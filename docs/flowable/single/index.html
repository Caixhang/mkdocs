<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<title>Flowable Unified DOCS (v 6.4.2-SNAPSHOT)</title>
<style>

/* normalize.css */

button,hr,input{overflow:visible}audio,canvas,progress,video{display:inline-block}progress,sub,sup{vertical-align:baseline}html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0} menu,article,aside,details,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{}button,select{text-transform:none}[type=submit], [type=reset],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}[hidden],template{display:none}/*# sourceMappingURL=normalize.min.css.map */

/* tocbot 2.1.4 */

.toc{overflow-y:auto}.toc>ul{overflow:hidden;position:relative}.toc-list{margin:0;padding-left:10px}a.toc-link{color:currentColor;height:100%}.is-collapsible{max-height:1000px;overflow:hidden;transition:all 300ms ease-in-out}.is-collapsed{max-height:0}.is-position-fixed{position:fixed !important;top:0}.is-active-link{font-weight:700}.toc-link::before{background-color:#f9f9fb;content:' ';display:inline-block;height:inherit;left:8px;margin-top:-1px;position:absolute;width:2px}.is-active-link::before{background-color:#54BC4B}


/* Activiti Specific */

body {
  color: #494d55;
  font-size: 16px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

html, body {
  height: 100%;
  width: 100%;
  background: #f9f9f9;
  font-family: "Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;
  color: #484848
}

.page-wrapper {
  min-height: 100%;
  /* equal to footer height */
  margin-bottom: -50px;
}

.page-wrapper:after {
  content: "";
  display: block;
  height: 50px;
}

#header {
  position:fixed;
  top:0px;
  z-index:100000;
  width:100%;
}

#header > h1 {
    background: #a0cc47;
    color: #f9f9f9;
    border-bottom: 2px solid #042944;
    padding: 20px 0 20px 20px;
    font-size: 40px;
    font-weight: 800;
    line-height: 1.1;
    margin: 0;
}

#header > h1:before {
  background:url('images/logo.png');
  background-size: 337px 54px; background-repeat: no-repeat;
  width: 337px;
  height: 54px;
  display:inline-block;
  content:'';
  margin-right: 30px;
}

#author {
  margin-left: 25%;
  font-size: 40px;
}

#content {
  margin: 129px 0 0 27%;
  padding: 10px 40px 0 20px;
  padding-right: 40px;
  line-height: 1.7;
  width: 65%;
  overflow-x: auto;
}

h2, h3, h4, h5, h6 {
  color: #00345a;
}

h2 {
  font-size: 26px;
  margin-top: 0;
  margin-bottom: 20px;
  font-weight: bold;
  padding-bottom: 10px;
  border-bottom: 1px solid #d7d7d7;
}

h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 0;
  font-weight: bold;
  padding-bottom: 10px;
  /*border-bottom: 1px solid #d7d7d7;*/
}

h4 {
    font-size: 16px;
    font-weight: bold;
}

h5 {
    font-size: 14px;
    font-weight: bold;
}

h6, h7 {
    font-size: 14px;
    font-weight: bold;
    margin-top: 0;
    margin-bottom: 0;
}

.sect1, .sect2 {
  margin-bottom: 20px;
}

.clear
{
  clear: both;
}

.note, .listingblock, .literalblock{
  padding-left: 8px;
  padding-right: 8px;
  margin-bottom: 14px;
  background-color: #f7f7f9;
  border: 1px solid #e1e1e8;
  border-radius: 4px;
  color: #808080;
}

table.tableblock {
  width: 100%;
  max-width: 100%;
  margin-bottom: 20px;
  background-color: transparent;
  border-spacing: 0;
  border-collapse: collapse;
  border: 1px solid #ddd;
  table-layout: fixed;
}

table.tableblock>caption+thead>tr:first-child>td, table.tableblock>caption+thead>tr:first-child>th, table.tableblock>colgroup+thead>tr:first-child>td, table.tableblock>colgroup+thead>tr:first-child>th, table.tableblock>thead:first-child>tr:first-child>td, table.tableblock>thead:first-child>tr:first-child>th {
    border-top: 0;
}

table.tableblock > thead > tr > th {
    border-bottom-color: #8bd6d8;
}

table.tableblock>thead>tr>th {
    vertical-align: bottom;
    border-bottom: 1px solid #ddd;
}

table.tableblock>tbody>tr>td, table.tableblock>tbody>tr>th, table.tableblock>tfoot>tr>td, table.tableblock>tfoot>tr>th, table.tableblock>thead>tr>td, table.tableblock>thead>tr>th {
    padding: 8px;
    line-height: 1.42857143;
    vertical-align: top;
    border-top: 1px solid #ddd;
}

th {
    text-align: left;
}

table.tableblock > tbody > tr:nth-of-type(odd) {
    background-color: #f5f5f5;
}

table.tableblock > tbody > tr:nth-of-type(odd) {
    background-color: #f9f9f9;
}

td > p {
  margin:0;
}

td.content {
  white-space: normal;
}

pre, td, th {
   white-space: pre-wrap;
   white-space: -moz-pre-wrap;
   white-space: -pre-wrap;
   white-space: -o-pre-wrap;
   word-wrap: break-word;
}

img {
  max-width: 100%;
}

a {
  color: #007387;
}

a:hover {
  color: #004c59;
}

#toc-parent {
  width: 25%;
  float: left;
  height: 100%;
  overflow-y: auto;
  position: fixed;
  padding: 10px;
  border-right: 1px solid #ccc;
}

#generated-toc {
    width: 100%;
    height: 100%;
    font-size: 16px;
}

.toc-link {
  text-decoration: none;
}

.toc-list {
  margin: 0 20px 0 10px;
}

.toc-list-item {
  padding: 4px 0 4px 0;
}


div.sect5  p {
    margin-top: 0;
    margin-bottom: 0;
}

div.sect5  code {
    font-family: "Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments, .listingblock .pygments code { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
<script type="text/javascript">

/*
 * Tocbot.min.js version 2.1.4
 */

 !function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([/*!*************************!*\
   !*** ./src/js/index.js ***!
   \*************************/
 function(e,t,n){var o,i,r;(function(l){!function(n,l){i=[],o=l(n),r="function"==typeof o?o.apply(t,i):o,!(void 0!==r&&(e.exports=r))}("undefined"!=typeof l?l:this.window||this.global,function(e){"use strict";function t(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var o in n)h.call(n,o)&&(e[o]=n[o])}return e}function o(e,t,n){t||(t=250);var o,i;return function(){var r=n||this,l=+new Date,s=arguments;o&&l<o+t?(clearTimeout(i),i=setTimeout(function(){o=l,e.apply(r,s)},t)):(o=l,e.apply(r,s))}}var i,r,l,s=n(/*! smooth-scroll */1),c=n(/*! ./default-options.js */2),a={},u={},d=n(/*! ./build-html.js */3),f=n(/*! ./parse-content.js */4),m=(e.document,document.body,!!e.document.querySelector&&!!e.addEventListener),h=Object.prototype.hasOwnProperty;return u.destroy=function(){try{document.querySelector(a.tocSelector).innerHTML=""}catch(e){console.warn("Element not found: "+a.tocSelector)}document.removeEventListener("scroll",this._scrollListener,!1),document.removeEventListener("resize",this._scrollListener,!1),i&&document.removeEventListener("click",this._clickListener,!1),s&&s.destroy()},u.init=function(e){if(m&&(a=t(c,e||{}),this.options=a,this.state={},i=d(a),r=f(a),this._buildHtml=i,this._parseContent=r,u.destroy(),l=r.selectHeadings(a.contentSelector,a.headingSelector),null!==l)){var n=r.nestHeadingsArray(l),h=n.nest;return i.render(a.tocSelector,h),this._scrollListener=o(function(){i.updateToc(l)},a.throttleTimeout),this._scrollListener(),document.addEventListener("scroll",this._scrollListener,!1),document.addEventListener("resize",this._scrollListener,!1),this._clickListener=o(function(e){i.disableTocAnimation(e),i.updateToc(l)},a.throttleTimeout),document.addEventListener("click",this._clickListener,!1),s&&(this.smoothScroll=s.init(t(a.smoothScrollOptions,{callback:i.enableTocAnimation}))),this}},u.refresh=function(e){u.destroy(),u.init(e||this.options)},e.tocbot=u,u})}).call(t,function(){return this}())},/*!******************************************************!*\
   !*** ./~/smooth-scroll/dist/js/smooth-scroll.min.js ***!
   \******************************************************/
 function(e,t,n){var o,i,r;(function(n){/*! smooth-scroll v10.0.1 | (c) 2016 Chris Ferdinandi | MIT License | http://github.com/cferdinandi/smooth-scroll */
 !function(n,l){i=[],o=l(n),r="function"==typeof o?o.apply(t,i):o,!(void 0!==r&&(e.exports=r))}("undefined"!=typeof n?n:this.window||this.global,function(e){"use strict";var t,n,o,i,r,l,s,c={},a="querySelector"in document&&"addEventListener"in e,u={selector:"[data-scroll]",selectorHeader:null,speed:500,easing:"easeInOutCubic",offset:0,callback:function(){}},d=function(){var e={},t=!1,n=0,o=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(t=arguments[0],n++);for(var i=function(n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t&&"[object Object]"===Object.prototype.toString.call(n[o])?e[o]=d(!0,e[o],n[o]):e[o]=n[o])};o>n;n++){var r=arguments[n];i(r)}return e},f=function(e){return Math.max(e.scrollHeight,e.offsetHeight,e.clientHeight)},m=function(e,t){var n,o,i=t.charAt(0),r="classList"in document.documentElement;for("["===i&&(t=t.substr(1,t.length-2),n=t.split("="),n.length>1&&(o=!0,n[1]=n[1].replace(/"/g,"").replace(/'/g,"")));e&&e!==document&&1===e.nodeType;e=e.parentNode){if("."===i)if(r){if(e.classList.contains(t.substr(1)))return e}else if(new RegExp("(^|\\s)"+t.substr(1)+"(\\s|$)").test(e.className))return e;if("#"===i&&e.id===t.substr(1))return e;if("["===i&&e.hasAttribute(n[0])){if(!o)return e;if(e.getAttribute(n[0])===n[1])return e}if(e.tagName.toLowerCase()===t)return e}return null},h=function(e){"#"===e.charAt(0)&&(e=e.substr(1));for(var t,n=String(e),o=n.length,i=-1,r="",l=n.charCodeAt(0);++i<o;){if(t=n.charCodeAt(i),0===t)throw new InvalidCharacterError("Invalid character: the input contains U+0000.");r+=t>=1&&31>=t||127==t||0===i&&t>=48&&57>=t||1===i&&t>=48&&57>=t&&45===l?"\\"+t.toString(16)+" ":t>=128||45===t||95===t||t>=48&&57>=t||t>=65&&90>=t||t>=97&&122>=t?n.charAt(i):"\\"+n.charAt(i)}return"#"+r},p=function(e,t){var n;return"easeInQuad"===e&&(n=t*t),"easeOutQuad"===e&&(n=t*(2-t)),"easeInOutQuad"===e&&(n=.5>t?2*t*t:-1+(4-2*t)*t),"easeInCubic"===e&&(n=t*t*t),"easeOutCubic"===e&&(n=--t*t*t+1),"easeInOutCubic"===e&&(n=.5>t?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1),"easeInQuart"===e&&(n=t*t*t*t),"easeOutQuart"===e&&(n=1- --t*t*t*t),"easeInOutQuart"===e&&(n=.5>t?8*t*t*t*t:1-8*--t*t*t*t),"easeInQuint"===e&&(n=t*t*t*t*t),"easeOutQuint"===e&&(n=1+--t*t*t*t*t),"easeInOutQuint"===e&&(n=.5>t?16*t*t*t*t*t:1+16*--t*t*t*t*t),n||t},v=function(e,t,n){var o=0;if(e.offsetParent)do o+=e.offsetTop,e=e.offsetParent;while(e);return o=Math.max(o-t-n,0),Math.min(o,b()-g())},g=function(){return Math.max(document.documentElement.clientHeight,e.innerHeight||0)},b=function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)},C=function(e){return e&&"object"==typeof JSON&&"function"==typeof JSON.parse?JSON.parse(e):{}},S=function(e){return e?f(e)+e.offsetTop:0},y=function(t,n,o){o||(t.focus(),document.activeElement.id!==t.id&&(t.setAttribute("tabindex","-1"),t.focus(),t.style.outline="none"),e.scrollTo(0,n))};c.animateScroll=function(n,o,l){var c=C(o?o.getAttribute("data-options"):null),a=d(t||u,l||{},c),f="[object Number]"===Object.prototype.toString.call(n),m=f||!n.tagName?null:n;if(f||m){var h=e.pageYOffset;a.selectorHeader&&!i&&(i=document.querySelector(a.selectorHeader)),r||(r=S(i));var g,x,N=f?n:v(m,r,parseInt(a.offset,10)),L=N-h,O=b(),E=0,A=function(t,i,r){var l=e.pageYOffset;(t==i||l==i||e.innerHeight+l>=O)&&(clearInterval(r),y(n,i,f),a.callback(n,o))},H=function(){E+=16,g=E/parseInt(a.speed,10),g=g>1?1:g,x=h+L*p(a.easing,g),e.scrollTo(0,Math.floor(x)),A(x,N,s)},T=function(){clearInterval(s),s=setInterval(H,16)};0===e.pageYOffset&&e.scrollTo(0,0),T()}};var x=function(t){e.location.hash,n&&(n.id=n.getAttribute("data-scroll-id"),c.animateScroll(n,o),n=null,o=null)},N=function(i){if(0===i.button&&!i.metaKey&&!i.ctrlKey&&(o=m(i.target,t.selector),o&&"a"===o.tagName.toLowerCase()&&o.hostname===e.location.hostname&&o.pathname===e.location.pathname&&/#/.test(o.href))){var r=h(o.hash);if("#"===r){i.preventDefault(),n=document.body;var l=n.id?n.id:"smooth-scroll-top";return n.setAttribute("data-scroll-id",l),n.id="",void(e.location.hash.substring(1)===l?x():e.location.hash=l)}n=document.querySelector(r),n&&(n.setAttribute("data-scroll-id",n.id),n.id="",o.hash===e.location.hash&&(i.preventDefault(),x()))}},L=function(e){l||(l=setTimeout(function(){l=null,r=S(i)},66))};return c.destroy=function(){t&&(document.removeEventListener("click",N,!1),e.removeEventListener("resize",L,!1),t=null,n=null,o=null,i=null,r=null,l=null,s=null)},c.init=function(n){a&&(c.destroy(),t=d(u,n||{}),i=t.selectorHeader?document.querySelector(t.selectorHeader):null,r=S(i),document.addEventListener("click",N,!1),e.addEventListener("hashchange",x,!1),i&&e.addEventListener("resize",L,!1))},c})}).call(t,function(){return this}())},/*!***********************************!*\
   !*** ./src/js/default-options.js ***!
   \***********************************/
 function(e,t){e.exports={tocSelector:".js-toc",contentSelector:".js-toc-content",headingSelector:"h1, h2, h3",ignoreSelector:".js-toc-ignore",linkClass:"toc-link",extraLinkClasses:"",activeLinkClass:"is-active-link",listClass:"toc-list",extraListClasses:"",isCollapsedClass:"is-collapsed",collapsibleClass:"is-collapsible",listItemClass:"toc-list-item",collapseDepth:0,smoothScrollOptions:{easing:"easeInOutCubic",offset:0,speed:300,updateURL:!0},headingsOffset:0,throttleTimeout:50,positionFixedSelector:null,positionFixedClass:"is-position-fixed",fixedSidebarOffset:"auto",includeHtml:!1}},/*!******************************!*\
   !*** ./src/js/build-html.js ***!
   \******************************/
 function(e,t){e.exports=function(e){function t(e,n){var r=n.appendChild(o(e));if(e.children.length){var l=i(e.isCollapsed);e.children.forEach(function(e){t(e,l)}),r.appendChild(l)}}function n(e,n){var o=!1,r=i(o);n.forEach(function(e){t(e,r)});var l=document.querySelector(e);if(null!==l)return l.firstChild&&l.removeChild(l.firstChild),l.appendChild(r)}function o(t){var n=document.createElement("li"),o=document.createElement("a");return e.listItemClass&&n.setAttribute("class",e.listItemClass),e.includeHtml&&t.childNodes.length?u.call(t.childNodes,function(e){o.appendChild(e.cloneNode(!0))}):o.textContent=t.textContent,o.setAttribute("data-scroll",""),o.setAttribute("href","#"+t.id),o.setAttribute("class",e.linkClass+h+"node-name--"+t.nodeName+h+e.extraLinkClasses),n.appendChild(o),n}function i(t){var n=document.createElement("ul"),o=e.listClass+h+e.extraListClasses;return t&&(o+=h+e.collapsibleClass,o+=h+e.isCollapsedClass),n.setAttribute("class",o),n}function r(){var t=document.documentElement.scrollTop||f.scrollTop,n=document.querySelector(e.positionFixedSelector);"auto"===e.fixedSidebarOffset&&(e.fixedSidebarOffset=document.querySelector(e.tocSelector).offsetTop),t>e.fixedSidebarOffset?n.className.indexOf(e.positionFixedClass)===-1&&(n.className+=h+e.positionFixedClass):n.className=n.className.split(h+e.positionFixedClass).join("")}function l(t){var n=document.documentElement.scrollTop||f.scrollTop;e.positionFixedSelector&&r();var o,i=t;if(m&&null!==document.querySelector(e.tocSelector)&&i.length>0){d.call(i,function(t,r){if(t.offsetTop>n+e.headingsOffset){var l=0===r?r:r-1;return o=i[l],!0}if(r===i.length-1)return o=i[i.length-1],!0});var l=document.querySelector(e.tocSelector).querySelectorAll("."+e.linkClass);u.call(l,function(t){t.className=t.className.split(h+e.activeLinkClass).join("")});var c=document.querySelector(e.tocSelector).querySelector("."+e.linkClass+".node-name--"+o.nodeName+'[href="#'+o.id+'"]');c.className+=h+e.activeLinkClass;var a=document.querySelector(e.tocSelector).querySelectorAll("."+e.listClass+"."+e.collapsibleClass);u.call(a,function(t){var n=h+e.isCollapsedClass;t.className.indexOf(n)===-1&&(t.className+=h+e.isCollapsedClass)}),c.nextSibling&&(c.nextSibling.className=c.nextSibling.className.split(h+e.isCollapsedClass).join("")),s(c.parentNode.parentNode)}}function s(t){return t.className.indexOf(e.collapsibleClass)!==-1?(t.className=t.className.split(h+e.isCollapsedClass).join(""),s(t.parentNode.parentNode)):t}function c(t){var n=t.target||t.srcElement;n.className.indexOf(e.linkClass)!==-1&&(m=!1)}function a(){m=!0}var u=[].forEach,d=[].some,f=document.body,m=!0,h=" ";return{enableTocAnimation:a,disableTocAnimation:c,render:n,updateToc:l}}},/*!*********************************!*\
   !*** ./src/js/parse-content.js ***!
   \*********************************/
 function(e,t){e.exports=function(e){function t(e){return e[e.length-1]}function n(e){return+e.nodeName.split("H").join("")}function o(t){var o={id:t.id,children:[],nodeName:t.nodeName,headingLevel:n(t),textContent:t.textContent.trim()};return e.includeHtml&&(o.childNodes=t.childNodes),o}function i(i,r){for(var l=o(i),s=n(i),c=r,a=t(c),u=a?a.headingLevel:0,d=s-u;d>0;)a=t(c),a&&void 0!==a.children&&(c=a.children),d--;return s>=e.collapseDepth&&(l.isCollapsed=!0),c.push(l),c}function r(t,n){var o=n;e.ignoreSelector&&(o=n.split(",").map(function(t){return t.trim()+":not("+e.ignoreSelector+")"}));try{return document.querySelector(t).querySelectorAll(o)}catch(i){return console.warn("Element not found: "+t),null}}function l(e){return s.call(e,function(e,t){var n=o(t);return i(n,e.nest),e},{nest:[]})}var s=[].reduce;return{nestHeadingsArray:l,selectHeadings:r}}}]);
 //# sourceMappingURL=tocbot.min.js.map

</script>

<script type="text/javascript">

  var generateToc = function() {
    var readyState = document.readyState;
    if (readyState === 'interactive' || readyState == 'complete') {

      var headerSize = 140;

      var tocParentNode = document.createElement("div");
      tocParentNode.setAttribute("id", "toc-parent");

      var generatedTocNode = document.createElement("div");
      generatedTocNode.setAttribute("id", "generated-toc");
      tocParentNode.appendChild(generatedTocNode);

      var contentNode = document.getElementById("content");
      contentNode.parentNode.insertBefore(tocParentNode, contentNode);

      var clearNode = document.createElement("div");
      clearNode.setAttribute("class", "clear");
      contentNode.parentNode.appendChild(clearNode);

      tocbot.init({
        tocSelector: '#generated-toc',
        contentSelector: '#content',
        headingSelector: 'h2, h3, h4, h5',
        headingsOffset: headerSize,
        smoothScrollOptions: {
          easing: 'easeInOutCubic',
          offset: headerSize,
          speed: 300, // animation duration.
          updateURL: true
        },
        collapseDepth: 0
      });

    } else {
      window.setTimeout(function(){
        generateToc();
      }, 50);
    }

  }
  generateToc();

</script>
</head>
<body class="book">
<div id="header">
<h1>Flowable Unified DOCS (v 6.4.2-SNAPSHOT)</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_说明">1. 说明</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="license">1.1. 翻译(说明)</h3>
<div class="paragraph">
<p>由[分享牛Flowable中国社区] 翻译，任何意见建议,欢迎联系QQ:3152981878。
如果想一起成为开源代码贡献人员，欢迎大家加入qq交流群为社区贡献添砖加瓦。qq贡献群：1023773998</p>
</div>
</div>
<div class="sect2">
<h3 id="_协议">1.2. 协议</h3>
<div class="paragraph">
<p>Flowable在<a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache V2 协议</a>下发布。</p>
</div>
</div>
<div class="sect2">
<h3 id="download">1.3. 下载</h3>
<div class="paragraph">
<p><a href="http://www.flowable.org/downloads.html"><a href="http://www.flowable.org/downloads.html" class="bare">http://www.flowable.org/downloads.html</a></a></p>
</div>
</div>
<div class="sect2">
<h3 id="sources">1.4. 源码</h3>
<div class="paragraph">
<p>Flowable的发布包里包含了大部分源码，以JAR文件方式提供。Flowable的源码也可以通过以下链接获得：
  <a href="https://github.com/flowable/flowable-engine"><a href="https://github.com/flowable/flowable-engine" class="bare">https://github.com/flowable/flowable-engine</a></a></p>
</div>
</div>
<div class="sect2">
<h3 id="required.software">1.5. 必要的软件</h3>
<div class="sect3">
<h4 id="_jdk_8">1.5.1. JDK 8+</h4>
<div class="paragraph">
<p>运行Flowable需要JDK 8或以上版本。可以访问 <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Oracle Java SE downloads页面</a> 点击“Download JDK”按钮获取。该页面上也有安装指导。安装完成后，可以执行 <code>java -version</code> 。能看到JDK的版本信息就说明安装成功了。</p>
</div>
</div>
<div class="sect3">
<h4 id="_ide">1.5.2. IDE</h4>
<div class="paragraph">
<p>可以自行选择用于Flowable开发的IDE。如果想要使用Flowable Designer，则需要Eclipse Mars或Neon。
到 <a href="http://www.eclipse.org/downloads/">Eclipse下载页面</a>选择Eclipse版本并下载。解压下载的文件，
然后执行<code>eclipse</code>文件夹下的eclipse文件。手册后续有专门一章介绍如何<a href="#eclipseDesignerInstallation">安装我们的Eclipse Designer插件</a>。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reporting.problems">1.6. 反馈问题</h3>
<div class="paragraph">
<p>我们希望开发者在报告或提问之前，先看看<a href="http://www.catb.org/~esr/faqs/smart-questions.html">提问的智慧</a>。</p>
</div>
<div class="paragraph">
<p>看完提问的智慧，你可以在<a href="http://forums.flowable.org">用户论坛</a>提问、评论以及提交改进建议，也可以在<a href="https://github.com/flowable/flowable-engine/issues">我们的Github问题跟踪系统</a>创建bug报告。</p>
</div>
</div>
<div class="sect2">
<h3 id="experimental">1.7. 实验性功能</h3>
<div class="paragraph">
<p>标记有<strong>[实验性]</strong>的章节介绍的功能还不够稳定。</p>
</div>
<div class="paragraph">
<p><code>.impl.</code>包下的类都是内部实现类，不保证稳定。但是，在用户手册中作为配置参数介绍的类则是被官方支持的，可以保证稳定。</p>
</div>
</div>
<div class="sect2">
<h3 id="internal">1.8. 内部实现类</h3>
<div class="paragraph">
<p>在JAR文件中，所有<code>.impl.</code>包下的类（比如<code>org.flowable.engine.impl.db</code>）都是实现类，只应在内部使用。实现类中的所有类或接口都不保证稳定。</p>
</div>
</div>
<div class="sect2">
<h3 id="_versioning_strategy">1.9. 版本策略</h3>
<div class="paragraph">
<p>使用三个整数的形式标记版本：<strong>MAJOR.MINOR.MICRO</strong>。其中 <strong>MAJOR</strong>版本代表核心引擎的演进。<strong>MINOR</strong>版本代表新功能与新API。<strong>MICRO</strong>版本代表bug修复与改进。</p>
</div>
<div class="paragraph">
<p>总的来说，Flowable希望在<strong>MINOR</strong>与<strong>MICRO</strong>版本中，对所有非内部实现类保持“源代码兼容性”，即应用可以正确构建，且不改变语义。Flowable也希望在<strong>MINOR</strong>与<strong>MICRO</strong>版本中，保持“二进制兼容性”，即用新版本的Flowable直接替换老版本的Jar文件，仍然可以正常工作。</p>
</div>
<div class="paragraph">
<p>如果在<strong>MINOR</strong>版本中修改了API，将保留原有版本，并使用<em>@Deprecated</em>注解。这种废弃的API将在两个<strong>MINOR</strong>版本之后移除。</p>
</div>
</div>
<div class="sect2">
<h3 id="translator_info">1.10. Architecture Overview</h3>
<div class="paragraph">
<p><strong>TBD</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="_supported_platform">1.11. Supported Platform</h3>
<div class="paragraph">
<p><strong>TBD</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="_history">1.12. History</h3>
<div class="paragraph">
<p><strong>TBD</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="_whats_new">1.13. What&#8217;s new</h3>
<div class="paragraph">
<p><strong>TBD</strong></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concepts">2. Concepts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="bpmnConstructs">2.1. BPMN 2.0结构</h3>
<div class="paragraph">
<p>本章节介绍Flowable支持的BPMN 2.0结构，以及Flowable对BPMN标准的自定义扩展。</p>
</div>
<div class="sect3">
<h4 id="bpmnCustomExtensions">2.1.1. 自定义扩展</h4>
<div class="paragraph">
<p>BPMN 2.0标准对流程的所有的参与者都很有用。最终用户不会因为依赖专有解决方案，而被供应商“绑架”。Flowable之类的开源框架，也可以提供与大型供应商的解决方案相同（经常是更好;-）的实现。有了BPMN 2.0标准，从大型供应商解决方案向Flowable的迁移，可以十分简单平滑。</p>
</div>
<div class="paragraph">
<p>缺点则是标准通常是不同公司（不同观点）大量讨论与妥协的结果。作为阅读BPMN 2.0 XML流程定义的开发者，有时会觉得某些结构或方法十分笨重。Flowable将开发者的感受放在最高优先，因此引入了一些<strong><em>Flowable BPMN扩展（extensions）</em></strong>。这些“扩展”并不在BPMN 2.0规格中，有些是新结构，有些是对特定结构的简化。</p>
</div>
<div class="paragraph">
<p>尽管BPMN 2.0规格明确指出可以支持自定义扩展，我们仍做了如下保证：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>自定义扩展<strong>保证是</strong>在<strong>标准方式</strong>的基础上进行简化。因此当你决定使用自定义扩展时，不用担心无路可退（仍然可以用标准方式）。</p>
</li>
<li>
<p>使用自定义扩展时，总是通过<strong>flowable:</strong>命名空间前缀，明确标识出XML元素、属性等。请注意Flowable引擎也支持<strong>activiti:</strong>命名空间前缀。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>因此是否使用自定义扩展，完全取决于你自己。有些其他因素会影响选择（图形化编辑器的使用，公司策略，等等）。我们提供扩展，只是因为相信标准中的某些地方可以用更简单或效率更高的方式处理。请不要吝啬给我们反馈你对扩展的评价（正面的或负面的），也可以给我们提供关于自定义扩展的新想法。说不定某一天，你的想法会成为标准的一部分！</p>
</div>
</div>
<div class="sect3">
<h4 id="bpmnEvents">2.1.2. 事件</h4>
<div class="paragraph">
<p>事件（event）通常用于为流程生命周期中发生的事情建模。事件总是图形化为圆圈。在BPMN 2.0中，有两种主要的事件分类：<em>捕获（catching）</em>与<em>抛出（throwing）</em>事件。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>捕获:</strong> 当流程执行到达这个事件时，会等待直到触发器动作。触发器的类型由其中的图标，或者说XML中的类型声明而定义。捕获事件与抛出事件显示上的区别，是其内部的图标没有填充（即是白色的）。</p>
</li>
<li>
<p><strong>抛出:</strong> 当流程执行到达这个事件时，会触发一个触发器。触发器的类型，由其中的图标，或者说XML中的类型声明而定义。抛出事件与捕获事件显示上的区别，是其内部的图标填充为黑色。</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="eventDefinitions">事件定义</h5>
<div class="paragraph">
<p>事件定义（event definition），用于定义事件的语义。没有事件定义的话，事件就“不做什么特别的事情”。例如，一个没有事件定义的开始事件，并不限定具体是什么启动了流程。如果为这个开始事件添加事件定义（例如定时器事件定义），就声明了启动流程的“类型”（例如对于定时器事件定义，就是到达了特定的时间点）。</p>
</div>
</div>
<div class="sect4">
<h5 id="timerEventDefinitions">定时器事件定义</h5>
<div class="paragraph">
<p>定时器事件（timer event definition），是由定时器所触发的事件。可以用于<a href="#bpmnTimerStartEvent">开始事件</a>，<a href="#bpmnIntermediateCatchingEvent">中间事件</a>，或<a href="#bpmnTimerBoundaryEvent">边界事件</a>。定时器事件的行为取决于所使用的业务日历（business calendar）。定时器事件有默认的业务日历，但也可以为每个定时器事件定义，单独定义业务日历。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;timerEventDefinition</span> <span class="tok-na">flowable:businessCalendarName=</span><span class="tok-s">&quot;custom&quot;</span><span class="tok-nt">&gt;</span>
    ...
<span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>其中businessCalendarName指向流程引擎配置中的业务日历。如果省略业务日历定义，则使用默认业务日历。</p>
</div>
<div class="paragraph">
<p>定时器定义必须且只能包含下列的一种元素：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>timeDate</strong>。这个元素指定了<a href="http://en.wikipedia.org/wiki/ISO_8601#Dates">ISO 8601</a>格式的固定时间。在这个时间就会触发触发器。例如：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;timerEventDefinition&gt;</span>
    <span class="tok-nt">&lt;timeDate&gt;</span>2011-03-11T12:13:14<span class="tok-nt">&lt;/timeDate&gt;</span>
<span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>timeDuration</strong>。要定义定时器需要等待多长时间再触发，可以用<em>timerEventDefinition</em>的子元素<em>timeDuration</em>。使用<a href="http://en.wikipedia.org/wiki/ISO_8601#Durations">ISO 8601</a>格式（BPMN 2.0规范要求）。例如（等待10天）：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;timerEventDefinition&gt;</span>
    <span class="tok-nt">&lt;timeDuration&gt;</span>P10D<span class="tok-nt">&lt;/timeDuration&gt;</span>
<span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>timeCycle</strong>。指定重复周期，可用于周期性启动流程，或者为超期用户任务多次发送提醒。这个元素可以使用两种格式。第一种是按照<a href="http://en.wikipedia.org/wiki/ISO_8601#Repeating_intervals">ISO 8601</a>标准定义的循环时间周期。例如（三次重复间隔，每次间隔为10小时）：</p>
</li>
<li>
<p>也可以使用<em>timeCycle</em>的可选属性<em>endDate</em>，或者像这样直接写在时间表达式的结尾：<code>R3/PT10H/${EndDate}</code>。
当到达endDate时，应用会停止，并为该任务创建其他作业。
可以使用<a href="http://en.wikipedia.org/wiki/ISO_8601#Dates">ISO 8601</a>标准的常量，如<em>"2015-02-25T16:42:11+00:00"</em>。也可以使用变量，如<em>${EndDate}</em></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;timerEventDefinition&gt;</span>
    <span class="tok-nt">&lt;timeCycle</span> <span class="tok-na">flowable:endDate=</span><span class="tok-s">&quot;2015-02-25T16:42:11+00:00&quot;</span><span class="tok-nt">&gt;</span>R3/PT10H<span class="tok-nt">&lt;/timeCycle&gt;</span>
<span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;timerEventDefinition&gt;</span>
    <span class="tok-nt">&lt;timeCycle&gt;</span>R3/PT10H/${EndDate}<span class="tok-nt">&lt;/timeCycle&gt;</span>
<span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果同时使用了两种格式，则系统会使用以属性方式定义的endDate。</p>
</div>
<div class="paragraph">
<p>目前只有<em>BoundaryTimerEvents</em>与<em>CatchTimerEvent</em>可以使用<em>EndDate</em>。</p>
</div>
<div class="paragraph">
<p>另外，也可以使用cron表达式指定定时周期。下面的例子展示了一个整点启动，每5分钟触发的触发器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>0 0/5 * * * ?</pre>
</div>
</div>
<div class="paragraph">
<p>请参考<a href="http://www.quartz-scheduler.org/documentation/quartz-2.x/tutorials/crontrigger.html">这个教程</a>了解如何使用cron表达式。</p>
</div>
<div class="paragraph">
<p><strong>请注意:</strong> 与普通的Unix cron不同，第一个符号代表的是秒，而不是分钟。</p>
</div>
<div class="paragraph">
<p>重复时间周期更适合使用相对时间，也就是从某个特定时间点开始计算（比如用户任务开始的时间）。而cron表达式可以使用绝对时间，因此更适合用于<a href="#timerStartEventDescription">定时启动事件</a>。</p>
</div>
<div class="paragraph">
<p>可以在定时事件定义中使用表达式，也就是使用流程变量控制定时。这个流程变量必须是包含合适时间格式的字符串，ISO 8601（或者对于循环类型，cron）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;boundaryEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;escalationTimer&quot;</span> <span class="tok-na">cancelActivity=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">attachedToRef=</span><span class="tok-s">&quot;firstLineSupport&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;timerEventDefinition&gt;</span>
    <span class="tok-nt">&lt;timeDuration&gt;</span>${duration}<span class="tok-nt">&lt;/timeDuration&gt;</span>
  <span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
<span class="tok-nt">&lt;/boundaryEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>定时器只有在异步执行器启用时才能触发（需要在<code>flowable.cfg.xml</code>中，将<em>asyncExecutorActivate</em>设置为<code>true</code>。因为默认情况下异步执行器都是禁用的）。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnErrorEventDefinition">错误事件定义</h5>
<div class="paragraph">
<p>（error event definition）</p>
</div>
<div class="paragraph">
<p><strong>重要提示：</strong> BPMN错误与Java异常<strong>不</strong>是一回事。事实上，这两者毫无共同点。BPMN错误事件是建模<em>业务异常（business exceptions）</em>的方式。而Java异常会按<a href="#serviceTaskExceptionHandling">它们自己的方式</a>处理。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myErrorEndEvent&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;errorEventDefinition</span> <span class="tok-na">errorRef=</span><span class="tok-s">&quot;myError&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/endEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnSignalEventDefinition">信号事件定义</h5>
<div class="paragraph">
<p>信号事件（signal event），是引用具名信号的事件。信号是全局范围（广播）的事件，并会被传递给所有激活的处理器（等待中的流程实例/捕获信号事件 catching signal events）。</p>
</div>
<div class="paragraph">
<p>使用<code>signalEventDefinition</code>元素声明信号事件定义。其<code>signalRef</code>属性引用一个<code>signal</code>元素，该<code>signal</code>元素需要声明为<code>definitions</code>根元素的子元素。下面摘录一个流程，使用中间事件（intermediate event）抛出与捕获信号事件。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions...</span> <span class="tok-nt">&gt;</span>
    <span class="tok-c">&lt;!-- 声明信号 --&gt;</span>
    <span class="tok-nt">&lt;signal</span> <span class="tok-na">id=</span><span class="tok-s">&quot;alertSignal&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;alert&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;catchSignal&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;intermediateThrowEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;throwSignalEvent&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Alert&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-c">&lt;!-- 信号事件定义 --&gt;</span>
            <span class="tok-nt">&lt;signalEventDefinition</span> <span class="tok-na">signalRef=</span><span class="tok-s">&quot;alertSignal&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;/intermediateThrowEvent&gt;</span>
        ...
        <span class="tok-nt">&lt;intermediateCatchEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;catchSignalEvent&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;On Alert&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-c">&lt;!-- 信号事件定义 --&gt;</span>
            <span class="tok-nt">&lt;signalEventDefinition</span> <span class="tok-na">signalRef=</span><span class="tok-s">&quot;alertSignal&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;/intermediateCatchEvent&gt;</span>
        ...
    <span class="tok-nt">&lt;/process&gt;</span>
<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>两个<code>signalEventDefinition</code>引用同一个<code>signal</code>元素。</p>
</div>
<div class="sect5">
<h6 id="bpmnSignalEventDefinitionThrow">抛出信号事件</h6>
<div class="paragraph">
<p>信号可以由流程实例使用BPMN结构抛出（throw），也可以通过编程方式使用Java API抛出。下面<code>org.flowable.engine.RuntimeService</code>中的方法可以用编程方式抛出信号：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">RuntimeService</span><span class="tok-o">.</span><span class="tok-na">signalEventReceived</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">signalName</span><span class="tok-o">);</span>
<span class="tok-n">RuntimeService</span><span class="tok-o">.</span><span class="tok-na">signalEventReceived</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">signalName</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>signalEventReceived(String signalName)</code>与<code>signalEventReceived(String signalName, String executionId)</code>的区别，是前者在全局范围为所有已订阅处理器抛出信号（广播），而后者只为指定的执行传递信号。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnSignalEventDefinitionCatch">捕获信号事件</h6>
<div class="paragraph">
<p>可以使用信号捕获中间事件（intermediate catch signal event）或者信号边界事件（signal boundary event）捕获信号事件。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnSignalEventDefinitionQuery">查询信号事件订阅</h6>
<div class="paragraph">
<p>可以查询订阅了某一信号事件的所有执行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Execution</span><span class="tok-o">&gt;</span> <span class="tok-n">executions</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createExecutionQuery</span><span class="tok-o">()</span>
      <span class="tok-o">.</span><span class="tok-na">signalEventSubscriptionName</span><span class="tok-o">(</span><span class="tok-s">&quot;alert&quot;</span><span class="tok-o">)</span>
      <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用<code>signalEventReceived(String signalName, String executionId)</code>方法为这些执行传递这个信号。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnSignalEventDefinitionScope">信号事件的范围</h6>
<div class="paragraph">
<p>默认情况下，信号事件在<em>流程引擎全局广播</em>。这意味着你可以在一个流程实例中抛出一个信号事件，而不同流程定义的不同流程实例都会响应这个事件。</p>
</div>
<div class="paragraph">
<p>但有时也会希望只在<em>同一个流程实例</em>中响应信号事件。例如，在流程实例中使用异步机制，而两个或多个活动彼此互斥的时候。</p>
</div>
<div class="paragraph">
<p>要限制信号事件的<em>范围（scope）</em>，在信号事件定义中添加（非BPMN 2.0标准！）<em>scope属性</em>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;signal</span> <span class="tok-na">id=</span><span class="tok-s">&quot;alertSignal&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;alert&quot;</span> <span class="tok-na">flowable:scope=</span><span class="tok-s">&quot;processInstance&quot;</span><span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这个属性的默认值为<em>"global（全局）"</em>。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnSignalEventDefinitionExample">信号事件示例</h6>
<div class="paragraph">
<p>下面是一个不同流程通过信号通信的例子。第一个流程在保险政策更新或变更时启动。在变更由人工审核之后，会抛出信号事件，指出政策已经发生了变更：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.signal.event.throw.png" alt="bpmn.signal.event.throw">
</div>
</div>
<div class="paragraph">
<p>这个事件可以被所有感兴趣的流程实例捕获。下面是一个订阅这个事件的流程的例子。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.signal.event.catch.png" alt="bpmn.signal.event.catch">
</div>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>要理解信号事件会广播给<strong>所有</strong>激活的处理器，这很重要。这意味着在上面的例子中，所有订阅这个信号的流程实例都会接收这个信号。在这个例子中这就是我们期望的。然而，有的情况下，不希望使用广播方式。考虑下面的流程：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.signal.event.warning.1.png" alt="bpmn.signal.event.warning.1">
</div>
</div>
<div class="paragraph">
<p>Flowable不支持上面流程中描述的模式。我们的想法是，在执行"do something"任务时抛出的错误，由错误边界事件捕获，并通过信号抛出事件传播至执行的并行分支，最终中断"do something in parallel"任务。到目前为止Flowable会按照预期效果执行。<strong>然而，由于信号的广播效应，它也会被传播至所有其他订阅了这个信号事件的流程实例。</strong>这可能并非我们希望的效果。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>信号事件与特定的流程实例无关，而是会广播给所有流程实例。如果你需要只为某一特定的流程实例传递信号，则需要使用<code>signalEventReceived(String signalName, String executionId)</code>手动建立关联，并使用适当的的<a href="#bpmnSignalEventDefinitionQuery">查询机制</a>。</p>
</div>
<div class="paragraph">
<p>Flowable提供了解决的方法。可以在信号事件上添加<em>scope</em>属性，并将其设置为<em>processInstance</em>。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnMessageEventDefinition">消息事件定义</h5>
<div class="paragraph">
<p>消息事件（message event），是指引用具名消息的事件。消息具有名字与载荷。与信号不同，消息事件只有一个接收者。</p>
</div>
<div class="paragraph">
<p>消息事件定义使用<code>messageEventDefinition</code>元素声明。其<code>messageRef</code>属性引用一个<code>message</code>元素，该<code>message</code>元素需要声明为<code>definitions</code>根元素的子元素。下面摘录一个流程，声明了两个消息事件，并由开始事件与消息捕获中间事件（intermediate catching message event）引用。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span> <span class="tok-na">id=</span><span class="tok-s">&quot;definitions&quot;</span>
  <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot;</span>
  <span class="tok-na">xmlns:flowable=</span><span class="tok-s">&quot;http://flowable.org/bpmn&quot;</span>
  <span class="tok-na">targetNamespace=</span><span class="tok-s">&quot;Examples&quot;</span>
  <span class="tok-na">xmlns:tns=</span><span class="tok-s">&quot;Examples&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;message</span> <span class="tok-na">id=</span><span class="tok-s">&quot;newInvoice&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;newInvoiceMessage&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;message</span> <span class="tok-na">id=</span><span class="tok-s">&quot;payment&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;paymentMessage&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;invoiceProcess&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;messageStart&quot;</span> <span class="tok-nt">&gt;</span>
    	<span class="tok-nt">&lt;messageEventDefinition</span> <span class="tok-na">messageRef=</span><span class="tok-s">&quot;newInvoice&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/startEvent&gt;</span>
    ...
    <span class="tok-nt">&lt;intermediateCatchEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;paymentEvt&quot;</span> <span class="tok-nt">&gt;</span>
    	<span class="tok-nt">&lt;messageEventDefinition</span> <span class="tok-na">messageRef=</span><span class="tok-s">&quot;payment&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/intermediateCatchEvent&gt;</span>
    ...
  <span class="tok-nt">&lt;/process&gt;</span>

<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="bpmnMessageEventDefinitionThrow">抛出消息事件</h6>
<div class="paragraph">
<p>作为嵌入式的流程引擎，Flowable并不关心实际如何接收消息。因为这可能与环境相关，或需要进行平台定义的操作。例如连接至JMS（Java Messaging Service，Java消息服务）队列（Queue）/主题（Topic），或者处理Webservice或者REST请求。因此接收消息需要作为应用的一部分，或者是流程引擎所嵌入的基础框架中的一部分，由你自行实现。</p>
</div>
<div class="paragraph">
<p>在应用中接收到消息后，需要决定如何处理它。如果这个消息需要启动新的流程实例，可以选择一种由runtime服务提供的方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">ProcessInstance</span> <span class="tok-nf">startProcessInstanceByMessage</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">messageName</span><span class="tok-o">);</span>
<span class="tok-n">ProcessInstance</span> <span class="tok-nf">startProcessInstanceByMessage</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">messageName</span><span class="tok-o">,</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">processVariables</span><span class="tok-o">);</span>
<span class="tok-n">ProcessInstance</span> <span class="tok-nf">startProcessInstanceByMessage</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">messageName</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">businessKey</span><span class="tok-o">,</span>
    <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">processVariables</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这些方法使用消息启动流程实例。</p>
</div>
<div class="paragraph">
<p>如果需要由已有的流程实例接收消息，需要首先将消息与特定的流程实例关联（查看后续章节），然后触发等待中的执行，让流程继续进行。runtime服务提供了下列方法，可以触发订阅了消息事件的执行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-kt">void</span> <span class="tok-nf">messageEventReceived</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">messageName</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">);</span>
<span class="tok-kt">void</span> <span class="tok-nf">messageEventReceived</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">messageName</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">,</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">processVariables</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnMessageEventDefinitionQuery">查询消息事件订阅</h6>
<div class="ulist">
<ul>
<li>
<p>对于消息启动事件（message start event），消息事件的订阅与的<em>流程定义</em>相关。可以使用<code>ProcessDefinitionQuery</code>查询这种类型的消息订阅：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-n">ProcessDefinition</span> <span class="tok-n">processDefinition</span> <span class="tok-o">=</span> <span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">createProcessDefinitionQuery</span><span class="tok-o">()</span>
      <span class="tok-o">.</span><span class="tok-na">messageEventSubscription</span><span class="tok-o">(</span><span class="tok-s">&quot;newCallCenterBooking&quot;</span><span class="tok-o">)</span>
      <span class="tok-o">.</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>因为一个消息只能被一个流程定义订阅，因此这个查询总是返回0或1个结果。如果流程定义更新了，只有该流程定义的最新版本会订阅这个消息事件。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>对于消息捕获中间事件（intermediate catch message event），消息事件的订阅与<em>执行</em>相关。可以使用<code>ExecutionQuery</code>查询这种类型的消息订阅：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">Execution</span> <span class="tok-n">execution</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createExecutionQuery</span><span class="tok-o">()</span>
      <span class="tok-o">.</span><span class="tok-na">messageEventSubscriptionName</span><span class="tok-o">(</span><span class="tok-s">&quot;paymentReceived&quot;</span><span class="tok-o">)</span>
      <span class="tok-o">.</span><span class="tok-na">variableValueEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;orderId&quot;</span><span class="tok-o">,</span> <span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">getOrderId</span><span class="tok-o">())</span>
      <span class="tok-o">.</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这种查询通常都会有关联查询，并且通常需要了解流程的情况（在这个例子里，对于给定的orderId，至多只有一个流程实例）。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnMessageEventDefinitionExample">消息事件示例</h6>
<div class="paragraph">
<p>下面是一个流程的例子，可以使用两种不同的消息启动：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.start.message.event.example.1.png" alt="bpmn.start.message.event.example.1">
</div>
</div>
<div class="paragraph">
<p>在流程需要通过不同的方式启动，但是后续使用统一的方式处理时，就可以使用这种方法。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnStartEvents">启动事件</h5>
<div class="paragraph">
<p>启动事件（start event）是流程的起点。启动事件的类型（流程在消息到达时启动，在指定的时间间隔后启动，等等），定义了流程<em>如何</em>启动，并显示为启动事件中的小图标。在XML中，类型由子元素声明来定义。</p>
</div>
<div class="paragraph">
<p>启动事件<strong>随时捕获</strong>：启动事件（保持）等候，直到特定的触发器被触发。</p>
</div>
<div class="paragraph">
<p>在启动事件中，可以使用下列Flowable自定义参数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>initiator</strong>: 指明保存认证用户（authenticated user）ID用的变量名。在流程启动时，操作用户的ID会保存在这个变量中。例如：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;request&quot;</span> <span class="tok-na">flowable:initiator=</span><span class="tok-s">&quot;initiator&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>认证用户必须在try-finally块中调用<code>IdentityService.setAuthenticatedUserId(String)</code>方法进行设置。像这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-k">try</span> <span class="tok-o">{</span>
  <span class="tok-n">identityService</span><span class="tok-o">.</span><span class="tok-na">setAuthenticatedUserId</span><span class="tok-o">(</span><span class="tok-s">&quot;bono&quot;</span><span class="tok-o">);</span>
  <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;someProcessKey&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span> <span class="tok-k">finally</span> <span class="tok-o">{</span>
  <span class="tok-n">identityService</span><span class="tok-o">.</span><span class="tok-na">setAuthenticatedUserId</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这段代码已经集成在Flowable应用中，可以在<a href="#forms">表单</a>中使用。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnNoneStartEvent">空启动事件</h5>
<div class="sect5">
<h6 id="noneStartEventDescription">描述</h6>
<div class="paragraph">
<p>“空”启动事件（none Start Event），指的是未指定启动流程实例触发器的启动事件。引擎将无法预知何时启动流程实例。空启动事件用于流程实例通过调用下列<em>startProcessInstanceByXXX</em> API方法启动的情况。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">ProcessInstance</span> <span class="tok-n">processInstance</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByXXX</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>请注意：</em>子流程（sub-process）必须有空启动事件。</p>
</div>
</div>
<div class="sect5">
<h6 id="noneStartEventGraphicalNotation">图示</h6>
<div class="paragraph">
<p>空启动事件用空心圆圈表示，中间没有图标（也就是说，没有触发器）。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.none.start.event.png" alt="bpmn.none.start.event">
</div>
</div>
</div>
<div class="sect5">
<h6 id="noneStartEventXml">XML表示</h6>
<div class="paragraph">
<p>空启动事件的XML表示格式，就是普通的启动事件声明，而没有任何子元素（其他种类的启动事件都有用于声明其类型的子元素）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;my start event&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="noneStartEventCustomExtension">空启动事件的自定义扩展</h6>
<div class="paragraph">
<p><strong>formKey</strong>: 引用表单定义，用户需要在启动新流程实例时填写该表单。可以在<a href="#forms">表单章节</a>找到更多信息。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;request&quot;</span> <span class="tok-na">flowable:formKey=</span><span class="tok-s">&quot;request&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnTimerStartEvent">定时器启动事件</h5>
<div class="sect5">
<h6 id="timerStartEventDescription">描述</h6>
<div class="paragraph">
<p>定时器启动事件（timer start event）在指定时间创建流程实例。在流程只需要启动一次，或者流程需要在特定的时间间隔重复启动时，都可以使用。</p>
</div>
<div class="paragraph">
<p><em>请注意：</em>子流程不能有定时器启动事件。</p>
</div>
<div class="paragraph">
<p><em>请注意：</em>定时器启动事件，在流程部署的同时就开始计时。不需要调用startProcessInstanceByXXX就会在时间启动。调用startProcessInstanceByXXX时会在定时启动之外额外启动一个流程。</p>
</div>
<div class="paragraph">
<p><em>请注意：</em>当部署带有定时器启动事件的流程的更新版本时，上一版本的定时器作业会被移除。这是因为通常并不希望旧版本的流程仍然自动启动新的流程实例。</p>
</div>
</div>
<div class="sect5">
<h6 id="timerStartEventGraphicalNotation">图示</h6>
<div class="paragraph">
<p>定时器启动事件，用其中有一个钟表图标的圆圈来表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.clock.start.event.png" alt="bpmn.clock.start.event">
</div>
</div>
</div>
<div class="sect5">
<h6 id="timerStartEventXml">XML表示</h6>
<div class="paragraph">
<p>定时器启动事件的XML表示格式，是普通的启动事件声明加上定时器定义子元素。请参考<a href="#timerEventDefinitions">定时器定义</a>了解详细配置方法。</p>
</div>
<div class="paragraph">
<p>示例：流程会启动4次，间隔5分钟，从2011年3月11日，12:13开始</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;timerEventDefinition&gt;</span>
    <span class="tok-nt">&lt;timeCycle&gt;</span>R4/2011-03-11T12:13/PT5M<span class="tok-nt">&lt;/timeCycle&gt;</span>
  <span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
<span class="tok-nt">&lt;/startEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>示例：流程会在设定的时间启动一次</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;timerEventDefinition&gt;</span>
    <span class="tok-nt">&lt;timeDate&gt;</span>2011-03-11T12:13:14<span class="tok-nt">&lt;/timeDate&gt;</span>
  <span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
<span class="tok-nt">&lt;/startEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnMessageStartEvent">消息启动事件</h5>
<div class="sect5">
<h6 id="messageStartEventDescription">描述</h6>
<div class="paragraph">
<p><a href="#bpmnMessageEventDefinition">消息</a>启动事件（message start event）使用具名消息启动流程实例。消息名用于<em>选择</em>正确的启动事件。</p>
</div>
<div class="paragraph">
<p>当<strong>部署</strong>具有一个或多个消息启动事件的流程定义时，会做如下判断：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>给定流程定义中，消息启动事件的名字必须是唯一的。一个流程定义不得包含多个同名的消息启动事件。如果流程定义中有两个或多个消息启动事件引用同一个消息，或者两个或多个消息启动事件引用了具有相同消息名字的消息，则Flowable会在部署这个流程定义时抛出异常。</p>
</li>
<li>
<p>在所有已部署的流程定义中，消息启动事件的名字必须是唯一的。如果在流程定义中，一个或多个消息启动事件引用了已经部署的另一流程定义中消息启动事件的消息名，则Flowable会在部署这个流程定义时抛出异常。</p>
</li>
<li>
<p>流程版本：在部署流程定义的新版本时，会取消上一版本的消息订阅，即使新版本中并没有这个消息事件）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在<strong>启动</strong>流程实例时，可以使用下列<code>RuntimeService</code>中的方法，触发消息启动事件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">ProcessInstance</span> <span class="tok-nf">startProcessInstanceByMessage</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">messageName</span><span class="tok-o">);</span>
<span class="tok-n">ProcessInstance</span> <span class="tok-nf">startProcessInstanceByMessage</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">messageName</span><span class="tok-o">,</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">processVariables</span><span class="tok-o">);</span>
<span class="tok-n">ProcessInstance</span> <span class="tok-nf">startProcessInstanceByMessage</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">messageName</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">businessKey</span><span class="tok-o">,</span>
    <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&lt;</span> <span class="tok-n">processVariables</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>messageName</code>是由<code>message</code>元素的<code>name</code>属性给定的名字。<code>messageEventDefinition</code>的<code>messageRef</code>属性会引用<code>message</code>元素。当<strong>启动</strong>流程实例时，会做如下判断：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>只有顶层流程（top-level process）才支持消息启动事件。嵌入式子流程不支持消息启动事件。</p>
</li>
<li>
<p>如果一个流程定义中有多个消息启动事件，可以使用<code>runtimeService.startProcessInstanceByMessage(&#8230;&#8203;)</code>选择合适的启动事件。</p>
</li>
<li>
<p>如果一个流程定义中有多个消息启动事件与一个空启动事件，则<code>runtimeService.startProcessInstanceByKey(&#8230;&#8203;)</code>与<code>runtimeService.startProcessInstanceById(&#8230;&#8203;)</code>会使用空启动事件启动流程实例。</p>
</li>
<li>
<p>如果一个流程定义中有多个消息启动事件而没有空启动事件，则<code>runtimeService.startProcessInstanceByKey(&#8230;&#8203;)</code>与<code>runtimeService.startProcessInstanceById(&#8230;&#8203;)</code>会抛出异常。</p>
</li>
<li>
<p>如果一个流程定义中只有一个消息启动事件，则<code>runtimeService.startProcessInstanceByKey(&#8230;&#8203;)</code>与<code>runtimeService.startProcessInstanceById(&#8230;&#8203;)</code>会使用这个消息启动事件启动新流程实例。</p>
</li>
<li>
<p>如果流程由调用活动（call activity）启动，则只有在下列情况下才支持消息启动事件</p>
<div class="ulist">
<ul>
<li>
<p>除了消息启动事件之外，流程还有唯一的空启动事件</p>
</li>
<li>
<p>或者流程只有唯一的消息启动事件，而没有其他启动事件。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="messageStartEventGraphicalNotation">图示</h6>
<div class="paragraph">
<p>消息启动事件用其中有一个消息事件标志的圆圈表示。这个标志并未填充，用以表示捕获（接收）行为。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.start.message.event.png" alt="bpmn.start.message.event">
</div>
</div>
</div>
<div class="sect5">
<h6 id="messageStartEventXml">XML表示</h6>
<div class="paragraph">
<p>消息启动事件的XML表示格式，为普通启动事件声明加上messageEventDefinition子元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span> <span class="tok-na">id=</span><span class="tok-s">&quot;definitions&quot;</span>
  <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot;</span>
  <span class="tok-na">xmlns:flowable=</span><span class="tok-s">&quot;http://flowable.org/bpmn&quot;</span>
  <span class="tok-na">targetNamespace=</span><span class="tok-s">&quot;Examples&quot;</span>
  <span class="tok-na">xmlns:tns=</span><span class="tok-s">&quot;Examples&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;message</span> <span class="tok-na">id=</span><span class="tok-s">&quot;newInvoice&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;newInvoiceMessage&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;invoiceProcess&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;messageStart&quot;</span> <span class="tok-nt">&gt;</span>
    	<span class="tok-nt">&lt;messageEventDefinition</span> <span class="tok-na">messageRef=</span><span class="tok-s">&quot;tns:newInvoice&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/startEvent&gt;</span>
    ...
  <span class="tok-nt">&lt;/process&gt;</span>

<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnSignalStartEvent">信号启动事件</h5>
<div class="sect5">
<h6 id="bpmnSignalStartEventDescription">描述</h6>
<div class="paragraph">
<p><a href="#bpmnSignalEventDefinition">信号</a>启动事件（signal start event），使用具名信号启动流程实例。这个信号可以由流程实例中的信号抛出中间事件（intermediary signal throw event），或者API（<em>runtimeService.signalEventReceivedXXX</em>方法）触发。两种方式都会启动所有拥有相同名字信号启动事件的流程定义。</p>
</div>
<div class="paragraph">
<p>请注意可以选择异步还是同步启动流程实例。</p>
</div>
<div class="paragraph">
<p>需要为API传递的<code>signalName</code>，是由<code>signal</code>元素的<code>name</code>属性决定的名字。<code>signal</code>元素由<code>signalEventDefinition</code>的<code>signalRef</code>属性引用。</p>
</div>
</div>
<div class="sect5">
<h6 id="signalStartEventGraphicalNotation">图示</h6>
<div class="paragraph">
<p>信号启动事件用其中有一个信号事件标志的圆圈表示。这个标志并未填充，用以表示捕获（接收）行为。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.start.signal.event.png" alt="bpmn.start.signal.event">
</div>
</div>
</div>
<div class="sect5">
<h6 id="signalStartEventXml">XML表示</h6>
<div class="paragraph">
<p>信号启动事件的XML表示格式，为普通启动事件声明，加上signalEventDefinition子元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-nt">&lt;signal</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theSignal&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;The Signal&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processWithSignalStart1&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;signalEventDefinition</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theSignalEventDefinition&quot;</span> <span class="tok-na">signalRef=</span><span class="tok-s">&quot;theSignal&quot;</span>  <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/startEvent&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Task in process A&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnErrorStartEvent">错误启动事件</h5>
<div class="sect5">
<h6 id="errorStartEventDescription">描述</h6>
<div class="paragraph">
<p><a href="#bpmnErrorEventDefinition">错误</a>启动事件（error start event），可用于触发事件子流程（Event Sub-Process）。<strong>错误启动事件不能用于启动流程实例</strong>。</p>
</div>
<div class="paragraph">
<p>错误启动事件总是中断。</p>
</div>
</div>
<div class="sect5">
<h6 id="errorStartEventGraphicalNotation">图示</h6>
<div class="paragraph">
<p>错误启动事件用其中有一个错误事件标志的圆圈表示。这个标志并未填充，用以表示捕获（接收）行为。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.start.error.event.png" alt="bpmn.start.error.event">
</div>
</div>
</div>
<div class="sect5">
<h6 id="errorStartEventXml">XML表示</h6>
<div class="paragraph">
<p>错误启动事件的XML表示格式，为普通启动事件声明加上errorEventDefinition子元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;messageStart&quot;</span> <span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;errorEventDefinition</span> <span class="tok-na">errorRef=</span><span class="tok-s">&quot;someError&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/startEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnEndEvent">结束事件</h5>
<div class="paragraph">
<p>结束事件（end event）标志着流程或子流程中一个分支的结束。结束事件<strong>总是抛出（型）事件</strong>。这意味着当流程执行到达结束事件时，会抛出一个<em>结果</em>。结果的类型由事件内部的黑色图标表示。在XML表示中，类型由子元素声明给出。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnNoneEndEvent">空结束事件</h5>
<div class="sect5">
<h6 id="noneEndEventDescription">描述</h6>
<div class="paragraph">
<p>“空”结束事件(none end event)，意味着当到达这个事件时，没有特别指定抛出的<em>结果</em>。因此，引擎除了结束当前执行分支之外，不会多做任何事情。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnNoneEndEventDescription">图示</h6>
<div class="paragraph">
<p>空结束事件，用其中没有图标（没有结果类型）的粗圆圈表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.none.end.event.png" alt="bpmn.none.end.event">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnNoneStartEventXml">XML表示</h6>
<div class="paragraph">
<p>空事件的XML表示格式为普通结束事件声明，没有任何子元素（其它种类的结束事件都有子元素，用于声明其类型）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;my end event&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnErrorEndEvent">错误结束事件</h5>
<div class="sect5">
<h6 id="bpmnErrorEndEventDescription">描述</h6>
<div class="paragraph">
<p>当流程执行到达<strong>错误结束事件（error end event）</strong>时，结束执行的当前分支，并抛出错误。这个错误可以<a href="#bpmnBoundaryErrorEvent">由匹配的错误边界中间事件捕获</a>。如果找不到匹配的错误边界事件，将会抛出异常。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnErrorEndEventGraphicalNotation">图示</h6>
<div class="paragraph">
<p>错误结束事件事件用内部有一个错误图标的标准结束事件（粗圆圈）表示。错误图标是全黑的，代表抛出的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.error.end.event.png" alt="bpmn.error.end.event">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnErrorEndEventXml">XML表示</h6>
<div class="paragraph">
<p>错误结束事件表示为结束事件，加上<em>errorEventDefinition</em>子元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myErrorEndEvent&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;errorEventDefinition</span> <span class="tok-na">errorRef=</span><span class="tok-s">&quot;myError&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/endEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>errorRef</em>属性可以引用在流程外定义的<em>error</em>元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;error</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myError&quot;</span> <span class="tok-na">errorCode=</span><span class="tok-s">&quot;123&quot;</span> <span class="tok-nt">/&gt;</span>
...
<span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myProcess&quot;</span><span class="tok-nt">&gt;</span>
...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>error</em>的<strong>errorCode</strong>用于查找匹配的错误捕获边界事件。如果<em>errorRef</em>不匹配任何已定义的<em>error</em>，则该<em>errorRef</em>会用做<em>errorCode</em>的快捷方式。这个快捷方式是Flowable特有的。下面的代码片段在功能上是相同的。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-nt">&lt;error</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myError&quot;</span> <span class="tok-na">errorCode=</span><span class="tok-s">&quot;error123&quot;</span> <span class="tok-nt">/&gt;</span>
...
<span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myProcess&quot;</span><span class="tok-nt">&gt;</span>
...
  <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myErrorEndEvent&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;errorEventDefinition</span> <span class="tok-na">errorRef=</span><span class="tok-s">&quot;myError&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/endEvent&gt;</span>
...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>与下面的代码功能相同</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myErrorEndEvent&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;errorEventDefinition</span> <span class="tok-na">errorRef=</span><span class="tok-s">&quot;error123&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/endEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意<em>errorRef</em>必须遵从BPMN 2.0概要（schema），且必须是合法的QName。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnTerminateEndEvent">终止结束事件</h5>
<div class="sect5">
<h6 id="_描述">描述</h6>
<div class="paragraph">
<p>当到达<em>终止结束事件（terminate end event）</em>时，当前的流程实例或子流程会被终止。也就是说，当执行到达终止结束事件时，会判断第一个<em>范围 scope</em>（流程或子流程）并终止它。请注意在BPMN 2.0中，子流程可以是嵌入式子流程，调用活动，事件子流程，或事务子流程。有一条通用规则：当存在多实例的调用过程或嵌入式子流程时，只会终止一个实例，其他的实例与流程实例不会受影响。</p>
</div>
<div class="paragraph">
<p>可以添加一个可选属性<em>terminateAll</em>。当其为<em>true</em>时，无论该终止结束事件在流程定义中的位置，也无论它是否在子流程（甚至是嵌套子流程）中，都会终止（根）流程实例。</p>
</div>
</div>
<div class="sect5">
<h6 id="_图示">图示</h6>
<div class="paragraph">
<p>终止结束事件用内部有一个全黑圆的标准结束事件（粗圆圈）表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.terminate.end.event.png" alt="bpmn.terminate.end.event">
</div>
</div>
</div>
<div class="sect5">
<h6 id="_xml表示">XML表示</h6>
<div class="paragraph">
<p>终止结束事件，表示为结束事件，加上<em>terminateEventDefinition</em>子元素。</p>
</div>
<div class="paragraph">
<p>请注意<em>terminateAll</em>属性是可选的（默认为<em>false</em>）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myEndEvent &gt;</span>
<span class="tok-s">  &lt;terminateEventDefinition flowable:terminateAll=&quot;</span><span class="tok-err">true&quot;</span><span class="tok-nt">&gt;&lt;/terminateEventDefinition&gt;</span>
<span class="tok-nt">&lt;/endEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCancelEndEvent">取消结束事件</h5>
<div class="sect5">
<h6 id="bpmnCancelEndEventDescription">描述</h6>
<div class="paragraph">
<p>取消结束事件（cancel end event）只能与BPMN事务子流程（BPMN transaction subprocess）一起使用。当到达取消结束事件时，会抛出取消事件，且必须由取消边界事件（cancel boundary event）捕获。取消边界事件将取消事务，并触发补偿（compensation）。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnCancelEndEventGraphicalNotation">图示</h6>
<div class="paragraph">
<p>取消结束事件用内部有一个取消图标的标准结束事件（粗圆圈）表示。取消图标是全黑的，代表抛出的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.cancel.end.event.png" alt="bpmn.cancel.end.event">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnCancelEndEventXml">XML表示</h6>
<div class="paragraph">
<p>取消结束事件，表示为结束事件，加上<em>cancelEventDefinition</em>子元素。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myCancelEndEvent&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;cancelEventDefinition</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/endEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryEvent">边界事件</h5>
<div class="paragraph">
<p>边界事件（boundary event）是<em>捕获型</em>事件，依附在活动（activity）上。边界事件永远不会抛出。这意味着当活动运行时，事件将<em>监听</em>特定类型的触发器。当<em>捕获</em>到事件时，会终止活动，并沿该事件的出口顺序流继续。</p>
</div>
<div class="paragraph">
<p>所有的边界事件都用相同的方式定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;boundaryEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myBoundaryEvent&quot;</span> <span class="tok-na">attachedToRef=</span><span class="tok-s">&quot;theActivity&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;XXXEventDefinition/&gt;</span>
<span class="tok-nt">&lt;/boundaryEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>边界事件由下列元素定义：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>（流程范围内）唯一的标识符</p>
</li>
<li>
<p>由<strong>attachedToRef</strong>属性定义的，对该事件所依附的活动的引用。请注意边界事件及其所依附的活动，应定义在相同级别（也就是说，边界事件并不包含在活动内）。</p>
</li>
<li>
<p>定义了边界事件的类型的，形如<em>XXXEventDefinition</em>的XML子元素（例如<em>TimerEventDefinition</em>，<em>ErrorEventDefinition</em>，等等）。查阅特定的边界事件类型，以了解更多细节。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="bpmnTimerBoundaryEvent">定时器边界事件</h5>
<div class="sect5">
<h6 id="timerBoundaryEventDescription">描述</h6>
<div class="paragraph">
<p>定时器边界事件（timer boundary event）的行为像是跑表与闹钟。当执行到达边界事件所依附的活动时，将启动定时器。当定时器触发时（例如在特定时间间隔后），可以中断活动，并沿着边界事件的出口顺序流继续执行。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnTimerBoundaryEventGraphicalNotation">图示</h6>
<div class="paragraph">
<p>定时器边界事件用内部有一个定时器图标的标准边界事件（圆圈）表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.timer.event.png" alt="bpmn.boundary.timer.event">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnTimerBoundaryEventXml">XML表示</h6>
<div class="paragraph">
<p>定时器边界事件与<a href="#bpmnBoundaryEvent">一般边界事件</a>一样定义。其中类型子元素为<strong>timerEventDefinition</strong>元素。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;boundaryEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;escalationTimer&quot;</span> <span class="tok-na">cancelActivity=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">attachedToRef=</span><span class="tok-s">&quot;firstLineSupport&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;timerEventDefinition&gt;</span>
    <span class="tok-nt">&lt;timeDuration&gt;</span>PT4H<span class="tok-nt">&lt;/timeDuration&gt;</span>
  <span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
<span class="tok-nt">&lt;/boundaryEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请参考<a href="#timerEventDefinitions">定时器事件定义</a>了解定时器配置的细节。</p>
</div>
<div class="paragraph">
<p>在图示中圆圈画为虚线，如下：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.non.interrupting.boundary.timer.event.png" alt="bpmn.non.interrupting.boundary.timer.event">
</div>
</div>
<div class="paragraph">
<p>中断与非中断定时器事件是不同的。非中断意味着最初的活动<strong>不会</strong>被中断，而会保持原样。默认为中断行为。在XML表示中，<em>cancelActivity</em>属性设置为false。</p>
</div>
<div class="paragraph">
<p>一个典型使用场景，是在一段时间之后发送提醒邮件，但不影响正常的流程流向。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;boundaryEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;escalationTimer&quot;</span> <span class="tok-na">cancelActivity=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-na">attachedToRef=</span><span class="tok-s">&quot;firstLineSupport&quot;</span><span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>定时器边界事件只有在异步执行器（async executor）启用时才能触发（也就是说，需要在<code>flowable.cfg.xml</code>中，将<em>asyncExecutorActivate</em>设置为<code>true</code>。因为异步执行器默认情况下是禁用的。）</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnKnownIssueBoundaryEvent">边界事件的已知问题</h6>
<div class="paragraph">
<p>所有类型的边界事件，都有一个关于并发的已知问题：不能在边界事件上附加多个出口顺序流。这个问题的解决方案，是使用一条出口顺序流，指向并行网关。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.known.issue.boundary.event.png" alt="bpmn.known.issue.boundary.event">
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryErrorEvent">错误边界事件</h5>
<div class="sect5">
<h6 id="bpmnBoundaryErrorEventDescription">描述</h6>
<div class="paragraph">
<p>在活动边界上的错误<em>捕获</em>中间（事件），或简称<strong>错误边界事件（error boundary event）</strong>，捕获其所依附的活动范围内抛出的错误。</p>
</div>
<div class="paragraph">
<p>在<a href="#bpmnSubProcess">嵌入式子流程</a>或者<a href="#bpmnCallActivity">调用活动</a>上定义错误边界事件最有意义，因为子流程的范围会包括其中的所有活动。错误可以由<a href="#bpmnErrorEndEvent">错误结束事件</a>抛出。这样的错误会逐层向其上级父范围传播，直到在范围内找到一个匹配错误事件定义的错误边界事件。</p>
</div>
<div class="paragraph">
<p>当捕获错误事件时，会销毁边界事件定义所在的活动，同时销毁其中所有的当前执行（例如，并行活动，嵌套子流程，等等）。流程执行将沿着边界事件的出口顺序流继续。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnBoundaryErrorEventgraphicalNotation">图示</h6>
<div class="paragraph">
<p>错误边界事件用内部有一个错误图标的标准中间事件（两层圆圈）表示。错误图标是白色的，代表<em>捕获</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.error.event.png" alt="bpmn.boundary.error.event">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnBoundaryErrorEventXml">XML表示</h6>
<div class="paragraph">
<p>错误边界事件与标准<a href="#bpmnBoundaryEvent">边界事件</a>一样定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;boundaryEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;catchError&quot;</span> <span class="tok-na">attachedToRef=</span><span class="tok-s">&quot;mySubProcess&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;errorEventDefinition</span> <span class="tok-na">errorRef=</span><span class="tok-s">&quot;myError&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/boundaryEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在<a href="#bpmnBoundaryEvent">边界事件</a>中，<em>errorRef</em>引用一个流程元素外定义的错误：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;error</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myError&quot;</span> <span class="tok-na">errorCode=</span><span class="tok-s">&quot;123&quot;</span> <span class="tok-nt">/&gt;</span>
...
<span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myProcess&quot;</span><span class="tok-nt">&gt;</span>
...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>errorCode</strong>用于匹配捕获的错误：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果省略了<em>errorRef</em>，错误边界事件会捕获<strong>所有错误事件</strong>，无论<em>error</em>的errorCode是什么。</p>
</li>
<li>
<p>如果提供了<em>errorRef</em>，并且其引用了存在的<em>error</em>，则边界事件<strong>只会捕获相同错误代码的错误</strong>。</p>
</li>
<li>
<p>如果提供了<em>errorRef</em>，但BPMN 2.0文件中没有定义<em>error</em>，则<strong>errorRef会用作errorCode</strong>（与错误结束事件类似）。</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="bpmnBoundaryErrorEventExample">示例</h6>
<div class="paragraph">
<p>下面的示例流程展示了如何使用错误结束事件。当<em>'Review profitability (审核盈利能力)'</em>用户任务完成，并指出提供的信息不足时，会抛出错误。当这个错误被子流程边界捕获时，<em>'Review sales lead (审核销售线索)'</em>子流程中的所有运行中活动都会被销毁（即使<em>'Review customer rating 审核客户等级'</em>还没有完成），并会创建<em>'Provide additional details (提供更多信息)'</em>用户任务。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.error.example.png" alt="bpmn.boundary.error.example">
</div>
</div>
<div class="paragraph">
<p>这个流程作为演示配置的示例提供。可以在<em>org.flowable.examples.bpmn.event.error</em>包中找到流程XML与单元测试。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundarySignalEvent">信号边界事件</h5>
<div class="sect5">
<h6 id="bpmnBoundarySignalEventDescription">描述</h6>
<div class="paragraph">
<p>依附在活动边界上的<a href="#bpmnSignalEventDefinition">信号</a>捕获中间（事件），或简称<strong>信号边界事件（signal boundary event）</strong>，捕获与其信号定义具有相同名称的信号。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>与其他事件例如错误边界事件不同的是，信号边界事件不只是捕获其所依附范围抛出的信号。信号边界事件为全局范围（广播）的，意味着信号可以从任何地方抛出，甚至可以是不同的流程实例。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>与其他事件（如错误事件）不同，信号在被捕获后不会被消耗。如果有两个激活的信号边界事件，捕获相同的信号事件，则两个边界事件都会被触发，哪怕它们不在同一个流程实例里。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnBoundarySignalEventGraphicalNotation">图示</h6>
<div class="paragraph">
<p>信号边界事件，用内部有一个信号图标的标准中间事件（两层圆圈）表示。信号图标是白色的，代表<em>捕获</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.signal.event.png" alt="bpmn.boundary.signal.event">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnBoundarySignalEventXml">XML表示</h6>
<div class="paragraph">
<p>信号边界事件与标准<a href="#bpmnBoundaryEvent">边界事件</a>一样定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;boundaryEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;boundary&quot;</span> <span class="tok-na">attachedToRef=</span><span class="tok-s">&quot;task&quot;</span> <span class="tok-na">cancelActivity=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;signalEventDefinition</span> <span class="tok-na">signalRef=</span><span class="tok-s">&quot;alertSignal&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/boundaryEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnBoundarySignalEventExample">示例</h6>
<div class="paragraph">
<p>参见<a href="#bpmnSignalEventDefinition">信号事件定义</a>章节。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryMessageEvent">消息边界事件</h5>
<div class="sect5">
<h6 id="bpmnBoundaryMessageEventDescription">描述</h6>
<div class="paragraph">
<p>在活动边界上的<a href="#bpmnMessageEventDefinition">消息</a><em>捕获</em>中间（事件），或简称<strong>消息边界事件（message boundary event）</strong>，捕获与其消息定义具有相同消息名的消息。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnBoundaryMessageEventGraphicalNotation">图示</h6>
<div class="paragraph">
<p>消息边界事件，用内部有一个消息图标的标准中间事件（两层圆圈）表示。信号图标是白色的，代表<em>捕获</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.message.event.png" alt="bpmn.boundary.message.event">
</div>
</div>
<div class="paragraph">
<p>请注意消息边界事件既可以是中断型的（右图），也可以是非中断型的（左图）。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnBoundaryMessageEventXml">XML表示</h6>
<div class="paragraph">
<p>消息边界事件与标准<a href="#bpmnBoundaryEvent">边界事件</a>一样定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;boundaryEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;boundary&quot;</span> <span class="tok-na">attachedToRef=</span><span class="tok-s">&quot;task&quot;</span> <span class="tok-na">cancelActivity=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;messageEventDefinition</span> <span class="tok-na">messageRef=</span><span class="tok-s">&quot;newCustomerMessage&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/boundaryEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnBoundaryMessageEventExample">示例</h6>
<div class="paragraph">
<p>参见<a href="#bpmnMessageEventDefinition">消息事件定义</a>章节。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryCancelEvent">取消边界事件</h5>
<div class="sect5">
<h6 id="bpmnBoundaryCancelEventDescription">描述</h6>
<div class="paragraph">
<p>依附在事务子流程边界上的取消<em>捕获</em>中间事件，或简称<strong>取消边界事件（cancel boundary event）</strong>，在事务取消时触发。当取消边界事件触发时，首先会中断当前范围的所有活动执行。接下来，启动事务范围内所有有效的的补偿边界事件（compensation boundary event）。补偿会同步执行，也就是说在离开事务前，边界事件会等待补偿完成。当补偿完成时，沿取消边界事件的任何出口顺序流离开事务子流程。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>一个事务子流程只允许使用一个取消边界事件。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>如果事务子流程中有嵌套的子流程，只会对成功完成的子流程触发补偿。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>如果取消边界事件放置在具有多实例特性的事务子流程上，如果一个实例触发了取消，则边界事件将取消所有实例。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnBoundaryCancelEventGraphicalNotation">图示</h6>
<div class="paragraph">
<p>取消边界事件，用内部有一个取消图标的标准中间事件（两层圆圈）表示。取消图标是白色的（未填充），代表<em>捕获</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.cancel.event.png" alt="bpmn.boundary.cancel.event">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnBoundaryCancelEventXml">XML表示</h6>
<div class="paragraph">
<p>取消边界事件与标准<a href="#bpmnBoundaryEvent">边界事件</a>一样定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;boundaryEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;boundary&quot;</span> <span class="tok-na">attachedToRef=</span><span class="tok-s">&quot;transaction&quot;</span> <span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;cancelEventDefinition</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/boundaryEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>因为取消边界事件总是中断型的，因此没有<code>cancelActivity</code>属性。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryCompensationEvent">补偿边界事件</h5>
<div class="sect5">
<h6 id="bpmnBoundaryCompensationEventDescription">描述</h6>
<div class="paragraph">
<p>依附在活动边界上的补偿<em>捕获</em>中间（事件），或简称<strong>补偿边界事件（compensation boundary event）</strong>，可以为活动附加补偿处理器。</p>
</div>
<div class="paragraph">
<p>补偿边界事件必须使用直接关联的方式引用单个的补偿处理器。</p>
</div>
<div class="paragraph">
<p>补偿边界事件与其它边界事件的活动策略不同。其它边界事件，例如信号边界事件，在其依附的活动启动时激活；当该活动结束时会被解除，并取消相应的事件订阅。而补偿边界事件不是这样。补偿边界事件在其依附的活动<strong>成功完成</strong>时激活，同时创建补偿事件的相应订阅。当补偿事件被触发，或者相应的流程实例结束时，才会移除订阅。请考虑下列因素：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>当补偿被触发时，会调用补偿边界事件关联的补偿处理器。调用次数与其依附的活动成功完成的次数相同。</p>
</li>
<li>
<p>如果补偿边界事件依附在具有多实例特性的活动上，则会为每一个实例创建补偿事件订阅。</p>
</li>
<li>
<p>如果补偿边界事件依附在位于循环内部的活动上，则每次该活动执行时，都会创建一个补偿事件订阅。</p>
</li>
<li>
<p>如果流程实例结束，则取消补偿事件的订阅。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>嵌入式子流程不支持补偿边界事件。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnBoundaryCompensationEventGraphicalNotation">图示</h6>
<div class="paragraph">
<p>补偿边界事件，用内部有一个补偿图标的标准中间事件（两层圆圈）表示。补偿图标是白色的（未填充），代表<em>捕获</em>的含义。另外，补偿边界事件使用单向连接关联补偿处理器，如下图所示：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.compensation.event.png" alt="bpmn.boundary.compensation.event">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnBoundaryCompensationEventXml">XML表示</h6>
<div class="paragraph">
<p>补偿边界事件与标准<a href="#bpmnBoundaryEvent">边界事件</a>一样定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-nt">&lt;boundaryEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;compensateBookHotelEvt&quot;</span> <span class="tok-na">attachedToRef=</span><span class="tok-s">&quot;bookHotel&quot;</span> <span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;compensateEventDefinition</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/boundaryEvent&gt;</span>

<span class="tok-nt">&lt;association</span> <span class="tok-na">associationDirection=</span><span class="tok-s">&quot;One&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;a1&quot;</span>
    <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;compensateBookHotelEvt&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;undoBookHotel&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;undoBookHotel&quot;</span> <span class="tok-na">isForCompensation=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;...&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>补偿边界事件在活动完成后才激活，因此不支持<code>cancelActivity</code>属性。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateCatchingEvent">捕获中间事件</h5>
<div class="paragraph">
<p>所有的捕获中间事件（intermediate catching events）都使用相同方式定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;intermediateCatchEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myIntermediateCatchEvent&quot;</span> <span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;XXXEventDefinition/&gt;</span>
<span class="tok-nt">&lt;/intermediateCatchEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>捕获中间事件由下列元素定义:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>（流程范围内）唯一的标识符</p>
</li>
<li>
<p>定义了捕获中间事件类型的，形如<em>XXXEventDefinition</em>的XML子元素（例如<em>TimerEventDefinition</em>等）。查阅特定中间捕获事件类型，以了解更多细节。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="bpmnTimerIntermediateEvent">定时器捕获中间事件</h5>
<div class="sect5">
<h6 id="bpmnTimerIntermediateEventDescription">描述</h6>
<div class="paragraph">
<p>定时器捕获中间事件（timer intermediate catching event）的行为像是跑表。当执行到达捕获事件时，启动定时器；当定时器触发时（例如在一段时间间隔后），沿定时器中间事件的出口顺序流继续执行。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnTimerIntermediateEventGraphicalNotation">图示</h6>
<div class="paragraph">
<p>定时器中间事件用内部有定时器图标的中间捕获事件表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.intermediate.timer.event.png" alt="bpmn.intermediate.timer.event">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnTimerIntermediateEventXml">XML表示</h6>
<div class="paragraph">
<p>定时器中间事件与<a href="#bpmnIntermediateCatchingEvent">捕获中间事件</a>一样定义。子元素为<strong>timerEventDefinition</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;intermediateCatchEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;timer&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;timerEventDefinition&gt;</span>
    <span class="tok-nt">&lt;timeDuration&gt;</span>PT5M<span class="tok-nt">&lt;/timeDuration&gt;</span>
  <span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
<span class="tok-nt">&lt;/intermediateCatchEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>查看<a href="#timerEventDefinitions">定时器事件定义</a>了解详细配置。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateSignalEvent">信号捕获中间事件</h5>
<div class="sect5">
<h6 id="bpmnIntermediateSignalEventDescription">描述</h6>
<div class="paragraph">
<p><a href="#bpmnSignalEventDefinition">信号</a><em>捕获</em>中间事件（signal intermediate catching event），捕获与其引用的信号定义具有相同信号名称的信号。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>与其他事件如错误事件不同，信号在被捕获后不会被消耗。如果有两个激活的信号中间事件，捕获相同的信号事件，则两个中间事件都会被触发，哪怕它们不在同一个流程实例里。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnIntermediateSignalEventGraphicalNotation">图示</h6>
<div class="paragraph">
<p>信号捕获中间事件用内部有信号图标的标准中间事件（两层圆圈）表示。信号图标是白色的（未填充），代表<em>捕获</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.intermediate.signal.catch.event.png" alt="bpmn.intermediate.signal.catch.event">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnIntermediateSignalEventXml">XML表示</h6>
<div class="paragraph">
<p>信号中间事件与<a href="#bpmnIntermediateCatchingEvent">捕获中间事件</a>一样定义。子元素为<strong>signalEventDefinition</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;intermediateCatchEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;signal&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;signalEventDefinition</span> <span class="tok-na">signalRef=</span><span class="tok-s">&quot;newCustomerSignal&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/intermediateCatchEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnIntermediateSignalEventExample">示例</h6>
<div class="paragraph">
<p>参阅<a href="#bpmnSignalEventDefinition">信号事件定义</a>章节。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateMessageEvent">消息捕获中间事件</h5>
<div class="sect5">
<h6 id="bpmnIntermediateMessageEventDescription">描述</h6>
<div class="paragraph">
<p><a href="#bpmnMessageEventDefinition">消息</a><em>捕获</em>中间事件（message intermediate catching event），捕获特定名字的消息。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnIntermediateMessageEventGraphicalNotation">图示</h6>
<div class="paragraph">
<p>消息捕获中间事件用内部有消息图标的标准中间事件（两层圆圈）表示。消息图标是白色的（未填充），代表<em>捕获</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.intermediate.message.catch.event.png" alt="bpmn.intermediate.message.catch.event">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnIntermediateMessageEventXml">XML表示</h6>
<div class="paragraph">
<p>消息中间事件与<a href="#bpmnIntermediateCatchingEvent">捕获中间事件</a>一样定义。子元素为<strong>messageEventDefinition</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;intermediateCatchEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;message&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;messageEventDefinition</span> <span class="tok-na">signalRef=</span><span class="tok-s">&quot;newCustomerMessage&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/intermediateCatchEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnIntermediateMessageEventExample">示例</h6>
<div class="paragraph">
<p>参阅<a href="#bpmnMessageEventDefinition">消息事件定义</a>章节。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateThrowEvent">抛出中间事件</h5>
<div class="paragraph">
<p>所有的抛出中间事件（intermediate throwing evnet）都使用相同方式定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;intermediateThrowEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myIntermediateThrowEvent&quot;</span> <span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;XXXEventDefinition/&gt;</span>
<span class="tok-nt">&lt;/intermediateThrowEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>抛出中间事件由下列元素定义:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>（流程范围内）唯一的标识符</p>
</li>
<li>
<p>定义了抛出中间事件类型的，形如<em>XXXEventDefinition</em>的XML子元素（例如<em>signalEventDefinition</em>等）。查阅特定中间抛出事件类型，以了解更多细节。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateThrowNoneEvent">空抛出中间事件</h5>
<div class="paragraph">
<p>下面的流程图展示了空抛出中间事件（intermediate throwing none event）的简单例子。其用于指示流程已经到达了某种状态。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.intermediate.none.event.png" alt="bpmn.intermediate.none.event">
</div>
</div>
<div class="paragraph">
<p>添加一个<a href="#executionListeners">执行监听器</a>后，空中间事件就可以成为很好的监视某些KPI（Key Performance Indicators 关键绩效指标）的钩子。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;intermediateThrowEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;noneEvent&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:executionListener</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.test.bpmn.event.IntermediateNoneEventTest$MyExecutionListener&quot;</span> <span class="tok-na">event=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/intermediateThrowEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>你也可以添加一些自己的代码，将部分事件发送给你的BAM（Business Activity Monitoring 业务活动监控）工具，或者DWH（Data Warehouse 数据仓库）。在这种情况下，引擎本身不会做任何事情，只是从中穿过。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateThrowSignalEvent">信号抛出中间事件</h5>
<div class="sect5">
<h6 id="bpmnIntermediateThrowSignalEventDescription">描述</h6>
<div class="paragraph">
<p><a href="#bpmnSignalEventDefinition">信号</a><em>抛出</em>中间事件（signal intermediate throwing event），抛出所定义信号的信号事件。</p>
</div>
<div class="paragraph">
<p>在Flowable中，信号会广播至所有的激活的处理器（也就是说，所有的信号捕获事件）。可以同步或异步地发布信号。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在默认配置中，信号<strong>同步</strong>地传递。这意味着抛出信号的流程实例会等待，直到信号传递至所有的捕获信号的流程实例。所有的捕获流程实例也会在与抛出流程实例相同的事务中，也就是说如果收到通知的流程实例中，有一个实例产生了技术错误（抛出异常），则所有相关的实例都会失败。</p>
</li>
<li>
<p>信号也可以<strong>异步</strong>地传递。这是由到达抛出信号事件时的发送处理器来决定的。对于每个激活的处理器，JobExecutor会为其存储并传递一个异步通知消息(asynchronous notification message),即作业（Job）。</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="bpmnIntermediateThrowSignalEventGraphicalNotation">图示</h6>
<div class="paragraph">
<p>消息抛出中间事件用内部有信号图标的标准中间事件（两层圆圈）表示。信号图标是黑色的（已填充），代表<em>抛出</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.intermediate.signal.throw.event.png" alt="bpmn.intermediate.signal.throw.event">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnIntermediateThrowSignalEventXml">XML表示</h6>
<div class="paragraph">
<p>信号中间事件与<a href="#bpmnIntermediateThrowEvent">抛出中间事件</a>一样定义。子元素为<strong>signalEventDefinition</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;intermediateThrowEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;signal&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;signalEventDefinition</span> <span class="tok-na">signalRef=</span><span class="tok-s">&quot;newCustomerSignal&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/intermediateThrowEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>异步信号事件这样定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;intermediateThrowEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;signal&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;signalEventDefinition</span> <span class="tok-na">signalRef=</span><span class="tok-s">&quot;newCustomerSignal&quot;</span> <span class="tok-na">flowable:async=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/intermediateThrowEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnIntermediateThrowSignalEventExample">示例</h6>
<div class="paragraph">
<p>参阅<a href="#bpmnSignalEventDefinition">信号事件定义</a>章节。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateThrowCompensationEvent">补偿抛出中间事件</h5>
<div class="sect5">
<h6 id="bpmnIntermediateThrowCompensationEventDescription">描述</h6>
<div class="paragraph">
<p>补偿<em>抛出</em>中间事件（compensation intermediate throwing event）用于触发补偿。</p>
</div>
<div class="paragraph">
<p><strong>触发补偿：</strong>既可以为设计的活动触发补偿，也可以为补偿事件所在的范围触发补偿。补偿由活动所关联的补偿处理器执行。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>活动抛出补偿时，活动关联的补偿处理器将执行的次数，为活动成功完成的次数。</p>
</li>
<li>
<p>抛出补偿时，当前范围中所有的活动，包括并行分支上的活动都会被补偿。</p>
</li>
<li>
<p>补偿分层触发：如果将要被补偿的活动是一个子流程，则该子流程中所有的活动都会触发补偿。如果该子流程有嵌套的活动，则会递归地抛出补偿。然而，补偿不会传播至流程的<strong>上层</strong>：如果子流程中触发了补偿，该补偿不会传播至子流程范围外的活动。BPMN规范指出，对“与子流程在相同级别”的活动触发补偿。</p>
</li>
<li>
<p>在Flowable中，补偿按照执行的相反顺序运行。这意味着最后完成的活动会第一个补偿。</p>
</li>
<li>
<p>可以使用补偿抛出中间事件补偿已经成功完成的事务子流程。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>如果抛出补偿的范围中有一个子流程，而该子流程包含有关联了补偿处理器的活动，则当抛出补偿时，只有该子流程成功完成时，补偿才会传播至该子流程。如果子流程内嵌套的部分活动已经完成，并附加了补偿处理器，但包含这些活动的子流程还没有完成，则这些补偿处理器仍不会执行。参考下面的例子：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.throw.compensation.example1.png" alt="bpmn.throw.compensation.example1">
</div>
</div>
<div class="paragraph">
<p>在这个流程中，有两个并行的执行：一个执行嵌入子流程，另一个执行“charge credit card（信用卡付款）”活动。假定两个执行都已开始，且第一个执行正等待用户完成“review bookings（检查预定）”任务。第二个执行进行了“charge credit card（信用卡付款）”活动的操作，抛出了错误，导致“cancel reservations（取消预订）”事件触发补偿。这时并行子流程还未完成，意味着补偿不会传播至该子流程，因此不会执行“cancel hotel reservation（取消酒店预订）”补偿处理器。而如果“cancel reservations（取消预订）”运行前，这个用户任务（因此该嵌入式子流程也）已经完成，则补偿会传播至该嵌入式子流程。</p>
</div>
<div class="paragraph">
<p><strong>流程变量：</strong>当补偿嵌入式子流程时，用于执行补偿处理器的执行，可以访问子流程的局部流程变量在子流程完成时的值。为此，会对范围执行（为执行子流程所创建的执行）所关联的流程变量进行快照。意味着：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>补偿执行器无法访问子流程范围内并行执行所添加的变量。</p>
</li>
<li>
<p>上层执行所关联的流程变量（例如流程实例关联的流程变量）不在该快照中。因为补偿处理器可以直接访问这些流程变量在抛出补偿时的值。</p>
</li>
<li>
<p>只会为嵌入式子流程进行变量快照。其他活动不会进行变量快照。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>目前的限制：</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>目前不支持<code>waitForCompletion="false"</code>。当补偿抛出中间事件触发补偿时，只有在补偿成功完成时，才会离开该事件。</p>
</li>
<li>
<p>补偿由并行执行运行。并行执行会按照补偿活动完成的逆序启动。</p>
</li>
<li>
<p>补偿不会传播至调用活动（call activity）生成的子流程。</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="bpmnIntermediateThrowCompensationEventGraphicalNotation">图示</h6>
<div class="paragraph">
<p>补偿抛出中间事件用内部有补偿图标的标准中间事件（两层圆圈）表示。补偿图标是黑色的（已填充），代表<em>抛出</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.intermediate.compensation.throw.event.png" alt="bpmn.intermediate.compensation.throw.event">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnIntermediateThrowCompensationEventXml">XML表示</h6>
<div class="paragraph">
<p>补偿中间事件与<a href="#bpmnIntermediateThrowEvent">抛出中间事件</a>一样定义。子元素为<strong>compensateEventDefinition</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;intermediateThrowEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;throwCompensation&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;compensateEventDefinition</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/intermediateThrowEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>另外，<code>activityRef</code>可选项用于为指定的范围或活动触发补偿：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;intermediateThrowEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;throwCompensation&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;compensateEventDefinition</span> <span class="tok-na">activityRef=</span><span class="tok-s">&quot;bookHotel&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/intermediateThrowEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnSequenceFlow">2.1.3. 顺序流</h4>
<div class="sect4">
<h5 id="sequenceFlowDescription">描述</h5>
<div class="paragraph">
<p>顺序流（sequence flow）是流程中两个元素间的连接器。在流程执行过程中，一个元素被访问后，会沿着其所有出口顺序流继续执行。这意味着BPMN 2.0的默认是并行执行的：两个出口顺序流就会创建两个独立的、并行的执行路径。</p>
</div>
</div>
<div class="sect4">
<h5 id="sequenceFlowGraphicalNotation">图示</h5>
<div class="paragraph">
<p>顺序流，用从源元素指向目标元素的箭头表示。箭头总是指向目标元素。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.sequence.flow.png" alt="bpmn.sequence.flow">
</div>
</div>
</div>
<div class="sect4">
<h5 id="sequenceFlowXml">XML表示</h5>
<div class="paragraph">
<p>顺序流需要有流程唯一的<strong>id</strong>，并引用存在的<strong>源</strong>与<strong>目标</strong>元素。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnConditionalSequenceFlow">条件顺序流</h5>
<div class="sect5">
<h6 id="condSeqFlowDescription">描述</h6>
<div class="paragraph">
<p>在顺序流上可以定义条件（conditional sequence flow）。当离开BPMN 2.0活动时，默认行为是计算其每个出口顺序流上的条件。当条件计算为<em>true</em>时，选择该出口顺序流。如果该方法选择了多条顺序流，则会生成多个<em>执行</em>，流程会以并行方式继续。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>上面的介绍针对BPMN 2.0活动（与事件），但不适用于网关（gateway）。不同类型的网关，会用不同的方式处理带有条件的顺序流。</p>
</div>
</div>
<div class="sect5">
<h6 id="conditionalSequenceFlowGraphicalNotation">图示</h6>
<div class="paragraph">
<p>条件顺序流用起点带有小菱形的顺序流表示。在顺序流旁显示条件表达式。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.conditional.sequence.flow.png" alt="bpmn.conditional.sequence.flow">
</div>
</div>
</div>
<div class="sect5">
<h6 id="conditionalSequenceFlowXml">XML表示</h6>
<div class="paragraph">
<p>条件顺序流的XML表示格式为含有<strong>conditionExpression（条件表达式）</strong>子元素的普通顺序流。请注意目前只支持<em>tFormalExpressions</em>。可以省略<em>xsi:type=""</em>定义，默认为唯一支持的表达式类型。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theTask&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-cp">&lt;![CDATA[${order.price &gt; 100 &amp;&amp; order.price &lt; 250}]]&gt;</span>
  <span class="tok-nt">&lt;/conditionExpression&gt;</span>
<span class="tok-nt">&lt;/sequenceFlow&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>目前conditionalExpressions<strong>只能使用UEL</strong>。详细信息可以在<a href="#apiExpressions">表达式</a>章节找到。使用的表达式需要能解析为boolean值，否则当计算条件时会抛出异常。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>下面的例子，通过典型的JavaBean的方式，使用getter引用流程变量的数据。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-cp">&lt;![CDATA[${order.price &gt; 100 &amp;&amp; order.price &lt; 250}]]&gt;</span>
<span class="tok-nt">&lt;/conditionExpression&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>这个例子调用了一个解析为boolean值的方法。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-cp">&lt;![CDATA[${order.isStandardOrder()}]]&gt;</span>
<span class="tok-nt">&lt;/conditionExpression&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Flowable发行版中包含了下列示例流程，用于展示值表达式与方法表达式的使用（参见<em>org.flowable.examples.bpmn.expression</em>）。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.uel-expression.on.seq.flow.png" alt="bpmn.uel expression.on.seq.flow">
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnDefaultSequenceFlow">默认顺序流</h5>
<div class="sect5">
<h6 id="bpmnDefaultSequenceFlowDescription">描述</h6>
<div class="paragraph">
<p>所有的BPMN 2.0任务与网关都可以使用<strong>默认顺序流（default sequence flow）</strong>。只有当没有其他顺序流可以选择时，才会选择默认顺序流作为活动的出口顺序流。流程会忽略默认顺序流上的条件。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnDefaultSequenceFlowGraphicalNotation">图示</h6>
<div class="paragraph">
<p>默认顺序流用起点带有“斜线”标记的一般顺序流表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.default.sequence.flow.png" alt="bpmn.default.sequence.flow">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnDefaultSequenceFlowXmlRepresentation">XML表示</h6>
<div class="paragraph">
<p>活动的默认顺序流由该活动的<strong>default属性</strong>定义。下面的XML片段展示了一个排他网关（exclusive gateway），带有默认顺序流<em>flow 2</em>。只有当<em>conditionA</em>与<em>conditionB</em>都计算为false时，才会选择默认顺序流作为网关的出口顺序流。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-nt">&lt;exclusiveGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Exclusive Gateway&quot;</span> <span class="tok-na">default=</span><span class="tok-s">&quot;flow2&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;task1&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>${conditionA}<span class="tok-nt">&lt;/conditionExpression&gt;</span>
<span class="tok-nt">&lt;/sequenceFlow&gt;</span>

<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;task2&quot;</span><span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow3&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;task3&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>${conditionB}<span class="tok-nt">&lt;/conditionExpression&gt;</span>
<span class="tok-nt">&lt;/sequenceFlow&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>对应下面的图示：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.default.sequence.flow.example.png" alt="bpmn.default.sequence.flow.example">
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnGateways">2.1.4. 网关</h4>
<div class="paragraph">
<p>网关（gateway）用于控制执行的流向（或者按BPMN 2.0的用词：执行的<em>“标志（token）”</em>）。网关可以<em>消费（consuming）</em>与<em>生成（generating）</em>标志。</p>
</div>
<div class="paragraph">
<p>网关用其中带有图标的菱形表示。该图标显示了网关的类型。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.gateway.png" alt="bpmn.gateway">
</div>
</div>
<div class="sect4">
<h5 id="bpmnExclusiveGateway">排他网关</h5>
<div class="sect5">
<h6 id="exclusiveGatewayDescription">描述</h6>
<div class="paragraph">
<p>排他网关（exclusive gateway）（也叫<em>异或网关 XOR gateway</em>，或者更专业的，<em>基于数据的排他网关 exclusive data-based gateway</em>），用于对流程中的<strong>决策</strong>建模。当执行到达这个网关时，会按照所有出口顺序流定义的顺序对它们进行计算。选择第一个条件计算为true的顺序流（当没有设置条件时，认为顺序流为<em>true</em>）继续流程。</p>
</div>
<div class="paragraph">
<p><strong>请注意这里出口顺序流的含义与BPMN 2.0中的一般情况不一样。一般情况下，会选择所有条件计算为true的顺序流，并行执行。而使用排他网关时，只会选择一条顺序流。当多条顺序流的条件都计算为true时，会且仅会选择在XML中最先定义的顺序流继续流程。如果没有可选的顺序流，会抛出异常。</strong></p>
</div>
</div>
<div class="sect5">
<h6 id="exclusiveGatewayGraphNotation">图示</h6>
<div class="paragraph">
<p>排他网关用内部带有&#8217;X&#8217;图标的标准网关（菱形）表示，'X&#8217;图标代表<em>异或</em>的含义。请注意内部没有图标的网关默认为排他网关。BPMN 2.0规范不允许在同一个流程中混合使用有及没有X的菱形标志。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.exclusive.gateway.notation.png" alt="bpmn.exclusive.gateway.notation">
</div>
</div>
</div>
<div class="sect5">
<h6 id="exclusiveGatewayXML">XML表示</h6>
<div class="paragraph">
<p>排他网关的XML表示格式很简洁：一行定义网关的XML。条件表达式定义在其出口顺序流上。查看<a href="#bpmnConditionalSequenceFlow">条件顺序流</a>章节了解这种表达式的可用选项。</p>
</div>
<div class="paragraph">
<p>以下面的模型为例：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.exclusive.gateway.png" alt="bpmn.exclusive.gateway">
</div>
</div>
<div class="paragraph">
<p>其XML表示如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-nt">&lt;exclusiveGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Exclusive Gateway&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theTask1&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>${input == 1}<span class="tok-nt">&lt;/conditionExpression&gt;</span>
<span class="tok-nt">&lt;/sequenceFlow&gt;</span>

<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow3&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theTask2&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>${input == 2}<span class="tok-nt">&lt;/conditionExpression&gt;</span>
<span class="tok-nt">&lt;/sequenceFlow&gt;</span>

<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow4&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theTask3&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>${input == 3}<span class="tok-nt">&lt;/conditionExpression&gt;</span>
<span class="tok-nt">&lt;/sequenceFlow&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnParallelGateway">并行网关</h5>
<div class="sect5">
<h6 id="bpmnParallelGatewayDescription">描述</h6>
<div class="paragraph">
<p>网关也可以建模流程中的并行执行。在流程模型中引入并行的最简单的网关，就是<strong>并行网关（parallel gateway）</strong>。它可以将执行<em>分支（fork）</em>为多条路径，也可以<em>合并（join）</em>多条入口路径的执行。</p>
</div>
<div class="paragraph">
<p>并行网关的功能取决于其入口与出口顺序流：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>分支：</strong>所有的出口顺序流都并行执行，为每一条顺序流创建一个并行执行。</p>
</li>
<li>
<p><strong>合并：</strong>所有到达并行网关的并行执行都会在网关处等待，直到每一条入口顺序流都到达了有个执行。然后流程经过该合并网关继续。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意，如果并行网关同时具有多条入口与出口顺序流，可以<strong>同时具有分支与合并的行为</strong>。在这种情况下，网关首先合并所有入口顺序流，然后分裂为多条并行执行路径。</p>
</div>
<div class="paragraph">
<p><strong>与其他网关类型有一个重要区别：并行网关不计算条件。如果连接到并行网关的顺序流上定义了条件，会直接忽略该条件。</strong></p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnParallelGatewayGraphicalNotation">图示</h6>
<div class="paragraph">
<p>并行网关，用内部带有&#8217;加号&#8217;图标的网关（菱形）表示，代表<em>与（AND）</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.parallel.gateway.png" alt="bpmn.parallel.gateway">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnParallelGatewayXML">XML表示</h6>
<div class="paragraph">
<p>定义并行网关只需要一行XML：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;parallelGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myParallelGateway&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>实际行为（分支，合并或两者皆有），由连接到该并行网关的顺序流定义。</p>
</div>
<div class="paragraph">
<p>例如，上面的模型表示为下面的XML：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;fork&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;parallelGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;fork&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;fork&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;receivePayment&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;fork&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;shipOrder&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;receivePayment&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Receive Payment&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;receivePayment&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;join&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;shipOrder&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Ship Order&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;shipOrder&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;join&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;parallelGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;join&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;join&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;archiveOrder&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;archiveOrder&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Archive Order&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;archiveOrder&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的例子中，当流程启动后会创建两个任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-n">ProcessInstance</span> <span class="tok-n">pi</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;forkJoin&quot;</span><span class="tok-o">);</span>
<span class="tok-n">TaskQuery</span> <span class="tok-n">query</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">processInstanceId</span><span class="tok-o">(</span><span class="tok-n">pi</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
    <span class="tok-o">.</span><span class="tok-na">orderByTaskName</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">asc</span><span class="tok-o">();</span>

<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">query</span><span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
<span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-n">tasks</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">());</span>

<span class="tok-n">Task</span> <span class="tok-n">task1</span> <span class="tok-o">=</span> <span class="tok-n">tasks</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">);</span>
<span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Receive Payment&quot;</span><span class="tok-o">,</span> <span class="tok-n">task1</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
<span class="tok-n">Task</span> <span class="tok-n">task2</span> <span class="tok-o">=</span> <span class="tok-n">tasks</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">);</span>
<span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Ship Order&quot;</span><span class="tok-o">,</span> <span class="tok-n">task2</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当这两个任务完成后，第二个并行网关会合并这两个执行。由于它只有一条出口顺序流，因此就不会再创建并行执行路径，而只是激活<em>Archive Order(存档订单)</em>任务。</p>
</div>
<div class="paragraph">
<p>请注意并行网关不需要“平衡”（也就是说，前后对应的两个并行网关，其入口/出口顺序流的数量不需要一致）。每个并行网关都会简单地等待所有入口顺序流，并为每一条出口顺序流创建并行执行，而不受流程模型中的其他结构影响。因此，下面的流程在BPMN 2.0中是合法的：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.unbalanced.parallel.gateway.png" alt="bpmn.unbalanced.parallel.gateway">
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnInclusiveGateway">包容网关</h5>
<div class="sect5">
<h6 id="bpmnInclusiveGatewayDescription">描述</h6>
<div class="paragraph">
<p>可以把<strong>包容网关（inclusive gateway）</strong>看做排他网关与并行网关的组合。与排他网关一样，可以在包容网关的出口顺序流上定义条件，包容网关会计算条件。然而主要的区别是，包容网关与并行网关一样，可以同时选择多于一条出口顺序流。</p>
</div>
<div class="paragraph">
<p>包容网关的功能取决于其入口与出口顺序流：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>分支：</strong>流程会计算所有出口顺序流的条件。对于每一条计算为true的顺序流，流程都会创建一个并行执行。</p>
</li>
<li>
<p><strong>合并：</strong>所有到达包容网关的并行执行，都会在网关处等待。直到每一条具有流程标志（process token）的入口顺序流，都有一个执行到达。这是与并行网关的重要区别。换句话说，包容网关只会等待可以被执行的入口顺序流。在合并后，流程穿过合并并行网关继续。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意，如果包容网关同时具有多条入口与出口顺序流，可以<strong>同时具有分支与合并的行为</strong>。在这种情况下，网关首先合并所有具有流程标志的入口顺序流，然后为每一个条件计算为true的出口顺序流分裂出并行执行路径。</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>包容网关的汇聚行为比并行网关更复杂。所有到达包容网关的并行执行，都会在网关等待，直到所有“可以到达”包容网关的执行都“到达”包容网关。
判断方法为：计算当前流程实例中的所有执行，检查从其位置是否有一条到达包容网关的路径（忽略顺序流上的任何条件）。如果存在这样的执行（可到达但尚未到达），则不会触发包容网关的汇聚行为。</p>
</div>
</blockquote>
<div class="attribution">
&#8212; 译者附（翻译自alfresco文档 http://docs.alfresco.com/process-services1.6/topics/inclusive_gateway.html）
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnInclusiveGatewayGraphicalNotation">图示</h6>
<div class="paragraph">
<p>包容网关，用内部带有&#8217;圆圈&#8217;图标的网关（菱形）表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.inclusive.gateway.png" alt="bpmn.inclusive.gateway">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnInclusiveGatewayXML">XML表示</h6>
<div class="paragraph">
<p>定义包容网关需要一行XML：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;inclusiveGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myInclusiveGateway&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>实际行为（分支，合并或两者皆有），由连接到该包容网关的顺序流定义。</p>
</div>
<div class="paragraph">
<p>例如，上面的模型表现为下面的XML：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;fork&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;inclusiveGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;fork&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;fork&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;receivePayment&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>${paymentReceived == false}<span class="tok-nt">&lt;/conditionExpression&gt;</span>
<span class="tok-nt">&lt;/sequenceFlow&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;fork&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;shipOrder&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>${shipOrder == true}<span class="tok-nt">&lt;/conditionExpression&gt;</span>
<span class="tok-nt">&lt;/sequenceFlow&gt;</span>

<span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;receivePayment&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Receive Payment&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;receivePayment&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;join&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;shipOrder&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Ship Order&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;shipOrder&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;join&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;inclusiveGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;join&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;join&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;archiveOrder&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;archiveOrder&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Archive Order&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;archiveOrder&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的例子中，当流程启动后，如果流程变量paymentReceived == false且shipOrder == true，会创建两个任务。如果只有一个流程变量等于true，则只会创建一个任务。如果没有条件计算为true，会抛出异常（可通过指定默出口顺序流避免）。在下面的例子中，只会创建ship order（传递订单）一个任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">variableMap</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;();</span>
<span class="tok-n">variableMap</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;receivedPayment&quot;</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="tok-n">variableMap</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;shipOrder&quot;</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">);</span>

<span class="tok-n">ProcessInstance</span> <span class="tok-n">pi</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;forkJoin&quot;</span><span class="tok-o">);</span>

<span class="tok-n">TaskQuery</span> <span class="tok-n">query</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">processInstanceId</span><span class="tok-o">(</span><span class="tok-n">pi</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
    <span class="tok-o">.</span><span class="tok-na">orderByTaskName</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">asc</span><span class="tok-o">();</span>

<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">query</span><span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
<span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-n">tasks</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">());</span>

<span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">=</span> <span class="tok-n">tasks</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">);</span>
<span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Ship Order&quot;</span><span class="tok-o">,</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当这个任务完成后，第二个包容网关会合并这两个执行。并且由于它只有一条出口顺序流，所有不会再创建并行执行路径，而只会激活<em>Archive Order(存档订单)</em>任务。</p>
</div>
<div class="paragraph">
<p>请注意包容网关不需要“平衡”（也就是说，对应的包容网关，其入口/出口顺序流的数量不需要匹配）。包容网关会简单地等待所有入口顺序流，并为每一条出口顺序流创建并行执行，不受流程模型中的其他结构影响。</p>
</div>
<div class="paragraph">
<p>请注意包容网关不需要“平衡”（也就是说，前后对应的两个包容网关，其入口/出口顺序流的数量不需要一致）。每个包容网关都会简单地等待所有入口顺序流，并为每一条出口顺序流创建并行执行，不受流程模型中的其他结构影响。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnEventbasedGateway">基于事件的网关</h5>
<div class="sect5">
<h6 id="eventBasedGatewayDescription">描述</h6>
<div class="paragraph">
<p>基于事件的网关（event-based gateway）提供了根据事件做选择的方式。网关的每一条出口顺序流都需要连接至一个捕获中间事件。当流程执行到达基于事件的网关时，与等待状态类似，网关会暂停执行，并且为每一条出口顺序流创建一个事件订阅。</p>
</div>
<div class="paragraph">
<p>请注意：基于事件的网关的出口顺序流与一般的顺序流不同。这些顺序流从不实际<strong>执行</strong>。相反，它们用于告知流程引擎：当执行到达一个基于事件的网关时，需要订阅什么事件。有以下限制：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>一个基于事件的网关，必须有两条或更多的出口顺序流。</p>
</li>
<li>
<p>基于事件的网关，只能连接至<code>intermediateCatchEvent（捕获中间事件）</code>类型的元素（Flowable不支持在基于事件的网关之后连接“接收任务 Receive Task”）。</p>
</li>
<li>
<p>连接至基于事件的网关的<code>intermediateCatchEvent</code>，必须只有一个入口顺序流。</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="eventBasedGatewayGraphNotation">图示</h6>
<div class="paragraph">
<p>基于事件的网关，用内部带有特殊图标的网关（菱形）表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.event.based.gateway.notation.png" alt="bpmn.event.based.gateway.notation">
</div>
</div>
</div>
<div class="sect5">
<h6 id="eventBasedGatewayXML">XML表示</h6>
<div class="paragraph">
<p>用于定义基于事件的网关的XML元素为<code>eventBasedGateway</code>。</p>
</div>
</div>
<div class="sect5">
<h6 id="eventBasedGatewayExample">示例</h6>
<div class="paragraph">
<p>下面是一个带有基于事件的网关的示例流程。当执行到达基于事件的网关时，流程执行暂停。流程实例订阅alert信号事件，并创建一个10分钟后触发的定时器。流程引擎会等待10分钟，并同时等待信号事件。如果信号在10分钟内触发，则会取消定时器，流程沿着信号继续执行，激活Handle alert用户任务。如果10分钟内没有触发信号，则会继续执行，并取消信号订阅。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.event.based.gateway.example.png" alt="bpmn.event.based.gateway.example">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span> <span class="tok-na">id=</span><span class="tok-s">&quot;definitions&quot;</span>
	<span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot;</span>
	<span class="tok-na">xmlns:flowable=</span><span class="tok-s">&quot;http://flowable.org/bpmn&quot;</span>
	<span class="tok-na">targetNamespace=</span><span class="tok-s">&quot;Examples&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;signal</span> <span class="tok-na">id=</span><span class="tok-s">&quot;alertSignal&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;alert&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;catchSignal&quot;</span><span class="tok-nt">&gt;</span>

        <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-nt">/&gt;</span>

        <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;gw1&quot;</span> <span class="tok-nt">/&gt;</span>

        <span class="tok-nt">&lt;eventBasedGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;gw1&quot;</span> <span class="tok-nt">/&gt;</span>

        <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;gw1&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;signalEvent&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;gw1&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;timerEvent&quot;</span> <span class="tok-nt">/&gt;</span>

        <span class="tok-nt">&lt;intermediateCatchEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;signalEvent&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Alert&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;signalEventDefinition</span> <span class="tok-na">signalRef=</span><span class="tok-s">&quot;alertSignal&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;/intermediateCatchEvent&gt;</span>

        <span class="tok-nt">&lt;intermediateCatchEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;timerEvent&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Alert&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;timerEventDefinition&gt;</span>
                <span class="tok-nt">&lt;timeDuration&gt;</span>PT10M<span class="tok-nt">&lt;/timeDuration&gt;</span>
            <span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
        <span class="tok-nt">&lt;/intermediateCatchEvent&gt;</span>

        <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;timerEvent&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;exGw1&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;signalEvent&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;task&quot;</span> <span class="tok-nt">/&gt;</span>

        <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;task&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Handle alert&quot;</span><span class="tok-nt">/&gt;</span>

        <span class="tok-nt">&lt;exclusiveGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;exGw1&quot;</span> <span class="tok-nt">/&gt;</span>

        <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;task&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;exGw1&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;exGw1&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-nt">/&gt;</span>

        <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/process&gt;</span>
<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnTask">2.1.5. 任务</h4>
<div class="sect4">
<h5 id="bpmnUserTask">用户任务</h5>
<div class="sect5">
<h6 id="bpmnUserTaskDescription">描述</h6>
<div class="paragraph">
<p>“用户任务（user task）”用于对需要人工执行的任务进行建模。当流程执行到达用户任务时，会为指派至该任务的用户或组的任务列表创建一个新任务。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnUserTaskGraphicalNotation">图示</h6>
<div class="paragraph">
<p>用户任务用左上角有一个小用户图标的标准任务（圆角矩形）表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.user.task.png" alt="bpmn.user.task">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnUserTaskXml">XML表示</h6>
<div class="paragraph">
<p>用户任务在XML中如下定义。其中<em>id</em>是必须属性，<em>name</em>是可选属性。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Important task&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以为用户任务添加描述（description）。事实上任何BPMN 2.0元素都可以有描述。描述由<strong>documentation</strong>元素定义。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span>
<span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Schedule meeting&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;documentation&gt;</span>
      Schedule an engineering meeting for next week with the new hire.
  <span class="tok-nt">&lt;/documentation&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用标准Java方式获取描述文本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getDescription</span><span class="tok-o">()</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnUserTaskDueDate">到期日期</h6>
<div class="paragraph">
<p>每个任务都可以使用一个字段标志该任务的到期日期（due date）。可以使用查询API，查询在给定日期前或后到期的任务。</p>
</div>
<div class="paragraph">
<p>可以在任务定义中使用扩展指定表达式，以在任务创建时设定到期日期。该表达式<strong>必须解析为<code>java.util.Date</code>，<code>java.util.String (ISO8601格式)</code>，ISO8601时间长度（例如PT50M），或者<code>null</code></strong>。例如，可以使用在流程里前一个表单中输入的日期，或者由前一个服务任务计算出的日期。如果使用的是时间长度，则到期日期基于当前时间加上给定长度计算。例如当dueDate使用“PT30M”时，任务在从现在起30分钟后到期。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Important task&quot;</span> <span class="tok-na">flowable:dueDate=</span><span class="tok-s">&quot;${dateVariable}&quot;</span><span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>任务的到期日期也可以使用<code>TaskService</code>，或者在<code>TaskListener</code>中使用传递的<code>DelegateTask</code>修改。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnUserTaskAssignment">用户指派</h6>
<div class="paragraph">
<p>用户任务可以直接指派（assign）给用户。可以定义<strong>humanPerformer</strong>子元素来实现。<em>humanPerformer</em>需要<strong>resourceAssignmentExpression</strong>来实际定义用户。目前，只支持<strong>formalExpressions</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-nt">&gt;</span>

  ...

  <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&#39;theTask&#39;</span> <span class="tok-na">name=</span><span class="tok-s">&#39;important task&#39;</span> <span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;humanPerformer&gt;</span>
      <span class="tok-nt">&lt;resourceAssignmentExpression&gt;</span>
        <span class="tok-nt">&lt;formalExpression&gt;</span>kermit<span class="tok-nt">&lt;/formalExpression&gt;</span>
      <span class="tok-nt">&lt;/resourceAssignmentExpression&gt;</span>
    <span class="tok-nt">&lt;/humanPerformer&gt;</span>
  <span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>只能指定一个</strong>用户作为任务的<em>humanPerformer</em>。在Flowable术语中，这个用户被称作<strong>办理人（assignee）</strong>。拥有办理人的任务，在其他人的任务列表中不可见，而只能在该办理人的<strong>个人任务列表</strong>中看到。</p>
</div>
<div class="paragraph">
<p>可以通过TaskService获取特定用户办理的任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">taskAssignee</span><span class="tok-o">(</span><span class="tok-s">&quot;kermit&quot;</span><span class="tok-o">).</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>任务也可以放在用户的<strong>候选任务列表</strong>中。在这个情况下，需要使用<strong>potentialOwner（潜在用户）</strong>结构。用法与<em>humanPerformer</em>结构类似。请注意需要指定表达式中的每一个元素为用户还是组（引擎无法自行判断）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-nt">&gt;</span>

  ...

  <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&#39;theTask&#39;</span> <span class="tok-na">name=</span><span class="tok-s">&#39;important task&#39;</span> <span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;potentialOwner&gt;</span>
      <span class="tok-nt">&lt;resourceAssignmentExpression&gt;</span>
        <span class="tok-nt">&lt;formalExpression&gt;</span>user(kermit), group(management)<span class="tok-nt">&lt;/formalExpression&gt;</span>
      <span class="tok-nt">&lt;/resourceAssignmentExpression&gt;</span>
    <span class="tok-nt">&lt;/potentialOwner&gt;</span>
  <span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可用如下方法获取定义了<em>potentialOwner</em>结构的任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">taskCandidateUser</span><span class="tok-o">(</span><span class="tok-s">&quot;kermit&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>将获取所有kermit作为<strong>候选用户</strong>的任务，也就是说，表达式含有<em>user(kermit)</em>的任务。同时也将获取所有<strong>指派给kermit为其成员的组</strong>的任务（例如，kermit时<em>management</em>组的成员，且任务指派给<em>management</em>组）。组在运行时解析，并可通过<a href="#apiEngine">身份服务</a>管理。</p>
</div>
<div class="paragraph">
<p>如果并未指定给定字符串是用户还是组，引擎默认其为组。下列代码与<em>声明group(accountancy)</em>效果一样。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;formalExpression&gt;</span>accountancy<span class="tok-nt">&lt;/formalExpression&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnUserTaskUserAssignmentExtension">用于任务指派的Flowable扩展</h6>
<div class="paragraph">
<p>很明显，当指派关系不复杂时，这种用户与组的指派方式十分笨重。为避免这种复杂性，可以在用户任务上使用<a href="#bpmnCustomExtensions">自定义扩展</a>。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>assignee（办理人）属性</strong>：这个自定义扩展用于直接将用户指派至用户任务。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;my task&quot;</span> <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;kermit&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>与<a href="#bpmnUserTaskAssignment">上面</a>定义的<strong>humanPerformer</strong>结构效果完全相同。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>candidateUsers（候选用户）属性</strong>：这个自定义扩展用于为任务指定候选用户。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;my task&quot;</span> <span class="tok-na">flowable:candidateUsers=</span><span class="tok-s">&quot;kermit, gonzo&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>与使用<a href="#bpmnUserTaskAssignment">上面</a>定义的<strong>potentialOwner</strong>结构效果完全相同。请注意不需要像在<em>potentialOwner</em>中一样，使用<em>user(kermit)</em>的声明，因为这个属性只能用于用户。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>candidateGroups（候选组）attribute</strong>：这个自定义扩展用于为任务指定候选组。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;my task&quot;</span> <span class="tok-na">flowable:candidateGroups=</span><span class="tok-s">&quot;management, accountancy&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>与使用<a href="#bpmnUserTaskAssignment">上面</a>定义的<strong>potentialOwner</strong>结构效果完全相同。请注意不需要像在<em>potentialOwner</em>中一样，使用<em>group(management)</em>的声明，因为这个属性只能用于组。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>可以定义在一个用户任务上同时定义<em>candidateUsers</em>与<em>candidateGroups</em>。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意：尽管Flowable提供了<a href="#apiEngine">IdentityService</a>身份管理组件，但并不会检查给定的用户是否实际存在。这是为了便于将Flowable嵌入应用时，与已有的身份管理解决方案进行集成。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnUserTaskUserCustomIdentityLinkAssignmentExtension">自定义身份关联类型</h6>
<div class="paragraph">
<p>在<a href="#bpmnUserTaskAssignment">用户指派</a>中已经介绍过，BPMN标准支持单个指派用户即<strong>hunamPerformer</strong>，或者由一组用户构成<strong>potentialOwners</strong>潜在用户池。另外，Flowable为用户任务定义了<a href="#bpmnUserTaskUserAssignmentExtension">扩展属性元素</a>，用于代表任务的<strong>办理人</strong>或者<strong>候选用户</strong>。</p>
</div>
<div class="paragraph">
<p>Flowable支持的身份关联（identity link）类型有：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">IdentityLinkType</span> <span class="tok-o">{</span>
  <span class="tok-cm">/* Flowable内置角色 */</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">ASSIGNEE</span> <span class="tok-o">=</span> <span class="tok-s">&quot;assignee&quot;</span><span class="tok-o">;</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">CANDIDATE</span> <span class="tok-o">=</span> <span class="tok-s">&quot;candidate&quot;</span><span class="tok-o">;</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">OWNER</span> <span class="tok-o">=</span> <span class="tok-s">&quot;owner&quot;</span><span class="tok-o">;</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">STARTER</span> <span class="tok-o">=</span> <span class="tok-s">&quot;starter&quot;</span><span class="tok-o">;</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">PARTICIPANT</span> <span class="tok-o">=</span> <span class="tok-s">&quot;participant&quot;</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>BPMN标准及Flowable示例中，身份认证是<strong>用户</strong>与<strong>组</strong>。在前一章节提到过，Flowable的身份管理实现并不适用于生产环境，而需要在支持的认证概要下自行扩展。</p>
</div>
<div class="paragraph">
<p>如果需要添加额外的关联类型，可按照下列语法，使用自定义资源作为扩展元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;make profit&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:customResource</span> <span class="tok-na">flowable:name=</span><span class="tok-s">&quot;businessAdministrator&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;resourceAssignmentExpression&gt;</span>
        <span class="tok-nt">&lt;formalExpression&gt;</span>user(kermit), group(management)<span class="tok-nt">&lt;/formalExpression&gt;</span>
      <span class="tok-nt">&lt;/resourceAssignmentExpression&gt;</span>
    <span class="tok-nt">&lt;/flowable:customResource&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>自定义关联表达式添加至<em>TaskDefinition</em>类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</div></td><td class="code"><span></span>
<span class="tok-kd">protected</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Expression</span><span class="tok-o">&gt;&gt;</span> <span class="tok-n">customUserIdentityLinkExpressions</span> <span class="tok-o">=</span>
    <span class="tok-k">new</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Expression</span><span class="tok-o">&gt;&gt;();</span>
<span class="tok-kd">protected</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Expression</span><span class="tok-o">&gt;&gt;</span> <span class="tok-n">customGroupIdentityLinkExpressions</span> <span class="tok-o">=</span>
    <span class="tok-k">new</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Expression</span><span class="tok-o">&gt;&gt;();</span>

<span class="tok-kd">public</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Expression</span><span class="tok-o">&gt;&gt;</span> <span class="tok-nf">getCustomUserIdentityLinkExpressions</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">customUserIdentityLinkExpressions</span><span class="tok-o">;</span>
<span class="tok-o">}</span>

<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">addCustomUserIdentityLinkExpression</span><span class="tok-o">(</span>
        <span class="tok-n">String</span> <span class="tok-n">identityLinkType</span><span class="tok-o">,</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Expression</span><span class="tok-o">&gt;</span> <span class="tok-n">idList</span><span class="tok-o">)</span> <span class="tok-o">{</span>

    <span class="tok-n">customUserIdentityLinkExpressions</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-n">identityLinkType</span><span class="tok-o">,</span> <span class="tok-n">idList</span><span class="tok-o">);</span>
<span class="tok-o">}</span>

<span class="tok-kd">public</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Expression</span><span class="tok-o">&gt;&gt;</span> <span class="tok-nf">getCustomGroupIdentityLinkExpressions</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">customGroupIdentityLinkExpressions</span><span class="tok-o">;</span>
<span class="tok-o">}</span>

<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">addCustomGroupIdentityLinkExpression</span><span class="tok-o">(</span>
        <span class="tok-n">String</span> <span class="tok-n">identityLinkType</span><span class="tok-o">,</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Expression</span><span class="tok-o">&gt;</span> <span class="tok-n">idList</span><span class="tok-o">)</span> <span class="tok-o">{</span>

    <span class="tok-n">customGroupIdentityLinkExpressions</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-n">identityLinkType</span><span class="tok-o">,</span> <span class="tok-n">idList</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这些方法将在运行时，由<em>UserTaskActivityBehavior</em>的<em>handleAssignments</em>方法调用。</p>
</div>
<div class="paragraph">
<p>最后，需要扩展<em>IdentityLinkType</em>类，以支持自定义身份关联类型：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-kn">package</span> <span class="tok-nn">com.yourco.engine.task</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">IdentityLinkType</span> <span class="tok-kd">extends</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">flowable</span><span class="tok-o">.</span><span class="tok-na">engine</span><span class="tok-o">.</span><span class="tok-na">task</span><span class="tok-o">.</span><span class="tok-na">IdentityLinkType</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">ADMINISTRATOR</span> <span class="tok-o">=</span> <span class="tok-s">&quot;administrator&quot;</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">EXCLUDED_OWNER</span> <span class="tok-o">=</span> <span class="tok-s">&quot;excludedOwner&quot;</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnUserTaskUserCustomAssignmentTaskListeners">通过任务监听器自定义指派</h6>
<div class="paragraph">
<p>如果上面的方式仍不能满足要求，可以在创建事件（create event）上使用<a href="#taskListeners">任务监听器</a>，调用自定义指派逻辑：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;task1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My task&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:taskListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;create&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.MyAssignmentHandler&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>传递至<code>TaskListener</code>的<code>DelegateTask</code>，可用于设置办理人与候选用户/组：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyAssignmentHandler</span> <span class="tok-kd">implements</span> <span class="tok-n">TaskListener</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">notify</span><span class="tok-o">(</span><span class="tok-n">DelegateTask</span> <span class="tok-n">delegateTask</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-c1">// 在这里执行自定义身份查询</span>

    <span class="tok-c1">// 然后调用如下命令：</span>
    <span class="tok-n">delegateTask</span><span class="tok-o">.</span><span class="tok-na">setAssignee</span><span class="tok-o">(</span><span class="tok-s">&quot;kermit&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">delegateTask</span><span class="tok-o">.</span><span class="tok-na">addCandidateUser</span><span class="tok-o">(</span><span class="tok-s">&quot;fozzie&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">delegateTask</span><span class="tok-o">.</span><span class="tok-na">addCandidateGroup</span><span class="tok-o">(</span><span class="tok-s">&quot;management&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">...</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当使用Spring时，可以按上面章节的介绍使用自定义指派属性，并交由使用<a href="#taskListeners">任务监听器</a>、带有<a href="#springExpressions">表达式</a>的Spring bean，监听任务<em>创建</em>事件。在下面的例子中，通过调用<code>ldapService</code> Spring bean的<code>findManagerOfEmployee</code>方法设置办理人。传递的<em>emp</em>参数是一个流程变量。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;task&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My Task&quot;</span> <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;${ldapService.findManagerForEmployee(emp)}&quot;</span><span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以用于候选用户与组：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;task&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My Task&quot;</span> <span class="tok-na">flowable:candidateUsers=</span><span class="tok-s">&quot;${ldapService.findAllSales()}&quot;</span><span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意调用方法的返回类型必须是<code>String</code>或<code>Collection&lt;String&gt;</code>（候选用户或组）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">FakeLdapService</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">findManagerForEmployee</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">employee</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-s">&quot;Kermit The Frog&quot;</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-nf">findAllSales</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">asList</span><span class="tok-o">(</span><span class="tok-s">&quot;kermit&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;gonzo&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;fozzie&quot;</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnScriptTask">脚本任务</h5>
<div class="sect5">
<h6 id="bpmnScriptTaskDescription">描述</h6>
<div class="paragraph">
<p>脚本任务（script task）是自动执行的活动。当流程执行到达脚本任务时，会执行相应的脚本。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnScriptTaskGraphicalNotation">图示</h6>
<div class="paragraph">
<p>脚本任务用左上角有一个小“脚本”图标的标准BPMN 2.0任务（圆角矩形）表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.scripttask.png" alt="bpmn.scripttask">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnScriptTaskXml">XML表示</h6>
<div class="paragraph">
<p>脚本任务使用<strong>script</strong>与<strong>scriptFormat</strong>元素定义。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-nt">&lt;scriptTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theScriptTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Execute script&quot;</span> <span class="tok-na">scriptFormat=</span><span class="tok-s">&quot;groovy&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;script&gt;</span>
    sum = 0
    for ( i in inputArray ) {
      sum += i
    }
  <span class="tok-nt">&lt;/script&gt;</span>
<span class="tok-nt">&lt;/scriptTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>scriptFormat</strong>属性的值，必须是兼容<a href="http://jcp.org/en/jsr/detail?id=223">JSR-223</a>（Java平台脚本）的名字。默认情况下，JavaScript包含在每一个JDK中，因此不需要添加任何JAR文件。如果想使用其它（兼容JSR-223的）脚本引擎，则需要在classpath中添加相应的jar，并使用适当的名字。例如，Flowable单元测试经常使用Groovy，因为其语法与Java十分相似。</p>
</div>
<div class="paragraph">
<p>请注意Groovy脚本引擎与groovy-all JAR捆绑在一起。在Groovy 2.0版本以前，脚本引擎是Groovy JAR的一部分。因此，必须添加如下依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>org.codehaus.groovy<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>groovy-all<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>2.x.x<span class="tok-nt">&lt;version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnScriptTaskVariables">脚本中的变量</h6>
<div class="paragraph">
<p>到达脚本引擎的执行中，所有的流程变量都可以在脚本中使用。在这个例子里，脚本变量<em>'inputArray'</em>实际上就是一个流程变量（一个integer的数组）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;script&gt;</span>
    sum = 0
    for ( i in inputArray ) {
      sum += i
    }
<span class="tok-nt">&lt;/script&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以简单地调用<em>execution.setVariable("variableName", variableValue)</em>，在脚本中设置流程变量。默认情况下，变量不会自动储存（<strong>请注意，在一些早期版本中是会储存的！</strong>）。可以将<code>scriptTask</code>的<code>autoStoreVariables</code>参数设置为<code>true</code>，以自动保存任何在脚本中定义的变量（例如上例中的<em>sum</em>）。然而这并不是最佳实践。<strong>最佳实践是显式调用execution.setVariable()</strong>，因为在JDK近期的一些版本中，某些脚本语言不能自动保存变量。查看<a href="http://www.jorambarrez.be/blog/2013/03/25/bug-on-jdk-1-7-0_17-when-using-scripttask-in-activiti/">这个链接</a>了解更多信息。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;scriptTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;script&quot;</span> <span class="tok-na">scriptFormat=</span><span class="tok-s">&quot;JavaScript&quot;</span> <span class="tok-na">flowable:autoStoreVariables=</span><span class="tok-s">&quot;false&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这个参数的默认值为<code>false</code>。也就是说如果在脚本任务定义中忽略这个参数，则脚本声明的所有变量将只在脚本执行期间有效。</p>
</div>
<div class="paragraph">
<p>在脚本中设置变量的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;script&gt;</span>
    def scriptVar = &quot;test123&quot;
    execution.setVariable(&quot;myVar&quot;, scriptVar)
<span class="tok-nt">&lt;/script&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意：下列名字是保留字，<strong>不能用于</strong>变量名：<strong>out，out:print，lang:import，context，elcontext</strong>。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnScriptTaskResultValue">脚本任务的结果</h6>
<div class="paragraph">
<p>脚本任务的返回值，可以通过为脚本任务定义的<em>'flowable:resultVariable'</em>属性设置为流程变量。可以是已经存在的，或者新的流程变量。如果指定为已存在的流程变量，则流程变量的值会被脚本执行的结果值覆盖。如果不指定结果变量名，则脚本结果值将被忽略。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;scriptTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theScriptTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Execute script&quot;</span> <span class="tok-na">scriptFormat=</span><span class="tok-s">&quot;juel&quot;</span> <span class="tok-na">flowable:resultVariable=</span><span class="tok-s">&quot;myVar&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;script&gt;</span>#{echo}<span class="tok-nt">&lt;/script&gt;</span>
<span class="tok-nt">&lt;/scriptTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的例子中，脚本执行的结果（解析表达式<em>'#{echo}'</em>的值），将在脚本完成后，设置为名为<em>'myVar'</em>的流程变量。</p>
</div>
</div>
<div class="sect5">
<h6 id="_security">安全性</h6>
<div class="paragraph">
<p>当使用<em>javascript</em>作为脚本语言时，可以使用<em>“安全脚本（secure scripting）”</em>。参见<a href="#advancedSecureScripting">安全脚本</a>章节。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnJavaServiceTask">Java服务任务</h5>
<div class="sect5">
<h6 id="bpmnJavaServiceTaskDescription">描述</h6>
<div class="paragraph">
<p>Java服务任务（Java service task）用于调用Java类。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnJavaServiceTaskGraphicalNotation">图示</h6>
<div class="paragraph">
<p>服务任务用左上角有一个小齿轮图标的圆角矩形表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.java.service.task.png" alt="bpmn.java.service.task">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnJavaServiceTaskXML">XML表示</h6>
<div class="paragraph">
<p>有四种方法声明如何调用Java逻辑：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>指定实现了JavaDelegate或ActivityBehavior的类</p>
</li>
<li>
<p>调用解析为委托对象（delegation object）的表达式</p>
</li>
<li>
<p>调用方法表达式（method expression）</p>
</li>
<li>
<p>对值表达式（value expression）求值</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>使用<strong><em>flowable:class</em></strong>属性提供全限定类名（fully qualified classname），指定流程执行时调用的类。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;javaService&quot;</span>
             <span class="tok-na">name=</span><span class="tok-s">&quot;My Java Service Task&quot;</span>
             <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;org.flowable.MyJavaDelegate&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>查看<a href="#bpmnJavaServiceTaskImplementation">实现</a>章节，了解使用这种类的更多信息。</p>
</div>
<div class="paragraph">
<p>也可以使用解析为对象的表达式。该对象必须遵循的规则，与使用<code>flowable:class</code>创建的对象规则相同（查看<a href="#bpmnJavaServiceTaskImplementation">更多</a>）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceTask&quot;</span> <span class="tok-na">flowable:delegateExpression=</span><span class="tok-s">&quot;${delegateExpressionBean}&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>delegateExpressionBean</code>是一个实现了<code>JavaDelegate</code>接口的bean，定义在Spring容器中。</p>
</div>
<div class="paragraph">
<p>使用<strong>flowable:expression</strong>属性指定需要计算的UEL方法表达式。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;javaService&quot;</span>
             <span class="tok-na">name=</span><span class="tok-s">&quot;My Java Service Task&quot;</span>
             <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;#{printer.printMessage()}&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>将在名为<code>printer</code>的对象上调用<code>printMessage</code>方法（不带参数）。</p>
</div>
<div class="paragraph">
<p>也可以为表达式中使用的方法传递变量。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;javaService&quot;</span>
             <span class="tok-na">name=</span><span class="tok-s">&quot;My Java Service Task&quot;</span>
             <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;#{printer.printMessage(execution, myVar)}&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>将在名为<code>printer</code>的对象上调用<code>printMessage</code>方法。传递的第一个参数为<code>DelegateExecution</code>，名为<code>execution</code>，在表达式上下文中默认可用。传递的第二个参数，是当前执行中，名为<code>myVar</code>变量的值。</p>
</div>
<div class="paragraph">
<p>可以使用<strong>flowable:expression</strong>属性指定需要计算的UEL值表达式。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;javaService&quot;</span>
             <span class="tok-na">name=</span><span class="tok-s">&quot;My Java Service Task&quot;</span>
             <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;#{split.ready}&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>会调用名为<code>split</code>的bean的<code>ready</code>参数的getter方法，<code>getReady</code>（不带参数）。该对象会被解析为执行的流程变量或（如果可用的话）Spring上下文中的bean。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnJavaServiceTaskImplementation">实现</h6>
<div class="paragraph">
<p>要实现可以在流程执行中调用的类，需要实现<em>org.flowable.engine.delegate.JavaDelegate</em>接口，并在<em>execute</em>方法中提供所需逻辑。当流程执行到达该活动时，会执行方法中定义的逻辑，并按照BPMN 2.0的默认方法离开活动。</p>
</div>
<div class="paragraph">
<p>下面是一个Java类的示例，用于将流程变量String改为大写。这个类需要实现<em>org.flowable.engine.delegate.JavaDelegate</em>接口，因此需要实现<em>execute(DelegateExecution)</em>方法。这个方法就是引擎将调用的方法，需要实现业务逻辑。可以通过<a href="http://flowable.org/javadocs/org/flowable/engine/delegate/DelegateExecution.html">DelegateExecution</a>接口（点击链接获取该接口操作的详细Javadoc）访问流程实例信息，如流程变量等。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ToUppercase</span> <span class="tok-kd">implements</span> <span class="tok-n">JavaDelegate</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">DelegateExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">var</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">)</span> <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">getVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;input&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">var</span> <span class="tok-o">=</span> <span class="tok-n">var</span><span class="tok-o">.</span><span class="tok-na">toUpperCase</span><span class="tok-o">();</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;input&quot;</span><span class="tok-o">,</span> <span class="tok-n">var</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意：<strong>只会为serviceTask上定义的Java类创建一个实例</strong>。所有流程实例共享同一个类实例，用于调用<em>execute(DelegateExecution)</em>。这意味着该类不能有任何成员变量，并需要是线程安全的，因为它可能会在不同线程中同时执行。这也影响了<a href="#serviceTaskFieldInjection">字段注入</a>的使用方法。（译者注：原文可能较老，不正确。5.21中，flowable:class指定的类，会在流程实例启动时，为每个活动分别进行实例化。不过，当该活动在流程中重复执行，或者为多实例时，使用的都会是同一个类实例。）</p>
</div>
<div class="paragraph">
<p>在流程定义中引用（如<code>flowable:class</code>）的类，<strong>不会在部署时实例化</strong>。只有当流程执行第一次到达该类使用的地方时，才会创建该类的实例。如果找不到这个类，会抛出<code>FlowableException</code>。这是因为部署时的环境（更准确的说<em>classpath</em>），与实际运行的环境经常不一样。例如当使用<em>ant</em>或者Flowable应用中业务存档上传的方式部署的流程，其classpath中不会自动包含流程引用的类。</p>
</div>
<div class="paragraph">
<p><a href="#internal">[内部：非公开实现类]</a>也可以使用实现了<em>org.flowable.engine.impl.delegate.ActivityBehavior</em>接口的类。该实现可以访问更强大的引擎功能，例如，可以影响流程的控制流程。请注意这并不是很好的实践，需要避免这么使用。建议只有在高级使用场景下，并且你确知在做什么的时候，才使用<em>ActivityBehavior</em>接口。</p>
</div>
</div>
<div class="sect5">
<h6 id="serviceTaskFieldInjection">字段注入</h6>
<div class="paragraph">
<p>可以为委托类的字段注入值。支持下列注入方式：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>字符串常量</p>
</li>
<li>
<p>表达式</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>如果可以的话，会按照Java Bean命名约定（例如，<code>firstName</code>成员使用setter <code>setFirstName(&#8230;&#8203;)</code>），通过委托类的公有setter方法，注入变量。如果该字段没有可用的setter，会直接设置该委托类的私有成员的值。有的环境中，SecurityManagers不允许修改私有字段，因此为想要注入的字段暴露一个公有setter方法，是更安全的做法。</p>
</div>
<div class="paragraph">
<p><strong>不论在流程定义中声明的是什么类型的值，注入对象的setter/私有字段的类型，总是<code>org.flowable.engine.delegate.Expression</code>。解析表达式后，可以被转型为合适的类型。</strong></p>
</div>
<div class="paragraph">
<p><em>'flowable:class'</em>属性支持字段注入。也可以在使用<em>flowable:delegateExpression</em>属性时，进行字段注入。然而考虑到线程安全，需要遵循特殊的规则（参见下一章节）。</p>
</div>
<div class="paragraph">
<p>下面的代码片段展示了如何为类中声明的字段注入常量值。请注意按照BPMN 2.0 XML概要的要求，<strong>在实际字段注入声明前，需要先声明&#8217;extensionElements&#8217;XML元素</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;javaService&quot;</span>
    <span class="tok-na">name=</span><span class="tok-s">&quot;Java service invocation&quot;</span>
    <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;org.flowable.examples.bpmn.servicetask.ToUpperCaseFieldInjected&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;extensionElements&gt;</span>
      <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;Hello World&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ToUpperCaseFieldInjected</code>类有一个字段<code>text</code>，为<code>org.flowable.engine.delegate.Expression</code>类型。当调用<code>text.getValue(execution)</code>时，会返回配置的字符串<code>Hello World</code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ToUpperCaseFieldInjected</span> <span class="tok-kd">implements</span> <span class="tok-n">JavaDelegate</span> <span class="tok-o">{</span>

  <span class="tok-kd">private</span> <span class="tok-n">Expression</span> <span class="tok-n">text</span><span class="tok-o">;</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">DelegateExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;var&quot;</span><span class="tok-o">,</span> <span class="tok-o">((</span><span class="tok-n">String</span><span class="tok-o">)</span><span class="tok-n">text</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">)).</span><span class="tok-na">toUpperCase</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>另外，对于较长文本（例如邮件正文），可以使用<em>'flowable:string'</em>子元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;javaService&quot;</span>
    <span class="tok-na">name=</span><span class="tok-s">&quot;Java service invocation&quot;</span>
    <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;org.flowable.examples.bpmn.servicetask.ToUpperCaseFieldInjected&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;text&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;flowable:string&gt;</span>
          This is a long string with a lot of words and potentially way longer even!
      <span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用表达式在运行时动态解析注入的值。这种表达式可以使用流程变量，或者（若使用Spring）Spring定义的Bean。在<a href="#bpmnJavaServiceTaskImplementation">服务任务实现</a>中提到过，当服务任务中使用<em>flowable:class</em>属性时，该Java类的实例在所有流程实例中共享。要动态地为字段注入值，可以在<code>org.flowable.engine.delegate.Expression</code>中注入值或方法表达式，它们会通过<code>execute</code>方法传递的<code>DelegateExecution</code>计算/调用。</p>
</div>
<div class="paragraph">
<p>下面的示例类使用了注入的表达式，并使用当前的<code>DelegateExecution</code>解析它们。调用<em>genderBean</em>方法时传递的是<em>gender</em>变量。完整的代码与测试可以在<code>org.flowable.examples.bpmn.servicetask.JavaServiceTaskTest.testExpressionFieldInjection</code>中找到</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;javaService&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Java service invocation&quot;</span>
  <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;org.flowable.examples.bpmn.servicetask.ReverseStringsFieldInjected&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;text1&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:expression&gt;</span>${genderBean.getGenderString(gender)}<span class="tok-nt">&lt;/flowable:expression&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;text2&quot;</span><span class="tok-nt">&gt;</span>
       <span class="tok-nt">&lt;flowable:expression&gt;</span>Hello ${gender == &#39;male&#39; ? &#39;Mr.&#39; : &#39;Mrs.&#39;} ${name}<span class="tok-nt">&lt;/flowable:expression&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;/ extensionElements&gt;</span>
<span class="tok-nt">&lt;/ serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ReverseStringsFieldInjected</span> <span class="tok-kd">implements</span> <span class="tok-n">JavaDelegate</span> <span class="tok-o">{</span>

  <span class="tok-kd">private</span> <span class="tok-n">Expression</span> <span class="tok-n">text1</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-n">Expression</span> <span class="tok-n">text2</span><span class="tok-o">;</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">DelegateExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">value1</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">)</span> <span class="tok-n">text1</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">);</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;var1&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">StringBuffer</span><span class="tok-o">(</span><span class="tok-n">value1</span><span class="tok-o">).</span><span class="tok-na">reverse</span><span class="tok-o">().</span><span class="tok-na">toString</span><span class="tok-o">());</span>

    <span class="tok-n">String</span> <span class="tok-n">value2</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">)</span> <span class="tok-n">text2</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">);</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;var2&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">StringBuffer</span><span class="tok-o">(</span><span class="tok-n">value2</span><span class="tok-o">).</span><span class="tok-na">reverse</span><span class="tok-o">().</span><span class="tok-na">toString</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>另外，为避免XML太过冗长，可以将表达式设置为属性，而不是子元素。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;text1&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${genderBean.getGenderString(gender)}&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;text1&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;Hello ${gender == &#39;male&#39; ? &#39;Mr.&#39; : &#39;Mrs.&#39;} ${name}&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="serviceTaskFieldInjectionThreadSafety">字段注入与线程安全</h6>
<div class="paragraph">
<p>通常情况下，在服务任务中使用Java委托与字段注入是线程安全的。然而，有些情况下不能保证线程安全。这取决于设置，或Flowable运行的环境。</p>
</div>
<div class="paragraph">
<p>当使用<em>flowable:class</em>属性时，使用字段注入总是线程安全的（译者注：仍不完全安全，如对于多实例服务任务，使用的是同一个实例）。对于引用了某个类的每一个服务任务，都会实例化新的实例，并且在创建实例时注入一次字段。在不同的任务或流程定义中多次使用同一个类没有问题。</p>
</div>
<div class="paragraph">
<p>当使用<em>flowable:expression</em>属性时，不能使用字段注入。只能通过方法调用传递变量。总是线程安全的。</p>
</div>
<div class="paragraph">
<p>当使用<em>flowable:delegateExpression</em>属性时，委托实例的线程安全性，取决于表达式解析的方式。如果该委托表达式在多个任务或流程定义中重复使用，并且表达式总是返回相同的示例，则字段注入<strong>不是线程安全的</strong>。让我们看几个例子。</p>
</div>
<div class="paragraph">
<p>假设表达式为<em>${factory.createDelegate(someVariable)}</em>，其中factory为引擎可用的Java bean（例如使用Spring集成时的Spring bean），并在每次表达式解析时创建新的实例。这种情况下，使用字段注入时，没有线程安全性问题：每次表达式解析时，都会注入新实例的字段。</p>
</div>
<div class="paragraph">
<p>然而，如果表达式为<em>${someJavaDelegateBean}</em>，解析为JavaDelegate的实现，并且在创建单例的环境（如Spring）中运行。当在不同的任务或流程定义中使用这个表达式时，表达式总会解析为相同的实例。这种情况下，使用字段注入不是线程安全的。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceTask1&quot;</span> <span class="tok-na">flowable:delegateExpression=</span><span class="tok-s">&quot;${someJavaDelegateBean}&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;extensionElements&gt;</span>
        <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;someField&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${input * 2}&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>

<span class="tok-c">&lt;!-- 其它流程定义元素 --&gt;</span>

<span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceTask2&quot;</span> <span class="tok-na">flowable:delegateExpression=</span><span class="tok-s">&quot;${someJavaDelegateBean}&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;extensionElements&gt;</span>
        <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;someField&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${input * 2000}&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这段示例代码有两个服务任务，使用同一个委托表达式，但是<em>expression</em>字段填写不同的值。<strong>如果该表达式解析为相同的实例，就会在并发场景下，注入<em>someField</em>字段时出现竞争条件</strong>。</p>
</div>
<div class="paragraph">
<p>最简单的解决方法是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用表达式代替直接使用Java委托，并将所需数据通过方法参数传递给委托。</p>
</li>
<li>
<p>或者，在每次委托表达式解析时，返回委托类的新实例。这意味着这个bean的scope必须是<strong>prototype（原型）</strong>（例如在委托类上加上@Scope(SCOPE_PROTOTYPE)注解）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在Flowable 5.22版本中，可以通过配置流程引擎配置，禁用在委托表达式上使用字段注入。需要设置<em>delegateExpressionFieldInjectionMode</em>参数（取<em>org.flowable.engine.imp.cfg.DelegateExpressionFieldInjectionMode</em>枚举中的值）。</p>
</div>
<div class="paragraph">
<p>可使用下列选项：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>DISABLED（禁用）</strong>：当使用委托表达式时，完全禁用字段注入。不会再尝试进行字段注入。这是最安全的方式，保证线程安全。</p>
</li>
<li>
<p><strong>COMPATIBILITY（兼容）</strong>：在这个模式下，行为与V5.21之前完全一样：可以在委托表达式中使用字段注入，如果委托类中没有定义该字段，会抛出异常。这是最不线程安全的模式，但可以保证历史版本兼容性，也可以在委托表达式只在一个任务中使用的时候（因此不会产生并发竞争条件），安全使用。</p>
</li>
<li>
<p><strong>MIXED（混合）</strong>：可以在使用委托表达式时注入，但当委托中没有定义字段时，不会抛出异常。这样可以在部分委托（比如不是单例的实例）中使用注入，而在部分委托中不使用注入。</p>
</li>
<li>
<p><strong>Flowable 5.x版本的默认模式为COMPATIBILITY</strong>。</p>
</li>
<li>
<p><strong>Flowable 6.x版本的默认模式为MIXED</strong>。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例如，假设使用<em>MIXED</em>模式，并使用Spring集成，在Spring配置中定义了如下bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;singletonDelegateExpressionBean&quot;</span>
  <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.test.fieldinjection.SingletonDelegateExpressionBean&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;prototypeDelegateExpressionBean&quot;</span>
  <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.test.fieldinjection.PrototypeDelegateExpressionBean&quot;</span>
  <span class="tok-na">scope=</span><span class="tok-s">&quot;prototype&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>第一个bean是一般的Spring bean，因此是单例的。第二个bean的scope为<em>prototype</em>，因此每次请求这个bean时，Spring容器都会返回一个新实例。</p>
</div>
<div class="paragraph">
<p>在以下流程定义中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceTask1&quot;</span> <span class="tok-na">flowable:delegateExpression=</span><span class="tok-s">&quot;${prototypeDelegateExpressionBean}&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;fieldA&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${input * 2}&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;fieldB&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${1 + 1}&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resultVariableName&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;resultServiceTask1&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>

<span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceTask2&quot;</span> <span class="tok-na">flowable:delegateExpression=</span><span class="tok-s">&quot;${prototypeDelegateExpressionBean}&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;fieldA&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${123}&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;fieldB&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${456}&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resultVariableName&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;resultServiceTask2&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>

<span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceTask3&quot;</span> <span class="tok-na">flowable:delegateExpression=</span><span class="tok-s">&quot;${singletonDelegateExpressionBean}&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;fieldA&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${input * 2}&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;fieldB&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${1 + 1}&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resultVariableName&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;resultServiceTask1&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>

<span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceTask4&quot;</span> <span class="tok-na">flowable:delegateExpression=</span><span class="tok-s">&quot;${singletonDelegateExpressionBean}&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;fieldA&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${123}&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;fieldB&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${456}&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resultVariableName&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;resultServiceTask2&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>有四个服务任务，第一、二个使用<em>${prototypeDelegateExpressionBean}</em>委托表达式，第三、四个使用<em>${singletonDelegateExpressionBean}</em>委托表达式。</p>
</div>
<div class="paragraph">
<p>先看原型bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">PrototypeDelegateExpressionBean</span> <span class="tok-kd">implements</span> <span class="tok-n">JavaDelegate</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">AtomicInteger</span> <span class="tok-n">INSTANCE_COUNT</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AtomicInteger</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">);</span>

  <span class="tok-kd">private</span> <span class="tok-n">Expression</span> <span class="tok-n">fieldA</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-n">Expression</span> <span class="tok-n">fieldB</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-n">Expression</span> <span class="tok-n">resultVariableName</span><span class="tok-o">;</span>

  <span class="tok-kd">public</span> <span class="tok-nf">PrototypeDelegateExpressionBean</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">INSTANCE_COUNT</span><span class="tok-o">.</span><span class="tok-na">incrementAndGet</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">DelegateExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-o">{</span>

    <span class="tok-n">Number</span> <span class="tok-n">fieldAValue</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Number</span><span class="tok-o">)</span> <span class="tok-n">fieldA</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">);</span>
    <span class="tok-n">Number</span> <span class="tok-n">fieldValueB</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Number</span><span class="tok-o">)</span> <span class="tok-n">fieldB</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">);</span>

    <span class="tok-kt">int</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">fieldAValue</span><span class="tok-o">.</span><span class="tok-na">intValue</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-n">fieldValueB</span><span class="tok-o">.</span><span class="tok-na">intValue</span><span class="tok-o">();</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-n">resultVariableName</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">).</span><span class="tok-na">toString</span><span class="tok-o">(),</span> <span class="tok-n">result</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在运行上面流程定义的流程实例后，<em>INSTANCE_COUNT</em>的值为<em>2</em>。这是因为每次解析<em>${prototypeDelegateExpressionBean}</em>时，都会创建新实例。可以看到三个<em>Expression</em>成员字段的注入没有任何问题。</p>
</div>
<div class="paragraph">
<p>单例bean则有一点区别：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SingletonDelegateExpressionBean</span> <span class="tok-kd">implements</span> <span class="tok-n">JavaDelegate</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">AtomicInteger</span> <span class="tok-n">INSTANCE_COUNT</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AtomicInteger</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">);</span>

  <span class="tok-kd">public</span> <span class="tok-nf">SingletonDelegateExpressionBean</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">INSTANCE_COUNT</span><span class="tok-o">.</span><span class="tok-na">incrementAndGet</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">DelegateExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-o">{</span>

    <span class="tok-n">Expression</span> <span class="tok-n">fieldAExpression</span> <span class="tok-o">=</span> <span class="tok-n">DelegateHelper</span><span class="tok-o">.</span><span class="tok-na">getFieldExpression</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">,</span> <span class="tok-s">&quot;fieldA&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">Number</span> <span class="tok-n">fieldA</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Number</span><span class="tok-o">)</span> <span class="tok-n">fieldAExpression</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">);</span>

    <span class="tok-n">Expression</span> <span class="tok-n">fieldBExpression</span> <span class="tok-o">=</span> <span class="tok-n">DelegateHelper</span><span class="tok-o">.</span><span class="tok-na">getFieldExpression</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">,</span> <span class="tok-s">&quot;fieldB&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">Number</span> <span class="tok-n">fieldB</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Number</span><span class="tok-o">)</span> <span class="tok-n">fieldBExpression</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">);</span>

    <span class="tok-kt">int</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">fieldA</span><span class="tok-o">.</span><span class="tok-na">intValue</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-n">fieldB</span><span class="tok-o">.</span><span class="tok-na">intValue</span><span class="tok-o">();</span>

    <span class="tok-n">String</span> <span class="tok-n">resultVariableName</span> <span class="tok-o">=</span> <span class="tok-n">DelegateHelper</span><span class="tok-o">.</span><span class="tok-na">getFieldExpression</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">,</span>
        <span class="tok-s">&quot;resultVariableName&quot;</span><span class="tok-o">).</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">).</span><span class="tok-na">toString</span><span class="tok-o">();</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-n">resultVariableName</span><span class="tok-o">,</span> <span class="tok-n">result</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在对于单例bean，<em>INSTANCE_COUNT</em>总是<em>1</em>。在这个委托中，没有<em>Expression</em>成员字段（使用<em>MIXED</em>模式）。而在<em>COMPATIBILITY</em>模式下，就会抛出异常，因为需要有成员字段。这个bean也可以使用<em>DISABLED</em>模式，但会禁用上面进行了字段注入的原型bean。</p>
</div>
<div class="paragraph">
<p>在委托的代码里，使用了<strong>org.flowable.engine.delegate.DelegateHelper</strong>。它提供了一些有用的工具方法，用于执行相同的逻辑，并且在单例中是线程安全的。与注入<em>Expression</em>不同，它通过<em>getFieldExpression</em>读取。这意味着在服务任务的XML里，字段定义与单例bean完全相同。查看上面的XML代码，可以看到定义是相同的，只是实现逻辑不同。</p>
</div>
<div class="paragraph">
<p>技术提示：<em>getFieldExpression</em>直接读取BpmnModel，并在方法执行时创建表达式，因此是线程安全的。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在Flowable V5.x版本中，（由于架构缺陷）不能在<em>ExecutionListener</em>或<em>TaskListener</em>中使用DelegateHelper。要保证监听器的线程安全，仍需使用表达式，或确保每次解析委托表达式时，都创建新实例。</p>
</li>
<li>
<p>在Flowable V6.x版本中，在<em>ExecutionListener</em>或<em>TaskListener</em>中可以使用DelegateHelper。例如在V6.x版本中，下列代码可以使用<strong>DelegateHelper</strong>：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;extensionElements&gt;</span>
  <span class="tok-nt">&lt;flowable:executionListener</span>
      <span class="tok-na">delegateExpression=</span><span class="tok-s">&quot;${testExecutionListener}&quot;</span> <span class="tok-na">event=</span><span class="tok-s">&quot;start&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;input&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${startValue}&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resultVar&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;processStartValue&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/flowable:executionListener&gt;</span>
<span class="tok-nt">&lt;/extensionElements&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>其中<em>testExecutionListener</em>解析为ExecutionListener接口的一个实现的实例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span></span><span class="tok-nd">@Component</span><span class="tok-o">(</span><span class="tok-s">&quot;testExecutionListener&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TestExecutionListener</span> <span class="tok-kd">implements</span> <span class="tok-n">ExecutionListener</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">notify</span><span class="tok-o">(</span><span class="tok-n">DelegateExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">Expression</span> <span class="tok-n">inputExpression</span> <span class="tok-o">=</span> <span class="tok-n">DelegateHelper</span><span class="tok-o">.</span><span class="tok-na">getFieldExpression</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">,</span> <span class="tok-s">&quot;input&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">Number</span> <span class="tok-n">input</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Number</span><span class="tok-o">)</span> <span class="tok-n">inputExpression</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">);</span>

    <span class="tok-kt">int</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">input</span><span class="tok-o">.</span><span class="tok-na">intValue</span><span class="tok-o">()</span> <span class="tok-o">*</span> <span class="tok-mi">100</span><span class="tok-o">;</span>

    <span class="tok-n">Expression</span> <span class="tok-n">resultVarExpression</span> <span class="tok-o">=</span> <span class="tok-n">DelegateHelper</span><span class="tok-o">.</span><span class="tok-na">getFieldExpression</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">,</span> <span class="tok-s">&quot;resultVar&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-n">resultVarExpression</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">).</span><span class="tok-na">toString</span><span class="tok-o">(),</span> <span class="tok-n">result</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="serviceTaskResultValue">服务任务的结果</h6>
<div class="paragraph">
<p>服务执行的返回值（仅对使用表达式的服务任务），可以通过为服务任务定义的<em>'flowable:resultVariable'</em>属性设置为流程变量。可以是已经存在的，或者新的流程变量。
如果指定为已存在的流程变量，则流程变量的值会被服务执行的结果值覆盖。
如果使用<em>'flowable:useLocalScopeForResultVariable'</em>，则会将结果值设置为局部变量。
如果不指定结果变量名，则服务任务的结果值将被忽略。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;aMethodExpressionServiceTask&quot;</span>
    <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;#{myService.doSomething()}&quot;</span>
    <span class="tok-na">flowable:resultVariable=</span><span class="tok-s">&quot;myVar&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在上例中，服务执行的结果（流程变量或Spring bean中，使用<em>'myService'</em>名字所获取的对象，调用<em>'doSomething()'</em>方法的返回值），在服务执行完成后，会设置为名为<em>'myVar'</em>的流程变量。</p>
</div>
</div>
<div class="sect5">
<h6 id="serviceTaskTriggerable">可触发</h6>
<div class="paragraph">
<p>一种常见的模式是发送JMS消息或HTTP调用触发外部服务，然后流程实例进入等待状态。之后外部系统会回复响应，流程实例继续执行下一个活动。在默认的BPMN中，需要使用服务任务和接收任务（receive task）。但是这样会引入竞争条件：外部服务的响应可能会早于流程实例持久化及接收任务激活。为了解决这个问题，Flowable为服务任务增加了triggerable（可触发）属性，可以将服务任务转变为执行服务逻辑，并在继续执行之前等待外部触发的任务。如果在可触发服务任务上同时设置异步（async 为 true），则流程实例会先持久化，然后在异步作业中执行服务任务逻辑。在BPMN XML中，可以这样实现可触发服务任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;aTriggerableServiceTask&quot;</span>
    <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;#{myService.doSomething()}&quot;</span>
    <span class="tok-na">flowable:triggerable=</span><span class="tok-s">&quot;true&quot;</span>
    <span class="tok-na">flowable:async=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>外部服务可以同步或异步地触发等待中的流程实例。为了避免乐观锁异常，最好使用异步触发。默认情况下，异步作业是排他的，也就是说流程实例会被锁定，以保证流程实例中的其他活动不会影响到触发器的逻辑。可以使用RuntimeService的triggerAsync方法，异步触发等待中的流程实例。当然还是可以使用RuntimeService的trigger方法，同步触发。</p>
</div>
</div>
<div class="sect5">
<h6 id="serviceTaskExceptionHandling">处理异常</h6>
<div class="paragraph">
<p>当执行自定义逻辑时，通常需要捕获并在流程中处理特定的业务异常。Flowable提供了多种选择。</p>
</div>
<div class="sect6">
<h7 id="serviceTaskBpmnErrors">抛出BPMN错误</h7>
<div class="paragraph">
<p>可以在服务任务或脚本任务的用户代码中抛出BPMN错误。可以在Java委托、脚本、表达式与委托表达式中，抛出特殊的FlowableException：<em>BpmnError</em>。引擎会捕获这个异常，并将其转发至合适的错误处理器，如错误边界事件或错误事件子流程。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ThrowBpmnErrorDelegate</span> <span class="tok-kd">implements</span> <span class="tok-n">JavaDelegate</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">DelegateExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
    <span class="tok-k">try</span> <span class="tok-o">{</span>
      <span class="tok-n">executeBusinessLogic</span><span class="tok-o">();</span>
    <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">BusinessException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">BpmnError</span><span class="tok-o">(</span><span class="tok-s">&quot;BusinessExceptionOccurred&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>构造函数的参数是错误代码。错误代码决定了处理这个错误的错误处理器。参见<a href="#bpmnBoundaryErrorEvent">错误边界事件</a>了解如何捕获BPMN错误。</p>
</div>
<div class="paragraph">
<p>这个机制<strong>只应该用于业务错误</strong>，需要通过流程中定义的错误边界事件或错误事件子流程处理。技术错误应该通过其他异常类型表现，并且通常不在流程内部处理。</p>
</div>
</div>
<div class="sect6">
<h7 id="exceptionMapping">异常映射</h7>
<div class="paragraph">
<p>也可以使用<code>mapException</code>扩展，直接将Java异常映射至业务异常（错误）。单映射是最简单的形式：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;servicetask1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Service Task&quot;</span> <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;...&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:mapException</span>
          <span class="tok-na">errorCode=</span><span class="tok-s">&quot;myErrorCode1&quot;</span><span class="tok-nt">&gt;</span>org.flowable.SomeException<span class="tok-nt">&lt;/flowable:mapException&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的代码中，如果服务任务抛出<code>org.flowable.SomeException</code>的实例，引擎会捕获该异常，并将其转换为带有给定errorCode的BPMN错误。然后就可以像普通BPMN错误完全一样地处理。其他的异常没有映射，仍将抛出至API调用处。</p>
</div>
<div class="paragraph">
<p>也可以在单行中使用<code>includeChildExceptions</code>属性，映射特定异常的所有子异常。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;servicetask1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Service Task&quot;</span> <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;...&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:mapException</span> <span class="tok-na">errorCode=</span><span class="tok-s">&quot;myErrorCode1&quot;</span>
           <span class="tok-na">includeChildExceptions=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">&gt;</span>org.flowable.SomeException<span class="tok-nt">&lt;/flowable:mapException&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的代码中，Flowable会将<code>SomeException</code>的任何直接或间接的子类，转换为带有指定错误代码的BPMN错误。
当未指定<code>includeChildExceptions</code>时，视为“false”。</p>
</div>
<div class="paragraph">
<p>默认映射最泛用。默认映射是一个不指定类的映射，可以匹配任何Java异常：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;servicetask1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Service Task&quot;</span> <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;...&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:mapException</span> <span class="tok-na">errorCode=</span><span class="tok-s">&quot;myErrorCode1&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>除了默认映射，会按照从上至下的顺序检查映射，使用第一个匹配的映射。只在所有映射都不能成功匹配时使用默认映射。
只有第一个不指定类的映射会作为默认映射。默认映射忽略<code>includeChildExceptions</code>。</p>
</div>
</div>
<div class="sect6">
<h7 id="serviceTaskExceptionSequenceFlow">异常顺序流</h7>
<div class="paragraph">
<p><a href="#internal">[内部：非公开实现类]</a></p>
</div>
<div class="paragraph">
<p>也可以选择在发生异常时，将流程执行路由至另一条路径。下面是一个例子。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;javaService&quot;</span>
  <span class="tok-na">name=</span><span class="tok-s">&quot;Java service invocation&quot;</span>
  <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;org.flowable.ThrowsExceptionBehavior&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>

<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;no-exception&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;javaService&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;exception&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;javaService&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;fixException&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>服务任务有两条出口顺序流，命名为<code>exception</code>与<code>no-exception</code>。在发生异常时，使用顺序流ID控制流程流向：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ThrowsExceptionBehavior</span> <span class="tok-kd">implements</span> <span class="tok-n">ActivityBehavior</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">DelegateExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">var</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">)</span> <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">getVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;var&quot;</span><span class="tok-o">);</span>

    <span class="tok-n">String</span> <span class="tok-n">sequenceFlowToTake</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
    <span class="tok-k">try</span> <span class="tok-o">{</span>
      <span class="tok-n">executeLogic</span><span class="tok-o">(</span><span class="tok-n">var</span><span class="tok-o">);</span>
      <span class="tok-n">sequenceFlowToTake</span> <span class="tok-o">=</span> <span class="tok-s">&quot;no-exception&quot;</span><span class="tok-o">;</span>
    <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">Exception</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-n">sequenceFlowToTake</span> <span class="tok-o">=</span> <span class="tok-s">&quot;exception&quot;</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
    <span class="tok-n">DelegateHelper</span><span class="tok-o">.</span><span class="tok-na">leaveDelegate</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">,</span> <span class="tok-n">sequenceFlowToTake</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="serviceTaskCallActivitiService">在JavaDelegate中使用Flowable服务</h6>
<div class="paragraph">
<p>有的时候，需要在Java服务任务中使用Flowable服务（例如调用活动（call activity）不满足需要的场景下，使用RuntimeService启动流程实例）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">StartProcessInstanceTestDelegate</span> <span class="tok-kd">implements</span> <span class="tok-n">JavaDelegate</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">DelegateExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
    <span class="tok-n">RuntimeService</span> <span class="tok-n">runtimeService</span> <span class="tok-o">=</span> <span class="tok-n">Context</span><span class="tok-o">.</span><span class="tok-na">getProcessEngineConfiguration</span><span class="tok-o">().</span><span class="tok-na">getRuntimeService</span><span class="tok-o">();</span>
    <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;myProcess&quot;</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用这个接口访问所有Flowable服务API。</p>
</div>
<div class="paragraph">
<p>使用这些API调用造成的所有数据变更都在当前事务中。在依赖注入的环境（如Spring或CDI，无论是否使用启用JTA的数据源）下也可以使用这个接口。例如，下面的代码片段与上面的代码具有相同功能，但通过注入而不是<em>org.flowable.engine.EngineServices</em>接口获得RuntimeService。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-nd">@Component</span><span class="tok-o">(</span><span class="tok-s">&quot;startProcessInstanceDelegate&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">StartProcessInstanceTestDelegateWithInjection</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Autowired</span>
    <span class="tok-kd">private</span> <span class="tok-n">RuntimeService</span> <span class="tok-n">runtimeService</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">startProcess</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;oneTaskProcess&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>重要技术提示：</strong>由于服务调用是在当前事务中完成的，因此在服务任务执行前产生或修改的数据尚未存入数据库。所有API调用都基于数据库数据处理，这意味着这些未提交的修改在服务任务的API调用中“不可见”。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnWebserviceTask">Web服务任务</h5>
<div class="sect5">
<h6 id="bpmnWebserviceTaskDescription">描述</h6>
<div class="paragraph">
<p>Web服务任务（Web service task）用于同步地调用外部的Web服务。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnWebserviceTaskGraphicalNotation">图示</h6>
<div class="paragraph">
<p>Web服务任务与Java服务任务图标一样。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.web.service.task.png" alt="bpmn.web.service.task">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnWebserviceTaskXML">XML表示</h6>
<div class="paragraph">
<p>使用Web服务之前，需要导入其操作及复杂的类型。可以使用导入标签（import tag）指向Web服务的WSDL，自动处理：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;import</span> <span class="tok-na">importType=</span><span class="tok-s">&quot;http://schemas.xmlsoap.org/wsdl/&quot;</span>
	<span class="tok-na">location=</span><span class="tok-s">&quot;http://localhost:63081/counter?wsdl&quot;</span>
	<span class="tok-na">namespace=</span><span class="tok-s">&quot;http://webservice.flowable.org/&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>按照上面的声明，Flowable会导入定义，但不会创建条目定义（item definition）与消息。如果需要调用一个名为&#8217;prettyPrint&#8217;的方法，则需要先为请求及回复消息创建对应的消息与条目定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;message</span> <span class="tok-na">id=</span><span class="tok-s">&quot;prettyPrintCountRequestMessage&quot;</span> <span class="tok-na">itemRef=</span><span class="tok-s">&quot;tns:prettyPrintCountRequestItem&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;message</span> <span class="tok-na">id=</span><span class="tok-s">&quot;prettyPrintCountResponseMessage&quot;</span> <span class="tok-na">itemRef=</span><span class="tok-s">&quot;tns:prettyPrintCountResponseItem&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;itemDefinition</span> <span class="tok-na">id=</span><span class="tok-s">&quot;prettyPrintCountRequestItem&quot;</span> <span class="tok-na">structureRef=</span><span class="tok-s">&quot;counter:prettyPrintCount&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;itemDefinition</span> <span class="tok-na">id=</span><span class="tok-s">&quot;prettyPrintCountResponseItem&quot;</span> <span class="tok-na">structureRef=</span><span class="tok-s">&quot;counter:prettyPrintCountResponse&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在声明服务任务前，需要定义实际引用Web服务的BPMN接口与操作。基本上，是定义“接口”与所需的“操作”。对每一个操作都可以重复使用之前定义的“传入”与“传出”消息。例如，下面的声明定义了“counter”接口及“prettyPrintCountOperation”操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;interface</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Counter Interface&quot;</span> <span class="tok-na">implementationRef=</span><span class="tok-s">&quot;counter:Counter&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;operation</span> <span class="tok-na">id=</span><span class="tok-s">&quot;prettyPrintCountOperation&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;prettyPrintCount Operation&quot;</span>
			<span class="tok-na">implementationRef=</span><span class="tok-s">&quot;counter:prettyPrintCount&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">&lt;inMessageRef&gt;</span>tns:prettyPrintCountRequestMessage<span class="tok-nt">&lt;/inMessageRef&gt;</span>
		<span class="tok-nt">&lt;outMessageRef&gt;</span>tns:prettyPrintCountResponseMessage<span class="tok-nt">&lt;/outMessageRef&gt;</span>
	<span class="tok-nt">&lt;/operation&gt;</span>
<span class="tok-nt">&lt;/interface&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样就可以使用##WebService实现，声明Web服务任务，并引用Web服务操作。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;webService&quot;</span>
	<span class="tok-na">name=</span><span class="tok-s">&quot;Web service invocation&quot;</span>
	<span class="tok-na">implementation=</span><span class="tok-s">&quot;##WebService&quot;</span>
	<span class="tok-na">operationRef=</span><span class="tok-s">&quot;tns:prettyPrintCountOperation&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnWebserviceTaskIOSpecification">Web服务任务IO规范</h6>
<div class="paragraph">
<p>除非使用简化方法处理输入与输出数据关联（见下），否则需要为每个Web服务任务声明IO规范，指出任务的输入与输出是什么。这个方法很简单，也兼容BPMN 2.0。在prettyPrint例子中，根据之前声明的条目定义，定义输入与输出：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nt">&lt;ioSpecification&gt;</span>
    <span class="tok-nt">&lt;dataInput</span> <span class="tok-na">itemSubjectRef=</span><span class="tok-s">&quot;tns:prettyPrintCountRequestItem&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dataInputOfServiceTask&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;dataOutput</span> <span class="tok-na">itemSubjectRef=</span><span class="tok-s">&quot;tns:prettyPrintCountResponseItem&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dataOutputOfServiceTask&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;inputSet&gt;</span>
        <span class="tok-nt">&lt;dataInputRefs&gt;</span>dataInputOfServiceTask<span class="tok-nt">&lt;/dataInputRefs&gt;</span>
    <span class="tok-nt">&lt;/inputSet&gt;</span>
    <span class="tok-nt">&lt;outputSet&gt;</span>
        <span class="tok-nt">&lt;dataOutputRefs&gt;</span>dataOutputOfServiceTask<span class="tok-nt">&lt;/dataOutputRefs&gt;</span>
    <span class="tok-nt">&lt;/outputSet&gt;</span>
<span class="tok-nt">&lt;/ioSpecification&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnWebserviceTaskDataInputAssociation">Web服务任务数据输入关联</h6>
<div class="paragraph">
<p>有两种指定数据输入关联的方式：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用表达式</p>
</li>
<li>
<p>使用简化方法</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>使用表达式指定数据输入关联，需要定义源及目标条目，并指定每个条目与字段的关联。下面的例子中，我们针对每个条目，指定prefix与suffix字段：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-nt">&lt;dataInputAssociation&gt;</span>
    <span class="tok-nt">&lt;sourceRef&gt;</span>dataInputOfProcess<span class="tok-nt">&lt;/sourceRef&gt;</span>
    <span class="tok-nt">&lt;targetRef&gt;</span>dataInputOfServiceTask<span class="tok-nt">&lt;/targetRef&gt;</span>
    <span class="tok-nt">&lt;assignment&gt;</span>
        <span class="tok-nt">&lt;from&gt;</span>${dataInputOfProcess.prefix}<span class="tok-nt">&lt;/from&gt;</span>
        <span class="tok-nt">&lt;to&gt;</span>${dataInputOfServiceTask.prefix}<span class="tok-nt">&lt;/to&gt;</span>
    <span class="tok-nt">&lt;/assignment&gt;</span>
    <span class="tok-nt">&lt;assignment&gt;</span>
        <span class="tok-nt">&lt;from&gt;</span>${dataInputOfProcess.suffix}<span class="tok-nt">&lt;/from&gt;</span>
        <span class="tok-nt">&lt;to&gt;</span>${dataInputOfServiceTask.suffix}<span class="tok-nt">&lt;/to&gt;</span>
    <span class="tok-nt">&lt;/assignment&gt;</span>
<span class="tok-nt">&lt;/dataInputAssociation&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用更简单明了的简化方法。'sourceRef&#8217;元素是一个Flowable变量名，'targetRef&#8217;是条目定义的参数。在下面的例子里，将&#8217;PrefixVariable&#8217;变量的值关联至&#8217;prefix&#8217;字段，并将&#8217;SuffixVariable&#8217;变量的值关联至&#8217;suffix&#8217;字段。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-nt">&lt;dataInputAssociation&gt;</span>
    <span class="tok-nt">&lt;sourceRef&gt;</span>PrefixVariable<span class="tok-nt">&lt;/sourceRef&gt;</span>
    <span class="tok-nt">&lt;targetRef&gt;</span>prefix<span class="tok-nt">&lt;/targetRef&gt;</span>
<span class="tok-nt">&lt;/dataInputAssociation&gt;</span>
<span class="tok-nt">&lt;dataInputAssociation&gt;</span>
    <span class="tok-nt">&lt;sourceRef&gt;</span>SuffixVariable<span class="tok-nt">&lt;/sourceRef&gt;</span>
    <span class="tok-nt">&lt;targetRef&gt;</span>suffix<span class="tok-nt">&lt;/targetRef&gt;</span>
<span class="tok-nt">&lt;/dataInputAssociation&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnWebserviceTaskDataOutputAssociation">Web服务任务数据输出关联</h6>
<div class="paragraph">
<p>有两种指定数据输出关联的方式：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用表达式</p>
</li>
<li>
<p>使用简化方法</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>使用表达式指定数据输出关联，需要定义目标变量及源表达式。这种方法很简单，与数据输入关联类似：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;dataOutputAssociation&gt;</span>
    <span class="tok-nt">&lt;targetRef&gt;</span>dataOutputOfProcess<span class="tok-nt">&lt;/targetRef&gt;</span>
    <span class="tok-nt">&lt;transformation&gt;</span>${dataOutputOfServiceTask.prettyPrint}<span class="tok-nt">&lt;/transformation&gt;</span>
<span class="tok-nt">&lt;/dataOutputAssociation&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用更简单明了的简化方法。'sourceRef&#8217;是条目定义的参数，'targetRef&#8217;元素是Flowable变量名。这种方法很简单，与数据输入关联类似：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;dataOutputAssociation&gt;</span>
    <span class="tok-nt">&lt;sourceRef&gt;</span>prettyPrint<span class="tok-nt">&lt;/sourceRef&gt;</span>
    <span class="tok-nt">&lt;targetRef&gt;</span>OutputVariable<span class="tok-nt">&lt;/targetRef&gt;</span>
<span class="tok-nt">&lt;/dataOutputAssociation&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBusinessRuleTask">业务规则任务</h5>
<div class="sect5">
<h6 id="bpmnBusinessRuleTaskDescription">描述</h6>
<div class="paragraph">
<p>业务规则任务（business rule task）用于同步地执行一条或多条规则。Flowable使用名为Drools Expert的Drools规则引擎执行业务规则。目前，业务规则中包含的.drl文件，必须与定义了业务规则服务并执行规则的流程定义一起部署。这意味着流程中使用的所有.drl文件都需要打包在流程BAR文件中，与任务表单等类似。要了解如何为Drools Expert创建业务规则，请访问位于<a href="http://www.jboss.org/drools/documentation">JBoss Drools</a>的Drools文档。</p>
</div>
<div class="paragraph">
<p>如果想要使用自己的规则任务实现，比如希望通过不同方法使用Drools，或者想使用完全不同的规则引擎，则可以使用BusinessRuleTask的class或expression属性。这样它会与<a href="#bpmnJavaServiceTask">服务任务</a>的行为完全相同。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnBusinessRuleTaskGraphicalNotation">图示</h6>
<div class="paragraph">
<p>业务规则任务显示为带有表格图标的圆角矩形。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.business.rule.task.png" alt="bpmn.business.rule.task">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnBusinessRuleTaskXML">XML表示</h6>
<div class="paragraph">
<p>要执行与流程定义在同一个BAR文件中部署的一条或多条业务规则，需要定义输入与结果变量。输入变量可以用流程变量的列表定义，使用逗号分隔。输出变量只能有一个变量名，将执行业务规则后的输出对象存储至流程变量。请注意结果变量会包含对象的List。如果没有指定结果变量名，默认为org.flowable.engine.rules.OUTPUT。</p>
</div>
<div class="paragraph">
<p>下面的业务规则任务，执行与流程定义一起部署的所有业务规则：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;simpleBusinessRuleProcess&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;businessRuleTask&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;businessRuleTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;businessRuleTask&quot;</span> <span class="tok-na">flowable:ruleVariablesInput=</span><span class="tok-s">&quot;${order}&quot;</span>
      <span class="tok-na">flowable:resultVariable=</span><span class="tok-s">&quot;rulesOutput&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;businessRuleTask&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以将业务规则任务配置为只执行部署的.drl文件中的一组规则。要做到这一点，需要指定规则名字的列表，用逗号分隔。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-nt">&lt;businessRuleTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;businessRuleTask&quot;</span> <span class="tok-na">flowable:ruleVariablesInput=</span><span class="tok-s">&quot;${order}&quot;</span>
      <span class="tok-na">flowable:rules=</span><span class="tok-s">&quot;rule1, rule2&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样只会执行rule1与rule2。</p>
</div>
<div class="paragraph">
<p>也可以定义需要从执行中排除的规则列表。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-nt">&lt;businessRuleTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;businessRuleTask&quot;</span> <span class="tok-na">flowable:ruleVariablesInput=</span><span class="tok-s">&quot;${order}&quot;</span>
      <span class="tok-na">flowable:rules=</span><span class="tok-s">&quot;rule1, rule2&quot;</span> <span class="tok-na">exclude=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这个例子中，除了rule1与rule2之外，其它所有与流程定义一起部署在同一个BAR文件中的规则都会被执行。</p>
</div>
<div class="paragraph">
<p>前面提到过，还可以自行指定BusinessRuleTask的实现：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;businessRuleTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;businessRuleTask&quot;</span> <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;${MyRuleServiceDelegate}&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样配置的业务规则任务与服务任务的行为完全一样，但仍保持业务规则任务的图标，代表在这里处理业务规则。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnEmailTask">邮件任务</h5>
<div class="paragraph">
<p>Flowable让你可以通过自动的邮件服务任务（email task），增强业务流程。可以向一个或多个收信人发送邮件，支持cc，bcc，HTML文本，等等。请注意邮件任务<strong>不是</strong>BPMN 2.0规范的“官方”任务（所以也没有专用图标）。因此，在Flowable中，邮件任务实现为一种特殊的服务任务。</p>
</div>
<div class="sect5">
<h6 id="bpmnEmailTaskServerConfiguration">配置邮件服务器</h6>
<div class="paragraph">
<p>Flowable引擎使用支持SMTP的外部邮件服务器发送邮件。为了发送邮件，引擎需要了解如何连接邮件服务器。可以在<em>flowable.cfg.xml</em>配置文件中设置下面的参数：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填?</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailServerHost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件服务器的主机名（如mail.mycorp.com）。默认为<code>localhost</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailServerPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是，如果不使用默认端口</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件服务器的SMTP端口。默认值为<em>25</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailServerDefaultFrom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若用户没有提供地址，默认使用的邮件发件人地址。默认为<em>flowable@localhost</em>_</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailServerUsername</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若服务器需要</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部分邮件服务器发信时需要进行认证。默认为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailServerPassword</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若服务器需要</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部分邮件服务器发信时需要进行认证。默认为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailServerUseSSL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若服务器需要</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部分邮件服务器要求ssl通信。默认设置为false。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailServerUseTLS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若服务器需要</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部分邮件服务器要求TLS通信（例如gmail）。默认设置为false。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="bpmnEmailTaskUsage">定义邮件任务</h6>
<div class="paragraph">
<p>邮件任务实现为特殊的<a href="#bpmnJavaServiceTask">服务任务</a>，将服务任务的<em>type</em>定义为<em>'mail'</em>进行设置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sendMail&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;mail&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>邮件任务通过<a href="#serviceTaskFieldInjection">字段注入</a>配置。这些参数的值可以使用EL表达式，并将在流程执行运行时解析。可以设置下列参数：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填?</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件的收信人。可以使用逗号分隔的列表定义多个接收人</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">from</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件的发信人地址。如果不设置，会使用<a href="#bpmnEmailTaskServerConfiguration">默认配置</a>的地址</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">subject</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件的主题</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件的抄送人。可以使用逗号分隔的列表定义多个接收人</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bcc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件的密送人。可以使用逗号分隔的列表定义多个接收人</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">charset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可以指定邮件的字符集，对许多非英语语言很必要。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">html</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件的HTML文本</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件的内容，用于纯文本邮件。对于不支持富文本内容的客户端，可以与<em>html</em>一起使用。邮件客户端可以回退为显式纯文本格式。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">htmlVar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">存储邮件HTML内容的流程变量名。与<em>html</em>参数的最大区别，是这个参数会在邮件任务发送前，使用其内容进行表达式替换。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">textVar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">存储邮件纯文本内容的流程变量名。与<em>text</em>参数的最大区别，是这个参数会在邮件任务发送前，使用其内容进行表达式替换。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ignoreException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">处理邮件失败时，是忽略还是抛出FlowableException。默认设置为false。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">exceptionVariableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果设置<em>ignoreException = true</em>，而处理邮件失败时，则使用给定名字的变量保存失败信息</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="bpmnEmailTaskExampleUsage">示例 usage</h6>
<div class="paragraph">
<p>下面的XML代码片段是使用邮件任务的示例。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sendMail&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;mail&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;from&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;order-shipping@thecompany.com&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;to&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${recipient}&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;subject&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;Your order ${orderId} has been shipped&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;html&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:expression&gt;</span>
        <span class="tok-cp">&lt;![CDATA[</span>
<span class="tok-cp">          &lt;html&gt;</span>
<span class="tok-cp">            &lt;body&gt;</span>
<span class="tok-cp">              Hello ${male ? &#39;Mr.&#39; : &#39;Mrs.&#39; } ${recipientName},&lt;br/&gt;&lt;br/&gt;</span>

<span class="tok-cp">              As of ${now}, your order has been &lt;b&gt;processed and shipped&lt;/b&gt;.&lt;br/&gt;&lt;br/&gt;</span>

<span class="tok-cp">              Kind regards,&lt;br/&gt;</span>

<span class="tok-cp">              TheCompany.</span>
<span class="tok-cp">            &lt;/body&gt;</span>
<span class="tok-cp">          &lt;/html&gt;</span>
<span class="tok-cp">        ]]&gt;</span>
      <span class="tok-nt">&lt;/flowable:expression&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnHttpTask">Http任务</h5>
<div class="paragraph">
<p>Http任务（Http task）用于发出HTTP请求，增强了Flowable的集成能力。请注意Http任务不是BPMN 2.0规范的“官方”任务（所以也没有专用图标）。因此，在Flowable中，Http任务实现为一种特殊的服务任务。</p>
</div>
<div class="sect5">
<h6 id="bpmnHttpTaskClientConfiguration">配置Http客户端</h6>
<div class="paragraph">
<p>Flowable使用可配置的Http客户端发出Http请求。如果不进行设置，会使用默认配置。</p>
</div>
<div class="paragraph">
<p>示例配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span>  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span>
        <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-c">&lt;!-- http客户端配置 --&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;httpClientConfig&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;httpClientConfig&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;httpClientConfig&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.cfg.HttpClientConfig&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;connectTimeout&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;5000&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;socketTimeout&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;5000&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;connectionRequestTimeout&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;5000&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestRetryLimit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;5&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填?</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接超时时间，以毫秒计。<br>
默认值 5000。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">socketTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Socket超时时间，以毫秒计。<br>
默认值 5000。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionRequestTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求连接超时时间。以毫秒计<br>
默认值 5000。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestRetryLimit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求重试次数（“0”代表不重试）<br>
默认值 3。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disableCertVerify</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">禁用SSL证书验证。<br>
默认值 false。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="bpmnHttpTaskUsage">定义Http任务</h6>
<div class="paragraph">
<p>Http任务实现为特殊的<a href="#bpmnJavaServiceTask">服务任务</a>，将服务任务的<em>type</em>定义为<em>'http'</em>进行设置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;httpGet&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;http&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用自定义的实现，覆盖Http任务的默认行为。
需要扩展org.flowable.http.HttpActivityBehavior，并覆盖perform()方法。</p>
</div>
<div class="paragraph">
<p>需要在任务定义中设置<em>httpActivityBehaviorClass</em>字段（默认值为 <em>org.flowable.http.impl.HttpActivityBehaviorImpl</em>）。</p>
</div>
<div class="paragraph">
<p>当前使用的默认实现<em>HttpActivityBehaviorImpl</em>基于Apache Http Client。尽管Apache Http Client可以使用很多方法自定义，但我们并没有在Http客户端配置中使用全部选项。</p>
</div>
<div class="paragraph">
<p>参考 <a href="http://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/impl/client/HttpClientBuilder.html">Http Client builder</a> 创建自定义客户端。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;serviceTask id="httpGet" flowable:type="http"&gt;
  &lt;extensionElements&gt;
    &lt;flowable:field name="httpActivityBehaviorClass"&gt;
        &lt;flowable:string&gt;
          &lt;![CDATA[org.example.flowable.HttpActivityBehaviorCustomImpl]]&gt;
        &lt;/flowable:string&gt;
    &lt;/flowable:field&gt;
  &lt;/extensionElements&gt;
&lt;/sericeTask&gt;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnHttpTaskConfiguration">配置Http任务</h6>
<div class="paragraph">
<p>Http任务通过<a href="#serviceTaskFieldInjection">字段注入</a>配置。所有参数都可以配置为EL表达式，在运行时进行解析。可以设置下列参数：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填?</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestMethod</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求方法<br>
（GET,POST,PUT,DELETE）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求URL<br>
（例如 - <a href="http://flowable.org）。" class="bare">http://flowable.org）。</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestHeaders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">行分隔的Http请求头。<br>
例如 -<br>
Content-Type: application/json<br>
Authorization: Basic aGFRlc3Q=</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestBody</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求体<br>
例如 - ${sampleBody}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求超时时间。单位为毫秒<br>
（例如 - 5000）。<br>
默认值为“0”，即没有超时。<br>
链接相关的超时设置为<a href="#bpmnHttpTaskClientConfiguration">配置Http客户端</a>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disallowRedirects</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否禁用Http重定向。<br>
默认为false。<br>
（例如 - true）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">failStatusCodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">逗号分隔的Http状态码，将令请求失败并抛出FlowableException。<br>
例如：400, 404, 500, 503<br>
例如：400, 5XX</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">handleStatusCodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">逗号分隔的Http状态码，将令任务抛出BpmnError，并可用错误边界事件捕获。<br>
BpmnError的错误码为<em>HTTP&lt;statuscode&gt;</em>。<br>
例如，404状态码会将错误码设置为<em>HTTP404</em>。<br>
仅当<em>disallowRedirects</em>字段设置为true时，3XX状态码才会被抛出。若同一个状态码在<em>handleStatusCodes</em>及<em>failStatusCodes</em>中都有配置，则<em>handleStatusCodes</em>生效。<br>
例如：400, 404, 500, 503<br>
例如：3XX, 4XX, 5XX<br></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ignoreException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否忽略异常。异常将被捕获，并存储在名为<em>&lt;taskId&gt;.errorMessage</em>的变量中。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">saveRequestVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否保存请求变量。<br>
默认情况下，只会保存将响应相关的变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">saveResponseParameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否保存全部的响应变量，包括HTTP状态码，响应头等。<br>
默认情况下，只会将响应体保存为变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resultVariablePrefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">执行变量名的前缀。<br>
如果不设置前缀，变量名为<em>&lt;taskId&gt;.fieldName</em>。<br>
例如，对于id为<em>task7</em>的任务，其请求URL将保存为<em>task7.requestUrl</em>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">saveResponseParametersTransient</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若为true，则会将响应体变量（如果设置了保存响应头，状态码，也包括在内）设置为瞬时变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">saveResponseVariableAsJson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若为true，则响应体会保存为JSON变量，而非String。如果HTTP服务返回JSON，并且想使用点注记方式使用字段（如<em>myResponse.user.name</em>），这个配置就很有用。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">httpActivityBehaviorClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.flowable.http.HttpActivityBehavior类的自定义扩展的全限定类名。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>除了上面提到的字段，使用<em>saveResponseParameters</em>还会在执行成功后设置下列变量。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">变量</th>
<th class="tableblock halign-left valign-top">可选？</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">responseProtocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Http版本。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">responseReason</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Http响应原因短语。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">responseStatusCode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Http响应状态码（例如 - 200）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">responseHeaders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">行分隔的Http响应头。<br>
例如 -<br>
Content-Type: application/json<br>
Content-Length: 777</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">responseBody</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串形式的响应体，若有。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">errorMessage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">被忽略的异常信息，若有。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_result_variables">结果变量</h6>
<div class="paragraph">
<p>请注意上述执行变量名都会使用<em>resultVariablePrefix</em>前缀。
例如，可以在其他活动中，使用<em>task7.responseStatusCode</em>获取响应状态码。
其中<em>task7</em>是服务任务的<em>id</em>。可以设置<em>resultVariablePrefix</em>覆盖这个行为。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnHttpTaskExampleUsage">示例</h6>
<div class="paragraph">
<p>下面的XML片段是使用Http任务的例子。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;httpGet&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;http&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestMethod&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;GET&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestUrl&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;http://flowable.org&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestHeaders&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:expression&gt;</span>
        <span class="tok-cp">&lt;![CDATA[</span>
<span class="tok-cp">          Accept: text/html</span>
<span class="tok-cp">          Cache-Control: no-cache</span>
<span class="tok-cp">        ]]&gt;</span>
      <span class="tok-nt">&lt;/flowable:expression&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestTimeout&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:expression&gt;</span>
        <span class="tok-cp">&lt;![CDATA[</span>
<span class="tok-cp">          ${requestTimeout}</span>
<span class="tok-cp">        ]]&gt;</span>
      <span class="tok-nt">&lt;/flowable:expression&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resultVariablePrefix&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:string&gt;</span>task7<span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnHttpTaskErrorHandling">错误处理</h6>
<div class="paragraph">
<p>默认情况下，当发生链接、IO或其他未处理的异常时，Http任务抛出FlowableException。
默认情况下，不会处理任何重定向/客户端/服务端错误状态码。</p>
</div>
<div class="paragraph">
<p>可以设置<em>failStatusCodes</em>及/或<em>handleStatusCodes</em>字段，配置Http任务处理异常及Http状态的方式。参见<a href="#bpmnHttpTaskConfiguration">配置Http任务</a>。</p>
</div>
<div class="paragraph">
<p>由<em>handleStatusCodes</em>抛出的BpmnError与其他BPMN异常一样，需要由对应的错误边界事件处理。
下面是一些Http任务错误处理及重试的例子。</p>
</div>
<div class="sect6">
<h7 id="_400及5xx失败异步执行并按照failedjobretrytimecycle重试的http任务"><em>400</em>及5XX失败，异步执行，并按照failedJobRetryTimeCycle重试的Http任务</h7>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;failGet&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Fail test&quot;</span> <span class="tok-na">flowable:async=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;http&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestMethod&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:string&gt;</span><span class="tok-cp">&lt;![CDATA[GET]]&gt;</span><span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestUrl&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:string&gt;</span><span class="tok-cp">&lt;![CDATA[http://localhost:9798/api/fail]]&gt;</span><span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;failStatusCodes&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:string&gt;</span><span class="tok-cp">&lt;![CDATA[400, 5XX]]&gt;</span><span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;flowable:failedJobRetryTimeCycle&gt;</span>R3/PT5S<span class="tok-nt">&lt;/flowable:failedJobRetryTimeCycle&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_将400处理为bmpnerror">将<em>400</em>处理为BmpnError</h7>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;handleGet&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;HTTP Task&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;http&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestMethod&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:string&gt;</span><span class="tok-cp">&lt;![CDATA[GET]]&gt;</span><span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestUrl&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:string&gt;</span><span class="tok-cp">&lt;![CDATA[http://localhost:9798/api/fail]]&gt;</span><span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;handleStatusCodes&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:string&gt;</span><span class="tok-cp">&lt;![CDATA[4XX]]&gt;</span><span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
<span class="tok-nt">&lt;boundaryEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;catch400&quot;</span> <span class="tok-na">attachedToRef=</span><span class="tok-s">&quot;handleGet&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;errorEventDefinition</span> <span class="tok-na">errorRef=</span><span class="tok-s">&quot;HTTP400&quot;</span><span class="tok-nt">&gt;&lt;/errorEventDefinition&gt;</span>
<span class="tok-nt">&lt;/boundaryEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_忽略异常">忽略异常</h7>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;ignoreTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Fail test&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;http&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestMethod&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:string&gt;</span><span class="tok-cp">&lt;![CDATA[GET]]&gt;</span><span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestUrl&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:string&gt;</span><span class="tok-cp">&lt;![CDATA[http://nohost:9798/api]]&gt;</span><span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;ignoreException&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:string&gt;</span><span class="tok-cp">&lt;![CDATA[true]]&gt;</span><span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_异常映射">异常映射</h7>
<div class="paragraph">
<p>参见<a href="#exceptionMapping">异常映射</a></p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnMuleTask">Mule任务</h5>
<div class="paragraph">
<p>Mule任务可以向Mule发送消息，增强Flowable的集成特性。请注意Mule任务<strong>不是</strong>BPMN 2.0规范的“官方”任务（所以也没有专用图标）。因此，在Flowable中，Mule任务实现为一种特殊的服务任务。</p>
</div>
<div class="sect5">
<h6 id="bpmnMuleTaskUsage">定义Mule任务</h6>
<div class="paragraph">
<p>Mule任务实现为特殊的<a href="#bpmnJavaServiceTask">服务任务</a>，将服务任务的<em>type</em>定义为<em>'mule'</em>进行设置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sendMule&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;mule&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mule任务通过<a href="#serviceTaskFieldInjection">字段注入</a>配置。这些参数的值可以使用EL表达式，将在流程执行运行时解析。可以设置下列参数：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填?</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">endpointUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">希望调用的Mule端点（endpoint）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">language</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">计算payloadExpression字段所用的语言。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">payloadExpression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">消息载荷的表达式。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resultVariable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">存储调用结果的变量名。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="bpmnMuleTaskExampleUsage">示例</h6>
<div class="paragraph">
<p>下面的XML代码片段是使用Mule任务的例子。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-nt">&lt;extensionElements&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;endpointUrl&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;flowable:string&gt;</span>vm://in<span class="tok-nt">&lt;/flowable:string&gt;</span>
  <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;language&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;flowable:string&gt;</span>juel<span class="tok-nt">&lt;/flowable:string&gt;</span>
  <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;payloadExpression&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;flowable:string&gt;</span>&quot;hi&quot;<span class="tok-nt">&lt;/flowable:string&gt;</span>
  <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resultVariable&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;flowable:string&gt;</span>theVariable<span class="tok-nt">&lt;/flowable:string&gt;</span>
  <span class="tok-nt">&lt;/flowable:field&gt;</span>
<span class="tok-nt">&lt;/extensionElements&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCamelTask">Camel任务</h5>
<div class="paragraph">
<p>Camel任务（Camel task）可以向Camel发送消息，增强Flowable的集成特性。请注意Camel任务<strong>不是</strong>BPMN 2.0规范的“官方”任务（所以也没有专用图标）。因此，在Flowable中，Camel任务实现为一种特殊的服务任务。还请注意，需要在项目中包含Flowable Camel模块才能使用Camel任务。</p>
</div>
<div class="sect5">
<h6 id="bpmnCamelTaskUsage">定义Camel任务</h6>
<div class="paragraph">
<p>Camel任务实现为特殊的<a href="#bpmnJavaServiceTask">服务任务</a>，将服务任务的<em>type</em>定义为<em>'camel'</em>进行设置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sendCamel&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;camel&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>只需要在流程定义的服务任务上定义Camel类型即可。集成逻辑都通过Camel容器委托。默认情况下Flowable引擎在Spring容器中查找camelContext Bean。camelContext Bean定义由Camel容器装载的Camel路由。在下面的例子中，按照指定的Java包装载路由。但也可以自行在Spring配置中直接定义路由。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;camelContext</span> <span class="tok-na">id=</span><span class="tok-s">&quot;camelContext&quot;</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://camel.apache.org/schema/spring&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;packageScan&gt;</span>
    <span class="tok-nt">&lt;package&gt;</span>org.flowable.camel.route<span class="tok-nt">&lt;/package&gt;</span>
  <span class="tok-nt">&lt;/packageScan&gt;</span>
<span class="tok-nt">&lt;/camelContext&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以在<a href="http://camel.apache.org/">Camel网站</a>找到关于Camel路由的更多文档。下面只通过几个小例子展示基本概念。在第一个例子中，在Flowable工作流中进行最简单的Camel调用。叫做SimpleCamelCall。</p>
</div>
<div class="paragraph">
<p>如果想要定义多个Camel上下文Bean，或想使用不同的Bean名字，可以在Camel任务定义中像这样覆盖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceTask1&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;camel&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;camelContext&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;customCamelContext&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnCamelTaskSimpleCamelCall">简单Camel调用示例</h6>
<div class="paragraph">
<p>这个例子相关的所有文件，都可以在flowable-camel模块的org.flowable.camel.examples.simpleCamelCall包中找到。目标是简单地启动一个Camel路由。首先需要一个配置了上面提到的路由的Spring上下文。下面的代码实现这个目的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;camelContext</span> <span class="tok-na">id=</span><span class="tok-s">&quot;camelContext&quot;</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://camel.apache.org/schema/spring&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;packageScan&gt;</span>
    <span class="tok-nt">&lt;package&gt;</span>org.flowable.camel.examples.simpleCamelCall<span class="tok-nt">&lt;/package&gt;</span>
  <span class="tok-nt">&lt;/packageScan&gt;</span>
<span class="tok-nt">&lt;/camelContext&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SimpleCamelCallRoute</span> <span class="tok-kd">extends</span> <span class="tok-n">RouteBuilder</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">configure</span><span class="tok-o">()</span> <span class="tok-kd">throws</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
    <span class="tok-n">from</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable:SimpleCamelCallProcess:simpleCall&quot;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s">&quot;log:org.flowable.camel.examples.SimpleCamelCall&quot;</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>路由只是记录消息体，不做更多事情。请注意from端点（endpoint）的格式，包含冒号分隔的三个部分：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">端点URL部分</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指向引擎端点</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SimpleCamelCallProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">simpleCall</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程中Camel服务的名字</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>现在已经配置好路由，可以访问Camel。下面需要像这样定义工作流：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;SimpleCamelCallProcess&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;start&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;simpleCall&quot;</span><span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;simpleCall&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;camel&quot;</span><span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;simpleCall&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;end&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;end&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnCamelTaskPingPong">连通性测试示例</h6>
<div class="paragraph">
<p>示例已经可以工作，但实际上Camel与Flowable之间并没有通信，因此没有太多价值。在这个例子里，将试着从Camel接收与发送消息。我们将发送一个字符串，Camel在其上附加一些文字并返回作为结果。发送部分比较普通，即以变量的格式将信息发送给Camel服务。这是我们的调用代码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-nd">@Deployment</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testPingPong</span><span class="tok-o">()</span> <span class="tok-o">{</span>
  <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">variables</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;();</span>

  <span class="tok-n">variables</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;input&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Hello&quot;</span><span class="tok-o">);</span>
  <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">outputMap</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">String</span><span class="tok-o">&gt;();</span>
  <span class="tok-n">variables</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;outputMap&quot;</span><span class="tok-o">,</span> <span class="tok-n">outputMap</span><span class="tok-o">);</span>

  <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;PingPongProcess&quot;</span><span class="tok-o">,</span> <span class="tok-n">variables</span><span class="tok-o">);</span>
  <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-n">outputMap</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">());</span>
  <span class="tok-n">assertNotNull</span><span class="tok-o">(</span><span class="tok-n">outputMap</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-s">&quot;outputValue&quot;</span><span class="tok-o">));</span>
  <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Hello World&quot;</span><span class="tok-o">,</span> <span class="tok-n">outputMap</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-s">&quot;outputValue&quot;</span><span class="tok-o">));</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>“input”变量是实际上是Camel路由的输入，而outputMap用于捕获Camel传回的结果。流程像是这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;PingPongProcess&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;start&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;ping&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;ping&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;camel&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;ping&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;saveOutput&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;saveOutput&quot;</span> <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;org.flowable.camel.examples.pingPong.SaveOutput&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow3&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;saveOutput&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;end&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;end&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意SaveOutput服务任务会从上下文中取出“Output”变量，并存储至上面提到的OutputMap。现在需要了解变量如何发送至Camel，以及如何返回。这就需要了解Camel行为（Behavior）的概念。变量与Camel通信的方式可以通过CamelBehavior配置。在这个例子里使用默认配置，其它配置在后面会进行简短介绍。可以使用类似的代码配置期望的Camel行为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceTask1&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;camel&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;camelBehaviorClass&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;org.flowable.camel.impl.CamelBehaviorCamelBodyImpl&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果不指定行为，则会设置为org.flowable.camel.impl.CamelBehaviorDefaultImpl。这个行为会将变量复制到相同名字的Camel参数。无论选择什么行为，对于返回值：如果Camel消息体是一个map，则其中的每个元素都将复制为变量；否则整个对象将复制为名为"camelBody"的特定变量。以第二个例子作为Camel路由的总结：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">configure</span><span class="tok-o">()</span> <span class="tok-kd">throws</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
  <span class="tok-n">from</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable:PingPongProcess:ping&quot;</span><span class="tok-o">).</span><span class="tok-na">transform</span><span class="tok-o">().</span><span class="tok-na">simple</span><span class="tok-o">(</span><span class="tok-s">&quot;${property.input} World&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个路由中，字符串"world"会在结尾连接上名为“input”的参数，并将结果作为消息体返回。可以通过Java服务任务访问"camelBody"变量。也可以访问“outputMap”获取。除了这个例子中使用的默认行为之外，我们还可以看看其他的方式。在每个Camel路由开始时，流程实例ID会复制为名为"PROCESS_ID_PROPERTY"的Camel参数。之后会用于将流程实例与Camel路由相关联。也可以在Camel路由中直接使用。</p>
</div>
<div class="paragraph">
<p>Flowable提供了三种不同的行为。可以通过修改路由URL中特定的部分覆写行为。这里有个在URL中覆写已有行为的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">from</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable:asyncCamelProcess:serviceTaskAsync2?copyVariablesToProperties=true&quot;</span><span class="tok-o">).</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>下表展示了三种可用的Camel行为：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">行为</th>
<th class="tableblock halign-left valign-top">URL中</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CamelBehaviorDefaultImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyVariablesToProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">将Flowable变量复制为Camel参数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CamelBehaviorCamelBodyImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyCamelBodyToBody</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只将名为"camelBody"的Flowable变量复制为Camel消息体。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CamelBehaviorBodyAsMapImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyVariablesToBodyAsMap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">将一个map中的所有Flowable变量复制为Camel消息体。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>上表展示了Flowable变量如何传递给Camel。下表展示Camel变量如何返回至Flowable。需要在路由URL中进行配置。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">URL</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果Camel消息体是一个map，则将其中每一对象复制为Flowable变量；否则将整个Camel消息体复制为"camelBody" Flowable变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyVariablesFromProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">将Camel参数以同名复制为Flowable变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyCamelBodyToBodyAsString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">与default相同，但如果Camel消息体不是map，则首先将其转换为字符串，然后再复制为"camelBody"。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyVariablesFromHeader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">额外地，将Camel头复制为Flowable的同名变量。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_returning_back_the_variables">返回变量</h6>
<div class="paragraph">
<p>上面提到的变量传递，不论是从Camel到Flowable还是反向，都只用于变量传递的起始侧。
要特别注意，由于Flowable的行为是非阻塞的，Flowable不会自动向Camel返回变量。
为此提供了特殊的语法。可以在Camel路由URL中，以<code>var.return.someVariableName</code>的格式，指定一个或多个参数。与这些参数同名（但没有<code>var.return</code>部分）的变量会作为输出变量。因此将会以相同的名字复制回Camel参数。<br>
例如在如下路由中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>from("direct:start").to("flowable:process?var.return.exampleVar").to("mock:result");</pre>
</div>
</div>
<div class="paragraph">
<p>名为<code>exampleVar</code>的Flowable变量会作为输出变量。因此会以同名复制回Camel参数。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnCamelTaskAsyncPingPong">异步连通性测试示例</h6>
<div class="paragraph">
<p>上面的例子全都是同步的。流程实例等待，直到Camel路由结束并返回。有时，需要Flowable流程实例继续运行。这时可以使用Camel服务任务的异步功能。可以将Camel服务任务的<em>async</em>参数设置为true，启用这个功能。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceAsyncPing&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;camel&quot;</span> <span class="tok-na">flowable:async=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>设置这个参数后，Camel路由会由Flowable作业执行器异步启动。如果在Camel路由中定义了队列，Flowable流程实例会继续执行流程定义中Camel服务任务之后的活动。Camel路由会与流程执行完全异步地执行。如果需要在流程定义的某处等待Camel服务任务的响应，可以使用接收任务（receive task）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;receiveTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;receiveAsyncPing&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Wait State&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>流程实例会等待，直到接收到来自Camel的信号。可以在Camel中向特定的Flowable端点发送消息，来为流程实例发送信号。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span> <span class="tok-n">from</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable:asyncPingProcess:serviceAsyncPing&quot;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable:asyncPingProcess:receiveAsyncPing&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>“flowable”字符串常量</p>
</li>
<li>
<p>流程名</p>
</li>
<li>
<p>接收任务名</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="bpmnCamelInstantiateWorkflowFromCamelRoute">使用Camel路由实例化工作流</h6>
<div class="paragraph">
<p>上面的例子都是先启动Flowable流程实例，然后在流程实例中启动Camel路由。也可以反过来，在已经启动的Camel路由中启动或调用流程实例。类似于为接收任务发送消息。例如，一个简单的路由：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">from</span><span class="tok-o">(</span><span class="tok-s">&quot;direct:start&quot;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable:camelProcess&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以看到，URL包含两部分：第一部分是“flowable”字符串常量，第二部分是流程定义的名字。当然，需要提前在Flowable引擎中部署这个流程定义。</p>
</div>
<div class="paragraph">
<p>也可以在Camel头中，将流程实例起动人设置为某个已认证用户ID。为此，首先需要在流程定义中指定启动人变量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-na">flowable:initiator=</span><span class="tok-s">&quot;initiator&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>然后使用Camel头<em>CamelProcessInitiatorHeader</em>指定用户ID。Camel路由定义如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-n">from</span><span class="tok-o">(</span><span class="tok-s">&quot;direct:startWithInitiatorHeader&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">setHeader</span><span class="tok-o">(</span><span class="tok-s">&quot;CamelProcessInitiatorHeader&quot;</span><span class="tok-o">,</span> <span class="tok-n">constant</span><span class="tok-o">(</span><span class="tok-s">&quot;kermit&quot;</span><span class="tok-o">))</span>
    <span class="tok-o">.</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable:InitiatorCamelCallProcess?processInitiatorHeaderName=CamelProcessInitiatorHeader&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnManualTask">手动任务</h5>
<div class="sect5">
<h6 id="bpmnManualTaskDescription">描述</h6>
<div class="paragraph">
<p><em>手动任务（manual task）</em>定义在BPM引擎之外的任务。它用于建模引擎不需要了解，也不需要提供系统或用户界面的工作。对于引擎来说，手动任务将按<strong>直接穿过活动</strong>处理，在流程执行到达手动任务时，自动继续执行流程。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnManualTaskGraphicalNotation">图示</h6>
<div class="paragraph">
<p>手动任务用左上角有一个小“手”图标的标准BPMN 2.0任务（圆角矩形）表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.manual.task.png" alt="bpmn.manual.task">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnManualTaskXml">XML表示</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;manualTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myManualTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Call client for more information&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnReceiveTask">Java接收任务</h5>
<div class="sect5">
<h6 id="bpmnReceiveTaskDescription">描述</h6>
<div class="paragraph">
<p>接收任务（receive task），是等待特定消息到达的简单任务。目前，我们只为这个任务实现了Java语义。当流程执行到达接收任务时，流程状态将提交至持久化存储。这意味着流程将保持等待状态，直到引擎接收到特定的消息，触发流程穿过接收任务继续执行。</p>
</div>
</div>
<div class="sect5">
<h6 id="_graphical_notation_2">图示</h6>
<div class="paragraph">
<p>接收任务用左上角有一个消息图标的标准BPMN 2.0任务（圆角矩形）表示。消息图标是白色的（对应的黑色消息图标代表发送的含义）。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.receive.task.png" alt="bpmn.receive.task">
</div>
</div>
</div>
<div class="sect5">
<h6 id="_xml_representation_2">XML表示</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;receiveTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;waitState&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;wait&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>要使流程实例从接收任务的等待状态中继续执行，需要使用到达接收任务的执行id，调用<em>runtimeService.signal(executionId)</em>。下面的代码片段展示了如何操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-n">ProcessInstance</span> <span class="tok-n">pi</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;receiveTask&quot;</span><span class="tok-o">);</span>
<span class="tok-n">Execution</span> <span class="tok-n">execution</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createExecutionQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">processInstanceId</span><span class="tok-o">(</span><span class="tok-n">pi</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
  <span class="tok-o">.</span><span class="tok-na">activityId</span><span class="tok-o">(</span><span class="tok-s">&quot;waitState&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
<span class="tok-n">assertNotNull</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">);</span>

<span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">trigger</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnShellTask">Shell任务</h5>
<div class="sect5">
<h6 id="bpmnShellTaskDescription">描述</h6>
<div class="paragraph">
<p>Shell任务（Shell task）可以运行Shell脚本与命令。请注意Shell任务<strong>不是</strong>BPMN 2.0规范的“官方”任务（因此也没有专用图标）。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnShellTaskUsage">定义Shell任务</h6>
<div class="paragraph">
<p>Shell任务实现为特殊的<a href="#bpmnJavaServiceTask">服务任务</a>，将服务任务的<em>type</em>定义为<em>'shell'</em>进行设置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;shellEcho&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;shell&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Shell任务通过<a href="#serviceTaskFieldInjection">字段注入</a>配置。这些参数的值可以使用EL表达式，将在流程执行运行时解析。可以设置下列参数：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填?</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">command</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要执行的Shell命令。</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">arg1-5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参数1至参数5</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wait</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true/false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否等待Shell进程终止。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">redirectError</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true/false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否将标准错误（standard error）并入标准输出（standard output）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cleanEnv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true/false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否避免Shell进程继承当前环境。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outputVariable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">保存输出的变量名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不会记录输出。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">errorCodeVariable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">保存结果错误码的变量名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不会记录错误码。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shell进程的默认目录</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当前目录</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="bpmnShellTaskExampleUsage">示例</h6>
<div class="paragraph">
<p>下面的XML代码片段是使用Shell任务的例子。将会运行"cmd /c echo EchoTest" Shell脚本，等待其结束，并将其结果存入<em>resultVar</em>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;shellEcho&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;shell&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;command&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;cmd&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;arg1&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;/c&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;arg2&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;echo&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;arg3&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;EchoTest&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;wait&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;outputVariable&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;resultVar&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="executionListeners">执行监听器</h5>
<div class="paragraph">
<p>执行监听器（execution listener）可以在流程执行中发生特定的事件时，执行外部Java代码或计算表达式。可以被捕获的事件有：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>流程实例的启动和结束。</p>
</li>
<li>
<p>流程执行转移。</p>
</li>
<li>
<p>活动的启动和结束。</p>
</li>
<li>
<p>网关的启动和结束。</p>
</li>
<li>
<p>中间事件的启动和结束。</p>
</li>
<li>
<p>启动事件的结束，和结束事件的启动。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>下面的流程定义包含了三个执行监听器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;executionListenersProcess&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:executionListener</span>
      <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.examples.bpmn.executionlistener.ExampleExecutionListenerOne&quot;</span>
      <span class="tok-na">event=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>

  <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;firstTask&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;firstTask&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;firstTask&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;secondTask&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;extensionElements&gt;</span>
      <span class="tok-nt">&lt;flowable:executionListener</span>
        <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.examples.bpmn.executionListener.ExampleExecutionListenerTwo&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/extensionElements&gt;</span>
  <span class="tok-nt">&lt;/sequenceFlow&gt;</span>

  <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;secondTask&quot;</span> <span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;extensionElements&gt;</span>
      <span class="tok-nt">&lt;flowable:executionListener</span>
        <span class="tok-na">expression=</span><span class="tok-s">&quot;${myPojo.myMethod(execution.event)}&quot;</span>
        <span class="tok-na">event=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/extensionElements&gt;</span>
  <span class="tok-nt">&lt;/userTask&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;secondTask&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;thirdTask&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;thirdTask&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;thirdTask&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>第一个执行监听器将在流程启动时收到通知。这个监听器是一个外部Java类（<code>ExampleExecutionListenerOne</code>），并且需要实现<code>org.flowable.engine.delegate.ExecutionListener</code>接口。当该事件发生时（这里是<code>start</code>事件），会调用<code>notify(ExecutionListenerExecution execution)</code>方法。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ExampleExecutionListenerOne</span> <span class="tok-kd">implements</span> <span class="tok-n">ExecutionListener</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">notify</span><span class="tok-o">(</span><span class="tok-n">ExecutionListenerExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;variableSetInExecutionListener&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;firstValue&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;eventReceived&quot;</span><span class="tok-o">,</span> <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">getEventName</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用实现了<code>org.flowable.engine.delegate.JavaDelegate</code>接口的委托类。这些委托类也可以用于其他的结构，如服务任务的委托。</p>
</div>
<div class="paragraph">
<p>第二个执行监听器在流程执行转移时被调用。请注意<code>listener</code>元素并未定义<code>event</code>，因为在转移上只会触发<code>take</code>事件。<strong>当监听器定义在转移上时，<code>event</code>属性的值将被忽略。</strong></p>
</div>
<div class="paragraph">
<p>最后一个执行监听器在<code>secondTask</code>活动结束时被调用。监听器声明中没有使用<code>class</code>，而是定义了<code>expression</code>。这个表达式将在事件触发时计算/调用。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;flowable:executionListener</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${myPojo.myMethod(execution.eventName)}&quot;</span> <span class="tok-na">event=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>与其他表达式一样，可以使用与解析<em>execution</em>变量。execution对象提供了露事件名参数，可以使用<code>execution.eventName</code>向你的方法传递事件名。</p>
</div>
<div class="paragraph">
<p><a href="#bpmnJavaServiceTaskXML">与服务任务类似</a>，执行监听器也支持使用<code>delegateExpression</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;flowable:executionListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-na">delegateExpression=</span><span class="tok-s">&quot;${myExecutionListenerBean}&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>较早之前，我们也引入了新的执行监听器类型，org.flowable.engine.impl.bpmn.listener.ScriptExecutionListener。这个脚本执行监听器可以为执行监听器事件执行一段脚本代码。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span></span><span class="tok-nt">&lt;flowable:executionListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;start&quot;</span>
    <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.bpmn.listener.ScriptExecutionListener&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;script&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;flowable:string&gt;</span>
      def bar = &quot;BAR&quot;;  // 局部变量
      foo = &quot;FOO&quot;; // 将变量放入执行上下文
      execution.setVariable(&quot;var1&quot;, &quot;test&quot;); // 测试访问执行实例
      bar // 隐式返回值
    <span class="tok-nt">&lt;/flowable:string&gt;</span>
  <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;language&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;groovy&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resultVariable&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;myVar&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;/flowable:executionListener&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="executionListenerFieldInjection">执行监听器上的字段注入</h6>
<div class="paragraph">
<p>使用通过<code>class</code>属性配置的执行监听器时，可以使用字段注入。与<a href="#serviceTaskFieldInjection">服务任务字段注入</a>使用完全相同的机制，可以在那里看到字段注入的各种用法。</p>
</div>
<div class="paragraph">
<p>下面的代码片段展示了一个简单的示例流程，带有一个使用了字段注入的执行监听器。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;executionListenersProcess&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:executionListener</span>
        <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.examples.bpmn.executionListener.ExampleFieldInjectedExecutionListener&quot;</span>
        <span class="tok-na">event=</span><span class="tok-s">&quot;start&quot;</span><span class="tok-nt">&gt;</span>

      <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;fixedValue&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;Yes, I am &quot;</span> <span class="tok-nt">/&gt;</span>
      <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dynamicValue&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${myVar}&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;/flowable:executionListener&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>

  <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;firstTask&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;firstTask&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;firstTask&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ExampleFieldInjectedExecutionListener</span> <span class="tok-kd">implements</span> <span class="tok-n">ExecutionListener</span> <span class="tok-o">{</span>

  <span class="tok-kd">private</span> <span class="tok-n">Expression</span> <span class="tok-n">fixedValue</span><span class="tok-o">;</span>

  <span class="tok-kd">private</span> <span class="tok-n">Expression</span> <span class="tok-n">dynamicValue</span><span class="tok-o">;</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">notify</span><span class="tok-o">(</span><span class="tok-n">ExecutionListenerExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;var&quot;</span><span class="tok-o">,</span> <span class="tok-n">fixedValue</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">).</span><span class="tok-na">toString</span><span class="tok-o">()</span> <span class="tok-o">+</span>
        <span class="tok-n">dynamicValue</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">).</span><span class="tok-na">toString</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ExampleFieldInjectedExecutionListener</code>类将连接两个字段（一个是固定值-fixedValue，另一个是动态值-dynamicValue），并将其存储在'<code>var</code>'流程变量中。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-nd">@Deployment</span><span class="tok-o">(</span><span class="tok-n">resources</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
  <span class="tok-s">&quot;org/flowable/examples/bpmn/executionListener/ExecutionListenersFieldInjectionProcess.bpmn20.xml&quot;</span><span class="tok-o">})</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testExecutionListenerFieldInjection</span><span class="tok-o">()</span> <span class="tok-o">{</span>
  <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">variables</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;();</span>
  <span class="tok-n">variables</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;myVar&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;listening!&quot;</span><span class="tok-o">);</span>

  <span class="tok-n">ProcessInstance</span> <span class="tok-n">processInstance</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span>
      <span class="tok-s">&quot;executionListenersProcess&quot;</span><span class="tok-o">,</span> <span class="tok-n">variables</span><span class="tok-o">);</span>

  <span class="tok-n">Object</span> <span class="tok-n">varSetByListener</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">getVariable</span><span class="tok-o">(</span><span class="tok-n">processInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">(),</span> <span class="tok-s">&quot;var&quot;</span><span class="tok-o">);</span>
  <span class="tok-n">assertNotNull</span><span class="tok-o">(</span><span class="tok-n">varSetByListener</span><span class="tok-o">);</span>
  <span class="tok-n">assertTrue</span><span class="tok-o">(</span><span class="tok-n">varSetByListener</span> <span class="tok-k">instanceof</span> <span class="tok-n">String</span><span class="tok-o">);</span>

  <span class="tok-c1">// 结果为固定注入字段及注入表达式的连接</span>
  <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Yes, I am listening!&quot;</span><span class="tok-o">,</span> <span class="tok-n">varSetByListener</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，与服务任务使用相同的线程安全规则。请阅读<a href="#serviceTaskFieldInjectionThreadSafety">相应章节</a>了解更多信息。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="taskListeners">任务监听器</h5>
<div class="paragraph">
<p><em>任务监听器（task listener）</em>用于在特定的任务相关事件发生时，执行自定义的Java逻辑或表达式。</p>
</div>
<div class="paragraph">
<p>任务监听器只能在流程定义中作为<a href="#bpmnUserTask">用户任务</a>的子元素。请注意，任务监听器是一个Flowable自定义结构，因此也需要作为<em>BPMN 2.0 extensionElements</em>，放在<em>flowable</em>命名空间下。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My Task&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:taskListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;create&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.MyTaskCreateListener&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>任务监听器</em>包含下列属性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>event（事件）</strong>（必填）：触发任务监听器的任务事件类型。可用的事件有：</p>
<div class="ulist">
<ul>
<li>
<p><strong>create（创建）</strong>：当任务已经创建，并且<strong>所有任务参数都已经设置</strong>时触发。</p>
</li>
<li>
<p><strong>assignment（指派）</strong>：当任务已经指派给某人时触发。请注意：当流程执行到达用户任务时，在触发<em>create</em>事件<strong>之前</strong>，会首先触发<em>assignment</em>事件。这顺序看起来不太自然，但是有实际原因的：当收到<em>create</em>事件时，我们通常希望能看到任务的所有参数，包括办理人。</p>
</li>
<li>
<p><strong>complete（完成）</strong>：当任务已经完成，从运行时数据中删除前触发。</p>
</li>
<li>
<p><strong>delete（删除）</strong>：在任务即将被删除前触发。请注意任务由completeTask正常完成时也会触发。</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>class</strong>：需要调用的委托类。这个类必须实现<code>org.flowable.engine.delegate.TaskListener</code>接口。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyTaskCreateListener</span> <span class="tok-kd">implements</span> <span class="tok-n">TaskListener</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">notify</span><span class="tok-o">(</span><span class="tok-n">DelegateTask</span> <span class="tok-n">delegateTask</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-c1">// 这里是要实现的业务逻辑</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用<a href="#serviceTaskFieldInjection">字段注入</a>，为委托类传递流程变量或执行。请注意委托类的实例在流程部署时创建（与Flowable中其它的委托类一样），这意味着该实例会在所有流程实例执行中共享。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>expression</strong>：（不能与<em>class</em>属性一起使用）：指定在事件发生时要执行的表达式。可以为被调用的对象传递<code>DelegateTask</code>对象与事件名（使用<code>task.eventName</code>）作为参数。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-o">&lt;</span><span class="tok-n">flowable</span><span class="tok-o">:</span><span class="tok-n">taskListener</span> <span class="tok-n">event</span><span class="tok-o">=</span><span class="tok-s">&quot;create&quot;</span> <span class="tok-n">expression</span><span class="tok-o">=</span><span class="tok-s">&quot;${myObject.callMethod(task, task.eventName)}&quot;</span> <span class="tok-o">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>delegateExpression</strong>：指定一个能够解析为<code>TaskListener</code>接口实现类的对象的表达式。<a href="#bpmnJavaServiceTaskXML">与服务任务类似</a>。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;flowable:taskListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;create&quot;</span> <span class="tok-na">delegateExpression=</span><span class="tok-s">&quot;${myTaskListenerBean}&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>较早之前，我们也引入了新的执行监听器类型，org.flowable.engine.impl.bpmn.listener.ScriptTaskListener。这个脚本任务监听器可以为一个任务监听器事件执行一段脚本代码。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-nt">&lt;flowable:taskListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;complete&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.bpmn.listener.ScriptTaskListener&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;script&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;flowable:string&gt;</span>
      def bar = &quot;BAR&quot;;  // 局部变量
      foo = &quot;FOO&quot;; // 将变量放入执行上下文
      task.setOwner(&quot;kermit&quot;); // 测试访问任务实例
      bar // 隐式返回值
    <span class="tok-nt">&lt;/flowable:string&gt;</span>
  <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;language&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;groovy&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resultVariable&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;myVar&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/flowable:taskListener&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnMultiInstance">多实例（for each）</h5>
<div class="sect5">
<h6 id="bpmnMultiInstanceDescription">描述</h6>
<div class="paragraph">
<p><em>多实例活动（multi-instance activity）</em>是在业务流程中，为特定步骤定义重复的方式。在编程概念中，多实例类似<strong>for each</strong>结构：可以为给定集合中的每一条目，<strong>顺序或并行地</strong>，执行特定步骤，甚至是整个子流程。</p>
</div>
<div class="paragraph">
<p><em>多实例</em>是一个普通活动，加上定义（被称作“<em>多实例</em>特性的”）额外参数，会使得活动在运行时被多次执行。下列活动可以成为<em>多实例活动：</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#bpmnUserTask">用户任务</a></p>
</li>
<li>
<p><a href="#bpmnScriptTask">脚本任务</a></p>
</li>
<li>
<p><a href="#bpmnJavaServiceTask">Java服务任务</a></p>
</li>
<li>
<p><a href="#bpmnWebserviceTask">Web服务任务</a></p>
</li>
<li>
<p><a href="#bpmnBusinessRuleTask">业务规则任务</a></p>
</li>
<li>
<p><a href="#bpmnEmailTask">邮件任务</a></p>
</li>
<li>
<p><a href="#bpmnManualTask">人工任务</a></p>
</li>
<li>
<p><a href="#bpmnReceiveTask">接收任务</a></p>
</li>
<li>
<p><a href="#bpmnSubProcess">（嵌入式）子流程</a></p>
</li>
<li>
<p><a href="#bpmnCallActivity">调用活动</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#bpmnGateways">网关</a>与<a href="#bpmnEvents">事件</a><strong>不能</strong>设置为多实例。</p>
</div>
<div class="paragraph">
<p>按照BPMN2.0规范的要求，用于为每个实例创建执行的父执行，会提供下列变量：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>nrOfInstances</strong>：实例总数。</p>
</li>
<li>
<p><strong>nrOfActiveInstances</strong>：当前活动的（即未完成的），实例数量。对于顺序多实例，这个值总为1。</p>
</li>
<li>
<p><strong>nrOfCompletedInstances</strong>：已完成的实例数量。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>可以调用<code>execution.getVariable(x)</code>方法获取这些值。</p>
</div>
<div class="paragraph">
<p>另外，每个被创建的执行，都有局部变量（对其他执行不可见，也不存储在流程实例级别）：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>loopCounter</strong>：给定实例在<em>for-each循环中的index</em>。可以通过Flowable的<strong>elementIndexVariable</strong>属性为loopCounter变量重命名。</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="bpmnMultiInstanceGraphicalNotation">图示</h6>
<div class="paragraph">
<p>如果一个活动是多实例，将通过在该活动底部的三条短线表示。三条<em>竖</em>线代表实例会并行执行，而三条<em>横</em>线代表顺序执行。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.multi.instance.png" alt="bpmn.multi.instance">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnMultiInstanceXml">XML表示</h6>
<div class="paragraph">
<p>要将活动变成多实例，该活动的XML元素必须有<code>multiInstanceLoopCharacteristics</code>子元素</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;multiInstanceLoopCharacteristics</span> <span class="tok-na">isSequential=</span><span class="tok-s">&quot;false|true&quot;</span><span class="tok-nt">&gt;</span>
 ...
<span class="tok-nt">&lt;/multiInstanceLoopCharacteristics&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>isSequential</strong>属性代表了活动的实例为顺序还是并行执行。</p>
</div>
<div class="paragraph">
<p>实例的数量<strong>在进入活动时，计算一次</strong>。有几种不同方法可以配置数量。一个方法是通过<strong>loopCardinality</strong>子元素，直接指定数字。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;multiInstanceLoopCharacteristics</span> <span class="tok-na">isSequential=</span><span class="tok-s">&quot;false|true&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;loopCardinality&gt;</span>5<span class="tok-nt">&lt;/loopCardinality&gt;</span>
<span class="tok-nt">&lt;/multiInstanceLoopCharacteristics&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用解析为正整数的表达式：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;multiInstanceLoopCharacteristics</span> <span class="tok-na">isSequential=</span><span class="tok-s">&quot;false|true&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;loopCardinality&gt;</span>${nrOfOrders-nrOfCancellations}<span class="tok-nt">&lt;/loopCardinality&gt;</span>
<span class="tok-nt">&lt;/multiInstanceLoopCharacteristics&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>另一个定义实例数量的方法，是使用<code>loopDataInputRef</code>子元素，指定一个集合型流程变量的名字。对集合中的每一项，都会创建一个实例。可以使用<code>inputDataItem</code>子元素，将该项设置给该实例的局部变量。在下面的XML示例中展示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;miTasks&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My Task ${loopCounter}&quot;</span> <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;${assignee}&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;multiInstanceLoopCharacteristics</span> <span class="tok-na">isSequential=</span><span class="tok-s">&quot;false&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;loopDataInputRef&gt;</span>assigneeList<span class="tok-nt">&lt;/loopDataInputRef&gt;</span>
    <span class="tok-nt">&lt;inputDataItem</span> <span class="tok-na">name=</span><span class="tok-s">&quot;assignee&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/multiInstanceLoopCharacteristics&gt;</span>
<span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>假设变量<code>assigneeList</code>包含<code>[kermit, gonzo, fozzie]</code>。上面的代码会创建三个并行的用户任务。每一个执行都有一个名为<code>assignee</code>的（局部）流程变量，含有集合中的一项，并在这个例子中被用于指派用户任务。</p>
</div>
<div class="paragraph">
<p><code>loopDataInputRef</code>与<code>inputDataItem</code>的缺点是名字很难记，并且由于BPMN 2.0概要的限制，不能使用表达式。Flowable通过在<code>multiInstanceCharacteristics</code>上提供<strong>collection</strong>与<strong>elementVariable</strong>属性解决了这些问题：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;miTasks&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My Task&quot;</span> <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;${assignee}&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;multiInstanceLoopCharacteristics</span> <span class="tok-na">isSequential=</span><span class="tok-s">&quot;true&quot;</span>
     <span class="tok-na">flowable:collection=</span><span class="tok-s">&quot;${myService.resolveUsersForTask()}&quot;</span> <span class="tok-na">flowable:elementVariable=</span><span class="tok-s">&quot;assignee&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;/multiInstanceLoopCharacteristics&gt;</span>
<span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意<code>collection</code>属性会作为表达式进行解析。如果表达式解析为字符串而不是一个集合，不论是因为本身配置的就是静态字符串值，还是表达式计算结果为字符串，这个字符串都会被当做变量名，在流程变量中用于获取实际的集合。</p>
</div>
<div class="paragraph">
<p>例如，下面的代码片段会要求集合存储在<code>assigneeList</code>流程变量中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;miTasks&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My Task&quot;</span> <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;${assignee}&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;multiInstanceLoopCharacteristics</span> <span class="tok-na">isSequential=</span><span class="tok-s">&quot;true&quot;</span>
     <span class="tok-na">flowable:collection=</span><span class="tok-s">&quot;assigneeList&quot;</span> <span class="tok-na">flowable:elementVariable=</span><span class="tok-s">&quot;assignee&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;/multiInstanceLoopCharacteristics&gt;</span>
<span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>假如<code>myService.getCollectionVariableName()</code>返回字符串值，引擎就会用这个值作为变量名，获取流程变量保存的集合。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;miTasks&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My Task&quot;</span> <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;${assignee}&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;multiInstanceLoopCharacteristics</span> <span class="tok-na">isSequential=</span><span class="tok-s">&quot;true&quot;</span>
     <span class="tok-na">flowable:collection=</span><span class="tok-s">&quot;${myService.getCollectionVariableName()}&quot;</span> <span class="tok-na">flowable:elementVariable=</span><span class="tok-s">&quot;assignee&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;/multiInstanceLoopCharacteristics&gt;</span>
<span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>多实例活动在所有实例都完成时结束。然而，也可以指定一个表达式，在每个实例结束时进行计算。当表达式计算为true时，将销毁所有剩余的实例，并结束多实例活动，继续执行流程。这个表达式必须通过<strong>completionCondition</strong>子元素定义。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;miTasks&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My Task&quot;</span> <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;${assignee}&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;multiInstanceLoopCharacteristics</span> <span class="tok-na">isSequential=</span><span class="tok-s">&quot;false&quot;</span>
     <span class="tok-na">flowable:collection=</span><span class="tok-s">&quot;assigneeList&quot;</span> <span class="tok-na">flowable:elementVariable=</span><span class="tok-s">&quot;assignee&quot;</span> <span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;completionCondition&gt;</span>${nrOfCompletedInstances/nrOfInstances &gt;= 0.6 }<span class="tok-nt">&lt;/completionCondition&gt;</span>
  <span class="tok-nt">&lt;/multiInstanceLoopCharacteristics&gt;</span>
<span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子里，会为<code>assigneeList</code>集合中的每个元素创建并行实例。当60%的任务完成时，其他的任务将被删除，流程继续运行。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnMultiInstanceBoundaryEvent">边界事件与多实例</h6>
<div class="paragraph">
<p>多实例是普通活动，因此可以在其边界定义<a href="#bpmnBoundaryEvent">边界事件</a>。如果是中断边界事件，当其捕获事件时，会销毁活动中的<strong>所有实例</strong>。以下面的多实例子流程为例：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.multi.instance.boundary.event.png" alt="bpmn.multi.instance.boundary.event">
</div>
</div>
<div class="paragraph">
<p>当定时器触发时，子流程的所有实例都会被销毁，无论有多少实例，或者实例的内部活动是否完成。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnCompensationHandlers">多实例与执行监听器</h6>
<div class="paragraph">
<p>执行监听器与多实例一起使用时需要特别注意。以下面的BPMN 2.0 XML代码片段为例。这段XML定义在与<em>multiInstanceLoopCharacteristics</em> XML元素相同的级别：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:executionListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.MyStartListener&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:executionListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.MyEndListener&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/extensionElements&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>对于普通的BPMN活动，会在活动开始与结束时调用一次监听器。</p>
</div>
<div class="paragraph">
<p>但是当该活动为多实例时，行为有区别：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>当进入多实例活动时，在任何<em>内部</em>活动执行前，抛出一个启动事件。<em>loopCounter</em>变量还未设置（为null）。</p>
</li>
<li>
<p>进入每个实际执行的活动时，抛出一个启动事件。<em>loopCounter</em>变量已经设置。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>结束事件类似：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>离开每个实际执行的活动后，抛出一个结束事件。<em>loopCounter</em>变量已经设置。</p>
</li>
<li>
<p>多实例活动整体完成后，抛出一个结束事件。<em>loopCounter</em>变量未设置。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-nt">&lt;subProcess</span> <span class="tok-na">id=</span><span class="tok-s">&quot;subprocess1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Sub Process&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:executionListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.MyStartListener&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:executionListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.MyEndListener&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
  <span class="tok-nt">&lt;multiInstanceLoopCharacteristics</span> <span class="tok-na">isSequential=</span><span class="tok-s">&quot;false&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;loopDataInputRef&gt;</span>assignees<span class="tok-nt">&lt;/loopDataInputRef&gt;</span>
    <span class="tok-nt">&lt;inputDataItem</span> <span class="tok-na">name=</span><span class="tok-s">&quot;assignee&quot;</span><span class="tok-nt">&gt;&lt;/inputDataItem&gt;</span>
  <span class="tok-nt">&lt;/multiInstanceLoopCharacteristics&gt;</span>
  <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;startevent2&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Start&quot;</span><span class="tok-nt">&gt;&lt;/startEvent&gt;</span>
  <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;endevent2&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;End&quot;</span><span class="tok-nt">&gt;&lt;/endEvent&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow3&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;startevent2&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;endevent2&quot;</span><span class="tok-nt">&gt;&lt;/sequenceFlow&gt;</span>
<span class="tok-nt">&lt;/subProcess&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子中，假设<em>assignees</em>有三项。在运行时会发生如下事情：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>多实例整体抛出一个启动事件。调用一次<em>start</em>执行监听器，<em>loopCounter</em>与<em>assignee</em>变量均未设置（即为null）。</p>
</li>
<li>
<p>每一个活动实例抛出一个启动事件。调用三次<em>start</em>执行监听器，<em>loopCounter</em>与<em>assignee</em>变量均已设置（也就是说不为null）。</p>
</li>
<li>
<p>因此启动执行监听器总共被调用四次。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意，即使<em>multiInstanceLoopCharacteristics</em>不是定义在子流程上，也是一样。例如，如果上面的例子中只是一个简单的用户任务，抛出事件的行为也是一样。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_compensation_handlers">补偿处理器</h5>
<div class="sect5">
<h6 id="bpmnCompensationHandlerDescription">描述</h6>
<div class="paragraph">
<p>如果要使用一个活动补偿另一个活动的影响，可以将其声明为<em>补偿处理器（compensation handler）</em>。补偿处理器不在正常流程中执行，而只在流程抛出补偿事件时才会执行。</p>
</div>
<div class="paragraph">
<p>补偿处理器不得有入口或出口顺序流。</p>
</div>
<div class="paragraph">
<p>补偿处理器必须通过单向的连接，关联一个补偿边界事件。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnCompensationHandlerGraphicalNotation">图示</h6>
<div class="paragraph">
<p>如果一个活动是补偿处理器，则会在其下部中间显示补偿事件图标。下面摘录的流程图展示了一个带有补偿边界事件的服务任务，并关联至一个补偿处理器。请注意补偿处理器图标显示在"cancel hotel reservation（取消酒店预订）"服务任务的下部中间。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.compensation.event.png" alt="bpmn.boundary.compensation.event">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnCompensationHandlerXml">XML表示</h6>
<div class="paragraph">
<p>要将一个活动声明为补偿处理器，需要将<code>isForCompensation</code>属性设置为true：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;undoBookHotel&quot;</span> <span class="tok-na">isForCompensation=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;...&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnSubprocessAndCallActivity">2.1.6. 子流程与调用活动</h4>
<div class="sect4">
<h5 id="bpmnSubProcess">子流程</h5>
<div class="sect5">
<h6 id="bpmnSubProcessDescription">描述</h6>
<div class="paragraph">
<p><em>子流程（sub-process）</em>是包含其他的活动、网关、事件等的活动。其本身构成一个流程，并作为更大流程的一部分。<em>子流程</em>完全在父流程中定义（这就是为什么经常被称作<em>嵌入式</em>子流程）。</p>
</div>
<div class="paragraph">
<p>子流程有两个主要的使用场景：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>子流程可以<strong>分层建模</strong>。很多建模工具都可以<em>折叠</em>子流程，隐藏子流程的所有细节，而只显示业务流程的高层端到端总览。</p>
</li>
<li>
<p>子流程会创建新的<strong>事件范围</strong>。在子流程执行中抛出的事件可以通过子流程边界上的<a href="#bpmnBoundaryEvent">边界事件</a>捕获，为该事件创建了限制在子流程内的范围。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>使用子流程也要注意以下几点：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>子流程只能有<strong>一个空启动事件</strong>，而不允许有其他类型的启动事件。请注意BPMN 2.0规范允许省略子流程的启动与结束事件，但目前Flowable的实现尚不支持省略。</p>
</li>
<li>
<p><strong>顺序流不能跨越子流程边界。</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="bpmnSubProcessGraphicalNotation">图示</h6>
<div class="paragraph">
<p>子流程表示为标准活动(圆角矩形)。若<em>折叠</em>了子流程，则只显示其名字与一个加号，以展示流程的高层概览：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.collapsed.subprocess.png" alt="bpmn.collapsed.subprocess">
</div>
</div>
<div class="paragraph">
<p>若<em>展开</em>了子流程，则在子流程内显示子流程的所有步骤：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.expanded.subprocess.png" alt="bpmn.expanded.subprocess">
</div>
</div>
<div class="paragraph">
<p>使用子流程的一个主要原因是为事件定义范围。下面的流程模型展示了这种用法：<em>investigate software（调查硬件）/investigate hardware（调查软件）</em>两个任务需要并行执行，且需要在给定时限内，在<em>Level 2 support（二级支持）</em>响应前完成。在这里，定时器的范围（即需要按时完成的活动）通过子流程进行限制。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.subprocess.with.boundary.timer.png" alt="bpmn.subprocess.with.boundary.timer">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnSubProcessXML">XML表示</h6>
<div class="paragraph">
<p>子流程通过<em>subprocess</em>元素定义。子流程中的所有活动、网关、事件等，都需要定义在这个元素内。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;subProcess</span> <span class="tok-na">id=</span><span class="tok-s">&quot;subProcess&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;subProcessStart&quot;</span> <span class="tok-nt">/&gt;</span>

  ... 其他子流程元素 ...

  <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;subProcessEnd&quot;</span> <span class="tok-nt">/&gt;</span>

 <span class="tok-nt">&lt;/subProcess&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnEventSubprocess">事件子流程</h5>
<div class="sect5">
<h6 id="bpmnEventSubprocessDescription">描述</h6>
<div class="paragraph">
<p>事件子流程（event sub-process）是BPMN 2.0新定义的。事件子流程是通过事件触发的子流程。可以在流程级别，或者任何子流程级别，添加事件子流程。用于触发事件子流程的事件，使用启动事件进行配置。因此可知，不能在事件子流程中使用空启动事件。事件子流程可以通过消息事件、错误事件、信号时间、定时器事件或补偿事件等触发。在事件子流程的宿主范围（流程实例或子流程）创建时，创建对启动事件的订阅。当该范围销毁时，删除订阅。</p>
</div>
<div class="paragraph">
<p>事件子流程可以是中断或不中断的。中断的子流程将取消当前范围内的任何执行。非中断的事件子流程将创建新的并行执行。宿主范围内的每个活动，只能触发一个中断事件子流程，而非中断事件子流程可以多次触发。子流程是否是中断的，通过触发事件子流程的启动事件配置。</p>
</div>
<div class="paragraph">
<p>事件子流程不能有任何入口或出口顺序流。事件子流程是由事件触发的，因此入口顺序流不合逻辑。当事件子流程结束时，要么同时结束当前范围（中断事件子流程的情况），要么是非中断子流程创建的并行执行结束。</p>
</div>
<div class="paragraph">
<p><strong>目前的限制：</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Flowable支持错误、定时器、信号与消息启动事件触发事件子流程。</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="bpmnEventSubprocessGraphicalNotation">图示</h6>
<div class="paragraph">
<p>事件子流程表示为点线边框的<a href="#bpmnSubProcessGraphicalNotation">嵌入式子流程</a>。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.subprocess.eventSubprocess.png" alt="bpmn.subprocess.eventSubprocess">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnEventSubprocessXMLRepresentation">XML表示</h6>
<div class="paragraph">
<p>事件子流程的XML表示形式与嵌入式子流程相同。但需要将<code>triggeredByEvent</code>属性设置为<code>true</code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;subProcess</span> <span class="tok-na">id=</span><span class="tok-s">&quot;eventSubProcess&quot;</span> <span class="tok-na">triggeredByEvent=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">&gt;</span>
	...
<span class="tok-nt">&lt;/subProcess&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnEventSubprocessExample">示例</h6>
<div class="paragraph">
<p>下面是使用错误启动事件触发事件子流程的例子。该事件子流程处于“流程级别”，即流程实例的范围：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.subprocess.eventSubprocess.example.1.png" alt="bpmn.subprocess.eventSubprocess.example.1">
</div>
</div>
<div class="paragraph">
<p>事件子流程在XML中是这样的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;subProcess</span> <span class="tok-na">id=</span><span class="tok-s">&quot;eventSubProcess&quot;</span> <span class="tok-na">triggeredByEvent=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;catchError&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;errorEventDefinition</span> <span class="tok-na">errorRef=</span><span class="tok-s">&quot;error&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/startEvent&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;catchError&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;taskAfterErrorCatch&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;taskAfterErrorCatch&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Provide additional data&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/subProcess&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>前面已经指出，事件子流程也可以添加到嵌入式子流程内。若添加到嵌入式子流程内，可以代替边界事件的功能。例如在下面两个流程图中，嵌入式子流程都抛出错误事件。错误事件都被捕获，并由用户任务处理。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.subprocess.eventSubprocess.example.2a.png" alt="bpmn.subprocess.eventSubprocess.example.2a">
</div>
</div>
<div class="paragraph">
<p>对比：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.subprocess.eventSubprocess.example.2b.png" alt="bpmn.subprocess.eventSubprocess.example.2b">
</div>
</div>
<div class="paragraph">
<p>两种情况下都执行相同的任务。然而，两种模型有如下不同：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>嵌入式（事件）子流程使用其宿主范围的执行来执行。这意味着嵌入式（事件）子流程可以访问其范围的局部变量。当使用边界事件时，执行嵌入式子流程的执行，会被边界事件的出口顺序流删除。意味着嵌入式子流程创建的变量将不再可用。</p>
</li>
<li>
<p>使用事件子流程时，事件完全由其所在的子流程处理。当使用边界事件时，事件由其父流程处理。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这两点可以帮助你判断哪种方式更适合解决特定的流程建模或实现问题，以选择使用边界事件还是嵌入式（事件）子流程。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnTransactionSubprocess">事务子流程</h5>
<div class="sect5">
<h6 id="_description_2">描述</h6>
<div class="paragraph">
<p>事务子流程（transaction sub-process）是一种嵌入式子流程，用于将多个活动组织在一个事务里。事务是工作的逻辑单元，可以组织一组独立活动，使得它们可以一起成功或失败。</p>
</div>
<div class="paragraph">
<p><strong>事务的可能结果：</strong>事务有三种不同的结果：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>若未被取消，或被意外终止，则事务<em>成功(successful)</em>。若事务子流程成功，将使用出口顺序流离开。若流程后面抛出了补偿事件，成功的事务可以被补偿。<em>请注意：</em>与“普通”嵌入式子流程一样，可以使用补偿抛出中间事件，在事务成功完成后补偿。</p>
</li>
<li>
<p>若执行到达取消结束事件时，事务被<em>取消(canceled)</em>。在这种情况下，所有执行都将被终止并移除。只会保留一个执行，设置为取消边界事件，并将触发补偿。在补偿完成后，事务子流程通过取消边界事件的出口顺序流离开。</p>
</li>
<li>
<p>若由于抛出了错误结束事件，且未被事务子流程所在的范围捕获，则事务会被<em>意外(hazard)</em>终止。错误被事件子流程的边界捕获也一样。在这种情况下，不会进行补偿。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>下面的流程图展示这三种不同的结果：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.transaction.subprocess.example.1.png" alt="bpmn.transaction.subprocess.example.1">
</div>
</div>
<div class="paragraph">
<p><strong>与ACID事务的关系：</strong>要注意不要将BPMN事务子流程与技术（ACID）事务混淆。BPMN事务子流程不是划分技术事务范围的方法。要理解Acitivit中的事务管理，请阅读<a href="#bpmnConcurrencyAndTransactions">并发与事务</a>章节。BPMN事务与ACID事务有如下区别：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ACID事务生存期一般比较短，而BPMN事务可以持续几小时，几天甚至几个月才完成。考虑一个场景：事务包括的活动中有一个用户任务。通常人的响应时间要比程序长。或者，在另一个场景下，BPMN事务可能等待某些业务事件发生，像是特定订单的填写完成。这些操作通常要比更新数据库字段、使用事务队列存储消息等，花长得多的时间完成。</p>
</li>
<li>
<p>不可能将业务活动的持续时间限定为ACID事务的范围，因此一个BPMN事务通常会生成多个ACID事务。</p>
</li>
<li>
<p>一个BPMN事务可以生成多个ACID事务，也就不能使用ACID特性。例如，考虑上面的流程例子。假设"book hotel（预订酒店）"与"charge credit card（信用卡付款）"操作在分开的ACID事务中处理。再假设"book hotel（预订酒店）"活动已经成功。这时，因为已经进行了预订酒店操作，而还没有进行信用卡扣款，就处在中间不一致状态（intermediary inconsistent state）。在ACID事务中，会顺序进行不同的操作，因此也处在中间不一致状态。在这里不一样的是，不一致状态在事务范围外可见。例如，如果通过外部预订服务进行预定，则使用该预订服务的其他部分将能看到酒店已被预订。这意味着，当使用业务事务时，完全不会使用隔离参数（的确，当使用ACID事务时，我们通常也会降低隔离级别，以保证高并发级别。但ACID事务可以细粒度地进行控制，而中间不一致状态也只会存在于一小段时间内）。</p>
</li>
<li>
<p>BPMN业务事务不使用传统方式回滚。这是因为它生成多个ACID事务，在BPMN事务取消时，部分ACID事务可能已经提交。这样它们没法回滚。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>因为BPMN事务天生需要长时间运行，因此就需要使用不同的方式缺乏隔离与回滚机制造成的问题。在实际使用中，通常只能通过领域特定（domain specific）的方式解决这些问题：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>通过补偿实现回滚。如果在事务范围内抛出了取消事件，就补偿所有成功执行并带有补偿处理器的活动所造成的影响。</p>
</li>
<li>
<p>缺乏隔离通常使用特定领域的解决方案来处理。例如，在上面的例子里，在我们确定第一个客户可以付款前，一个酒店房间可能被第二个客户预定。这可能不满足业务预期，因此预订服务可能会选择允许一定量的超量预定。</p>
</li>
<li>
<p>另外，由于事务可以由于意外而终止，预订服务需要处理这种情况，比如酒店房间已经预定，但从未付款（因为事务可能已经终止）。在这种情况下，预定服务可能选择这种策略：一个酒店房间有最大预留时间，若到时还未付款，则取消预订。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>总结一下：尽管ACID事务提供了对回滚、隔离级别，与启发式结果（heuristic outcomes）等问题的通用解决方案，但仍然需要在实现业务事务时，为这些问题寻找特定领域的解决方案。</p>
</div>
<div class="paragraph">
<p><strong>目前的限制：</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>BPMN规范要求，流程引擎响应底层事务协议提交的事务。如果在底层协议中发生了取消事件，则取消事务。作为嵌入式的引擎，Flowable当前不支持这点。查看下面介绍一致性的段落，了解其后果。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>基于ACID事务与乐观锁（optimistic concurrency）的一致性：</strong>BPMN事务在如下情况保证一致性：所有活动都成功完成；或若部分活动不能执行，则所有已完成活动都被补偿。两种方法都可以达到最终一致性状态。然而需要了解的是：Flowable中BPMN事务的一致性模型，以流程执行的一致性模型为基础。Flowable以事务的方式执行流程，并通过乐观锁标记处理并发。在Flowable中，BPMN的错误、取消与补偿事件，都建立在相同的ACID事务与乐观锁之上。例如，只有在实际到达时，取消结束事件才能触发补偿。如果服务任务抛出了非受检异常，导致并未实际到达取消结束事件；或者，由于底层ACID事务中的其他操作，将事务设置为rollback-only（回滚）状态，导致补偿处理器的操作不能提交；或者，当两个并行执行到达一个取消结束事件时，补偿会被两次触发，并由于乐观锁异常而失败。这些情况下都不能真正完成补偿。想说明的是，当在Flowable中实现BPMN事务时，与实施“普通”流程与子流程，需要遵守相同的规则。因此实现流程时需要有效地保证一致性，需要将乐观锁、事务执行模型纳入考虑范围。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnTransactionSubprocessGraphicalNotation">图示</h6>
<div class="paragraph">
<p>事务子流程表示为带有两层边框的<a href="#bpmnSubProcessGraphicalNotation">嵌入式子流程</a>。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.transaction.subprocess.png" alt="bpmn.transaction.subprocess">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnTransactionSubprocessXMLRepresentation">XML表示</h6>
<div class="paragraph">
<p>事务子流程在XML中通过<code>transaction</code>标签表示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;transaction</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myTransaction&quot;</span> <span class="tok-nt">&gt;</span>
	...
<span class="tok-nt">&lt;/transaction&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnTransactionSubprocessExample">示例</h6>
<div class="paragraph">
<p>下面是一个事务子流程的例子：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.transaction.subprocess.example.2.png" alt="bpmn.transaction.subprocess.example.2">
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCallActivity">调用活动（子流程）</h5>
<div class="sect5">
<h6 id="bpmnCallActivityDescription">描述</h6>
<div class="paragraph">
<p>尽管看起来很相像，但在BPMN 2.0中，调用活动（call activity）有别于一般的<em><a href="#bpmnSubProcess">子流程</a></em>——通常也称作<em>嵌入式子流程</em>。从概念上说，两者都在流程执行到达该活动时，调用一个子流程。</p>
</div>
<div class="paragraph">
<p>两者的区别为，调用活动引用一个流程定义外部的流程，而<em><a href="#bpmnSubProcess">子流程</a></em>嵌入在原有流程定义内。调用活动的主要使用场景是，在多个不同流程定义中调用一个可复用的流程定义。</p>
</div>
<div class="paragraph">
<p>当流程执行到达<em>调用活动</em>时，会创建一个新的执行，作为到达调用活动的执行的子执行。这个子执行用于执行子流程，也可用于创建并行子执行（与普通流程中行为类似）。父执行将等待子流程完成，之后沿原流程继续执行。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnCallActivityGraphicalNotation">图示</h6>
<div class="paragraph">
<p>调用过程表现为带有粗边框（折叠与展开都是）的<a href="#bpmnSubProcessGraphicalNotation">子流程</a>。取决于建模工具，调用过程可以展开，但默认表现为折叠形式。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.collapsed.call.activity.png" alt="bpmn.collapsed.call.activity">
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnCallActivityXMLRepresentation">XML表示</h6>
<div class="paragraph">
<p>调用活动是一个普通活动，在<em>calledElement</em>中通过<strong>key</strong>引用流程定义。在实际使用中，通常在<em>calledElement</em>中配置<strong>流程的ID</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;callActivity</span> <span class="tok-na">id=</span><span class="tok-s">&quot;callCheckCreditProcess&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Check credit&quot;</span> <span class="tok-na">calledElement=</span><span class="tok-s">&quot;checkCreditProcess&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意子流程的流程定义<strong>在运行时解析</strong>。这意味着如果需要的话，子流程可以与调用流程分别部署。</p>
</div>
</div>
<div class="sect5">
<h6 id="bpmnCallActivityPassVariables">传递变量</h6>
<div class="paragraph">
<p>可以向子流程传递与接收流程变量。数据将在子流程启动时复制到子流程，并在其结束时复制回主流程。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-nt">&lt;callActivity</span> <span class="tok-na">id=</span><span class="tok-s">&quot;callSubProcess&quot;</span> <span class="tok-na">calledElement=</span><span class="tok-s">&quot;checkCreditProcess&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;extensionElements&gt;</span>
        <span class="tok-nt">&lt;flowable:in</span> <span class="tok-na">source=</span><span class="tok-s">&quot;someVariableInMainProcess&quot;</span>
            <span class="tok-na">target=</span><span class="tok-s">&quot;nameOfVariableInSubProcess&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;flowable:out</span> <span class="tok-na">source=</span><span class="tok-s">&quot;someVariableInSubProcess&quot;</span>
            <span class="tok-na">target=</span><span class="tok-s">&quot;nameOfVariableInMainProcess&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/callActivity&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以将<code>inheritVariables</code>设置为true，将所有流程变量传递给子流程。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;callActivity</span> <span class="tok-na">id=</span><span class="tok-s">&quot;callSubProcess&quot;</span> <span class="tok-na">calledElement=</span><span class="tok-s">&quot;checkCreditProcess&quot;</span> <span class="tok-na">flowable:inheritVariables=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>除了需要按照BPMN 2.0标准的方式声明流程变量的BPMN标准元素<em>dataInputAssociation</em>与<em>dataOutputAssociation</em>之外，
Flowable还提供了扩展作为快捷方式。</p>
</div>
<div class="paragraph">
<p>也可以在这里使用表达式：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;callActivity</span> <span class="tok-na">id=</span><span class="tok-s">&quot;callSubProcess&quot;</span> <span class="tok-na">calledElement=</span><span class="tok-s">&quot;checkCreditProcess&quot;</span> <span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;extensionElements&gt;</span>
        <span class="tok-nt">&lt;flowable:in</span> <span class="tok-na">sourceExpression=</span><span class="tok-s">&quot;${x+5}&quot;</span> <span class="tok-na">target=</span><span class="tok-s">&quot;y&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;flowable:out</span> <span class="tok-na">source=</span><span class="tok-s">&quot;${y+5}&quot;</span> <span class="tok-na">target=</span><span class="tok-s">&quot;z&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/callActivity&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>因此最终 z = y+5 = x+5+5 。</p>
</div>
<div class="paragraph">
<p>调用活动元素还提供了一个自定义Flowable属性扩展，<em>businessKey</em>，用于设置子流程实例的businessKey。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;callActivity id="callSubProcess" calledElement="checkCreditProcess" flowable:businessKey="${myVariable}"&gt;
...
&lt;/callActivity&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>将<em>inheritBusinessKey</em>属性设置为<code>true</code>，会将子流程的businessKey值设置为调用流程的businessKey的值。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;callActivity id="callSubProcess" calledElement="checkCreditProcess" flowable:inheritBusinessKey="true"&gt;
...
&lt;/callActivity&gt;</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bpmnCallActivityExample">引用同一部署中的流程</h6>
<div class="paragraph">
<p>默认会使用引用流程最后部署的流程定义版本。但有的时候也会想引用与主流程一起部署的引用流程定义。这需要将主流程与引用流程放在同一个部署单元中，以便引用相同的部署。</p>
</div>
<div class="paragraph">
<p>在<code>callActivity</code>元素中，将<code>sameDeployment</code>属性设置为<code>true</code>，即可引用相同部署的流程。</p>
</div>
<div class="paragraph">
<p>如下例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;callActivity id="callSubProcess" calledElement="checkCreditProcess" flowable:sameDeployment="true"&gt;
...
&lt;/callActivity&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><code>sameDeployment</code>默认值为false。</p>
</div>
</div>
<div class="sect5">
<h6 id="_example">示例</h6>
<div class="paragraph">
<p>下面的流程图展示了简单的订单处理流程。因为检查客户的信用额度的操作在许多其他流程中都通用，因此将<em>check credit step（检查信用额度步骤）</em>建模为调用活动。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.call.activity.super.process.png" alt="bpmn.call.activity.super.process">
</div>
</div>
<div class="paragraph">
<p>流程像是下面这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;receiveOrder&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;manualTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;receiveOrder&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Receive Order&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;receiveOrder&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;callCheckCreditProcess&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;callActivity</span> <span class="tok-na">id=</span><span class="tok-s">&quot;callCheckCreditProcess&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Check credit&quot;</span> <span class="tok-na">calledElement=</span><span class="tok-s">&quot;checkCreditProcess&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow3&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;callCheckCreditProcess&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;prepareAndShipTask&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;prepareAndShipTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Prepare and Ship&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow4&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;prepareAndShipTask&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>子流程像是下面这样：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.call.activity.sub.process.png" alt="bpmn.call.activity.sub.process">
</div>
</div>
<div class="paragraph">
<p>与子流程的流程定义相比没什么特别。但调用活动的流程也可以不通过其他流程调用而直接使用。</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnConcurrencyAndTransactions">2.1.7. 事务与并发</h4>
<div class="sect4">
<h5 id="asyncContinuations">异步延续</h5>
<div class="paragraph">
<p>（Asynchronous Continuations）</p>
</div>
<div class="paragraph">
<p>Flowable以事务方式执行流程，并可按照你的需求配置。让我们从Flowable一般如何为事务划分范围开始介绍。如果Flowable被触发（启动流程，完成任务，为执行发送信号），Flowable将沿流程执行，直到到达每个执行路径的等待状态。更具体地说，它以深度优先方式搜索流程图，并在每个执行分支都到达等待状态时返回。等待状态是“之后”再执行的任务，也就是说着Flowable将当前执行持久化，并等待再次触发。触发可以来自外部来源如用户任务或消息接受任务，也可以来自Flowable自身如定时器事件。以下面的图片说明：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/async.example.no.async.PNG" alt="async.example.no.async">
</div>
</div>
<div class="paragraph">
<p>这是一个BPMN流程的片段，有一个用户任务、一个服务任务，与一个定时器事件。用户任务的完成操作与验证地址（validate address）在同一个工作单元内，因此需要原子性地（atomically）成功或失败。这意味着如果服务任务抛出了异常，我们会想要回滚当前事务，以便执行返回到用户任务，并希望用户任务仍然保存在数据库中。这也是Flowable的默认行为。在（1）中，应用或客户端线程完成任务。在相同的线程中，Flowable执行服务并继续，直到到达等待状态，在这个例子中，是定时器事件（2）。然后将控制权返回至调用者（3），同时提交事务（如果事务由Flowable开启）。</p>
</div>
<div class="paragraph">
<p>在有的情况下，我们不想要这样。有时我们需要在流程中自定义地控制事务边界，以便为工作的逻辑单元划分范围。这就需要使用异步延续。考虑下面的流程（片段）：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/async.example.async.PNG" alt="async.example.async">
</div>
</div>
<div class="paragraph">
<p>完成用户任务，生成发票，并将发票发送给客户。这次发票的生成不再是同一个工作单元的一部分，因此我们不希望当发票生成失败时，回滚用户任务。所以我们希望Flowable做的，是完成用户任务（1），提交事务，并将控制权返回给调用程序。然后我们希望在后台线程中，异步地生成发票。这个后台线程就是Flowable作业执行器（事实上是一个线程池），它周期性地将作业保存至数据库。因此在幕后，当到达"generate invoice（生成发票）"任务时，Flowable会创建“消息”作业并将其持久化到数据库中，用于继续执行流程。这个作业之后会被作业执行器选中并执行。Flowable也会向本地的作业执行器进行提示，告知其有新作业到来，以提升性能。</p>
</div>
<div class="paragraph">
<p>要使用这个特性，可以使用<em>flowable:async="true"</em>扩展。因此，一个示例的服务任务会像是这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;service1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Generate Invoice&quot;</span>
    <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;my.custom.Delegate&quot;</span>
    <span class="tok-na">flowable:async=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以为下列BPMN任务类型指定<em>flowable:async</em>：任务，服务任务，脚本任务，业务规则任务，发送任务，接收任务，用户任务，子流程，调用活动。</p>
</div>
<div class="paragraph">
<p>对于用户任务、接收任务与其他等待状态来说，异步操作允许我们在一个独立的线程/事务中启动执行监听器。</p>
</div>
</div>
<div class="sect4">
<h5 id="failRetry">失败重试</h5>
<div class="paragraph">
<p>默认配置下，如果作业执行中有任何异常，Flowable将三次重试执行作业。对异步作业也是这样。需要更灵活的配置时可以使用这两个参数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>重试的次数</p>
</li>
<li>
<p>重试的间隔</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这两个参数可以通过<code>flowable:failedJobRetryTimeCycle</code>元素配置。这有一个简单的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;failingServiceTask&quot;</span> <span class="tok-na">flowable:async=</span><span class="tok-s">&quot;true&quot;</span>
    <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;org.flowable.engine.test.jobexecutor.RetryFailingDelegate&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;extensionElements&gt;</span>
        <span class="tok-nt">&lt;flowable:failedJobRetryTimeCycle&gt;</span>R5/PT7M<span class="tok-nt">&lt;/flowable:failedJobRetryTimeCycle&gt;</span>
    <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>时间周期表达式与定时器事件表达式一样遵循ISO 8601标准。上面的例子会让作业执行器重试5次，并在每次重试前等待7分钟。</p>
</div>
</div>
<div class="sect4">
<h5 id="exclusiveJobs">排他作业</h5>
<div class="paragraph">
<p>从近期版本开始，JobExecutor确保同一个流程实例的作业永远不会并发执行。为什么这样？</p>
</div>
<div class="sect5">
<h6 id="_why_exclusive_jobs">为什么使用排他作业？</h6>
<div class="paragraph">
<p>考虑下面的流程定义：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.why.exclusive.jobs.png" alt="bpmn.why.exclusive.jobs">
</div>
</div>
<div class="paragraph">
<p>一个并行网关，之后是三个服务任务，都使用异步操作执行。其结果是在数据库中添加了三个作业。当作业储存在数据库后，就由JobExecutor处理。JobExecutor获取作业，并将其委托至工作线程的线程池，由它们实际执行作业。这意味着通过使用异步操作，可以将工作分发至线程池（在集群场景下，甚至会在集群中跨越多个线程池）。通常这都是好事。但也有其固有问题：一致性。考虑服务任务后的并行合并：当服务任务的执行完成时到达并行合并，并需要决定等待其他执行，还是需要继续向前。这意味着，对于每一个到达并行合并的分支，都需要选择继续执行，还是需要等待其他分支上的一个或多个其他执行。</p>
</div>
<div class="paragraph">
<p>为什么这是问题呢？这是因为服务任务配置为使用异步延续，有可能所有相应的作业都同时被作业执行器处理，并委托至不同的工作线程。结果是服务执行的事务，与到达并行合并的3个独立执行所在的事务会发生重叠。如果这样，每一个独立事务都“看不到”其他事物已经并发地到达了同样的并行合并，并因此判断自己需要等待其他事务。然而，如果每个事务都判断需要等待其他事务，在并行合并后不会有继续流程的事务，而流程实例也就会永远保持这个状态。</p>
</div>
<div class="paragraph">
<p>Flowable如何解决这个问题呢？Flowable使用乐观锁。每当需要基于数据进行判断，而数据可能不是最新值（因为其他事务可能在我们提交前修改了这个数据）时，我们确保会在每个事务中都增加同一个数据库记录行的版本号。这样，无论哪个事务第一个提交，都将成功，而其他的会抛出乐观锁异常并失败。这样就解决了上面流程中讨论的问题：如果多个执行并发到达并行合并，它们都判断需要等待，增加其父执行（流程实例）的版本号并尝试提交。无论哪个执行第一个提交，都可以成功提交，而其他的将会抛出乐观锁异常并失败。因为这些执行由作业触发，Flowable会在等待给定时间后，重试执行相同的作业，期望这一次通过这个同步的网关。</p>
</div>
<div class="paragraph">
<p>这是好的解决方案么？我们可以看到乐观锁使Flowable避免不一致状态。它确保了我们不会“在合并网关卡住”，也就是说：要么所有的执行都通过网关，要么数据库中的作业能确保可以重试通过它。然而，尽管这是一个持久化与一致性角度的完美解决方案，但从更高层次看，仍然不一定总是理想行为：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Flowable只会为同一个作业重试一个固定的最大次数（默认配置为<em>3</em>次）。在这之后，作业仍然保存在数据库中，但不会再重试。这就需要手动操作来触发作业。</p>
</li>
<li>
<p>如果一个作业有非事务性的副作用，则副作用将不会由于事务失败而回滚。例如，如果"book concert tickets（预定音乐会门票）"服务与Flowable不在同一个事务中，则重试执行作业将预定多张票。</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_what_are_exclusive_jobs">什么是排他作业？</h6>
<div class="paragraph">
<p>排他作业不能与同一个流程实例中的其他排他作业同时执行。考虑上面展示的流程：如果我们将服务任务都声明为排他的，则JobExecutor将确保相关的作业都不会并发执行。相反，它将确保不论何时从特定流程实例中获取了排他作业，都会从同一个流程实例中获取所有其他的排他作业，并将它们委托至同一个工作线程。这保证了作业的顺序执行。</p>
</div>
<div class="paragraph">
<p>如何启用这个特性？从近期版本开始，排他作业成为默认配置。所有异步操作与定时器事件都默认为排他的。另外，如果希望作业成为非排他的，可以使用<code>flowable:exclusive="false"</code>配置。例如，下面的服务任务是异步，但非排他的。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;service&quot;</span> <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;${myService.performBooking(hotel, dates)}&quot;</span>
    <span class="tok-na">flowable:async=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">flowable:exclusive=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这是好的解决方案么？有很多人都在问这个问题。他们的顾虑是，这将阻止并行操作，因此会有性能问题。但也需要考虑以下两点：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果你是专家，并且知道你在做什么（并理解“为什么排他作业？”章节的内容），可以关掉排他。否则，对大多数用户来说，异步操作与定时器能够正常工作才更重要。</p>
</li>
<li>
<p>事实上不会有性能问题。只有在重负载下才会有性能问题。重负载意味着作业执行器的所有的工作线程都一直忙碌。对于排他作业，Flowable会简单的根据负载不同进行分配。排他作业意味着同一个流程实例的作业都将在同一个线程中顺序执行。但是请想一下：我们有不止一个流程实例。其他流程实例的作业将被委托至其他线程，并与本实例的作业并发执行。也就是说Flowable不会并发执行同一个流程实例的排他作业，但会并发执行多个实例。从总吞吐量角度来看，可以期望大多数场景下都可以保证实例很快地完成。此外，执行同一个流程实例中下一个作业所需的数据，已经缓存在同一个执行集群节点中。如果作业与节点没有关联关系，则可能需要重新从数据库中获取数据。</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="security">2.1.8. 流程启动认证</h4>
<div class="paragraph">
<p>默认情况下，任何人都可以启动已部署流程定义的新流程实例。可以使用流程启动认证功能定义用户与组，让Web客户端可以选择性的限制能够启动新流程实例的用户。请注意Flowable引擎<strong>不会</strong>用任何方式验证认证定义。这个功能只是为了开发人员可以简化Web客户端认证规则的实现。语法与为用户任务指派用户的语法类似：可以使用&lt;flowable:potentialStarter&gt;标签，将用户或组指派为流程的潜在启动者。这里有一个例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;potentialStarter&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:potentialStarter&gt;</span>
       <span class="tok-nt">&lt;resourceAssignmentExpression&gt;</span>
         <span class="tok-nt">&lt;formalExpression&gt;</span>group2, group(group3), user(user3)<span class="tok-nt">&lt;/formalExpression&gt;</span>
       <span class="tok-nt">&lt;/resourceAssignmentExpression&gt;</span>
    <span class="tok-nt">&lt;/flowable:potentialStarter&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>

  <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span><span class="tok-nt">/&gt;</span>
  ...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的XML中，<em>user(user3)</em>直接引用用户<em>user3</em>，而<em>group(group3)</em>引用组<em>group3</em>。不显式标明的话，默认为组。也可以使用&lt;process&gt;标签提供的&lt;flowable:candidateStarterUsers&gt;与&lt;flowable:candidateStarterGroups&gt;的属性。这里有一个例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;potentialStarter&quot;</span> <span class="tok-na">flowable:candidateStarterUsers=</span><span class="tok-s">&quot;user1, user2&quot;</span>
    <span class="tok-na">flowable:candidateStarterGroups=</span><span class="tok-s">&quot;group1&quot;</span><span class="tok-nt">&gt;</span>
    ...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这些属性可以同时使用。</p>
</div>
<div class="paragraph">
<p>在流程启动认证定义后，开发者可以使用下列方法获取该认证定义。
这段代码获取可以由给定用户启动的流程定义列表：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">processDefinitions</span> <span class="tok-o">=</span> <span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">createProcessDefinitionQuery</span><span class="tok-o">().</span><span class="tok-na">startableByUser</span><span class="tok-o">(</span><span class="tok-s">&quot;userxxx&quot;</span><span class="tok-o">).</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以获取给定流程定义中，所有定义为潜在启动者的身份关联</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">identityLinks</span> <span class="tok-o">=</span> <span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">getIdentityLinksForProcessDefinition</span><span class="tok-o">(</span><span class="tok-s">&quot;processDefinitionId&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>下面的例子展示了如何获取能够启动给定流程的用户列表：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">User</span><span class="tok-o">&gt;</span> <span class="tok-n">authorizedUsers</span> <span class="tok-o">=</span> <span class="tok-n">identityService</span><span class="tok-o">().</span><span class="tok-na">createUserQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">potentialStarter</span><span class="tok-o">(</span><span class="tok-s">&quot;processDefinitionId&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>用完全相同的方法，可以获取配置为给定流程定义的潜在启动者的组列表：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Group</span><span class="tok-o">&gt;</span> <span class="tok-n">authorizedGroups</span> <span class="tok-o">=</span> <span class="tok-n">identityService</span><span class="tok-o">().</span><span class="tok-na">createGroupQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">potentialStarter</span><span class="tok-o">(</span><span class="tok-s">&quot;processDefinitionId&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dataobjects">2.1.9. 数据对象</h4>
<div class="paragraph">
<p>BPMN提供了将数据对象定义为流程或子流程元素的一部分的可能性。根据BPMN规范，数据对象可以包含复杂的XML结构，并可以从XSD定义中引入。下列XSD类型为Flowable支持的第一批数据对象：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;dataObject</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dObj1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;StringTest&quot;</span> <span class="tok-na">itemSubjectRef=</span><span class="tok-s">&quot;xsd:string&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;dataObject</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dObj2&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;BooleanTest&quot;</span> <span class="tok-na">itemSubjectRef=</span><span class="tok-s">&quot;xsd:boolean&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;dataObject</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dObj3&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;DateTest&quot;</span> <span class="tok-na">itemSubjectRef=</span><span class="tok-s">&quot;xsd:datetime&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;dataObject</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dObj4&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;DoubleTest&quot;</span> <span class="tok-na">itemSubjectRef=</span><span class="tok-s">&quot;xsd:double&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;dataObject</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dObj5&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;IntegerTest&quot;</span> <span class="tok-na">itemSubjectRef=</span><span class="tok-s">&quot;xsd:int&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;dataObject</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dObj6&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;LongTest&quot;</span> <span class="tok-na">itemSubjectRef=</span><span class="tok-s">&quot;xsd:long&quot;</span><span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>数据对象定义使用<em>name</em>属性值作为新变量的名字，将其自动转换为流程变量。另外，Flowable也提供了为变量设置默认值的扩展元素。下面的BPMN代码片段示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dataObjectScope&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Data Object Scope&quot;</span> <span class="tok-na">isExecutable=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;dataObject</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dObj123&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;StringTest123&quot;</span> <span class="tok-na">itemSubjectRef=</span><span class="tok-s">&quot;xsd:string&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;extensionElements&gt;</span>
      <span class="tok-nt">&lt;flowable:value&gt;</span>Testing123<span class="tok-nt">&lt;/flowable:value&gt;</span>
    <span class="tok-nt">&lt;/extensionElements&gt;</span>
  <span class="tok-nt">&lt;/dataObject&gt;</span>
  ...
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cmmn_1_1">2.2. CMMN 1.1</h3>
<div class="sect3">
<h4 id="_什么是_cmmn">2.2.1. 什么是 CMMN?</h4>
<div class="paragraph">
<p>案例管理模型和标记法是由<a href="http://www.omg.org/spec/CMMN/">对象管理组织(Object Management Group,缩写为OMG)</a>为了表示案例模型而建立的标准规范.</p>
</div>
<div class="paragraph">
<p>Flowable 包含:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>一个基于CMMN1.1的模型设计器用来创建案例模型</p>
</li>
<li>
<p>一个JAVA引擎用来导入并运行CMMN1.1案例模型</p>
</li>
<li>
<p>一个动态前端页面用来执行案例模型,并允许用户查看并完成相关任务和对应表单</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_基础概念和术语">2.2.2. 基础概念和术语</h4>
<div class="paragraph">
<p>以下内容展示了一个简单的CMMN1.1图:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn-basic-concepts.png" alt="cmmn basic concepts">
</div>
</div>
<div class="paragraph">
<p>一个 <strong>案例模型</strong> 通常被看作一个包含所有的案例元素的 <em>文件夹</em>. 每个案例模型包含一个 <strong>计划模型</strong> ,其他所有的元素放在该计划模型内部.</p>
</div>
<div class="paragraph">
<p>一个计划模型中所有元素被称为 <strong>计划项</strong>. 每个计划项都一个类型及运行时相关配置项的定义.例如,上图中,有三个人工任务和一个里程碑.其他的计划项分别有 <em>流程任务、案例任务和阶段</em>.</p>
</div>
<div class="paragraph">
<p>当把一个案例模型在Flowable CMMN引擎上部署完成后, 很可能就直接启动一个基于此模型的实例. 其中的定义的计划项同样也会产成运行时的实例并且暴露出来,通过使用Flowable API可以查询得到. <strong>计划项实例</strong> 拥有基于CMMN 1.1规范定义的生命周期状态, 并且是整个引擎工作的核心. 详细内容请查阅 CMMN1.1规范的8.4.2部分.</p>
</div>
<div class="paragraph">
<p>计划项可以拥有 <em>哨兵</em>: 当使用哨兵守卫它的激活, 这个计划项相当于拥有入口凭证.这些凭证明确了触发哨兵需要满足的条件.例如,在上图中,里程碑在一个案例实例启动后为可用状态,但是当人工任务A和人工任务B都完成后,该里程碑状态由可用状态变成活跃状态.注意守卫可以在它的条件中使用不可见的复杂表达式,以便完成更多复杂的功能.同样,也可以拥有多个守卫,只需满足一个哨兵就可以出发状态的转变.</p>
</div>
<div class="paragraph">
<p>计划项和计划模型也可以拥有退出凭证的哨兵,其明确了从对应计划项退出的条件.在上图中,当人工任务C完成后,整个计划模型(包括此刻所有活跃状态的子元素)将会退出.</p>
</div>
<div class="paragraph">
<p>CMMN 1.1在XSD中定义作为规范一部分的XML标准格式. 已供参阅, 下面展示的XML代表了上述例子的案例图.</p>
</div>
<div class="paragraph">
<p>一些结论:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>XML中的四个计划项通过使用 <em>definitionRef</em> 属性关联它们自身的定义. 实际的声明是在底部的 <em>casePlanModel</em> 元素</p>
</li>
<li>
<p>拥有进入或退出凭证的计划项关联一个 <em>sentry</em> 哨兵(而不是反过来)</p>
</li>
<li>
<p>XML也包含可见案例图的信息(x 和 y坐标, 宽度和高度等等),在以下展示中已省略. 当使用其他 CMMN 1.1 模型工具用来保存正确的可视化案例图时,这些信息是重要的.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</div></td><td class="code"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-nt">&lt;definitions</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.omg.org/spec/CMMN/20151109/MODEL&quot;</span>
             <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
             <span class="tok-na">xmlns:flowable=</span><span class="tok-s">&quot;http://flowable.org/cmmn&quot;</span>
             <span class="tok-na">xmlns:cmmndi=</span><span class="tok-s">&quot;http://www.omg.org/spec/CMMN/20151109/CMMNDI&quot;</span>
             <span class="tok-na">xmlns:dc=</span><span class="tok-s">&quot;http://www.omg.org/spec/CMMN/20151109/DC&quot;</span>
             <span class="tok-na">xmlns:di=</span><span class="tok-s">&quot;http://www.omg.org/spec/CMMN/20151109/DI&quot;</span>
             <span class="tok-na">targetNamespace=</span><span class="tok-s">&quot;http://www.flowable.org/casedef&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;case</span> <span class="tok-na">id=</span><span class="tok-s">&quot;simpleExample&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Simple Example&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;casePlanModel</span> <span class="tok-na">id=</span><span class="tok-s">&quot;casePlanModel&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My Case&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Human task A&quot;</span>
            <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-88199E7C-7655-439C-810B-8849FC52D3EB&quot;</span><span class="tok-nt">&gt;&lt;/planItem&gt;</span>
      <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem2&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Milestone One&quot;</span>
            <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-8BF8A774-A8A7-4F1A-95CF-1E0D61EE5A47&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;entryCriterion</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-62CC4A6D-B29B-4129-93EA-460253C45CDF&quot;</span>
            <span class="tok-na">sentryRef=</span><span class="tok-s">&quot;sentry1&quot;</span><span class="tok-nt">&gt;&lt;/entryCriterion&gt;</span>
      <span class="tok-nt">&lt;/planItem&gt;</span>
      <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem3&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Human task B&quot;</span>
            <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-A1FB8733-0DBC-4B38-9830-CBC4D0C4B802&quot;</span><span class="tok-nt">&gt;&lt;/planItem&gt;</span>
      <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem4&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Human task C&quot;</span>
            <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-D3970AFC-7391-4BA7-95BA-51C64D2F41E9&quot;</span><span class="tok-nt">&gt;&lt;/planItem&gt;</span>
      <span class="tok-nt">&lt;sentry</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentry1&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;planItemOnPart</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentryOnPart1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;planItem1&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;standardEvent&gt;</span>complete<span class="tok-nt">&lt;/standardEvent&gt;</span>
        <span class="tok-nt">&lt;/planItemOnPart&gt;</span>
        <span class="tok-nt">&lt;planItemOnPart</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentryOnPart2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;planItem3&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;standardEvent&gt;</span>complete<span class="tok-nt">&lt;/standardEvent&gt;</span>
        <span class="tok-nt">&lt;/planItemOnPart&gt;</span>
      <span class="tok-nt">&lt;/sentry&gt;</span>
      <span class="tok-nt">&lt;sentry</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentry2&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;planItemOnPart</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentryOnPart3&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;planItem4&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;standardEvent&gt;</span>complete<span class="tok-nt">&lt;/standardEvent&gt;</span>
        <span class="tok-nt">&lt;/planItemOnPart&gt;</span>
      <span class="tok-nt">&lt;/sentry&gt;</span>
      <span class="tok-nt">&lt;humanTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-88199E7C-7655-439C-810B-8849FC52D3EB&quot;</span>
        <span class="tok-na">name=</span><span class="tok-s">&quot;Human task A&quot;</span><span class="tok-nt">&gt;&lt;/humanTask&gt;</span>
      <span class="tok-nt">&lt;milestone</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-8BF8A774-A8A7-4F1A-95CF-1E0D61EE5A47&quot;</span>
        <span class="tok-na">name=</span><span class="tok-s">&quot;Milestone One&quot;</span><span class="tok-nt">&gt;&lt;/milestone&gt;</span>
      <span class="tok-nt">&lt;humanTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-A1FB8733-0DBC-4B38-9830-CBC4D0C4B802&quot;</span>
        <span class="tok-na">name=</span><span class="tok-s">&quot;Human task B&quot;</span><span class="tok-nt">&gt;&lt;/humanTask&gt;</span>
      <span class="tok-nt">&lt;humanTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-D3970AFC-7391-4BA7-95BA-51C64D2F41E9&quot;</span>
        <span class="tok-na">name=</span><span class="tok-s">&quot;Human task C&quot;</span><span class="tok-nt">&gt;&lt;/humanTask&gt;</span>
      <span class="tok-nt">&lt;exitCriterion</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-422626DB-9B40-49D8-955E-641AB96A5BFA&quot;</span>
        <span class="tok-na">sentryRef=</span><span class="tok-s">&quot;sentry2&quot;</span><span class="tok-nt">&gt;&lt;/exitCriterion&gt;</span>
    <span class="tok-nt">&lt;/casePlanModel&gt;</span>
  <span class="tok-nt">&lt;/case&gt;</span>
  <span class="tok-nt">&lt;cmmndi:CMMNDI&gt;</span>
    <span class="tok-nt">&lt;cmmndi:CMMNDiagram</span> <span class="tok-na">id=</span><span class="tok-s">&quot;CMMNDiagram_simpleExample&quot;</span><span class="tok-nt">&gt;</span>
        ...
    <span class="tok-nt">&lt;/cmmndi:CMMNDiagram&gt;</span>
  <span class="tok-nt">&lt;/cmmndi:CMMNDI&gt;</span>
<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_程序示例">2.2.3. 程序示例</h4>
<div class="paragraph">
<p>在这个小节, 我们将会用代码构建并执行一个简单的案例模型, 通过在命令行中调用Flowable CMMN engine的Java API.</p>
</div>
<div class="paragraph">
<p>在这个案例模型中, 我们将构建一个简化的有两个阶段的 <em>employee onboarding</em> 案例: 两个时期分别在的员工入职前后.第一个阶段,HR部门中的某个人将会完成相关任务;第二个阶段,该员工完成它们.同时,在任何时间,该试用员工可以拒绝这份工作并且停止这个实例.</p>
</div>
<div class="paragraph">
<p>注意, 只有 stages and human tasks 被用到. 在真实案例模型中, 很可能会有其他类型的计划项,比如里程碑, 嵌套stage, 自动化任务等等.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.programmatic.example.png" alt="cmmn.programmatic.example">
</div>
</div>
<div class="paragraph">
<p>这个案例模型的XML如下所示:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85</div></td><td class="code"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-nt">&lt;definitions</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.omg.org/spec/CMMN/20151109/MODEL&quot;</span>
             <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
             <span class="tok-na">xmlns:flowable=</span><span class="tok-s">&quot;http://flowable.org/cmmn&quot;</span>
             <span class="tok-na">xmlns:cmmndi=</span><span class="tok-s">&quot;http://www.omg.org/spec/CMMN/20151109/CMMNDI&quot;</span>
             <span class="tok-na">xmlns:dc=</span><span class="tok-s">&quot;http://www.omg.org/spec/CMMN/20151109/DC&quot;</span>
             <span class="tok-na">xmlns:di=</span><span class="tok-s">&quot;http://www.omg.org/spec/CMMN/20151109/DI&quot;</span>
             <span class="tok-na">targetNamespace=</span><span class="tok-s">&quot;http://www.flowable.org/casedef&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;case</span> <span class="tok-na">id=</span><span class="tok-s">&quot;employeeOnboarding&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Simple Example&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;casePlanModel</span> <span class="tok-na">id=</span><span class="tok-s">&quot;casePlanModel&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My Case&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem5&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Prior to starting&quot;</span>
            <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-025D29E8-BA9B-403D-A684-8C5B52185642&quot;</span><span class="tok-nt">&gt;&lt;/planItem&gt;</span>
      <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem8&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;After starting&quot;</span>
            <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-8459EF32-4F4C-4E9B-A6E9-87FDC2299044&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;entryCriterion</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-50B5F12D-FE75-4D05-9148-86574EE6C073&quot;</span>
            <span class="tok-na">sentryRef=</span><span class="tok-s">&quot;sentry2&quot;</span><span class="tok-nt">&gt;&lt;/entryCriterion&gt;</span>
      <span class="tok-nt">&lt;/planItem&gt;</span>
      <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem9&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Reject job&quot;</span>
            <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-134E885A-3D58-417E-81E2-66A3E12334F9&quot;</span><span class="tok-nt">&gt;&lt;/planItem&gt;</span>
      <span class="tok-nt">&lt;sentry</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentry2&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;planItemOnPart</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentryOnPart4&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;planItem5&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;standardEvent&gt;</span>complete<span class="tok-nt">&lt;/standardEvent&gt;</span>
        <span class="tok-nt">&lt;/planItemOnPart&gt;</span>
      <span class="tok-nt">&lt;/sentry&gt;</span>
      <span class="tok-nt">&lt;sentry</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentry3&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;planItemOnPart</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentryOnPart5&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;planItem9&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;standardEvent&gt;</span>complete<span class="tok-nt">&lt;/standardEvent&gt;</span>
        <span class="tok-nt">&lt;/planItemOnPart&gt;</span>
      <span class="tok-nt">&lt;/sentry&gt;</span>
      <span class="tok-nt">&lt;stage</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-025D29E8-BA9B-403D-A684-8C5B52185642&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Prior to starting&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Create email address&quot;</span>
                <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-EA434DDD-E1BE-4AC1-8520-B19ACE8782D2&quot;</span><span class="tok-nt">&gt;&lt;/planItem&gt;</span>
        <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem2&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Allocate office&quot;</span>
                <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-505BA223-131A-4EF0-ABAD-485AEB0F2C96&quot;</span><span class="tok-nt">&gt;&lt;/planItem&gt;</span>
        <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem3&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Send joining letter to candidate&quot;</span>
                <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-D28DBAD5-0F5F-45F4-8553-3381199AC45F&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;entryCriterion</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-4D88C79D-8E31-4246-9541-A4F6A5720AC8&quot;</span>
            <span class="tok-na">sentryRef=</span><span class="tok-s">&quot;sentry1&quot;</span><span class="tok-nt">&gt;&lt;/entryCriterion&gt;</span>
        <span class="tok-nt">&lt;/planItem&gt;</span>
        <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem4&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Agree start date&quot;</span>
                <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-97A72C46-C0AD-477F-86DD-85EF643BB97D&quot;</span><span class="tok-nt">&gt;&lt;/planItem&gt;</span>
        <span class="tok-nt">&lt;sentry</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentry1&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;planItemOnPart</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentryOnPart1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;planItem1&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;standardEvent&gt;</span>complete<span class="tok-nt">&lt;/standardEvent&gt;</span>
          <span class="tok-nt">&lt;/planItemOnPart&gt;</span>
          <span class="tok-nt">&lt;planItemOnPart</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentryOnPart2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;planItem2&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;standardEvent&gt;</span>complete<span class="tok-nt">&lt;/standardEvent&gt;</span>
          <span class="tok-nt">&lt;/planItemOnPart&gt;</span>
          <span class="tok-nt">&lt;planItemOnPart</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentryOnPart3&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;planItem4&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;standardEvent&gt;</span>complete<span class="tok-nt">&lt;/standardEvent&gt;</span>
          <span class="tok-nt">&lt;/planItemOnPart&gt;</span>
        <span class="tok-nt">&lt;/sentry&gt;</span>
        <span class="tok-nt">&lt;humanTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-EA434DDD-E1BE-4AC1-8520-B19ACE8782D2&quot;</span>
            <span class="tok-na">name=</span><span class="tok-s">&quot;Create email address&quot;</span>
            <span class="tok-na">flowable:candidateGroups=</span><span class="tok-s">&quot;hr&quot;</span><span class="tok-nt">&gt;&lt;/humanTask&gt;</span>
        <span class="tok-nt">&lt;humanTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-505BA223-131A-4EF0-ABAD-485AEB0F2C96&quot;</span>
            <span class="tok-na">name=</span><span class="tok-s">&quot;Allocate office&quot;</span>
            <span class="tok-na">flowable:candidateGroups=</span><span class="tok-s">&quot;hr&quot;</span><span class="tok-nt">&gt;&lt;/humanTask&gt;</span>
        <span class="tok-nt">&lt;humanTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-D28DBAD5-0F5F-45F4-8553-3381199AC45F&quot;</span>
            <span class="tok-na">name=</span><span class="tok-s">&quot;Send joining letter to candidate&quot;</span>
            <span class="tok-na">flowable:candidateGroups=</span><span class="tok-s">&quot;hr&quot;</span><span class="tok-nt">&gt;&lt;/humanTask&gt;</span>
        <span class="tok-nt">&lt;humanTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-97A72C46-C0AD-477F-86DD-85EF643BB97D&quot;</span>
            <span class="tok-na">name=</span><span class="tok-s">&quot;Agree start date&quot;</span>
            <span class="tok-na">flowable:candidateGroups=</span><span class="tok-s">&quot;hr&quot;</span><span class="tok-nt">&gt;&lt;/humanTask&gt;</span>
      <span class="tok-nt">&lt;/stage&gt;</span>
      <span class="tok-nt">&lt;stage</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-8459EF32-4F4C-4E9B-A6E9-87FDC2299044&quot;</span>
        <span class="tok-na">name=</span><span class="tok-s">&quot;After starting&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem6&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;New starter training&quot;</span>
                <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-DF7B9582-11A6-40B4-B7E5-EC7AC6029387&quot;</span><span class="tok-nt">&gt;&lt;/planItem&gt;</span>
        <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem7&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Fill in paperwork&quot;</span>
                <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;sid-7BF2B421-7FA0-479D-A8BD-C22EBD09F599&quot;</span><span class="tok-nt">&gt;&lt;/planItem&gt;</span>
        <span class="tok-nt">&lt;humanTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-DF7B9582-11A6-40B4-B7E5-EC7AC6029387&quot;</span>
            <span class="tok-na">name=</span><span class="tok-s">&quot;New starter training&quot;</span>
            <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;${potentialEmployee}&quot;</span><span class="tok-nt">&gt;&lt;/humanTask&gt;</span>
        <span class="tok-nt">&lt;humanTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-7BF2B421-7FA0-479D-A8BD-C22EBD09F599&quot;</span>
            <span class="tok-na">name=</span><span class="tok-s">&quot;Fill in paperwork&quot;</span>
            <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;${potentialEmployee}&quot;</span><span class="tok-nt">&gt;&lt;/humanTask&gt;</span>
      <span class="tok-nt">&lt;/stage&gt;</span>
      <span class="tok-nt">&lt;humanTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-134E885A-3D58-417E-81E2-66A3E12334F9&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Reject job&quot;</span>
        <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;${potentialEmployee}&quot;</span><span class="tok-nt">&gt;&lt;/humanTask&gt;</span>
      <span class="tok-nt">&lt;exitCriterion</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sid-18277F30-E146-4B3E-B3C9-3F1E187EC7A8&quot;</span>
        <span class="tok-na">sentryRef=</span><span class="tok-s">&quot;sentry3&quot;</span><span class="tok-nt">&gt;&lt;/exitCriterion&gt;</span>
    <span class="tok-nt">&lt;/casePlanModel&gt;</span>
  <span class="tok-nt">&lt;/case&gt;</span>
<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>首先, 创建一个新的工程, 添加 <em>flowable-cmmn-engine</em> 依赖(这里展示了Maven), H2 数据库依赖也要添加, 后续将会使用 H2 作为内嵌的数据库.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>org.flowable<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>flowable-cmmn-engine<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>${flowable.version}<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>com.h2database<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>h2<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>${h2.version}<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Flowable CMMN API 包括了其他的 Flowable APIs 和相关概念. 同样,熟悉 BPMN 或者 DMN APIs的人很容易上手.和其他引擎一样, 第一行代码是创建一个 Cmmn引擎. 这里,默认的配置将会使用 H2作为内存数据库:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Main</span> <span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">CmmnEngine</span> <span class="tok-n">cmmnEngine</span>
        <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">StandaloneInMemCmmnEngineConfiguration</span><span class="tok-o">().</span><span class="tok-na">buildCmmnEngine</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>注意_CmmnEngineConfiguration_ 提供了很多配置项来调整 CMMN引擎的设置.</p>
</div>
<div class="paragraph">
<p>把上述 XML 放入一个文件中, 例如 <em>my-case.cmmn</em> (or .cmmn.xml). 对于Maven工程, 应该放在 <em>src/main/resources</em> 文件夹中.</p>
</div>
<div class="paragraph">
<p>为了使引擎感知当前案例模型, 它首先需要被部署 <em>deployed</em>. 这个工作由 the <em>CmmnRepositoryService</em> 完成:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">CmmnRepositoryService</span> <span class="tok-n">cmmnRepositoryService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnRepositoryService</span><span class="tok-o">();</span>
<span class="tok-n">CmmnDeployment</span> <span class="tok-n">cmmnDeployment</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRepositoryService</span><span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">addClasspathResource</span><span class="tok-o">(</span><span class="tok-s">&quot;my-case.cmmn&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当部署XML时, 会返回一个 <strong>CmmnDeployment</strong>. 一个 deployment 包含多个案例模型和目标. 一个明确的案例模型定义被存储成一个案例定义 <strong>CaseDefinition</strong>. 这可以通过执行 <em>CaseDefinitionQuery</em> 案例定义查询 来验证:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">CaseDefinition</span><span class="tok-o">&gt;</span> <span class="tok-n">caseDefinitions</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRepositoryService</span><span class="tok-o">.</span><span class="tok-na">createCaseDefinitionQuery</span><span class="tok-o">().</span><span class="tok-na">list</span><span class="tok-o">();</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Found &quot;</span> <span class="tok-o">+</span> <span class="tok-n">caseDefinitions</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; case definitions&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当在引擎中拥有一个案例定义后, 现在可以启动一个对应 <strong>CaseInstance</strong> 案例实例. 要么使用查询后的结果并传递给下面的代码片段中, 要么直接使用 the case definition的key(如下所示).</p>
</div>
<div class="paragraph">
<p>注意当启动 <strong>CaseInstance</strong>, 我们也传递了 <em>potentialEmployee</em> 作为一个标记, 这个变量之后会被用作人工任务的指派(see the <em>assignee="${potentialEmployee}"</em> attribute on <em>human tasks</em>)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">CmmnRuntimeService</span> <span class="tok-n">cmmnRuntimeService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnRuntimeService</span><span class="tok-o">();</span>
<span class="tok-n">CaseInstance</span> <span class="tok-n">caseInstance</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceBuilder</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">caseDefinitionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;employeeOnboarding&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">variable</span><span class="tok-o">(</span><span class="tok-s">&quot;potentialEmployee&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;johnDoe&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当 <strong>CaseInstance</strong> 启动后, 引擎将决定哪一个计划项应该被激活:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>第一个阶段没有入口凭证, 所以它会被激活</p>
</li>
<li>
<p>第一个阶段的子人工任务没有入口凭证, 所以它们三个也预计被激活</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在运行时, 计划项被当做 <strong>PlanItemInstances</strong>, 可以使用 <em>CmmnRuntimeService</em> 查询获取:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">PlanItemInstance</span><span class="tok-o">&gt;</span> <span class="tok-n">planItemInstances</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createPlanItemInstanceQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">caseInstanceId</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
    <span class="tok-o">.</span><span class="tok-na">orderByName</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>

<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">PlanItemInstance</span> <span class="tok-n">planItemInstance</span> <span class="tok-o">:</span> <span class="tok-n">planItemInstances</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">planItemInstance</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>打印如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>After starting
Agree start date
Allocate office
Create email address
Prior to starting
Reject job
Send joining letter to candidate</pre>
</div>
</div>
<div class="paragraph">
<p>上述打印结果中有些事情可能出乎意料:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>stages 也是属于 计划项, 同样被当做 <strong>PlanItemInstance</strong>. 注意当调用 <em>.getStageInstanceId()</em> ,子计划项实例也会拥有stage作为父类.</p>
</li>
<li>
<p><em>Send joining letter to candidate</em> 也在返回结果集中.原因是因为依据 CMMN 1.1 规范, 这个计划项实例是出于可用状态, 而不是处于活跃状态.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>进一步, 修改上述代码:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">PlanItemInstance</span> <span class="tok-n">planItemInstance</span> <span class="tok-o">:</span> <span class="tok-n">planItemInstances</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">planItemInstance</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">()</span>
        <span class="tok-o">+</span> <span class="tok-s">&quot;, state=&quot;</span> <span class="tok-o">+</span> <span class="tok-n">planItemInstance</span><span class="tok-o">.</span><span class="tok-na">getState</span><span class="tok-o">()</span>
        <span class="tok-o">+</span> <span class="tok-s">&quot;, parent stage=&quot;</span> <span class="tok-o">+</span> <span class="tok-n">planItemInstance</span><span class="tok-o">.</span><span class="tok-na">getStageInstanceId</span><span class="tok-o">());</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>现在输出如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>After starting, state=available, parent stage=null
Agree start date, state=active, parent stage=fe37ac97-b016-11e7-b3ad-acde48001122
Allocate office, state=active, parent stage=fe37ac97-b016-11e7-b3ad-acde48001122
Create email address, state=active, parent stage=fe37ac97-b016-11e7-b3ad-acde48001122
Prior to starting, state=active, parent stage=null
Reject job, state=active, parent stage=fe37ac97-b016-11e7-b3ad-acde48001122
Send joining letter to candidate, state=available, parent stage=fe37ac97-b016-11e7-b3ad-acde48001122</pre>
</div>
</div>
<div class="paragraph">
<p>为了只显示活跃状态的计划项实例, 查询可以调整并增加 <em>planItemInstanceStateActive()</em> 方法:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">PlanItemInstance</span><span class="tok-o">&gt;</span> <span class="tok-n">planItemInstances</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createPlanItemInstanceQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">caseInstanceId</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
    <span class="tok-o">.</span><span class="tok-na">planItemInstanceStateActive</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">orderByName</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>现在输出如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Agree start date
Allocate office
Create email address
Prior to starting
Reject job</pre>
</div>
</div>
<div class="paragraph">
<p>当然, <strong>PlanItemInstance</strong> 是 低级别的表示, 但是每个计划项也拥有一个  <em>plan item definition</em>  明确其类型. 在这个例子中, 我们只有 <em>human tasks</em>.通过使用 计划项实例 来影响整个 案例实例,
(比如, <em>CmmnRuntimeService.triggerPlanItemInstance(String planItemInstanceId)</em>).然而, 交互最有可能通过实际计划项定义的结果发生: 比如这里的人工任务.</p>
</div>
<div class="paragraph">
<p>任务的查询方法和BPMN 引擎一样, (实际上, 任务服务是一个共享的组件, BPMN或者CMMN创建的任务都可以通过各自引擎查询得到):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-n">CmmnTaskService</span> <span class="tok-n">cmmnTaskService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnTaskService</span><span class="tok-o">();</span>
<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">hrTasks</span> <span class="tok-o">=</span> <span class="tok-n">cmmnTaskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">taskCandidateGroup</span><span class="tok-o">(</span><span class="tok-s">&quot;hr&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">caseInstanceId</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
    <span class="tok-o">.</span><span class="tok-na">orderByTaskName</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">:</span> <span class="tok-n">hrTasks</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Task for HR : &quot;</span> <span class="tok-o">+</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
<span class="tok-o">}</span>

<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">employeeTasks</span> <span class="tok-o">=</span> <span class="tok-n">cmmnTaskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">taskAssignee</span><span class="tok-o">(</span><span class="tok-s">&quot;johndoe&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">orderByTaskName</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">:</span> <span class="tok-n">employeeTasks</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Task for employee: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">task</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>上述输出:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Task for HR : Agree start date
Task for HR : Allocate office
Task for HR : Create email address

Task for employee: Reject job</pre>
</div>
</div>
<div class="paragraph">
<p>当HR的三个任务都完成, 给求职者发送入职信的任务应该是可用的:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">:</span> <span class="tok-n">hrTasks</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">cmmnTaskService</span><span class="tok-o">.</span><span class="tok-na">complete</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
<span class="tok-o">}</span>

<span class="tok-n">hrTasks</span> <span class="tok-o">=</span> <span class="tok-n">cmmnTaskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">taskCandidateGroup</span><span class="tok-o">(</span><span class="tok-s">&quot;hr&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">caseInstanceId</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
    <span class="tok-o">.</span><span class="tok-na">orderByTaskName</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>

<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">:</span> <span class="tok-n">hrTasks</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Task for HR : &quot;</span> <span class="tok-o">+</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>事实上, 预期的任务现在被创建了:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Task for HR : Send joining letter to candidate</pre>
</div>
</div>
<div class="paragraph">
<p>完成这个任务,案例实例将进入第二个阶段, 同时第一阶段的哨兵的条件得到满足. 'Reject job&#8217;任务被程序自动创建, 并且指派给员工的两个任务也被创建:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-n">Task</span> <span class="tok-k">for</span> <span class="tok-n">employee</span><span class="tok-o">:</span> <span class="tok-n">Fill</span> <span class="tok-n">in</span> <span class="tok-n">paperwork</span>
<span class="tok-n">Task</span> <span class="tok-k">for</span> <span class="tok-n">employee</span><span class="tok-o">:</span> <span class="tok-n">New</span> <span class="tok-n">starter</span> <span class="tok-n">training</span>
<span class="tok-n">Task</span> <span class="tok-k">for</span> <span class="tok-n">employee</span><span class="tok-o">:</span> <span class="tok-n">Reject</span> <span class="tok-n">job</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>完成所有任务将结束整个案例实例:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>List&lt;Task&gt; tasks = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).listPage(0, 1);
while (!tasks.isEmpty()) {
    cmmnTaskService.complete(tasks.get(0).getId());
    tasks = cmmnTaskService.createTaskQuery()
        .caseInstanceId(caseInstance.getId())
        .listPage(0, 1);
}</pre>
</div>
</div>
<div class="paragraph">
<p>当执行案例实例时, 引擎也会保存历史信息, 这可以通过查询API获取:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-n">CmmnHistoryService</span> <span class="tok-n">cmmnHistoryService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnHistoryService</span><span class="tok-o">();</span>
<span class="tok-n">HistoricCaseInstance</span> <span class="tok-n">historicCaseInstance</span> <span class="tok-o">=</span> <span class="tok-n">cmmnHistoryService</span><span class="tok-o">.</span><span class="tok-na">createHistoricCaseInstanceQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">caseInstanceId</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
    <span class="tok-o">.</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>

<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Case instance execution took &quot;</span>
    <span class="tok-o">+</span> <span class="tok-o">(</span><span class="tok-n">historicCaseInstance</span><span class="tok-o">.</span><span class="tok-na">getEndTime</span><span class="tok-o">().</span><span class="tok-na">getTime</span><span class="tok-o">()</span> <span class="tok-o">-</span> <span class="tok-n">historicCaseInstance</span><span class="tok-o">.</span><span class="tok-na">getStartTime</span><span class="tok-o">().</span><span class="tok-na">getTime</span><span class="tok-o">())</span> <span class="tok-o">+</span> <span class="tok-s">&quot; ms&quot;</span><span class="tok-o">);</span>

<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">HistoricTaskInstance</span><span class="tok-o">&gt;</span> <span class="tok-n">historicTaskInstances</span> <span class="tok-o">=</span> <span class="tok-n">cmmnHistoryService</span><span class="tok-o">.</span><span class="tok-na">createHistoricTaskInstanceQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">caseInstanceId</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
    <span class="tok-o">.</span><span class="tok-na">orderByTaskCreateTime</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>

<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">HistoricTaskInstance</span> <span class="tok-n">historicTaskInstance</span> <span class="tok-o">:</span> <span class="tok-n">historicTaskInstances</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Task completed: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">historicTaskInstance</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>输出如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Case instance execution took 149 ms
Task completed: Reject job
Task completed: Agree start date
Task completed: Allocate office
Task completed: Create email address
Task completed: Send joining letter to candidate
Task completed: New starter training
Task completed: Fill in paperwork</pre>
</div>
</div>
<div class="paragraph">
<p>案例执行相关的历史数据以特殊的结构被收集, 比如 Tasks (上面所见的), milestones, cases, variables and 一般的 plan items.
这个数据作为运行时数据被持久化, 但是不会在实例结束后被删除.访问历史数据可以通过 <em>CmmnHistoryService</em> 的相关API</p>
</div>
<div class="paragraph">
<p>当然, 这只是Flowable CMMN Engine所有可用的APIs中的一小部分,请查阅其他章节了解更多详情</p>
</div>
</div>
<div class="sect3">
<h4 id="_cmmn_1_1_constructs">2.2.4. CMMN 1.1 Constructs</h4>
<div class="paragraph">
<p>这个小节 覆盖了 Flowable支持的 CMMN 1.1设计, 同时也是对 CMMN 1.1 标准的拓展</p>
</div>
<div class="paragraph">
<p>下述设计, 除了哨兵和item 控制, 都是依据 CMMN规范中的计划项作为参考.它们实例执行的历史数据可用通过 <em>CmmnHistoryService</em> 使用 <em>org.flowable.cmmn.api.history.HistoricPlanItemInstanceQuery</em> 方法获取.</p>
</div>
<div class="sect4">
<h5 id="_阶段">阶段</h5>
<div class="paragraph">
<p>一个 stage 被看作一组计划项的集合, 它通常用于在案例实例中定义"阶段"</p>
</div>
<div class="paragraph">
<p>一个 stage 本事也是计划项, 也拥有进入和退出凭证. 计划项以及它包含的计划项只有在计入活跃状态才可用, stage 可以内嵌在其他stage中.
A stage is visualized as a rectangle with angled corners:</p>
</div>
<div class="paragraph">
<p>a stage 可以看作是一个有尖角的矩形</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.stage.png" alt="cmmn.stage">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_任务">任务</h5>
<div class="paragraph">
<p>一个手动任务, 意味着它将在引擎外部发生.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: 表达式将会在运行时被解析当做任务名称</p>
</li>
<li>
<p><strong>blocking</strong>: 布尔值决定是否任务被阻塞</p>
</li>
<li>
<p><strong>blockingExpression</strong>: 表达式 计算成布尔值决定该任务是否被阻塞</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>如果一个任务是 非阻塞non-blocking, 引擎将在执行时自动完成它. 如果一个任务被阻塞blocking, 这个任务对应的计划项实例会被保持活跃状态active state,
直到以编程方式触发( <em>CmmnRuntimeService.triggerPlanItemInstance(String planItemInstanceId)</em> 方法).</p>
</div>
<div class="paragraph">
<p>一个任务看作一个圆角矩形:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.task.png" alt="cmmn.task">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_人工任务">人工任务</h5>
<div class="paragraph">
<p>一个人工任务用作模型化需要人完成的工作, 比如表单. 当引擎抵达一个人工任务, 被指派的人工或组对应的任务列表就会新增加一项.</p>
</div>
<div class="paragraph">
<p>一个人工任务也是一个计划项, 这意味着除了人工任务本身之外，还创建了一个 <em>PlanItemInstance</em>,并且可以通过 <em>PlanItemInstanceQuery</em> 查询它.</p>
</div>
<div class="paragraph">
<p>人工任务可以通过 <em>org.flowable.task.api.TaskQuery</em> API 查询.历史数据可以通过 <em>org.flowable.task.api.history.HistoricTaskInstanceQuery</em> 查询.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="paragraph">
<p>属性:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: 被用作该人工任务的名称</p>
</li>
<li>
<p><strong>blocking</strong>: 布尔值决定该任务是否被阻塞</p>
</li>
<li>
<p><strong>blockingExpression</strong>: 表达式计算得到布尔值决定任务是否被阻塞</p>
</li>
<li>
<p><strong>assignee</strong> : 表达式(可以是静态文本) 决定该任务的指派人</p>
</li>
<li>
<p><strong>owner</strong> : 表达式(可以是静态文本)决定该任务的拥有者</p>
</li>
<li>
<p><strong>candidateUsers</strong> : 表达式(可以是静态文本)解析成以逗号分隔的字符串,被用作决定该人工任务的候选人列表</p>
</li>
<li>
<p><strong>candidateGroups</strong> : 表达式(可以是静态文本)解析成以逗号分隔的字符串,被用作决定该人工任务的候选组列表</p>
</li>
<li>
<p><strong>form key</strong>: 表达式决定使用表单的key, 后续通过API访问</p>
</li>
<li>
<p><strong>Due date</strong> 过期时间 解析为 java.util.Date or a ISO-8601 date string</p>
</li>
<li>
<p><strong>Priority</strong>: 优先级 解析为整型, 可以用来在 TaskQuery API中筛选任务</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>一个人工任务看作一个圆角矩形, 左上角有一个用户图标</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.humantask.png" alt="cmmn.humantask">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_java_服务任务">Java 服务任务</h5>
<div class="paragraph">
<p>服务任务被用作执行自定义逻辑.</p>
</div>
<div class="paragraph">
<p>自定义逻辑要放在一个实现 <em>org.flowable.cmmn.api.delegate.PlanItemJavaDelegate</em> 接口的类中.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyJavaDelegate</span> <span class="tok-kd">implements</span> <span class="tok-n">PlanItemJavaDelegate</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">DelegatePlanItemInstance</span> <span class="tok-n">planItemInstance</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">String</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">)</span> <span class="tok-n">planItemInstance</span><span class="tok-o">.</span><span class="tok-na">getVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;someVariable&quot;</span><span class="tok-o">);</span>
        <span class="tok-o">...</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>对于一些高级实现,使用 <em>PlanItemJavaDelegate</em> 可能不能覆盖到, <em>CmmnActivityBehavior_可以被使用(类似于 BPMN 引擎中的 _JavaDelegate</em> vs <em>ActivityBehavior</em>)</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="paragraph">
<p>属性:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: 服务任务service task的名称</p>
</li>
<li>
<p><strong>class</strong>: 自定义逻辑的Java实现类</p>
</li>
<li>
<p><strong>class fields</strong>: 调用自定义逻辑时的传递参数</p>
</li>
<li>
<p><strong>Delegate expression</strong>: 表达式解析为一个实现_PlanItemJavaDelegate_接口的类</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>一个 服务任务service task 看作一个圆角矩形, 左上角有个齿轮图标</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.servicetask.png" alt="cmmn.servicetask">
</div>
</div>
<div class="paragraph">
<p>====决策任务</p>
</div>
<div class="paragraph">
<p>一个决策任务调用外部 DMN 决策表，并在case实例中存储结果变量</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="paragraph">
<p>属性:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Decision table reference</strong>: 相关的需要被执行 DMN 决策表.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>通过设置'<em>Throw error if no rules were hit</em>'属性, 当在 DMN 决策表计算过程中没有命中任何规则时, 可能会抛出错误.</p>
</div>
<div class="paragraph">
<p>一个 服务任务service task 看作一个圆角矩形, 左上角有个表格图标</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.decisiontask.png" alt="cmmn.decisiontask">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_http请求任务">http请求任务</h5>
<div class="paragraph">
<p>Http Task http请求任务是 <em>service task</em> 一个开箱即用的实现,被用作调用一个http REST 服务.</p>
</div>
<div class="paragraph">
<p>Http Task http请求任务包含多个参数来自定义请求和响应. 查阅  BPMN http task documentation 了解更多参数设置的细节</p>
</div>
<div class="paragraph">
<p>一个 服务任务service task 看作一个圆角矩形, 左上角有个火箭图标</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.httptask.png" alt="cmmn.httptask">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_脚本任务">脚本任务</h5>
<div class="paragraph">
<p>脚本任务类似 BPMN 中脚本任务, 当一个计划项变成活跃状态, 用来执行一个脚本.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="paragraph">
<p>属性:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: 表示任务名称</p>
</li>
<li>
<p><strong>type</strong>: 任务属性, 必须是"script", 表示该任务类型</p>
</li>
<li>
<p><strong>scriptFormat</strong>: 拓展属性 表示脚本语言(例如, javascript, groovy)</p>
</li>
<li>
<p><strong>script</strong>: 执行的脚本, 在"script"元素中作为一个string</p>
</li>
<li>
<p><strong>autoStoreVariables</strong>: 可选的任务属性标记 (默认: false) 表示脚本中定义的变量是否保存到计划项实例上下文中 (查看下面注意事项note)</p>
</li>
<li>
<p><strong>resultVariableName</strong>: 可选的任务属性 明确脚本执行结果保存到计划项实例上下文中对应的名称 (查看下面注意事项note)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>一个 服务任务service task 看作一个圆角矩形, 左上角有个脚本图标</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.scripttask.png" alt="cmmn.scripttask">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;scriptPlanItem&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Script Plan Item&quot;</span> <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;myScriptTask&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;task</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My Script Task Item&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;script&quot;</span> <span class="tok-na">flowable:scriptFormat=</span><span class="tok-s">&quot;JavaScript&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;documentation&gt;</span>Optional documentation<span class="tok-nt">&lt;/documentation&gt;</span>
    <span class="tok-nt">&lt;extensionElements&gt;</span>
        <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;script&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;string&gt;</span>
                sum = 0;
                for ( i in inputArray ) {
                    sum += i;
                }
            <span class="tok-nt">&lt;/string&gt;</span>
        <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/task&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note</strong>: <strong>scriptFormat</strong> 属性值必须符合 <a href="http://jcp.org/en/jsr/detail?id=223">JSR-223</a> (scripting for the Java platform).
默认, JavaScript 包含在每个JDK里, 不需要额外的JAR文件. 如果你想使用另外 (JSR-223 兼容) 脚本引擎, 在classpath中添加对应的Jar文件并使用合适的名称.
例如, Flowable 单元测试 经常使用 Groovy, 因为其语法和 JAVA 相像.</p>
</div>
<div class="paragraph">
<p>注意Groovy脚本引擎是绑定在groovy-jsr223 JAR, 这样, 必须添加下面的依赖:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>org.codehaus.groovy<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>groovy-jsr223<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>2.x.x<span class="tok-nt">&lt;version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在脚本任务中, 所有案例变量 variables 都可以通过 PlanItem 实例在脚本中访问.在下面的例子中, 脚本变量 <em>'inputArray'</em> 实际上是一个案例变量variable(一个整型数组)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;script&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;string&gt;</span>
    sum = 0
    for ( i in inputArray ) {
      sum += i
    }
    <span class="tok-nt">&lt;/string&gt;</span>
<span class="tok-nt">&lt;/flowable:field&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note</strong>: 通过在脚本中调用 <em>planItemInstance.setVariable("variableName", variableValue)</em>, 可以设置计划项实例的变量值.默认不会保存任务变量.
通过设置 <em>autoStoreVariables_属性值为true, 也可以自动保存在脚本中定义的变量(例如, 上述实例中的sum).然而, 最好是不要显示调用 _planItemInstance.setVariable("variableName", variableValue)</em>
,在某些版本的JDK中, 一些脚本语言自动保存变量会不起作用. 查阅 <a href="http://www.jorambarrez.be/blog/2013/03/25/bug-on-jdk-1-7-0_17-when-using-scripttask-in-activiti/">链接</a> 了解更多细节</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;task</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Script Task&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;script&quot;</span> <span class="tok-na">flowable:scriptFormat=</span><span class="tok-s">&quot;groovy&quot;</span> <span class="tok-na">flowable:autoStoreVariables=</span><span class="tok-s">&quot;false&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The default for this parameter is <code>false</code>, meaning that if the parameter is omitted from the script task definition, all the declared variables will only exist during the duration of the script.</p>
</div>
<div class="paragraph">
<p>该参数默认是false, 意味着在脚本定义中省略, 所有脚本中声明的变量只会存在于脚本执行过程中.</p>
</div>
<div class="paragraph">
<p>这是一个在脚本中如何设置变量的例子:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;script&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;string&gt;</span>
    def scriptVar = &quot;test123&quot;
    planItemInstance.setVariable(&quot;myVar&quot;, scriptVar)
    <span class="tok-nt">&lt;/string&gt;</span>
<span class="tok-nt">&lt;/flowable:field&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>以下名称是预留的, 不能被使用: <strong>out, out:print, lang:import, context, elcontext</strong>.</p>
</div>
<div class="paragraph">
<p><strong>Note</strong> 脚本任务的返回值可以被分配给一个已经存在或者新的计划项实例变量, 通过在脚本任务定义中设置_'flowable:resultVariable'_ 属性值.任何已经存在的相同名称变量的值会被脚本返回值覆盖.当未明确设置返回结果变量名, 脚本的返回值会被忽略.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;task</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Script Task&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;script&quot;</span> <span class="tok-na">flowable:scriptFormat=</span><span class="tok-s">&quot;groovy&quot;</span> <span class="tok-na">flowable:resultVariable=</span><span class="tok-s">&quot;myVar&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;script&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;string&gt;</span>#{echo}<span class="tok-nt">&lt;/string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
<span class="tok-nt">&lt;/task&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在上述实例中, 当脚本执行结束后, 脚本的返回值( <em>'#{echo}'</em>的解析值)会被设置成名称为 <em>'myVar'</em> 的流程变量值.</p>
</div>
</div>
<div class="sect4">
<h5 id="_里程碑">里程碑</h5>
<div class="paragraph">
<p>里程碑被用作标记到达案例实例中的某个点. 在运行时, 它们被称为 <strong>MilestoneInstances</strong> , 可以通过调用 <em>CmmnRuntimeService</em> 的 <strong>MilestoneInstanceQuery</strong> 查询. 也可以通过 <em>CmmnHistoryService</em> 获取一个历史副本.</p>
</div>
<div class="paragraph">
<p>里程碑也是计划项, 这意味着除了里程碑条目外, <em>PlanItemInstance</em> 同样会被创建, 通过_PlanItemInstanceQuery_ 可以查询到.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="paragraph">
<p>属性:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: 一个表达式或者静态文本, 决定里程碑名称</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>里程碑被看作一个圆角矩形(比任务更圆一些)</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.milestone.png" alt="cmmn.milestone">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_案例任务">案例任务</h5>
<div class="paragraph">
<p>用例任务用作在一个案例上下文中启动一个子案例. <em>CaseInstanceQuery</em> 有一些选项查询父类案例.</p>
</div>
<div class="paragraph">
<p>当一个案例任务被阻塞, <em>PlanItemInstance</em> 将会处于活跃状态, 直到子案例全部完成.如果案例任务是非阻塞, 子案例启动后, 计划项实例自动完成.当子案例实例结束对父类没有影响.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="paragraph">
<p>属性:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: 表达式或静态文本, 决定名称</p>
</li>
<li>
<p><strong>blocking</strong>: 布尔值决定任务是否被阻塞</p>
</li>
<li>
<p><strong>blockingExpression</strong>: 表达式计算得到布尔值决定任务是否被阻塞</p>
</li>
<li>
<p><strong>Case reference</strong>: 案例定义的key, 用来启动一个子实例.可以是一个表达式</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>一个案例任务看作一个圆角矩形, 左上角有一个case 图标</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.casetask.png" alt="cmmn.casetask">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_流程任务">流程任务</h5>
<div class="paragraph">
<p>流程任务被用作在案例上下文中启动一个流程实例</p>
</div>
<div class="paragraph">
<p>当流程任务被阻塞, <em>PlanItemInstance</em> 将会一直 活跃_active_状态, 直到 流程实例全部完成. 如果流程任务非阻塞, 流程实例任务启动并且计划项实例自动完成, 当流程实例结束对父类没有任何影响.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="paragraph">
<p>属性:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: 表达式或静态文本, 决定名称</p>
</li>
<li>
<p><strong>blocking</strong>: 布尔值决定任务是否被阻塞</p>
</li>
<li>
<p><strong>blockingExpression</strong>: 表达式计算得到布尔值决定任务是否被阻塞</p>
</li>
<li>
<p><strong>Process reference</strong>: 案例定义的key, 用来启动一个子实例.可以是一个表达式</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>一个流程任务看作一个圆角矩形, 左上角有个箭头图标</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.processtask.png" alt="cmmn.processtask">
</div>
</div>
<div class="paragraph">
<p>流程任务可以配置为具有内部和外部参数，这些参数的形式是_source/sourceExpression_ and <em>target/targetExpression</em>.</p>
</div>
<div class="paragraph">
<p>内部参数在当前案例实例上下文内被解析.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>source</em> value 将把一个case实例变量, 映射成一个流程变量</p>
</li>
<li>
<p>或者, the <em>sourceExpression</em> 允许创建任意值，其中表达式根据case实例解析.</p>
</li>
<li>
<p><em>target</em> 是流程变量的名称, 是被_source_映射</p>
</li>
<li>
<p>或者, _targetExpression_将被解析成一个 <strong>string</strong>, 用作流程实例的变量名称.表达式根据case实例上下文解析.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>内部参数在当前流程实例(全局)上下文内被解析.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>source</em> value will be the process instance variable which value will be mapped to a case variable</p>
</li>
<li>
<p><em>source</em> value 将把一个流程变量值, 映射成一个case变量</p>
</li>
<li>
<p>或者, the <em>sourceExpression</em> 允许创建任意值，其中表达式根据流程实例解析.</p>
</li>
<li>
<p><em>target</em> 是流程变量的名称, 是被_source_映射</p>
</li>
<li>
<p>或者, _targetExpression_将被解析成一个 <strong>string</strong>, 用作case实例的变量名称.表达式根据流程实例(全局)上下文解析.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_凭证">凭证</h5>
<div class="sect5">
<h6 id="_入口凭证_入口哨兵">入口凭证 (入口哨兵)</h6>
<div class="paragraph">
<p>进入凭证构成一个计划项实例的哨兵, 它们由两部分组成:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One or more parts that depend on other plan items: these define dependencies on state transitions of other plan items. For example, one human task can depend on the state transition <em>complete</em> of three other human tasks to become active itself</p>
</li>
<li>
<p>一个或者多个部分依赖其他计划项: 它们依赖其他计划项状态的转变.例如一个人工任务取决于另外三个人工任务的完成,才能变成活跃状态.</p>
</li>
<li>
<p>One optional <em>if part</em> or <em>condition</em>: this is an expression that allows the definition of a complex condition
*一个可选的如果部分或条件: 允许定义一个复杂条件的表达式</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A sentry is satisfied when all its criteria are resolved to <em>true</em>. When a criterion evaluates to true, this is stored and remembered for future evaluations. Note that entry criteria of all plan item instances in the <em>available</em> state are evaluated whenever something changes in the case instance.
Multiple sentries are possible on a plan item. However, when one is satisfied, the plan item moves from state <em>available</em> to <em>active</em>.</p>
</div>
<div class="paragraph">
<p>一个哨兵只有所有凭证解析为 <em>true</em>, 才会满足条件. 当一个凭证被解析为true, 将会被存储以便后续计算. 注意当case实例中发生更改时，将计算处于可用状态的所有计划项实例的入口条件.
多个哨兵可能会用在一个计划项, 然而当一个哨兵满足条件, 该计划项状态会从可用 <em>available</em> 变成活跃 <em>active</em>.</p>
</div>
<div class="paragraph">
<p>See <a href="#cmmn_sentry_evaluation">the section on sentry evaluation</a> for more information.</p>
</div>
<div class="paragraph">
<p>查阅 <a href="#cmmn_sentry_evaluation">the section on sentry evaluation</a>, 了解更多详情.</p>
</div>
<div class="paragraph">
<p>An entry criterion is visualized as a diamond shape (white color inside) on the border of a plan item:</p>
</div>
<div class="paragraph">
<p>入口哨兵被看作一个菱形(内部白色),位于计划项边界上:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.entrycriteria.png" alt="cmmn.entrycriteria">
</div>
</div>
</div>
<div class="sect5">
<h6 id="_exit_criterion_exit_sentry">Exit criterion (exit sentry)</h6>

</div>
<div class="sect5">
<h6 id="_exit_criterion_exit_sentry_出口凭证_出口哨兵">Exit criterion (exit sentry) 出口凭证 (出口哨兵)</h6>
<div class="paragraph">
<p>Exit criteria form a sentry for a given plan item instance. They consist of two parts:</p>
</div>
<div class="paragraph">
<p>进入凭证构成一个计划项实例的哨兵, 它们由两部分组成:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One or more parts that depend on other plan items: these define dependencies on state transitions of other plan items. For example, one human task can depend on reaching a certain milestone to be automatically terminated</p>
</li>
<li>
<p>一个或者多个部分依赖其他计划项: 它们依赖其他计划项状态的转变.例如一个人工任务取决于另外三个人工任务的完成,才能变成活跃状态.</p>
</li>
<li>
<p>One optional <em>if part</em> or <em>condition</em>: this is an expression that allows a complex condition to be defined
*一个可选的如果部分或条件: 允许定义一个复杂条件的表达式</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A sentry is satisfied when all its criteria are resolved to <em>true</em>. When a criterion evaluates to true, this is stored and remembered for future evaluations. Note that exit criteria of all plan item instances in the <em>active</em> state are evaluated whenever something changes in the case instance.
Multiple sentries are possible on a plan item. However, when one is satisfied, the plan item moves from state <em>active</em> to <em>exit</em>.</p>
</div>
<div class="paragraph">
<p>一个哨兵只有所有凭证解析为 <em>true</em>, 才会满足条件. 当一个凭证被解析为true, 将会被存储以便后续计算. 注意当case实例中发生更改时，将计算处于可用状态的所有计划项实例的入口条件.
多个哨兵可能会用在一个计划项, 然而当一个哨兵满足条件, 该计划项状态会从活跃 <em>active</em> 变成退出  <em>exit</em>.</p>
</div>
<div class="paragraph">
<p>See <a href="#cmmn_sentry_evaluation">the section on sentry evaluation</a> for more information.</p>
</div>
<div class="paragraph">
<p>查阅 <a href="#cmmn_sentry_evaluation">the section on sentry evaluation</a> 了解更多.</p>
</div>
<div class="paragraph">
<p>An exit criterion is visualized as a diamond shape (white color inside) on the border of a plan item:</p>
</div>
<div class="paragraph">
<p>出口哨兵被看作一个菱形(内部黑色),位于计划项边界上:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.exitcriteria.png" alt="cmmn.exitcriteria">
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_event_listeners">Event Listeners</h5>

</div>
<div class="sect4">
<h5 id="_event_listeners_事件监听器">Event Listeners 事件监听器</h5>
<div class="sect5">
<h6 id="_timer_event_listener">Timer Event Listener</h6>

</div>
<div class="sect5">
<h6 id="_timer_event_listener_计时器事件监听器">Timer Event Listener 计时器事件监听器</h6>
<div class="paragraph">
<p>A timer event listener is used when the passing of time needs to be captured in a case model.</p>
</div>
<div class="paragraph">
<p>计时器事件监听器在一个case模型中被用作捕获时间的传递.</p>
</div>
<div class="paragraph">
<p>A timer event listener is not a task and has a simpler plan item lifecycle compared to a <em>task</em>: the timer will simply move from <em>available</em> to <em>completed</em> when the event (in this case, the time passing) occurs.</p>
</div>
<div class="paragraph">
<p>计时器事件监听器不是一个任务, 相比于任务, 拥有更简单的生命周期: 当一个事件(比如, 时间传递)发生时, 计时器简单从可用 <em>available</em> 状态变成完成 <em>completed</em> 状态.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="paragraph">
<p>属性:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Timer expression</strong>: an expression that defines when the timer should occur. The following options are possible:</p>
</li>
<li>
<p><strong>Timer expression</strong>: 表达式定义计时器何时发生. 以下是可能的使用配置:</p>
<div class="ulist">
<ul>
<li>
<p>An expression resolving to a java.util.Date or org.joda.time.DateTime instance (for example, _${someBean.calculateNextDate(someCaseInstanceVariable)})</p>
</li>
<li>
<p>表达式被解析成 a java.util.Date or org.joda.time.DateTime instance (例如,  <em>${someBean.calculateNextDate(someCaseInstanceVariable)}</em>)</p>
</li>
<li>
<p>An ISO8601 date</p>
</li>
<li>
<p>ISO8601 格式日期</p>
</li>
<li>
<p>An ISO8601 duration String (for example, <em>PT5H</em>, indicating the timer should fire in 5 hours from instantiation)</p>
</li>
<li>
<p>ISO8601 格式 持续String (例如, <em>PT5H</em>, 表示计时器应在实例化后5小时启动)</p>
</li>
<li>
<p>AN ISO8601 repetition String (for example, R5/PT2H, indicating the timer should fire 5 times, each time waiting 2 hours)</p>
</li>
<li>
<p>ISO8601 循环时间周期 (例如, R5/PT2H, 表示总共触发5次, 每次间隔2小时)</p>
</li>
<li>
<p>A String containing a cron expression</p>
</li>
<li>
<p>cron表达式指定</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Start trigger plan item/event</strong>: reference to a plan item in the case model that triggers the start of the timer event listener</p>
</li>
<li>
<p><strong>Start trigger plan item/event</strong>: 引用case模型中计划项, 用来触发计时器事件监听器的开始.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that setting a <em>start trigger</em> for the timer event listener does not have a visual indicator in the case model, unlike entry/exit criteria on sentries.</p>
</div>
<div class="paragraph">
<p>注意 设置计时器事件监听器的 <em>start trigger</em> 属性在case 模型中没有可视化指示, 不像入口/出口哨兵的凭证.</p>
</div>
<div class="paragraph">
<p>A timer event listener is visualized as circle with a clock icon inside:</p>
</div>
<div class="paragraph">
<p>计时器事件监听器看作一个圆, 里面有一个钟表图标:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.timereventlistener.png" alt="cmmn.timereventlistener">
</div>
</div>
</div>
<div class="sect5">
<h6 id="_user_event_listener">User Event Listener</h6>

</div>
<div class="sect5">
<h6 id="_user_event_listener_用户事件监听器">User Event Listener 用户事件监听器</h6>
<div class="paragraph">
<p>A user event listener can be used when needing to capture a user interaction that directly influences a case state,
instead of indirectly via impacting variables or information in the case.
A typical use case for a user event listener are buttons in a UI that a user can click to drive the state of the case instance.
When the event is triggered an <em>Occur</em> event is thrown to which sentries can listener to.
Like timer event listeners, it has a much simpler lifecycle that a <em>task</em>.</p>
</div>
<div class="paragraph">
<p>一个用户事件监听器被用作捕获一个直接影响案例状态而不是间接影响变量或者案例信息的用户交互. 一个典型的例子就是界面的按钮,用户点击后改变case实例的状态.
当 事件被触发, <em>Occur</em> event会被抛出, 并且被哨兵所捕获. 类似计时器事件监听器, 相比任务,它也有一个更为简单的生命周期.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.usereventlistener.png" alt="cmmn.usereventlistener">
</div>
</div>
<div class="paragraph">
<p>User event listeners can be queried using the <em>org.flowable.cmmn.api.runtime.UserEventListenerInstanceQuery</em>. Such a query can be created by calling the <em>cmmnRuntimeService.createUserEventListenerInstanceQuery()</em> method. Note that a user event listener is also a plan item instance, which means it can also be queried through the <em>org.flowable.cmmn.api.runtime.PlanItemInstanceQuery</em> API.</p>
</div>
<div class="paragraph">
<p>用户事件监听器可以使用 <em>org.flowable.cmmn.api.runtime.UserEventListenerInstanceQuery</em> 查询. 类似调用 the <em>cmmnRuntimeService.createUserEventListenerInstanceQuery()</em> 方法.
注意:也是一个计划项实例, 意味着也可以通过 the <em>org.flowable.cmmn.api.runtime.PlanItemInstanceQuery</em> API 查询.</p>
</div>
<div class="paragraph">
<p>A user event listener can be completed by calling the <em>cmmnRuntimeService.completeUserEventListenerInstance(id)</em> method.</p>
</div>
<div class="paragraph">
<p>用户事件监听器可以通过调用 <em>cmmnRuntimeService.completeUserEventListenerInstance(id)</em> 方法来完成.</p>
</div>
</div>
<div class="sect5">
<h6 id="_generic_event_listener">Generic Event Listener</h6>

</div>
<div class="sect5">
<h6 id="_generic_event_listener_一般事件监听器">Generic Event Listener 一般事件监听器</h6>
<div class="paragraph">
<p>A generic event listener is used to typically model a programmatic interaction (e.g. a external system that calls out to change something in a case instance).</p>
</div>
<div class="paragraph">
<p>一般事件监听器通常被用作编程交互建模(例如, 一个外部系统在一个case实例中调用来更改某些东西)</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.generic-event-listener.png" alt="cmmn.generic event listener">
</div>
</div>
<div class="paragraph">
<p>The API to retrieve and complete these event listeners is on the <em>CmmnRuntimeService</em>:</p>
</div>
<div class="paragraph">
<p>通过 <em>CmmnRuntimeService</em> 来获取和完成这些事件监听器</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">GenericEventListenerInstanceQuery</span> <span class="tok-nf">createGenericEventListenerInstanceQuery</span><span class="tok-o">();</span>
<span class="tok-kt">void</span> <span class="tok-nf">completeGenericEventListenerInstance</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">genericEventListenerInstanceId</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Similar to <em>user event listeners</em>, this API is a wrapper on top of the <em>PlanItemInstance</em> queries and operations. This means that the data can also be retrieved through the regular <em>PlanItemInstanceQuery</em></p>
</div>
<div class="paragraph">
<p>和  <em>user event listeners</em> 类似, 这个 API 是 <em>PlanItemInstance</em> 查询和操作顶部的包装. 这意味着数据也可以从  <em>PlanItemInstanceQuery</em> 获取.</p>
</div>
<div class="paragraph">
<p>Note that generic event listeners are not part of the CMMN specification, but are a Flowable-specific addition.</p>
</div>
<div class="paragraph">
<p>注意 一般事件监听器不是 CMMN 规范的内容, 而是 Flowable-规范 的补充</p>
</div>
</div>
<div class="sect5">
<h6 id="_automatic_removal_of_event_listeners">Automatic removal of event listeners</h6>

</div>
<div class="sect5">
<h6 id="_automatic_removal_of_event_listeners_自动移除事件监听器">Automatic removal of event listeners 自动移除事件监听器</h6>
<div class="paragraph">
<p>The engine will automatically detect when event listeners (user or timer) are not useful anymore.
Take for example the following case definition:</p>
</div>
<div class="paragraph">
<p>引擎会自动监测不再使用的事件监听器(用户或者定时器), 例如下面的case定义:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.user-event-listener-removal-1.png" alt="cmmn.user event listener removal 1">
</div>
</div>
<div class="paragraph">
<p>Here, the <em>First stage</em> contains two human tasks (A and B) and it can be exited by a user when the <em>Stop first stage</em> user event is triggered.
However, when both taks A and B are completed, the stage will also complete. If now the user event listener would be triggered, there is nothing that listens to this event anymore.
The engine will detect this and terminate the user event automatically.</p>
</div>
<div class="paragraph">
<p>这里, 第一个阶段,包含两个人工任务(A 和 B), 并且当停止第一个阶段事件被触发, 该阶段会被终止. 然而, 当 A 和 B 都完成后, 该阶段stage 也会完成.
如果这个时候触发用户事件监听器, 将会不起任何作用. 此时引擎将会检测到,并自动决定该用户事件.</p>
</div>
<div class="paragraph">
<p>The same mechanism also works for event listeners that are referenced by entry sentries:</p>
</div>
<div class="paragraph">
<p>相同的原理, 适用于两个入口哨兵的监听器场景:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.user-event-listener-removal-2.png" alt="cmmn.user event listener removal 2">
</div>
</div>
<div class="paragraph">
<p>In this case, in the case that <em>EventListenerA</em> would be triggered, <em>EventListenerB</em> is terminated (as nothing is listening to its occurrence anymore).</p>
</div>
<div class="paragraph">
<p>在这种场景, 如果  <em>EventListenerA</em> 被触发, <em>EventListenerB</em> 会终止(因为没有任何在监听B的发生)</p>
</div>
<div class="paragraph">
<p>Or, when timer and user event listeners are mixed, the one that is triggered first will also cause the removal of others (when they are not referenced somewhere else):</p>
</div>
<div class="paragraph">
<p>或者, 当定时器和用户事件监听器被混合使用, 首先被触发的一个会造成其他的移除(当他们没有被别的地方引用)</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.user-event-listener-removal-3.png" alt="cmmn.user event listener removal 3">
</div>
</div>
<div class="paragraph">
<p>Here, the timer will be removed in case the user event is triggered first (and vice versa).</p>
</div>
<div class="paragraph">
<p>这里, 定时器会被移除, 如果用户件事监听首先被触发.(反之亦然)</p>
</div>
<div class="paragraph">
<p>The detection also takes in account plan items that have not yet been created. Take for example the following case definition:</p>
</div>
<div class="paragraph">
<p>检测还考虑到尚未创建的计划项.如下图所示:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.user-event-listener-removal-4.png" alt="cmmn.user event listener removal 4">
</div>
</div>
<div class="paragraph">
<p>Here, human task <em>C</em> is not yet created when a case instance is started for this case definition. The user event listener will not be removed as long that <em>C</em> has a parent stage that is in a non-terminal state, as this means that the event could still be listened to in the future.</p>
</div>
<div class="paragraph">
<p>这里, 当case 实例启动后, 人工任务C还未被创建. 只要C具有处于非终止 non-terminal 状态的父级，就不会删除用户事件监听器.这意味着该事件可以在未来依然被监听</p>
</div>
</div>
<div class="sect5">
<h6 id="_available_condition">Available condition</h6>

</div>
<div class="sect5">
<h6 id="_available_condition_可用条件">Available condition 可用条件</h6>
<div class="paragraph">
<p>All types of event listeners can be configured to have a <strong>available condition</strong>: an expressions that will guard the available state of the event listener. To explain the use case, take the following case definition:</p>
</div>
<div class="paragraph">
<p>所有类型的事件监听器都拥有一个 <strong>available condition</strong>: 一个表达式用来维护事件监听器的可用状态.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.create-condition.png" alt="cmmn.create condition">
</div>
</div>
<div class="paragraph">
<p>When the case instance is started, Stage 1 (as it has no entry criteria) will be moving immediately from <em>available</em> to <em>active</em>. Similar story for human task A. Human task B will move from <em>available</em> to <em>enabled</em> as it&#8217;s manually activated.</p>
</div>
<div class="paragraph">
<p>当 case实例启动后, stage 1 (没有入口凭证)将立即从可用状态变成活跃状态. 人工任务A类似. 手动激活人工任务B, 它的状态从 <em>available</em> to <em>enabled</em>.</p>
</div>
<div class="paragraph">
<p>Normally, also the event listener would become <em>available</em>. The life cycle of event listeners is simpler than that of plan items such as human tasks: an event listener stays in the <em>available</em> state until the event happens. There&#8217;s no <em>active</em> state like for other plan items.
This means that a user could trigger it after start and the stage would be exited.</p>
</div>
<div class="paragraph">
<p>正常来讲, 事件监听器状态也会变成 <em>available</em>. 事件监听器的生命周期比其他计划项(比如人工任务)简单: 事件监听器保持可用状态, 直到事件发生. 这里没有类似其他计划项一样拥有活跃状态,
这意味着 一个用户可以在开始之后触发它, 然后stage将会退出.</p>
</div>
<div class="paragraph">
<p>In some use case however, the event listener shouldn&#8217;t be <em>available</em> for the user to interact with (or a timer shouldn&#8217;t start, when using a timer event listener) unless a certain condition is true.</p>
</div>
<div class="paragraph">
<p>在一些场景中,除非一个明确满足true的条件, 否则事件监听器不应该可供用户交互(或者当使用定时器监听时, 一个定时器不应该开始) .</p>
</div>
<div class="paragraph">
<p>In the example above, we want to only create it when the stage doesn&#8217;t have any active children (or required) anymore. Setting the <strong>availableCondition</strong> to <strong>${cmmn:isStageCompletable()}</strong> will allow the event listener to be created which makes it move immediately to <em>available</em>. Concretely in this model, when human task A is completed Stage 1 becomes <em>completable</em> (as human task B is manually activated and non-required). This makes the <em>availbleCondition</em> of the event listener <em>true</em> and the event listener is now available for a user to decide to exit the stage.</p>
</div>
<div class="paragraph">
<p>在上述例子中, 我们想要只在该阶段没有任何活跃元素时创建它. 设置 <strong>availableCondition</strong> to <strong>${cmmn:isStageCompletable()}</strong> 将允许事件监听器被创建, 使得它状态立即变成可用.
在这个模型中具体讲, 当人工任务 A 完成, stage 1 变成可完成(因为人工任务B是手动激活的，并且不是必需的)。这使得事件监听器的可用条件变为true, 同时用户也可以决定是否退出该阶段.</p>
</div>
<div class="paragraph">
<p>Note: this is a Flowable specific addition to the CMMN specification. Without this addition, the event listener would have to be nested within a substage which is protected with entry criteria that listens to the completion of task A.</p>
</div>
<div class="paragraph">
<p>注意: 这是一个 Flowable 规范对CMMN规范的特定添加.如果没有此添加，则事件监听器将必须嵌套在子阶段中，该子阶段受入口凭证监听任务 A 完成的保护。</p>
</div>
<div class="paragraph">
<p>Note: if this were an autocompletable stage, the engine would complete the stage automatically when A completes.</p>
</div>
<div class="paragraph">
<p>注意: 如果是一个可以自动完成的阶段stage, 引擎在A完成时, 自动完成该阶段stage.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_item_control_repetition_rule">Item control: Repetition Rule</h5>

</div>
<div class="sect4">
<h5 id="_item_control_repetition_rule_条目控制_重复规则">Item control: Repetition Rule 条目控制: 重复规则</h5>
<div class="paragraph">
<p>Plan items on the case model can have a <em>repetition rule</em>: an expression that can be used to indicate a certain plan item needs to be repeated.
When no expression is set, but the repetition is enabled (for example, the checkbox is checked in the Flowable Modeler) or the expression is empty, a <em>true</em> value is assumed by default.</p>
</div>
<div class="paragraph">
<p>案例模型中的计划项可以具有重复规则 <em>repetition rule</em> ：一个表达式，可用于指示某个计划项目需要重复。
如果未设置表达式，但启用了重复（例如，在 <em>Flowable Modeler</em> 模型设计器中勾选了复选框）或表达式为空，则默认为 <em>true</em>。</p>
</div>
<div class="paragraph">
<p>An optional <em>repetition counter variable</em> can be set, which holds the index (one-based) of the instance. If not set, the default variable name is <em>repeitionCounter</em>.</p>
</div>
<div class="paragraph">
<p>可以设置一个可选的 <em>repetition counter variable_属性，它将保存一个实例对应的索引(从1开始). 如果未设置,默认的变量名为 _repeitionCounter</em>.</p>
</div>
<div class="paragraph">
<p>If the plan item does not have any entry criteria, the repetition rule expression is evaluated when the plan item is completed or terminated. If the expression resolved to <em>true</em>, a new instance is created. For example, a human task with a repetition rule expression <em>${repetitionCounter &lt; 3}</em>, will create three sequential human tasks.</p>
</div>
<div class="paragraph">
<p>如果一个计划项没有设置入口凭证, 当它完成或则停止时,重复准则表达式都会计算. 如果解析为true, 则创建一个新的实例. 例如, 一个人工人有表达式 <em>${repetitionCounter &lt; 3}</em>, 将会创建3个有序的人工任务.</p>
</div>
<div class="paragraph">
<p>If the plan item has entry criteria, the behavior is different. The repetition rule is not evaluated on completion or termination, but when a sentry of the plan item is satisfied. If both the sentry is satisfied and the repetition rule evaluates to true, a new instance is created.</p>
</div>
<div class="paragraph">
<p>如果计划项有设置入口凭证, 表现是不同的. 当完成或中止时, 重复规则不会计算. 只有满足哨兵的条件才会计算.如果同时满足哨兵条件并且重复准则计算为true, 一个新的实例才会被创建.</p>
</div>
<div class="paragraph">
<p>Take, for example, the following timer event listener followed by a human task. The sentry has one entry criterion for the <em>occur</em> event of the timer event listener. Note that enabling and setting the repetition rule on the task has a visual indicator at the bottom of the rectangle.</p>
</div>
<div class="paragraph">
<p>例如，下面的计时器事件监听器后面跟着一个人工任务。哨兵对于计时器事件监听器的发生事件有一个入口凭证。注意，在任务上启用和设置重复规则都会在矩形底部有一个可视指示器。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.repeatingtimereventlistener.png" alt="cmmn.repeatingtimereventlistener">
</div>
</div>
<div class="paragraph">
<p>If the timer event listener is repeating (for example, <em>R/PT1H</em>), the <em>occur</em> event will be fired every hour. When the repetition rule expression of the human task evaluates to true, a new human task instance will be created each hour.</p>
</div>
<div class="paragraph">
<p>如果定时器事件监听器是可重复的(例如, <em>R/PT1H</em>), 每间隔1小时,发生事件 <em>occur</em> event 会被触发. 当人工任务的重复准则计算为true, 每隔1小时,一个新的人工任务实例会被创建.</p>
</div>
<div class="paragraph">
<p>Note that Flowable allows to have repeating user and generic event listeners. This is contrary to the CMMN specification (which disallows it), but we believe it is needed for having a more flexible way of using event listeners (for example to model a case where a user might multiple times trigger an action that leads to the creation of tasks).</p>
</div>
<div class="paragraph">
<p>注意, Flowable 允许拥有可重复的用户和一般事件监听器. 这和 CMMN 准则是相反的. 但是我们相信拥有一个更加灵活的方式使用时间监听器是需要的(例如在一个用户需要多次触发一个动作来创建人物的案例模型)</p>
</div>
</div>
<div class="sect4">
<h5 id="_item_control_manual_activation_rule">Item control: Manual Activation Rule</h5>

</div>
<div class="sect4">
<h5 id="_item_control_manual_activation_rule_条目控制_手动激活准则">Item control: Manual Activation Rule 条目控制: 手动激活准则</h5>
<div class="paragraph">
<p>Plan items on the case model can have a <em>manual activation rule</em>: an expression that can be used to indicate a certain plan item needs to be <em>manually activated by an end-user</em>.
When no expression is set, but the manual activation is enabled (for example, the checkbox is checked in the Flowable Modeler) or the expression is empty, a <em>true</em> value is assumed by default.</p>
</div>
<div class="paragraph">
<p>案例模型中的计划项可以拥有一个手动激活准则: 一个表达式被提供给终端用户手动激活一个确定的计划项. 当未设置任何表达式, 但是启用了手动激活(例如, Flowable Modeler 中的复选框被选中)
或者表达式为空, 默认值为true.</p>
</div>
<div class="paragraph">
<p>Stages and all task types can be marked for manual activation. Visually, the task or stage will get a <em>play</em> icon (small triangle pointing to the right) to indicate an end-user will have to manually activate it:</p>
</div>
<div class="paragraph">
<p>阶段stage 和所有类型任务都可以设置手动激活. 可视化地, 任务或者阶段stage 将会有一个 播放图标 <em>play</em> icon(一个指向右侧的小三角形),指明用户需要手动去激活它.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.manual-activation.png" alt="cmmn.manual activation">
</div>
</div>
<div class="paragraph">
<p>Normally, when a sentry for a plan item is satisfied (or the plan item doesn&#8217;t have any sentries) the plan item instance is automatically moved to the <em>ACTIVE</em> state. When a manual activation is set though, and it evaluates to true, the plan item instance now becomes <em>ENABLED</em> instead of <em>ACTIVE</em>. As the name implies, the idea behind this is that end-users manually have to activate the plan item instance. A typical use case is showing a list of buttons of potential plan item instances that can currently be started by the end user.</p>
</div>
<div class="paragraph">
<p>正常来讲, 当一个计划项的哨兵条件得到满足(或者没有任何哨兵), 计划项将自动转为活跃状态 <em>ACTIVE</em>. 当设置了手动激活,并且计算结果为true,计划项从活跃状态 <em>ACTIVE</em> 变为已启用状态 <em>ENABLED</em>. 正如名称所示, 背后的想法就是指终端用户需要手动激活计划项.
一个典型的用例就是一个潜在计划项实例的按钮列表.而这些按钮目前可以由最终用户启动.</p>
</div>
<div class="paragraph">
<p>为了启动一个可启动的计划项实例,  可以使用 <em>CmmnRuntimeService</em> 的 <em>startPlanItemInstance</em> 方法:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">PlanItemInstance</span><span class="tok-o">&gt;</span> <span class="tok-n">enabledPlanItemInstances</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createPlanItemInstanceQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">caseInstanceId</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
    <span class="tok-o">.</span><span class="tok-na">planItemInstanceStateEnabled</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>

<span class="tok-c1">// ...</span>

<span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">startPlanItemInstance</span><span class="tok-o">(</span><span class="tok-n">planItemInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>注意,任务的行为只在计划项实例进入活动状态时被执行。例如，对于人工任务，只有在调用 <em>startPlanItemInstance</em> 方法之后才会创建用户任务。</p>
</div>
<div class="paragraph">
<p>已启动的计划项实例可以转变为 禁用状态 <em>DISABLED</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">disablePlanItemInstance</span><span class="tok-o">(</span><span class="tok-n">planItemInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Disabled plan item instances can be enabled again:</p>
</div>
<div class="paragraph">
<p>禁用的计划项也可以重新被启动:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">enablePlanItemInstance</span><span class="tok-o">(</span><span class="tok-n">planItemInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>注意, 在决定阶段或案例实例终止时，禁用状态 <em>DISABLED</em> 被视为“终端”状态. 这意味着当只有禁用的计划项实例存在，案例实例将终止.</p>
</div>
</div>
<div class="sect4">
<h5 id="_item_control_required_rule">Item control: Required Rule</h5>
<div class="paragraph">
<p>案例模型中的计划项可以拥有一个要求准则 <em>required rule</em>: 一个表达式被用作被外部stage 或者案例模型要求执行的一个计划项.这可以用来表明案例模型中的计划项哪些是必须的,哪些是可选的.</p>
</div>
<div class="paragraph">
<p>当未设置任何表达式, 但是启用了 <em>required rule</em> (例如, Flowable Modeler 中的复选框被选中)或者表达式为空, 默认值为true.</p>
</div>
<div class="paragraph">
<p><em>required rule</em> 与 父类 stage的 <em>autoComplete</em> 属性一起使用:
* 如果 <em>autoComplete</em> 为 <em>false</em>, 这个也是默认值, <strong>all</strong> 所有子计划项实例必须处于最终状态(完成、终止，等等), 以便由引擎完成阶段计划项实例.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果 <em>autoComplete</em> 为 <em>true</em>, 需要所有要求准则计算为true的子计划项实例进入最终状态. 如果这没有其他处于活跃状态的子元素, 父类阶段 stage 将自动完成.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>阶段stage 拥有一个 <strong>completeable</strong> 属性来用作表示当前条件是否得到满足来完成该stage. 例如, 下面的简单阶段stage, 假设一个哨兵的条件为true, 另一个为false, 则意味着
左边的计划项实例将进入活跃状态, 右侧的将进入可用状态.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.completeable-stage.png" alt="cmmn.completeable stage">
</div>
</div>
<div class="paragraph">
<p>调用 <em>cmmnRuntimeService.completeStagePlanItemInstance(String stagePlanItemInstanceId)</em> 完成当前stage是不可能的(抛出异常),
因为有一个活跃状态的子元素存在. 当左侧的用户任务完成, 因为当前没有子元素活跃, <em>completeStagePlanItemInstance</em> 会被调用.
但是对于它自身, 阶段stage 不会自动完成, 因为右边的用户任务还处于可用状态.</p>
</div>
<div class="paragraph">
<p>如果上面的阶段stage 设置为 <strong>autoCompleteable</strong> (在底部有一个黑色的小矩形), 右边的计划项设置为必须的(有一个可见的感叹号标记), 表现会不同:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.completeable-stage02.png" alt="cmmn.completeable stage02">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>如果左边计划项实例是活跃(哨兵为true), 右边不是(哨兵为false). 这种情况下, 当左边任务完成后, stage 实例将会自动完成并且所有必须的计划项实例进入最终状态.</p>
</li>
<li>
<p>如果左右俩个任务都是活跃状态(哨兵都为true)</p>
<div class="ulist">
<ul>
<li>
<p>当左边任务完成后, 因为右边实例还处于活跃zhuangt, 当前阶段stage 不会自动完成.</p>
</li>
<li>
<p>当右边任务完成后, 因为左边必须的任务不是出于最终状态(活跃), 当前阶段 stage不会自动完成.</p>
</li>
</ul>
</div>
</li>
<li>
<p>如果左边任务不是活跃状态, 右边出于活跃. 这种情况下, 当右边任务完成后, 当前阶段stage 不会自动完成, 因为左边必须的任务不是出于一个最终状态. 只有左边任务出于活跃并且完成后, 才能完成当前阶段 stage.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>注意, 手动激活规则独立于要求准则. 例如, 以下阶段stage:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.completeable-stage03.png" alt="cmmn.completeable stage03">
</div>
</div>
<div class="paragraph">
<p>这里, 用户任务D是必须的, 任务B是需要手动激活.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果D完成, 当前stage将自动完成. 因为B不是必须的并且不是活跃状态.</p>
</li>
<li>
<p>如果B也是必须的, 即使D已经完成, 还是需要手动激活B(调用 <em>cmmnRuntimeService.startPlanItemInstance(String planItemInstanceId)</em>), 然后当前阶段stage 才能自动完成.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_item_control_completion_neutral_rule">Item control: Completion Neutral Rule</h5>
<div class="paragraph">
<p>案例模型中的计划项可以拥有一个中立完成准则 <em>completion neutral rule</em>: 一个表达式被用作对于完成父类stage 或者案例模型, 一个计划项是中立的(非必须).
这可以用来表明案例模型中的计划项哪些是必须的,哪些是可选的. 相比在某些时候使用 required rule 和 autoComplete, 会更加灵活.</p>
</div>
<div class="paragraph">
<p>注意,  中立完成准则 <em>Completion Neutral Rule</em> 不是 CMMN 1.1规范, 是 Flowable 规范的补充.</p>
</div>
<div class="paragraph">
<p>依照规范, 出于 <strong>AVAILABLE</strong> 可用状态的阶段 stage 不能被完成, 除非 <em>autoComplete</em> 属性为true, 并且计划项不是必须的. 例如, 一个计划项保持可用 <strong>AVAILABLE</strong> 状态, 哨兵条件未满足. 这意味
除非计划项被标记为非必须,并且 父类 stage 设置 <em>autoComplete</em>, 否则 父类stage 不会完成. 缺点是, 一旦一个阶段被标记为自动完成，所有子计划项目都需要为所需的规则进行配置, 这在某些用例中是冗长和繁重的工作</p>
</div>
<div class="paragraph">
<p>中立完成准则 <em>Completion Neutral Rule</em>, 与 autoComplete-required 机制相反，完成中立规则从“自底向上”工作:一个计划项目可以单独标记为中立,而无需标记任何其他计划项目.</p>
</div>
<div class="paragraph">
<p>当计划项都计算为true, <em>Required Rule</em> 优先.</p>
</div>
<div class="paragraph">
<p>To summarize:
总结:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>一个计划项设置为 <em>"completion neutral"</em>, 如果他出于活跃 <strong>AVAILABLE</strong> 状态(等待一个入口哨兵凭证), 将允许 父类stage 自动完成. 这意味着一个计划项目相对于它的父阶段完成评估是中立的.</p>
</li>
<li>
<p>在以下条件中, 一个 stage 会保持活跃 <strong>ACTIVE</strong> 状态:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>它拥有至少一个出于活跃状态的计划项</p>
</li>
<li>
<p>它拥有至少一个带有 <em>requiredRule</em> , 处于可用 <strong>AVAILABLE</strong> 或者 启用 <strong>ENABLE</strong> 状态的计划项.</p>
</li>
<li>
<p>它没有被标记为 <em>autoComplete</em>, 拥有至少一个 计划项处于 启用 <strong>ENABLED</strong> 状态 (不管 必须准则 <em>requiredRule</em>)</p>
</li>
<li>
<p>它没有被标记为 <em>autoComplete</em>, 拥有至少一个 计划项处于 可用 <strong>AVAILABLE</strong> 状态并且 不是 完成中立 <em>completionNeutral</em></p>
</li>
</ol>
</div>
</li>
<li>
<p>一个阶段 将会完成:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>它不包含子元素, 或者所有子计划项 都是处于 一个 终止 <em>Terminal</em> 或者 半终止 <em>Semi-terminal</em> 状态 (关闭, 完成, 禁用, 失败)</p>
</li>
<li>
<p>它没有标记为 <em>autoComplete</em> 且所有存在的子计划项处于 可用 <strong>AVAILABLE</strong> 状态, 并且是 完成中立 <em>completionNeutral</em> ,而不是必须的</p>
</li>
<li>
<p>它标记为 <em>autoComplete</em> 且所有子计划项非必须 <em>not required</em>, 处于 已启用 <strong>ENABLED</strong> 或者 可用 <strong>AVAILABLE</strong> 状态. (不管 完成中立 <em>completionNeutral</em>, 要求准则优先)</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cmmn_sentry_evaluation">2.2.5. Sentry evaluation</h4>

</div>
<div class="sect3">
<h4 id="_哨兵计算">2.2.6. 哨兵计算</h4>
<div class="paragraph">
<p>在任何案例定义中, 哨兵扮演一个重要的角色. 它们提供了一个强大的声明式配置方式来激活正确的计划项或者自动停止.因此，Flowable CMMN 引擎核心逻辑最重要的部分之一是计算哨兵，以查看在一个案例实例中发生了什么状态更改。</p>
</div>
<div class="sect4">
<h5 id="_什么时候计算哨兵">什么时候计算哨兵?</h5>
<div class="paragraph">
<p>在任何状态发生改变或者新事件发生,具体地说，这意味着:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>当一个案例实例启动.</p>
</li>
<li>
<p>当一个等待状态的计划项被触发继续.(比如人工任务)</p>
</li>
<li>
<p>当案例实例相关变量发生改变(新增, 修改, 或删除)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>*当计划项实例状态改变(比如 通过 RuntimeService 停止, 一个手动计划项启动,等等)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>当RuntimeService#evaluateCriteria 方法手动触发.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>伴随着状态改变的进行, 引擎会有计划地一直对当前活跃的哨兵进行计算.例如，假设一个人工任务的完成满足另一个人工任务的出口哨兵。第二个人工任务的状态更改将再次使用此新信息对所有活动哨兵进行新的评估。当最后一次评估没有发生变化时，引擎认为状态稳定，停止计算.</p>
</div>
</div>
<div class="sect4">
<h5 id="_concepts_概念">Concepts 概念</h5>
<div class="paragraph">
<p>哨兵包含两部分:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>与其他计划项生命周期相关的一个或者多个 <em>onParts</em></p>
</li>
<li>
<p>零个或者一个 if条件</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>注意以下案例定义:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.sentry-eval-01.png" alt="cmmn.sentry eval 01">
</div>
</div>
<div class="paragraph">
<p>假设(上图中未展示出来)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>任务C的入口哨兵监听任务 A和B的完成 <em>complete</em> 事件</p>
</li>
<li>
<p>出口哨兵监听 用户事件监听器的发生 <em>occur</em> 事件 <em>'Stop  C'</em></p>
</li>
<li>
<p>入口哨兵有个表达式设置为 <em>${var:eq(myVar, <em>hello world</em>)}</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在这个简单例子中, 入口哨兵 有两个 onParts 和 一个 ifPart. 退出哨兵只有一个 onPart.</p>
</div>
<div class="paragraph">
<p>当案例实例启动后, 人工任务A和B被创建(他们没有入口哨兵), 很快进入活跃 <em>active</em> 状态. C因为入口哨兵条件不满足, 处于可用 <em>available</em> 状态. 用户事件监听器“Stop C”从一开始就可用，因此可以被触发.</p>
</div>
<div class="paragraph">
<p>当任务A和B都完成并且变量 <em>myVar</em> 设置为 <em>'hello world'</em>, 入口哨兵条件满足并且触发. C后面的计划项实例被移动到active状态, 同时,人工任务C被创建(例如，现在可以通过 <em>TaskService</em> 查询它).
当&#8217;Stop C&#8217;被触发(通过 <em>CmmnRuntimeService#completeUserEventListenerInstance</em> 方法),出口哨兵条件满足, C被中止.</p>
</div>
<div class="paragraph">
<p>如果 <em>'Stop C'</em> 在 C变成活跃 <em>active</em> 状态前被触发, 它的计划项实例将被中止, 出口哨兵也将不再监听任何.</p>
</div>
</div>
<div class="sect4">
<h5 id="_默认行为">默认行为</h5>
<div class="paragraph">
<p>当一个案例实例启动后</p>
</div>
<div class="listingblock">
<div class="content">
<pre>CaseInstance caseInstance = cmmnRuntimeService.createCaseInstanceBuilder()
    .caseDefinitionKey("myCase")
    .start();</pre>
</div>
</div>
<div class="paragraph">
<p>入口哨兵条件会立即被计算, 因此当案例实例启动会有一个有序的循环计算.</p>
</div>
<div class="paragraph">
<p>注意, 如果使用像_${myVar == <em>hello world</em>}_ 条件表达式不会起作用. 引擎会抛出 PropertyNotFound 异常, 因为它不知道 变量myVar.</p>
</div>
<div class="paragraph">
<p>为了解决上述问题:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在启动时传一个 <em>myVar</em> 变量</p>
</li>
<li>
<p>做一个非空校验, 类似 <em>${planItemInstance.getVariable(<em>myVar</em>) != null &amp;&amp; planItemInstance.getVariable(<em>myVar</em>) == <em>hello world</em>}</em></p>
</li>
<li>
<p>或者更简单地, 使用 表达式函数 <a href="#cmmnExpressionsFunctions">expression functions</a> , 类似 <em>${var:eq(myVar, <em>hello world</em>)}</em> 考虑到变量可能不存在的情况</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>默认的计算逻辑有“缓存”，这意味着当哨兵的一部分条件得到满足时，引擎将存储并在随后的计算中并"记住"这个值.</strong></p>
</div>
<div class="paragraph">
<p>这意味着, 从某一部分(onPart或ifPart of the sentry)得到满足的那一刻起, 该特定部分在下一次评估中不再被评估, 而是被认为是正确的.</p>
</div>
<div class="paragraph">
<p>在上述例子中,这是任务A相对于B通常会在另一个时间点完成。例如,如果任务A完成后,任务C哨兵的一部分说“我监听任务A完成“得到满意,这事实上为将来被缓存。如果现在B完成了,
它也被存储。如果 <em>myVar</em> 变量得到正确的值，ifPart也会触发，整个岗兵和任务C也会被激活。当然，也可以先满足变量值，然后再满足任务. 关键是这并不重要,因为引擎会保存之前满足的部分条件</p>
</div>
<div class="paragraph">
<p>这是流程引擎的默认行为, 可以设置 哨兵 <em>triggerMode</em> 为 <strong>default</strong> 覆盖. 在Flowable Modeler 中增加一个新计划项时自动被设置.
当不设置(例如从另一个工具导入模型)时, <em>triggerMode</em> 默认是 <strong>default</strong>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_trigger_mode_onevent_事件触发模式">Trigger mode "onEvent" 事件触发模式</h5>
<div class="paragraph">
<p>默认行为(查看前面部分)是保存先前被满足的部分. 这是最常用和最安全的方法(也是对哨兵进行推理时通常期望的方法).</p>
</div>
<div class="paragraph">
<p>另一种哨兵触发模式称为“onEvent”。在这种模式下，引擎将有关于哨兵的部分保存，不会保存*not remember*过去满足的任何部分。这在高级用例中有时是需要的。以下面的例子为例:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.sentry-eval-02.png" alt="cmmn.sentry eval 02">
</div>
</div>
<div class="paragraph">
<p>这里, 案例模型是一个有三个子阶段stage. 所有子阶段都可以重复. 子阶段B和C有一个入口哨兵用来等待阶段A的完成. 同理(未展示出来), 两个哨兵都有一个变量的依赖条件.</p>
</div>
<div class="paragraph">
<p>在高级用例中, 可能想要或需要哨兵部分(特别是包含条件的ifPart)仅在相关计划项的生命周期事件发生时才进行计算。在本例中，正是Stage A的完成事件。
对于这些用例，可以将哨兵的 <em>triggerMode</em> 设置为onEvent。顾名思义，这意味着哨兵的计算只在引用事件发生时发生，而不考虑对过去事件的缓存。</p>
</div>
<div class="paragraph">
<p>具体地说, 在这里的例子中，只有在阶段A完成时(而不是在其他时刻)才会计算入口哨兵的情况. 这与一般的评价规则有很大的不同.
在这个特殊的例子中,它确实使管理变量变得更容易, 因为条件只在一个精确的时刻进行评估，并且不需要担心由于某个变量在某个时间点的具体值而触发某个哨兵的部分.
特别是在本例中，所有子阶段都在重复，这需要做很多工作。这是一种功能强大的机制，但对于高级建模人员来说，这意味着他们对案例模型和这种 <em>triggerMode</em> 的语义具有内在的知识.</p>
</div>
<div class="paragraph">
<p>注意，在计算哨兵时，引擎认为所有的事件都是同时发生的。以下面的案例定义为例:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.sentry-eval-03.png" alt="cmmn.sentry eval 03">
</div>
</div>
<div class="paragraph">
<p>假设所有的哨兵使用 <em>triggerMode onEvent</em> 的设置. 如果任务A完成, 这会使任务B退出, 任务C也会退出. 所以,即使有两种截然不同的生命周期事件(A被完成和B被退出),人们可能会认为 <em>onEvent</em> 的字面意思是,
有两种截然不同的计算发生, 而另一部分C的退出哨兵的缓存被忘记.引擎足够聪明地看到,他们是相同的计算周期且任务C也将退出.</p>
</div>
<div class="paragraph">
<p>从技术上讲: <em>onEvent</em> 哨兵存在缓存，更具体地说，是用于在同一API调用(或事务，简单地说)期间发生的计算.</p>
</div>
<div class="paragraph">
<p><strong>Important</strong> onEvent是一种功能强大的机制，只有当很好地理解语义时才应该使用它。如果不仔细检查用例，可能会创建由于没有正确的配置哨兵而卡住的用例模型。</p>
</div>
<div class="paragraph">
<p>(例如, 假设一个哨兵有一个onPart监听一个计划项的完成情况，还有一个带有条件的ifPart。如果计划项完成, 从而触发onPart, 但是由于某种原因缺少了条件中使用的变量…… ifPart将永远不会触发，case实例可能会陷在一个不想要的状态).</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bpmn20">2.3. DMN 1.1 入门</h3>
<div class="sect3">
<h4 id="whatIsDmn">2.3.1. 什么是DMN？</h4>
<div class="paragraph">
<p>Decision Model &amp; Notation(DMN)是由<a href="http://www.omg.org/spec/DMN/1.1">对象管理组（OMG）</a>发布的标准。它是描述和构建组织内可重复决策的标准方法，以确保决策模型在各组织之间是通用的。</p>
</div>
</div>
<div class="sect3">
<h4 id="dmnDefiningDecision">2.3.2. 什么是DMN定义？</h4>
<div class="paragraph">
<p>DMN 1.1模式的根元素是<strong>definitions</strong>。在这个项目中可以定义多个决策定义(尽管我们建议每个文件中只有一个决策定义，这可以简化开发过程的后期维护)。每个决策可以定义一个表达式。目前，Flowable支持几种表达式类型中的<strong>决策表</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.omg.org/spec/DMN/20151101&quot;</span>
  <span class="tok-na">namespace=</span><span class="tok-s">&quot;http://www.flowable.org/dmn&quot;</span>
  <span class="tok-na">name=</span><span class="tok-s">&quot;DetermineDiscount&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;decision</span> <span class="tok-na">id=</span><span class="tok-s">&quot;DET_DISC_1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;DetermineDiscount&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;decisionTable</span> <span class="tok-na">id=</span><span class="tok-s">&quot;determineDiscountTable1&quot;</span> <span class="tok-na">hitPolicy=</span><span class="tok-s">&quot;FIRST&quot;</span><span class="tok-nt">&gt;</span>
      ..
    <span class="tok-nt">&lt;/decisionTable&gt;</span>

  <span class="tok-nt">&lt;/decision&gt;</span>

<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_创建dmn定义">2.3.3. 创建DMN定义</h4>
<div class="paragraph">
<p>虽然使用纯文本编辑器创建DMN定义是可行的，但是对于此示例，我们将首先使用Flowable建模器的决策表编辑器。</p>
</div>
<div class="paragraph">
<p>接下来，我们将实现一个非常简单的用例：根据客户类别确定折扣百分比。</p>
</div>
<div class="paragraph">
<p>首先打开Flowable建模器中的决策表部分。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/decision_tables_1.png" alt="decision tables 1">
</div>
</div>
<div class="paragraph">
<p>选择<strong>Create Decision Table</strong>。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/decision_tables_2.png" alt="decision tables 2">
</div>
</div>
<div class="paragraph">
<p>填写决策表名称和决策表唯一键，然后选择<strong>Create new decision table</strong>。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/decision_tables_3.png" alt="decision tables 3">
</div>
</div>
<div class="paragraph">
<p>现在就可以定义决策表了。接下来我们对编辑器做个说明。</p>
</div>
<div class="sect4">
<h5 id="_hit_policy_命中策略">Hit Policy 命中策略</h5>
<div class="paragraph">
<p>我们可以在左上角选择<strong>hit policy</strong>。</p>
</div>
<div class="paragraph">
<p>可以看到，有7个命中策略可用。</p>
</div>
<div class="paragraph">
<p><strong>单一命中</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>F</strong>IRST: 可以匹配多个（重叠）具有不同输出条目的规则。返回规则顺序中的第一次命中（返回后停止评估）。</p>
</li>
<li>
<p><strong>U</strong>NIQUE: 没有重叠的可能，所有规则都是互斥的。只能匹配到一条规则。</p>
</li>
<li>
<p><strong>A</strong>NY: 可能会有重叠，但如果所有匹配规则显示每个输出的输出条目相等，就可以使用任何匹配。如果输出条目不相等，则命中策略不正确，结果将为空并标记为failed。当禁用<a href="#strictMode">strict mode</a>时，结果是最后一个有效规则。(违规将以验证消息的形式出现)</p>
</li>
<li>
<p><strong>P</strong>RIORITY: 具有不同的输出条目的多个规则可以匹配。此策略返回具有最高输出优先级的匹配规则。输出优先级在输出值的有序列表中按优先级递减的顺序指定。当禁用<a href="#strictMode">strict mode</a>且未定义输出值时，结果是最后一个有效规则。(违规将以验证消息的形式出现)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>多重命中</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>O</strong>UTPUT ORDER: 按输出优先级递减的顺序返回所有命中规则。输出优先级在输出值的有序列表中按优先级递减的顺序指定。</p>
</li>
<li>
<p><strong>R</strong>ULE ORDER: 按规则顺序返回所有命中。</p>
</li>
<li>
<p><strong>C</strong>OLLECT: 以任意顺序返回所有命中。我们可以添加运算符（<em>+</em>，<em>&lt;</em>，<em>&gt;</em>，<em>＃</em>）来将一个简单函数应用于输出。如果没有运算符，则结果是所有输出条目的列表。</p>
<div class="ulist">
<ul>
<li>
<p>+ (sum): 决策表的结果是所有不同输出的总和。</p>
</li>
<li>
<p>&lt; (min): 决策表的结果是所有输出的最小值。</p>
</li>
<li>
<p>&gt; (max): 决策表的结果是所有输出的最大值。</p>
</li>
<li>
<p># (count): 决策表的结果是所有不同输出的总数。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_输入和输出表达式">输入和输出表达式</h5>
<div class="paragraph">
<p>决策表本身的表头分为两部分;蓝色和绿色。蓝色部分是<strong>input expressions</strong>（输入表达式）;绿色的是<strong>output expressions</strong>（输出表达式）。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/decision_tables_4.png" alt="decision tables 4">
</div>
</div>
<div class="paragraph">
<p>在输入表达式中，我们可以定义将在规则输入条目的表达式中使用的变量(下面解释)。还可以通过选择<strong>Add Input</strong>(右键单击option菜单或单击plus图标)来定义多个输入表达式。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/decision_tables_5.png" alt="decision tables 5">
</div>
</div>
<div class="paragraph">
<p>在输出表达式中，我们可以定义将创建什么变量来构成决策表执行的结果(变量的值将由输出条目表达式决定，下面解释)。还可以通过选择<strong>Add Output</strong>(右键单击option菜单或单击plus图标)来定义多个输出表达式。</p>
</div>
</div>
<div class="sect4">
<h5 id="_规则">规则</h5>
<div class="paragraph">
<p>每个规则由一个或多个输入项和一个或多个输出项组成。输入项是一个表达式，它将根据输入的变量(该“列”的值)求值。当所有输入项都为true时，就认为整个规则是true，开始计算输出项。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>DMN规范定义了一种表达式语言：(S)-FEEL。目前，我们不支持这部分规范。 在Flowable DMN中，我们使用JUEL作为表达式语言。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/decision_tables_6.png" alt="decision tables 6">
</div>
</div>
<div class="paragraph">
<p>我们可以双击相应的单元格输入表达式。在此示例中，输入表达式== BRONZE。结合相应输入表达式（列标题）中定义的变量，将在运行时生成完整的表达式customerCat == "BRONZE"。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/decision_tables_7.png" alt="decision tables 7">
</div>
</div>
<div class="paragraph">
<p>然后双击相应的单元格输出表达式。这实际上更像是一个隐式赋值。
在此示例中，输入表达式5。</p>
</div>
<div class="paragraph">
<p>然后，我们可以通过添加更多规则（通过选择添加规则）继续完成决策表。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/decision_tables_8.png" alt="decision tables 8">
</div>
</div>
<div class="paragraph">
<p>在我们的示例中，规则4有一个空的输入条目，引擎将会把这个空输入条目评估为true。那么如果其他规则都无效，则规则4的结果将是该决策表的输出。在这种情况下，变量<strong>discountPerc</strong>的值为<strong>0</strong>。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/decision_tables_9.png" alt="decision tables 9">
</div>
</div>
<div class="paragraph">
<p>现在我们可以保存决策表。填入决策表唯一键。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bpmn2_0流程中的应用">2.3.4. BPMN2.0流程中的应用</h4>
<div class="paragraph">
<p>通过包含<strong>Decision task</strong>并选择<strong>Decision table reference</strong>，可以在BPMN2.0流程中使用新创建的决策表。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/decision_tables_10.png" alt="decision tables 10">
</div>
</div>
<div class="paragraph">
<p>上面定义的流程中，该流程有一个启动表单，它将<strong>customer category</strong>（客户类别）提供给流程实例（从而提供给决策表）。<strong>Display Discount</strong>（显示折扣）用户任务使用表达式表单字段显示决策表的结果;${discountperc}。</p>
</div>
</div>
<div class="sect3">
<h4 id="_dmn_1_1_xml文件">2.3.5. DMN 1.1 xml文件</h4>
<div class="paragraph">
<p>上面示例的完整DMN 1.1 xml文件。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.omg.org/spec/DMN/20151101&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;definition_78d09dd7-374c-11e8-b5d8-0242ac120005&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Determine Discount&quot;</span> <span class="tok-na">namespace=</span><span class="tok-s">&quot;http://www.flowable.org/dmn&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;decision</span> <span class="tok-na">id=</span><span class="tok-s">&quot;DET_DISC_1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Determine Discount&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;decisionTable</span> <span class="tok-na">id=</span><span class="tok-s">&quot;decisionTable_78d09dd7-374c-11e8-b5d8-0242ac120005&quot;</span> <span class="tok-na">hitPolicy=</span><span class="tok-s">&quot;UNIQUE&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;input</span> <span class="tok-na">label=</span><span class="tok-s">&quot;Customer Category&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;inputExpression</span> <span class="tok-na">id=</span><span class="tok-s">&quot;inputExpression_1&quot;</span> <span class="tok-na">typeRef=</span><span class="tok-s">&quot;string&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;text&gt;</span>customerCat<span class="tok-nt">&lt;/text&gt;</span>
        <span class="tok-nt">&lt;/inputExpression&gt;</span>
        <span class="tok-nt">&lt;inputValues&gt;</span>
          <span class="tok-nt">&lt;text&gt;</span>&quot;BRONZE&quot;,&quot;SILVER&quot;,&quot;GOLD&quot;<span class="tok-nt">&lt;/text&gt;</span>
        <span class="tok-nt">&lt;/inputValues&gt;</span>
      <span class="tok-nt">&lt;/input&gt;</span>
      <span class="tok-nt">&lt;output</span> <span class="tok-na">id=</span><span class="tok-s">&quot;outputExpression_2&quot;</span> <span class="tok-na">label=</span><span class="tok-s">&quot;Discount Percentage&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;discountPerc&quot;</span> <span class="tok-na">typeRef=</span><span class="tok-s">&quot;number&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;outputValues&gt;</span>
          <span class="tok-nt">&lt;text&gt;</span>&quot;0&quot;,&quot;5&quot;,&quot;10&quot;,&quot;20&quot;<span class="tok-nt">&lt;/text&gt;</span>
        <span class="tok-nt">&lt;/outputValues&gt;</span>
      <span class="tok-nt">&lt;/output&gt;</span>
      <span class="tok-nt">&lt;rule&gt;</span>
        <span class="tok-nt">&lt;inputEntry</span> <span class="tok-na">id=</span><span class="tok-s">&quot;inputEntry_1_1&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;text&gt;</span><span class="tok-cp">&lt;![CDATA[== &quot;BRONZE&quot;]]&gt;</span><span class="tok-nt">&lt;/text&gt;</span>
        <span class="tok-nt">&lt;/inputEntry&gt;</span>
        <span class="tok-nt">&lt;outputEntry</span> <span class="tok-na">id=</span><span class="tok-s">&quot;outputEntry_2_1&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;text&gt;</span><span class="tok-cp">&lt;![CDATA[5]]&gt;</span><span class="tok-nt">&lt;/text&gt;</span>
        <span class="tok-nt">&lt;/outputEntry&gt;</span>
      <span class="tok-nt">&lt;/rule&gt;</span>
      <span class="tok-nt">&lt;rule&gt;</span>
        <span class="tok-nt">&lt;inputEntry</span> <span class="tok-na">id=</span><span class="tok-s">&quot;inputEntry_1_2&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;text&gt;</span><span class="tok-cp">&lt;![CDATA[== &quot;SILVER&quot;]]&gt;</span><span class="tok-nt">&lt;/text&gt;</span>
        <span class="tok-nt">&lt;/inputEntry&gt;</span>
        <span class="tok-nt">&lt;outputEntry</span> <span class="tok-na">id=</span><span class="tok-s">&quot;outputEntry_2_2&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;text&gt;</span><span class="tok-cp">&lt;![CDATA[10]]&gt;</span><span class="tok-nt">&lt;/text&gt;</span>
        <span class="tok-nt">&lt;/outputEntry&gt;</span>
      <span class="tok-nt">&lt;/rule&gt;</span>
      <span class="tok-nt">&lt;rule&gt;</span>
        <span class="tok-nt">&lt;inputEntry</span> <span class="tok-na">id=</span><span class="tok-s">&quot;inputEntry_1_3&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;text&gt;</span><span class="tok-cp">&lt;![CDATA[== &quot;GOLD&quot;]]&gt;</span><span class="tok-nt">&lt;/text&gt;</span>
        <span class="tok-nt">&lt;/inputEntry&gt;</span>
        <span class="tok-nt">&lt;outputEntry</span> <span class="tok-na">id=</span><span class="tok-s">&quot;outputEntry_2_3&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;text&gt;</span><span class="tok-cp">&lt;![CDATA[20]]&gt;</span><span class="tok-nt">&lt;/text&gt;</span>
        <span class="tok-nt">&lt;/outputEntry&gt;</span>
      <span class="tok-nt">&lt;/rule&gt;</span>
      <span class="tok-nt">&lt;rule&gt;</span>
        <span class="tok-nt">&lt;inputEntry</span> <span class="tok-na">id=</span><span class="tok-s">&quot;inputEntry_1_4&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;text&gt;</span><span class="tok-cp">&lt;![CDATA[-]]&gt;</span><span class="tok-nt">&lt;/text&gt;</span>
        <span class="tok-nt">&lt;/inputEntry&gt;</span>
        <span class="tok-nt">&lt;outputEntry</span> <span class="tok-na">id=</span><span class="tok-s">&quot;outputEntry_2_4&quot;</span><span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;text&gt;</span><span class="tok-cp">&lt;![CDATA[0]]&gt;</span><span class="tok-nt">&lt;/text&gt;</span>
        <span class="tok-nt">&lt;/outputEntry&gt;</span>
      <span class="tok-nt">&lt;/rule&gt;</span>
    <span class="tok-nt">&lt;/decisionTable&gt;</span>
  <span class="tok-nt">&lt;/decision&gt;</span>
<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>此处需要重点强调的是，在Flowable中使用的决策表键是DMN xml文件中的决策ID。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="formIntroduction">2.4. 表单介绍</h3>
<div class="sect3">
<h4 id="whatIsFormDefinition">2.4.1. 表单定义是什么？</h4>
<div class="paragraph">
<p>对于BPMN引擎而言，我们沿用了BPMN规范，同理对与DMN引擎，我们使用了DMN规范。但是对于开始或任务表单，并不存在类似的共性问题让我们使用。因此，我们自己定义了一个基于JSON格式的的表单结构定义，我们使用这种结构作为Flowable表单编辑器的输出格式，而且我们会在Flowable任务应用中提取该结构让开始或任务表单使用。</p>
</div>
</div>
<div class="sect3">
<h4 id="formDefining">2.4.2. Defining a form</h4>
<div class="paragraph">
<p>用你最爱的文本或JSON编辑器新建一个JSON文件，然后给这个文件起个个性的名字。确保这个文件的后缀为.form，比如shareniu.fom,否则表单引擎将无法部署此文件。</p>
</div>
<div class="paragraph">
<p>表单的JSON定义以key、name和description开头。表单引擎通过属性key来辨别表单在整个表单引擎中的唯一身份。对于来源相同的同一个表单定义的版本系统也是基于属性key运作的。第二部分是一个数组类型fields，表单定义的字段在这里阐明。第三部分是可选的，用来定义表单的结果outcomes。示例如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</div></td><td class="code"><span></span><span class="tok-p">{</span>
    <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;form1&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;My first form&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;fields&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span>
            <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;input1&quot;</span><span class="tok-p">,</span>
            <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Input1&quot;</span><span class="tok-p">,</span>
            <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;text&quot;</span><span class="tok-p">,</span>
            <span class="tok-nt">&quot;required&quot;</span><span class="tok-p">:</span> <span class="tok-kc">false</span><span class="tok-p">,</span>
            <span class="tok-nt">&quot;placeholder&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;empty&quot;</span>
        <span class="tok-p">}</span>
    <span class="tok-p">],</span>
    <span class="tok-nt">&quot;outcomes&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span>
            <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;null&quot;</span><span class="tok-p">,</span>
            <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Accept&quot;</span>
        <span class="tok-p">},</span>
        <span class="tok-p">{</span>
            <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;null&quot;</span><span class="tok-p">,</span>
            <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Reject&quot;</span>
        <span class="tok-p">}</span>
    <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>每个表单字段都有一个id、name和type属性。在同一个表单定义中id应该是独一无二的。当一个用户完成表单后id还能当作变量名使用。在这个小例子中，一个名叫input1的流程变量被创建了，用户填入这个文本字段里的东西就是这个变量的值。结果outcomes也可以被映射成一个变量，此变量基于表单标识符，格式为："form_&lt;form-identifier&gt;_outcome"。举例说明，选中的结果会被设置为一个名叫"form_form1_outcome"的变量。你可以通过表达式${form_form1_outcome == "Accept"}来检验结果outcome是否为&#8217;Accept'</p>
</div>
<div class="paragraph">
<p>表单支持以下类型字段</p>
</div>
<div class="ulist">
<ul>
<li>
<p>text: 文本字段</p>
</li>
<li>
<p>multi-line-text: 多行文本字段</p>
</li>
<li>
<p>integer: 文本字段，但是只允许数字类型的值</p>
</li>
<li>
<p>boolean: 复选框字段</p>
</li>
<li>
<p>date: 日期字段</p>
</li>
<li>
<p>dropdown: 选择框字段，定义字段时可以设置选项的值</p>
</li>
<li>
<p>radio-buttons: 单选字段，定义字段时可以设置选项的值</p>
</li>
<li>
<p>people: 选择框字段，可以选中用户表里的一个用户</p>
</li>
<li>
<p>functional-group: 选择框字段，可以选中分组表里的一个组</p>
</li>
<li>
<p>upload: 上传文件字段</p>
</li>
<li>
<p>expression:  一个标签，在标签文本中你可以运用JUEL表达式操作变量或其他动态的值</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_engine">3. Engine</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction">3.1. Introduction</h3>
<div class="paragraph">
<p><strong>TBD</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="_installation">3.2. Installation</h3>
<div class="paragraph">
<p><strong>TBD</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="_flowable_common">3.3. Flowable Common ???</h3>
<div class="sect3">
<h4 id="_introduction_2">3.3.1. Introduction</h4>
<div class="paragraph">
<p><strong>TBD</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="_jpa">3.3.2. JPA</h4>
<div class="paragraph">
<p>（Java Persistence API Java持久化API）</p>
</div>
<div class="paragraph">
<p>可以使用JPA实体作为流程变量，这样可以：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用流程变量更新已有的JPA实体。流程变量可以在用户任务的表单中填写，或者通过服务任务生成。</p>
</li>
<li>
<p>重用已有的领域模型，而不需要写专门的服务用于读取与更新实体。</p>
</li>
<li>
<p>基于已有实体做决策（网关）。</p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_requirements">需求</h5>
<div class="paragraph">
<p>只支持完全满足下列条件的实体：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>实体需要使用JPA注解配置，字段与参数访问器都可以。也可以使用映射的父类。</p>
</li>
<li>
<p>实体需要有使用<code>@Id</code>注解的主键，不支持复合主键（<code>@EmbeddedId</code>与<code>@IdClass</code>）。Id字段/参数可以是任何JPA规范支持的类型：原生类型与其包装器（除了boolean）、<code>String</code>、<code>BigInteger</code>、<code>BigDecimal</code>、<code>java.util.Date</code>与<code>java.sql.Date</code>。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="jpaconfiguration">配置</h5>
<div class="paragraph">
<p>引擎必须引用<code>EntityManagerFactory</code>才能使用JPA实体，可以配置引用，或者配置持久化单元名（Persistence Unit Name）。引擎会自动检测用作变量的JPA实体，并按需处理。</p>
</div>
<div class="paragraph">
<p>下面的示例配置使用jpaPersistenceUnitName：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span>
  <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneInMemProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>

<span class="tok-c">&lt;!-- 数据库配置 --&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUrl&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:JpaVariableTest;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jpaPersistenceUnitName&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;flowable-jpa-pu&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jpaHandleTransaction&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jpaCloseEntityManager&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-c">&lt;!-- 作业执行器配置 --&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;asyncExecutorActivate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-c">&lt;!-- 邮件服务器配置 --&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;mailServerPort&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;5025&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>下面的示例配置使用自定义的<code>EntityManagerFactory</code>（open-jpa实体管理器）。请注意这段代码只包含了与本例相关的bean，而省略了其他的bean。使用open-jpa实体管理器的完整可用示例，可以在flowable-spring-examples (<code>/flowable-spring/src/test/java/org/flowable/spring/test/jpa/JPASpringTest.java</code>)中找到。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;entityManagerFactory&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;persistenceUnitManager&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;pum&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jpaVendorAdapter&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.springframework.orm.jpa.vendor.OpenJpaVendorAdapter&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databasePlatform&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.apache.openjpa.jdbc.sql.H2Dictionary&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/bean&gt;</span>
  <span class="tok-nt">&lt;/property&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.SpringProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jpaEntityManagerFactory&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;entityManagerFactory&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jpaHandleTransaction&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jpaCloseEntityManager&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;asyncExecutorActivate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用相同的配置，以编程方式构建引擎。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">ProcessEngine</span> <span class="tok-n">processEngine</span> <span class="tok-o">=</span> <span class="tok-n">ProcessEngineConfiguration</span>
    <span class="tok-o">.</span><span class="tok-na">createProcessEngineConfigurationFromResourceDefault</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">setJpaPersistenceUnitName</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable-pu&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">buildProcessEngine</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>配置参数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>jpaPersistenceUnitName</code>：要使用的持久化单元的名字。（需要确保该持久化单元在classpath中可用。根据规范，默认位置为<code>/META-INF/persistence.xml</code>）。<code>jpaEntityManagerFactory</code>与<code>jpaPersistenceUnitName</code>二选一。</p>
</li>
<li>
<p><code>jpaEntityManagerFactory</code>：用于载入实体及刷入更新的，实现<code>javax.persistence.EntityManagerFactory</code>的bean。<em>jpaEntityManagerFactory</em>与<em>jpaPersistenceUnitName</em>二选一。</p>
</li>
<li>
<p><code>jpaHandleTransaction</code>：标示是否需要由引擎负责开启及提交/回滚<em>EntityManager</em>上的事务。当使用<em>Java Transaction API (JTA)</em>时，需设置为false。</p>
</li>
<li>
<p><code>jpaCloseEntityManager</code>：标示是否需要由引擎负责关闭从<code>EntityManagerFactory</code>获取的<code>EntityManager</code>实例。当<em>EntityManager</em>由容器管理时（例如，使用扩展持久化上下文 Extended Persistence Context，而不将实体范围限制为单一事务时）需设置为false。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_usage">使用</h5>
<div class="sect5">
<h6 id="_simple_example">简单示例</h6>
<div class="paragraph">
<p>可以在Flowable源代码的JPAVariableTest中找到使用JPA变量的例子。下面逐步解释<code>JPAVariableTest.testUpdateJPAEntityValues</code>。</p>
</div>
<div class="paragraph">
<p>首先，基于<code>META-INF/persistence.xml</code>为持久化单元创建<em>EntityManagerFactory</em>。包括需要包含在持久化单元内的类及一些（数据库）厂商特定配置。</p>
</div>
<div class="paragraph">
<p>在这个测试里使用的是简单实体，包括id以及一个<code>String</code>值参数。在运行测试前，先创建一个实体并保存。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</div></td><td class="code"><span></span><span class="tok-nd">@Entity</span><span class="tok-o">(</span><span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-s">&quot;JPA_ENTITY_FIELD&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">FieldAccessJPAEntity</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Id</span>
  <span class="tok-nd">@Column</span><span class="tok-o">(</span><span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-s">&quot;ID_&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">private</span> <span class="tok-n">Long</span> <span class="tok-n">id</span><span class="tok-o">;</span>

  <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">;</span>

  <span class="tok-kd">public</span> <span class="tok-nf">FieldAccessJPAEntity</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-c1">// JPA需要的空构造方法</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-n">Long</span> <span class="tok-nf">getId</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">id</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setId</span><span class="tok-o">(</span><span class="tok-n">Long</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">id</span> <span class="tok-o">=</span> <span class="tok-n">id</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getValue</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">value</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setValue</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>启动一个新的流程实例，将这个实体加入变量。与其他变量一样，它们都会在引擎中持久化存储。当下一次请求这个变量时，将会根据类及Id，从<code>EntityManager</code>载入。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">variables</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;();</span>
<span class="tok-n">variables</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;entityToUpdate&quot;</span><span class="tok-o">,</span> <span class="tok-n">entityToUpdate</span><span class="tok-o">);</span>

<span class="tok-n">ProcessInstance</span> <span class="tok-n">processInstance</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span>
    <span class="tok-s">&quot;UpdateJPAValuesProcess&quot;</span><span class="tok-o">,</span> <span class="tok-n">variables</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>流程定义的第一个节点是<code>服务任务</code>，将调用<code>entityToUpdate</code>上的<code>setValue</code>方法。<code>entityToUpdate</code>将解析为之前启动流程实例时设置的JPA变量，并使用当前引擎的上下文中关联的<code>EntityManager</code>载入。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&#39;theTask&#39;</span> <span class="tok-na">name=</span><span class="tok-s">&#39;updateJPAEntityTask&#39;</span>
  <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;${entityToUpdate.setValue(&#39;updatedValue&#39;)}&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当服务任务完成时，流程实例在流程定义中的用户任务处等待，以便我们可以查看流程实例。在这时，<code>EntityManager</code>已经刷入，对实体的修改也已经存入数据库。当获取<code>entityToUpdate</code>变量的值时，将重新载入实体。所以可以得到<code>value</code>参数设置为<code>updatedValue</code>的实体。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-c1">// 流程&#39;UpdateJPAValuesProcess&#39;中的服务任务已经设置了entityToUpdate的值。</span>
<span class="tok-n">Object</span> <span class="tok-n">updatedEntity</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">getVariable</span><span class="tok-o">(</span><span class="tok-n">processInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">(),</span> <span class="tok-s">&quot;entityToUpdate&quot;</span><span class="tok-o">);</span>
<span class="tok-n">assertTrue</span><span class="tok-o">(</span><span class="tok-n">updatedEntity</span> <span class="tok-k">instanceof</span> <span class="tok-n">FieldAccessJPAEntity</span><span class="tok-o">);</span>
<span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;updatedValue&quot;</span><span class="tok-o">,</span> <span class="tok-o">((</span><span class="tok-n">FieldAccessJPAEntity</span><span class="tok-o">)</span><span class="tok-n">updatedEntity</span><span class="tok-o">).</span><span class="tok-na">getValue</span><span class="tok-o">());</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_query_jpa_process_variables">查询JPA流程变量</h6>
<div class="paragraph">
<p>可以查询以特定JPA实体作为变量值的<code>流程实例</code>与<code>执行</code>。<strong>请注意<code>ProcessInstanceQuery</code>与<code>ExecutionQuery</code>中，只有<code>variableValueEquals(name, entity)</code>方法支持JPA实体查询</strong>。而<code>variableValueNotEquals</code>、<code>variableValueGreaterThan</code>、<code>variableValueGreaterThanOrEqual</code>、<code>variableValueLessThan</code>与<code>variableValueLessThanOrEqual</code>等方法都不支持JPA，并会在值传递为JPA实体时，抛出<code>FlowableException</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span> <span class="tok-n">ProcessInstance</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createProcessInstanceQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">variableValueEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;entityToQuery&quot;</span><span class="tok-o">,</span> <span class="tok-n">entityToQuery</span><span class="tok-o">).</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_advanced_example_using_spring_beans_and_jpa">使用Spring bean与JPA的高级示例</h6>
<div class="paragraph">
<p>可以在<code>flowable-spring-examples</code>中找到高级用法的示例——<code>JPASpringTest</code>。它描述了一个简单的用例：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用一个已有的Spring bean及已定义的JPA实体，用于存储贷款申请。</p>
</li>
<li>
<p>Flowable通过该bean获取该实体，并将其用作流程中的变量。流程定义如下步骤：</p>
<div class="ulist">
<ul>
<li>
<p>使用<code>LoanRequestBean</code>，并使用启动流程时（从启动表单）接收的变量创建LoanRequest（贷款申请）实体的服务任务。使用<code>flowable:resultVariable</code>将表达式结果，即所创建的实体存储为流程变量。</p>
</li>
<li>
<p>经理用于审核并批准/驳回申请的用户任务，并将审核结论存储为boolean变量<code>approvedByManager</code>。</p>
</li>
<li>
<p>更新贷款申请实体的服务任务，使实体与流程同步。</p>
</li>
<li>
<p>使用一个排他网关，依据<code>approved</code>实体参数的值选择下一步采用哪条路径：若申请被批准，结束流程；否则，生成一个额外任务（Send rejection letter 发送拒信），以便客户可以收到拒信得到通知。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意这个流程只用于单元测试，而不包含任何表单。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/jpa.spring.example.process.png" alt="jpa.spring.example.process">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</div></td><td class="code"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-nt">&lt;definitions</span> <span class="tok-na">id=</span><span class="tok-s">&quot;taskAssigneeExample&quot;</span>
  <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot;</span>
  <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="tok-na">xmlns:flowable=</span><span class="tok-s">&quot;http://flowable.org/bpmn&quot;</span>
  <span class="tok-na">targetNamespace=</span><span class="tok-s">&quot;org.flowable.examples&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;LoanRequestProcess&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Process creating and handling loan request&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&#39;theStart&#39;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&#39;flow1&#39;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&#39;theStart&#39;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&#39;createLoanRequest&#39;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&#39;createLoanRequest&#39;</span> <span class="tok-na">name=</span><span class="tok-s">&#39;Create loan request&#39;</span>
      <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;${loanRequestBean.newLoanRequest(customerName, amount)}&quot;</span>
      <span class="tok-na">flowable:resultVariable=</span><span class="tok-s">&quot;loanRequest&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&#39;flow2&#39;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&#39;createLoanRequest&#39;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&#39;approveTask&#39;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;approveTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Approve request&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&#39;flow3&#39;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&#39;approveTask&#39;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&#39;approveOrDissaprove&#39;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&#39;approveOrDissaprove&#39;</span> <span class="tok-na">name=</span><span class="tok-s">&#39;Store decision&#39;</span>
      <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;${loanRequest.setApproved(approvedByManager)}&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&#39;flow4&#39;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&#39;approveOrDissaprove&#39;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&#39;exclusiveGw&#39;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;exclusiveGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Exclusive Gateway approval&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;endFlow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theEnd&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>${loanRequest.approved}<span class="tok-nt">&lt;/conditionExpression&gt;</span>
    <span class="tok-nt">&lt;/sequenceFlow&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;endFlow2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;sendRejectionLetter&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>${!loanRequest.approved}<span class="tok-nt">&lt;/conditionExpression&gt;</span>
    <span class="tok-nt">&lt;/sequenceFlow&gt;</span>

    <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sendRejectionLetter&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Send rejection letter&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&#39;flow5&#39;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&#39;sendRejectionLetter&#39;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&#39;theOtherEnd&#39;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&#39;theEnd&#39;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&#39;theOtherEnd&#39;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/process&gt;</span>

<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>尽管上面的例子很简单，但也展示了JPA与Spring结合，以及带参数方法表达式的威力。这个流程本身完全不需要写Java代码（当然还是需要写Spring bean），大幅加速了开发。</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="history">3.3.3. 历史</h4>
<div class="paragraph">
<p>历史是记录流程执行过程中发生的事情，并将其永久存储的组件。与运行时数据不同，历史数据在流程实例完成以后仍保存在数据库中。</p>
</div>
<div class="paragraph">
<p>有6个历史实体：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>HistoricProcessInstance</code>保存当前及已结束流程实例的信息。</p>
</li>
<li>
<p><code>HistoricVariableInstance</code>保存流程变量或任务变量的最新值。</p>
</li>
<li>
<p><code>HistoricActivityInstance</code>保存活动（流程中的节点）的一次执行的信息。</p>
</li>
<li>
<p><code>HistoricTaskInstance</code>保存当前与历史（完成及删除的）任务实例的信息。</p>
</li>
<li>
<p><code>HistoricIdentityLink</code>保存任务及流程实例、当前及历史的身份关联的信息。</p>
</li>
<li>
<p><code>HistoricDetail</code>保存与历史流程实例、活动实例或任务实例等有关的多种信息。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>历史与当前进行中的流程实例都在数据库中保存历史实体，因此可以选择直接查询历史表，以减少对运行时流程实例数据的访问，并提高运行时执行的性能。</p>
</div>
<div class="sect4">
<h5 id="historyQuery">查询历史</h5>
<div class="paragraph">
<p>可以使用HistoryServiceAPI提供的<code>createHistoricProcessInstanceQuery()</code>、<code>createHistoricVariableInstanceQuery()</code>、<code>createHistoricActivityInstanceQuery()</code>、 <code>getHistoricIdentityLinksForTask()</code>、<code>getHistoricIdentityLinksForProcessInstance()</code>、<code>createHistoricDetailQuery()</code>与<code>createHistoricTaskInstanceQuery()</code>方法，查询全部6种历史实体。</p>
</div>
<div class="paragraph">
<p>下面用一些例子展示历史查询API的部分用法。可以在<a href="http://flowable.org/javadocs/index.html">javadoc</a>的<code>org.flowable.engine.history</code>包中找到全部用法。</p>
</div>
<div class="sect5">
<h6 id="historyQueryProcessInstance">历史流程实例查询</h6>
<div class="paragraph">
<p>获取所有流程中，完成所花费时间（持续时间）排名前10的、流程定义为<em>XXX</em>的、已完成的<code>HistoricProcessInstances（历史流程实例）</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">historyService</span><span class="tok-o">.</span><span class="tok-na">createHistoricProcessInstanceQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">finished</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">processDefinitionId</span><span class="tok-o">(</span><span class="tok-s">&quot;XXX&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">orderByProcessInstanceDuration</span><span class="tok-o">().</span><span class="tok-na">desc</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">listPage</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">10</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="historyQueryVariableInstance">历史变量实例查询</h6>
<div class="paragraph">
<p>获取已完成的、id为&#8217;XXX&#8217;的流程实例中，所有的<code>HistoricVariableInstances（历史变量实例）</code>，并以变量名排序。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">historyService</span><span class="tok-o">.</span><span class="tok-na">createHistoricVariableInstanceQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">processInstanceId</span><span class="tok-o">(</span><span class="tok-s">&quot;XXX&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">orderByVariableName</span><span class="tok-o">.</span><span class="tok-na">desc</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="historyQueryActivityInstance">历史活动实例查询</h6>
<div class="paragraph">
<p>获取最新的、已完成的、流程定义的id为XXX的、服务任务类型的<code>HistoricActivityInstance（历史活动实例）</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-n">historyService</span><span class="tok-o">.</span><span class="tok-na">createHistoricActivityInstanceQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">activityType</span><span class="tok-o">(</span><span class="tok-s">&quot;serviceTask&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">processDefinitionId</span><span class="tok-o">(</span><span class="tok-s">&quot;XXX&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">finished</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">orderByHistoricActivityInstanceEndTime</span><span class="tok-o">().</span><span class="tok-na">desc</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">listPage</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="historyQueryDetail">历史详情查询</h6>
<div class="paragraph">
<p>下面的的例子获取id为123的流程中所有的变量更新记录。这个查询只会返回<code>HistoricVariableUpdate（历史变量更新）</code>。请注意一个变量名可能会有多个<code>HistoricVariableUpdate</code>实体，这代表了流程中的每一次变量更新。可以使用<code>orderByTime（按变量更新的时间）</code>或<code>orderByVariableRevision（按变量更新的版本号）</code>对这些更新记录进行排序。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">historyService</span><span class="tok-o">.</span><span class="tok-na">createHistoricDetailQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">variableUpdates</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">processInstanceId</span><span class="tok-o">(</span><span class="tok-s">&quot;123&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">orderByVariableName</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">()</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>下面的例子获取流程id为"123"的、启动时提交或任何任务中提交的所有<a href="#formProperties">表单参数</a>。这个查询只会返回<code>HistoricFormProperties（历史表单参数）</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">historyService</span><span class="tok-o">.</span><span class="tok-na">createHistoricDetailQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">formProperties</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">processInstanceId</span><span class="tok-o">(</span><span class="tok-s">&quot;123&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">orderByVariableName</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">()</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>最后一个例子获取id为"123"的任务进行的所有变量更新操作。将返回该任务设置的所有变量（任务局部变量）的<code>HistoricVariableUpdates</code>，而<strong>不会</strong>返回流程实例中设置的变量。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">historyService</span><span class="tok-o">.</span><span class="tok-na">createHistoricDetailQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">variableUpdates</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">taskId</span><span class="tok-o">(</span><span class="tok-s">&quot;123&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">orderByVariableName</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">()</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以在<code>TaskListener</code>中使用<code>TaskService</code>或<code>DelegateTask</code>设置任务局部变量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">setVariableLocal</span><span class="tok-o">(</span><span class="tok-s">&quot;123&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;myVariable&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Variable value&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">notify</span><span class="tok-o">(</span><span class="tok-n">DelegateTask</span> <span class="tok-n">delegateTask</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-n">delegateTask</span><span class="tok-o">.</span><span class="tok-na">setVariableLocal</span><span class="tok-o">(</span><span class="tok-s">&quot;myVariable&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Variable value&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="historyQueryTaskInstance">历史任务实例查询</h6>
<div class="paragraph">
<p>获取所有任务中，完成所花费时间（持续时间）排名前10的、已完成的<code>HistoricTaskInstance（历史任务实例）</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">historyService</span><span class="tok-o">.</span><span class="tok-na">createHistoricTaskInstanceQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">finished</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">orderByHistoricTaskInstanceDuration</span><span class="tok-o">().</span><span class="tok-na">desc</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">listPage</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">10</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>获取删除原因包含"invalid"的、最终指派给<em>kermit</em>用户的<code>HistoricTaskInstance</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">historyService</span><span class="tok-o">.</span><span class="tok-na">createHistoricTaskInstanceQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">finished</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">taskDeleteReasonLike</span><span class="tok-o">(</span><span class="tok-s">&quot;%invalid%&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">taskAssignee</span><span class="tok-o">(</span><span class="tok-s">&quot;kermit&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">listPage</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">10</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="historyConfig">配置历史</h5>
<div class="paragraph">
<p>可以使用org.flowable.engine.impl.history.HistoryLevel枚举（或在5.11之前的版本中，<code>ProcessEngineConfiguration</code>中定义的<em>HISTORY</em>常量），以编程方式配置历史级别：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">ProcessEngine</span> <span class="tok-n">processEngine</span> <span class="tok-o">=</span> <span class="tok-n">ProcessEngineConfiguration</span>
  <span class="tok-o">.</span><span class="tok-na">createProcessEngineConfigurationFromResourceDefault</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">setHistory</span><span class="tok-o">(</span><span class="tok-n">HistoryLevel</span><span class="tok-o">.</span><span class="tok-na">AUDIT</span><span class="tok-o">.</span><span class="tok-na">getKey</span><span class="tok-o">())</span>
  <span class="tok-o">.</span><span class="tok-na">buildProcessEngine</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以在flowable.cfg.xml或Spring上下文中配置级别：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneInMemProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;history&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;audit&quot;</span> <span class="tok-nt">/&gt;</span>
  ...
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以配置下列历史级别：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>none（无）</code>：跳过所有历史的存档。这是流程执行性能最高的配置，但是不会保存任何历史信息。</p>
</li>
<li>
<p><code>activity（活动）</code>：存档所有流程实例与活动实例。在流程实例结束时，将顶级流程实例变量的最新值复制为历史变量实例。但不会存档细节。</p>
</li>
<li>
<p><code>audit（审计）</code>：默认级别。将存档所有流程实例及活动实例，并保持变量值与提交的表单参数的同步，以保证所有通过表单进行的用户操作都可追踪、可审计。</p>
</li>
<li>
<p><code>full（完全）</code>：历史存档的最高级别，因此也最慢。这个级别存储所有<code>audit</code>级别存储的信息，加上所有其他细节（主要是流程变量的更新）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>在Flowable 5.11版本以前，历史级别保存在数据库中（<code>ACT_GE_PROPERTY</code> 表，参数名为<code>historyLevel</code>）。从5.11开始，这个值不再使用，并从数据库中忽略/删除。现在可以在引擎每次启动时切换历史级别。不会由于前一次启动时修改了级别，而导致本次启动抛出异常。</strong></p>
</div>
</div>
<div class="sect4">
<h5 id="asyncHistoryConfig">配置异步历史</h5>
<div class="paragraph">
<p>[实验性] Flowable 6.1.0引入了异步历史，使用历史作业执行器异步地进行历史数据的持久化。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneInMemProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;asyncHistoryEnabled&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;asyncHistoryExecutorNumberOfRetries&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;10&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;asyncHistoryExecutorActivate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
  ...
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>配置<code>asyncHistoryExecutorActivate</code>参数后，流程引擎启动时会自动启动历史作业执行器。只有在测试（或不使用异步历史时）才应该设置为false。
<code>asyncHistoryExecutorNumberOfRetries</code>参数用于配置异步历史作业的重试次数。这个参数与普通的异步作业有些不同，因为历史作业可能需要更多周期才能成功完成。比如，首先需要在ACT_HI_TASK_表中创建一个历史的任务，然后才能在另一个历史作业中记录其办理人的更新。流程引擎配置中，这个参数的默认值为10。到达重试次数后，会忽略这个历史作业（且不会写入死信作业表中）。</p>
</div>
<div class="paragraph">
<p>另外，可以使用<code>asyncHistoryExecutor</code>参数配置异步执行器，与普通的异步作业执行器类似。</p>
</div>
<div class="paragraph">
<p>如果不在默认的历史表中保存历史数据，而是在NoSQL数据库（Elasticsearch、MongoDb、Cassandra等）或其他什么地方保存，可以覆盖处理作业的处理器：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用<code>historyJobHandlers</code>参数，配置全部自定义历史作业处理器的map</p>
</li>
<li>
<p>或者，配置<code>customHistoryJobHandlers</code>列表。启动时会将列表中的所有处理器加入<code>historyJobHandlers</code> map中。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>另外，也可以使用消息队列，让引擎在产生新的历史作业时发送消息。这样，历史数据就可以在另外的服务器中进行处理。也可以配置引擎及消息队列使用JTA（以及JMS），这样就可以不用在作业中记录历史数据，而可以将所有数据发送至全局事务的消息队列中。</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/flowable/flowable-examples/tree/master/async-history">Flowable异步历史示例</a>提供了配置异步历史的不同示例，包括默认方式、JMS队列、JTA，还有使用消息队列，并使用Spring Boot应用作为消息监听器。</p>
</div>
</div>
<div class="sect4">
<h5 id="historyFormAuditPurposes">用于审计的历史</h5>
<div class="paragraph">
<p>如果历史至少<a href="#historyConfig">配置</a>为<code>audit</code>级别，则会记录由<code>FormService.submitStartFormData(String processDefinitionId, Map&lt;String, String&gt; properties)</code>与<code>FormService.submitTaskFormData(String taskId, Map&lt;String, String&gt; properties)</code>方法提交的所有参数。</p>
</div>
<div class="paragraph">
<p>表单参数可以像这样通过查询API读取：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">historyService</span>
      <span class="tok-o">.</span><span class="tok-na">createHistoricDetailQuery</span><span class="tok-o">()</span>
      <span class="tok-o">.</span><span class="tok-na">formProperties</span><span class="tok-o">()</span>
      <span class="tok-o">...</span>
      <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这段代码只会返回<code>HistoricFormProperty</code>类型的历史详情。</p>
</div>
<div class="paragraph">
<p>如果在调用提交方法前，使用<code>IdentityService.setAuthenticatedUserId(String)</code>设置了认证用户，那么也可以在历史中获取该认证用户信息。使用<code>HistoricProcessInstance.getStartUserId()</code>获取启动表单的认证用户信息，任务表单则需使用<code>HistoricActivityInstance.getAssignee()</code>。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bpmn">3.4. BPMN</h3>
<div class="sect3">
<h4 id="_introduction_3">3.4.1. Introduction</h4>
<div class="paragraph">
<p><strong>TBD</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration">3.4.2. 配置</h4>
<div class="sect4">
<h5 id="configuration">创建ProcessEngine</h5>
<div class="paragraph">
<p>Flowable流程引擎通过名为<code>flowable.cfg.xml</code>的XML文件进行配置。请注意这种方式与<a href="#springintegration">使用Spring创建流程引擎</a><strong>不</strong>一样。</p>
</div>
<div class="paragraph">
<p>获取<code>ProcessEngine</code>，最简单的方式是使用<code>org.flowable.engine.ProcessEngines</code>类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">ProcessEngine</span> <span class="tok-n">processEngine</span> <span class="tok-o">=</span> <span class="tok-n">ProcessEngines</span><span class="tok-o">.</span><span class="tok-na">getDefaultProcessEngine</span><span class="tok-o">()</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样会从classpath寻找<code>flowable.cfg.xml</code>，并用这个文件中的配置构造引擎。下面的代码展示了一个配置的例子。后续章节会对配置参数进行详细介绍。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUrl&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcDriver&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.h2.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUsername&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sa&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcPassword&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;asyncExecutorActivate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;mailServerHost&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;mail.my-corp.com&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;mailServerPort&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;5025&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意这个配置XML文件实际上是一个Spring配置文件。<strong>但这并不意味着Flowable只能用于Spring环境！</strong>我们只是利用Spring内部的解析与依赖注入功能来简化引擎的构建过程。</p>
</div>
<div class="paragraph">
<p>也可以通过编程方式使用配置文件，来构造ProcessEngineConfiguration对象。也可以使用不同的bean id(例如第3行)。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-n">ProcessEngineConfiguration</span><span class="tok-o">.</span>
  <span class="tok-nf">createProcessEngineConfigurationFromResourceDefault</span><span class="tok-o">();</span>
  <span class="tok-n">createProcessEngineConfigurationFromResource</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">resource</span><span class="tok-o">);</span>
  <span class="tok-n">createProcessEngineConfigurationFromResource</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">resource</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">beanName</span><span class="tok-o">);</span>
  <span class="tok-n">createProcessEngineConfigurationFromInputStream</span><span class="tok-o">(</span><span class="tok-n">InputStream</span> <span class="tok-n">inputStream</span><span class="tok-o">);</span>
  <span class="tok-n">createProcessEngineConfigurationFromInputStream</span><span class="tok-o">(</span><span class="tok-n">InputStream</span> <span class="tok-n">inputStream</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">beanName</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以不使用配置文件，使用默认配置（参考<a href="#configurationClasses">不同的支持类</a>获得更多信息）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">ProcessEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneProcessEngineConfiguration</span><span class="tok-o">();</span>
<span class="tok-n">ProcessEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneInMemProcessEngineConfiguration</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>所有的<code>ProcessEngineConfiguration.createXXX()</code>方法都返回<code>ProcessEngineConfiguration</code>，并可以继续按需调整。调用<code>buildProcessEngine()</code>后，生成一个<code>ProcessEngine</code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">ProcessEngine</span> <span class="tok-n">processEngine</span> <span class="tok-o">=</span> <span class="tok-n">ProcessEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneInMemProcessEngineConfiguration</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">setDatabaseSchemaUpdate</span><span class="tok-o">(</span><span class="tok-n">ProcessEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">DB_SCHEMA_UPDATE_FALSE</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">setJdbcUrl</span><span class="tok-o">(</span><span class="tok-s">&quot;jdbc:h2:mem:my-own-db;DB_CLOSE_DELAY=1000&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">setAsyncExecutorActivate</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">buildProcessEngine</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configurationRoot">ProcessEngineConfiguration bean</h5>
<div class="paragraph">
<p><code>flowable.cfg.xml</code>文件中必须包含一个id为'processEngineConfiguration'的bean。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span> <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这个bean用于构建<code>ProcessEngine</code>。有多个类可以用于定义<code>processEngineConfiguration</code>。这些类用于不同的环境，并各自设置一些默认值。最佳实践是选择最匹配你环境的类，以便减少配置引擎需要的参数。目前可以使用的类为：<a id="configurationClasses"></a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration</strong>：流程引擎独立运行。Flowable自行处理事务。在默认情况下，数据库检查只在引擎启动时进行（如果Flowable表结构不存在或表结构版本不对，会抛出异常）。</p>
</li>
<li>
<p><strong>org.flowable.engine.impl.cfg.StandaloneInMemProcessEngineConfiguration</strong>：这是一个便于使用单元测试的类。Flowable自行处理事务。默认使用H2内存数据库。数据库会在引擎启动时创建，并在引擎关闭时删除。使用这个类时，很可能不需要更多的配置（除了使用任务执行器或邮件等功能时）。</p>
</li>
<li>
<p><strong>org.flowable.spring.SpringProcessEngineConfiguration</strong>：在流程引擎处于Spring环境时使用。查看<a href="#springintegration">Spring集成</a>章节了解更多信息。</p>
</li>
<li>
<p><strong>org.flowable.engine.impl.cfg.JtaProcessEngineConfiguration</strong>：用于引擎独立运行，并使用JTA事务的情况。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="databaseConfiguration">配置数据库</h5>
<div class="paragraph">
<p>有两种方式配置Flowable引擎使用的数据库。第一种方式是定义数据库的JDBC参数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>jdbcUrl</strong>: 数据库的JDBC URL。</p>
</li>
<li>
<p><strong>jdbcDriver</strong>: 对应数据库类型的驱动。</p>
</li>
<li>
<p><strong>jdbcUsername</strong>: 用于连接数据库的用户名。</p>
</li>
<li>
<p><strong>jdbcPassword</strong>: 用于连接数据库的密码。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>通过提供的JDBC参数构造的数据源，使用默认的<a href="http://www.mybatis.org/">MyBatis</a>连接池设置。可用下列属性调整这个连接池（来自MyBatis文档）：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>jdbcMaxActiveConnections</strong>: 连接池能够容纳的最大活动连接数量。默认值为10.</p>
</li>
<li>
<p><strong>jdbcMaxIdleConnections</strong>: 连接池能够容纳的最大空闲连接数量。</p>
</li>
<li>
<p><strong>jdbcMaxCheckoutTime</strong>: 连接从连接池“取出”后，被强制返回前的最大时间间隔，单位为毫秒。默认值为20000（20秒）。</p>
</li>
<li>
<p><strong>jdbcMaxWaitTime</strong>: 这是一个底层设置，在连接池获取连接的时间异常长时，打印日志并尝试重新获取连接（避免连接池配置错误，导致没有异常提示）。默认值为20000（20秒）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>数据库配置示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUrl&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcDriver&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.h2.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUsername&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sa&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcPassword&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>我们的跑分显示MyBatis连接池在处理大量并发请求时，并不是最经济或最具弹性的。因此，建议使用<code>javax.sql.DataSource</code>的实现，并将其注入到流程引擎配置中（如Hikari、Tomcat JDBC连接池，等等）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;driverClassName&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;com.mysql.jdbc.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;url&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:mysql://localhost:3306/flowable&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;username&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;flowable&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;flowable&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;defaultAutoCommit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-nt">/&gt;</span>
  ...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意Flowable发布时不包括用于定义数据源的库。需要自行把库放在classpath中。</p>
</div>
<div class="paragraph">
<p>无论使用JDBC还是数据源方式配置，都可以使用下列参数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>databaseType</strong>: 通常不需要专门设置这个参数，因为它可以从数据库连接信息中自动检测得出。只有在自动检测失败时才需要设置。可用值：{h2, mysql, oracle, postgres, mssql, db2}。这个选项会决定创建、删除与查询时使用的脚本。查看<a href="#supporteddatabases">“支持的数据库”</a>章节了解我们支持哪些类型的数据库。</p>
</li>
<li>
<p><strong>databaseSchemaUpdate</strong>: 用于设置流程引擎启动关闭时使用的数据库表结构控制策略。</p>
<div class="ulist">
<ul>
<li>
<p><code>false</code> (默认): 当引擎启动时，检查数据库表结构的版本是否匹配库文件版本。版本不匹配时抛出异常。</p>
</li>
<li>
<p><code>true</code>: 构建引擎时，检查并在需要时更新表结构。表结构不存在则会创建。</p>
</li>
<li>
<p><code>create-drop</code>: 引擎创建时创建表结构，并在引擎关闭时删除表结构。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="jndiDatasourceConfig">配置JNDI数据源</h5>
<div class="paragraph">
<p>默认情况下，Flowable的数据库配置保存在每个web应用WEB-INF/classes文件夹下的db.properties文件中。有时这样并不合适，因为这需要用户修改Flowable源码中的db.properties文件并重新编译war包，或者在部署后解开war包并修改db.properties文件。</p>
</div>
<div class="paragraph">
<p>通过使用JNDI（Java Naming and Directory Interface，Java命名和目录接口）获取数据库连接，连接就完全交由Servlet容器管理，并可以在WAR部署之外管理配置。同时也提供了比db.properties中更多的控制连接的参数。</p>
</div>
<div class="sect5">
<h6 id="jndi_configuration">配置</h6>
<div class="paragraph">
<p>根据你使用的servlet容器应用不同，配置JNDI数据源的方式也不同。下面的介绍用于Tomcat，对于其他容器应用，请参考对应的文档。</p>
</div>
<div class="paragraph">
<p>Tomcat的JNDI资源配置在$CATALINA_BASE/conf/[enginename]/[hostname]/[warname].xml (对于Flowable UI通常会是$CATALINA_BASE/conf/Catalina/localhost/flowable-app.xml)。当应用第一次部署时，默认会从Flowable war包中复制context.xml。所以如果存在这个文件则需要替换。例如，如果需要将JNDI资源修改为应用连接MySQL而不是H2，需要如下修改：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
    <span class="tok-nt">&lt;Context</span> <span class="tok-na">antiJARLocking=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">path=</span><span class="tok-s">&quot;/flowable-app&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;Resource</span> <span class="tok-na">auth=</span><span class="tok-s">&quot;Container&quot;</span>
            <span class="tok-na">name=</span><span class="tok-s">&quot;jdbc/flowableDB&quot;</span>
            <span class="tok-na">type=</span><span class="tok-s">&quot;javax.sql.DataSource&quot;</span>
            <span class="tok-na">description=</span><span class="tok-s">&quot;JDBC DataSource&quot;</span>
            <span class="tok-na">url=</span><span class="tok-s">&quot;jdbc:mysql://localhost:3306/flowable&quot;</span>
            <span class="tok-na">driverClassName=</span><span class="tok-s">&quot;com.mysql.jdbc.Driver&quot;</span>
            <span class="tok-na">username=</span><span class="tok-s">&quot;sa&quot;</span>
            <span class="tok-na">password=</span><span class="tok-s">&quot;&quot;</span>
            <span class="tok-na">defaultAutoCommit=</span><span class="tok-s">&quot;false&quot;</span>
            <span class="tok-na">initialSize=</span><span class="tok-s">&quot;5&quot;</span>
            <span class="tok-na">maxWait=</span><span class="tok-s">&quot;5000&quot;</span>
            <span class="tok-na">maxActive=</span><span class="tok-s">&quot;120&quot;</span>
            <span class="tok-na">maxIdle=</span><span class="tok-s">&quot;5&quot;</span><span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;/Context&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_jndi_properties">JNDI参数</h6>
<div class="paragraph">
<p>在Flowable UI的配置文件中使用下列参数配置JNDI数据源：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>spring.datasource.jndi-name=: 数据源的JNDI名</p>
</li>
<li>
<p>datasource.jndi.resourceRef: 设置是否在J2EE容器中查找。也就是说，如果JNDI名中没有包含"java:comp/env/"前缀，是否需要添加它。默认为"true"。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="supporteddatabases">支持的数据库</h5>
<div class="paragraph">
<p>下面列出Flowable用于引用数据库的类型（区分大小写！）。</p>
</div>
<table id="databaseTypes" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flowable数据库类型</th>
<th class="tableblock halign-left valign-top">示例JDBC URL</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">h2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:h2:tcp://localhost/flowable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认配置的数据库</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mysql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:mysql://localhost:3306/flowable?autoReconnect=true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">已使用mysql-connector-java数据库驱动测试</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">oracle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:oracle:thin:@localhost:1521:xe</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">postgres</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:postgresql://localhost:5432/flowable</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">db2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:db2://localhost:50000/flowable</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mssql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:sqlserver://localhost:1433;databaseName=flowable (jdbc.driver=com.microsoft.sqlserver.jdbc.SQLServerDriver) <em>OR</em> jdbc:jtds:sqlserver://localhost:1433/flowable (jdbc.driver=net.sourceforge.jtds.jdbc.Driver)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">已使用Microsoft JDBC Driver 4.0 (sqljdbc4.jar)与JTDS Driver测试</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="creatingDatabaseTable">创建数据库表</h5>
<div class="paragraph">
<p>在你的数据库中创建数据库表，最简单的方法是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在classpath中添加flowable-engine JAR</p>
</li>
<li>
<p>添加合适的数据库驱动</p>
</li>
<li>
<p>在classpath中添加Flowable配置文件(<em>flowable.cfg.xml</em>)，指向你的数据库(参考<a href="#databaseConfiguration">数据库配置</a>)</p>
</li>
<li>
<p>执行<em>DbSchemaCreate</em>类的main方法</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>然而，通常只有数据库管理员可以在数据库中执行DDL语句，在生产环境中这也是最明智的选择。DDL的SQL脚本可以在Flowable下载页面或Flowable发布文件夹中找到，位于<code>database</code>子文件夹。引擎JAR (<em>flowable-engine-x.jar</em>)的<em>org/flowable/db/create</em>包中也有一份(<em>drop</em>文件夹存放删除脚本)。SQL文件的格式为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>flowable.{db}.{create|drop}.{type}.sql</pre>
</div>
</div>
<div class="paragraph">
<p>其中<em>db</em>为<a href="#supporteddatabases">支持的数据库</a>，而<em>type</em>为：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>engine:</strong> 引擎执行所需的表，必需。</p>
</li>
<li>
<p><strong>history:</strong> 存储历史与审计信息的表。当历史级别设置为<em>none</em>时不需要。请注意不使用这些表会导致部分使用历史数据的功能失效（如任务备注）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>MySQL用户请注意：</strong>低于5.6.4的MySQL版本不支持timestamps或包含毫秒精度的日期。更糟的是部分版本会在创建类似的列时抛出异常，而另一些版本则不会。当使用自动创建/升级时，引擎在执行时会自动修改DDL语句。当使用DDL文件方式建表时，可以使用通用版本，或使用文件名包含<em>mysql55</em>的特殊版本（用于5.6.4以下的任何版本）。特殊版本的文件中不会使用毫秒精度的列类型。</p>
</div>
<div class="paragraph">
<p>具体地说，对于MySQL的版本：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>&lt;5.6:</strong> 不支持毫秒精度。可以使用DDL文件（使用包含<em>mysql55</em>的文件）。可以使用自动创建/升级。</p>
</li>
<li>
<p><strong>5.6.0 - 5.6.3:</strong> 不支持毫秒精度。<strong>不</strong>可以使用自动创建/升级。建议升级为较新版本的数据库。如果确实需要，可以使用包含<em>mysql55</em>的DDL文件。</p>
</li>
<li>
<p><strong>5.6.4+:</strong> 支持毫秒精度。可以使用DDL文件（默认的包含<em>mysql</em>的文件）。可以使用自动创建/升级。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意如果在Flowable表已经创建/升级后，再升级MySQL数据库，则需要手工修改列类型！</p>
</div>
</div>
<div class="sect4">
<h5 id="database.tables.explained">数据库表名说明</h5>
<div class="paragraph">
<p>Flowable的所有数据库表都以<strong>ACT_</strong>开头。第二部分是说明表用途的两字符标示符。服务API的命名也大略符合这个规则。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ACT_RE_</strong>*: 'RE&#8217;代表<code>repository</code>。带有这个前缀的表包含“静态”信息，例如流程定义与流程资源（图片、规则等）。</p>
</li>
<li>
<p><strong>ACT_RU_</strong>*: 'RU&#8217;代表<code>runtime</code>。这些表存储运行时信息，例如流程实例（process instance）、用户任务（user task）、变量（variable）、作业（job）等。Flowable只在流程实例运行中保存运行时数据，并在流程实例结束时删除记录。这样保证运行时表小和快。</p>
</li>
<li>
<p><strong>ACT_HI_</strong>*: 'HI&#8217;代表<code>history</code>。这些表存储历史数据，例如已完成的流程实例、变量、任务等。</p>
</li>
<li>
<p><strong>ACT_GE_</strong>*: 通用数据。在多处使用。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="databaseUpgrade">数据库升级</h5>
<div class="paragraph">
<p>在升级前，请确保你已经（使用数据库的备份功能）备份了数据库。</p>
</div>
<div class="paragraph">
<p>默认情况下，每次流程引擎创建时会进行版本检查，通常是在你的应用或者Flowable web应用启动的时候。如果Flowable发现库版本与Flowable数据库表版本不同，会抛出异常。</p>
</div>
<div class="paragraph">
<p>要进行升级，首先需要将下列配置参数放入你的flowable.cfg.xml配置文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans</span> <span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span>
      <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-c">&lt;!-- ... --&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-c">&lt;!-- ... --&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>同时，在classpath中加上合适的数据库驱动。</strong>升级应用中的Flowable库，或者启动一个新版本的Flowable，并将它指向包含旧版本数据的数据库。将<code>databaseSchemaUpdate</code>设置为<code>true</code>。当Flowable发现库与数据库表结构不一致时，会自动将数据库表结构升级至新版本。</p>
</div>
<div class="paragraph">
<p><strong>也可以直接运行升级DDL语句。</strong>也可以从Flowable下载页面获取升级数据库脚本并运行。</p>
</div>
</div>
<div class="sect4">
<h5 id="jobExecutorConfiguration">作业执行器（从6.0.1版本起）</h5>
<div class="paragraph">
<p>在Flowable V6中唯一可用的作业执行器，是Flowable V5中的异步执行器(async executor)。因为它为Flowable引擎提供了性能更好，对数据库也更友好的执行异步作业的方式。
Flowable V5中的作业执行器(job executor)在V6中不再可用。可以在用户手册的高级章节找到更多信息。</p>
</div>
<div class="paragraph">
<p>此外，如果在Java EE 7下运行，容器还可以使用符合JSR-236标准的<code>ManagedAsyncJobExecutor</code>来管理线程。要启用这个功能，需要在配置中如下加入线程工厂：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;threadFactory&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.springframework.jndi.JndiObjectFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
   <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jndiName&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;java:jboss/ee/concurrency/factory/default&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;customJobExecutor&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.jobexecutor.ManagedAsyncJobExecutor&quot;</span><span class="tok-nt">&gt;</span>
   <span class="tok-c">&lt;!-- ... --&gt;</span>
   <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;threadFactory&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;threadFactory&quot;</span> <span class="tok-nt">/&gt;</span>
   <span class="tok-c">&lt;!-- ... --&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果没有设置线程工厂，ManagedAsyncJobExecutor实现会退化为默认实现（AsyncJobExecutor）。</p>
</div>
</div>
<div class="sect4">
<h5 id="_job_executor_activation">启用作业执行器</h5>
<div class="paragraph">
<p><code>AsyncExecutor</code>是管理线程池的组件，用于触发定时器与其他异步任务。也可以使用其他实现（如使用消息队列，参见用户手册的高级章节）。</p>
</div>
<div class="paragraph">
<p>默认情况下，<code>AsyncExecutor</code>并未启用，也不会启动。如下配置使异步执行器与Flowable引擎一同启动：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;asyncExecutorActivate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>asyncExecutorActivate这个参数使Flowable引擎在启动同时启动异步执行器。</p>
</div>
</div>
<div class="sect4">
<h5 id="mailServerConfiguration">配置邮件服务器</h5>
<div class="paragraph">
<p>配置邮件服务器是可选的。Flowable支持在业务流程中发送电子邮件。发送电子邮件需要配置有效的SMTP邮件服务器。查看<a href="#bpmnEmailTaskServerConfiguration">电子邮件任务</a>了解配置选项。</p>
</div>
</div>
<div class="sect4">
<h5 id="historyConfiguration">配置历史</h5>
<div class="paragraph">
<p>历史存储的配置是可选的。你可以通过调整配置控制<a href="#history">历史功能</a>。查看<a href="#historyConfig">配置历史</a>章节了解更多细节。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;history&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;audit&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="asyncHistoryConfiguration">配置异步历史</h5>
<div class="paragraph">
<p>[实验性] 从Flowable 6.1.0起，添加了异步历史功能。当启用异步历史时，历史数据将由历史任务执行器负责持久化，而不是与运行时执行持久化同步保存。
查看<a href="#asyncHistoryConfig">配置异步历史</a>章节了解更多细节。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;asyncHistoryEnabled&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="exposingConfigurationBeans">配置在表达式与脚本中可用的bean</h5>
<div class="paragraph">
<p>默认情况下，所有通过<code>flowable.cfg.xml</code>或你自己的Spring配置文件声明的bean，都可以在表达式与脚本中使用。如果你希望限制配置文件中bean的可见性，可以使用流程引擎配置的<code>beans</code>参数。<code>ProcessEngineConfiguration</code>中的<code>beans</code>参数是一个map。当你配置这个参数时，只有在这个map中声明的bean可以在表达式与脚本中使用。bean会使用你在map中指定的名字暴露。</p>
</div>
</div>
<div class="sect4">
<h5 id="processDefinitionCacheConfiguration">配置部署缓存</h5>
<div class="paragraph">
<p>鉴于流程定义信息不会改变，为了避免每次使用流程定义时都读取数据库，所有的流程定义都会（在解析后）被缓存。默认情况下，这个缓存没有限制。要限制流程定义缓存，加上如下的参数</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;processDefinitionCacheLimit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;10&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>设置这个参数，会将默认的hashmap缓存替换为LRU缓存，以进行限制。当然，参数的“最佳”取值，取决于总的流程定义数量，以及实际使用的流程定义数量。</p>
</div>
<div class="paragraph">
<p>也可以注入自己的缓存实现。必须是一个实现了<code>org.flowable.engine.impl.persistence.deploy.DeploymentCache</code>接口的bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;processDefinitionCache&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.MyCache&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/property&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>类似的，可以使用名为<code>knowledgeBaseCacheLimit</code>与<code>knowledgeBaseCache</code>的参数配置规则缓存(rules cache)。只有在流程中使用规则任务(rules task)时才需要设置。</p>
</div>
</div>
<div class="sect4">
<h5 id="loggingConfiguration">日志</h5>
<div class="paragraph">
<p>所有的日志（Flowable、Spring、MyBatis等）都通过SLF4J路由，并允许你自行选择日志实现。</p>
</div>
<div class="paragraph">
<p><strong>默认情况下，Flowable引擎依赖中不提供SFL4J绑定JAR。你需要自行将其加入你的项目，以便使用所选的日志框架。</strong>如果没有加入实现JAR，SLF4J会使用NOP-logger。这时除了一条警告外，不会记录任何日志。可以从<a href="http://www.slf4j.org/codes.html#StaticLoggerBinder"><a href="http://www.slf4j.org/codes.html#StaticLoggerBinder" class="bare">http://www.slf4j.org/codes.html#StaticLoggerBinder</a></a>了解关于绑定的更多信息。</p>
</div>
<div class="paragraph">
<p>可以像这样（这里使用Log4j）使用Maven添加依赖，请注意你还需要加上版本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.slf4j<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>slf4j-log4j12<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Flowable-UI与Flowable-rest web应用配置为使用Log4j绑定。运行所有flowable-*模块的测试时也会使用Log4j。</p>
</div>
<div class="paragraph">
<p><strong>重要提示：当使用classpath中带有commons-logging的容器时：</strong>为了将spring的日志路由至SLF4j，需要使用桥接（参考<a href="http://www.slf4j.org/legacy.html#jclOverSLF4J"><a href="http://www.slf4j.org/legacy.html#jclOverSLF4J" class="bare">http://www.slf4j.org/legacy.html#jclOverSLF4J</a></a>）。如果你的容器提供了commons-logging实现，请按照<a href="http://www.slf4j.org/codes.html#release"><a href="http://www.slf4j.org/codes.html#release" class="bare">http://www.slf4j.org/codes.html#release</a></a>页面的指示调整。</p>
</div>
<div class="paragraph">
<p>使用Maven的示例（省略了版本）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.slf4j<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>jcl-over-slf4j<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="MDC">映射诊断上下文</h5>
<div class="paragraph">
<p>Flowable支持SLF4J的映射诊断上下文特性。下列基本信息会与需要日志记录的信息一起，传递给底层日志实现：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>processDefinition Id 作为 mdcProcessDefinitionID</p>
</li>
<li>
<p>processInstance Id 作为 mdcProcessInstanceID</p>
</li>
<li>
<p>execution Id 作为 mdcExecutionId</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>默认情况下这些信息都不会被日志记录，但可以通过配置logger，按照你想要的格式，与其他日志信息一起显示。例如在Log4j中进行如下简单的格式定义，就可以让logger显示上述信息：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="properties"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-na">log4j.appender.consoleAppender.layout.ConversionPattern</span><span class="tok-o">=</span><span class="tok-s">ProcessDefinitionId=%X{mdcProcessDefinitionID}</span>
<span class="tok-na">executionId</span><span class="tok-o">=</span><span class="tok-s">%X{mdcExecutionId} mdcProcessInstanceID=%X{mdcProcessInstanceID} mdcBusinessKey=%X{mdcBusinessKey} %m%n</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果需要使用日志中包含的信息进行实时监测（如使用日志分析器），就会很有帮助。</p>
</div>
</div>
<div class="sect4">
<h5 id="eventDispatcher">事件处理器</h5>
<div class="paragraph">
<p>Flowable引擎中的事件机制可以让你在引擎中发生多种事件的时候得到通知。查看<a href="#eventDispatcherEventTypes">所有支持的事件类型</a>了解可用的事件。</p>
</div>
<div class="paragraph">
<p>可以只为特定种类的事件注册监听器，而不是在任何类型的事件发送时都被通知。可以<a href="#eventDispatcherConfiguration">通过配置</a>添加引擎全局的事件监听器，<a href="#eventDispatcherConfigurationRuntime">在运行时通过API</a>添加引擎全局的事件监听器，也可以<a href="#eventDispatcherConfigurationProcessDefinition">在BPMN XML文件为个别流程定义</a>添加事件监听器。</p>
</div>
<div class="paragraph">
<p>所有被分发的事件都是<code>org.flowable.engine.common.api.delegate.event.FlowableEvent</code>的子类。事件（在可用时）提供<code>type</code>, <code>executionId</code>, <code>processInstanceId</code>与<code>processDefinitionId</code>。部分事件含有关于发生事件的上下文信息。关于事件包含的附加信息，请参阅<a href="#eventDispatcherEventTypes">所有支持的事件类型</a>。</p>
</div>
<div class="sect5">
<h6 id="eventDispatcherListener">实现事件监听器</h6>
<div class="paragraph">
<p>对事件监听器的唯一要求，是要实现<code>org.flowable.engine.delegate.event.FlowableEventListener</code>接口。下面是一个监听器实现的例子，它将接收的所有事件打印至标准输出，并对作业执行相关的事件特别处理：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyEventListener</span> <span class="tok-kd">implements</span> <span class="tok-n">FlowableEventListener</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onEvent</span><span class="tok-o">(</span><span class="tok-n">FlowableEvent</span> <span class="tok-n">event</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">switch</span> <span class="tok-o">(</span><span class="tok-n">event</span><span class="tok-o">.</span><span class="tok-na">getType</span><span class="tok-o">())</span> <span class="tok-o">{</span>

      <span class="tok-k">case</span> <span class="tok-n">JOB_EXECUTION_SUCCESS</span><span class="tok-o">:</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;A job well done!&quot;</span><span class="tok-o">);</span>
        <span class="tok-k">break</span><span class="tok-o">;</span>

      <span class="tok-k">case</span> <span class="tok-n">JOB_EXECUTION_FAILURE</span><span class="tok-o">:</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;A job has failed...&quot;</span><span class="tok-o">);</span>
        <span class="tok-k">break</span><span class="tok-o">;</span>

<span class="tok-nl">      default:</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Event received: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">event</span><span class="tok-o">.</span><span class="tok-na">getType</span><span class="tok-o">());</span>
    <span class="tok-o">}</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isFailOnException</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-c1">// onEvent方法中的逻辑并不重要，可以忽略日志失败异常……</span>

    <span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>isFailOnException()</code>方法决定了当事件分发后，<code>onEvent(..)</code>方法抛出异常时的行为。若返回<code>false</code>，忽略异常；若返回<code>true</code>，异常不会被忽略而会被上抛，使当前执行的命令失败。如果事件是API调用（或其他事务操作，例如作业执行）的一部分，事务将被回滚。如果事件监听器中并不是重要的业务操作，建议返回<code>false</code>。</p>
</div>
<div class="paragraph">
<p>Flowable提供了少量基础实现，以简化常用的事件监听器使用场景。它们可以被用作监听器的示例或基类：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>org.flowable.engine.delegate.event.BaseEntityEventListener</strong>: 事件监听器基类，可用来监听实体（entity）相关事件，特定或所有实体的事件都可以。它隐藏了类型检测，提供了4个需要覆盖的方法：<code>onCreate(..)</code>, <code>onUpdate(..)</code>与<code>onDelete(..)</code>在实体创建、更新及删除时调用；对所有其他实体相关事件，<code>onEntityEvent(..)</code>会被调用。</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="eventDispatcherConfiguration">配置与使用</h6>
<div class="paragraph">
<p>在流程引擎中配置的事件监听器会在流程引擎启动时生效，引擎重启后也会保持有效。</p>
</div>
<div class="paragraph">
<p><code>eventListeners</code>参数为<code>org.flowable.engine.delegate.event.FlowableEventListener</code>类实例的列表(list)。与其他地方一样，你可以声明内联bean定义，也可以用<code>ref</code>指向已有的bean。下面的代码片段在配置中添加了一个事件监听器，无论任何类型的事件分发时，都会得到通知：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span>
    <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    ...
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;eventListeners&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;list&gt;</span>
         <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.example.MyEventListener&quot;</span> <span class="tok-nt">/&gt;</span>
      <span class="tok-nt">&lt;/list&gt;</span>
    <span class="tok-nt">&lt;/property&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>要在特定类型的事件分发时得到通知，使用<code>typedEventListeners</code>参数，值为map。map的key为逗号分隔的事件名字列表（或者一个事件的名字），取值为<code>org.flowable.engine.delegate.event.FlowableEventListener</code>实例的列表。下面的代码片段在配置中添加了一个事件监听器，它会在作业执行成功或失败时得到通知：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span>
    <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    ...
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;typedEventListeners&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;map&gt;</span>
        <span class="tok-nt">&lt;entry</span> <span class="tok-na">key=</span><span class="tok-s">&quot;JOB_EXECUTION_SUCCESS,JOB_EXECUTION_FAILURE&quot;</span> <span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;list&gt;</span>
            <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.example.MyJobEventListener&quot;</span> <span class="tok-nt">/&gt;</span>
          <span class="tok-nt">&lt;/list&gt;</span>
        <span class="tok-nt">&lt;/entry&gt;</span>
      <span class="tok-nt">&lt;/map&gt;</span>
    <span class="tok-nt">&lt;/property&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>事件分发的顺序由加入监听器的顺序决定。首先，所有普通(<code>eventListeners</code>参数定义的)事件监听器按照在<code>list</code>里的顺序被调用；之后，如果分发的是某类型的事件，则(<code>typedEventListeners</code> 参数定义的)该类型监听器被调用。</p>
</div>
</div>
<div class="sect5">
<h6 id="eventDispatcherConfigurationRuntime">在运行时添加监听器</h6>
<div class="paragraph">
<p>可以使用API(<code>RuntimeService</code>)为引擎添加或删除事件监听器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</div></td><td class="code"><span></span>
<span class="tok-cm">/**</span>
<span class="tok-cm"> * 新增一个监听器，会在所有事件发生时被通知。</span>
<span class="tok-cm"> * @param listenerToAdd 要新增的监听器</span>
<span class="tok-cm"> */</span>
<span class="tok-kt">void</span> <span class="tok-nf">addEventListener</span><span class="tok-o">(</span><span class="tok-n">FlowableEventListener</span> <span class="tok-n">listenerToAdd</span><span class="tok-o">);</span>

<span class="tok-cm">/**</span>
<span class="tok-cm"> * 新增一个监听器，在给定类型的事件发生时被通知。</span>
<span class="tok-cm"> * @param listenerToAdd 要新增的监听器</span>
<span class="tok-cm"> * @param types 监听器需要监听的事件类型</span>
<span class="tok-cm"> */</span>
<span class="tok-kt">void</span> <span class="tok-nf">addEventListener</span><span class="tok-o">(</span><span class="tok-n">FlowableEventListener</span> <span class="tok-n">listenerToAdd</span><span class="tok-o">,</span> <span class="tok-n">FlowableEventType</span><span class="tok-o">...</span> <span class="tok-n">types</span><span class="tok-o">);</span>

<span class="tok-cm">/**</span>
<span class="tok-cm"> * 从分发器中移除指定监听器。该监听器将不再被通知，无论该监听器注册为监听何种类型。</span>
<span class="tok-cm"> * @param listenerToRemove 要移除的监听器</span>
<span class="tok-cm"> */</span>
 <span class="tok-kt">void</span> <span class="tok-nf">removeEventListener</span><span class="tok-o">(</span><span class="tok-n">FlowableEventListener</span> <span class="tok-n">listenerToRemove</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，运行时新增的监听器<strong>在引擎重启后不会保持。</strong></p>
</div>
</div>
<div class="sect5">
<h6 id="eventDispatcherConfigurationProcessDefinition">为流程定义增加监听器</h6>
<div class="paragraph">
<p>可以为某一流程定义增加监听器。只有与该流程定义相关，或使用该流程定义启动的流程实例相关的事件，才会调用这个监听器。监听器实现可以用完全限定类名（fully qualified classname）定义；也可以定义为表达式，该表达式需要能被解析为实现监听器接口的bean；也可以配置为抛出消息（message）/信号（signal）/错误（error）的BPMN事件。</p>
</div>
<div class="sect6">
<h7 id="_listeners_executing_user_defined_logic">执行用户定义逻辑的监听器</h7>
<div class="paragraph">
<p>下面的代码片段为流程定义增加了2个监听器。第一个监听器接收任何类型的事件，使用完全限定类名定义。第二个监听器只在作业成功执行或失败时被通知，使用流程引擎配置中<code>beans</code>参数定义的bean作为监听器。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;testEventListeners&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:eventListener</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.test.MyEventListener&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:eventListener</span> <span class="tok-na">delegateExpression=</span><span class="tok-s">&quot;${testEventListener}&quot;</span> <span class="tok-na">events=</span><span class="tok-s">&quot;JOB_EXECUTION_SUCCESS,JOB_EXECUTION_FAILURE&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>

  ...

<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>实体相关的事件也可以在流程定义中增加监听器，只有在特定实体类型的事件发生时得到通知。下面的代码片段展示了如何设置。可以响应实体的所有事件（第一个例子），或只响应实体的特定类型事件（第二个例子）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;testEventListeners&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:eventListener</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.test.MyEventListener&quot;</span> <span class="tok-na">entityType=</span><span class="tok-s">&quot;task&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:eventListener</span> <span class="tok-na">delegateExpression=</span><span class="tok-s">&quot;${testEventListener}&quot;</span> <span class="tok-na">events=</span><span class="tok-s">&quot;ENTITY_CREATED&quot;</span> <span class="tok-na">entityType=</span><span class="tok-s">&quot;task&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>

  ...

<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>entityType</code>可用的值有：<code>attachment</code>（附件）, <code>comment</code>（备注）, <code>execution</code>（执行）, <code>identity-link</code>（身份关联）, <code>job</code>（作业）, <code>process-instance</code>（流程实例）, <code>process-definition</code>（流程定义）, <code>task</code>（任务）。</p>
</div>
</div>
<div class="sect6">
<h7 id="_listeners_throwing_bpmn_events">抛出BPMN事件的监听器</h7>
<div class="paragraph">
<p>处理分发的事件的另一个方法，是抛出BPMN事件。请牢记在心，只有特定种类的Flowable事件类型，抛出BPMN事件才合理。例如，在流程实例被删除时抛出BPMN事件，会导致错误。下面的代码片段展示了如何在流程实例中抛出信号，向外部流程（全局）抛出信号，在流程实例中抛出消息事件，以及在流程实例中抛出错误事件。这里不使用<code>class</code>或<code>delegateExpression</code>，而要使用<code>throwEvent</code>属性，以及一个附加属性，用于指定需要抛出的事件类型。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;testEventListeners&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:eventListener</span> <span class="tok-na">throwEvent=</span><span class="tok-s">&quot;signal&quot;</span> <span class="tok-na">signalName=</span><span class="tok-s">&quot;My signal&quot;</span> <span class="tok-na">events=</span><span class="tok-s">&quot;TASK_ASSIGNED&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;testEventListeners&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:eventListener</span> <span class="tok-na">throwEvent=</span><span class="tok-s">&quot;globalSignal&quot;</span> <span class="tok-na">signalName=</span><span class="tok-s">&quot;My signal&quot;</span> <span class="tok-na">events=</span><span class="tok-s">&quot;TASK_ASSIGNED&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;testEventListeners&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:eventListener</span> <span class="tok-na">throwEvent=</span><span class="tok-s">&quot;message&quot;</span> <span class="tok-na">messageName=</span><span class="tok-s">&quot;My message&quot;</span> <span class="tok-na">events=</span><span class="tok-s">&quot;TASK_ASSIGNED&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;testEventListeners&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:eventListener</span> <span class="tok-na">throwEvent=</span><span class="tok-s">&quot;error&quot;</span> <span class="tok-na">errorCode=</span><span class="tok-s">&quot;123&quot;</span> <span class="tok-na">events=</span><span class="tok-s">&quot;TASK_ASSIGNED&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果需要使用额外的逻辑判断是否需要抛出BPMN事件，可以扩展Flowable提供的监听器类。通过在你的子类中覆盖<code>isValidEvent(FlowableEvent event)</code>，可以阻止抛出BPMN事件。相关的类为<code>org.flowable.engine.test.api.event.SignalThrowingEventListenerTest</code>, <code>org.flowable.engine.impl.bpmn.helper.MessageThrowingEventListener</code>与<code>org.flowable.engine.impl.bpmn.helper.ErrorThrowingEventListener</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_notes_on_listeners_on_a_process_definition">关于流程定义监听器的说明</h7>
<div class="ulist">
<ul>
<li>
<p>事件监听器只能作为<code>extensionElements</code>的子元素，声明在<code>process</code>元素上。不能在个别节点（activity）上定义（事件）监听器。</p>
</li>
<li>
<p><code>delegateExpression</code>中的表达式，与其他表达式（例如在网关中的）不一样，不可以访问执行上下文。只能够引用在流程引擎配置中<code>beans</code>参数定义的bean；或是在使用spring（且没有定义beans参数）时，引用任何实现了监听器接口的spring bean。</p>
</li>
<li>
<p>使用监听器的<code>class</code>属性时，只会创建唯一一个该类的实例。请确保监听器实现不依赖于成员变量，或确保多线程/上下文的使用安全。</p>
</li>
<li>
<p>如果<code>events</code>属性使用了不合法的事件类型，或者使用了不合法的<code>throwEvent</code>值，会在流程定义部署时抛出异常（导致部署失败）。如果<code>class</code>或<code>delegateExecution</code>指定了不合法的值（不存在的类，不存在的bean引用，或者代理类没有实现监听器接口），在流程启动（或该流程定义的第一个有效事件分发给这个监听器）时，会抛出异常。请确保引用的类在classpath中，并且保证表达式能够解析为有效的实例。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="eventDispatcherCustomEvents">通过API分发事件</h6>
<div class="paragraph">
<p>可以通过API提供事件分发机制，向任何在引擎中注册的监听器分发自定义事件。建议（但不强制）只分发<code>CUSTOM</code>类型的<code>FlowableEvents</code>。使用<code>RuntimeService</code>分发事件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span>
<span class="tok-cm">/**</span>
<span class="tok-cm"> * 将给定事件分发给所有注册监听器。</span>
<span class="tok-cm"> * @param event 要分发的事件。</span>
<span class="tok-cm"> *</span>
<span class="tok-cm"> * @throws FlowableException 当分发事件发生异常，或者{@link FlowableEventDispatcher}被禁用。</span>
<span class="tok-cm"> * @throws FlowableIllegalArgumentException 当给定事件不可分发</span>
<span class="tok-cm"> */</span>
 <span class="tok-kt">void</span> <span class="tok-nf">dispatchEvent</span><span class="tok-o">(</span><span class="tok-n">FlowableEvent</span> <span class="tok-n">event</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="eventDispatcherEventTypes">支持的事件类型</h6>
<div class="paragraph">
<p>下表列出引擎中的所有事件类型。每种类型对应<code>org.flowable.engine.common.api.delegate.event.FlowableEventType</code>中的一个枚举值。</p>
</div>
<table id="eventTypes" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Supported events</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">事件名称</th>
<th class="tableblock halign-left valign-top">说明</th>
<th class="tableblock halign-left valign-top">事件类</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENGINE_CREATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">本监听器所属的流程引擎已经创建，并可以响应API调用。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENGINE_CLOSED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">本监听器所属的流程引擎已经关闭，不能再对该引擎进行API调用。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENTITY_CREATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">新的实体已经创建。该实体包含在本事件里。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENTITY_INITIALIZED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">新的实体已经创建并完全初始化。如果任何子实体作为该实体的一部分被创建，本事件会在子实体创建/初始化后触发，与 <code>ENTITY_CREATE</code> 事件相反。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENTITY_UPDATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实体已经更新。该实体包含在本事件里。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENTITY_DELETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实体已经删除。该实体包含在本事件里。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENTITY_SUSPENDED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实体已经暂停。该实体包含在本事件里。ProcessDefinitions（流程定义）, ProcessInstances（流程实例）与Tasks（任务）会分发本事件。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENTITY_ACTIVATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实体已经激活。该实体包含在本事件里。ProcessDefinitions, ProcessInstances与Tasks会分发本事件。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JOB_EXECUTION_SUCCESS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">作业已经成功执行。该作业包含在本事件里。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JOB_EXECUTION_FAILURE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">作业执行失败。该作业与异常包含在本事件里。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code> 及 <code>org.flowable&#8230;&#8203;FlowableExceptionEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JOB_RETRIES_DECREMENTED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">作业重试次数已经由于执行失败而减少。该作业包含在本事件里。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIMER_SCHEDULED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">已创建一个定时作业，并预计在未来时间点执行。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIMER_FIRED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定时器已经触发。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JOB_CANCELED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">作业已经取消。该作业包含在本事件里。作业会由于API调用取消，任务完成导致关联的边界定时器取消，也会由于新流程定义的部署而取消。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_STARTED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">节点开始执行</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableActivityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_COMPLETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">节点成功完成</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableActivityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_CANCELLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">节点将要取消。节点的取消有三个原因（MessageEventSubscriptionEntity, SignalEventSubscriptionEntity, TimerEntity）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableActivityCancelledEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_SIGNALED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">节点收到了一个信号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableSignalEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_MESSAGE_RECEIVED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">节点收到了一个消息。事件在节点接收消息前分发。节点接收消息后，会为该节点分发 <code>ACTIVITY_SIGNAL</code> 或 <code>ACTIVITY_STARTED</code> 事件，取决于其类型（边界事件，或子流程启动事件）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableMessageEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_MESSAGE_WAITING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个节点已经创建了一个消息事件订阅，并正在等待接收消息。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableMessageEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_MESSAGE_CANCELLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个节点已经取消了一个消息事件订阅，因此接收这个消息不会再触发该节点。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableMessageEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_ERROR_RECEIVED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">节点收到了错误事件。在节点实际处理错误前分发。该事件的<code>activityId</code>为处理错误的节点。如果错误成功传递，后续会为节点发送 <code>ACTIVITY_SIGNALLED</code> 或 <code>ACTIVITY_COMPLETE</code> 消息。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableErrorEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNCAUGHT_BPMN_ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">抛出了未捕获的BPMN错误。流程没有该错误的处理器。该事件的<code>activityId</code>为空。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableErrorEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_COMPENSATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">节点将要被补偿(compensate)。该事件包含将要执行补偿的节点id。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableActivityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULTI_INSTANCE_ACTIVITY_STARTED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">多实例节点开始执行</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableMultiInstanceActivityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULTI_INSTANCE_ACTIVITY_COMPLETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">多实例节点成功完成</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableMultiInstanceActivityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULTI_INSTANCE_ACTIVITY_CANCELLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">多实例节点将要取消。多实例节点的取消有三个原因（MessageEventSubscriptionEntity, SignalEventSubscriptionEntity, TimerEntity）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableMultiInstanceActivityCancelledEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARIABLE_CREATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程变量已经创建。本事件包含变量名、取值，及关联的执行和任务（若有）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableVariableEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARIABLE_UPDATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">变量已经更新。本事件包含变量名、取值，及关联的执行和任务（若有）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableVariableEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARIABLE_DELETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">变量已经删除。本事件包含变量名、最后取值，及关联的执行和任务（若有）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableVariableEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TASK_ASSIGNED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任务已经分派给了用户。该任务包含在本事件里。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TASK_CREATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任务已经创建。本事件在 <code>ENTITY_CREATE</code> 事件之后分发。若该任务是流程的一部分，本事件会在任务监听器执行前触发。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TASK_COMPLETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任务已经完成。本事件在 <code>ENTITY_DELETE</code> 事件前分发。若该任务是流程的一部分，本事件会在流程前进之前触发，并且会跟随一个 <code>ACTIVITY_COMPLETE</code> 事件，指向代表该任务的节点。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PROCESS_CREATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程实例已经创建。已经设置所有的基础参数，但还未设置变量。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PROCESS_STARTED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程实例已经启动。在启动之前创建的流程时分发。PROCESS_STARTED事件在相关的ENTITY_INITIALIZED事件，以及设置变量之后分发。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PROCESS_COMPLETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程实例已经完成。在最后一个节点的 <code>ACTIVITY_COMPLETED </code> 事件后分发。当流程实例没有任何路径可以继续时，流程结束。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PROCESS_COMPLETED_WITH_TERMINATE_END_EVENT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程已经到达终止结束事件(terminate end event)并结束。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableProcessTerminatedEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PROCESS_CANCELLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程已经被取消。在流程实例从运行时中删除前分发。流程实例由API调用<code>RuntimeService.deleteProcessInstance</code>取消。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableCancelledEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MEMBERSHIP_CREATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用户已经加入组。本事件包含了相关的用户和组的id。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableMembershipEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MEMBERSHIP_DELETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用户已经从组中移出。本事件包含了相关的用户和组的id。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableMembershipEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MEMBERSHIPS_DELETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">组的所有用户将被移出。本事件在用户移出前抛出，因此关联关系仍然可以访问。因为性能原因，不会再为每个被移出的用户抛出 <code>MEMBERSHIP_DELETED</code> 事件。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableMembershipEvent</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>引擎中所有的 <code>ENTITY_\*</code> 事件都与实体关联。下表列出每个实体分发的实体事件：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>ENTITY_CREATED, ENTITY_INITIALIZED, ENTITY_DELETED</code></strong>: 附件(Attachment)，备注(Comment)，部署(Deployment)，执行(Execution)，组(Group)，身份关联(IdentityLink)，作业(Job)，模型(Model)，流程定义(ProcessDefinition)，流程实例(ProcessInstance)，任务(Task)，用户(User)。</p>
</li>
<li>
<p><strong><code>ENTITY_UPDATED</code></strong>: 附件，部署，执行，组，身份关联，作业，模型，流程定义，流程实例，任务，用户。</p>
</li>
<li>
<p><strong><code>ENTITY_SUSPENDED, ENTITY_ACTIVATED</code></strong>: 流程定义，流程实例/执行，任务。</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="eventDispatcherRemarks">附加信息</h6>
<div class="paragraph">
<p><strong>监听器只会响应其所在引擎分发的事件。</strong>因此如果在同一个数据库上运行不同的引擎，则只有该监听器注册的引擎生成的事件，才会分发给该监听器。其他引擎生成的事件不会分发给这个监听器，而不论这些引擎是否运行在同一个JVM下。</p>
</div>
<div class="paragraph">
<p>某些事件类型（与实体相关）暴露了目标实体。按照事件类型的不同，有些实体不能被更新（如实体删除事件中的实体）。如果可能的话，请使用事件暴露的<code>EngineServices</code>来安全地操作引擎。即使这样，更新、操作事件中暴露的实体仍然需要小心。</p>
</div>
<div class="paragraph">
<p>历史不会分发实体事件，因为它们都有对应的运行时实体分发事件。</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="chapterApi">3.4.3. Flowable API</h4>
<div class="sect4">
<h5 id="apiEngine">流程引擎API与服务</h5>
<div class="paragraph">
<p>引擎API是与Flowable交互的最常用手段。总入口点是<code>ProcessEngine</code>。像<a href="#configuration">配置</a>章节中介绍的一样，ProcessEngine可以使用多种方式创建。使用ProcessEngine，可以获得各种提供工作流/BPM方法的服务。ProcessEngine与服务对象都是线程安全的，因此可以在服务器中保存并共用同一个引用。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.services.png" alt="api.services">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-n">ProcessEngine</span> <span class="tok-n">processEngine</span> <span class="tok-o">=</span> <span class="tok-n">ProcessEngines</span><span class="tok-o">.</span><span class="tok-na">getDefaultProcessEngine</span><span class="tok-o">();</span>

<span class="tok-n">RuntimeService</span> <span class="tok-n">runtimeService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getRuntimeService</span><span class="tok-o">();</span>
<span class="tok-n">RepositoryService</span> <span class="tok-n">repositoryService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getRepositoryService</span><span class="tok-o">();</span>
<span class="tok-n">TaskService</span> <span class="tok-n">taskService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getTaskService</span><span class="tok-o">();</span>
<span class="tok-n">ManagementService</span> <span class="tok-n">managementService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getManagementService</span><span class="tok-o">();</span>
<span class="tok-n">IdentityService</span> <span class="tok-n">identityService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getIdentityService</span><span class="tok-o">();</span>
<span class="tok-n">HistoryService</span> <span class="tok-n">historyService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getHistoryService</span><span class="tok-o">();</span>
<span class="tok-n">FormService</span> <span class="tok-n">formService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getFormService</span><span class="tok-o">();</span>
<span class="tok-n">DynamicBpmnService</span> <span class="tok-n">dynamicBpmnService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getDynamicBpmnService</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在<code>ProcessEngines.getDefaultProcessEngine()</code>第一次被调用时，将初始化并构建流程引擎，之后的重复调用都会返回同一个流程引擎。可以通过<code>ProcessEngines.init()</code>创建流程引擎，并由<code>ProcessEngines.destroy()</code>关闭流程引擎。</p>
</div>
<div class="paragraph">
<p>ProcessEngines会扫描<code>flowable.cfg.xml</code>与<code>flowable-context.xml</code>文件。对于<code>flowable.cfg.xml</code>文件，流程引擎会以标准Flowable方式构建引擎：<code>ProcessEngineConfiguration.createProcessEngineConfigurationFromInputStream(inputStream).buildProcessEngine()</code>。对于<code>flowable-context.xml</code>文件，流程引擎会以Spring的方式构建：首先构建Spring应用上下文，然后从该上下文中获取流程引擎。</p>
</div>
<div class="paragraph">
<p>所有的服务都是无状态的。这意味着你可以很容易的在集群环境的多个节点上运行Flowable，使用同一个数据库，而不用担心上一次调用实际在哪台机器上执行。不论在哪个节点执行，对任何服务的任何调用都是幂等（idempotent）的。</p>
</div>
<div class="paragraph">
<p><strong>RepositoryService</strong>很可能是使用Flowable引擎要用的第一个服务。这个服务提供了管理与控制<code>部署(deployments)</code>与<code>流程定义(process definitions)</code>的操作。在这里简单说明一下，流程定义是BPMN 2.0流程对应的Java对象，体现流程中每一步的结构与行为。<code>部署</code>是Flowable引擎中的包装单元，一个部署中可以包含多个BPMN 2.0 XML文件及其他资源。开发者可以决定在一个部署中包含的内容，可以是单个流程的BPMN 2.0 XML文件，也可以包含多个流程及其相关资源（如&#8217;hr-processes&#8217;部署可以包含所有与人力资源流程相关的的东西）。<code>RepositoryService</code>可用于<code>部署</code>这样的包。部署意味着将它上传至引擎，引擎将在储存至数据库之前检查与分析所有的流程。在部署操作后，可以在系统中使用这个部署包，部署包中的所有流程都可以启动。</p>
</div>
<div class="paragraph">
<p>此外，这个服务还可以：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>查询引擎现有的部署与流程定义。</p>
</li>
<li>
<p>暂停或激活部署中的某些流程，或整个部署。暂停意味着不能再对它进行操作，激活刚好相反，重新使它可以操作。</p>
</li>
<li>
<p>获取各种资源，比如部署中保存的文件，或者引擎自动生成的流程图。</p>
</li>
<li>
<p>获取POJO版本的流程定义。它可以用Java而不是XML的方式查看流程。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>与提供静态信息（也就是不会改变，至少不会经常改变的信息）的<code>RepositoryService</code>相反，<strong>RuntimeService</strong>用于启动流程定义的新流程实例。前面介绍过，<code>流程定义</code>中定义了流程中不同步骤的结构与行为。流程实例则是流程定义的实际执行过程。同一时刻，一个流程定义通常有多个运行中的实例。<code>RuntimeService</code>也用于读取与存储<code>流程变量</code>。流程变量是流程实例中的数据，可以在流程的许多地方使用（例如排他网关经常使用流程变量判断流程下一步要走的路径）。<code>RuntimeService</code>还可以用于查询流程实例与执行(Execution)。执行也就是BPMN 2.0中 <code>'token'</code> 的概念。通常执行是指向流程实例当前位置的指针。最后，还可以在流程实例等待外部触发时使用<code>RuntimeService</code>，使流程可以继续运行。流程有许多<code>等待状态(wait states)</code>，<code>RuntimeService</code>服务提供了许多操作用于“通知”流程实例：已经接收到外部触发，流程实例可以继续运行。</p>
</div>
<div class="paragraph">
<p>对于像Flowable这样的BPM引擎来说，核心是需要人类用户操作的任务。所有任务相关的东西都组织在<strong>TaskService</strong>中，例如：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>查询分派给用户或组的任务</p>
</li>
<li>
<p>创建<em>独立运行(standalone)</em>任务。这是一种没有关联到流程实例的任务。</p>
</li>
<li>
<p>决定任务的执行用户(assignee)，或者将用户通过某种方式与任务关联。</p>
</li>
<li>
<p>认领(claim)与完成(complete)任务。认领是指某人决定成为任务的执行用户，也即他将会完成这个任务。完成任务是指“做这个任务要求的工作”，通常是填写某个表单。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>IdentityService</strong>很简单。它用于管理（创建，更新，删除，查询……）组与用户。请注意，Flowable实际上在运行时并不做任何用户检查。例如任务可以分派给任何用户，而引擎并不会验证系统中是否存在该用户。这是因为Flowable有时要与LDAP、Active Directory等服务结合使用。</p>
</div>
<div class="paragraph">
<p><strong>FormService</strong>是可选服务。也就是说Flowable没有它也能很好地运行，而不必牺牲任何功能。这个服务引入了<em>开始表单(start form)</em>与<em>任务表单(task form)</em>的概念。 <em>开始表单</em>是在流程实例启动前显示的表单，而<em>任务表单</em>是用户完成任务时显示的表单。Flowable可以在BPMN 2.0流程定义中定义这些表单。表单服务通过简单的方式暴露这些数据。再次重申，表单不一定要嵌入流程定义，因此这个服务是可选的。</p>
</div>
<div class="paragraph">
<p><strong>HistoryService</strong>暴露Flowable引擎收集的所有历史数据。当执行流程时，引擎会保存许多数据（可配置），例如流程实例启动时间、谁在执行哪个任务、完成任务花费的事件、每个流程实例的执行路径，等等。这个服务主要提供查询这些数据的能力。</p>
</div>
<div class="paragraph">
<p><strong>ManagementService</strong>通常在用Flowable编写用户应用时不需要使用。它可以读取数据库表与表原始数据的信息，也提供了对作业(job)的查询与管理操作。Flowable中很多地方都使用作业，例如定时器(timer)，异步操作(asynchronous continuation)，延时暂停/激活(delayed suspension/activation)等等。后续会详细介绍这些内容。</p>
</div>
<div class="paragraph">
<p><strong>DynamicBpmnService</strong>可用于修改流程定义中的部分内容，而不需要重新部署它。例如可以修改流程定义中一个用户任务的办理人设置，或者修改一个服务任务中的类名。</p>
</div>
<div class="paragraph">
<p>参考<a href="http://www.flowable.org/docs/javadocs/index.html">javadocs</a>了解服务操作与引擎API的更多信息。</p>
</div>
</div>
<div class="sect4">
<h5 id="_exception_strategy">异常策略</h5>
<div class="paragraph">
<p>Flowable的异常基类是<code>org.flowable.engine.FlowableException</code>，这是一个非受检异常(unchecked exception)。在任何API操作时都可能会抛出这个异常，<a href="http://www.flowable.org/docs/javadocs/index.html">javadoc</a>提供了每个方法可能抛出的异常。例如，从<code>TaskService</code>中摘录：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-cm">/**</span>
<span class="tok-cm"> * 当任务成功执行时调用。</span>
<span class="tok-cm"> * @param taskId 需要完成的任务id，不能为null。</span>
<span class="tok-cm"> * @throws FlowableObjectNotFoundException 若给定id找不到任务。</span>
<span class="tok-cm"> */</span>
 <span class="tok-kt">void</span> <span class="tok-nf">complete</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">taskId</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在上例中，如果所用的id找不到任务，就会抛出异常。并且，由于javadoc中<strong>明确要求taskId不能为null，因此如果传递了<code>null</code>值，会抛出<code>FlowableIllegalArgumentException</code>异常</strong>。</p>
</div>
<div class="paragraph">
<p>尽管我们想避免过大的异常层次结构，但在特定情况下仍然会抛出下述异常子类。所有流程执行与API调用中发生的错误，如果不符合下面列出的异常，会统一抛出<code>FlowableExceptions</code>。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FlowableWrongDbException</code>: 当Flowable引擎检测到数据库表结构版本与引擎版本不匹配时抛出。</p>
</li>
<li>
<p><code>FlowableOptimisticLockingException</code>: 当对同一数据实体的并发访问导致数据存储发生乐观锁异常时抛出。</p>
</li>
<li>
<p><code>FlowableClassLoadingException</code>: 当需要载入的类（如JavaDelegate, TaskListener, &#8230;&#8203;）无法找到，或载入发生错误时抛出。</p>
</li>
<li>
<p><code>FlowableObjectNotFoundException</code>: 当请求或要操作的对象不存在时抛出。</p>
</li>
<li>
<p><code>FlowableIllegalArgumentException</code>: 当调用Flowable API时使用了不合法的参数时抛出。可能是引擎配置中的不合法值，或者是API调用传递的不合法参数，也可能是流程定义中的不合法值。</p>
</li>
<li>
<p><code>FlowableTaskAlreadyClaimedException</code>: 当对已被认领的任务调用<code>taskService.claim(&#8230;&#8203;)</code>时抛出。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="queryAPI">查询API</h5>
<div class="paragraph">
<p>从引擎中查询数据有两种方式：查询API与原生(native)查询。查询API可以使用链式API，通过编程方式进行类型安全的查询。你可以在查询中增加各种条件（所有条件都用做AND逻辑），也可以明确指定排序方式。下面是示例代码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">taskAssignee</span><span class="tok-o">(</span><span class="tok-s">&quot;kermit&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">processVariableValueEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;orderId&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;0815&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">orderByDueDate</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>有时需要更复杂的查询，例如使用OR操作符查询，或者使用查询API不能满足查询条件要求。我们为这种需求提供了可以自己写SQL查询的原生查询。返回类型由使用的查询对象决定，数据会映射到正确的对象中（Task、ProcessInstance、Execution，等等）。查询在数据库中进行，因此需要使用数据库中定义的表名与列名。这需要了解内部数据结构，因此建议小心使用原生查询。数据库表名可以通过API读取，这样可以将依赖关系减到最小。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createNativeTaskQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">sql</span><span class="tok-o">(</span><span class="tok-s">&quot;SELECT count(*) FROM &quot;</span> <span class="tok-o">+</span> <span class="tok-n">managementService</span><span class="tok-o">.</span><span class="tok-na">getTableName</span><span class="tok-o">(</span><span class="tok-n">Task</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span> <span class="tok-o">+</span>
      <span class="tok-s">&quot; T WHERE T.NAME_ = #{taskName}&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">parameter</span><span class="tok-o">(</span><span class="tok-s">&quot;taskName&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;gonzoTask&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>

<span class="tok-kt">long</span> <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createNativeTaskQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">sql</span><span class="tok-o">(</span><span class="tok-s">&quot;SELECT count(*) FROM &quot;</span> <span class="tok-o">+</span> <span class="tok-n">managementService</span><span class="tok-o">.</span><span class="tok-na">getTableName</span><span class="tok-o">(</span><span class="tok-n">Task</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-s">&quot; T1, &quot;</span> <span class="tok-o">+</span>
      <span class="tok-n">managementService</span><span class="tok-o">.</span><span class="tok-na">getTableName</span><span class="tok-o">(</span><span class="tok-n">VariableInstanceEntity</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-s">&quot; V1 WHERE V1.TASK_ID_ = T1.ID_&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">count</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="apiVariables">变量</h5>
<div class="paragraph">
<p>流程实例按步骤执行时，需要使用一些数据。在Flowable中，这些数据称作<em>变量(variable)</em>，并会存储在数据库中。变量可以用在表达式中（例如在排他网关中用于选择正确的出口路径），也可以在Java服务任务(service task)中用于调用外部服务（例如为服务调用提供输入或结果存储），等等。</p>
</div>
<div class="paragraph">
<p>流程实例可以持有变量（称作<em>流程变量 process variables</em>）；用户任务以及<em>执行(executions)</em>——流程当前活动节点的指针——也可以持有变量。流程实例可以持有任意数量的变量，每个变量存储为<em>ACT_RU_VARIABLE</em>数据库表的一行。</p>
</div>
<div class="paragraph">
<p>所有的<em>startProcessInstanceXXX</em>方法都有一个可选参数，用于在流程实例创建及启动时设置变量。例如，在<em>RuntimeService</em>中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">ProcessInstance</span> <span class="tok-nf">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">processDefinitionKey</span><span class="tok-o">,</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">variables</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以在流程执行中加入变量。例如，(<em>RuntimeService</em>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-kt">void</span> <span class="tok-nf">setVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">);</span>
<span class="tok-kt">void</span> <span class="tok-nf">setVariableLocal</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">);</span>
<span class="tok-kt">void</span> <span class="tok-nf">setVariables</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">,</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-o">?</span> <span class="tok-kd">extends</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">variables</span><span class="tok-o">);</span>
<span class="tok-kt">void</span> <span class="tok-nf">setVariablesLocal</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">,</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-o">?</span> <span class="tok-kd">extends</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">variables</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意可以为给定执行（请记住，流程实例由一颗执行的树(tree of executions)组成）设置<em>局部(local)</em>变量。局部变量将只在该执行中可见，对执行树的上层则不可见。这可以用于 数据不应该暴露给流程实例的其他执行，或者变量在流程实例的不同路径中有不同的值（例如使用并行路径时）的情况。</p>
</div>
<div class="paragraph">
<p>可以用下列方法读取变量。请注意<em>TaskService</em>中有类似的方法。这意味着任务与执行一样，可以持有局部变量，其生存期为任务持续的时间。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getVariables</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">);</span>
<span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getVariablesLocal</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">);</span>
<span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getVariables</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">,</span> <span class="tok-n">Collection</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">variableNames</span><span class="tok-o">);</span>
<span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getVariablesLocal</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">,</span> <span class="tok-n">Collection</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">variableNames</span><span class="tok-o">);</span>
<span class="tok-n">Object</span> <span class="tok-nf">getVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">);</span>
<span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">T</span> <span class="tok-nf">getVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">,</span> <span class="tok-n">Class</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">variableClass</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>变量通常用于<a href="#bpmnJavaServiceTask">Java代理（Java delegates）</a>、<a href="#apiExpressions">表达式（expressions）</a>、执行（execution）、任务监听器（tasklisteners）、脚本（scripts）等等。在这些结构中，提供了当前的<em>execution</em>或<em>task</em>对象，可用于变量的设置、读取。简单示例如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">getVariables</span><span class="tok-o">();</span>
<span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">getVariables</span><span class="tok-o">(</span><span class="tok-n">Collection</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">variableNames</span><span class="tok-o">);</span>
<span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">getVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">);</span>

<span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariables</span><span class="tok-o">(</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">object</span><span class="tok-o">&gt;</span> <span class="tok-n">variables</span><span class="tok-o">);</span>
<span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意也可以使用上例中方法的<em>局部变量</em>版本。</p>
</div>
<div class="paragraph">
<p>由于历史（与向后兼容）原因，当调用上述任何方法时，引擎会从数据库中取出<strong>所有</strong>变量。也就是说，如果你有10个变量，使用<em>getVariable("myVariable")</em>获取其中的一个，实际上其他9个变量也会从数据库取出并缓存。这并不坏，因为后续的调用可以不必再读取数据库。比如，如果流程定义包含三个连续的服务任务（因此它们在同一个数据库事务里），在第一个服务任务里通过一次调用获取全部变量，也许比在每个服务任务里分别获取需要的变量要好。请注意对读取与设置变量<strong>都是这样</strong>。</p>
</div>
<div class="paragraph">
<p>当然，如果使用大量变量，或者你希望精细控制数据库查询与流量，上述的做法就不合适了。我们引入了可以更精细控制的方法。这个方法有一个可选的参数，告诉引擎是否需要读取并缓存所有变量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getVariables</span><span class="tok-o">(</span><span class="tok-n">Collection</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">variableNames</span><span class="tok-o">,</span> <span class="tok-kt">boolean</span> <span class="tok-n">fetchAllVariables</span><span class="tok-o">);</span>
<span class="tok-n">Object</span> <span class="tok-nf">getVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">,</span> <span class="tok-kt">boolean</span> <span class="tok-n">fetchAllVariables</span><span class="tok-o">);</span>
<span class="tok-kt">void</span> <span class="tok-nf">setVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">,</span> <span class="tok-kt">boolean</span> <span class="tok-n">fetchAllVariables</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当<em>fetchAllVariables</em>参数为<em>true</em>时，行为与上面描述的完全一样：读取或设置一个变量时，所有的变量都将被读取并缓存。</p>
</div>
<div class="paragraph">
<p>而当参数值为<em>false</em>时，会使用明确的查询，其他变量不会被读取或缓存。只有指定的变量的值会被缓存并用于后续使用。</p>
</div>
</div>
<div class="sect4">
<h5 id="apiTransientVariables">瞬时变量</h5>
<div class="paragraph">
<p>瞬时变量(Transient variable)类似普通变量，只是不会被持久化。通常来说，瞬时变量用于高级使用场景。如果不明确，还是使用普通流程变量为好。</p>
</div>
<div class="paragraph">
<p>瞬时变量具有下列特性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>瞬时变量完全不存储历史。</p>
</li>
<li>
<p>与<em>普通</em>变量类似，设置瞬时变量时会存入<em>最上层父</em>中。这意味着在一个执行中设置一个变量时，瞬时变量实际上会存储在流程实例执行中。与普通变量类似，可以使用<em>局部(local)</em>的对应方法，将变量设置为某个执行或任务的局部变量。</p>
</li>
<li>
<p>瞬时变量只能在下一个“等待状态”之前访问。之后该变量即消失。等待状态意味着流程实例会持久化至数据存储中。请注意在这个定义中，<em>异步</em>活动也是“等待状态”！</p>
</li>
<li>
<p>只能使用<em>setTransientVariable(name, value)</em>设置瞬时变量，但是调用<em>getVariable(name)</em>也会返回瞬时变量（也有<em>getTransientVariable(name)</em>方法，它只会返回瞬时变量）。这是为了简化表达式的撰写，并保证已有逻辑可以使用这两种类型的变量。</p>
</li>
<li>
<p>瞬时变量<em>屏蔽(shadow)</em>同名的持久化变量。也就是说当一个流程实例中设置了同名的持久化变量与瞬时变量时，<em>getVariable("someVariable")</em>会返回瞬时变量的值。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在大多数可以使用普通变量的地方，都可以获取、设置瞬时变量：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在<em>JavaDelegate</em>实现中的<em>DelegateExecution</em>内</p>
</li>
<li>
<p>在<em>ExecutionListener</em>实现中的<em>DelegateExecution</em>内，以及在<em>TaskListener</em>实现中的<em>DelegateTask</em>内</p>
</li>
<li>
<p>通过<em>execution</em>对象在脚本任务内</p>
</li>
<li>
<p>通过RuntimeService启动流程实例时</p>
</li>
<li>
<p>完成任务时</p>
</li>
<li>
<p>调用<em>runtimeService.trigger</em>方法时</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>瞬时变量相关的方法遵循普通流程变量方法的命名约定：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-kt">void</span> <span class="tok-nf">setTransientVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">variableValue</span><span class="tok-o">);</span>
<span class="tok-kt">void</span> <span class="tok-nf">setTransientVariableLocal</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">variableValue</span><span class="tok-o">);</span>
<span class="tok-kt">void</span> <span class="tok-nf">setTransientVariables</span><span class="tok-o">(</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">transientVariables</span><span class="tok-o">);</span>
<span class="tok-kt">void</span> <span class="tok-nf">setTransientVariablesLocal</span><span class="tok-o">(</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">transientVariables</span><span class="tok-o">);</span>

<span class="tok-n">Object</span> <span class="tok-nf">getTransientVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">);</span>
<span class="tok-n">Object</span> <span class="tok-nf">getTransientVariableLocal</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">);</span>

<span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getTransientVariables</span><span class="tok-o">();</span>
<span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getTransientVariablesLocal</span><span class="tok-o">();</span>

<span class="tok-kt">void</span> <span class="tok-nf">removeTransientVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">);</span>
<span class="tok-kt">void</span> <span class="tok-nf">removeTransientVariableLocal</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>下面的BPMN流程图展示了一个典型例子：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.transient.variable.example.png" alt="api.transient.variable.example">
</div>
</div>
<div class="paragraph">
<p>假设&#8217;Fetch Data(获取数据)'服务任务调用某个远程服务（例如使用REST）。也假设需要其需要一些配置参数，并需要在启动流程实例时提供。同时，这些配置参数对于历史审计并不重要，因此我们将它们作为瞬时变量传递：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-n">ProcessInstance</span> <span class="tok-n">processInstance</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createProcessInstanceBuilder</span><span class="tok-o">()</span>
       <span class="tok-o">.</span><span class="tok-na">processDefinitionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;someKey&quot;</span><span class="tok-o">)</span>
       <span class="tok-o">.</span><span class="tok-na">transientVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;configParam01&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;A&quot;</span><span class="tok-o">)</span>
       <span class="tok-o">.</span><span class="tok-na">transientVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;configParam02&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;B&quot;</span><span class="tok-o">)</span>
       <span class="tok-o">.</span><span class="tok-na">transientVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;configParam03&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;C&quot;</span><span class="tok-o">)</span>
       <span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意在到达用户任务并持久化之前，都可以使用这些瞬时变量。例如，在&#8217;Additional Work(额外工作)'用户任务中它们就不再可用。也请注意如果&#8217;Fetch Data&#8217;是异步的，则瞬时变量在该步骤之后也不再可用。</p>
</div>
<div class="paragraph">
<p><em>Fetch Data</em>（的简化版本）可以像是：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">FetchDataServiceTask</span> <span class="tok-kd">implements</span> <span class="tok-n">JavaDelegate</span> <span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">DelegateExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">configParam01</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">)</span> <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">getVariable</span><span class="tok-o">(</span><span class="tok-n">configParam01</span><span class="tok-o">);</span>
    <span class="tok-c1">// ...</span>

    <span class="tok-n">RestReponse</span> <span class="tok-n">restResponse</span> <span class="tok-o">=</span> <span class="tok-n">executeRestCall</span><span class="tok-o">();</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setTransientVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;response&quot;</span><span class="tok-o">,</span> <span class="tok-n">restResponse</span><span class="tok-o">.</span><span class="tok-na">getBody</span><span class="tok-o">());</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setTransientVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;status&quot;</span><span class="tok-o">,</span> <span class="tok-n">restResponse</span><span class="tok-o">.</span><span class="tok-na">getStatus</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>'Process Data（处理数据）'可以获取response瞬时变量，解析并将其相关数据存储在实际流程变量中，因为之后还需要使用它们。</p>
</div>
<div class="paragraph">
<p>离开排他网关的顺序流上的条件表达式，不关注使用的是持久化还是瞬时变量（在这个例子中<em>status</em>是瞬时变量）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>${status == 200}<span class="tok-nt">&lt;/conditionExpression&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="apiExpressions">表达式</h5>
<div class="paragraph">
<p>Flowable使用UEL进行表达式解析。UEL代表<em>Unified Expression Language</em>，是EE6规范的一部分（查看<a href="http://docs.oracle.com/javaee/6/tutorial/doc/gjddd.html">EE6规范</a>了解更多信息）。</p>
</div>
<div class="paragraph">
<p>表达式可以用于<a href="#bpmnJavaServiceTaskXML">Java服务任务(Java Service task)</a>、<a href="#executionListeners">执行监听器(Execution Listener)</a>、<a href="#taskListeners">任务监听器(Task Listener)</a> 与 <a href="#conditionalSequenceFlowXml">条件顺序流(Conditional sequence flow)</a>等。尽管有值表达式与方法表达式这两种不同的表达式，Flowable通过抽象，使它们都可以在需要<code>表达式</code>的地方使用。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>值表达式 Value expression</strong>: 解析为一个值。默认情况下，所有流程变量都可以使用。（若使用Spring）所有的Spring bean也可以用在表达式里。例如：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>${myVar}
${myBean.myProperty}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>方法表达式 Method expression</strong>: 调用一个方法，可以带或不带参数。<strong>当调用不带参数的方法时，要确保在方法名后添加空括号（以避免与值表达式混淆）。</strong>传递的参数可以是字面值(literal value)，也可以是表达式，它们会被自动解析。例如：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>${printer.print()}
${myBean.addNewOrder('orderName')}
${myBean.doSomething(myVar, execution)}</pre>
</div>
</div>
<div class="paragraph">
<p>请注意，表达式支持解析（及比较）原始类型(primitive)、bean、list、array与map。
Note that these expressions support resolving primitives (including comparing them), beans, lists, arrays and maps.</p>
</div>
<div class="paragraph">
<p>除了所有流程变量外，还有一些默认对象可在表达式中使用：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>execution</code>: <code>DelegateExecution</code>+，持有正在运行的执行的额外信息。</p>
</li>
<li>
<p><code>task</code>: <code>DelegateTask</code>持有当前任务的额外信息。<strong>请注意：只在任务监听器的表达式中可用。</strong></p>
</li>
<li>
<p><code>authenticatedUserId</code>: 当前已验证的用户id。如果没有已验证的用户，该变量不可用。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>更多实际使用例子，请查看<a href="#springExpressions">Spring中的表达式</a>、<a href="#bpmnJavaServiceTaskXML">Java服务任务</a>、<a href="#executionListeners">执行监听器</a>、<a href="#taskListeners">任务监听器</a>或者<a href="#conditionalSequenceFlowXml">条件顺序流</a>等章节。</p>
</div>
</div>
<div class="sect4">
<h5 id="apiUnitTesting">单元测试</h5>
<div class="paragraph">
<p>业务流程是软件项目的必要组成部分，也需要使用测试一般应用逻辑的方法——单元测试——测试它们。Flowable是嵌入式的Java引擎，因此为业务流程编写单元测试就同编写一般的单元测试一样简单。</p>
</div>
<div class="paragraph">
<p>Flowable支持JUnit 3及4的单元测试风格。按照JUnit 3的风格，必须扩展(extended)<code>org.flowable.engine.test.FlowableTestCase</code>。它通过保护(protected)成员变量提供对ProcessEngine与服务的访问。在测试的<code>setup()</code>中，processEngine会默认使用classpath中的<code>flowable.cfg.xml</code>资源初始化。如果要指定不同的配置文件，请覆盖<em>getConfigurationResource()</em>方法。当使用相同的配置资源时，流程引擎会静态缓存，用于多个单元测试。</p>
</div>
<div class="paragraph">
<p>通过扩展<code>FlowableTestCase</code>，可以使用<code>org.flowable.engine.test.Deployment</code>注解测试方法。在测试运行前，会部署与测试类在同一个包下的格式为<code>testClassName.testMethod.bpmn20.xml</code>的资源文件。在测试结束时，会删除这个部署，包括所有相关的流程实例、任务，等等。也可以使用<code>Deployment</code>注解显式指定资源位置。查看该类以获得更多信息。</p>
</div>
<div class="paragraph">
<p>综上所述，JUnit 3风格的测试看起来类似：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyBusinessProcessTest</span> <span class="tok-kd">extends</span> <span class="tok-n">FlowableTestCase</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Deployment</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testSimpleProcess</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;simpleProcess&quot;</span><span class="tok-o">);</span>

    <span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;My Task&quot;</span><span class="tok-o">,</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>

    <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">complete</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createProcessInstanceQuery</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>要使用JUnit 4的风格书写单元测试并达成同样的功能，必须使用<code>org.flowable.engine.test.FlowableRule</code> Rule。这样能够通过它的getter获得流程引擎与服务。对于<code>FlowableTestCase</code>（上例），包含<code>@Rule</code>就可以使用<code>org.flowable.engine.test.Deployment</code>注解（参见上例解释其用途及配置），并且会自动在classpath中寻找默认配置文件。当使用相同的配置资源时，流程引擎会静态缓存，以用于多个单元测试。</p>
</div>
<div class="paragraph">
<p>下面的代码片段展示了JUnit 4风格的测试与<code>FlowableRule</code>的用法。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyBusinessProcessTest</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Rule</span>
  <span class="tok-kd">public</span> <span class="tok-n">FlowableRule</span> <span class="tok-n">flowableRule</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">FlowableRule</span><span class="tok-o">();</span>

  <span class="tok-nd">@Test</span>
  <span class="tok-nd">@Deployment</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">ruleUsageExample</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">RuntimeService</span> <span class="tok-n">runtimeService</span> <span class="tok-o">=</span> <span class="tok-n">flowableRule</span><span class="tok-o">.</span><span class="tok-na">getRuntimeService</span><span class="tok-o">();</span>
    <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;ruleUsage&quot;</span><span class="tok-o">);</span>

    <span class="tok-n">TaskService</span> <span class="tok-n">taskService</span> <span class="tok-o">=</span> <span class="tok-n">flowableRule</span><span class="tok-o">.</span><span class="tok-na">getTaskService</span><span class="tok-o">();</span>
    <span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;My Task&quot;</span><span class="tok-o">,</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>

    <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">complete</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createProcessInstanceQuery</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="apiDebuggingUnitTest">调试单元测试</h5>
<div class="paragraph">
<p>当使用H2内存数据库进行单元测试时，下面的方法可以让你在调试过程中方便地检查Flowable数据库中的数据。截图来自Eclipse，但其他IDE方式相似。</p>
</div>
<div class="paragraph">
<p>假设我们的单元测试的某处放置了<em>断点(breakpoint)</em>（在Eclipse里可以通过在代码左侧条上双击实现）：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.test.debug.breakpoint.png" alt="api.test.debug.breakpoint">
</div>
</div>
<div class="paragraph">
<p>如果我们在<em>debug</em>模式（在测试类中右键，选择“Run as”，然后选择“JUnit test”）下运行单元测试，测试进程会在断点处暂停，这样我们就可以在右上窗口中查看测试中的变量。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.test.debug.view.png" alt="api.test.debug.view">
</div>
</div>
<div class="paragraph">
<p>要检查Flowable的数据，打开<em>Display</em>窗口（如果没有找到这个窗口，打开 Window&#8594;Show View&#8594;Other，然后选择<em>Display</em>），并键入（可以使用代码补全）<code>org.h2.tools.Server.createWebServer("-web").start()</code></p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.test.debug.start.h2.server.png" alt="api.test.debug.start.h2.server">
</div>
</div>
<div class="paragraph">
<p>选中刚键入的行并右键点击。然后选择&#8217;Display'（或者用快捷键执行）</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.test.debug.start.h2.server.2.png" alt="api.test.debug.start.h2.server.2">
</div>
</div>
<div class="paragraph">
<p>现在打开浏览器并访问<a href="http://localhost:8082"><a href="http://localhost:8082" class="bare">http://localhost:8082</a></a>，填入内存数据库的JDBC URL（默认为<code>jdbc:h2:mem:flowable</code>），然后点击connect按钮。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.test.debug.h2.login.png" alt="api.test.debug.h2.login">
</div>
</div>
<div class="paragraph">
<p>这样就可以看到Flowable的数据。便于理解单元测试执行流程的方式。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.test.debug.h2.tables.png" alt="api.test.debug.h2.tables">
</div>
</div>
</div>
<div class="sect4">
<h5 id="apiProcessEngineInWebApp">Web应用中的流程引擎</h5>
<div class="paragraph">
<p><code>ProcessEngine</code>是线程安全的类，可以很容易地在多个线程间共享。在web应用中，这意味着可以在容器启动时创建引擎，并在容器关闭时关闭引擎。</p>
</div>
<div class="paragraph">
<p>下面的代码片段展示了如何在Servlet环境中，通过<code>ServletContextListener</code>初始化与销毁流程引擎。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ProcessEnginesServletContextListener</span> <span class="tok-kd">implements</span> <span class="tok-n">ServletContextListener</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">contextInitialized</span><span class="tok-o">(</span><span class="tok-n">ServletContextEvent</span> <span class="tok-n">servletContextEvent</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">ProcessEngines</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">contextDestroyed</span><span class="tok-o">(</span><span class="tok-n">ServletContextEvent</span> <span class="tok-n">servletContextEvent</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">ProcessEngines</span><span class="tok-o">.</span><span class="tok-na">destroy</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>contextInitialized</code>方法会调用<code>ProcessEngines.init()</code>。它会在classpath中查找<code>flowable.cfg.xml</code>资源文件，并为每个文件分别创建<code>ProcessEngine</code>（如果多个JAR都包含配置文件）。如果在classpath中有多个这样的资源文件，请确保它们使用不同的引擎名。需要使用流程引擎时，可以这样获取：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">ProcessEngines</span><span class="tok-o">.</span><span class="tok-na">getDefaultProcessEngine</span><span class="tok-o">()</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>或者</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">ProcessEngines</span><span class="tok-o">.</span><span class="tok-na">getProcessEngine</span><span class="tok-o">(</span><span class="tok-s">&quot;myName&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当然，就像<a href="#configuration">配置</a>章节中介绍的，还可以使用各种不同的方式创建流程引擎。</p>
</div>
<div class="paragraph">
<p>context-listener的<code>contextDestroyed</code>方法会调用<code>ProcessEngines.destroy()</code>。它会妥善关闭所有已初始化的流程引擎。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="springintegration">3.4.4. 集成Spring</h4>
<div class="paragraph">
<p>尽管完全可以脱离Spring使用Flowable，我们仍提供了很多非常好的集成特性，并将在这一章节介绍。</p>
</div>
<div class="sect4">
<h5 id="_processenginefactorybean">ProcessEngineFactoryBean</h5>
<div class="paragraph">
<p>可以将<code>ProcessEngine</code>配置为普通的Spring bean。入口是<code>org.flowable.spring.ProcessEngineFactoryBean</code>类。这个bean处理流程引擎配置，并创建流程引擎。所以在Spring中创建与设置的参数与<a href="#configuration">配置</a>章节中介绍的相同。Spring集成所用的配置与引擎bean为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.SpringProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    ...
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngine&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.ProcessEngineFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意<code>processEngineConfiguration</code> bean现在使用<code>org.flowable.spring.SpringProcessEngineConfiguration</code>类。</p>
</div>
</div>
<div class="sect4">
<h5 id="_transactions">事务</h5>
<div class="paragraph">
<p>我们会逐步说明(Flowable)发行版里，Spring示例中的<code>SpringTransactionIntegrationTest</code>。下面是我们示例中使用的Spring配置文件（SpringTransactionIntegrationTest-context.xml）。下面的小节包含了dataSource(数据源)，transactionManager(事务管理器)，processEngine(流程引擎)以及Flowable引擎服务。</p>
</div>
<div class="paragraph">
<p>将DataSource传递给<code>SpringProcessEngineConfiguration</code>（使用“dataSource”参数）时，Flowable会在内部使用<code>org.springframework.jdbc.datasource.TransactionAwareDataSourceProxy</code>对得到的数据源进行包装（wrap）。这是为了保证从数据源获取的SQL连接与Spring的事务可以协同工作。这样也就不需要在Spring配置中对数据源进行代理（proxy）。但仍然可以将代理<code>TransactionAwareDataSourceProxy</code>传递给<code>SpringProcessEngineConfiguration</code>——在这种情况下，不会再进行包装。</p>
</div>
<div class="paragraph">
<p><strong>请确保如果自行在Spring配置中声明了<code>TransactionAwareDataSourceProxy</code>，则不要将它用在已经配置Spring事务的资源上（例如DataSourceTransactionManager与JPATransactionManager。它们需要未经代理的数据源）。</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="tok-na">xmlns:context=</span><span class="tok-s">&quot;http://www.springframework.org/schema/context&quot;</span>
       <span class="tok-na">xmlns:tx=</span><span class="tok-s">&quot;http://www.springframework.org/schema/tx&quot;</span>
       <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans</span>
<span class="tok-s">                             http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="tok-s">                           http://www.springframework.org/schema/context</span>
<span class="tok-s">                             http://www.springframework.org/schema/context/spring-context-2.5.xsd</span>
<span class="tok-s">                           http://www.springframework.org/schema/tx</span>
<span class="tok-s">                             http://www.springframework.org/schema/tx/spring-tx-3.0.xsd&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.springframework.jdbc.datasource.SimpleDriverDataSource&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;driverClass&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.h2.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;url&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;username&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sa&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.SpringProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;asyncExecutorActivate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngine&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.ProcessEngineFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;repositoryService&quot;</span> <span class="tok-na">factory-bean=</span><span class="tok-s">&quot;processEngine&quot;</span> <span class="tok-na">factory-method=</span><span class="tok-s">&quot;getRepositoryService&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;runtimeService&quot;</span> <span class="tok-na">factory-bean=</span><span class="tok-s">&quot;processEngine&quot;</span> <span class="tok-na">factory-method=</span><span class="tok-s">&quot;getRuntimeService&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;taskService&quot;</span> <span class="tok-na">factory-bean=</span><span class="tok-s">&quot;processEngine&quot;</span> <span class="tok-na">factory-method=</span><span class="tok-s">&quot;getTaskService&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;historyService&quot;</span> <span class="tok-na">factory-bean=</span><span class="tok-s">&quot;processEngine&quot;</span> <span class="tok-na">factory-method=</span><span class="tok-s">&quot;getHistoryService&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;managementService&quot;</span> <span class="tok-na">factory-bean=</span><span class="tok-s">&quot;processEngine&quot;</span> <span class="tok-na">factory-method=</span><span class="tok-s">&quot;getManagementService&quot;</span> <span class="tok-nt">/&gt;</span>

...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这个Spring配置文件也包含了在这个示例中要用到的bean与配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans&gt;</span>
  ...
  <span class="tok-nt">&lt;tx:annotation-driven</span> <span class="tok-na">transaction-manager=</span><span class="tok-s">&quot;transactionManager&quot;</span><span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;userBean&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.test.UserBean&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;runtimeService&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;runtimeService&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;printer&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.test.Printer&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用任何Spring支持的方式创建应用上下文(application context)。在这个例子中，可以使用classpath中的XML资源配置来创建Spring应用上下文：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">ClassPathXmlApplicationContext</span> <span class="tok-n">applicationContext</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ClassPathXmlApplicationContext</span><span class="tok-o">(</span>
	<span class="tok-s">&quot;org/flowable/examples/spring/SpringTransactionIntegrationTest-context.xml&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>或者在单元测试中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-nd">@ContextConfiguration</span><span class="tok-o">(</span>
  <span class="tok-s">&quot;classpath:org/flowable/spring/test/transaction/SpringTransactionIntegrationTest-context.xml&quot;</span><span class="tok-o">)</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>然后就可以获取服务bean，并调用它们的方法。ProcessEngineFactoryBean会为服务加上额外的拦截器(interceptor)，并为Flowable服务方法设置Propagation.REQUIRED事务级别。这样，我们就可以使用repositoryService部署流程：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-n">RepositoryService</span> <span class="tok-n">repositoryService</span> <span class="tok-o">=</span>
  <span class="tok-o">(</span><span class="tok-n">RepositoryService</span><span class="tok-o">)</span> <span class="tok-n">applicationContext</span><span class="tok-o">.</span><span class="tok-na">getBean</span><span class="tok-o">(</span><span class="tok-s">&quot;repositoryService&quot;</span><span class="tok-o">);</span>
<span class="tok-n">String</span> <span class="tok-n">deploymentId</span> <span class="tok-o">=</span> <span class="tok-n">repositoryService</span>
  <span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">addClasspathResource</span><span class="tok-o">(</span><span class="tok-s">&quot;org/flowable/spring/test/hello.bpmn20.xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>还有另一种方法也可以使用。如果userBean.hello()方法在Spring事务中，Flowable服务方法调用就会加入这个事务。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">UserBean</span> <span class="tok-n">userBean</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">UserBean</span><span class="tok-o">)</span> <span class="tok-n">applicationContext</span><span class="tok-o">.</span><span class="tok-na">getBean</span><span class="tok-o">(</span><span class="tok-s">&quot;userBean&quot;</span><span class="tok-o">);</span>
<span class="tok-n">userBean</span><span class="tok-o">.</span><span class="tok-na">hello</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>UserBean看起来像下面这样。请记着在上面的Spring bean配置中，我们已经将repositoryService注入了userBean。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">UserBean</span> <span class="tok-o">{</span>

  <span class="tok-cm">/** 已经由Spring注入 */</span>
  <span class="tok-kd">private</span> <span class="tok-n">RuntimeService</span> <span class="tok-n">runtimeService</span><span class="tok-o">;</span>

  <span class="tok-nd">@Transactional</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">hello</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-c1">// 可以在你的领域模型（domain model）中进行事务操作，</span>
    <span class="tok-c1">// 它会与Flowable RuntimeService的startProcessInstanceByKey</span>
    <span class="tok-c1">// 合并在同一个事务里</span>
    <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;helloProcess&quot;</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setRuntimeService</span><span class="tok-o">(</span><span class="tok-n">RuntimeService</span> <span class="tok-n">runtimeService</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">runtimeService</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="springExpressions">表达式</h5>
<div class="paragraph">
<p>当使用ProcessEngineFactoryBean时，默认BPMN流程中所有的<a href="#apiExpressions">表达式</a>都可以“看见”所有的Spring bean。可以通过配置的map，限制表达式能使用的bean，甚至可以完全禁止表达式使用bean。下面的例子只暴露了一个bean（printer），可以使用“printer”作为key访问。<strong>要完全禁止表达式使用bean，可以将SpringProcessEngineConfiguration的‘beans’参数设为空list。如果不设置‘beans’参数，则上下文中的所有bean都将可以使用。</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.SpringProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  ...
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;beans&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;map&gt;</span>
      <span class="tok-nt">&lt;entry</span> <span class="tok-na">key=</span><span class="tok-s">&quot;printer&quot;</span> <span class="tok-na">value-ref=</span><span class="tok-s">&quot;printer&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/map&gt;</span>
  <span class="tok-nt">&lt;/property&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;printer&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.examples.spring.Printer&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样就可以在表达式中使用这个bean了。例如，SpringTransactionIntegrationTest <code>hello.bpmn20.xml</code>展示了如何通过UEL方法表达式(method expression)调用Spring bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span> <span class="tok-na">id=</span><span class="tok-s">&quot;definitions&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;helloProcess&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;print&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;print&quot;</span> <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;#{printer.printMessage()}&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;print&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;/process&gt;</span>

<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>其中<code>Printer</code>为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Printer</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">printMessage</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;hello world&quot;</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring bean配置（上面已经展示过）为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans&gt;</span>
  ...

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;printer&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.examples.spring.Printer&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_automatic_resource_deployment">自动部署资源</h5>
<div class="paragraph">
<p>集成Spring也提供了部署资源的特殊方式。在流程引擎配置中，可以指定一组资源。当创建流程引擎时，会扫描并部署这些资源。可以用过滤器阻止重复部署：只有当资源确实发生变化时，才会重新部署至Flowable数据库。在Spring容器经常重启（例如测试时）的时候，这很有用。</p>
</div>
<div class="paragraph">
<p>这里有个例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.SpringProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  ...
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;deploymentResources&quot;</span>
    <span class="tok-na">value=</span><span class="tok-s">&quot;classpath*:/org/flowable/spring/test/autodeployment/autodeploy.*.bpmn20.xml&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngine&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.ProcessEngineFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>默认情况下，上面的配置方式会将符合这个过滤器的所有资源组织在一起，作为Flowable引擎的一个部署。重复检测过滤器将作用于整个部署，避免重复地部署未改变资源。有时这不是你想要的。例如，如果用这种方式部署了一组资源，即使只有其中的一个资源发生了改变，整个部署都会被视作已改变，因此这个部署中所有的所有流程定义都会被重新部署。这将导致每个流程定义都会刷新版本号（流程定义id会变化），即使实际上只有一个流程发生了变化。</p>
</div>
<div class="paragraph">
<p>可以使用<code>SpringProcessEngineConfiguration</code>中的额外参数+deploymentMode+，定制部署的方式。这个参数定义了对于一组符合过滤器的资源，组织部署的方式。默认这个参数有3个可用值：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>default</code>: 将所有资源组织在一个部署中，整体用于重复检测过滤。这是默认值，在未设置这个参数时也会用这个值。</p>
</li>
<li>
<p><code>single-resource</code>: 为每个资源创建一个单独的部署，并用于重复检测过滤。如果希望单独部署每一个流程定义，并且只有在它发生变化时才创建新的流程定义版本，就应该使用这个值。</p>
</li>
<li>
<p><code>resource-parent-folder</code>: 为同一个目录下的资源创建一个单独的部署，并用于重复检测过滤。这个参数值可以为大多数资源创建独立的部署。同时仍可以通过将部分资源放在同一个目录下，将它们组织在一起。这里有一个将<code>deploymentMode</code>设置为<code>single-resource</code>的例子：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span>
    <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.SpringProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  ...
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;deploymentResources&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;classpath*:/flowable/*.bpmn&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;deploymentMode&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;single-resource&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果上述<code>deploymentMode</code>的参数值不能满足要求，还可以自定义组织部署的行为。创建<code>SpringProcessEngineConfiguration</code>的子类，并覆盖<code>getAutoDeploymentStrategy(String deploymentMode)</code>方法。这个方法用于确定对给定的<code>deploymentMode</code>参数值，应使用何种部署策略。</p>
</div>
</div>
<div class="sect4">
<h5 id="springUnitTest">单元测试</h5>
<div class="paragraph">
<p>与Spring集成后，业务流程可以非常简单地使用标准的 <a href="#apiUnitTesting">Flowable测试工具</a>进行测试。下面的例子展示了如何通过典型的基于Spring的单元测试，对业务流程进行测试：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</div></td><td class="code"><span></span><span class="tok-nd">@RunWith</span><span class="tok-o">(</span><span class="tok-n">SpringJUnit4ClassRunner</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-nd">@ContextConfiguration</span><span class="tok-o">(</span><span class="tok-s">&quot;classpath:org/flowable/spring/test/junit4/springTypicalUsageTest-context.xml&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyBusinessProcessTest</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Autowired</span>
  <span class="tok-kd">private</span> <span class="tok-n">RuntimeService</span> <span class="tok-n">runtimeService</span><span class="tok-o">;</span>

  <span class="tok-nd">@Autowired</span>
  <span class="tok-kd">private</span> <span class="tok-n">TaskService</span> <span class="tok-n">taskService</span><span class="tok-o">;</span>

  <span class="tok-nd">@Autowired</span>
  <span class="tok-nd">@Rule</span>
  <span class="tok-kd">public</span> <span class="tok-n">FlowableRule</span> <span class="tok-n">flowableSpringRule</span><span class="tok-o">;</span>

  <span class="tok-nd">@Test</span>
  <span class="tok-nd">@Deployment</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">simpleProcessTest</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;simpleProcess&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;My Task&quot;</span><span class="tok-o">,</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>

    <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">complete</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createProcessInstanceQuery</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">());</span>

  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意要让这个例子可以正常工作，需要在Spring配置中定义<em>org.flowable.engine.test.FlowableRule</em> bean（在上面的例子中通过@Autowire注入）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flowableRule&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.test.Flowable&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;processEngine&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;processEngine&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_jpa_with_hibernate_4_2_x">通过Hibernate 4.2.x使用JPA</h5>
<div class="paragraph">
<p>要在Flowable引擎的服务任务或者监听器逻辑中使用Hibernate 4.2.x JPA，需要添加Spring ORM的额外依赖。对Hibernate 4.1.x或更低则不需要。需要添加的依赖为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.springframework<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>spring-orm<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>${org.springframework.version}<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="chDeployment">3.4.5. 部署</h4>
<div class="sect4">
<h5 id="_business_archives">业务存档</h5>
<div class="paragraph">
<p>要部署流程，需要将它们包装在业务存档(BAR, Business archive)里。业务存档是Flowable引擎的部署单元，也就是一个ZIP文件。可以包含BPMN 2.0流程、表单定义、DMN规则，与其他类型的文件。总的来说，业务存档包含一组具名资源。</p>
</div>
<div class="paragraph">
<p>当部署业务存档时，会扫描具有<code>.bpmn20.xml</code>或<code>.bpmn</code>扩展名的BPMN文件。每一个这种文件都会被处理，并可以包含多个流程定义。
当启用DMN引擎时，也会解析<code>.dmn</code>。当启用表单引擎时，会处理<code>.form</code>文件。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>业务存档中的Java类<strong>不会添加至classpath</strong>。业务存档中，所有流程定义使用的自定义类（例如Java服务任务或者事件监听器），都需要放在运行流程的flowable引擎的classpath内。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_deploying_programmatically">编程方式部署</h6>
<div class="paragraph">
<p>从ZIP文件部署业务存档，可以这样做：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-n">String</span> <span class="tok-n">barFileName</span> <span class="tok-o">=</span> <span class="tok-s">&quot;path/to/process-one.bar&quot;</span><span class="tok-o">;</span>
<span class="tok-n">ZipInputStream</span> <span class="tok-n">inputStream</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ZipInputStream</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">FileInputStream</span><span class="tok-o">(</span><span class="tok-n">barFileName</span><span class="tok-o">));</span>

<span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">name</span><span class="tok-o">(</span><span class="tok-s">&quot;process-one.bar&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">addZipInputStream</span><span class="tok-o">(</span><span class="tok-n">inputStream</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以为单个资源构建部署。查看javadoc以获取更多信息。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_external_resources">外部资源</h5>
<div class="paragraph">
<p>流程定义保存在Flowable数据库中。这些流程定义在使用服务任务、执行监听器，或执行Flowable配置文件中定义的Spring bean时，可以引用委托类。这些类及Spring配置文件都需要在可能运行这个流程定义的流程引擎中可用。</p>
</div>
<div class="sect5">
<h6 id="_java_classes">Java类</h6>
<div class="paragraph">
<p>在流程启动时，引擎的classpath中需要有所有流程中用到的自定义类（例如服务任务、事件监听器、任务监听器等中用到的JavaDelegate）。</p>
</div>
<div class="paragraph">
<p>但是在部署业务存档时，classpath中可以没有这些类。这意味着，比如使用Ant部署新业务存档时，代理类不必提前放在classpath中。</p>
</div>
<div class="paragraph">
<p>当使用演示配置且希望添加自定义类时，需要在flowable-task或flowable-rest的webapp lib中，添加包含有你的自定义类的JAR。别忘了也要添加你的自定义类的依赖（若有）。或者，也可以将你的依赖添加到Tomcat的库文件夹<code>${tomcat.home}/lib</code>中。</p>
</div>
</div>
<div class="sect5">
<h6 id="_using_spring_beans_from_a_process">在流程中使用Spring bean</h6>
<div class="paragraph">
<p>在表达式或脚本中使用Spring bean时，执行该流程定义的引擎需要可以使用这些bean。可以简单直接地自行构建web应用，并按照<a href="#springintegration">集成Spring</a>章节的介绍在上下文中配置流程引擎。但也请牢记在心，如果使用Flowable task和rest web应用，就需要更新它的上下文配置。</p>
</div>
</div>
<div class="sect5">
<h6 id="_creating_a_single_app">创建单独应用</h6>
<div class="paragraph">
<p>如果不想费心在所有流程引擎的classpath中都包含所有需要的代理类，及保证它们都使用了正确的Spring配置，也可以考虑将Flowable rest web应用嵌入你自己的web应用。也就是说只使用一个单独的<code>ProcessEngine</code>。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="versioningOfProcessDefinitions">流程定义的版本</h5>
<div class="paragraph">
<p>BPMN并没有版本的概念。这其实很好，因为可执行的BPMN流程文件很可能已经作为开发项目的一部分，保存在版本管理系统仓库中了（例如Subversion，Git，或者Mercurial）。但是，作为部署过程的一部分，引擎会创建流程定义的版本。在部署时，Flowable会在保存至Flowable数据库前，为<code>ProcessDefinition</code>指定版本。</p>
</div>
<div class="paragraph">
<p>对于业务存档中的每个流程定义，为了初始化<code>key</code>、<code>version</code>、<code>name</code>与<code>id</code>参数，会执行下列步骤：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>XML文件中的流程定义<code>id</code>属性用作流程定义的<code>key</code>参数。</p>
</li>
<li>
<p>XML文件中的流程定义<code>name</code>属性用作流程定义的<code>name</code>参数。如果未给定<code>name</code>属性，会使用id作为name。</p>
</li>
<li>
<p>当每个key的流程第一次部署时，指定版本为1。对其后所有使用相同key的流程定义，部署时版本会在该key当前已部署的最高版本号基础上加1。key参数用于区分流程定义。</p>
</li>
<li>
<p>id参数设置为{processDefinitionKey}:{processDefinitionVersion}:{generated-id}，其中<code>generated-id</code>是一个唯一数字，用以保证在集群环境下，流程定义缓存中，流程id的唯一性。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以下面的流程为例</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myDefinitions&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myProcess&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My important process&quot;</span> <span class="tok-nt">&gt;</span>
    ...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当部署这个流程定义时，数据库中的流程定义会是这个样子：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess:1:676</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>如果我们现在部署同一个流程的更新版本（例如修改部分用户任务），且保持流程定义的<code>id</code>不变，那么流程定义表中会包含下面的记录：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess:1:676</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess:2:870</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>当调用<code>runtimeService.startProcessInstanceByKey("myProcess")</code>时，会使用版本<code>2</code>的流程定义，因为这是这个流程定义的最新版本。</p>
</div>
<div class="paragraph">
<p>如果再创建第二个流程，如下定义并部署至Flowable，表中会增加第三行。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myNewDefinitions&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myNewProcess&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My important process&quot;</span> <span class="tok-nt">&gt;</span>
    ...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>表数据类似：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess:1:676</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess:2:870</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">myNewProcess:1:1033</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myNewProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>请注意新流程的key与第一个流程的key不同。即使name是相同的（我们也可以修改它），Flowable也只用<code>id</code>属性来区分流程。因此新的流程部署时版本为1.</p>
</div>
</div>
<div class="sect4">
<h5 id="providingProcessDiagram">提供流程图</h5>
<div class="paragraph">
<p>可以在部署中添加流程图片。这个图片将存储在Flowable数据库中，并可以使用API访问。图片可以用在Flowable应用中，使流程可视化。</p>
</div>
<div class="paragraph">
<p>如果在classpath中，有一个<code>org/flowable/expenseProcess.bpmn20.xml</code>流程，key为&#8217;expense'。则流程图片会使用下列命名约定（按顺序）：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果部署中有图片资源，并且文件名包含BPMN 2.0 XML流程定义文件名以及流程key，并具有图形格式，则使用这个图片。在我们的例子中，就是<code>org/flowable/expenseProcess.expense.png</code>（或者.jpg/gif）。使用key的原因是，一个BPMN 2.0 XML文件中可以有多个流程定义。因此使用流程key区分每一个流程图的文件。</p>
</li>
<li>
<p>如果没有这种图片，就会寻找部署中匹配BPMN 2.0 XML文件名的图片资源。在我们的例子中，就是<code>org/flowable/expenseProcess.png</code>。请注意，这意味着同一个BPMN 2.0文件中的<strong>每一个流程定义</strong>，都会使用同一个流程图图片。当然，如果每个BPMN 2.0 XML文件中都只有一个流程定义，就没有问题。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>用编程方式部署的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span>
<span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">name</span><span class="tok-o">(</span><span class="tok-s">&quot;expense-process.bar&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">addClasspathResource</span><span class="tok-o">(</span><span class="tok-s">&quot;org/flowable/expenseProcess.bpmn20.xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">addClasspathResource</span><span class="tok-o">(</span><span class="tok-s">&quot;org/flowable/expenseProcess.png&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>图片资源可用下面的API获取：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-n">ProcessDefinition</span> <span class="tok-n">processDefinition</span> <span class="tok-o">=</span> <span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">createProcessDefinitionQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">processDefinitionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;expense&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>

<span class="tok-n">String</span> <span class="tok-n">diagramResourceName</span> <span class="tok-o">=</span> <span class="tok-n">processDefinition</span><span class="tok-o">.</span><span class="tok-na">getDiagramResourceName</span><span class="tok-o">();</span>
<span class="tok-n">InputStream</span> <span class="tok-n">imageStream</span> <span class="tok-o">=</span> <span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">getResourceAsStream</span><span class="tok-o">(</span>
    <span class="tok-n">processDefinition</span><span class="tok-o">.</span><span class="tok-na">getDeploymentId</span><span class="tok-o">(),</span> <span class="tok-n">diagramResourceName</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="generatingProcessDiagram">生成流程图</h5>
<div class="paragraph">
<p>如果部署时没有按<a href="#providingProcessDiagram">上小节</a>介绍的方式提供图片，且流程定义中包含必要的“图形交换(diagram interchange)”信息，Flowable引擎会生成流程图。</p>
</div>
<div class="paragraph">
<p>可以用与部署时<a href="#providingProcessDiagram">提供图片</a>完全相同的方法获取图片资源。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/deployment.image.generation.png" alt="deployment.image.generation">
</div>
</div>
<div class="paragraph">
<p>如果不需要或不希望在部署时生成流程图，可以在流程引擎配置中设置<code>isCreateDiagramOnDeploy</code>参数：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;createDiagramOnDeploy&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样就不会生成流程图了。</p>
</div>
</div>
<div class="sect4">
<h5 id="deploymentCategory">类别</h5>
<div class="paragraph">
<p>部署与流程定义都可以自定义类别。流程定义的类别使用BPMN文件中targetNamespace的值设置：<code>&lt;definitions &#8230;&#8203; targetNamespace="yourCategory" &#8230;&#8203;/&gt;</code>。</p>
</div>
<div class="paragraph">
<p>部署的类别也可用API如此设定：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">repositoryService</span>
    <span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">category</span><span class="tok-o">(</span><span class="tok-s">&quot;yourCategory&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">...</span>
    <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cmmn">3.5. CMMN</h3>
<div class="sect3">
<h4 id="_配置">3.5.1. 配置</h4>
<div class="sect4">
<h5 id="configuration">创建CmmnEngine</h5>
<div class="paragraph">
<p>Flowable CMMN引擎通过名为+flowable.cmmn.cfg.xml+的XML文件进行配置。 请注意，如果您使用的是“springintegration，构建流程引擎的Spring样式”，则这不适用*。</p>
</div>
<div class="paragraph">
<p>获得CmmnEngine的最简单方法是使用org.flowable.cmmn.engine.CmmnEngineConfiguration类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">CmmnEngine</span> <span class="tok-n">cmmnEngine</span> <span class="tok-o">=</span> <span class="tok-n">CmmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneCmmnEngineConfiguration</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这将在类路径上查找flowable.cmmn.cfg.xml文件，并根据该文件中的配置构造引擎。 以下代码段显示了示例配置。 以下部分将详细介绍配置属性。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.engine.CmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUrl&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcDriver&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.h2.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUsername&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sa&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcPassword&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，配置XML实际上是一个Spring配置。 这并不意味着Flowable只能在Spring环境中使用！我们只是在内部利用Spring的解析和依赖注入功能来构建引擎。</p>
</div>
<div class="paragraph">
<p>也可以使用配置文件以编程方式创建CmmnEngineConfiguration对象。 也可以使用不同的bean id（例如，参见第3行）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-n">CmmnEngineConfiguration</span><span class="tok-o">.</span>
  <span class="tok-nf">createCmmnEngineConfigurationFromResourceDefault</span><span class="tok-o">();</span>
  <span class="tok-n">createCmmnEngineConfigurationFromResource</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">resource</span><span class="tok-o">);</span>
  <span class="tok-n">createCmmnEngineConfigurationFromResource</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">resource</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">beanName</span><span class="tok-o">);</span>
  <span class="tok-n">createCmmnEngineConfigurationFromInputStream</span><span class="tok-o">(</span><span class="tok-n">InputStream</span> <span class="tok-n">inputStream</span><span class="tok-o">);</span>
  <span class="tok-n">createCmmnEngineConfigurationFromInputStream</span><span class="tok-o">(</span><span class="tok-n">InputStream</span> <span class="tok-n">inputStream</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">beanName</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以不使用配置文件，并基于创建配置默认值（有关更多信息，请参阅&lt;&lt; configurationClasses，不同支持的类&gt;&gt;）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">CmmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneCmmnEngineConfiguration</span><span class="tok-o">();</span>
<span class="tok-n">CmmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneInMemCmmnEngineConfiguration</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>所有这些CmmnEngineConfiguration.createXXX（）方法返回CmmnEngineConfiguration，如果需要可以进一步调整。 调用buildCmmnEngine（）操作后，创建一个 CmmnEngine：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">CmmnEngine</span> <span class="tok-n">cmmnEngine</span> <span class="tok-o">=</span> <span class="tok-n">CmmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneInMemCmmnEngineConfiguration</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">setDatabaseSchemaUpdate</span><span class="tok-o">(</span><span class="tok-n">CmmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">DB_SCHEMA_UPDATE_TRUE</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">setJdbcUrl</span><span class="tok-o">(</span><span class="tok-s">&quot;jdbc:h2:mem:my-own-db;DB_CLOSE_DELAY=1000&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">buildCmmnEngine</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configurationRoot">CmmnEngineConfiguration bean</h5>
<div class="paragraph">
<p>flowable.cmmn.cfg.xml必须包含一个具有id值为&#8217;cmmnEngineConfiguration&#8217;的bean。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span> <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.engine.CmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>然后使用该bean构造CmmnEngine 。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>org.flowable.cmmn.engine.impl.cfg.StandaloneInMemCmmnEngineConfiguration</strong>: this is a convenience class for unit testing purposes. Flowable will take care of all transactions. An H2 in-memory database is used by default. The database will be created and dropped when the engine boots and shuts down. When using this, no additional configuration is probably needed.</p>
</li>
<li>
<p><strong>org.flowable.cmmn.spring.SpringCmmnEngineConfiguration</strong>: To be used when the CMMN engine is used in a Spring environment.  See <a href="#springintegration">the Spring integration section</a> for more information.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="databaseConfiguration">数据源配置</h5>
<div class="paragraph">
<p>有两种方法可以配置Flowable CMMN引擎将使用的数据库。 第一个选项是定义数据库的JDBC属性：
* <strong>jdbcUrl</strong>: 数据库的JDBC URL.
* <strong>jdbcDriver</strong>: 为特定数据库类型实现驱动程序.
* <strong>jdbcUsername</strong>: 用于连接数据库的用户名.
* <strong>jdbcPassword</strong>: 用于连接数据库的密码.</p>
</div>
<div class="paragraph">
<p>基于提供的JDBC属性构造的数据源将具有默认链接： http：//www.mybatis.org/ [MyBatis]连接池设置。 可以选择设置以下属性来调整该连接池（取自MyBatis文档）：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>jdbcMaxActiveConnections</strong>: 连接池中处于被使用状态的连接的最大值。默认为10。</p>
</li>
<li>
<p><strong>jdbcMaxIdleConnections</strong>: 连接池中处于空闲状态的连接的最大值。</p>
</li>
<li>
<p><strong>jdbcMaxCheckoutTime</strong>: 连接被取出使用的最长时间，超过时间会被强制回收。 默认为20000（20秒）。</p>
</li>
<li>
<p><strong>jdbcMaxWaitTime</strong>:这是一个底层配置，让连接池可以在长时间无法获得连接时， 打印一条日志，并重新尝试获取一个连接。（避免因为错误配置导致沉默的操作失败）。 默认为20000（20秒）。
示例数据库配置：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUrl&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcDriver&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.h2.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUsername&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sa&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcPassword&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>我们的基准测试表明，在处理大量并发请求时，MyBatis连接池可能扛不住。 因此，我们建议使用javax.sql.DataSource实现并将其注入流程引擎配置（例如HikariCP，Tomcat JDBC连接池等）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;driverClassName&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;com.mysql.jdbc.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;url&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:mysql://localhost:3306/flowable&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;username&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;flowable&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;flowable&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;defaultAutoCommit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.engine.CmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-nt">/&gt;</span>
  ...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，Flowable 表单不附带允许您定义此类数据源的库。 所以你必须确保库在你的类路径上。</p>
</div>
<div class="paragraph">
<p>无论您使用的是JDBC还是数据源方法，都可以设置以下属性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>databaseType</strong>: 数据库类型，可以是如下的值（h2, mysql, oracle, postgres, mssql, db2）.</p>
</li>
<li>
<p><strong>databaseSchemaUpdate</strong>:允许您设置策略以在表单引擎启动和关闭时如何处理数据库表.</p>
<div class="ulist">
<ul>
<li>
<p><code>false</code> (default): 在创建表单引擎时检查库模式的版本，如果版本不匹配则抛出异常.</p>
</li>
<li>
<p><code>true</code>: 在构建表单引擎时，执行检查并在必要时执行模式的更新。 如果schema不存在，则创建它.</p>
</li>
<li>
<p><code>create-drop</code>: 在创建表单引擎时创建schema，并在关闭流程引擎时删除schema.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="jndiDatasourceConfig">JNDI方式数据源配置</h5>
<div class="paragraph">
<p>默认情况下，Flowable Form的数据库配置包含在每个Web应用程序的WEB-INF/classes中的db.properties文件中。 这并不总是理想的，因为它
要求用户修改Flowable源中的db.properties并重新编译WAR文件，或者在每次部署时分解WAR并修改db.properties。
通过使用JNDI（Java命名和目录接口）获取数据库连接，连接完全由Servlet容器管理，并且可以在WAR部署之外管理配置。 这也允许对db.properties文件提供的连接参数进行更多控制。</p>
</div>
<div class="sect5">
<h6 id="jndi_configuration">配置</h6>
<div class="paragraph">
<p>JNDI数据源的配置将根据您使用的servlet容器应用程序而有所不同。 以下说明适用于Tomcat，但对于其他容器应用程序，请参阅容器应用程序的文档。</p>
</div>
<div class="paragraph">
<p>如果使用Tomcat，则在$CATALINA_BASE/conf/[enginename]/[hostname]/[warname].xml中配置JNDI资源（对于Flowable UI，这通常是$CATALINA_BASE/conf/Catalina/localhost/flowable-app。XML）。 首次部署应用程序时，将从Flowable WAR文件复制默认上下文，因此如果已存在，则需要替换它。 例如，要更改JNDI资源以便应用程序连接到MySQL而不是H2，请将文件更改为以下内容：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
    <span class="tok-nt">&lt;Context</span> <span class="tok-na">antiJARLocking=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">path=</span><span class="tok-s">&quot;/flowable-app&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;Resource</span> <span class="tok-na">auth=</span><span class="tok-s">&quot;Container&quot;</span>
            <span class="tok-na">name=</span><span class="tok-s">&quot;jdbc/flowableDB&quot;</span>
            <span class="tok-na">type=</span><span class="tok-s">&quot;javax.sql.DataSource&quot;</span>
            <span class="tok-na">description=</span><span class="tok-s">&quot;JDBC DataSource&quot;</span>
            <span class="tok-na">url=</span><span class="tok-s">&quot;jdbc:mysql://localhost:3306/flowable&quot;</span>
            <span class="tok-na">driverClassName=</span><span class="tok-s">&quot;com.mysql.jdbc.Driver&quot;</span>
            <span class="tok-na">username=</span><span class="tok-s">&quot;sa&quot;</span>
            <span class="tok-na">password=</span><span class="tok-s">&quot;&quot;</span>
            <span class="tok-na">defaultAutoCommit=</span><span class="tok-s">&quot;false&quot;</span>
            <span class="tok-na">initialSize=</span><span class="tok-s">&quot;5&quot;</span>
            <span class="tok-na">maxWait=</span><span class="tok-s">&quot;5000&quot;</span>
            <span class="tok-na">maxActive=</span><span class="tok-s">&quot;120&quot;</span>
            <span class="tok-na">maxIdle=</span><span class="tok-s">&quot;5&quot;</span><span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;/Context&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_jndi_属性">JNDI 属性</h6>
<div class="paragraph">
<p>要配置JNDI数据源，请在Flowable UI的属性文件中使用以下属性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>spring.datasource.jndi-name=: 数据源的JNDI名称.</p>
</li>
<li>
<p>datasource.jndi.resourceRef: 设置查询是否发生在J2EE容器中，换句话说，如果JNDI名称尚未包含它，则需要添加前缀“java：comp/env/”。 默认为“true”.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="supporteddatabases">支持的数据库厂商</h5>
<div class="paragraph">
<p>下面列出了Flowable用于引用数据库的类型（区分大小写！）。ses.</p>
</div>
<table id="databaseTypes" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">数据库类型</th>
<th class="tableblock halign-left valign-top">连接URL</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">h2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:h2:tcp://localhost/flowable_form</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default configured database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mysql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:mysql://localhost:3306/flowable_form?autoReconnect=true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tested using mysql-connector-java database driver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">oracle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:oracle:thin:@localhost:1521:xe</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">postgres</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:postgresql://localhost:5432/flowable_form</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">db2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:db2://localhost:50000/flowable_form</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mssql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:sqlserver://localhost:1433;databaseName=flowable_form (jdbc.driver=com.microsoft.sqlserver.jdbc.SQLServerDriver) <em>OR</em> jdbc:jtds:sqlserver://localhost:1433/flowable_form (jdbc.driver=net.sourceforge.jtds.jdbc.Driver)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tested using Microsoft JDBC Driver 4.0 (sqljdbc4.jar) and JTDS Driver</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="creatingDatabaseTable">创建表</h5>
<div class="paragraph">
<p>为数据库创建数据库表的最简单方法是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在classpath中添加flowable-cmmn-engine JARS包</p>
</li>
<li>
<p>添加合适的数据库驱动</p>
</li>
<li>
<p>将Flowable配置文件（flowable.cmmn.cfg.xml）添加到类路径中，指向您的数据库（请参阅&lt;&lt; databaseConfiguration，数据库配置部分&gt;&gt;）</p>
</li>
<li>
<p>执行DbSchemaCreate类的main方法</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>但是，通常只有数据库管理员才能在数据库上执行DDL语句。 在生产系统中，这也是最明智的选择。 可以在Flowable下载页面或Flowable分发文件夹内的database 子目录中找到SQL DDL语句。 这些脚本也在引擎JAR（flowable-cmmn-engine-x.jar）中，在包org/ flowable/cmmn/db /create中。 SQL文件的形式</p>
</div>
<div class="listingblock">
<div class="content">
<pre>flowable.{db}.cmmn.create.sql</pre>
</div>
</div>
<div class="paragraph">
<p>其中<em>db</em>是&lt;&lt; supporteddatabases，supported databases &gt;&gt;中的任何一个。</p>
</div>
</div>
<div class="sect4">
<h5 id="database.tables.explained">数据库表名称解释</h5>
<div class="paragraph">
<p>Flowable CMMN Engine的数据库名称均以* ACT_CMMN_ *开头。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ACT_CMMN_</strong>*: 没有附加前缀的表包含“static”信息，例如案例定义和案例资源（图像，规则等）。</p>
</li>
<li>
<p><strong>ACT_CMMN_RU_</strong>*: 'RU&#8217;代表+运行时+。 这些是包含案例实例，计划项目等的运行时数据的运行时表。 Flowable仅在案例实例执行期间存储运行时数据，并在案例实例结束时删除记录。 这使运行时表保持小而快。</p>
</li>
<li>
<p><strong>ACT_CMMN_HI_</strong>*:'HI&#8217;代表历史。 这些是包含历史数据的表，例如过去的案例实例，计划项等。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="databaseUpgrade">数据库升级</h5>
<div class="paragraph">
<p>在运行升级之前，请确保备份数据库（使用数据库备份功能）。</p>
</div>
<div class="paragraph">
<p>默认情况下，每次创建流程引擎时都会执行版本检查。 这通常在应用程序或Flowable Web应用程序的引导时发生一次。 如果Flowable库注意到库版本与Flowable数据库表的版本之间的差异，则抛出异常。</p>
</div>
<div class="paragraph">
<p>要升级，必须首先将以下配置属性放在flowable.cmmn.cfg.xml配置文件中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans</span> <span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span>
      <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.engine.CmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-c">&lt;!-- ... --&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-c">&lt;!-- ... --&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>使用databaseSchemaUpdate设置为true即可完成自动升级。</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="historyConfiguration">历史配置</h5>
<div class="paragraph">
<p>自定义历史存储的配置是可选的。 这允许您调整影响引擎的“历史记录，历史记录功能”的设置。 有关详细信息，请参阅&lt;&lt; historyConfig，history configuration &gt;&gt;。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;history&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;audit&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="exposingConfigurationBeans">在表达式和脚本中公开配置bean</h5>
<div class="paragraph">
<p>默认情况下，您在flowable.cmmn.cfg.xml配置或您自己的Spring配置文件中指定的所有bean都可用于表达式和脚本。 如果要限制配置文件中bean的可见性，可以在流程引擎配置中配置名为beans的属性。 CmmnEngineConfiguration中的beans属性是一个map。 指定该属性时，表达式和脚本只能看到该映射中指定的bean。 暴露的bean将使用您在地图中指定的名称公开。</p>
</div>
</div>
<div class="sect4">
<h5 id="caseDefinitionCacheConfiguration">部署缓存配置</h5>
<div class="paragraph">
<p>所有定义都被缓存（在解析之后），以避免每次需要表单时都访问数据库，并且表单数据不会更改。 默认情况下，此缓存没有限制。 要限制表单缓存使用的容器大小，请添加以下属性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;caseDefinitionCacheLimit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;10&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>设置此属性将使默认的LRU算法。 当然，此属性的“最佳”值取决于存储的案例总量和运行时实际使用的案例数。</p>
</div>
<div class="paragraph">
<p>您也可以注入自己的缓存实现。 这必须是实现org.flowable.engine.common.impl.persistence.deploy.DeploymentCache接口的bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;caseDefinitionCache&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.MyCache&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/property&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="loggingConfiguration">日志</h5>
<div class="paragraph">
<p>所有日志记录（flowable，spring，mybatis，&#8230;&#8203;）都通过SLF4J进行路由，并允许选择您选择的日志记录实现。</p>
</div>
<div class="paragraph">
<p>*默认情况下，flowable-dmn-engine依赖项中不存在SFL4J-binding jar，这应该在项目中添加，以便使用您选择的日志框架。
*如果没有添加实现jar，SLF4J将使用NOP-logger，不记录任何内容，除了警告不会记录任何内容。 有关这些绑定链接的更多信息，请访问：http://www.slf4j.org/codes.html#StaticLoggerBinder[<a href="http://www.slf4j.org/codes.html#StaticLoggerBinder" class="bare">http://www.slf4j.org/codes.html#StaticLoggerBinder</a>]。
使用Maven，添加例如这样的依赖（这里使用log4j），请注意您仍然需要添加一个版本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.slf4j<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>slf4j-log4j12<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>flowable-ui和flowable-rest webapps配置了使用Log4j binding.。 在运行所有flowable-*模块的测试时也使用Log4j。</p>
</div>
<div class="paragraph">
<p>在类路径中使用带有commons-logging的容器时的重要注意事项：
为了通过SLF4J路由spring-logging，使用了一个桥接器（参见链接：http://www.slf4j.org/legacy.html#jclOverSLF4J[<a href="http://www.slf4j.org/legacy.html#jclOverSLF4J" class="bare">http://www.slf4j.org/legacy.html#jclOverSLF4J</a>]）。
如果您的容器提供了commons-logging实现，请按照此页面上的说明进行操作：http://www.slf4j.org/codes.html#release[<a href="http://www.slf4j.org/codes.html#release" class="bare">http://www.slf4j.org/codes.html#release</a>]确保稳定性。</p>
</div>
<div class="paragraph">
<p>使用Maven时的示例（省略版本）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.slf4j<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>jcl-over-slf4j<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="chapterApi">3.5.2. The Flowable CMMN API</h4>
<div class="sect4">
<h5 id="apiEngine">流程 CMMN 引擎 API 与服务类</h5>
<div class="paragraph">
<p>引擎 API 是与 Flowable 交互的最常用方式。核心起点是可以通过<a href="#configuration">配置部分</a>中描述的几种方式创建的 <code>CMMN 引擎</code>。从 CMMN 引擎中，您可以获得包含案例/CMMN 方法的各种服务类。CMMN 引擎和其服务类对象是线程安全的，因此您可以为整个服务保留其中一个引用。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-n">CmmnEngine</span> <span class="tok-n">cmmnEngine</span> <span class="tok-o">=</span> <span class="tok-n">CmmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneCmmnEngineConfiguration</span><span class="tok-o">();</span>

<span class="tok-n">CmmnRuntimeService</span> <span class="tok-n">runtimeService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnRuntimeService</span><span class="tok-o">();</span>
<span class="tok-n">CmmnRepositoryService</span> <span class="tok-n">repositoryService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnRepositoryService</span><span class="tok-o">();</span>
<span class="tok-n">CmmnTaskService</span> <span class="tok-n">taskService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnTaskService</span><span class="tok-o">();</span>
<span class="tok-n">CmmnManagementService</span> <span class="tok-n">managementService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnManagementService</span><span class="tok-o">();</span>
<span class="tok-n">CmmnHistoryService</span> <span class="tok-n">historyService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnHistoryService</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>CmmnEngineConfiguration.createStandaloneCmmnEngineConfiguration()</code> 将初始化并构建 CMMN 引擎，然后始终返回这个 CMMN 引擎。</p>
</div>
<div class="paragraph">
<p>CmmnEngineConfiguration 类将扫描所有 <code>flowable.cmmn.cfg.xml</code> 和 <code>flowable-cmmn-context.xml</code> 配置文件。对于所有 <code>flowable.cmmn.cfg.xml</code> 配置文件，CMMN 引擎将以典型的 Flowable 方式构建：<code>CmmnEngineConfiguration.createCmmnEngineConfigurationFromInputStream(inputStream).buildCmmnEngine()</code>。对于所有 <code>flowable-cmmn-context.xml</code> 配置文件，CMMN 引擎将以 Spring 方式构建：首先创建 Spring 应用程序上下文，然后 CMMN 引擎会从该应用程序上下文中获取。</p>
</div>
<div class="paragraph">
<p>所有的服务类均是无状态的。这意味着您可以轻松地在群集中的多个节点上运行Flowable，每个节点都连接同一个数据库，而不必担心哪台机器实际执行了旧的调用。对任何服务类的任何调用都是幂等的，无论它在何处执行。</p>
</div>
<div class="paragraph">
<p><strong>CmmnRepositoryService</strong> 可能是 Flowable CMMN 引擎工作时所需的第一个服务类。该服务类提供用于管理和使用<code>部署文件</code>和<code>案例定义</code>的操作。案例定义是 CMMN 1.1案例的 Java 对应物，它表示案例的每个步骤的结构和行为，这里不再过多介绍。<code>部署文件</code>是 Flowable CMMN 引擎中的打包单元。部署文件可以包含多个CMMN 1.1 XML文件和任何其他资源，其中具体包含哪些内容取决于开发人员。它的范围可以从单个流程 CMMN 1.1 XML 文件到整个案例和相关资源的包（例如，部署文件“hr-cases”可能包含与 HR 案例相关的所有内容）。<code>CmmnRepositoryService</code> 可以<code>发布</code>这样的包。发布一个部署文件意味着将其上载到引擎，在该引擎中，所有案例在存储到数据库之前都会被检查和解析。从那一刻起，系统会感知到这个部署文件，并且部署文件中包含的任何流程都可以被发起。</p>
</div>
<div class="paragraph">
<p>此外，这个服务类允许您：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>查询引擎已知的部署文件和案例定义。</p>
</li>
<li>
<p>检索各种资源，例如部署文件中包含的文件或引擎自动生成的案例图。</p>
</li>
<li>
<p>检索案例定义的 POJO 版本，它可用于使用 Java 而不是 JSON 进行内省。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>CmmnRepositoryService</code> 主要与静态信息（数据不会改变，至少不会变很多）有关，而 <strong>CmmnRuntimeService</strong> 恰恰相反，它涉及启动案例定义的新案例实例。如上所述，<code>案例定义</code>定义了案例的不同步骤的结构和行为。案例实例是案例定义的一次执行。对于每个案例定义，通常会有许多实例同时运行。CmmnRuntimeService 也是用于检索和存储案例变量的服务类。变量是特定于指定案例实例的数据，并且可以让案例中的各种结构使用（例如，方案的跳转条件通常使用流程变量来确定选择哪个路径来继续流转该案例）。CmmnRuntimeService 还允许您查询案例实例和方案条目。方案条目是 CMMN 1.1的已启用方案条目的表示。最后，无论何时案例实例需要继续流转并等待外部触发时都会使用 CmmnRuntimeService。案例实例可以具有各种等待状态，该服务类包含各种操作来向实例“发信号”并由外部触发器接收，然后案例实例可以继续流转。</p>
</div>
<div class="paragraph">
<p>需要由系统的操作用户执行的任务是 Flowable 这类 CMMN 引擎的核心。围绕任务的所有内容都分组在 <strong>CmmnTaskService</strong> 中，例如：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>查询分配给用户或组的任务</p>
</li>
<li>
<p>创建新的独立任务，这些任务与流程实例无关。</p>
</li>
<li>
<p>操作派遣任务的参与人或以某种方式参与任务的用户。</p>
</li>
<li>
<p>签收并完成一个任务。 签收意味着某人决定成为该任务的操作人，这意味着该用户将审批该任务，审批意味着“完成任务”。通常这是填写一种表单。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>CmmnHistoryService</strong> 暴露 Flowable CMMN 引擎收集的所有历史数据。在执行案例时，引擎可以保存大量数据（可以通过配置决定是否启用），例如案例实例开始时间，谁执行哪些任务，审批任务花费多长时间，每个案例实例流经哪条路径等。此服务类主要暴露查询功能以访问此类数据。</p>
</div>
<div class="paragraph">
<p><strong>CmmnManagementService</strong> 提供对数据库表低级信息的访问，允许查询不同类型的工作并执行它们。</p>
</div>
<div class="paragraph">
<p>有关服务操作和引擎 API 的更多详细信息，请参阅<a href="http://www.flowable.org/docs/javadocs/index.html">文档</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_异常策略">异常策略</h5>
<div class="paragraph">
<p>Flowable 中的基础异常是 <code>org.flowable.engine.FlowableException</code>，这是一个未经检查的异常。这种异常可以被 API 随时抛出，其他特定方法中发生的“预期中的”异常被记录在<a href="http://www.flowable.org/docs/javadocs/index.html">文档</a>中。例如 <code>CmmnTaskService</code> 的摘录：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-cm">/**</span>
<span class="tok-cm"> * 成功执行任务时调用。</span>
<span class="tok-cm"> * @param taskId 要完成的任务的id，不能为空。</span>
<span class="tok-cm"> * @throws FlowableObjectNotFoundException 当指定id的任务不存在时抛出。</span>
<span class="tok-cm"> */</span>
 <span class="tok-kt">void</span> <span class="tok-nf">complete</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">taskId</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的示例中，当传递不存在的任务 id 时，将抛出异常。同样的，由于 Java 文档<strong>明确声明 taskId 不能为 null，因此在传递 <code>null</code> 时将抛出 <code>FlowableIllegalArgumentException</code></strong> 。</p>
</div>
<div class="paragraph">
<p>尽管我们想要避免一个大的异常层次结构，下列的异常子类仍会在特定情况下被抛出。在流程执行或 API 调用期间发生的所有其他错误都不适合下面可能发生的异常，这些错误将作为常规 <code>FlowableExceptions</code> 抛出。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FlowableWrongDbException</code>：当 Flowable 引擎发现数据库 Schema 版本与引擎版本不匹配时抛出。</p>
</li>
<li>
<p><code>FlowableOptimisticLockingException</code>：当由同一数据条目的并发访问引起的数据存储中发生乐观锁问题时抛出。</p>
</li>
<li>
<p><code>FlowableClassLoadingException</code>：当未找到请求加载的类或加载时发生错误时抛出（例如 Java 代理类、任务监听器等）。</p>
</li>
<li>
<p><code>FlowableObjectNotFoundException</code>：当请求或操作的对象不存在时抛出。</p>
</li>
<li>
<p><code>FlowableIllegalArgumentException</code>：这个异常表示在 Flowable API 调用中使用了非法参数、在引擎的配置中配置了非法值。</p>
</li>
<li>
<p><code>FlowableTaskAlreadyClaimedException</code>：当一个任务已经被签收时，再次调用 <code>taskService.claim(&#8230;&#8203;)</code> 时抛出。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="queryAPI">查询 API</h5>
<div class="paragraph">
<p>有两种方法可以从引擎查询数据：使用查询 API 和本地查询。查询 API 允许您使用流畅的 API 编写完全类型安全的查询。您可以为查询添加各种查询条件（所有条件共同应用逻辑与）与一个排序参数。示例如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">taskAssignee</span><span class="tok-o">(</span><span class="tok-s">&quot;kermit&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">orderByDueDate</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="apiVariables">变量</h5>
<div class="paragraph">
<p>每个案例实例都需要并使用数据来执行自身节点来进行流转。在 Flowable 中, 这种数据被称为<em>变量</em>, 它们存储在数据库中。变量可以在表达式中使用（例如在哨兵的条件中）、在调用外部服务时的 Java 服务任务中使用（例如提供输入或存储服务调用的结果）等。</p>
</div>
<div class="paragraph">
<p>案例实例可以包含变量（称为<em>案例变量</em>）, 同样的<em>方案条目实例</em>和人工任务也可以包含变量。案例实例可以包含任意数量的变量。每个变量都存储在 <em>ACT_RU_VARIABLE</em> 数据库表的一行中。</p>
</div>
<div class="paragraph">
<p><em>createCaseInstanceBuilder_方法具有可选方法，用于通过 _CmmnRuntimeService</em> 创建案例实例并启动时提供变量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">CaseInstance</span> <span class="tok-n">caseInstance</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceBuilder</span><span class="tok-o">().</span><span class="tok-na">variable</span><span class="tok-o">(</span><span class="tok-s">&quot;var1&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;test&quot;</span><span class="tok-o">).</span><span class="tok-na">start</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在案例执行期间可以添加变量。例如 <em>CmmnRuntimeService</em>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-kt">void</span> <span class="tok-nf">setVariables</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">caseInstanceId</span><span class="tok-o">,</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-o">?</span> <span class="tok-kd">extends</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">variables</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>如下所示，变量同样可以被检索。请注意 <em>CmmnTaskService</em> 上存在类似的方法。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getVariables</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">caseInstanceId</span><span class="tok-o">);</span>
<span class="tok-n">Object</span> <span class="tok-nf">getVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">caseInstanceId</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>变量通常用于 Java 服务任务、达式和脚本中等。</p>
</div>
</div>
<div class="sect4">
<h5 id="apiTransientVariables">临时变量</h5>
<div class="paragraph">
<p>临时变量是行为类似于常规变量的变量，但不是持久变量。通常，临时变量用于高级用例。如有疑问，请使用常规案例变量。</p>
</div>
<div class="paragraph">
<p>以下情况适用于临时变量：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>临时变量根本不会存储历史记录。</p>
</li>
<li>
<p>与<em>常规</em>变量一样，临时变量在设置时会放在<em>最高级父节点</em>上。这意味着在方案条目上设置变量时，临时变量实际存储在案例执行实例中。与常规变量一样，如果在特定方案条目或任务上设置变量，则存在方法的<em>本地</em>变体。</p>
</li>
<li>
<p>临时变量只能在案例定义中的下一个“等待状态”之前访问。在那之后无法访问。在这里，等待状态表示案例实例中持久化到数据存储的时间点。</p>
</li>
<li>
<p>临时变量只能由 <em>setTransientVariable(name, value)</em> 设置，但在调用 <em>getVariable(name)</em> 时也会返回临时变量（临时变量在 <em>getTransientVariable(name)</em> 中也存在，它只检查瞬态变量）。这样做的原因是使表达式的编写变得容易，并且使用变量的现有逻辑适用于这两种变量类型。</p>
</li>
<li>
<p>临时变量会<em>优先于</em>相同名称的持久变量。这意味着当在同一案例实例上设置相同名称的持久变量和临时变量后调用 <em>getVariable("someVariable")</em> 时，将返回临时变量值。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>您可以在暴露常规变量的大多数地方设置和获取临时变量：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在 <em>PlanItemJavaDelegate</em> 实现中的 <em>DelegatePlanItemInstance</em> 上</p>
</li>
<li>
<p>通过运行时服务类启动案例实例时</p>
</li>
<li>
<p>审批一个任务时</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这些方法遵循常规案例变量的命名约定：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">CaseInstance</span> <span class="tok-n">caseInstance</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceBuilder</span><span class="tok-o">().</span><span class="tok-na">transientVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;var1&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;test&quot;</span><span class="tok-o">).</span><span class="tok-na">start</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="apiExpressions">表达式</h5>
<div class="paragraph">
<p>Flowable 使用 UEL 进行表达式解析。UEL 即 <em>Unified Expression Language（统一表达语言）</em>并且是 Java EE 6规范的一部分（详情参见 <a href="http://docs.oracle.com/javaee/6/tutorial/doc/gjddd.html">Java EE6 规范</a> ）。</p>
</div>
<div class="paragraph">
<p>表达式可用于例如 Java 服务任务和方案条目流转。虽然有两种类型的表达式：值表达式和方法表达式，但 Flowable 对此进行了抽象，因此它们都可以在需要<code>表达式</code>的地方使用。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>值表达式</strong>：解析为一个值。默认情况下，可以使用所有案例变量。此外，所有 Spring-beans（如果使用 Spring 的话）都可用于表达式。一些例子：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>${myVar}
${myBean.myProperty}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>方法表达式</strong>：调用带或不带参数的方法。<strong>在调用不带参数的方法时，请确保在方法名称后添加空括号（因为这会将方法表达式与值表达式区分开来）。</strong>传递的参数可以是文本值或自己解析的表达式。例子：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>${printer.print()}
${myBean.addNewOrder('orderName')}
${myBean.doSomething(myVar, planItemInstance)}</pre>
</div>
</div>
<div class="paragraph">
<p>请注意，这些表达式支持解析基础数据类型（包括比较它们）、Bean、列表、数组和集合。</p>
</div>
<div class="paragraph">
<p>除了所有流程变量之外，还有一些可用于表达式的默认对象：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>caseInstance</code>：<code>DelegateCaseInstance</code> 拥有有关正在进行的案例实例的额外信息。</p>
</li>
<li>
<p><code>planItemInstance</code>：<code>DelegatePlanItemInstance</code> 拥有有关当前方案条目的额外信息。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cmmnExpressionsFunctions">函数表达式</h5>
<div class="paragraph">
<p>[实验]表达式函数已在6.4.0版中添加。</p>
</div>
<div class="paragraph">
<p>为了更容易处理案例变量，在 <em>variables</em> 命名空间下可以使用一组开箱即用的函数。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>variables:get(varName)</strong>：检索变量的值。与直接在表达式中写入变量名称的主要区别在于，当变量不存在时，使用此函数不会抛出异常。例如，如果 myVariable 不存在，<em>${myVariable == "hello"}</em> 将会抛出异常，而 <em>${var:get(myVariable) == <em>hello</em>}</em> 将正常工作。</p>
</li>
<li>
<p><strong>variables:getOrDefault(varName, defaultValue)</strong>：与 <em>get(varName)</em> 类似，但可以选择提供默认值，该值在未设置变量或值为 <em>null</em> 时返回。</p>
</li>
<li>
<p><strong>variables:exists(varName)</strong>：如果变量具有非 null 值，则返回 <em>true</em> 。</p>
</li>
<li>
<p><strong>variables:isEmpty(varName)</strong> （别名 <em>:empty</em>）：检查变量值是否为空。 根据变量类型，行为如下：</p>
<div class="ulist">
<ul>
<li>
<p>对于 String 变量，如果变量是空字符串，则该变量被视为空。</p>
</li>
<li>
<p>对于 <code>java.util.Collection</code> 变量，如果集合没有元素，则返回 <em>true</em>。</p>
</li>
<li>
<p>对于 <code>ArrayNode</code> 变量，如果没有元素，则返回 <em>true</em></p>
</li>
<li>
<p>如果变量是 <em>null</em>，则始终返回 <em>true</em></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>variables:isNotEmpty(varName)</strong> （别名 <em>:notEmpty</em>）：<em>isEmpty(varName)</em> 的取反操作。</p>
</li>
<li>
<p><strong>variables:equals(varName, value)</strong>（别名_ <em>:eq</em>）：检查变量是否等于给定值。这是表达式的简写函数，否则将写为 <em>${execution.getVariable("varName") != null &amp;&amp; execution.getVariable("varName") == value}</em>。</p>
<div class="ulist">
<ul>
<li>
<p>如果变量值为 null，则返回 false（除非与 null 比较）。</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>variables:notEquals(varName, value)</strong>（别名 <em>:ne</em>）：<em>equals(varName, value)</em> 的取反操作。</p>
</li>
<li>
<p><strong>variables:contains(varName, value1, value2, &#8230;&#8203;)</strong>: 检查提供的<strong>所有</strong>值是否包含在变量中。根据变量类型，行为如下：</p>
<div class="ulist">
<ul>
<li>
<p>对于 String 变量，传递的值需要全部为变量一部分子字符串</p>
</li>
<li>
<p>对于 <code>java.util.Collection</code> 变量，所有传递的值都需要是集合的元素（常规 <em>contains</em> 语义）。</p>
</li>
<li>
<p>对于 <code>ArrayNode</code> 变量，支持检查 ArrayNode 是否包含作为变量类型支持的类型的 JsonNode</p>
</li>
<li>
<p>当变量值为 null 时，在所有情况下都返回 false。如果变量值不为 null，并且实例类型不是上述类型之一，则将返回 false。</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>variables:containsAny(varName, value1, value2, &#8230;&#8203;)</strong> ：类似于 <em>contains</em> 函数，但如果<strong>存在</strong>（不需要全部存在）传递的值包含在变量中，则返回 <em>true</em>。</p>
</li>
<li>
<p>比较函数：</p>
<div class="ulist">
<ul>
<li>
<p><strong>variables:lowerThan(varName, value)</strong>（别名 <em>:lessThan</em> 或 <em>:lt</em>）：<em>${execution.getVariable("varName") != null &amp;&amp; execution.getVariable("varName") &lt; value}</em> 的简写函数。</p>
</li>
<li>
<p><strong>variables:lowerThanOrEquals(varName, value)</strong>（别名 <em>:lessThanOrEquals</em> 或 <em>:lte</em>）：与上面的类似，相当于 <em>&lt; =</em></p>
</li>
<li>
<p><strong>variables:greaterThan(varName, value)</strong> （别名 <em>:gt</em>）：与上面的类似，相当于 <em>&gt;</em></p>
</li>
<li>
<p><strong>variables:greaterThanOrEquals(varName, value)</strong> （别名 <em>:gte</em>）：与上面的类似，相当于 <em>&gt; =</em></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>variables</em> 命名空间的别名为 <em>vars</em> 或 <em>var</em>。因此 <em>variables:get(varName)</em> 等同于使用 <em>vars:get(varName)</em> 或 <em>var:get(varName)</em>。请注意，不需要再次在变量名称周围加上引号：<em>var:get(varName)</em> 等同于 <em>var:get('varName')</em> 或 <em>var:get("varName")</em>。</p>
</div>
<div class="paragraph">
<p>另请注意，在上述任何函数中，都不需要将 <em>planItemInstance</em> 或 <em>caseInstance</em> 传递给函数（它们在不使用函数时需要传递）。在调用函数时，引擎将注入适当的变量作用域。这也意味着在 BPMN 流程定义中编写表达式时，可以以完全相同的方式使用这些函数。</p>
</div>
<div class="paragraph">
<p>这些变量函数的使用在 CMMN 中尤其有用，例如在写入 if 部分的哨兵条件时，采用以下 CMMN 案例定义：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.expression-functions.png" alt="cmmn.expression functions">
</div>
</div>
<div class="paragraph">
<p>Assume the sentry has an if-part besides the completion event. Right after a case instance is started, this if-part condition will be evaluated (as the stage becomes available). If the condition is of the form <em>${someVariable == someValue}</em>, this means the variable needs to be available when starting the case instance. In many cases, this is not possible or the variable comes later (e.g. from a form), which leads to a low-level <em>PropertyNotFoundException</em>. Taking the potential nullability in account, the correct expression would have to be:
假设哨兵除了完成事件之外还有一个 if 部分。在启动案例实例后，将评估此 if 部分条件（当此阶段变为可用时）。如果条件的形式为 <em>${someVariable == someValue}</em>，则表示该变量在启动案例实例时就将可用。在许多情况下，这是不可能的，或者变量稍后才会出现 （例如来自一个表单），这会导致一个低级的 <em>PropertyNotFoundException</em>。考虑到潜在的可空性，正确的表达必须是：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>${planItemInstance.getVariable('someVariable') != null &amp;&amp; planItemInstance.getVariable('someVariable') == someValue}</pre>
</div>
</div>
<div class="paragraph">
<p>这很长。但是，使用上述功能可以简化为</p>
</div>
<div class="listingblock">
<div class="content">
<pre>${var:eq(someVariable, someValue)}</pre>
</div>
</div>
<div class="paragraph">
<p>或者</p>
</div>
<div class="listingblock">
<div class="content">
<pre>${var:get(someVariable) == someValue}</pre>
</div>
</div>
<div class="paragraph">
<p>函数实现考虑了变量的可空性（并且在变量为 null 的情况下不抛出异常）并且将正确地处理相等性。</p>
</div>
<div class="paragraph">
<p>此外，可以注册自定义函数在表达式中使用。有关更多信息，请参阅 <code>org.flowable.common.engine.api.delegate.FlowableFunctionDelegate</code> 接口。</p>
</div>
</div>
<div class="sect4">
<h5 id="apiUnitTesting">单元测试</h5>
<div class="paragraph">
<p>案例是软件项目不可或缺的一部分，它们应该以与测试正常应用程序逻辑相同的方式进行测试：使用单元测试。
由于 Flowable 是一个嵌入式的 Java 引擎，因此为业务案例编写单元测试就像编写常规单元测试一样简单。</p>
</div>
<div class="paragraph">
<p>Flowable 支持 JUnit 4、JUnit 5 做单元测试。</p>
</div>
<div class="paragraph">
<p>在 JUnit 5中，需要使用 <code>org.flowable.cmmn.engine.test.FlowableCmmnTest</code> 注解或手动注册 <code>org.flowable.cmmn.engine.test.FlowableCmmnExtension</code>。
<code>FlowableCmmnTest</code> 注释是一个元注释，实现了对 <code>FlowableCmmnExtension</code> 的注册（即它实现了 <code>@ExtendWith(FlowableCmmnExtension.class)</code>）。
这将使 CmmnEngine 和其服务类可用作测试和生命周期方法的参数（<code>@BeforeAll</code>、<code>@BeforeEach</code>、<code>@AfterEach</code>、<code>@AfterAll</code>）。
在每次测试之前，默认会使用类路径上的 <code>flowable.cmmn.cfg.xml</code> 配置文件初始化 CmmnEngine。
为了指定不同的配置文件，需要使用 <code>org.flowable.cmmn.engine.test.CmmnConfigurationResource</code> 注解（参见第二个示例）。
使用相同的配置文件时，CMMN 引擎会在多个单元测试之间静态缓存。</p>
</div>
<div class="paragraph">
<p>通过使用 <code>FlowableCmmnExtension</code>，您可以对测试方法使用 <code>org.flowable.cmmn.engine.test.CmmnDeployment</code> 注解。
当使用有 <code>@CmmnDeployment</code> 注解的测试方法时，在每次测试之前，将会发布在 <code>CmmnDeployment#resources</code> 下定义的 cmmn 文件。
如果没有定义资源，将发布与测试类在同一包中的 <code>testClassName.testMethod.cmmn</code> 形式的资源文件。
在测试结束时，部署文件将会删除，包括所有相关的案例实例、定义等。
有关更多信息，请参阅 <code>CmmnDeployment</code> 类。</p>
</div>
<div class="paragraph">
<p>考虑到所有这些，JUnit 5单元测试看起来如下：</p>
</div>
<div class="listingblock">
<div class="title">使用默认配置文件的 Junit 5 单元测试</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</div></td><td class="code"><span></span><span class="tok-nd">@FlowableCmmnTest</span>
<span class="tok-kd">class</span> <span class="tok-nc">MyTest</span> <span class="tok-o">{</span>

  <span class="tok-kd">private</span> <span class="tok-n">CmmnEngine</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-n">CmmnRuntimeService</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-n">CmmnTaskService</span> <span class="tok-n">cmmnTaskService</span><span class="tok-o">;</span>

  <span class="tok-nd">@BeforeEach</span>
  <span class="tok-kt">void</span> <span class="tok-nf">setUp</span><span class="tok-o">(</span><span class="tok-n">CmmnEngine</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">cmmnEngine</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">;</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">cmmnRuntimeService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnRuntimeService</span><span class="tok-o">();</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">cmmnTaskService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getTaskRuntimeService</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Test</span>
  <span class="tok-nd">@CmmnDeployment</span>
  <span class="tok-kt">void</span> <span class="tok-nf">testSingleHumanTask</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">CaseInstance</span> <span class="tok-n">caseInstance</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceBuilder</span><span class="tok-o">()</span>
                    <span class="tok-o">.</span><span class="tok-na">caseDefinitionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;myCase&quot;</span><span class="tok-o">)</span>
                    <span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
	<span class="tok-n">assertNotNull</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">);</span>

    <span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">=</span> <span class="tok-n">cmmnTaskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">caseInstanceId</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">()).</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Task 1&quot;</span><span class="tok-o">,</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;JohnDoe&quot;</span><span class="tok-o">,</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getAssignee</span><span class="tok-o">());</span>

    <span class="tok-n">cmmnTaskService</span><span class="tok-o">.</span><span class="tok-na">complete</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceQuery</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>使用 JUnit 5，您还可以将部署文件的 ID（使用 org.flowable.cmmn.engine.test.CmmnDeploymentId）注入到测试和生命周期方法中。</pre>
</div>
</div>
<div class="listingblock">
<div class="title">使用自定义配置文件的Junit 5单元测试</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</div></td><td class="code"><span></span><span class="tok-nd">@FlowableCmmnTest</span>
<span class="tok-nd">@CmmnConfigurationResource</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable.custom.cmmn.cfg.xml&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">MyTest</span> <span class="tok-o">{</span>

  <span class="tok-kd">private</span> <span class="tok-n">CmmnEngine</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-n">CmmnRuntimeService</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-n">CmmnTaskService</span> <span class="tok-n">cmmnTaskService</span><span class="tok-o">;</span>

  <span class="tok-nd">@BeforeEach</span>
  <span class="tok-kt">void</span> <span class="tok-nf">setUp</span><span class="tok-o">(</span><span class="tok-n">CmmnEngine</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">cmmnEngine</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">;</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">cmmnRuntimeService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnRuntimeService</span><span class="tok-o">();</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">cmmnTaskService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getTaskRuntimeService</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>
  <span class="tok-nd">@Test</span>
  <span class="tok-nd">@CmmnDeployment</span>
  <span class="tok-kt">void</span> <span class="tok-nf">testSingleHumanTask</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">CaseInstance</span> <span class="tok-n">caseInstance</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceBuilder</span><span class="tok-o">()</span>
                    <span class="tok-o">.</span><span class="tok-na">caseDefinitionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;myCase&quot;</span><span class="tok-o">)</span>
                    <span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
	<span class="tok-n">assertNotNull</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">);</span>

    <span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">=</span> <span class="tok-n">cmmnTaskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">caseInstanceId</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">()).</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Task 1&quot;</span><span class="tok-o">,</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;JohnDoe&quot;</span><span class="tok-o">,</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getAssignee</span><span class="tok-o">());</span>

    <span class="tok-n">cmmnTaskService</span><span class="tok-o">.</span><span class="tok-na">complete</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceQuery</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在 JUnit 4 中，<em>org.flowable.cmmn.engine.test.FlowableCmmnTestCase</em> 可用作父类。它默认使用 <em>flowable.cmmn.cfg.xml</em> 配置文件，如果缺少此类文件，则使用连接 H2 内存数据库的标准 CmmnEngine。
在后台，CmmnTestRunner 用于初始化 CMMN 引擎。请注意下面的示例中如何使用 <em>@CmmnDeployment</em> 注解自动部署案例定义（它将在与测试类相同的文件夹中查找 .cmmn 文件，并期望文件名为&lt;测试类名&gt;.&lt;测试方法名称&gt;.cmmn）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</div></td><td class="code"><span></span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyTest</span> <span class="tok-kd">extends</span> <span class="tok-n">FlowableCmmnTestCase</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Test</span>
  <span class="tok-nd">@CmmnDeployment</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testSingleHumanTask</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">CaseInstance</span> <span class="tok-n">caseInstance</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceBuilder</span><span class="tok-o">()</span>
                    <span class="tok-o">.</span><span class="tok-na">caseDefinitionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;myCase&quot;</span><span class="tok-o">)</span>
                    <span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
	<span class="tok-n">assertNotNull</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">);</span>

    <span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">=</span> <span class="tok-n">cmmnTaskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">caseInstanceId</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">()).</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Task 1&quot;</span><span class="tok-o">,</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;JohnDoe&quot;</span><span class="tok-o">,</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getAssignee</span><span class="tok-o">());</span>

    <span class="tok-n">cmmnTaskService</span><span class="tok-o">.</span><span class="tok-na">complete</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceQuery</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>此外，使用 <em>FlowableCmmnRule</em> 并允许设置自定义配置：</p>
</div>
<div class="listingblock">
<div class="title">规则相关的 JUnit 4 单元测试</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nd">@Rule</span>
<span class="tok-kd">public</span> <span class="tok-n">FlowableCmmnRule</span> <span class="tok-n">cmmnRule</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">FlowableCmmnRule</span><span class="tok-o">(</span><span class="tok-s">&quot;org/flowable/custom.cfg.xml&quot;</span><span class="tok-o">)</span>

<span class="tok-nd">@Test</span>
<span class="tok-nd">@CmmnDeployment</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testSomething</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-c1">// ...</span>
    <span class="tok-n">assertThat</span><span class="tok-o">((</span><span class="tok-n">String</span><span class="tok-o">)</span> <span class="tok-n">cmmnRule</span><span class="tok-o">.</span><span class="tok-na">getCmmnRuntimeService</span><span class="tok-o">().</span><span class="tok-na">getVariable</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">(),</span> <span class="tok-s">&quot;test&quot;</span><span class="tok-o">),</span> <span class="tok-n">containsString</span><span class="tok-o">(</span><span class="tok-s">&quot;John&quot;</span><span class="tok-o">));</span>
    <span class="tok-c1">// ...</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="springintegration">3.5.3. 整合Spring</h4>
<div class="paragraph">
<p>不使用spring也可以很好的使用Flowable,在这一章,我们会介绍一些很有用的整合特性。</p>
</div>
<div class="sect4">
<h5 id="_cmmnenginefactorybean">CmmnEngineFactoryBean</h5>
<div class="paragraph">
<p><code>CmmnEngine</code> 可以配置位一般的spring bean。整合的基点是 <code>org.flowable.cmmn.spring.CmmnEngineFactoryBean</code> 类。这个bean加载CMMN配置文件并创建CMMN引擎。这意味着创建和配置和之前文档 <a href="#configuration">configuration section</a> 是一致的。整合spring,配置文件和引擎的服务类看上去是这样的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.spring.SpringCmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    ...
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngine&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.spring.CmmnEngineFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>注意 <code>cmmnEngineConfiguration</code> bean现在使用的是 <code>org.flowable.cmmn.spring.SpringCmmnEngineConfiguration</code> 。</p>
</div>
</div>
<div class="sect4">
<h5 id="_默认spring配置">默认spring配置</h5>
<div class="paragraph">
<p>以下章节包括数据源(dataSource),事务管理(transactionManager),cmmn引擎(cmmnEngine)以及Flowable引擎各服务。</p>
</div>
<div class="paragraph">
<p>当将数据源(DataSource)装入 <code>SpringCmmnEngineConfiguration</code> (使用字段"dataSource") 里,Flowable将全局使用  <code>org.springframework.jdbc.datasource.TransactionAwareDataSourceProxy</code> 代理,用来包装传入的数据源。目的是让spring事务很好的管理数据库连接。这意味着您在spring配置里,不需要再代理数据源。尽管也可以将一个  <code>TransactionAwareDataSourceProxy</code> 装入 <code>SpringCmmnEngineConfiguration</code> ,但是再这种情况下,CMMN引擎不会再次包装该数据源。</p>
</div>
<div class="paragraph">
<p><strong>确保在使用在spring配置中声明 <code>TransactionAwareDataSourceProxy</code> 时,不要使用在spring事务代管下的数据源（比如 DataSourceTransactionManager 需要未被代理的dataSource)。</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="tok-na">xmlns:context=</span><span class="tok-s">&quot;http://www.springframework.org/schema/context&quot;</span>
       <span class="tok-na">xmlns:tx=</span><span class="tok-s">&quot;http://www.springframework.org/schema/tx&quot;</span>
       <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans</span>
<span class="tok-s">                             http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="tok-s">                           http://www.springframework.org/schema/context</span>
<span class="tok-s">                             http://www.springframework.org/schema/context/spring-context-2.5.xsd</span>
<span class="tok-s">                           http://www.springframework.org/schema/tx</span>
<span class="tok-s">                             http://www.springframework.org/schema/tx/spring-tx-3.0.xsd&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.springframework.jdbc.datasource.SimpleDriverDataSource&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;driverClass&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.h2.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;url&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;username&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sa&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.spring.SpringCmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngine&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.spring.CmmnEngineFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnRepositoryService&quot;</span> <span class="tok-na">factory-bean=</span><span class="tok-s">&quot;cmmnEngine&quot;</span> <span class="tok-na">factory-method=</span><span class="tok-s">&quot;getCmmnRepositoryService&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnRuntimeService&quot;</span> <span class="tok-na">factory-bean=</span><span class="tok-s">&quot;cmmnEngine&quot;</span> <span class="tok-na">factory-method=</span><span class="tok-s">&quot;getCmmnRuntimeService&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnTaskService&quot;</span> <span class="tok-na">factory-bean=</span><span class="tok-s">&quot;cmmnEngine&quot;</span> <span class="tok-na">factory-method=</span><span class="tok-s">&quot;getCmmnTaskService&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnHistoryService&quot;</span> <span class="tok-na">factory-bean=</span><span class="tok-s">&quot;cmmnEngine&quot;</span> <span class="tok-na">factory-method=</span><span class="tok-s">&quot;getCmmnHistoryService&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnManagementService&quot;</span> <span class="tok-na">factory-bean=</span><span class="tok-s">&quot;cmmnEngine&quot;</span> <span class="tok-na">factory-method=</span><span class="tok-s">&quot;getCmmnManagementService&quot;</span> <span class="tok-nt">/&gt;</span>

...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>首先,application context(spring容器上下文)可以使用任何spring的配置方式(比如：xml,@Configuration等)。这个示例使用的XML配置方式。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">ClassPathXmlApplicationContext</span> <span class="tok-n">applicationContext</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ClassPathXmlApplicationContext</span><span class="tok-o">(</span>
	<span class="tok-s">&quot;org/flowable/cmmn/examples/spring/SpringIntegrationTest-context.xml&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>测试时这样使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-nd">@ContextConfiguration</span><span class="tok-o">(</span>
  <span class="tok-s">&quot;classpath:org/flowable/cmmn/spring/test/SpringIntegrationTest-context.xml&quot;</span><span class="tok-o">)</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="springExpressions">表达式</h5>
<div class="paragraph">
<p>使用CmmnEngineFactoryBean,所有的spring bean在CMMN流程中的表达式默认都是可见的。可以在配置SpringCmmnEngineConfiguration的beans(类型Map)属性,限制表达式中使用的bean。下面的示例是暴露了单独的名为printer的bean。
* 如果没有需要暴露给表达式的bean,配置 beans属性位一个空map。当不设置 <em>beans</em> 属性时,所有spring容器里的bean都是可用的。 *</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.spring.SpringCmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  ...
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;beans&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;map&gt;</span>
      <span class="tok-nt">&lt;entry</span> <span class="tok-na">key=</span><span class="tok-s">&quot;printer&quot;</span> <span class="tok-na">value-ref=</span><span class="tok-s">&quot;printer&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/map&gt;</span>
  <span class="tok-nt">&lt;/property&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;printer&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.examples.spring.Printer&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>将可以使用的bean暴露给表达式：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span>...
	<span class="tok-nt">&lt;case</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myCase&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;casePlanModel</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myPlanModel&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My CasePlanModel&quot;</span><span class="tok-nt">&gt;</span>

            <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Task One&quot;</span> <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;serviceTask&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;planItem</span> <span class="tok-na">id=</span><span class="tok-s">&quot;planItem2&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;The Case&quot;</span> <span class="tok-na">definitionRef=</span><span class="tok-s">&quot;task&quot;</span><span class="tok-nt">&gt;</span>
                <span class="tok-nt">&lt;entryCriterion</span> <span class="tok-na">sentryRef=</span><span class="tok-s">&quot;sentry1&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;/planItem&gt;</span>

            <span class="tok-nt">&lt;sentry</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sentry1&quot;</span><span class="tok-nt">&gt;</span>
                <span class="tok-nt">&lt;planItemOnPart</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;planItem1&quot;</span><span class="tok-nt">&gt;</span>
                    <span class="tok-nt">&lt;standardEvent&gt;</span>complete<span class="tok-nt">&lt;/standardEvent&gt;</span>
                <span class="tok-nt">&lt;/planItemOnPart&gt;</span>
            <span class="tok-nt">&lt;/sentry&gt;</span>

            <span class="tok-nt">&lt;task</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceTask&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;java&quot;</span> <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;${printer.printMessage(var1)}&quot;</span> <span class="tok-na">flowable:resultVariableName=</span><span class="tok-s">&quot;customResponse&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;task</span> <span class="tok-na">id=</span><span class="tok-s">&quot;task&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;The Task&quot;</span> <span class="tok-na">isBlocking=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>

        <span class="tok-nt">&lt;/casePlanModel&gt;</span>
    <span class="tok-nt">&lt;/case&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>+Printer+ 代码：</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Printer</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">printMessage</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">var</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;hello &quot;</span> <span class="tok-o">+</span> <span class="tok-n">var</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring配置是这样的(如上所示)：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans&gt;</span>
  ...

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;printer&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.examples.spring.Printer&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_自动部署资源">自动部署资源</h5>
<div class="paragraph">
<p>Spring integration also has a special feature for deploying resources.  In the CMMN engine configuration, you can specify a set of resources. When the CMMN engine is created, all those resources will be scanned and deployed.  There is filtering in place that prevents duplicate deployments.  Only when the resources have actually changed will new deployments be deployed to the Flowable DB. This makes sense in a lot of use cases, where the Spring container is rebooted frequently (for example, testing).</p>
</div>
<div class="paragraph">
<p>整合spring,部署资源有一个独有的特性。CMMN引擎配置中可以定义很多资源。当CMMN引擎创建,这些资源将被扫描,发布。这个过程中将过滤重复发布的资源。当资源产生改变,将重新发布对应资源到数据库。这个在频繁重启的时候是很有意义的(比如测试时)。</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example:</p>
</div>
<div class="paragraph">
<p>请看示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.spring.SpringCmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  ...
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;deploymentResources&quot;</span>
    <span class="tok-na">value=</span><span class="tok-s">&quot;classpath*:/org/flowable/cmmn/spring/test/autodeployment/autodeploy.*.cmmn&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngine&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.spring.CmmnEngineFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>以上配置默认将匹配到资源当作同一次发布(deployment)到Flowable引擎。没有更改的资源对整个发布生效。某些情况下,这可能不是所需要的。举个例子,这些发布里仅仅有一个资源文件有改动,那么发布(deployment)包含的所有资源都会被重新发布,导致实际没有变更的事例定义会产生新的版本。</p>
</div>
<div class="paragraph">
<p>针对以上的问题,可以更改 <code>SpringCmmnEngineConfiguration</code>, <code>deploymentMode</code> , 整个属性定义了如何判断资源将被部署。默认情况下该属性有一下三个选项：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>default</code>: 默认配置,将所有资源视为一组,当作同一发布.</p>
</li>
<li>
<p><code>single-resource</code>: 单独发布,将所有分开的资源每一个当作一组发布。适用于分开发布所有流程定义,当有所改变时,只有改变的事务定义会产生新的版本号。</p>
</li>
<li>
<p><code>resource-parent-folder</code>: 目录发布,将同一文件夹下的资源文件视为一组,作为同一文件发布。适用于将不同的部署于大多数资源文件,但是依然会将共享文件夹的资源文件视为一组。下面的示例代码为使用+single-resource+ 配置 <code>deploymentMode</code>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span>
    <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.spring.SpringCmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  ...
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;deploymentResources&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;classpath*:/flowable/*.cmmn&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;deploymentMode&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;single-resource&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>除了以上列举的3个值来配置  <code>deploymentMode</code>, 您也可以自定义规则去检测发布,创建 <code>SpringCmmnEngineConfiguration</code>  的子类,覆盖 <code>getAutoDeploymentStrategy(String deploymentMode)</code> 方法。该方法确定 <code>deploymentMode</code> 将使用哪种策略。</p>
</div>
</div>
<div class="sect4">
<h5 id="springUnitTest">单元测试</h5>
<div class="paragraph">
<p>整合spring 使用 <a href="#apiUnitTesting">Flowable testing facilities</a> 可以很容易去测试业务事例。
以下示例是经典的Spring-based JUnit 4或5的测试用例：</p>
</div>
<div class="listingblock">
<div class="title">JUnit 5 test</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</div></td><td class="code"><span></span><span class="tok-nd">@ExtendWith</span><span class="tok-o">(</span><span class="tok-n">FlowableCmmnSpringExtension</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-nd">@ExtendWith</span><span class="tok-o">(</span><span class="tok-n">SpringExtension</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-nd">@ContextConfiguration</span><span class="tok-o">(</span><span class="tok-n">classes</span> <span class="tok-o">=</span> <span class="tok-n">CmmnSpringJunitJupiterTest</span><span class="tok-o">.</span><span class="tok-na">TestConfiguration</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">MyBusinessCaseTest</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Autowired</span>
  <span class="tok-kd">private</span> <span class="tok-n">CmmnRepositoryService</span> <span class="tok-n">cmmnRepositoryService</span><span class="tok-o">;</span>

  <span class="tok-nd">@Autowired</span>
  <span class="tok-kd">private</span> <span class="tok-n">CmmnRuntimeService</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">;</span>

  <span class="tok-nd">@Test</span>
  <span class="tok-nd">@CmmnDeployment</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">simpleCaseTest</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">CaseInstance</span> <span class="tok-n">caseInstance</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceBuilder</span><span class="tok-o">()</span>
    		<span class="tok-o">.</span><span class="tok-na">caseDefinitionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;simpleCase&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">variable</span><span class="tok-o">(</span><span class="tok-s">&quot;var1&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;John Doe&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>

	<span class="tok-n">Assertions</span><span class="tok-o">.</span><span class="tok-na">assertNotNull</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">JUnit 4 test</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyBusinessCaseTest</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Rule</span>
  <span class="tok-kd">public</span> <span class="tok-n">FlowableCmmnRule</span> <span class="tok-n">cmmnRule</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">FlowableCmmnRule</span><span class="tok-o">(</span><span class="tok-s">&quot;org/flowable/spring/test/el/SpringBeanTest-context.xml&quot;</span><span class="tok-o">);</span>

  <span class="tok-nd">@Test</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">simpleCaseTest</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">cmmnRule</span><span class="tok-o">.</span><span class="tok-na">getCmmnRepositoryService</span><span class="tok-o">().</span><span class="tok-na">createDeployment</span><span class="tok-o">().</span><span class="tok-na">addClasspathResource</span><span class="tok-o">(</span><span class="tok-s">&quot;org/flowable/spring/test/el/springExpression.cmmn&quot;</span><span class="tok-o">).</span><span class="tok-na">deploy</span><span class="tok-o">();</span>
    <span class="tok-n">CmmnRuntimeService</span> <span class="tok-n">cmmnRuntimeService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRule</span><span class="tok-o">.</span><span class="tok-na">getCmmnRuntimeService</span><span class="tok-o">();</span>
    <span class="tok-n">CaseInstance</span> <span class="tok-n">caseInstance</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceBuilder</span><span class="tok-o">()</span>
    		<span class="tok-o">.</span><span class="tok-na">caseDefinitionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;myCase&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">variable</span><span class="tok-o">(</span><span class="tok-s">&quot;var1&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;John Doe&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>

	<span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertNotNull</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="chDeployment">3.5.4. 部署</h4>
<div class="sect4">
<h5 id="_外部资源">外部资源</h5>
<div class="paragraph">
<p>案例定义位于Flowable 数据库中。当在Flowable 配置文件使用Service Tasks或Spring Beans时，这些案例定义可以引用委托类来处理。
这些类和Spring配置文件,必须可以用于所有可能执行案例定义的CMMN引擎。</p>
</div>
<div class="sect5">
<h6 id="_java_类">JAVA 类</h6>
<div class="paragraph">
<p>在案例定义中使用的所有自定义类（例如，服务任务中使用的PlanItemJavaDelegates）都应该在启动案例实例时，配置在引擎的类路径上。</p>
</div>
<div class="paragraph">
<p>但是，在部署案例定义期间，这些类不必配置在类路径上。也就是说在部署新的案例定义时，您的委托类不必位于类路径上，例如：当您使用演示安装程序并要添加自定义类时，应该将包含类的JAR添加到“flowable-task”或“flowable-rest” webapp lib中。别忘了还要包括自定义类（如果有的话）的依赖项。或者您也可以将依赖项配置在Tomcat安装的libraries目录中，$tomcat.home/lib（或其他Web容器的类似位置）。</p>
</div>
</div>
<div class="sect5">
<h6 id="_从案例实例中使用springbeans">从案例实例中使用SpringBeans</h6>
<div class="paragraph">
<p>当在表达式或脚本使用SpringBean时，在执行案例定义时，这些bean必须对引擎可用。如果您正在构建自己的webapp，并按照 “Spring集成”章节 中的相关章节描述，在您的应用上下问文中配置CMMN引擎，那这很简单。但请记住，如果您使用"Flowable task"和"Flowable rest" webapps，那么也应该使用该上下文对其进行更新。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="versioningOfCaseDefinitions">案例定义的版本管理</h5>
<div class="paragraph">
<p>CMMN没有版本控制的概念，这实际上很好，因为可执行CMMN文件可能作为开发项目的一部分存在于版本控制系统库中（如Subversion、Git或Mercurial）。但是，案例定义的版本是作为部署的一部分在引擎中创建的。在部署过程中，flowable将为CaseDefinition分配一个版本，然后将其存储在flowable数据库中</p>
</div>
<div class="paragraph">
<p>对于部署中的每个案例定义，执行以下步骤初始化属性键、版本、名称和ID：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>XML文件中的案例定义+id+属性,用作案例定义+key+属性。</p>
</li>
<li>
<p>XML文件中的案例定义+名称+属性用作案例定义+名称+属性。如果未指定名称属性，则使用id属性作为名称。</p>
</li>
<li>
<p>第一次部署具有特定密钥的案例时，将分配版本1。对于具有相同键的案例定义的所有后续部署版本，版本将设置为比当前部署的最高版本高1。key属性用于区分大小写定义。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以下面的例子为例</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myDefinitions&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;case</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myCase&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My important case&quot;</span> <span class="tok-nt">&gt;</span>
    ...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>部署此案例定义时，数据库中的案例定义将看起来像这样</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">676</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>假设我们现在部署相同案例的更新版本（例如，更改一些人工任务），但案例定义的ID保持不变。案例定义表现在将包含以下条目：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">676</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">870</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>当调用RuntimeService.CreateCaseInstanceBuilder（）.CaseDefinitionKey（“MyCase”）.Start（）时，它现在将在版本2中使用案例定义，因为这是案例定义的最新版本。</p>
</div>
<div class="paragraph">
<p>如果我们像下面定义的那样创建第二个案例并将其部署到Flowable，那么第三行将添加到表中。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myNewDefinitions&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;case</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myNewCase&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My important case&quot;</span> <span class="tok-nt">&gt;</span>
    ...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这个表看起来像这样：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">676</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">870</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1033</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myNewCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>请注意：新案例的关键与第一个案例有何不同？尽管名称是相同的（我们可能也该更改它），但在区分大小写时，Flowable只考虑ID属性。因此，新案例会与版本1一起部署。</p>
</div>
</div>
<div class="sect4">
<h5 id="deploymentCategory">分类</h5>
<div class="paragraph">
<p>部署和案例定义都有用户定义的类别。案例定义类别是用CMMN XML中的“targetNamespace”属性的值初始化的：&lt;definitions…targetNamespace=“您定义的类别”…</p>
</div>
<div class="paragraph">
<p>部署类别也可以在API中指定，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">repositoryService</span>
    <span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">category</span><span class="tok-o">(</span><span class="tok-s">&quot;yourCategory&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">...</span>
    <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dmn">3.6. DMN</h3>
<div class="sect3">
<h4 id="_配置_2">3.6.1. 配置</h4>
<div class="sect4">
<h5 id="configuration">创建 DMN 引擎</h5>
<div class="paragraph">
<p><em>Flowable DMN 引擎的构造方式和 Flowable 工作流引擎非常相似。因此，部分文档非常类似流程引擎的相应内容。</em></p>
</div>
<div class="paragraph">
<p>Flowable DMN 引擎是通过名为 <code>flowable.dmn.cfg.xml</code> 的XML文件进行配置的。请注意，如果你使用 <a href="#springintegration">Spring 风格构建 DMN 引擎</a>，则不适用。</p>
</div>
<div class="paragraph">
<p>获取一个 <code>DmnEngine</code> 的最简单的方式是使用 <code>org.flowable.dmn.engine.DmnEngines</code> 类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">DmnEngine</span> <span class="tok-n">dmnEngine</span> <span class="tok-o">=</span> <span class="tok-n">DMNEngines</span><span class="tok-o">.</span><span class="tok-na">getDefaultDmnEngine</span><span class="tok-o">()</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>上述代码将会从classpath寻找 <code>flowable.dmn.cfg.xml</code> 文件，并根据文件中的配置构造引擎。下面的代码片段展示了实例配置。后续章节将详细介绍配置属性。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.dmn.engine.impl.cfg.StandaloneDmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUrl&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcDriver&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.h2.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUsername&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sa&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcPassword&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;strictMode&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;false&quot;</span><span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以注意到这个 XML 配置实际上是个 Spring 配置。 <strong>这并不代表 Flowable DMN 只能在 Spring 环境中使用！</strong> 我们只是在内部借助 Spring 的解析和依赖注入能力来构建引擎。</p>
</div>
<div class="paragraph">
<p>也可以通过编程的方式使用配置文件创建 DMNEngineConfiguration 对象。也可以使用不同的 bean ID（比如第三行）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-n">DmnEngineConfiguration</span><span class="tok-o">.</span>
  <span class="tok-nf">createDmnEngineConfigurationFromResourceDefault</span><span class="tok-o">();</span>
  <span class="tok-n">createDmnEngineConfigurationFromResource</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">resource</span><span class="tok-o">);</span>
  <span class="tok-n">createDmnEngineConfigurationFromResource</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">resource</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">beanName</span><span class="tok-o">);</span>
  <span class="tok-n">createDmnEngineConfigurationFromInputStream</span><span class="tok-o">(</span><span class="tok-n">InputStream</span> <span class="tok-n">inputStream</span><span class="tok-o">);</span>
  <span class="tok-n">createDmnEngineConfigurationFromInputStream</span><span class="tok-o">(</span><span class="tok-n">InputStream</span> <span class="tok-n">inputStream</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">beanName</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>不使用配置文件也是可行的，这将基于默认值创建配置（更多信息请参阅 <a href="#configurationClasses">已支持的其他配置类</a> ）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">DmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneDmnEngineConfiguration</span><span class="tok-o">();</span>
<span class="tok-n">DmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneInMemDmnEngineConfiguration</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>所有的 <code>DmnEngineConfiguration.createXXX()</code> 方法返回一个可做进一步调整的 <code>DmnEngineConfiguration</code> 。调用 <code>buildDmnEngine()</code> 方法之后将创建一个 <code>DmnEngine</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">DmnEngine</span> <span class="tok-n">dmnEngine</span> <span class="tok-o">=</span> <span class="tok-n">DmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneInMemDmnEngineConfiguration</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">setDatabaseSchemaUpdate</span><span class="tok-o">(</span><span class="tok-n">DmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">DB_SCHEMA_UPDATE_FALSE</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">setJdbcUrl</span><span class="tok-o">(</span><span class="tok-s">&quot;jdbc:h2:mem:my-own-db;DB_CLOSE_DELAY=1000&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">buildDmnEngine</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configurationRoot">DmnEngineConfiguration bean</h5>
<div class="paragraph">
<p><code>flowable.dmn.cfg.xml</code> 必须包含一个 ID 为 <code>'dmnEngineConfiguration'</code> 的 bean。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span> <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.dmn.engine.impl.cfg.StandaloneDmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这个 bean 将被用于构造 <code>DmnEngine</code>。有多个可选的类可以用来定义 <code>dmnEngineConfiguration</code>。这些类代表了不同的环境，并根据环境设置相应的默认值。最佳方式是选择最符合你的环境的类，尽可能地减少配置引擎所需要的属性。目前有下面这些类可供使用： <a id="configurationClasses"></a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>org.flowable.dmn.engine.impl.cfg.StandaloneDmnEngineConfiguration</strong>: 引擎以单机方式运行。Flowable 将自行处理事务。默认情况下，仅在引擎启动时检查数据库（如果 Flowable DMN 相关表不存在，或者版本不正确，将抛出异常）。</p>
</li>
<li>
<p><strong>org.flowable.dmn.engine.impl.cfg.StandaloneInMemDmnEngineConfiguration</strong>: 这是一个方便进行单元测试的类。Flowable DMN 将自行处理事务。默认使用 H2 内存数据库。数据库将随着引擎的启动和关闭进行创建和销毁。使用此类时一般无需进行额外配置。</p>
</li>
<li>
<p><strong>org.flowable.dmn.spring.SpringDmnEngineConfiguration</strong>: 在 Spring 环境中使用 DMN 引擎时使用此类。详见 <a href="#springintegration">与 Spring 集成章节</a>。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_植入到流程引擎">植入到流程引擎</h5>
<div class="paragraph">
<p>除了以独立方式运行，DMN 引擎还可以植入到流程引擎中。这使得流程引擎能够识别它和其他引擎。例如，除了 BPMN 模型，还可以将 DMN 模型部署到流程引擎部署服务 API。</p>
</div>
<div class="paragraph">
<p>要让流程引擎能够识别出 DMN 引擎，需要在流程引擎配置中将 <strong>org.flowable.dmn.engine.configurator.DmnEngineConfigurator</strong> 添加到流程引擎配置 bean 的 configurators list 中</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.dmn.engine.impl.cfg.StandaloneDmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUrl&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcDriver&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.h2.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUsername&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sa&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcPassword&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-nt">/&gt;</span>
    ...
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dmnEngineConfigurator&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.dmn.engine.configurator.DmnEngineConfigurator&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dmnEngineConfiguration&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;dmnEngineConfiguration&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;configurators&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;list&gt;</span>
        <span class="tok-nt">&lt;ref</span> <span class="tok-na">bean=</span><span class="tok-s">&quot;dmnEngineConfigurator&quot;</span> <span class="tok-nt">/&gt;</span>
      <span class="tok-nt">&lt;/list&gt;</span>
    <span class="tok-nt">&lt;/property&gt;</span>
    ...
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="databaseConfiguration">数据库配置</h5>
<div class="paragraph">
<p>Flowable DMN 引擎有两种方式进行数据库配置。第一种方式是定义数据库的 JDBC 属性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>jdbcUrl</strong>: 数据库的 JDBC Url。</p>
</li>
<li>
<p><strong>jdbcDriver</strong>: 特定类型数据库的驱动。</p>
</li>
<li>
<p><strong>jdbcUsername</strong>: 连接数据库所使用的用户名。</p>
</li>
<li>
<p><strong>jdbcPassword</strong>: 连接数据库所使用的密码。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>基于所提供的 JDBC 属性构造的数据源将使用默认的 <a href="http://www.mybatis.org/">MyBatis</a> 连接池设置。下面这些可选属性可以用来对连接池进行调整（引自 Mybatis 文档）：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>jdbcMaxActiveConnections</strong>: 连接池在任意时间可以持有的最大活动连接数。</p>
</li>
<li>
<p><strong>jdbcMaxIdleConnections</strong>: 连接池在任意时间可以持有的最大空闲连接数。</p>
</li>
<li>
<p><strong>jdbcMaxCheckoutTime</strong>: 在被强制返回之前，连接池中的连接可被“借用”的时长（以毫秒为单位）。默认值是20000（20秒）。</p>
</li>
<li>
<p><strong>jdbcMaxWaitTime</strong>: 这是一个低级别设置，使池有机会打印日志状态，并在获取连接耗时太久时进行重新尝试（以避免池配置错误时永远静默地失败）。默认值是20000（20秒）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>示例数据库配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUrl&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:flowable_dmn;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcDriver&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.h2.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUsername&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sa&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcPassword&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>我们的跑分显示 MyBatis 的连接池在处理大量并发请求时不是最高效的。因此，建议使用 javax.sql.DataSource 的实现（比如 HikariCP、Tomcat JDBC 连接池、等等），并将其注入到引擎配置中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;driverClassName&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;com.mysql.jdbc.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;url&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:mysql://localhost:3306/flowable_dmn&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;username&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;flowable&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;flowable&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;defaultAutoCommit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.dmn.engine.impl.cfg.StandaloneDmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-nt">/&gt;</span>
    ...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>要注意的是 Flowable DMN 并不自带定义这种数据源所需要的类库，所以你要确保这些类库在你的classpath中。</p>
</div>
<div class="paragraph">
<p>无论你使用 JDBC 或数据源方式，都可以设置以下属性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>databaseType</strong>：一般情况下能从数据库连接中自动识别出来，没必要手工指定。应该仅当自动识别失败时指定。可选的值有：{h2、mysql、oracle、postgres、mssql、db2}。这项设置将决定使用哪些 create/drop 脚本。参见 <a href="#supporteddatabases">“支持的数据库”章节</a> 了解已支持哪些类型的数据库。</p>
</li>
<li>
<p><strong>databaseSchemaUpdate</strong>：用来设置引擎启动和关闭时数据库表的操作策略。</p>
<div class="ulist">
<ul>
<li>
<p><code>false</code> （默认）：在创建引擎时检查数据库表的版本，如果不匹配则抛出异常。</p>
</li>
<li>
<p><code>true</code>：在构建引擎时进行检查，并在必要时更新数据库表。如果表不存在，则创建。</p>
</li>
<li>
<p><code>create-drop</code>：引擎创建时创建表，引擎关闭时删除表。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="jndiDatasourceConfig">JNDI 数据源配置</h5>
<div class="paragraph">
<p>默认情况下，Flowable DMN 的数据库配置包含在每个 web 应用的 WEB-INF/classes 下的 db.properties 文件中。但是这样并不理想，因为它使得用户要么修改 Flowable 代码中的 db.properties 并重新编译 WAR 文件，要么在每一次项目部署时解压 WAR 并修改 db.properties。</p>
</div>
<div class="paragraph">
<p>通过 JNDI （Java Naming and Directory Interface）获取数据库连接，这个连接将完全由 Servlet 容器管理，且配置可以在 war 包外部进行管理。而且相比 db.properties 文件，这种方式还能对连接参数进行更多的控制。</p>
</div>
<div class="sect5">
<h6 id="jndi_configuration">配置</h6>
<div class="paragraph">
<p>JNDI 数据源的配置将视你所使用的 servlet 容器而有所不同。下面的说明适用于 Tomcat，至于其他的容器，请参阅各容器的文档。</p>
</div>
<div class="paragraph">
<p>如果使用 Tomcat，JNDI 资源配置在 $CATALINA_BASE/conf/[enginename]/[hostname]/[warname].xml 中（Flowable UI 的配置通常在 $CATALINA_BASE/conf/Catalina/localhost/flowable-app.xml）。默认的 context 是在应用初次部署时从 Flowable WAR 文件中复制过来的，所以如果已经存在的话你需要进行替换。比如，要使用 MySql 而不是 H2，可如下修改 JNDI 资源：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
    <span class="tok-nt">&lt;Context</span> <span class="tok-na">antiJARLocking=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">path=</span><span class="tok-s">&quot;/flowable-app&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;Resource</span> <span class="tok-na">auth=</span><span class="tok-s">&quot;Container&quot;</span>
            <span class="tok-na">name=</span><span class="tok-s">&quot;jdbc/flowableDB&quot;</span>
            <span class="tok-na">type=</span><span class="tok-s">&quot;javax.sql.DataSource&quot;</span>
            <span class="tok-na">description=</span><span class="tok-s">&quot;JDBC DataSource&quot;</span>
            <span class="tok-na">url=</span><span class="tok-s">&quot;jdbc:mysql://localhost:3306/flowable&quot;</span>
            <span class="tok-na">driverClassName=</span><span class="tok-s">&quot;com.mysql.jdbc.Driver&quot;</span>
            <span class="tok-na">username=</span><span class="tok-s">&quot;sa&quot;</span>
            <span class="tok-na">password=</span><span class="tok-s">&quot;&quot;</span>
            <span class="tok-na">defaultAutoCommit=</span><span class="tok-s">&quot;false&quot;</span>
            <span class="tok-na">initialSize=</span><span class="tok-s">&quot;5&quot;</span>
            <span class="tok-na">maxWait=</span><span class="tok-s">&quot;5000&quot;</span>
            <span class="tok-na">maxActive=</span><span class="tok-s">&quot;120&quot;</span>
            <span class="tok-na">maxIdle=</span><span class="tok-s">&quot;5&quot;</span><span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;/Context&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_jndi_属性_2">JNDI 属性</h6>
<div class="paragraph">
<p>要配置 JNDI 数据源，使用下面这些 Flowable UI 的 properties 文件中的属性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>spring.datasource.jndi-name=：数据源的 JNDI 名称。</p>
</li>
<li>
<p>datasource.jndi.resourceRef：设置查询是否发生在 J2EE 容器中，换句话说，JNDI 名称中不包含前缀“java:comp/env/”时是否要把它加上。默认“true”。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="supporteddatabases">支持的数据库</h5>
<div class="paragraph">
<p>下面列出了 Flowable 所使用的数据库的类型（区分大小写！）。</p>
</div>
<table id="databaseTypes" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flowable DMN 数据库类型</th>
<th class="tableblock halign-left valign-top">JDBC URL 示例</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">h2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:h2:tcp://localhost/flowable_dmn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认数据库</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mysql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:mysql://localhost:3306/flowable_dmn?autoReconnect=true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">已使用 mysql-connector-java 数据库驱动进行测试</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">oracle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:oracle:thin:@localhost:1521:xe</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">postgres</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:postgresql://localhost:5432/flowable_dmn</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">db2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:db2://localhost:50000/flowable_dmn</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mssql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:sqlserver://localhost:1433;databaseName=flowable_dmn (jdbc.driver=com.microsoft.sqlserver.jdbc.SQLServerDriver) <em>OR</em> jdbc:jtds:sqlserver://localhost:1433/flowable_dmn (jdbc.driver=net.sourceforge.jtds.jdbc.Driver)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">已使用 Microsoft JDBC Driver 4.0（sqljdbc4.jar）和 JTDS 驱动进行测试</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="creatingDatabaseTable">创建数据库表</h5>
<div class="paragraph">
<p>Flowable DMN 使用 <a href="http://www.liquibase.org">Liquibase</a> 跟踪、管理和应用数据库表的变更。</p>
</div>
<div class="paragraph">
<p>创建数据库表的最简单的方式是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>将 flowable-dmn-engine 相关JAR包添加到 classpath</p>
</li>
<li>
<p>添加合适的数据库驱动</p>
</li>
<li>
<p>添加 Flowable 配置文件（<em>flowable.dmn.cfg.xml</em>）到 classpath，指向你的数据库（参阅 <a href="#databaseConfiguration">“数据库配置”章节</a>）</p>
</li>
<li>
<p>执行 <em>DbSchemaCreate</em> 类的 main 方法</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="database.tables.explained">数据库表名称说明</h5>
<div class="paragraph">
<p>Flowable DMN 的表名全部以 <strong>ACT_DMN_</strong> 开头。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ACT_DMN_DATABASECHANGELOG：此表用于 Liquibase 对已运行的变更进行追踪。</p>
</li>
<li>
<p>ACT_DMN_DATABASECHANGELOGLOCK：此表用于 Liquibase 确保同时只有一个 Liquibase 实例在运行。</p>
</li>
<li>
<p>ACT_DMN_DECISION_TABLE：此表包含了已部署的决策表的元数据。</p>
</li>
<li>
<p>ACT_DMN_DEPLOYMENT：此表包含了每次部署行为的元数据。</p>
</li>
<li>
<p>ACT_DMN_DEPLOYMENT_RESOURCE：此表包含了 DMN 定义的资源和元数据。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="databaseUpgrade">数据库升级</h5>
<div class="paragraph">
<p>请确保在升级前已对数据库进行备份。</p>
</div>
<div class="paragraph">
<p>每当引擎被创建时默认都会进行版本检查。版本检查通常在你的应用程序或者 Flowable web 应用启动时发生。如果 Flowable 库发现库版本和数据库表版本不同，则抛出异常。</p>
</div>
<div class="paragraph">
<p>要进行升级，你首先需要在 flowable.dmn.cfg.xml 配置文件中加入如下配置属性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans</span> <span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.dmn.engine.impl.cfg.StandaloneDmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-c">&lt;!-- ... --&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-c">&lt;!-- ... --&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>另外，在classpath中引入适合你数据库的驱动。</strong> 升级应用程序中的 Flowable DMN 类库，或者启动一个新版本的 Flowable DMN 并将其指向旧版本的数据库。当 databaseSchemaUpdate 设置为 true 时，Flowable DMN 将会在首次发现类库版本和数据库表版本不同时升级到新版本。</p>
</div>
</div>
<div class="sect4">
<h5 id="processDefinitionCacheConfiguration">部署缓存配置</h5>
<div class="paragraph">
<p>为了避免每次需要决策表时都去访问数据库，同时也因为决策表不会改变，所有的决策都是被缓存的（在它们经过解析之后）。缓存默认是没有限制的。可添加如下属性对决策缓存进行限制：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;decisionCacheLimit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;10&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这项设置将使用给定了硬性限制的 LRU 缓存替代默认的 hashmap 缓存。当然，最合适的取值取决于决策总数以及运行时实际使用到的决策数。</p>
</div>
<div class="paragraph">
<p>你还可以注入你自己的缓存实现。必须是一个实现了 org.flowable.dmn.engine.impl.persistence.deploy.DeploymentCache 接口的 bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;decisionCache&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.MyCache&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/property&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="strictMode">严格模式</h5>
<div class="paragraph">
<p>严格模式是默认 <strong>启用</strong> 的。就是说命中策略（hit policies）将按照 DMN 1.1 标准执行。也可以禁用严格模式。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.dmn.engine.impl.cfg.StandaloneDmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-c">&lt;!-- ... --&gt;</span>
      <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;strictMode&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;false&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-c">&lt;!-- ... --&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样做的影响是违反了命中策略约束时，结果不会作废。可能的违规将被作为验证信息记录到审核日志中。</p>
</div>
</div>
<div class="sect4">
<h5 id="_自定义_flowable_函数委托function_delegates">自定义 Flowable 函数委托（Function Delegates）</h5>
<div class="paragraph">
<p>Flowable DMN 内置了一些 JUEL 函数委托。通过设置 dmnEngineConfiguration bean 的 <strong>customFlowableFunctionDelegates</strong> 属性，你可以使用自己的实现。这些（函数委托）可以在表达式（expressions）中执行你自己的逻辑。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.dmn.engine.impl.cfg.StandaloneDmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-c">&lt;!-- ... --&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;customFlowableFunctionDelegates&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;list&gt;</span>
          <span class="tok-nt">&lt;bean</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;myOwnFunctionDelegateOne&quot;</span> <span class="tok-nt">/&gt;</span>
          <span class="tok-nt">&lt;bean</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;myOwnFunctionDelegateTwo&quot;</span> <span class="tok-nt">/&gt;</span>
      <span class="tok-nt">&lt;/list&gt;</span>
    <span class="tok-nt">&lt;/property&gt;</span>
    <span class="tok-c">&lt;!-- ... --&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myOwnFunctionDelegateOne&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.acme.MyOwnFunctionDelegateOne&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myOwnFunctionDelegateTwo&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.acme.MyOwnFunctionDelegateTwo&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，自定义函数委托必须继承自 org.flowable.engine.common.impl.el.AbstractFlowableFunctionDelegate。</p>
</div>
</div>
<div class="sect4">
<h5 id="loggingConfiguration">日志</h5>
<div class="paragraph">
<p>所有日志（flowable、spring、mybatis、&#8230;&#8203;）都通过 slf4j 门面进行记录，所以你可以自行选择日志框架。</p>
</div>
<div class="paragraph">
<p><strong>flowable 引擎依赖项中默认没有包含具体的日志实现框架；你应该将你选择的日志框架添加到你的项目中。</strong> 如果没有引入日志实现框架的 jar 包，slf4j 不会记录任何日志，只会给出一个不会记录任何内容的警告。</p>
</div>
<div class="paragraph">
<p>举个例子，使用 maven 时，像这样添加依赖（以使用 log4j 为例），请注意这里省略了版本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.slf4j<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>slf4j-log4j12<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>flowable-ui 和 flowable-rest webapps 使用 log4j。运行所有的 flowable-* mudules 测试时同样使用 log4j。</p>
</div>
<div class="paragraph">
<p><strong>所用容器的 classpath 中带有 commons-logging 时的重要注意事项：</strong> 为了能通过 slf4j 能调用到 spring-logging，使用了一个桥（a bridge is used）（详见 <a href="http://www.slf4j.org/legacy.html#jclOverSLF4J"><a href="http://www.slf4j.org/legacy.html#jclOverSLF4J" class="bare">http://www.slf4j.org/legacy.html#jclOverSLF4J</a></a>）。如果你的容器提供了 commons-logging 实现，请按此页面的说明进行操作，以确保稳定：<a href="http://www.slf4j.org/codes.html#release"><a href="http://www.slf4j.org/codes.html#release" class="bare">http://www.slf4j.org/codes.html#release</a></a>。</p>
</div>
<div class="paragraph">
<p>Maven 示例（忽略了版本）:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.slf4j<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>jcl-over-slf4j<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="chapterApi">3.6.2. Flowable DMN API</h4>
<div class="sect4">
<h5 id="apiEngine">DMN引擎API和服务</h5>
<div class="paragraph">
<p>DMN引擎API是与Flowable DMN交互的最常见方式。中心起点是<code>DmnEngine</code>，可以通过<a href="#configuration">configuration section</a>部分中描述的多种方式创建。从DmnEngine中，您可以获得各种其他服务。</p>
</div>
<div class="paragraph">
<p>DmnEngine和服务对象是线程安全的。因此，您可以为整个服务器保留对其中一个的引用。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">DmnEngine</span> <span class="tok-n">dmnEngine</span> <span class="tok-o">=</span> <span class="tok-n">DmnEngines</span><span class="tok-o">.</span><span class="tok-na">getDefaultDmnEngine</span><span class="tok-o">();</span>
<span class="tok-n">DmnRuleService</span> <span class="tok-n">dmnRuleService</span> <span class="tok-o">=</span> <span class="tok-n">dmnEngine</span><span class="tok-o">.</span><span class="tok-na">getDmnRuleService</span><span class="tok-o">();</span>
<span class="tok-n">DmnRepositoryService</span> <span class="tok-n">dmnRepositoryService</span> <span class="tok-o">=</span> <span class="tok-n">dmnEngine</span><span class="tok-o">.</span><span class="tok-na">getDmnRepositoryService</span><span class="tok-o">();</span>
<span class="tok-n">DmnManagementService</span> <span class="tok-n">dmnManagementService</span> <span class="tok-o">=</span> <span class="tok-n">dmnEngine</span><span class="tok-o">.</span><span class="tok-na">getDmnManagementService</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>DmnEngines.getDefaultDmnEngine()</code> 将在第一次调用时初始化并构建DMN引擎，之后始终返回相同的DMN引擎。 可以使用适当的DMNEngines.init()创建和DMNEngines.destroy()关闭所有DMN引擎。</p>
</div>
<div class="paragraph">
<p>DmnEngines类将扫描所有 <code>flowable.dmn.cfg.xml</code> 和 <code>flowable-dmn-context.xml</code> 文件。对所有 <code>flowable.dmn.cfg.xml</code> 文件， DMN引擎将以典型的Flowable方式构建：<code>DmnEngineConfiguration.createDmnEngineConfigurationFromInputStream(inputStream).buildDmnEngine()</code>. 对所有 <code>flowable-dmn-context.xml</code> 文件，DMN引擎将以Spring方式构建： 首先创建Spring应用程序上下文，然后从该应用程序上下文中获取DMN引擎。</p>
</div>
<div class="paragraph">
<p>所有服务都是无状态的。这意味着您可以在群集中的多个节点上轻松运行Flowable DMN，每个都进入同一个数据库，而不必担心哪台机器实际执行了以前的调用。对任何服务的任何调用都是幂等的，无论它在何处执行。</p>
</div>
<div class="paragraph">
<p>DmnRepositoryService可能是使用Flowable DMN引擎时所需的第一个服务。此服务提供用于管理、操作部署和DMN定义的操作。 DMN定义是DMN模型的根本概念(DMN的主要概念在&lt;dmn-introduction, DMN introduction section&gt;中有解释). 它包含决策的定义（及其决策表）。
 部署是Flowable DMN引擎中的打包的单位。部署可以包含多个DMN XML文件。 发布部署意味着将其部署到引擎表，在存储到数据库中之前检查和解析所有DMN定义。从那时起，系统就知道部署，现在可以执行部署中包含的任何决策。</p>
</div>
<div class="paragraph">
<p>此外，此服务允许您：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>查询引擎已知的部署，DMN定义和决策表。</p>
</li>
<li>
<p>检索可用于使用Java而不是XML进行内省的DMN定义或决策表的POJO版本。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>DmnRuleService</strong> 提供了执行决策的方法。通过提供参数和输入数据，可以开始评估决策。</p>
</div>
<div class="paragraph">
<p>使用Flowable DMN编写自定义应用程序时，通常不需要 <strong>DmnManagementService</strong> 。 它允许您检索有关引擎版本，数据库表和表元数据的信息。</p>
</div>
<div class="paragraph">
<p>有关服务操作和DMN引擎API的更多详细信息，查看链接：http://www.flowable.org/docs/javadocs/index.html[the javadocs].</p>
</div>
</div>
<div class="sect4">
<h5 id="_异常策略_2">异常策略</h5>
<div class="paragraph">
<p>Flowable中的基本异常是 <code>org.flowable.engine.FlowableException</code>,一个 unchecked 异常。 API可以随时抛出此异常，但在特定方法中发生的“预期”异常将记录在链接:http://www.flowable.org/docs/javadocs/index.html[ the javadocs]. 例如， 来自 <code>DmnRuleService</code> 的提取物:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-cm">/**</span>
<span class="tok-cm">  * Execute a decision identified by it&#39;s key.</span>
<span class="tok-cm">  *</span>
<span class="tok-cm">  * @param  decisionKey      the decision key, cannot be null</span>
<span class="tok-cm">  * @param  inputVariables   map with input variables</span>
<span class="tok-cm">  * @return                  the {@link RuleEngineExecutionResult} for this execution</span>
<span class="tok-cm">  * @throws FlowableObjectNotFoundException</span>
<span class="tok-cm">  *            when the decision with given key does not exist.</span>
<span class="tok-cm">  * @throws FlowableException</span>
<span class="tok-cm">  *           when an error occurs while executing the decision.</span>
<span class="tok-cm">  */</span>
<span class="tok-n">RuleEngineExecutionResult</span> <span class="tok-nf">executeDecisionByKey</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">decisionKey</span><span class="tok-o">,</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">inputVariables</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的示例中，当传递的密钥没有任何决策时，将抛出异常。此外，由于javadoc  <strong>明确声明decisionKey不能为null，当传递null时，将抛出 FlowableIllegalArgumentException</strong> 。</p>
</div>
<div class="paragraph">
<p>即使我们想要避免一个大的异常层次结构，在特定情况下会抛出以下子类。在流程执行或API调用期间发生的所有其他错误都不符合以下可能的异常，这些错误将作为常规<code> FlowableExceptions </code> 抛出。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FlowableOptimisticLockingException</code>: 在由同一数据条目的并发访问引起的数据存储中发生乐观锁定时抛出。</p>
</li>
<li>
<p><code>FlowableClassLoadingException</code>: 未找到请求加载的类或加载时发生错误时抛出。</p>
</li>
<li>
<p><code>FlowableObjectNotFoundException</code>: 当请求或操作的对象不存在时抛出。</p>
</li>
<li>
<p><code>FlowableIllegalArgumentException</code>: 指示在Flowable DMN API调用中提供了非法参数的异常，在引擎的配置中配置了非法值，或者提供了非法值。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="queryAPI">查询 API</h5>
<div class="paragraph">
<p>有两种方法可以从引擎查询数据：查询API和本机查询。 Query API允许使用流畅的API对完全类型安全的查询进行编程。您可以为查询添加各种条件（所有这些条件作为逻辑AND一起应用）并且恰好是一个排序。以下代码显示了一个示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">DmnDeployment</span><span class="tok-o">&gt;</span> <span class="tok-n">dmnDeployments</span> <span class="tok-o">=</span> <span class="tok-n">dmnRepositoryService</span><span class="tok-o">.</span><span class="tok-na">createDeploymentQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">deploymentNameLike</span><span class="tok-o">(</span><span class="tok-s">&quot;deployment%&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">orderByDeployTime</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>有时您需要更强大的查询，例如，使用OR运算符的查询或使用Query API无法表达的限制。对于这些情况，我们引入了本机查询，允许您编写自己的SQL查询。返回类型由您使用的Query对象定义，数据映射到正确的对象，例如Deployment，ProcessInstance，Execution等。由于查询将在数据库中触发，因此必须使用在数据库中定义的表名和列名;这需要一些有关内部数据结构的知识，建议您谨慎使用本机查询。可以通过API检索表名，以使依赖性尽可能小。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span>
<span class="tok-kt">long</span> <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-n">dmnRepositoryService</span><span class="tok-o">.</span><span class="tok-na">createNativeDeploymentQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">sql</span><span class="tok-o">(</span><span class="tok-s">&quot;SELECT count(*) FROM &quot;</span> <span class="tok-o">+</span> <span class="tok-n">dmnManagementService</span><span class="tok-o">.</span><span class="tok-na">getTableName</span><span class="tok-o">(</span><span class="tok-n">DmnDeploymentEntity</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-s">&quot; D1, &quot;</span>
        <span class="tok-o">+</span> <span class="tok-n">dmnManagementService</span><span class="tok-o">.</span><span class="tok-na">getTableName</span><span class="tok-o">(</span><span class="tok-n">DecisionTableEntity</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-s">&quot; D2 &quot;</span>
        <span class="tok-o">+</span> <span class="tok-s">&quot;WHERE D1.ID_ = D2.DEPLOYMENT_ID_ &quot;</span>
        <span class="tok-o">+</span> <span class="tok-s">&quot;AND D1.ID_ = #{deploymentId}&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">parameter</span><span class="tok-o">(</span><span class="tok-s">&quot;deploymentId&quot;</span><span class="tok-o">,</span> <span class="tok-n">deployment</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
    <span class="tok-o">.</span><span class="tok-na">count</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="apiUnitTesting">单元测试</h5>
<div class="paragraph">
<p>由于Flowable DMN是一个可嵌入的Java引擎，因此编写DMN定义的单元测试就像编写常规单元测试一样简单。</p>
</div>
<div class="paragraph">
<p>Flowable支持JUnit版本4和5样式的单元测试。</p>
</div>
<div class="paragraph">
<p>在JUnit 5样式中，需要使用 org.flowable.dmn.engine.test.FlowableDmnTest 注解
 或手动注册 org.flowable.dmn.engine.test.FlowableDmnExtension 。
 FlowableDmnTest 注解只是一个元注解，并且注册了 FlowableDmnExtension
 (即 <code>@ExtendWith(FlowableDmnExtension.class)</code>).
 这将使DmnEngine和服务可用作测试和生命周期方法的参数
 (<code>@BeforeAll</code>, <code>@BeforeEach</code>, <code>@AfterEach</code>, <code>@AfterAll</code>).
 在每次测试之前，默认情况下将使用类路径上的 flowable.dmn.cfg.xml 资源初始化dmnEngine。
 为了指定不同的配置文件需要使用org.flowable.dmn.engine.test.DmnConfigurationResource 注解（参见第二个例子）。
 当配置资源相同时，Dmn引擎将在多个单元测试中静态缓存。</p>
</div>
<div class="paragraph">
<p>通过使用 FlowableDmnExtension ，您可以在测试方法上使用 org.flowable.dmn.engine.test.DmnDeployment 注解或 org.flowable.dmn.engine.test.DmnDeploymentAnnotation 注解。
 如果同时使用 @DmnDeployment 和 @DmnDeploymentAnnotatio 那么 @DmnDeployment 优先，@DmnDeploymentAnnotation 将被忽略。
 在测试方法上使用 @DmnDeployment 注解时，在每次测试之前，将部署 DmnDeployment＃resources 中定义的dmn文件。
 如果没有定义资源，则为 testClassName.testMethod.dmn 形式的资源文件，将在与测试类相同的包中进行部署。
 在测试结束时，部署将被删除，包括所有相关的dmn定义，执行等。
 有关更多信息，请参阅 DmnDeployment 类。</p>
</div>
<div class="paragraph">
<p>考虑到所有这些，JUnit 5测试看起来如下：</p>
</div>
<div class="listingblock">
<div class="title">使用默认资源进行JUnit 5测试</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-nd">@FlowableDmnTest</span>
<span class="tok-kd">class</span> <span class="tok-nc">MyDecisionTableTest</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Test</span>
  <span class="tok-nd">@DmnDeploymentAnnotation</span>
  <span class="tok-kt">void</span> <span class="tok-nf">simpleDmnTest</span><span class="tok-o">(</span><span class="tok-n">DmnEngine</span> <span class="tok-n">dmnEngine</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">DmnRuleService</span> <span class="tok-n">dmnRuleService</span> <span class="tok-o">=</span> <span class="tok-n">dmnEngine</span><span class="tok-o">.</span><span class="tok-na">getDmnRuleService</span><span class="tok-o">();</span>

    <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">executionResult</span> <span class="tok-o">=</span> <span class="tok-n">ruleService</span><span class="tok-o">.</span><span class="tok-na">createExecuteDecisionBuilder</span><span class="tok-o">()</span>
            <span class="tok-o">.</span><span class="tok-na">decisionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;extensionUsage&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">variable</span><span class="tok-o">(</span><span class="tok-s">&quot;inputVariable1&quot;</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">variable</span><span class="tok-o">(</span><span class="tok-s">&quot;inputVariable2&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;test2&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">executeWithSingleResult</span><span class="tok-o">();</span>

    <span class="tok-n">Assertions</span><span class="tok-o">.</span><span class="tok-na">assertThat</span><span class="tok-o">(</span><span class="tok-n">executionResult</span><span class="tok-o">).</span><span class="tok-na">containsEntry</span><span class="tok-o">(</span><span class="tok-s">&quot;output1&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;test1&quot;</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>使用JUnit 5，您还可以将部署的ID（带有org.flowable.dmn.engine.test.DmnDeploymentId_）注入到测试和生命周期方法中。</pre>
</div>
</div>
<div class="listingblock">
<div class="title">使用自定义资源进行JUnit 5测试</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</div></td><td class="code"><span></span><span class="tok-nd">@FlowableDmnTest</span>
<span class="tok-nd">@DmnConfigurationResource</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable.custom.dmn.cfg.xml&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">MyDecisionTableTest</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Test</span>
  <span class="tok-nd">@DmnDeploymentAnnotation</span>
  <span class="tok-kt">void</span> <span class="tok-nf">simpleDmnTest</span><span class="tok-o">(</span><span class="tok-n">DmnEngine</span> <span class="tok-n">dmnEngine</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">DmnRuleService</span> <span class="tok-n">dmnRuleService</span> <span class="tok-o">=</span> <span class="tok-n">dmnEngine</span><span class="tok-o">.</span><span class="tok-na">getDmnRuleService</span><span class="tok-o">();</span>

    <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">executionResult</span> <span class="tok-o">=</span> <span class="tok-n">ruleService</span><span class="tok-o">.</span><span class="tok-na">createExecuteDecisionBuilder</span><span class="tok-o">()</span>
            <span class="tok-o">.</span><span class="tok-na">decisionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;extensionUsage&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">variable</span><span class="tok-o">(</span><span class="tok-s">&quot;inputVariable1&quot;</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">variable</span><span class="tok-o">(</span><span class="tok-s">&quot;inputVariable2&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;test2&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">executeWithSingleResult</span><span class="tok-o">();</span>

    <span class="tok-n">Assertions</span><span class="tok-o">.</span><span class="tok-na">assertThat</span><span class="tok-o">(</span><span class="tok-n">executionResult</span><span class="tok-o">).</span><span class="tok-na">containsEntry</span><span class="tok-o">(</span><span class="tok-s">&quot;output1&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;test1&quot;</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在编写JUnit 4单元测试时，可以使用 org.flowable.dmn.engine.test.FlowableDmnRule 规则。通过此规则，DMN引擎和服务可通过getter获得。包含此 Rule 将启用注解 org.flowable.dmn.engine.test.DmnDeploymentAnnotation (请参阅上文，了解其使用和配置) 它将在类路径中查找默认配置文件。 当使用相同的配置资源时，DMN引擎可以在多个单元测试中静态缓存。
也可以为规则提供自定义引擎配置。</p>
</div>
<div class="paragraph">
<p>以下代码片段显示了使用JUnit 4测试样式和 FlowableDmnRule 的用法的示例（并传递可选的自定义配置）：</p>
</div>
<div class="listingblock">
<div class="title">JUnit 4 test</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyDecisionTableTest</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Rule</span>
  <span class="tok-kd">public</span> <span class="tok-n">FlowableDmnRule</span> <span class="tok-n">flowableDmnRule</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">FlowableDmnRule</span><span class="tok-o">(</span><span class="tok-s">&quot;custom1.flowable.dmn.cfg.xml&quot;</span><span class="tok-o">);</span>

  <span class="tok-nd">@Test</span>
  <span class="tok-nd">@DmnDeploymentAnnotation</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">ruleUsageExample</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">DmnEngine</span> <span class="tok-n">dmnEngine</span> <span class="tok-o">=</span> <span class="tok-n">flowableDmnRule</span><span class="tok-o">.</span><span class="tok-na">getDmnEngine</span><span class="tok-o">();</span>
    <span class="tok-n">DmnRuleService</span> <span class="tok-n">dmnRuleService</span> <span class="tok-o">=</span> <span class="tok-n">dmnEngine</span><span class="tok-o">.</span><span class="tok-na">getDmnRuleService</span><span class="tok-o">();</span>

    <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">executionResult</span> <span class="tok-o">=</span> <span class="tok-n">ruleService</span><span class="tok-o">.</span><span class="tok-na">createExecuteDecisionBuilder</span><span class="tok-o">()</span>
            <span class="tok-o">.</span><span class="tok-na">decisionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;extensionUsage&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">variable</span><span class="tok-o">(</span><span class="tok-s">&quot;inputVariable1&quot;</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">variable</span><span class="tok-o">(</span><span class="tok-s">&quot;inputVariable2&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;test2&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">executeWithSingleResult</span><span class="tok-o">();</span>

    <span class="tok-n">Assertions</span><span class="tok-o">.</span><span class="tok-na">assertThat</span><span class="tok-o">(</span><span class="tok-n">executionResult</span><span class="tok-o">).</span><span class="tok-na">containsEntry</span><span class="tok-o">(</span><span class="tok-s">&quot;output1&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;test1&quot;</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="apiProcessEngineInWebApp">Web应用程序中的DMN引擎</h5>
<div class="paragraph">
<p>DmnEngine是一个线程安全的类，可以在多个线程之间轻松共享。 在Web应用程序中，这意味着可以在容器启动时创建DMN引擎，并在容器停机时关闭引擎。</p>
</div>
<div class="paragraph">
<p>以下代码片段显示了如何编写一个简单的 ServletContextListener 来初始化和销毁​​普通Servlet环境中的流程引擎：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">DmnEnginesServletContextListener</span> <span class="tok-kd">implements</span> <span class="tok-n">ServletContextListener</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">contextInitialized</span><span class="tok-o">(</span><span class="tok-n">ServletContextEvent</span> <span class="tok-n">servletContextEvent</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">DmnEngines</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">contextDestroyed</span><span class="tok-o">(</span><span class="tok-n">ServletContextEvent</span> <span class="tok-n">servletContextEvent</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">DmnEngines</span><span class="tok-o">.</span><span class="tok-na">destroy</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>contextInitialized 方法将调用 DmnEngines.init()。 这将寻找类路径上的 <code>flowable.dmn.cfg.xml</code> 资源文件，并对于给定的配置创建一个 <code>DmnEngine</code> (例如，带有配置文件的多个JAR).如果类路径上有多个此类资源文件，请确保它们都具有不同的名称。 当需要DMN引擎时，可以使用以下方式获取它：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">DmnEngines</span><span class="tok-o">.</span><span class="tok-na">getDefaultDmnEngine</span><span class="tok-o">()</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>或者:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">DmnEngines</span><span class="tok-o">.</span><span class="tok-na">getDmnEngine</span><span class="tok-o">(</span><span class="tok-s">&quot;myName&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当然，也可以使用任何创建DMN引擎的变体，如<a href="#configuration">configuration section</a>中描述的那样。</p>
</div>
<div class="paragraph">
<p>context-listener的 contextDestroyed方法会调用 DmnEngines.destroy()。 它会妥善关闭所有初始化的DMN引擎。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="springintegration">3.6.3. Spring集成</h4>
<div class="paragraph">
<p>虽然我们可以在没有Spring的情况下使用 Flowable DMN，但我们还是有必要提供了一些非常好的集成特性，本章我们将对此进行说明。</p>
</div>
<div class="sect4">
<h5 id="_dmnenginefactorybean">DmnEngineFactoryBean</h5>
<div class="paragraph">
<p>我们可以将<code>DMN引擎</code>配置为普通的Spring Bean。配置的入口是<code>org.flowable.dmn.spring.DmnEngineFactoryBean</code>类。这个bean采用DMN引擎配置并同时创建DMN引擎。 这意味着Spring属性的创建和配置与<a href="#configuration">configuration章节</a>中记录的是一致的。Spring集成所用的配置与引擎Bean如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.dmn.spring.SpringDmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    ...
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dmnEngine&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.dmn.spring.DmnEngineFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dmnEngineConfiguration&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;dmnEngineConfiguration&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>注意：DmnEngine Bean的配置现在使用的是<code>org.flowable.dmn.spring.SpringDmnEngineConfiguration</code>类。</p>
</div>
</div>
<div class="sect4">
<h5 id="_自动资源部署">自动资源部署</h5>
<div class="paragraph">
<p>Spring集成还有一个自动部署资源的特殊功能。在DMN引擎配置中，我们可以指定一组资源。一旦创建DMN引擎，所有指定的资源都会被扫描和部署。适当的过滤可以防止重复的部署。只有当资源确实发生变化时，才会重新部署至Flowable DMN数据库中。这在Spring容器经常重启（例如：测试）的时候非常有用。</p>
</div>
<div class="paragraph">
<p>以下是一个例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.SpringDmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  ...
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;deploymentResources&quot;</span>
    <span class="tok-na">value=</span><span class="tok-s">&quot;classpath*:/org/flowable/spring/test/autodeployment/autodeploy/decision*.dmn&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dmnEngine&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.dmn.spring.DmnEngineFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dmnEngineConfiguration&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;dmnEngineConfiguration&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>默认情况下，上面的配置方式会将符合这个过滤器的所有资源组织在一起，作为Flowable DMN引擎的一个部署。为避免未改变资源导致重复部署，重复检测过滤将作用于整个部署操作。有时候，这并不是你想要的。例如，如果我们以这种方式部署了一组DMN资源，即使这些资源中只有的一个DMN流程定义发生了改变，整个部署都被视为新的部署，这个部署中的所有流程定义都将被重新部署，这将导致每个流程定义都会刷新版本，即使实际上只有一个流程定义发生了变化。</p>
</div>
<div class="paragraph">
<p>要想定制部署的方式，我们可以在<code>SpringProcessEngineConfiguration</code>中指定一个额外属性<code>deploymentMode</code>，这个属性定义了部署一组符合过滤器的资源的策略。这个属性默认支持3个值：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>default</code>: 将所有资源组织在一个部署中，整体用于重复检测过滤。这是默认值，在不指定属性值的时候也使用这个。</p>
</li>
<li>
<p><code>single-resource</code>: 为每个资源创建一个单独的部署，并用于重复检测过滤。如果希望单独部署每一个DMN流程定义，并且只有在它发生变化时才创建新的DMN流程定义版本，就应该使用这个值。</p>
</li>
<li>
<p><code>resource-parent-folder</code>: 为同一个目录下的资源创建一个单独的部署，并用于重复检测过滤。这个属性值可以为大多数资源创建独立的部署。同时仍可以通过将部分资源放在同一个目录下，将它们组织在一起。以下是一个将<code>deploymentMode</code>设置为<code>single-resource</code>的例子：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dmnEngineConfiguration&quot;</span>
    <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.dmn.spring.SpringDmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  ...
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;deploymentResources&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;classpath*:/flowable/*.dmn&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;deploymentMode&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;single-resource&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>除了使用上面列出的<code>deploymentMode</code>几个枚举值之外，我们还可以自定义自动部署的行为。如果是这样做，我们可以创建<code>SpringDmnEngineConfiguration</code>的子类并覆盖<code>getAutoDeploymentStrategy(String deploymentMode)</code>方法。 这个方法用来设置<code>deploymentMode</code>属性值。</p>
</div>
</div>
<div class="sect4">
<h5 id="springUnitTest">单元测试</h5>
<div class="paragraph">
<p>集成Spring后，我们可以很轻松使用标准的<a href="#apiUnitTesting">Flowable测试工具</a>测试业务流程。下面的例子我们来展示如何使用典型的Spring单元测试工具测试业务流程：</p>
</div>
<div class="listingblock">
<div class="title">JUnit 5 测试</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</div></td><td class="code"><span></span><span class="tok-nd">@ExtendWith</span><span class="tok-o">(</span><span class="tok-n">FlowableDmnSpringExtension</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-nd">@ExtendWith</span><span class="tok-o">(</span><span class="tok-n">SpringExtension</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-nd">@ContextConfiguration</span><span class="tok-o">(</span><span class="tok-n">classes</span> <span class="tok-o">=</span> <span class="tok-n">DmnSpringJunitJupiterTest</span><span class="tok-o">.</span><span class="tok-na">TestConfiguration</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SpringJunit4Test</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Autowired</span>
    <span class="tok-kd">private</span> <span class="tok-n">DmnEngine</span> <span class="tok-n">dmnEngine</span><span class="tok-o">;</span>

    <span class="tok-nd">@Autowired</span>
    <span class="tok-kd">private</span> <span class="tok-n">DmnRuleService</span> <span class="tok-n">ruleService</span><span class="tok-o">;</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-nd">@DmnDeploymentAnnotation</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">simpleDecisionTest</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">executionResult</span> <span class="tok-o">=</span> <span class="tok-n">ruleService</span><span class="tok-o">.</span><span class="tok-na">createExecuteDecisionBuilder</span><span class="tok-o">()</span>
            <span class="tok-o">.</span><span class="tok-na">decisionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;extensionUsage&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">variable</span><span class="tok-o">(</span><span class="tok-s">&quot;inputVariable1&quot;</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">variable</span><span class="tok-o">(</span><span class="tok-s">&quot;inputVariable2&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;test2&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">executeWithSingleResult</span><span class="tok-o">();</span>

        <span class="tok-n">Assertions</span><span class="tok-o">.</span><span class="tok-na">assertThat</span><span class="tok-o">(</span><span class="tok-n">executionResult</span><span class="tok-o">).</span><span class="tok-na">containsEntry</span><span class="tok-o">(</span><span class="tok-s">&quot;output1&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;test1&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">JUnit 4 测试</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</div></td><td class="code"><span></span><span class="tok-nd">@RunWith</span><span class="tok-o">(</span><span class="tok-n">SpringJUnit4ClassRunner</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-nd">@ContextConfiguration</span><span class="tok-o">(</span><span class="tok-s">&quot;classpath:org/flowable/spring/test/junit4/springTypicalUsageTest-context.xml&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SpringJunit4Test</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Autowired</span>
    <span class="tok-kd">private</span> <span class="tok-n">DmnEngine</span> <span class="tok-n">dmnEngine</span><span class="tok-o">;</span>

    <span class="tok-nd">@Autowired</span>
    <span class="tok-kd">private</span> <span class="tok-n">DmnRuleService</span> <span class="tok-n">ruleService</span><span class="tok-o">;</span>

    <span class="tok-nd">@Autowired</span>
    <span class="tok-nd">@Rule</span>
    <span class="tok-kd">public</span> <span class="tok-n">FlowableDmnRule</span> <span class="tok-n">flowableSpringRule</span><span class="tok-o">;</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-nd">@DmnDeploymentAnnotation</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">simpleDecisionTest</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">executionResult</span> <span class="tok-o">=</span> <span class="tok-n">ruleService</span><span class="tok-o">.</span><span class="tok-na">createExecuteDecisionBuilder</span><span class="tok-o">()</span>
                <span class="tok-o">.</span><span class="tok-na">decisionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;extensionUsage&quot;</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">variable</span><span class="tok-o">(</span><span class="tok-s">&quot;inputVariable1&quot;</span><span class="tok-o">,</span> <span class="tok-mi">2</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">variable</span><span class="tok-o">(</span><span class="tok-s">&quot;inputVariable2&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;test2&quot;</span><span class="tok-o">)</span>
                <span class="tok-o">.</span><span class="tok-na">executeWithSingleResult</span><span class="tok-o">();</span>

        <span class="tok-n">Assertions</span><span class="tok-o">.</span><span class="tok-na">assertThat</span><span class="tok-o">(</span><span class="tok-n">executionResult</span><span class="tok-o">).</span><span class="tok-na">containsEntry</span><span class="tok-o">(</span><span class="tok-s">&quot;output1&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;test1&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>注意：这个例子正常运行的条件是，需要在Spring配置中定义一个 <em>org.flowable.dmn.engine.test.FlowableDmnRule</em> Bean（在上面的例子中通过@Autowire自动注入）</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flowableDmnRule&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.dmn.engine.test.FlowableDmnRule&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dmnEngine&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;dmnEngine&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="chDeployment">3.6.4. 部署</h4>
<div class="sect4">
<h5 id="_dmn定义">DMN定义</h5>
<div class="paragraph">
<p>文件名后缀符合 +.dmn+的文件,可以部署到DMN引擎中。</p>
</div>
<div class="paragraph">
<p>当DMN引擎嵌入到流程引擎中,DMN定义文件可以和其他流程相关资源一起,打包到流程包（business archive BAR）里。流程引擎的部署服务会识别DMN资源,将其引入到DMN引擎中。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>流程包中包含的自定义表达式函数的Java class文件*不会添加到classpath中*。这些自定义的决策表达式class文件应该添加到DMN引擎的classpath,这样引擎才能发现并使用这些决策表达式。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_dmn定义文件决策_和决策表">DMN定义文件,决策 和决策表</h6>
<div class="paragraph">
<p>一个DMN定义包含(不仅仅是)许多决策。一个决策一个表达式。DMN规范定义(描述)了多种类型的表达式。目前在Flowable DMN中,我们支持决策表类型的表达式。
部署一个DMN定义是,定义中的每个*包含决策表*的决策定义,会分开插入到ACT_DMN_DECISION表里。</p>
</div>
</div>
<div class="sect5">
<h6 id="_编程方式部署">编程方式部署</h6>
<div class="paragraph">
<p>可以这样部署一个DMN定义:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-n">String</span> <span class="tok-n">dmnDefinition</span> <span class="tok-o">=</span> <span class="tok-s">&quot;path/to/definition-one.dmn&quot;</span><span class="tok-o">;</span> <span class="tok-c1">//Don&#39;t forget the .dmn extension!</span>

<span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">name</span><span class="tok-o">(</span><span class="tok-s">&quot;Deployment of DMN definition-one&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">addClasspathResource</span><span class="tok-o">(</span><span class="tok-n">dmnDefinition</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用诸如`addInputStream`的其他方式部署DMN定义。以下是一个使用外部文件部署DMN定义的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-n">File</span> <span class="tok-n">dmnFile</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">File</span><span class="tok-o">(</span><span class="tok-s">&quot;/path/to/definition-two.dmn&quot;</span><span class="tok-o">);</span> <span class="tok-c1">//Don&#39;t forget the .dmn extension!</span>

<span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">name</span><span class="tok-o">(</span><span class="tok-s">&quot;Deployment of DMN definition-two&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">addInputStream</span><span class="tok-o">(</span><span class="tok-n">dmnFile</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">(),</span> <span class="tok-k">new</span> <span class="tok-n">FileInputStream</span><span class="tok-o">(</span><span class="tok-n">dmnFile</span><span class="tok-o">))</span>
    <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>部署的文件,名称可以是任意文本,但是作为有效的DMN定义文件,定义文件名后缀应该是(".dmn")。</p>
</div>
</div>
<div class="sect5">
<h6 id="_java_类_2">Java 类</h6>
<div class="paragraph">
<p>当决策执行时,使用的自定义Java class文件,需要放在引擎的classpath中。</p>
</div>
<div class="paragraph">
<p>在部署DMN定义时,这些class文件可以没有放到引擎的classpath下。</p>
</div>
<div class="paragraph">
<p>在测试时需要添加自定义Java类。需要把包含这些class文件的jar包放到flowable-ui-app或flowable-app-rest工程的lib下(${webserver}/${appname}/WEB-INF/lib/)。千万不要忘记这些依赖。另外,也可以将这些依赖放到tomcat中,<code>${tomcat.home}/lib</code>。</p>
</div>
</div>
<div class="sect5">
<h6 id="_创建单应用">创建单应用</h6>
<div class="paragraph">
<p>不用确保所有DMN引擎claspath中包含所有代理类,并且使用了正确的spring配置,你可以考虑在自己的webapp里引入flowable-rest,这样就只有一个+Dmn引擎+.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="versioningOfDMNDefinitions">DMB决策版本控制</h5>
<div class="paragraph">
<p>DMN没有版本控制的概念。这实际上很好，因为作为开发项目的一部分，可执行DMN定义文件可能位于版本控制系统存储库（例如Subversion、Git或Mercurial）中。部署期间创建DMN决策的版本。在部署过程中，flowable将为+decision+分配一个版本，然后将其存储在flowable db中。</p>
</div>
<div class="paragraph">
<p>因为DMN定义中的每个DMN决策都是一个DMN定义,将执行以下步骤来初始化属性+key+、<code>version</code>、<code>name+和+id</code>：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>定义文件中 decision <code>id</code> 属性在决策表中是 <code>key</code>.</p>
</li>
<li>
<p>定义文件中 decision <code>name</code> 属性在决策表中是 <code>name</code>.</p>
</li>
<li>
<p>一个有特定的key的决策在首次部署时,版本标记为1。对于之后所有拥有相同key的发布,版本号相对于之前最高版本号+1。所以key属性是用来区分不同的决策。</p>
</li>
<li>
<p>id属性时在集群环境中,保证决策表的唯一的[数字]标识。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以下面的流程为例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myDefinitions&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;decision</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myDecision&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My important decision&quot;</span> <span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;decisionTable</span> <span class="tok-na">id=</span><span class="tok-s">&quot;decisionTable1&quot;</span> <span class="tok-na">hitPolicy=</span><span class="tok-s">&quot;FIRST&quot;</span> <span class="tok-nt">&gt;</span>
    ...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当部署了该决策,决策表在数据库中是这样的：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">e29d4126-ed4d-11e6-9e00-7282cbd6ce64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myDecision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important decision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>当我们再发布这个流程的更新版本（比如：更改了用户任务）,流程定义的<code>id</code> 和之前是一样的。
流程定义表会包含一下信息：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">e29d4126-ed4d-11e6-9e00-7282cbd6ce64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myDecision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important decision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">e9c2a6c0-c085-11e6-9096-6ab56fad108a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myDecision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important decision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>当调用了 <code>dmnRuleService.executeDecisionByKey("myDecision")</code> , 之后会调用版本号 <code>2</code> 的决策定义,因为这个是决策定义的最新版本。</p>
</div>
<div class="paragraph">
<p>如果我们创建第二个决策,定义如下所示,然后发布到flowable DMN中,数据库表中会增加第三行。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myNewDefinitions&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;decision</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myNewDecision&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My important decision&quot;</span> <span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;decisionTable</span> <span class="tok-na">id=</span><span class="tok-s">&quot;decisionTable1&quot;</span> <span class="tok-na">hitPolicy=</span><span class="tok-s">&quot;FIRST&quot;</span> <span class="tok-nt">&gt;</span>
      ...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>表中数据是这样的:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">e29d4126-ed4d-11e6-9e00-7282cbd6ce64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myDecision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important decision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">e9c2a6c0-c085-11e6-9096-6ab56fad108a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myDecision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important decision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">d317d3f7-e948-11e6-9ce6-b28c070b517d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myNewDecision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important decision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>注意：新的决策的key和第一个决策的key是不一样的。尽管name属性是一样的（正常情况下，表意清晰的话，我们需要把name属性也改掉）,FlowableDMN引擎通过 <code>id</code> 属性来区分不同的决策。新增的决策将会以版本1部署。</p>
</div>
</div>
<div class="sect4">
<h5 id="deploymentCategory">分类</h5>
<div class="paragraph">
<p>DMN部署和决策表都可以自定义分类。
DMN部署分类可以这样定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">dmnRepository</span>
    <span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">category</span><span class="tok-o">(</span><span class="tok-s">&quot;yourCategory&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">...</span>
    <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>决策表分类可以这样定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">dmnRepository</span><span class="tok-o">.</span><span class="tok-na">setDecisionTableCategory</span><span class="tok-o">(</span><span class="tok-s">&quot;e9c2a6c0-c085-11e6-9096-6ab56fad108a&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;yourCategory&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_forms">3.7. FORMS</h3>
<div class="sect3">
<h4 id="_配置_3">3.7.1. 配置</h4>
<div class="sect4">
<h5 id="configuration">创建表单引擎</h5>
<div class="paragraph">
<p><em>Flowable 表单引擎的结构与Flowable流程引擎非常相似。 因此，文档的某些部分与其流程引擎对应部分相似.</em></p>
</div>
<div class="paragraph">
<p>Flowable Form引擎通过名为flowable.form.cfg.xml的XML文件进行配置。 请注意，如果您使用的是“springintegration，构建表单引擎的Spring样式”，则这不适用*。</p>
</div>
<div class="paragraph">
<p>获取FormEngine的最简单方法是使用org.flowable.form.engine.FormEngines类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">FormEngine</span> <span class="tok-n">formEngine</span> <span class="tok-o">=</span> <span class="tok-n">FormEngines</span><span class="tok-o">.</span><span class="tok-na">getDefaultFormEngine</span><span class="tok-o">()</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这将在类路径上查找flowable.form.cfg.xml文件，并根据该文件中的配置构造引擎。 以下代码段显示了示例配置。 以下部分将详细介绍配置属性。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;formEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.dmn.engine.impl.cfg.StandaloneFormEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUrl&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcDriver&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.h2.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUsername&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sa&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcPassword&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，配置XML实际上是Spring配置。 这并不意味着Flowable Form只能在Spring环境中使用！ 我们只是在内部利用Spring的解析和依赖注入功能来构建引擎。</p>
</div>
<div class="paragraph">
<p>也可以使用配置文件以编程方式创建FormEngineConfiguration对象。 也可以使用不同的bean id（例如，参见第3行）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-n">FormEngineConfiguration</span><span class="tok-o">.</span>
  <span class="tok-nf">createFormEngineConfigurationFromResourceDefault</span><span class="tok-o">();</span>
  <span class="tok-n">createFormEngineConfigurationFromResource</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">resource</span><span class="tok-o">);</span>
  <span class="tok-n">createFormEngineConfigurationFromResource</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">resource</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">beanName</span><span class="tok-o">);</span>
  <span class="tok-n">createFormEngineConfigurationFromInputStream</span><span class="tok-o">(</span><span class="tok-n">InputStream</span> <span class="tok-n">inputStream</span><span class="tok-o">);</span>
  <span class="tok-n">createFormEngineConfigurationFromInputStream</span><span class="tok-o">(</span><span class="tok-n">InputStream</span> <span class="tok-n">inputStream</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">beanName</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以不使用配置文件，并基于创建配置
默认值（有关更多信息，请参阅&lt;&lt; configurationClasses类&gt;&gt;）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">FormEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneFormEngineConfiguration</span><span class="tok-o">();</span>
<span class="tok-n">FormEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneInMemFormEngineConfiguration</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>所有这些FormEngineConfiguration.createXXX（）方法返回一个FormEngineConfiguration，如果需要可以进一步调整。 调用buildFormEngine（）操作后，创建一个FormEngine：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">FormEngine</span> <span class="tok-n">formEngine</span> <span class="tok-o">=</span> <span class="tok-n">FormEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneInMemFormEngineConfiguration</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">setDatabaseSchemaUpdate</span><span class="tok-o">(</span><span class="tok-n">FormEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">DB_SCHEMA_UPDATE_FALSE</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">setJdbcUrl</span><span class="tok-o">(</span><span class="tok-s">&quot;jdbc:h2:mem:my-own-db;DB_CLOSE_DELAY=1000&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">buildFormEngine</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configurationRoot">表单引擎配置类</h5>
<div class="paragraph">
<p>flowable.form.cfg.xml文件必须包含一个具有id值为 <em>formEngineConfiguration</em> 的bean。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span> <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;formEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.form.engine.impl.cfg.StandaloneFormEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>然后使用该bean构造FormEngine。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>org.flowable.form.engine.impl.cfg.StandaloneFormEngineConfiguration</strong>: the process engine is used in a standalone way. Flowable will take care of the transactions. By default, the database will only be checked when the engine boots (and an exception is thrown if there is no Flowable Form schema or the schema version is incorrect).</p>
</li>
<li>
<p><strong>org.flowable.form.engine.impl.cfg.StandaloneInMemFormEngineConfiguration</strong>: this is a convenience class for unit testing purposes. Flowable Form will take care of the transactions. An H2 in-memory database is used by default. The database will be created and dropped when the engine boots and shuts down. When using this, probably no additional configuration is needed).</p>
</li>
<li>
<p><strong>org.flowable.form.spring.SpringFormEngineConfiguration</strong>: To be used when the Form engine is used in a Spring environment.  See <a href="#springintegration">the Spring integration section</a> for more information.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_插件方式集成流程引擎">插件方式集成流程引擎</h5>
<div class="paragraph">
<p>除了在独立模式下运行外，还可以将表单引擎插入流程引擎。 这使得流程引擎可以识别它和其他引擎。 例如，这可以将包含BPMN模型和DMN模型的工件部署到流程引擎的部署服务API。</p>
</div>
<div class="paragraph">
<p>要使流程引擎知道表单引擎，需要将org.flowable.dmn.engine.configurator.FormEngineConfigurator添加到流程引擎配置中的配置程序列表中。 此配置程序是flowable-form-engine-configurator模块的一部分。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;configurators&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;list&gt;</span>
        <span class="tok-nt">&lt;ref</span> <span class="tok-na">bean=</span><span class="tok-s">&quot;formEngineConfigurator&quot;</span> <span class="tok-nt">/&gt;</span>
      <span class="tok-nt">&lt;/list&gt;</span>
    <span class="tok-nt">&lt;/property&gt;</span>
    ...
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;formEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.form.engine.impl.cfg.StandaloneFormEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUrl&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcDriver&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.h2.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUsername&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sa&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcPassword&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;formEngineConfigurator&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.form.engine.configurator.FormEngineConfigurator&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;formEngineConfiguration&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;formEngineConfiguration&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="databaseConfiguration">数据源配置</h5>
<div class="paragraph">
<p>有两种方法可以配置Flowable 表单引擎将使用的数据库。 第一个选项是定义数据库的JDBC属性：
* <strong>jdbcUrl</strong>: 数据库的JDBC URL.
* <strong>jdbcDriver</strong>: 为特定数据库类型实现驱动程序.
* <strong>jdbcUsername</strong>: 用于连接数据库的用户名.
* <strong>jdbcPassword</strong>: 用于连接数据库的密码.</p>
</div>
<div class="paragraph">
<p>基于提供的JDBC属性构造的数据源将具有默认链接： http：//www.mybatis.org/ [MyBatis]连接池设置。 可以选择设置以下属性来调整该连接池（取自MyBatis文档）：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>jdbcMaxActiveConnections</strong>: 连接池中处于被使用状态的连接的最大值。默认为10。</p>
</li>
<li>
<p><strong>jdbcMaxIdleConnections</strong>: 连接池中处于空闲状态的连接的最大值。</p>
</li>
<li>
<p><strong>jdbcMaxCheckoutTime</strong>: 连接被取出使用的最长时间，超过时间会被强制回收。 默认为20000（20秒）。</p>
</li>
<li>
<p><strong>jdbcMaxWaitTime</strong>:这是一个底层配置，让连接池可以在长时间无法获得连接时， 打印一条日志，并重新尝试获取一个连接。（避免因为错误配置导致沉默的操作失败）。 默认为20000（20秒）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>示例数据库配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUrl&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:flowable_dmn;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcDriver&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.h2.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUsername&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sa&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcPassword&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>我们的基准测试表明，在处理大量并发请求时，MyBatis连接池可能扛不住。 因此，我们建议使用javax.sql.DataSource实现并将其注入流程引擎配置（例如HikariCP，Tomcat JDBC连接池等）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;driverClassName&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;com.mysql.jdbc.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;url&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:mysql://localhost:3306/flowable_dmn&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;username&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;flowable&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;flowable&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;defaultAutoCommit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;formEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.form.engine.impl.cfg.StandaloneFormEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-nt">/&gt;</span>
    ...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，Flowable 表单不附带允许您定义此类数据源的库。 所以你必须确保库在你的类路径上。</p>
</div>
<div class="paragraph">
<p>无论您使用的是JDBC还是数据源方法，都可以设置以下属性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>databaseType</strong>: 数据库类型，可以是如下的值（h2, mysql, oracle, postgres, mssql, db2）.</p>
</li>
<li>
<p><strong>databaseSchemaUpdate</strong>:允许您设置策略以在表单引擎启动和关闭时如何处理数据库表.</p>
<div class="ulist">
<ul>
<li>
<p><code>false</code> (default): 在创建表单引擎时检查库模式的版本，如果版本不匹配则抛出异常.</p>
</li>
<li>
<p><code>true</code>: 在构建表单引擎时，执行检查并在必要时执行模式的更新。 如果schema不存在，则创建它.</p>
</li>
<li>
<p><code>create-drop</code>: 在创建表单引擎时创建schema，并在关闭流程引擎时删除schema.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="jndiDatasourceConfig">JNDI方式数据源配置</h5>
<div class="paragraph">
<p>默认情况下，Flowable Form的数据库配置包含在每个Web应用程序的WEB-INF/classes中的db.properties文件中。 这并不总是理想的，因为它
要求用户修改Flowable源中的db.properties并重新编译WAR文件，或者在每次部署时分解WAR并修改db.properties。
通过使用JNDI（Java命名和目录接口）获取数据库连接，连接完全由Servlet容器管理，并且可以在WAR部署之外管理配置。 这也允许对db.properties文件提供的连接参数进行更多控制。</p>
</div>
<div class="sect5">
<h6 id="jndi_configuration">配置</h6>
<div class="paragraph">
<p>JNDI数据源的配置将根据您使用的servlet容器应用程序而有所不同。 以下说明适用于Tomcat，但对于其他容器应用程序，请参阅容器应用程序的文档。</p>
</div>
<div class="paragraph">
<p>如果使用Tomcat，则在$CATALINA_BASE/conf/[enginename]/[hostname]/[warname].xml中配置JNDI资源（对于Flowable UI，这通常是$CATALINA_BASE/conf/Catalina/localhost/flowable-app。XML）。 首次部署应用程序时，将从Flowable WAR文件复制默认上下文，因此如果已存在，则需要替换它。 例如，要更改JNDI资源以便应用程序连接到MySQL而不是H2，请将文件更改为以下内容：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
    <span class="tok-nt">&lt;Context</span> <span class="tok-na">antiJARLocking=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">path=</span><span class="tok-s">&quot;/flowable-app&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;Resource</span> <span class="tok-na">auth=</span><span class="tok-s">&quot;Container&quot;</span>
            <span class="tok-na">name=</span><span class="tok-s">&quot;jdbc/flowableDB&quot;</span>
            <span class="tok-na">type=</span><span class="tok-s">&quot;javax.sql.DataSource&quot;</span>
            <span class="tok-na">description=</span><span class="tok-s">&quot;JDBC DataSource&quot;</span>
            <span class="tok-na">url=</span><span class="tok-s">&quot;jdbc:mysql://localhost:3306/flowable&quot;</span>
            <span class="tok-na">driverClassName=</span><span class="tok-s">&quot;com.mysql.jdbc.Driver&quot;</span>
            <span class="tok-na">username=</span><span class="tok-s">&quot;sa&quot;</span>
            <span class="tok-na">password=</span><span class="tok-s">&quot;&quot;</span>
            <span class="tok-na">defaultAutoCommit=</span><span class="tok-s">&quot;false&quot;</span>
            <span class="tok-na">initialSize=</span><span class="tok-s">&quot;5&quot;</span>
            <span class="tok-na">maxWait=</span><span class="tok-s">&quot;5000&quot;</span>
            <span class="tok-na">maxActive=</span><span class="tok-s">&quot;120&quot;</span>
            <span class="tok-na">maxIdle=</span><span class="tok-s">&quot;5&quot;</span><span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;/Context&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_jndi_属性_3">JNDI 属性</h6>
<div class="paragraph">
<p>要配置JNDI数据源，请在Flowable UI的属性文件中使用以下属性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>spring.datasource.jndi-name=: 数据源的JNDI名称.</p>
</li>
<li>
<p>datasource.jndi.resourceRef: 设置查询是否发生在J2EE容器中，换句话说，如果JNDI名称尚未包含它，则需要添加前缀“java：comp/env/”。 默认为“true”.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="supporteddatabases">支持的数据库厂商</h5>
<div class="paragraph">
<p>下面列出了Flowable用于引用数据库的类型（区分大小写！）。</p>
</div>
<table id="databaseTypes" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">数据库类型</th>
<th class="tableblock halign-left valign-top">连接URL</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">h2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:h2:tcp://localhost/flowable_form</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default configured database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mysql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:mysql://localhost:3306/flowable_form?autoReconnect=true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tested using mysql-connector-java database driver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">oracle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:oracle:thin:@localhost:1521:xe</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">postgres</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:postgresql://localhost:5432/flowable_form</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">db2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:db2://localhost:50000/flowable_form</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mssql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:sqlserver://localhost:1433;databaseName=flowable_form (jdbc.driver=com.microsoft.sqlserver.jdbc.SQLServerDriver) <em>OR</em> jdbc:jtds:sqlserver://localhost:1433/flowable_form (jdbc.driver=net.sourceforge.jtds.jdbc.Driver)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tested using Microsoft JDBC Driver 4.0 (sqljdbc4.jar) and JTDS Driver</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="creatingDatabaseTable">创建表</h5>
<div class="paragraph">
<p>Flowable表单使用链接：http://www.liquibase.org[Liquibase]来跟踪，管理和应用数据库架构更改。
为数据库创建数据库表的最简单方法是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在classpath中添加flowable-form-engine JARS包</p>
</li>
<li>
<p>添加合适的数据库驱动</p>
</li>
<li>
<p>将Flowable配置文件（flowable.form.cfg.xml）添加到类路径中，指向您的数据库（请参阅&lt;&lt; databaseConfiguration，数据库配置部分&gt;&gt;）</p>
</li>
<li>
<p>执行DbSchemaCreate类的main方法</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="database.tables.explained">数据库表名称解释</h5>
<div class="paragraph">
<p>Flowable表单的数据库名称都以ACT_FO_开头。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ACT_FO_DATABASECHANGELOG: Liquibase使用此表来跟踪已运行的changesets.</p>
</li>
<li>
<p>ACT_FO_DATABASECHANGELOGLOCK: Liquibase使用此表来确保一次只运行一个Liquibase实例.</p>
</li>
<li>
<p>ACT_FO_FORM_DEFINITION: 此表包含已部署的表单定义的定义信息.</p>
</li>
<li>
<p>ACT_FO_FORM_INSTANCE: 此表包含具有已由用户填写的值的表单实例.</p>
</li>
<li>
<p>ACT_FO_FORM_DEPLOYMENT: 该表包含部署元数据.</p>
</li>
<li>
<p>ACT_FO_FORM_RESOURCE: 此表包含表单定义资源.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="databaseUpgrade">数据库升级</h5>
<div class="paragraph">
<p>在运行升级之前，请确保备份数据库（使用数据库备份功能）。</p>
</div>
<div class="paragraph">
<p>默认情况下，每次创建流程引擎时都会执行版本检查。 这通常在应用程序或Flowable Web应用程序的引导时发生一次。 如果Flowable库注意到库版本与Flowable数据库表的版本之间的差异，则抛出异常。</p>
</div>
<div class="paragraph">
<p>要升级，必须首先将以下配置属性放在flowable.form.cfg.xml配置文件中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans</span> <span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;formEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.form.engine.impl.cfg.StandaloneFormEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-c">&lt;!-- ... --&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-c">&lt;!-- ... --&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>使用databaseSchemaUpdate设置为true即可。</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="formDefinitionCacheConfiguration">部署缓存配置</h5>
<div class="paragraph">
<p>所有定义都被缓存（在解析之后），以避免每次需要表单时都访问数据库，并且表单数据不会更改。 默认情况下，此缓存没有限制。 要限制表单缓存使用的容器大小，请添加以下属性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;formCacheLimit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;10&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>设置此属性将使默认的LRU算法。 当然，此属性的“最佳”值取决于存储的表单总量和运行时实际使用的表单数。</p>
</div>
<div class="paragraph">
<p>您也可以注入自己的缓存实现。 自定义类必须实现org.flowable.form.engine.impl.persistence.deploy.DeploymentCache接口的bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;formCache&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.MyCache&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/property&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="loggingConfiguration">日志</h5>
<div class="paragraph">
<p>所有日志记录（flowable，spring，mybatis，&#8230;&#8203;）都通过SLF4J进行路由，并允许选择您选择的日志记录实现。</p>
</div>
<div class="paragraph">
<p>*默认情况下，flowable-dmn-engine依赖项中不存在SFL4J-binding jar，这应该在项目中添加，以便使用您选择的日志框架。
*如果没有添加实现jar，SLF4J将使用NOP-logger，不记录任何内容，除了警告不会记录任何内容。 有关这些绑定链接的更多信息，请访问：http://www.slf4j.org/codes.html#StaticLoggerBinder[<a href="http://www.slf4j.org/codes.html#StaticLoggerBinder" class="bare">http://www.slf4j.org/codes.html#StaticLoggerBinder</a>]。
使用Maven，添加例如这样的依赖（这里使用log4j），请注意您仍然需要添加一个版本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.slf4j<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>slf4j-log4j12<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>flowable-ui和flowable-rest webapps配置了使用Log4j binding.。 在运行所有flowable-*模块的测试时也使用Log4j。</p>
</div>
<div class="paragraph">
<p>在类路径中使用带有commons-logging的容器时的重要注意事项：
为了通过SLF4J路由spring-logging，使用了一个桥接器（参见链接：http://www.slf4j.org/legacy.html#jclOverSLF4J[<a href="http://www.slf4j.org/legacy.html#jclOverSLF4J" class="bare">http://www.slf4j.org/legacy.html#jclOverSLF4J</a>]）。
如果您的容器提供了commons-logging实现，请按照此页面上的说明进行操作：http://www.slf4j.org/codes.html#release[<a href="http://www.slf4j.org/codes.html#release" class="bare">http://www.slf4j.org/codes.html#release</a>]确保稳定性。</p>
</div>
<div class="paragraph">
<p>使用Maven时的示例（省略版本）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.slf4j<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>jcl-over-slf4j<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="chapterApi">3.7.2. Flowable 表单 API</h4>
<div class="sect4">
<h5 id="apiEngine">表单引擎 API 与服务类</h5>
<div class="paragraph">
<p>表单引擎 API 是与 Flowable 表单交互的最常用方式。核心起点是可以通过 <a href="#configuration">配置部分</a> 中描述的几种方式创建的<code>表单引擎</code>。从表单引擎中，您能够获得各种其他服务类。</p>
</div>
<div class="paragraph">
<p>表单引擎和其服务类对象是线程安全的，因此您可以为整个服务保留其中一个引用。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.services.png" alt="api.services">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">FormEngine</span> <span class="tok-n">formEngine</span> <span class="tok-o">=</span> <span class="tok-n">FormEngines</span><span class="tok-o">.</span><span class="tok-na">getDefaultFormEngine</span><span class="tok-o">();</span>
<span class="tok-n">FormRuleService</span> <span class="tok-n">formRuleService</span> <span class="tok-o">=</span> <span class="tok-n">formEngine</span><span class="tok-o">.</span><span class="tok-na">getFormRuleService</span><span class="tok-o">();</span>
<span class="tok-n">FormRepositoryService</span> <span class="tok-n">formRepositoryService</span> <span class="tok-o">=</span> <span class="tok-n">formEngine</span><span class="tok-o">.</span><span class="tok-na">getFormRepositoryService</span><span class="tok-o">();</span>
<span class="tok-n">FormService</span> <span class="tok-n">formService</span> <span class="tok-o">=</span> <span class="tok-n">formEngine</span><span class="tok-o">.</span><span class="tok-na">getFormService</span><span class="tok-o">();</span>
<span class="tok-n">FormManagementService</span> <span class="tok-n">formManagementService</span> <span class="tok-o">=</span> <span class="tok-n">formEngine</span><span class="tok-o">.</span><span class="tok-na">getFormManagementService</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>FormEngines.getDefaultFormEngine()</code> 将在第一次调用时初始化并构建一个表单引擎，之后调用总是返回相同的表单引擎。使用 <code>FormEngines.init()</code> 和 <code>FormEngines.destroy()</code> 可以正确创建和关闭所有表单引擎。</p>
</div>
<div class="paragraph">
<p>FormEngines类将扫描所有 <code>flowable.form.cfg.xml</code> 和 <code>flowable-form-context.xml</code> 配置文件。对于所有 <code>flowable.form.cfg.xml</code> 配置文件，表单引擎将以典型的Flowable方式构建：<code>FormEngineConfiguration.createFormEngineConfigurationFromInputStream(inputStream).buildFormEngine()</code>。对于所有 <code>flowable-form-context.xml</code> 配置文件，表单引擎将以Spring方式构建：首先创建Spring应用程序上下文，然后表单引擎会从该应用程序上下文中获取。</p>
</div>
<div class="paragraph">
<p>所有的服务类均是无状态的。这意味着您可以轻松地在群集中的多个节点上运行Flowable表单模块，每个节点都连接同一个数据库，而不必担心哪台机器实际执行了旧的调用。对任何服务类的任何调用都是幂等的，无论它在何处执行。</p>
</div>
<div class="paragraph">
<p><strong>FormRepositoryService</strong> 可能是Flowable表单引擎工作时所需的第一个服务类。该服务类提供用于管理和使用<code>部署文件</code>和<code>表单定义</code>的操作。表单定义是表单模型的根本概念（表单定义的主要概念在 <a href="#form-introduction">表单介绍部分</a>中进行了解释）。</p>
</div>
<div class="paragraph">
<p><code>部署文件</code>是 Flowable 表单引擎中的打包最小单元。一个部署文件中可以包含多个表单定义的JSON 文件。发布一个部署文件意味着将其部署到引擎相关表中，在该引擎中，所有表单定义在存储到数据库之前都会被校验和解析。从那一刻起，系统会感知到这个部署文件，并且部署文件中包含的任何表单都可以被执行。</p>
</div>
<div class="paragraph">
<p>此外，这个服务类允许您：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>查询引擎已知的表单定义的部署文件。</p>
</li>
<li>
<p>检索表单定义的POJO类，它可用于使用Java中而不是JSON数据结构。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>FormService</strong> 提供了使用用户为特定表单定义填写的值来创建表单实例的方法。它也可以被用于查询表单实例。</p>
</div>
<div class="paragraph">
<p>使用 Flowable 表单模块编写自定义应用程序时，通常不需要 <strong>FormManagementService</strong> 。它允许您检索有关引擎版本，数据库表和表元数据的信息。</p>
</div>
</div>
<div class="sect4">
<h5 id="_异常策略_3">异常策略</h5>
<div class="paragraph">
<p>Flowable中的基础异常是 <code>org.flowable.engine.FlowableException</code>，这是一个未经检查的异常。这种异常可以被API随时抛出，其他特定方法中发生的“预期中的”异常被记录在<a href="http://www.flowable.org/docs/javadocs/index.html">文档</a>中。例如 <code>FormRuleService</code> 的摘录：</p>
</div>
<div class="paragraph">
<p>尽管我们想要避免一个大的异常层次结构，下列的异常子类仍会在特定情况下被抛出。在流程执行或 API 调用期间发生的所有其他错误都不适合下面可能发生的异常，这些错误将作为常规 <code>FlowableExceptions</code> 抛出。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FlowableOptimisticLockingException</code>：当由同一数据条目的并发访问引起的数据存储中发生乐观锁问题时抛出。</p>
</li>
<li>
<p><code>FlowableClassLoadingException</code>：当未找到请求加载的类或加载时发生错误时抛出。</p>
</li>
<li>
<p><code>FlowableObjectNotFoundException</code>：当请求或操作的对象不存在时抛出。</p>
</li>
<li>
<p><code>FlowableIllegalArgumentException</code>：这个异常表示在Flowable 表单 API调用中使用了非法参数、在引擎的配置中配置了非法值或者提供了非法值。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="queryAPI">查询 API</h5>
<div class="paragraph">
<p>有两种方法可以从引擎查询数据：使用查询 API 和本地查询。查询 API 允许您使用流畅的 API 编写完全类型安全的查询。您可以为查询添加各种查询条件（所有条件共同应用逻辑与）与一个排序参数。示例如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">FormDeployment</span><span class="tok-o">&gt;</span> <span class="tok-n">formDeployments</span> <span class="tok-o">=</span> <span class="tok-n">formRepositoryService</span><span class="tok-o">.</span><span class="tok-na">createDeploymentQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">deploymentNameLike</span><span class="tok-o">(</span><span class="tok-s">&quot;deployment%&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">orderByDeployTime</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>有时您需要更强大的查询操作，例如，使用或运算符或使用查询 API 无法表达的查询。对于这些情况，我们引入了本地查询，允许您编写自己的 SQL 语句进行查询。返回类型由您使用的查询对象定义，数据会映射到正确的对象，例如 Deployment、FormInstance 等。由于查询将在数据库中触发，因此必须使用在数据库中定义的表名和列名，这需要一些有关内部数据结构的知识，建议谨慎使用本机查询。表名可以通过 API 进行检索，以使依赖尽可能小。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span>
<span class="tok-kt">long</span> <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-n">formRepositoryService</span><span class="tok-o">.</span><span class="tok-na">createNativeDeploymentQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">sql</span><span class="tok-o">(</span><span class="tok-s">&quot;SELECT count(*) FROM &quot;</span> <span class="tok-o">+</span> <span class="tok-n">formManagementService</span><span class="tok-o">.</span><span class="tok-na">getTableName</span><span class="tok-o">(</span><span class="tok-n">FormDeploymentEntity</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-s">&quot; D1, &quot;</span>
        <span class="tok-o">+</span> <span class="tok-n">formManagementService</span><span class="tok-o">.</span><span class="tok-na">getTableName</span><span class="tok-o">(</span><span class="tok-n">FormDefinitionEntity</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-s">&quot; D2 &quot;</span>
        <span class="tok-o">+</span> <span class="tok-s">&quot;WHERE D1.ID_ = D2.DEPLOYMENT_ID_ &quot;</span>
        <span class="tok-o">+</span> <span class="tok-s">&quot;AND D1.ID_ = #{deploymentId}&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">parameter</span><span class="tok-o">(</span><span class="tok-s">&quot;deploymentId&quot;</span><span class="tok-o">,</span> <span class="tok-n">deployment</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
    <span class="tok-o">.</span><span class="tok-na">count</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="apiUnitTesting">单元测试</h5>
<div class="paragraph">
<p>由于 Flowable 表单模块是一个嵌入式的 Java 引擎，因此为表单定义编写单元测试就像编写常规单元测试一样简单。</p>
</div>
<div class="paragraph">
<p>Flowable 支持 JUnit 4、JUnit 5 做单元测试。</p>
</div>
<div class="paragraph">
<p>在编写JUnit 5单元测试时，可以使用 <code>org.flowable.form.engine.test.FlowableFormExtension</code>。
通过此扩展，表单引擎和服务类可用作测试和生命周期方法的参数。
使用此<code>拓展</code>将启用 <code>org.flowable.form.engine.test.FormDeploymentAnnotation</code> 注解（请参阅下面有关其使用和配置的说明），它将在类路径中查找默认配置文件。
使用相同的配置文件时，表单引擎会在多个单元测试中静态缓存。</p>
</div>
<div class="paragraph">
<p>当使用 <code>@FormDeploymentAnnotation</code> 注解测试方法时，在每次测试之前，将发布在+ FormDeploymentAnnotation＃resources +中定义的表单文件。
如果没有定义资源，将发布与测试类在同一包中的 <code>testClassName.testMethod.form</code> 形式的资源文件。
在测试结束时，部署文件将会删除，包括所有相关的表单实例、定义等。
有关更多信息，请参阅 <code>FormDeploymentAnnotation</code> 类。</p>
</div>
<div class="paragraph">
<p>在编写JUnit 4单元测试时，可以使用 <code>org.flowable.form.engine.test.FlowableFormRule</code> 规则。通过这个规则，表单引擎和服务类可以通过 getter 方法获得。包括这个<code>规则</code>将允许使用 <code>org.flowable.form.engine.test.FormDeploymentAnnotation</code> 注解（参见上面有关其使用和配置的说明），它将在类路径上查找默认配置文件。使用相同的配置文件时，表单引擎会在多个单元测试中静态缓存。
也可以为规则提供自定义的引擎配置。</p>
</div>
<div class="paragraph">
<p>以下代码片段显示了使用 JUnit 5单元测试的示例。</p>
</div>
<div class="listingblock">
<div class="title">JUnit 5 test</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</div></td><td class="code"><span></span><span class="tok-nd">@ExtendWith</span><span class="tok-o">(</span><span class="tok-n">FlowableFormExtension</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-c1">// 如果需要自定义表单配置，则应取消注释下面的部分</span>
<span class="tok-c1">//@FormConfigurationResource(&quot;custom1.flowable.form.cfg.xml&quot;)</span>
<span class="tok-kd">class</span> <span class="tok-nc">MyFormDefinitionTest</span> <span class="tok-o">{</span>

  <span class="tok-kd">private</span> <span class="tok-n">FormEngine</span> <span class="tok-n">formEngine</span><span class="tok-o">;</span>

  <span class="tok-nd">@BeforeEach</span>
  <span class="tok-kt">void</span> <span class="tok-nf">setUp</span><span class="tok-o">(</span><span class="tok-n">FormEngine</span> <span class="tok-n">formEngine</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">formEngine</span> <span class="tok-o">=</span> <span class="tok-n">formEngine</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Test</span>
  <span class="tok-nd">@FormDeploymentAnnotation</span>
  <span class="tok-kt">void</span> <span class="tok-nf">formUsageExample</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">FormService</span> <span class="tok-n">formService</span> <span class="tok-o">=</span> <span class="tok-n">formEngine</span><span class="tok-o">.</span><span class="tok-na">getFormService</span><span class="tok-o">();</span>

    <span class="tok-n">FormInstance</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">formService</span><span class="tok-o">.</span><span class="tok-na">getFormInstanceModelById</span><span class="tok-o">(</span>
        <span class="tok-s">&quot;f7689f79-f1cc-11e6-8549-acde48001122&quot;</span><span class="tok-o">,</span> <span class="tok-kc">null</span><span class="tok-o">);</span>

    <span class="tok-n">Assertions</span><span class="tok-o">.</span><span class="tok-na">assertNotNull</span><span class="tok-o">(</span><span class="tok-n">result</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>以下代码片段显示了使用 JUnit 4单元测试和 <code>FlowableFormRule</code> （传递可选的自定义配置）的示例。</p>
</div>
<div class="listingblock">
<div class="title">JUnit 4 test</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyFormDefinitionTest</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Rule</span>
  <span class="tok-kd">public</span> <span class="tok-n">FlowableFormRule</span> <span class="tok-n">flowableFormRule</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">FlowableFormRule</span><span class="tok-o">(</span><span class="tok-s">&quot;custom1.flowable.form.cfg.xml&quot;</span><span class="tok-o">);</span>

  <span class="tok-nd">@Test</span>
  <span class="tok-nd">@FormDeploymentAnnotation</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">formUsageExample</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">FormEngine</span> <span class="tok-n">formEngine</span> <span class="tok-o">=</span> <span class="tok-n">flowableFormRule</span><span class="tok-o">.</span><span class="tok-na">getFormEngine</span><span class="tok-o">();</span>
    <span class="tok-n">FormService</span> <span class="tok-n">formService</span> <span class="tok-o">=</span> <span class="tok-n">dmnEngine</span><span class="tok-o">.</span><span class="tok-na">getFormService</span><span class="tok-o">();</span>

    <span class="tok-n">FormInstance</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">formService</span><span class="tok-o">.</span><span class="tok-na">getFormInstanceModelById</span><span class="tok-o">(</span>
        <span class="tok-s">&quot;f7689f79-f1cc-11e6-8549-acde48001122&quot;</span><span class="tok-o">,</span> <span class="tok-kc">null</span><span class="tok-o">);</span>

    <span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertNotNull</span><span class="tok-o">(</span><span class="tok-n">result</span><span class="tok-o">));</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="apiFormEngineInWebApp">Web 应用程序中的表单引擎</h5>
<div class="paragraph">
<p><code>FormEngine</code> 是一个线程安全的类，可以很容易地在多个线程之间共享。在 Web 应用程序中，这意味着可以在容器启动时创建一次表单引擎，并在容器关闭时关闭引擎。</p>
</div>
<div class="paragraph">
<p>以下代码片段显示了如何在普通的 Servlet 环境中编写一个简单的 <code>ServletContextListener</code> 来初始化和销毁表单引擎：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">FormEnginesServletContextListener</span> <span class="tok-kd">implements</span> <span class="tok-n">ServletContextListener</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">contextInitialized</span><span class="tok-o">(</span><span class="tok-n">ServletContextEvent</span> <span class="tok-n">servletContextEvent</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">FormEngines</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">contextDestroyed</span><span class="tok-o">(</span><span class="tok-n">ServletContextEvent</span> <span class="tok-n">servletContextEvent</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">FormEngines</span><span class="tok-o">.</span><span class="tok-na">destroy</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>contextInitialized</code> 方法将委托给 <code>FormEngines.init()</code>。将在类路径中查找 <code>flowable.form.cfg.xml</code> 配置文件，并为给定的配置创建 <code>FormEngine</code> （例如，带有配置文件的多个JAR）。如果类路径上有多个这样的配置文件，请确保它们都有不同的名称。当需要 Form 引擎时，可以使用以下命令获取它：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">FormEngines</span><span class="tok-o">.</span><span class="tok-na">getDefaultFormEngine</span><span class="tok-o">()</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>或者</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">FormEngines</span><span class="tok-o">.</span><span class="tok-na">getFormEngine</span><span class="tok-o">(</span><span class="tok-s">&quot;myName&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当然，也可以如 <a href="#configuration">配置部分</a> 所述，使用创建表单引擎的任何变体。</p>
</div>
<div class="paragraph">
<p>上下文监听器的 <code>contextDestroyed</code> 方法委托给<code>FormEngines.destroy()</code>。这将正确关闭所有初始化的表单引擎。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="springintegration">3.7.3. 集成Spring</h4>
<div class="paragraph">
<p>虽然你可以在没有Spring的情况下使用Flowable 表单，但我们提供了一些非常好的集成功能，本章将对此进行说明。</p>
</div>
<div class="sect4">
<h5 id="_formenginefactorybean">FormEngineFactoryBean</h5>
<div class="paragraph">
<p>表单引擎可以按照常规的Spring bean方式进行配置.整合引用到的类是org.flowable.form.spring.FormEngineFactoryBean.该bean持有一个表单引擎配置类并创建表单引擎.这意味着Spring属性的创建和配置与 <a href="#configuration">configuration section</a> 中记录的相同.关于Spring集成和配置引擎bean如下所示</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;formEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.form.spring.SpringFormEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    ...
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;formEngine&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.form.spring.FormEngineFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;formEngineConfiguration&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;formEngineConfiguration&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>注意，formEngineConfiguration bean现在使用的是 <code>org.flowable.form.spring.SpringFormEngineConfiguration</code> 类。</p>
</div>
</div>
<div class="sect4">
<h5 id="_自动部署资源_2">自动部署资源</h5>
<div class="paragraph">
<p>集成Spring还具有部署资源的特性。在配置表单引擎时，您可以指定一组资源.当表单引擎被创建时，将扫描和部署这些资源并过滤防止重复部署。只有资源被更改时，才会将重新部署部署到Flowable 表单数据库.这在经常重启包含大量表单资源的Spring容器中具有很大的意义（例如，测试）</p>
</div>
<div class="paragraph">
<p>例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;formEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.SpringFormEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  ...
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;deploymentResources&quot;</span>
    <span class="tok-na">value=</span><span class="tok-s">&quot;classpath*:/org/flowable/spring/test/autodeployment/autodeploy/*.form&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;formEngine&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.form.spring.FormEngineFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;formEngineConfiguration&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;formEngineConfiguration&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>默认情况下，上面的配置会将匹配过滤后的所有资源进行分组并单独部署到Flowable 表单引擎中,在整个部署过程中重复过滤以防止重新部署未更改的资源.在某些情况下，你可能并不想这么做.例如，如果以这种方式部署一组表单资源，并且这些资源中只有一个表单定义更改了，整个流程定义部署将被视为新的并且被重新部署,尽管实际上只改变了一个但是每个表单都被定义为了新的版本,
为了能够自定义部署的方式，您可以在 <code>SpringFormEngineConfiguration</code> 中，指定 <code>deploymentMode</code> 属性。该属性定义了从过滤器匹配的资源集合以及确定部署的方式。默认情况下，该属性提供3个默认属性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>default</code>: 将所有资源分组到单个部署中，并对该部署应用重复过滤。如果您未指定其他值，将默认使用它。</p>
</li>
<li>
<p><code>single-resource</code>: 为每个单独的资源单独部署，并对该部署应用重复过滤。适用于单独部署某个已更改表单定义的资源，仅创建该表单定义的新版本。</p>
</li>
<li>
<p><code>resource-parent-folder</code>: 为共享同一父文件夹的资源创建单独的部署，并对该部署应用重复过滤。适用于为大多数资源创建单独的部署，但仍可以通过将它们放在共享文件夹中来对其进行分组。以下是为 <code>deploymentMode</code> 属性指定 <code>single-resource</code> 配置的示例：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;formEngineConfiguration&quot;</span>
    <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.form.spring.SpringFormEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  ...
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;deploymentResources&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;classpath*:/flowable/*.form&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;deploymentMode&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;single-resource&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>除了使用上面列出的 <code>deploymentMode</code> 属性之外，您还可以自定义属性来实现部署。如果需要，您可以创建 <code>SpringFormEngineConfiguration</code> 的子类并重写+getAutoDeploymentStrategy（String deploymentMode）+ 方法。该法确定将哪个部署策略用于 <code>deploymentMode</code> 配置的特定值。</p>
</div>
</div>
<div class="sect4">
<h5 id="springUnitTest">单元测试</h5>
<div class="paragraph">
<p>与Spring集成时，使用标准的<a href="#apiUnitTesting">Flowable testing facilities</a>来测试表单将会变得非常简单.
以下示例展示了如何在基于Spring的JUnit 4和5测试中测试表单：</p>
</div>
<div class="listingblock">
<div class="title">JUnit 5 测试</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-nd">@ExtendWith</span><span class="tok-o">(</span><span class="tok-n">FlowableFormSpringExtension</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-nd">@ExtendWith</span><span class="tok-o">(</span><span class="tok-n">SpringExtension</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-nd">@ContextConfiguration</span><span class="tok-o">(</span><span class="tok-n">classes</span> <span class="tok-o">=</span> <span class="tok-n">SpringJunitJupiterTest</span><span class="tok-o">.</span><span class="tok-na">TestConfiguration</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SpringJunit4Test</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Autowired</span>
    <span class="tok-kd">private</span> <span class="tok-n">FormEngine</span> <span class="tok-n">formEngine</span><span class="tok-o">;</span>

    <span class="tok-nd">@Autowired</span>
    <span class="tok-kd">private</span> <span class="tok-n">FormService</span> <span class="tok-n">formService</span><span class="tok-o">;</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-nd">@FormDeploymentAnnotation</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">simpleFormInstanceTest</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">FormInstance</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">formService</span><span class="tok-o">.</span><span class="tok-na">getFormInstanceModelById</span><span class="tok-o">(</span>
            <span class="tok-s">&quot;f7689f79-f1cc-11e6-8549-acde48001122&quot;</span><span class="tok-o">,</span> <span class="tok-kc">null</span><span class="tok-o">);</span>

        <span class="tok-n">Assertions</span><span class="tok-o">.</span><span class="tok-na">assertNotNull</span><span class="tok-o">(</span><span class="tok-n">result</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>使用 <code>FlowableFormSpringExtension</code> 时允许使用 <code>Deployment</code> 注解。</p>
</div>
<div class="listingblock">
<div class="title">JUnit 4 测试</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</div></td><td class="code"><span></span><span class="tok-nd">@RunWith</span><span class="tok-o">(</span><span class="tok-n">SpringJUnit4ClassRunner</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-nd">@ContextConfiguration</span><span class="tok-o">(</span><span class="tok-s">&quot;classpath:org/flowable/spring/test/junit4/springTypicalUsageTest-context.xml&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SpringJunit4Test</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Autowired</span>
    <span class="tok-kd">private</span> <span class="tok-n">FormEngine</span> <span class="tok-n">formEngine</span><span class="tok-o">;</span>

    <span class="tok-nd">@Autowired</span>
    <span class="tok-kd">private</span> <span class="tok-n">FormService</span> <span class="tok-n">formService</span><span class="tok-o">;</span>

    <span class="tok-nd">@Autowired</span>
    <span class="tok-nd">@Rule</span>
    <span class="tok-kd">public</span> <span class="tok-n">FlowableFormRule</span> <span class="tok-n">flowableSpringRule</span><span class="tok-o">;</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-nd">@FormDeploymentAnnotation</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">simpleFormInstanceTest</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">FormInstance</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">formService</span><span class="tok-o">.</span><span class="tok-na">getFormInstanceModelById</span><span class="tok-o">(</span>
            <span class="tok-s">&quot;f7689f79-f1cc-11e6-8549-acde48001122&quot;</span><span class="tok-o">,</span> <span class="tok-kc">null</span><span class="tok-o">);</span>

        <span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertNotNull</span><span class="tok-o">(</span><span class="tok-n">result</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>注意，在测试时，您需要在Spring配置中定义 <em>org.flowable.form.engine.test.FlowableFormRule</em> bean（在上面的示例中通过自动装配注入）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flowableFormRule&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.form.engine.test.FlowableFormRule&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;formEngine&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;formEngine&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="chDeployment">3.7.4. 部署</h4>
<div class="sect4">
<h5 id="_表单定义">表单定义</h5>
<div class="paragraph">
<p><strong>表单定义</strong>带有<code>.form</code>后缀名，可以被部署到<strong>表单引擎</strong>。</p>
</div>
<div class="paragraph">
<p>当<strong>表单引擎</strong>接入<strong>流程引擎</strong>后，<strong>表单定义</strong>和与此流程相关其他资源，将被打包进一个业务存档(BAR, Business archive)中。若使用了 flowable-form-engine-configurator 或 flowable-form-spring-configurator 模块，<strong>流程引擎</strong>部署服务将负责把表单资源部署到<strong>流程引擎</strong>中。</p>
</div>
<div class="sect5">
<h6 id="_表单定义_2">表单定义</h6>
<div class="paragraph">
<p>每个<strong>表单定义</strong>由一个或多个表单字段定义组成。当部署一个<strong>表单定义</strong>时，其信息将会被插入到 ACT_FO_FORM_DEFINITION 表中。</p>
</div>
</div>
<div class="sect5">
<h6 id="_编程方式部署_2">编程方式部署</h6>
<div class="paragraph">
<p>可使用如下方式部署一个<strong>表单定义</strong>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-n">String</span> <span class="tok-n">formDefinition</span> <span class="tok-o">=</span> <span class="tok-s">&quot;path/to/definition-one.form&quot;</span><span class="tok-o">;</span>
<span class="tok-n">ZipInputStream</span> <span class="tok-n">inputStream</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ZipInputStream</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">FileInputStream</span><span class="tok-o">(</span><span class="tok-n">barFileName</span><span class="tok-o">));</span>

<span class="tok-n">formRepositoryService</span><span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">name</span><span class="tok-o">(</span><span class="tok-s">&quot;definition-one&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">addClasspathResource</span><span class="tok-o">(</span><span class="tok-n">formDefinition</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="versioningOfFormDefinitions">表单定义的版本管理</h5>
<div class="paragraph">
<p><strong>表单定义</strong>的版本会在部署期间创建，Flowable在将<strong>表单定义</strong>存储到表单数据库前，为其分配一个版本。</p>
</div>
<div class="paragraph">
<p>对于每个<strong>表单定义</strong>，执行以下步骤来初始化这些属性<code>key</code>、<code>version</code>、 <code>name</code>和<code>id</code>：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>表单定义JSON文件中的<code>key</code>属性，被用作数据库中表单定义信息表的<code>key</code>属性。</p>
</li>
<li>
<p>表单定义JSON文件中的<code>name</code>属性，被用作数据库中表单定义信息表的<code>name</code>属性。</p>
</li>
<li>
<p>当首次以一个特定的<code>key</code>属性部署表单定义时，将分配版本为1。对于具有相同<code>key</code>属性表单定义的所有后续部署，版本将设置为当前已部署的最大版本号加1。<code>key</code>属性用来区分不同的表单定义。</p>
</li>
<li>
<p><code>id</code>属性是一个唯一的编号，用以保证在集群环境下，流程定义缓存中，流程<code>id</code>的唯一性。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>表单定义示例如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-p">{</span>
    <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;form1&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;My first form&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;fields&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span>
            <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;input1&quot;</span><span class="tok-p">,</span>
            <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Input1&quot;</span><span class="tok-p">,</span>
            <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;text&quot;</span><span class="tok-p">,</span>
            <span class="tok-nt">&quot;required&quot;</span><span class="tok-p">:</span> <span class="tok-kc">false</span><span class="tok-p">,</span>
            <span class="tok-nt">&quot;placeholder&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;empty&quot;</span>
        <span class="tok-p">}</span>
    <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当部署此表单定义后，数据库中表单定义信息表将如下所示：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">e29d4126-ed4d-11e6-9e00-7282cbd6ce64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">form1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My first form</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>假设我们现在部署相同表单定义的一个更新版本（例如，更改文本变量），但表单定义的<code>key</code>属性保持不变。数据库中表单定义信息表将包含以下条目：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">e29d4126-ed4d-11e6-9e00-7282cbd6ce64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">form1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My first form</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">e9c2a6c0-c085-11e6-9096-6ab56fad108a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">form1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My first form</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>如果我们创建第二个表单定义，如下所示，并将其部署到Flowable<strong>表单引擎</strong>，第三行将会添加到表中。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span>{
    &quot;key&quot;: &quot;form2&quot;,
    &quot;name&quot;: &quot;My second form&quot;,
    &quot;fields&quot;: [
        {
            &quot;id&quot;: &quot;input2&quot;,
            &quot;name&quot;: &quot;Input2&quot;,
            &quot;type&quot;: &quot;text&quot;,
            &quot;required&quot;: false,
            &quot;placeholder&quot;: &quot;empty&quot;
        }
    ]
}
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>数据库中表单定义信息表将如下所示：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">e29d4126-ed4d-11e6-9e00-7282cbd6ce64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">form1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My first form</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">e9c2a6c0-c085-11e6-9096-6ab56fad108a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">form1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My first form</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">d317d3f7-e948-11e6-9ce6-b28c070b517d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">form2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My second form</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>请注意新表单定义的<code>key</code>属性与第一个表单定义不同。 Flowable<strong>表单引擎</strong>仅使用<code>key</code>属性区分表单定义。因此，新的表单定义部署版本为1。</p>
</div>
</div>
<div class="sect4">
<h5 id="deploymentCategory">类别</h5>
<div class="paragraph">
<p><strong>表单部署</strong>和<strong>表单定义</strong>都可以具有用户定义的类别。
部署类别可以在如下API中指定：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">formRepository</span>
    <span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">category</span><span class="tok-o">(</span><span class="tok-s">&quot;yourCategory&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">...</span>
    <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>表单定义类别可以在如下API中指定:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">formRepository</span><span class="tok-o">.</span><span class="tok-na">setFormDefinitionCategory</span><span class="tok-o">(</span><span class="tok-s">&quot;e9c2a6c0-c085-11e6-9096-6ab56fad108a&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;yourCategory&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_integration">3.8. Integration</h3>
<div class="sect3">
<h4 id="cdiintegration">3.8.1. 集成CDI</h4>
<div class="paragraph">
<p>flowable-cdi模块结合了Flowable的可配置性及CDI(上下文和依赖注入, Contexts and Dependency Injection, J2EE)的可扩展性。flowable-cdi最突出的特点是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>支持@BusinessProcessScoped bean（生命周期绑定至流程实例的CDI bean），</p>
</li>
<li>
<p>从流程中解析CDI bean（包括EJB）的自定义El解析器，</p>
</li>
<li>
<p>使用注解对流程实例进行声明式控制，</p>
</li>
<li>
<p>Flowable关联至CDI事件总线，</p>
</li>
<li>
<p>可以与Java EE，Java SE，以及Spring一起工作，</p>
</li>
<li>
<p>支持单元测试。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
	<span class="tok-nt">&lt;groupId&gt;</span>org.flowable<span class="tok-nt">&lt;/groupId&gt;</span>
	<span class="tok-nt">&lt;artifactId&gt;</span>flowable-cdi<span class="tok-nt">&lt;/artifactId&gt;</span>
	<span class="tok-nt">&lt;version&gt;</span>6.x<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_setting_up_flowable_cdi">安装flowable-cdi</h5>
<div class="paragraph">
<p>Flowable CDI可以安装在不同环境中。在这个章节我们主要介绍配置选项。</p>
</div>
<div class="sect5">
<h6 id="_looking_up_a_process_engine">查找流程引擎</h6>
<div class="paragraph">
<p>CDI扩展需要访问流程引擎，在运行时会查找<code>org.flowable.cdi.spi.ProcessEngineLookup</code>接口的实现。CDI模块提供了默认的名为<code>org.flowable.cdi.impl.LocalProcessEngineLookup</code>的实现，使用<code>ProcessEngines</code>-Utility类查找流程引擎，默认配置下用 <code>ProcessEngines#NAME_DEFAULT</code> 查找流程引擎。如果需要使用自定义的名字，需要扩展这个类。请注意：需要将<code>flowable.cfg.xml</code>配置文件放在classpath中。</p>
</div>
<div class="paragraph">
<p>Flowable cdi使用java.util.ServiceLoader SPI解析<code>org.flowable.cdi.spi.ProcessEngineLookup</code>实例。为了提供接口的自定义实现，需要在部署中添加名为<code>META-INF/services/org.flowable.cdi.spi.ProcessEngineLookup</code>的纯文本文件，并在其中设置实现的全限定类名。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果不提供自定义的<code>org.flowable.cdi.spi.ProcessEngineLookup</code>实现，则Flowable会使用默认的<code>LocalProcessEngineLookup</code>实现。在这种情况下，只需要在classpath中提供flowable.cfg.xml（参见下一章节）即可。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_configuring_the_process_engine">配置流程引擎</h6>
<div class="paragraph">
<p>配置方式取决于所选用的流程引擎查找策略（上一章节）。这章介绍与LocalProcessEngineLookup一起使用的可用配置选项，并需要在classpath中提供一个Spring flowable.cfg.xml文件。</p>
</div>
<div class="paragraph">
<p>根据底层事务管理策略的不同，Flowable提供了不同的ProcessEngineConfiguration实现。flowable-cdi模块不关注事务，也就意味着可以使用任何事务管理策略（甚至是Spring抽象事务）。按照约定，CDI模块提供两个自定义的ProcessEngineConfiguration实现：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.flowable.cdi.CdiJtaProcessEngineConfiguration</code>: Flowable JtaProcessEngineConfiguration的子类，可用于Flowable使用JTA管理事务的情况</p>
</li>
<li>
<p><code>org.flowable.cdi.CdiStandaloneProcessEngineConfiguration</code>: StandaloneProcessEngineConfiguration的子类，可用于Flowable使用简单JDBC事务的情况。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>下面是一个JBoss 7的flowable.cfg.xml文件示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</div></td><td class="code"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-nt">&lt;beans</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans&quot;</span>
	<span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
	<span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="tok-nt">&gt;</span>

	<span class="tok-c">&lt;!-- 查找JTA事务管理器 --&gt;</span>
	<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.springframework.jndi.JndiObjectFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jndiName&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;java:jboss/TransactionManager&quot;</span><span class="tok-nt">&gt;&lt;/property&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resourceRef&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;/bean&gt;</span>

	<span class="tok-c">&lt;!-- 流程定义配置 --&gt;</span>
	<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span>
		<span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cdi.CdiJtaProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-c">&lt;!-- 查找默认的Jboss数据源 --&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dataSourceJndiName&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;java:jboss/datasources/ExampleDS&quot;</span> <span class="tok-nt">/&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseType&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;h2&quot;</span> <span class="tok-nt">/&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-nt">/&gt;</span>
		<span class="tok-c">&lt;!-- 使用外部管理事务 --&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;transactionsExternallyManaged&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;/bean&gt;</span>
<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这是Glassfish 3.1.1中的配置（假设已正确配置了名为jdbc/flowable的数据源）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</div></td><td class="code"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-nt">&lt;beans</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans&quot;</span>
	<span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
	<span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="tok-nt">&gt;</span>

	<span class="tok-c">&lt;!-- 查找JTA事务管理器 --&gt;</span>
	<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.springframework.jndi.JndiObjectFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jndiName&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;java:appserver/TransactionManager&quot;</span><span class="tok-nt">&gt;&lt;/property&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resourceRef&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;/bean&gt;</span>

	<span class="tok-c">&lt;!-- 流程定义配置 --&gt;</span>
	<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span>
		<span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cdi.CdiJtaProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dataSourceJndiName&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc/flowable&quot;</span> <span class="tok-nt">/&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-nt">/&gt;</span>
		<span class="tok-c">&lt;!-- 使用外部管理事务 --&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;transactionsExternallyManaged&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;/bean&gt;</span>
<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意上面的配置需要"spring-context"模块：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
	<span class="tok-nt">&lt;groupId&gt;</span>org.springframework<span class="tok-nt">&lt;/groupId&gt;</span>
	<span class="tok-nt">&lt;artifactId&gt;</span>spring-context<span class="tok-nt">&lt;/artifactId&gt;</span>
	<span class="tok-nt">&lt;version&gt;</span>4.2.5.RELEASE<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Java SE环境中的配置与<a href="#configuration">创建流程引擎</a>章节中的示例一样，只是用"CdiStandaloneProcessEngineConfiguration"代替"StandaloneProcessEngineConfiguration"。</p>
</div>
</div>
<div class="sect5">
<h6 id="_deploying_processes">部署流程</h6>
<div class="paragraph">
<p>可以使用标准的Flowable API（<code>RepositoryService</code>）部署流程。另外，flowable-cdi也提供了自动部署流程的功能，部署classpath中的<code>processes.xml</code>文件提供的流程列表。这是一个processes.xml文件的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>
<span class="tok-c">&lt;!-- 需要部署的流程列表 --&gt;</span>
<span class="tok-nt">&lt;processes&gt;</span>
	<span class="tok-nt">&lt;process</span> <span class="tok-na">resource=</span><span class="tok-s">&quot;diagrams/myProcess.bpmn20.xml&quot;</span> <span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;process</span> <span class="tok-na">resource=</span><span class="tok-s">&quot;diagrams/myOtherProcess.bpmn20.xml&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/processes&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_contextual_process_execution_with_cdi">使用CDI的基于上下文的流程执行</h5>
<div class="paragraph">
<p>本章节将介绍Flowable CDI扩展使用的基于上下文的流程执行模型（contextual process execution model）。BPMN业务流程通常是一个长期运行的交互动作，包含用户与系统的任务。在运行时，流程分割为独立工作单元的集合，由用户与/或应用逻辑操作。在flowable-cdi中，流程实例可以关联至一个CDI作用域，代表了一个工作单元。在工作单元很复杂的时候特别有用，比如用户任务由多个不同表单的复杂顺序组成，并需要在交互过程中保持"非流程作用域（non-process-scoped）"状态的场景。</p>
</div>
<div class="sect5">
<h6 id="_associating_a_conversation_with_a_process_instance">将一个会话关联至一个流程实例</h6>
<div class="paragraph">
<p>解析@BusinessProcessScoped bean或注入流程变量，都依赖活动的CDI作用域与流程实例的关联。flowable-cdi提供了<code>org.flowable.cdi.BusinessProcess</code> bean用于控制该关联，并提供：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>startProcessBy(&#8230;&#8203;)</em>方法，镜像了Flowable <code>RuntimeService</code>服务暴露的对应方法，用于启动并关联一个业务流程，</p>
</li>
<li>
<p><code>resumeProcessById(String processInstanceId)</code>，用于将给定id关联至流程实例，</p>
</li>
<li>
<p><code>resumeTaskById(String taskId)</code>，用于将给定id关联至任务（以及扩展至相关的流程实例）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>当完成了一个工作单元（例如一个用户任务）时，可以调用<code>completeTask()</code>方法，解除流程实例与会话/请求的关联。这将通知Flowable完成当前任务，并继续运行流程实例。</p>
</div>
<div class="paragraph">
<p>请注意<code>BusinessProcess</code> bean是一个<code>@Named</code> bean，意味着可以使用表达式（比如在JSF页面中）调用它。下面的JSF2代码片段启动了一个新的会话，并将其关联至一个用户任务实例，其id作为请求参数传递（例如<code>pageName.jsf?taskId=XX</code>）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;f:metadata&gt;</span>
<span class="tok-nt">&lt;f:viewParam</span> <span class="tok-na">name=</span><span class="tok-s">&quot;taskId&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;f:event</span> <span class="tok-na">type=</span><span class="tok-s">&quot;preRenderView&quot;</span> <span class="tok-na">listener=</span><span class="tok-s">&quot;#{businessProcess.startTask(taskId, true)}&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/f:metadata&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_declaratively_controlling_the_process">声明式控制流程</h6>
<div class="paragraph">
<p>Flowable可以使用注解，声明式地启动流程实例以及完成任务。<code>@org.flowable.cdi.annotation.StartProcess</code>注解可以通过"key"或"name"启动一个流程实例。请注意流程实例在注解的方法返回<em>之后</em>启动。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nd">@StartProcess</span><span class="tok-o">(</span><span class="tok-s">&quot;authorizeBusinessTripRequest&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">submitRequest</span><span class="tok-o">(</span><span class="tok-n">BusinessTripRequest</span> <span class="tok-n">request</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-c1">// 进行一些操作</span>
	<span class="tok-k">return</span> <span class="tok-s">&quot;success&quot;</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>按照Flowable的配置，被注解的方法代码以及流程实例的启动将处于同一个事务中。<code>@org.flowable.cdi.annotation.CompleteTask</code>的使用方式相同：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nd">@CompleteTask</span><span class="tok-o">(</span><span class="tok-n">endConversation</span><span class="tok-o">=</span><span class="tok-kc">false</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">authorizeBusinessTrip</span><span class="tok-o">()</span> <span class="tok-o">{</span>
	<span class="tok-c1">// 进行一些操作</span>
	<span class="tok-k">return</span> <span class="tok-s">&quot;success&quot;</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@CompleteTask</code>注解可以结束当前会话。默认行为是在调用Flowable返回后结束回话。但可以像上面的例子一样，禁用结束会话。</p>
</div>
</div>
<div class="sect5">
<h6 id="_referencing_beans_from_the_process">从流程中引用Bean</h6>
<div class="paragraph">
<p>flowable-cdi使用自定义解析器，将CDI bean暴露给Flowable El。因此可以像这样在流程中引用bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;authorizeBusinessTrip&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Authorize Business Trip&quot;</span>
			<span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;#{authorizingManager.account.username}&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>其中"authorizingManager"可以是生产者方法提供的bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nd">@Inject</span>	<span class="tok-nd">@ProcessVariable</span> <span class="tok-n">Object</span> <span class="tok-n">businessTripRequesterUsername</span><span class="tok-o">;</span>

<span class="tok-nd">@Produces</span>
<span class="tok-nd">@Named</span>
<span class="tok-kd">public</span> <span class="tok-n">Employee</span> <span class="tok-nf">authorizingManager</span><span class="tok-o">()</span> <span class="tok-o">{</span>
	<span class="tok-n">TypedQuery</span><span class="tok-o">&lt;</span><span class="tok-n">Employee</span><span class="tok-o">&gt;</span> <span class="tok-n">query</span> <span class="tok-o">=</span> <span class="tok-n">entityManager</span><span class="tok-o">.</span><span class="tok-na">createQuery</span><span class="tok-o">(</span><span class="tok-s">&quot;SELECT e FROM Employee e WHERE e.account.username=&#39;&quot;</span>
		<span class="tok-o">+</span> <span class="tok-n">businessTripRequesterUsername</span> <span class="tok-o">+</span> <span class="tok-s">&quot;&#39;&quot;</span><span class="tok-o">,</span> <span class="tok-n">Employee</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
	<span class="tok-n">Employee</span> <span class="tok-n">employee</span> <span class="tok-o">=</span> <span class="tok-n">query</span><span class="tok-o">.</span><span class="tok-na">getSingleResult</span><span class="tok-o">();</span>
	<span class="tok-k">return</span> <span class="tok-n">employee</span><span class="tok-o">.</span><span class="tok-na">getManager</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用<code>flowable:expression="myEjb.method()"</code>扩展，在服务任务中调用一个EJB中的业务方法。请注意这需要在<code>MyEjb</code>类上使用<code>@Named</code>注解。</p>
</div>
</div>
<div class="sect5">
<h6 id="_working_with_businessprocessscoped_beans">使用@BusinessProcessScoped bean</h6>
<div class="paragraph">
<p>可以使用flowable-cdi将一个bean的生命周期绑定在一个流程实例上。为此提供名为BusinessProcessContext的自定义的上下文实现。BusinessProcessScoped bean实例将作为流程变量存储在当前流程实例中。BusinessProcessScoped bean需要是可持久化（PassivationCapable，例如Serializable）的。下面是一个流程作用域bean的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-nd">@Named</span>
<span class="tok-nd">@BusinessProcessScoped</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BusinessTripRequest</span> <span class="tok-kd">implements</span> <span class="tok-n">Serializable</span> <span class="tok-o">{</span>
	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">long</span> <span class="tok-n">serialVersionUID</span> <span class="tok-o">=</span> <span class="tok-mi">1L</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">startDate</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">endDate</span><span class="tok-o">;</span>
	<span class="tok-c1">// ...</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>有时也需要在没有关联至流程实例的情况下（例如在流程启动前）使用流程作用域bean。如果当前没有激活的流程实例，则BusinessProcessScoped bean的实例将临时存储在本地作用域（也就是会话或请求中，取决于上下文）。如果该作用域之后关联至一个业务流程实例，则会将bean实例刷入该流程实例。</p>
</div>
</div>
<div class="sect5">
<h6 id="_injecting_process_variables">注入流程变量</h6>
<div class="paragraph">
<p>flowable-cdi支持以下方式注入流程变量</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用<code>@Inject [additional qualifiers] Type fieldName</code>类型安全地注入<code>@BusinessProcessScoped</code> bean</p>
</li>
<li>
<p>使用<code>@ProcessVariable(name?)</code>限定名不安全地注入其它流程变量：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-nd">@Inject</span> <span class="tok-nd">@ProcessVariable</span> <span class="tok-n">Object</span> <span class="tok-n">accountNumber</span><span class="tok-o">;</span>
<span class="tok-nd">@Inject</span> <span class="tok-nd">@ProcessVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;accountNumber&quot;</span><span class="tok-o">)</span> <span class="tok-n">Object</span> <span class="tok-n">account</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>要在EL中引用流程变量，有类似的选择：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>可以直接引用<code>@Named @BusinessProcessScoped</code> bean，</p>
</li>
<li>
<p>可以通过<code>ProcessVariables</code> bean引用其它流程变量：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>#{processVariables['accountNumber']}</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_receiving_process_events">接收流程事件</h6>
<div class="paragraph">
<p>Flowable可以关联至CDI事件总线。这样就可以使用标准CDI事件机制获取流程事件。要为Flowable启用CDI事件支持，需要在配置中启用相应的处理监听器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;postBpmnParseHandlers&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;list&gt;</span>
		<span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cdi.impl.event.CdiEventSupportBpmnParseHandler&quot;</span> <span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;/list&gt;</span>
<span class="tok-nt">&lt;/property&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样Flowable就被配置为使用CDI事件总线发布事件。下面介绍如何在CDI bean中接收流程事件。事件通知是类型安全的。流程事件的类型是<code>org.flowable.cdi.BusinessProcessEvent</code>。
下面是一个简单的事件观察者方法的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onProcessEvent</span><span class="tok-o">(</span><span class="tok-nd">@Observes</span> <span class="tok-n">BusinessProcessEvent</span> <span class="tok-n">businessProcessEvent</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-c1">// 处理事件</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>所有事件都会通知观察者。如果需要限制观察者接收的事件，可以添加限定注解：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@BusinessProcess</code>: 限制事件为特定的流程定义。例如：<code>@Observes @BusinessProcess("billingProcess") BusinessProcessEvent evt</code></p>
</li>
<li>
<p><code>@StartActivity</code>: 使用特定的活动限制事件。例如：<code>@Observes @StartActivity("shipGoods") BusinessProcessEvent evt</code>将在进入id为"shipGoods"的活动时调用。</p>
</li>
<li>
<p><code>@EndActivity</code>: 使用特定的活动限制事件。例如：<code>@Observes @EndActivity("shipGoods") BusinessProcessEvent evt</code>将在离开id为"shipGoods"的活动时调用。</p>
</li>
<li>
<p><code>@TakeTransition</code>: 使用特定的路径限制事件。</p>
</li>
<li>
<p><code>@CreateTask</code>: 使用特定任务的创建限制事件。</p>
</li>
<li>
<p><code>@DeleteTask</code>: 使用特定任务的删除限制事件。</p>
</li>
<li>
<p><code>@AssignTask</code>: 使用特定任务的指派限制事件。</p>
</li>
<li>
<p><code>@CompleteTask</code>: 使用特定任务的完成限制事件。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>上面的限定名可以自由组合。例如，要接收离开"shipmentProcess"中的"shipGoods"活动时生成的所有事件，可以撰写下面的观察者方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">beforeShippingGoods</span><span class="tok-o">(</span><span class="tok-nd">@Observes</span> <span class="tok-nd">@BusinessProcess</span><span class="tok-o">(</span><span class="tok-s">&quot;shippingProcess&quot;</span><span class="tok-o">)</span> <span class="tok-nd">@EndActivity</span><span class="tok-o">(</span><span class="tok-s">&quot;shipGoods&quot;</span><span class="tok-o">)</span> <span class="tok-n">BusinessProcessEvent</span> <span class="tok-n">evt</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-c1">// 处理事件</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在默认配置下，事件监听器将在上下文相同的事务中同步调用。CDI事务性观察者（CDI transactional observer，只能与JavaEE/EJB一起使用）可以在将事件交给观察者方法时进行控制。使用事务性观察者，可以保证比如只在触发事件的事务成功时才通知观察者：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onShipmentSuceeded</span><span class="tok-o">(</span><span class="tok-nd">@Observes</span><span class="tok-o">(</span><span class="tok-n">during</span><span class="tok-o">=</span><span class="tok-n">TransactionPhase</span><span class="tok-o">.</span><span class="tok-na">AFTER_SUCCESS</span><span class="tok-o">)</span> <span class="tok-nd">@BusinessProcess</span><span class="tok-o">(</span><span class="tok-s">&quot;shippingProcess&quot;</span><span class="tok-o">)</span> <span class="tok-nd">@EndActivity</span><span class="tok-o">(</span><span class="tok-s">&quot;shipGoods&quot;</span><span class="tok-o">)</span> <span class="tok-n">BusinessProcessEvent</span> <span class="tok-n">evt</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-c1">// 给客户发送邮件。</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_additional_features">其他功能</h6>
<div class="ulist">
<ul>
<li>
<p>可以注入流程引擎与服务：<code>@Inject ProcessEngine, RepositoryService, TaskService</code>, &#8230;&#8203;</p>
</li>
<li>
<p>可以注入当前的流程实例与任务：<code>@Inject ProcessInstance, Task</code>,</p>
</li>
<li>
<p>可以注入当前的businessKey：<code>@Inject @BusinessKey String businessKey</code>,</p>
</li>
<li>
<p>可以注入当前的流程实例id：<code>@Inject @ProcessInstanceId String pid</code>+</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_known_limitations">已知限制</h5>
<div class="paragraph">
<p>尽管flowable-cdi遵循SPI，并设计为“可插拔扩展”，但只在Weld下进行了测试。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="chapter_ldap">3.8.2. 集成LDAP</h4>
<div class="paragraph">
<p>很多公司使用LDAP（Lightweight Directory Access Protocol，轻量级目录访问协议）系统管理用户与组。Flowable提供了一个开箱即用的解决方案，简单配置即可将Flowable与LDAP系统连接起来。</p>
</div>
<div class="paragraph">
<p>早期版本就可以集成LDAP。之后大幅简化了配置，但“老”的LDAP配置方式仍然可用。实际上，简化配置只是对“老”框架进行的包装。</p>
</div>
<div class="sect4">
<h5 id="ldap_usage">使用</h5>
<div class="paragraph">
<p>在pom.xml中添加下列依赖，为项目中添加LDAP集成代码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.flowable<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>flowable-ldap-configurator<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>latest.version<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ldap_usecases">用途</h5>
<div class="paragraph">
<p>目前LDAP集成有两大作用：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>通过IdentityService进行认证。用于由IdentityService处理所有认证业务的场景。</p>
</li>
<li>
<p>获取一个组中的用户。比如，用于查询某用户作为候选组的任务。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="ldap_configuration">配置</h5>
<div class="paragraph">
<p>在流程引擎配置的<code>idmProcessEngineConfigurator</code>小节添加<code>org.flowable.ldap.LDAPConfigurator</code>的实现，进行Flowable与LDAP系统的集成配置。这是个高度可扩展的类：如果默认实现不能满足使用场景，可以轻松地覆盖方法，许多依赖的bean也是可插拔的。</p>
</div>
<div class="paragraph">
<p>这是一个示例配置（在代码方式创建引擎时完全类似）。目前不需要太关注这些参数，我们会在下一章节详细介绍。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;...SomeProcessEngineConfigurationClass&quot;</span><span class="tok-nt">&gt;</span>
    ...
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;idmProcessEngineConfigurator&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.ldap.LDAPConfigurator&quot;</span><span class="tok-nt">&gt;</span>

        <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;ldapConfiguration&quot;</span><span class="tok-nt">&gt;</span>
		  <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.ldap.LDAPConfiguration&quot;</span><span class="tok-nt">&gt;</span>

            <span class="tok-c">&lt;!-- 服务器连接参数 --&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;server&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;ldap://localhost&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;port&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;33389&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;user&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;uid=admin, ou=users, o=flowable&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;pass&quot;</span> <span class="tok-nt">/&gt;</span>

            <span class="tok-c">&lt;!-- 查询参数 --&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;baseDn&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;o=flowable&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;queryUserByUserId&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;(&amp;(objectClass=inetOrgPerson)(uid={0}))&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;queryUserByFullNameLike&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;(&amp;(objectClass=inetOrgPerson)(|({0}=*{1}*)({2}=*{3}*)))&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;queryAllUsers&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;(objectClass=inetOrgPerson)&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;queryGroupsForUser&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;(&amp;(objectClass=groupOfUniqueNames)(uniqueMember={0}))&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;queryAllGroups&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;(objectClass=groupOfUniqueNames)&quot;</span> <span class="tok-nt">/&gt;</span>

            <span class="tok-c">&lt;!-- 属性配置 --&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;userIdAttribute&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;uid&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;userFirstNameAttribute&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;cn&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;userLastNameAttribute&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sn&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;userEmailAttribute&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;mail&quot;</span> <span class="tok-nt">/&gt;</span>

            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;groupIdAttribute&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;cn&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;groupNameAttribute&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;cn&quot;</span> <span class="tok-nt">/&gt;</span>

          <span class="tok-nt">&lt;/bean&gt;</span>
        <span class="tok-nt">&lt;/property&gt;</span>
      <span class="tok-nt">&lt;/bean&gt;</span>
    <span class="tok-nt">&lt;/property&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ldap_properties">参数</h5>
<div class="paragraph">
<p><code>org.flowable.ldap.LDAPConfiguration</code>使用下列参数：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. LDAP配置参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP系统的服务器。例如<em>ldap://localhost:33389</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP系统的端口</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP系统的用户id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP系统的密码</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initialContextFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接LDAP所用的InitialContextFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.sun.jndi.ldap.LdapCtxFactory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">securityAuthentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接LDAP系统所用的<em>java.naming.security.authentication</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">simple</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">customConnectionParameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于设置没有配置setter的LDAP连接参数。例如 <a href="http://docs.oracle.com/javase/tutorial/jndi/ldap/jndi.html" class="bare">http://docs.oracle.com/javase/tutorial/jndi/ldap/jndi.html</a> 中的自定义参数，用于配置连接池、安全等。连接LDAP系统时会使用这些参数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map&lt;String, String&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">baseDn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询用户及组的基础<em>标识名</em>（<em>distinguished name, DN</em>）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userBaseDn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询用户的基础<em>标识名</em>。不设置则使用baseDn（见上）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupBaseDn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询组的基础<em>标识名</em>。不设置则使用baseDn（见上）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">searchTimeLimit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询LDAP的超时时间，以毫秒计</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一小时</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">queryUserByUserId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通过ID查询用户所用的语句。
 比如：<code>(&amp;(objectClass=inetOrgPerson)(uid={0}))</code>
 返回LDAP中所有<em>inetOrgPerson</em>类、<em>uid</em>属性值匹配的对象。
 上例中，使用{@link java.text.MessageFormat}即<em>{0}</em>注入用户ID。
 如果不能通过简单的语句进行查询，可以改用 <code>org.flowable.ldap.LDAPQueryBuilder</code> ，进行定制化查询。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">queryUserByFullNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通过全名查询用户所用的语句。
 比如：<code>(&amp;(objectClass=inetOrgPerson)(|({0}=**{1}**)({2}={3})))</code>
 返回LDAP中所有<em>inetOrgPerson</em>类、姓或名匹配的对象。
 注入到表达式中的值：{0} : 名字属性名 {1} : 查询文本 {2} : 姓属性名 {3} : 查询文本
 如果不能通过简单的语句进行查询，可以改用 <code>org.flowable.ldap.LDAPQueryBuilder</code>，进行定制化查询。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">queryAllUsers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不使用过滤条件，查询所有用户所用的语句。
 比如：<code>(objectClass=inetOrgPerson)</code>
 返回LDAP中所有<em>groupOfUniqueNames</em>类的对象。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">queryGroupsForUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询给定用户所在组所用的语句。
 比如：<code>(&amp;(objectClass=groupOfUniqueNames)(uniqueMember={0}))</code>
 返回LDAP中所有<em>groupOfUniqueNames</em>类、DN为<em>uniqueMember</em>的对象。
 上例中，使用{@link java.text.MessageFormat}即<em>{0}</em>注入用户ID。
 如果不能通过简单的语句进行查询，可以改用 <code>org.flowable.ldap.LDAPQueryBuilder</code> ，进行定制化查询。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">queryAllGroups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询所有组所用的语句。
 比如：<code>(objectClass=groupOfUniqueNames)</code>
 返回LDAP中所有<em>groupOfUniqueNames</em>的对象。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userIdAttribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户ID的LDAP属性名。用于查询并将LDAP用户对象映射至Flowable用户对象。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userFirstNameAttribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户名字的LDAP属性名。用于查询并将LDAP用户对象映射至Flowabl用户对象。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLastNameAttribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户姓的LDAP属性名。用于查询并将LDAP用户对象映射至Flowable用户对象。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupIdAttribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户组ID的LDAP属性名。用于查询并将LDAP用户组对象映射至Flowable用户组对象。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupNameAttribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户组名称的LDAP属性名。用于查询并将LDAP用户组对象映射至Flowable用户组对象。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupTypeAttribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户组类型的LDAP属性名。用于查询并将LDAP用户组对象映射至Flowable用户组对象</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>下面的参数用于修改默认行为及缓存组：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. 高级参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldapUserManagerFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果默认实现不符合要求，可以设置一个自定义的LDAPUserManagerFactory实现。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAPUserManagerFactory的实例</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldapGroupManagerFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果默认实现不符合要求，可以设置一个自定义的LDAPGroupManagerFactory实现。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAPGroupManagerFactory的实例</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldapMemberShipManagerFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果默认实现不符合要求，可以设置一个自定义的LDAPMembershipManagerFactory实现。请注意很少出现这种情况，一般都使用LDAP系统管理成员信息。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAPMembershipManagerFactory的实例</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldapQueryBuilder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果默认实现不符合要求，可以设置一个自定义的查询构建器。使用LDAPUserManager或LDAPGroupManage进行LDAP查询时，会使用LDAPQueryBuilder的实例。默认会使用在本实例中设置的参数，例如queryGroupsForUser与queryUserById</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.flowable.ldap.LDAPQueryBuilder的实例</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupCacheSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设置用户组缓存的尺寸。
这是用户所在组的LRU缓存。避免每次需要查询用户所在组时都访问LDAP系统。
若值小于0，则不会启用缓存。默认值为-1，所以不会进行缓存。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupCacheExpirationTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设置用户组缓存的过期时间，以毫秒计。如果设置了用户组缓存，在查询了用户所在组后，会缓存用户组关系，持续本参数设置的时间。也就是说，如果在00:00进行了用户所在组查询，过期时间为30分钟，则在00:00 - 00:30间会使用该惠存，00:30之后进行的查询不会使用该缓存，而是会重新查询LDAP系统。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个小时</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>使用活动目录（Active Directory）时请注意：用户报告在使用活动目录时，需要将<em>InitialDirContext</em>设置为Context.REFERRAL。可以通过customConnectionParameters map设置这个参数。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_advanced">3.9. 高级</h3>
<div class="paragraph">
<p>本章介绍的Flowable的高级使用技巧，超出了一般的执行BPMN 2.0流程的范畴。因此，要理解这里讨论的主题，需要对Flowable足够熟练与精通。</p>
</div>
<div class="sect3">
<h4 id="_async_executor">3.9.1. 异步执行器</h4>
<div class="paragraph">
<p>Flowable V5版本中，在之前的作业执行器(job executor)之外，还提供了异步执行器(async executor)。异步执行器已被许多Flowable的用户及我们自己的跑分证明，性能比老的作业执行器好。</p>
</div>
<div class="paragraph">
<p>从Flowable V6起，将只提供异步执行器。在V6中，对异步执行器进行了完全的重构，以提升性能及易用性。当然仍然与已有的API兼容。</p>
</div>
<div class="sect4">
<h5 id="async_executor_design">异步执行器的设计</h5>
<div class="paragraph">
<p>Flowable有两种作业类型：定时器（例如边界事件或用户任务中的定时器）以及异步操作（带有<em>flowable:async="true"</em>属性的服务任务）。</p>
</div>
<div class="paragraph">
<p><strong>定时器</strong>很容易理解：保存在ACT_RU_TIMER_JOB表中，并带有给定的到期日期。异步执行器中有一个线程，周期性地检查是否有需要触发的定时器（也就是说，到期日期在当前时间“之前”）。当需要触发定时器时，从JOB表中移除该定时器，并创建一个异步作业(async job)。</p>
</div>
<div class="paragraph">
<p><strong>异步作业</strong>在执行流程实例（即调用API）时插入数据库。如果当前Flowable引擎启用了异步执行器，则该异步作业将被<em>锁定(locked)</em>。即在ACT_RU_JOB表中插入一个作业条目，并设置其<em>lock owner(锁持有人)</em>与<em>lock expiration time(锁到期时间)</em>。在API调用成功后触发的事务监听器(transaction commit listener)，将会触发同一引擎中的异步执行器，让其执行该作业（因此可以保证数据库中已经保存了数据）。为此，异步执行器使用（可配置的）线程池，从其中取出线程用于执行作业，并使流程可以异步进行。如果Flowable引擎未启用异步执行器，则异步作业仍会插入ACT_RU_JOB表，但不会被锁定。</p>
</div>
<div class="paragraph">
<p>与检查定时器的线程类似，异步执行器中也有一个用于“获取”新的异步作业的线程。这里的异步作业，指的是表中存储但未被锁定的作业。这个线程会将这些作业锁定给当前Flowable引擎，并发送至异步执行器。</p>
</div>
<div class="paragraph">
<p>用于执行作业的线程池从一个内存队列中获取作业。当队列满了时（可配置），作业将会被解锁，并重新存回数据库。这样，其他的异步执行器就可以重新操作它们。</p>
</div>
<div class="paragraph">
<p>如果在执行作业期间发生了异常，这个异步作业将会转化为一个定时器作业，并带有一个到期日期。之后，它将会像普通定时器作业一样被获取，并重新变回异步作业，以实现重试。当一个作业已经重试了（可配置）几次，仍然失败，则作业被视为“死亡(dead)”，并被移至ACT_RU_DEADLETTER_JOB表。“死信(deadletter)”的概念在各种其他系统中也广泛使用。管理员需要检查失败作业的异常信息，并进行相应操作。</p>
</div>
<div class="paragraph">
<p>流程定义与流程实例都可以被暂停。这些定义或实例所关联的暂停作业，将被移至ACT_RU_SUSPENDED_JOB表，以确保用于获取作业的查询语句中的where条件尽量少。</p>
</div>
<div class="paragraph">
<p>综上所述：对于熟悉作业/异步执行器的旧实现的人来说，主要目标是让查询尽可能简单。在过去（V6以前），所有作业类型/状态使用一张表。为了满足所有使用场景，导致“where”条件十分庞大。现在已经解决了这个问题，我们的跑分也证明这个新设计带来了更好的性能，也更有弹性。</p>
</div>
</div>
<div class="sect4">
<h5 id="_async_executor_configuration">配置异步执行器</h5>
<div class="paragraph">
<p>异步执行器是一个高度可配置的组件。建议先查看异步执行器的默认配置，检查它们是否符合你的流程的要求。</p>
</div>
<div class="paragraph">
<p>另外，也可以扩展默认的实现，或者替换为你自己实现的<em>org.flowable.engine.impl.asyncexecutor.AsyncExecutor</em>接口。</p>
</div>
<div class="paragraph">
<p>可以在流程引擎配置中使用setter设置下列参数：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. 异步执行器配置选项</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorThreadPoolQueueSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在获取待执行的作业之后，线程池中某个线程实际执行作业之前，放置这些作业的队列的长度。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorCorePoolSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于执行作业的线程池中，最小的活动(kept alive)线程数量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorMaxPoolSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于执行作业的线程池中，创建线程的最大数量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorThreadKeepAliveTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在销毁执行作业所用的线程前，需要保持活动的时间（以毫秒计）。设置为&gt;0的值会消耗资源，但在有大量执行作业的时候，可以避免总是创建新线程。如果设置为0，则线程会在执行完作业后立刻被销毁。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorNumberOfRetries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">作业被移入“死信”表之前的最大重试次数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorMaxTimerJobsPerAcquisition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在一次获取定时器作业的查询中，获取作业的数量。默认值为1，因为这样可以降低潜在的乐观锁异常情况。较大的数值性能较好，但在不同的引擎间发生乐观锁异常的几率也会变大。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorMaxAsyncJobsDuePerAcquisition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在一次获取异步作业的查询中，获取作业的数量。默认值为1，因为这样可以降低潜在的乐观锁异常情况。较大的数值性能较好，但在不同的引擎间发生乐观锁异常的几率也会变大。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorDefaultTimerJobAcquireWaitTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">获取定时器作业的线程在两次获取作业的查询之间等待的时间（以毫秒记）。只在上一次查询未找到新的定时器作业，或者获取的作业数量少于<em>asyncExecutorMaxTimerJobsPerAcquisition</em>中设置的值时才会等待。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorDefaultAsyncJobAcquireWaitTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">获取异步作业的线程在两次获取作业的查询之间等待的时间（以毫秒记）。只在上一次查询未找到新的异步作业，或者获取的作业数量少于<em>asyncExecutorMaxAsyncJobsDuePerAcquisition</em>中设置的值时才会等待。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorDefaultQueueSizeFullWaitTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在内部作业队列已满之后，执行下一次查询之前，获取作业（包括定时器作业及异步作业）的线程将等待的时间（以毫秒记）。默认值为0（为保证向后兼容性）。设置为较大的值，可以让异步执行器有机会多执行掉一些队列作业，腾出队列空间。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorTimerLockTimeInMillis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5分钟</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">异步执行器获取定时器作业之后锁定的时间（以毫秒记）。在这段时间内，其它异步执行器不会尝试获取或锁定这个作业。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorAsyncJobLockTimeInMillis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5分钟</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">异步执行器获取异步作业之后锁定的时间（以毫秒记）。在这段时间内，其它异步执行器不会尝试获取或锁定这个作业。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorSecondsToWaitOnShutdown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当请求关闭执行器（或流程引擎）后，等待执行作业的线程池安全关闭的时间（以秒记）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorResetExpiredJobsInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60秒</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在两次<em>超时作业（expired job）</em>检查之间等待的时间（以毫秒记）。超时作业指的是已经锁定（某个执行器已经为其写入了锁持有人以及超时时间），但一直没有完成的作业。在检查中，会解锁超时作业，即移除其锁持有人以及超时时间。这样其他执行器就可以重新获取它。作业的锁超时时间在当前时间之前则视作超时。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorResetExpiredJobsPageSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">异步执行器的<em>超时重置（reset expired）</em>检查线程一次获取的作业数量。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_message_queue_based_async_executor">基于消息队列的异步执行器</h5>
<div class="paragraph">
<p>阅读<a href="#async_executor_design">异步执行器的设计</a>章节之后，很明显架构的灵感来自消息队列。异步执行器设计思路保证了可以很轻松地用消息队列代替线程池的工作，处理异步作业。</p>
</div>
<div class="paragraph">
<p>跑分显示，相比基于线程池的异步执行器，消息队列性能出众，吞吐量大。但需要额外的中间件，当然也就增加了安装配置、维护及监控的复杂度。对于多数用户来说，基于线程池的异步执行器性能已经足够用了。但能够知道在性能要求增长之后，仍有改进方案，也是挺好的。</p>
</div>
<div class="paragraph">
<p>目前，唯一直接可用的是带有JMS的Spring。选择首先支持Spring的原因是，Spring提供了非常好的功能，解决了使用线程以及处理多个消息消费者造成的麻烦。但是其实集成也很简单，因此可以轻松改用任何其他消息队列实现或协议（Stomp、AMPQ等等）。我们欢迎用户反馈下一个应该支持什么消息队列。</p>
</div>
<div class="paragraph">
<p>使用消息队列后，当引擎创建新的异步作业时，会在消息队列中放入一条包含有作业标识的消息（处在一个事务提交监听器中，这样就可以确保该作业条目已经提交至数据库）。之后消息消费者可以获取作业标识，并获取及执行该作业。异步执行器不再创建线程池，而是会在另一个单独线程中插入及查询定时器。当定时器到时触发时，将会被移至异步作业表，同时向消息队列发送一条消息。消息队列也可能失败，所以<em>超时重置</em>线程会按照原逻辑处理。只不过不是<em>解锁</em>作业，而是重发消息。异步执行器不再轮询异步作业。</p>
</div>
<div class="paragraph">
<p>主要由两个类实现：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>org.flowable.engine.impl.asyncexecutor.JobManager</em>接口的实现，将消息发送至消息队列而不是线程池。</p>
</li>
<li>
<p><em>javax.jms.MessageListener</em>接口的实现。从消息队列中消费消息，并使用消息中的作业标识获取及执行该作业。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>首先添加<em>flowable-jms-spring-executor</em>依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.flowable<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>flowable-jms-spring-executor<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>${flowable.version}<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在流程引擎配置中进行如下设置启用基于消息队列的异步执行器：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>asyncExecutorActivate</em>为<em>true</em></p>
</li>
<li>
<p><em>asyncExecutorMessageQueueMode</em>为<em>true</em></p>
</li>
<li>
<p><em>org.flowable.spring.executor.jms.MessageBasedJobManager</em>注入为<em>JobManager</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>下面是一个基于Java配置的完整例子，使用<em>ActiveMQ</em>作为消息中间件。</p>
</div>
<div class="paragraph">
<p>请注意：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>需要为<em>MessageBasedJobManager</em>注入一个配置了正确的<em>connectionFactory</em>的<em>JMSTemplate</em>。</p>
</li>
<li>
<p>我们使用Spring的<em>MessageListenerContainer</em>，因为它大幅简化了线程与多消费者的使用。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74</div></td><td class="code"><span></span><span class="tok-nd">@Configuration</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SpringJmsConfig</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Bean</span>
  <span class="tok-kd">public</span> <span class="tok-n">DataSource</span> <span class="tok-nf">dataSource</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-c1">// 略</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Bean</span><span class="tok-o">(</span><span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-s">&quot;transactionManager&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">PlatformTransactionManager</span> <span class="tok-nf">transactionManager</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">DataSourceTransactionManager</span> <span class="tok-n">transactionManager</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">DataSourceTransactionManager</span><span class="tok-o">();</span>
    <span class="tok-n">transactionManager</span><span class="tok-o">.</span><span class="tok-na">setDataSource</span><span class="tok-o">(</span><span class="tok-n">dataSource</span><span class="tok-o">());</span>
    <span class="tok-k">return</span> <span class="tok-n">transactionManager</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Bean</span>
  <span class="tok-kd">public</span> <span class="tok-n">SpringProcessEngineConfiguration</span> <span class="tok-nf">processEngineConfiguration</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">SpringProcessEngineConfiguration</span> <span class="tok-n">configuration</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">SpringProcessEngineConfiguration</span><span class="tok-o">();</span>
    <span class="tok-n">configuration</span><span class="tok-o">.</span><span class="tok-na">setDataSource</span><span class="tok-o">(</span><span class="tok-n">dataSource</span><span class="tok-o">());</span>
    <span class="tok-n">configuration</span><span class="tok-o">.</span><span class="tok-na">setTransactionManager</span><span class="tok-o">(</span><span class="tok-n">transactionManager</span><span class="tok-o">());</span>
    <span class="tok-n">configuration</span><span class="tok-o">.</span><span class="tok-na">setDatabaseSchemaUpdate</span><span class="tok-o">(</span><span class="tok-n">SpringProcessEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">DB_SCHEMA_UPDATE_TRUE</span><span class="tok-o">);</span>
    <span class="tok-n">configuration</span><span class="tok-o">.</span><span class="tok-na">setAsyncExecutorMessageQueueMode</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
    <span class="tok-n">configuration</span><span class="tok-o">.</span><span class="tok-na">setAsyncExecutorActivate</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
    <span class="tok-n">configuration</span><span class="tok-o">.</span><span class="tok-na">setJobManager</span><span class="tok-o">(</span><span class="tok-n">jobManager</span><span class="tok-o">());</span>
    <span class="tok-k">return</span> <span class="tok-n">configuration</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Bean</span>
  <span class="tok-kd">public</span> <span class="tok-n">ProcessEngine</span> <span class="tok-nf">processEngine</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">processEngineConfiguration</span><span class="tok-o">().</span><span class="tok-na">buildProcessEngine</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Bean</span>
  <span class="tok-kd">public</span> <span class="tok-n">MessageBasedJobManager</span> <span class="tok-nf">jobManager</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">MessageBasedJobManager</span> <span class="tok-n">jobManager</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">MessageBasedJobManager</span><span class="tok-o">();</span>
    <span class="tok-n">jobManager</span><span class="tok-o">.</span><span class="tok-na">setJmsTemplate</span><span class="tok-o">(</span><span class="tok-n">jmsTemplate</span><span class="tok-o">());</span>
    <span class="tok-k">return</span> <span class="tok-n">jobManager</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Bean</span>
  <span class="tok-kd">public</span> <span class="tok-n">ConnectionFactory</span> <span class="tok-nf">connectionFactory</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-n">ActiveMQConnectionFactory</span> <span class="tok-n">activeMQConnectionFactory</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ActiveMQConnectionFactory</span><span class="tok-o">(</span><span class="tok-s">&quot;tcp://localhost:61616&quot;</span><span class="tok-o">);</span>
      <span class="tok-n">activeMQConnectionFactory</span><span class="tok-o">.</span><span class="tok-na">setUseAsyncSend</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
      <span class="tok-n">activeMQConnectionFactory</span><span class="tok-o">.</span><span class="tok-na">setAlwaysSessionAsync</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
      <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-n">CachingConnectionFactory</span><span class="tok-o">(</span><span class="tok-n">activeMQConnectionFactory</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Bean</span>
  <span class="tok-kd">public</span> <span class="tok-n">JmsTemplate</span> <span class="tok-nf">jmsTemplate</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-n">JmsTemplate</span> <span class="tok-n">jmsTemplate</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JmsTemplate</span><span class="tok-o">();</span>
      <span class="tok-n">jmsTemplate</span><span class="tok-o">.</span><span class="tok-na">setDefaultDestination</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">ActiveMQQueue</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable-jobs&quot;</span><span class="tok-o">));</span>
      <span class="tok-n">jmsTemplate</span><span class="tok-o">.</span><span class="tok-na">setConnectionFactory</span><span class="tok-o">(</span><span class="tok-n">connectionFactory</span><span class="tok-o">());</span>
      <span class="tok-k">return</span> <span class="tok-n">jmsTemplate</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Bean</span>
  <span class="tok-kd">public</span> <span class="tok-n">MessageListenerContainer</span> <span class="tok-nf">messageListenerContainer</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-n">DefaultMessageListenerContainer</span> <span class="tok-n">messageListenerContainer</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">DefaultMessageListenerContainer</span><span class="tok-o">();</span>
      <span class="tok-n">messageListenerContainer</span><span class="tok-o">.</span><span class="tok-na">setConnectionFactory</span><span class="tok-o">(</span><span class="tok-n">connectionFactory</span><span class="tok-o">());</span>
      <span class="tok-n">messageListenerContainer</span><span class="tok-o">.</span><span class="tok-na">setDestinationName</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable-jobs&quot;</span><span class="tok-o">);</span>
      <span class="tok-n">messageListenerContainer</span><span class="tok-o">.</span><span class="tok-na">setMessageListener</span><span class="tok-o">(</span><span class="tok-n">jobMessageListener</span><span class="tok-o">());</span>
      <span class="tok-n">messageListenerContainer</span><span class="tok-o">.</span><span class="tok-na">setConcurrentConsumers</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">);</span>
      <span class="tok-n">messageListenerContainer</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
      <span class="tok-k">return</span> <span class="tok-n">messageListenerContainer</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Bean</span>
  <span class="tok-kd">public</span> <span class="tok-n">JobMessageListener</span> <span class="tok-nf">jobMessageListener</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">JobMessageListener</span> <span class="tok-n">jobMessageListener</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JobMessageListener</span><span class="tok-o">();</span>
    <span class="tok-n">jobMessageListener</span><span class="tok-o">.</span><span class="tok-na">setProcessEngineConfiguration</span><span class="tok-o">(</span><span class="tok-n">processEngineConfiguration</span><span class="tok-o">());</span>
    <span class="tok-k">return</span> <span class="tok-n">jobMessageListener</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的代码中，<em>flowable-jms-spring-executor</em>模块提供的只有<em>JobMessageListener</em>与<em>MessageBasedJobManager</em>两个类。其他的所有代码都来自Spring。因此，如果想要替换为其他的队列/协议，就需要替换这些类。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="advanced_parseHandlers">3.9.2. 深入流程解析</h4>
<div class="paragraph">
<p>BPMN 2.0 XML需要解析为Flowable的内部模型，才能在Flowable引擎中执行。部署流程时，或是在内存中找不到流程时，会从数据库中读取XML并进行解析。</p>
</div>
<div class="paragraph">
<p><code>BpmnParser</code>类会为每个流程创建一个<code>BpmnParser</code>实例，作为解析过程的容器。解析本身很简单：引擎对于每一个BPMN 2.0元素都有一个对应的<code>org.flowable.engine.parse.BpmnParseHandler</code>的实例，解析器将BPMN 2.0元素类映射至<code>BpmnParseHandler</code>实例。默认情况下，Flowable使用<code>BpmnParseHandler</code>实例处理所有支持的元素，并为流程的步骤附加执行监听器，以创建历史。</p>
</div>
<div class="paragraph">
<p>可以在Flowable引擎中添加<code>org.flowable.engine.parse.BpmnParseHandler</code>的自定义实例。比如常见使用场景是，为特定步骤添加执行监听器，向某个事件处理队列发送事件。Flowable处理历史就使用的是这种方式。要添加这种自定义处理器，需要调整Flowable配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;preBpmnParseHandlers&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;list&gt;</span>
    <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.parsing.MyFirstBpmnParseHandler&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/list&gt;</span>
<span class="tok-nt">&lt;/property&gt;</span>

<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;postBpmnParseHandlers&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;list&gt;</span>
    <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.parsing.MySecondBpmnParseHandler&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.parsing.MyThirdBpmnParseHandler&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/list&gt;</span>
<span class="tok-nt">&lt;/property&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在<code>preBpmnParseHandlers</code>参数中配置的<code>BpmnParseHandler</code>实例将添加在默认处理器之前。类似的，<code>postBpmnParseHandlers</code>中实例将添加在默认处理器之后。有时顺序会影响自定义解析处理器中包含的逻辑，需要特别注意。</p>
</div>
<div class="paragraph">
<p><code>org.flowable.engine.parse.BpmnParseHandler</code>是一个简单的接口：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">BpmnParseHandler</span> <span class="tok-o">{</span>

  <span class="tok-n">Collection</span><span class="tok-o">&lt;</span><span class="tok-n">Class</span><span class="tok-o">&gt;?</span> <span class="tok-kd">extends</span> <span class="tok-n">BaseElement</span><span class="tok-o">&gt;&gt;</span> <span class="tok-nf">getHandledTypes</span><span class="tok-o">();</span>

  <span class="tok-kt">void</span> <span class="tok-nf">parse</span><span class="tok-o">(</span><span class="tok-n">BpmnParse</span> <span class="tok-n">bpmnParse</span><span class="tok-o">,</span> <span class="tok-n">BaseElement</span> <span class="tok-n">element</span><span class="tok-o">);</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getHandledTypes()</code>方法返回该解析器处理的所有类型的集合。集合的泛型提示，可用的类型是<code>BaseElement</code>的子类。也可以扩展<code>AbstractBpmnParseHandler</code>类，并覆盖<code>getHandledType()</code>方法，它只返回一个类而不是一个集合。这个类也包含了一些默认解析处理器通用的辅助方法。当解析器遇到匹配该方法的返回类型的元素时，将调用这个<code>BpmnParseHandler</code>实例进行解析。在下面的例子里，当遇到BPMN 2.0 XML中的流程元素时，就会执行其<code>executeParse</code>方法（这是一个类型转换方法，替代<code>BpmnParseHandler</code>接口中的普通<code>parse</code>方法）中的逻辑。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TestBPMNParseHandler</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractBpmnParseHandler</span><span class="tok-o">&lt;</span><span class="tok-n">Process</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>

  <span class="tok-kd">protected</span> <span class="tok-n">Class</span><span class="tok-o">&lt;?</span> <span class="tok-kd">extends</span> <span class="tok-n">BaseElement</span><span class="tok-o">&gt;</span> <span class="tok-nf">getHandledType</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">Process</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">executeParse</span><span class="tok-o">(</span><span class="tok-n">BpmnParse</span> <span class="tok-n">bpmnParse</span><span class="tok-o">,</span> <span class="tok-n">Process</span> <span class="tok-n">element</span><span class="tok-o">)</span> <span class="tok-o">{</span>
     <span class="tok-o">..</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>重要提示：</strong>在实现自定义解析处理器时，不要使用任何用于解析BPMN 2.0结构的内部类。否则会很难查找bug。安全的做法是实现<em>BpmnParseHandler</em>接口，或扩展内部抽象类<em>org.flowable.engine.impl.bpmn.parser.handler.AbstractBpmnParseHandler</em>。</p>
</div>
<div class="paragraph">
<p>可以（但不常用）替换默认用于将BPMN 2.0元素解析为Flowable内部模型的<code>BpmnParseHandler</code>实例。可以通过下面的代码片段实现：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;customDefaultBpmnParseHandlers&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;list&gt;</span>
    ...
  <span class="tok-nt">&lt;/list&gt;</span>
<span class="tok-nt">&lt;/property&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>简单的例子，强制所有服务任务都异步执行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CustomUserTaskBpmnParseHandler</span> <span class="tok-kd">extends</span> <span class="tok-n">ServiceTaskParseHandler</span> <span class="tok-o">{</span>

  <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">executeParse</span><span class="tok-o">(</span><span class="tok-n">BpmnParse</span> <span class="tok-n">bpmnParse</span><span class="tok-o">,</span> <span class="tok-n">ServiceTask</span> <span class="tok-n">serviceTask</span><span class="tok-o">)</span> <span class="tok-o">{</span>

    <span class="tok-c1">// 进行常规操作</span>
    <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">executeParse</span><span class="tok-o">(</span><span class="tok-n">bpmnParse</span><span class="tok-o">,</span> <span class="tok-n">serviceTask</span><span class="tok-o">);</span>

    <span class="tok-c1">// 保证异步执行</span>
    <span class="tok-n">serviceTask</span><span class="tok-o">.</span><span class="tok-na">setAsynchronous</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="advanced.uuid.generator">3.9.3. 高并发下使用的UUID ID生成器</h4>
<div class="paragraph">
<p>在某些（非常）高并发负载的情况下，默认的ID生成器可能会由于不能足够快地获取新的id块而产生异常。每个流程引擎都有一个ID生成器。默认的ID生成器会在数据库中保存一块ID，这样其他引擎就不能使用同一个块中的ID。引擎运行时，当ID生成器发现ID块已经用完，就会启动一个新的事务，来获取一个新的块。在（非常）有限的使用场景下，当负载非常高时可能导致问题。对于大多数用例来说，默认的ID生成器已经足够使用了。默认的<code>org.flowable.engine.impl.db.DbIdGenerator</code>也有一个<code>idBlockSize</code>参数，用于配置保留的ID块的大小，调整获取ID的行为。</p>
</div>
<div class="paragraph">
<p>可以使用<code>org.flowable.engine.impl.persistence.StrongUuidGenerator</code>替换默认的ID生成器。它会在本地生成唯一的<a href="http://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a>，并将其用于所有实体的标识符。因为UUID不需要访问数据库就能生成，因此在非常高并发的使用场景下更合适。请注意取决于机器，性能可能与默认的ID生成器不同（更好更坏都有可能）。</p>
</div>
<div class="paragraph">
<p>可以在flowable配置中，像下面这样配置UUID生成器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;idGenerator&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.persistence.StrongUuidGenerator&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/property&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>使用UUID id生成器需要添加下列额外依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span> <span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>com.fasterxml.uuid<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>java-uuid-generator<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>3.1.3<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="advanced.tenancy">3.9.4. 多租户</h4>
<div class="paragraph">
<p>总的来说，多租户是指一个软件为多个不同组织提供服务。其核心是数据隔离，一个组织不能看到其他组织的数据。在这个语境中，一个这样的组织（或部门、团队，等等）被称为一个<em>租户（tenant）</em>。</p>
</div>
<div class="paragraph">
<p>请注意它与多实例部署有本质区别。多实例部署是指每一个组织都分别运行一个Flowable流程引擎实例（且使用不同的数据库账户）。尽管Flowable比较轻量级，运行一个流程引擎实例不会花费太多资源，但多实例部署仍然增加了复杂度与维护量。但是，在某些使用场景中，多实例部署可能是正确的解决方案。</p>
</div>
<div class="paragraph">
<p>Flowable中的多租户主要围绕着隔离数据实现。要注意<em>Flowable并不强制多租户规则</em>。换句话说，查询与使用数据时，不会验证进行操作的用户是否属于正确的租户。这应该在调用Flowable引擎的层次实现。Flowable负责确保可以存储租户信息，并可在获取流程数据时使用。</p>
</div>
<div class="paragraph">
<p>在Flowable流程引擎中部署流程定义时，可以传递一个<em>租户标识符（tenant identifier）</em>。这是一个字符串（可以是UUID，部门id，等等……），限制为256个字符长，唯一标识一个租户：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
            <span class="tok-o">.</span><span class="tok-na">addClassPathResource</span><span class="tok-o">(...)</span>
            <span class="tok-o">.</span><span class="tok-na">tenantId</span><span class="tok-o">(</span><span class="tok-s">&quot;myTenantId&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在部署时传入一个租户ID意味着：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>部署中包含的所有流程定义都将从该部署继承租户标识符。</p>
</li>
<li>
<p>从这些流程定义启动的所有流程实例都将从流程定义继承租户标识符。</p>
</li>
<li>
<p>在执行流程实例时，创建所有任务都将从流程实例继承租户标识符。独立任务也可以有租户标识符。</p>
</li>
<li>
<p>执行流程实例时，创建的所有执行都将从流程实例继承租户标识符。</p>
</li>
<li>
<p>（在流程内或通过API）触发信号抛出事件时可以提供租户标识符。这个信号将只在该租户的上下文中执行。也就是说，如果有多个使用相同名字的信号捕获事件，只会触发带有正确租户标识符的捕获事件。</p>
</li>
<li>
<p>所有作业（定时器与异步操作）要么从流程定义（如定时器启动事件），要么从流程实例（运行时创建的作业，如异步操作）继承租户标识符。这样就可以在自定义作业执行器中，为租户设置优先级。</p>
</li>
<li>
<p>所有历史实体（历史流程实例、任务与活动）都从其对应的运行时对象继承租户标识符。</p>
</li>
<li>
<p>另外，模型也可以有租户标识符（模型用于Flowable Modeler存储BPMN 2.0）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>所有查询API都可以通过租户标识符进行过滤。例如（也可以换成其他实体的查询）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createProcessInstanceQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">processInstanceTenantId</span><span class="tok-o">(</span><span class="tok-s">&quot;myTenantId&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">processDefinitionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;myProcessDefinitionKey&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">variableValueEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;myVar&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;someValue&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">()</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>查询API也可以使用<em>like</em>语义通过租户标识符过滤，也可以过滤掉没有租户标识符的实体。</p>
</div>
<div class="paragraph">
<p><strong>重要的实现细节：</strong>由于数据库的原因（更确切地说，对唯一约束中null的处理），<em>默认的</em>代表<em>没有租户</em>的租户标识符为<strong>空字符串</strong>。这是因为（流程定义key，流程定义版本，租户标识符）的组合需要是唯一的（由数据库约束保证）。也请注意租户标识符不能设置为null，不然会影响查询，因为某些数据库（Oracle）会将空字符串当做null值处理（这也就是为什么<em>.withoutTenantId</em>查询不检查空字符串还是null）。所以可以为多个租户部署（有相同的流程定义key的）同一个流程定义，并且每一个租户都有他们自己的版本。不影响未使用租户时的使用方式。</p>
</div>
<div class="paragraph">
<p><strong>请注意，集群运行多个Flowable实例与上面所说不冲突。</strong></p>
</div>
<div class="paragraph">
<p>[实验性] 可以调用<em>repositoryService</em>的<em>changeDeploymentTenantId(String deploymentId, String newTenantId)</em>方法修改租户标识符。并将连带修改每一处之前继承的租户标识符。在从非多租户环境迁移至多租户部署时很有用。查看该方法的Javadoc了解更多信息。</p>
</div>
</div>
<div class="sect3">
<h4 id="advanced.custom.sql.queries">3.9.5. 执行自定义SQL</h4>
<div class="paragraph">
<p>Flowable提供了与数据库交互的高级API。例如，要获取数据，查询API与原生（Native）查询API各有用武之地。但有时会需要更高的灵活性。下面介绍如何在Flowable流程引擎范围内（所以可以使用相同的事务设置等）的数据存储中，执行完全自定义的SQL语句（select、insert、update与delete都可以）。</p>
</div>
<div class="paragraph">
<p>Flowable引擎使用其底层框架MyBatis的功能自定义SQL语句。可以在<a href="http://mybatis.github.io/mybatis-3/java-api.html">MyBatis用户手册</a>找到更多信息。</p>
</div>
<div class="sect4">
<h5 id="_annotation_based_mapped_statements">基于注解的映射语句</h5>
<div class="paragraph">
<p>使用基于注解的映射语句（Annotation based Mapped Statement）时，首先要做的是创建一个MyBatis映射类。例如，假设在某个用例中，不需要完整的任务数据，而只需要其中很少一部分，就可以通过映射类（Mapper）完成，像是这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">MyTestMapper</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Select</span><span class="tok-o">(</span><span class="tok-s">&quot;SELECT ID_ as id, NAME_ as name, CREATE_TIME_ as createTime FROM ACT_RU_TASK&quot;</span><span class="tok-o">)</span>
    <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;&gt;</span> <span class="tok-nf">selectTasks</span><span class="tok-o">();</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>必须像下面这样为流程引擎配置映射类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span>...
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;customMybatisMappers&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;set&gt;</span>
    <span class="tok-nt">&lt;value&gt;</span>org.flowable.standalone.cfg.MyTestMapper<span class="tok-nt">&lt;/value&gt;</span>
  <span class="tok-nt">&lt;/set&gt;</span>
<span class="tok-nt">&lt;/property&gt;</span>
...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意这是一个接口。底层的MyBatis框架会构造一个它的实例，并在运行时使用。也请注意方法的返回值没有类型，而只是一个map的list（代表了带有列数据的行的列表）。如果需要，可以通过MyBatis映射类设置类型。</p>
</div>
<div class="paragraph">
<p>使用<em>managementService.executeCustomSql</em>方法执行上面的查询。这个方法使用<em>CustomSqlExecution</em>的实例作为包装器，将引擎需要处理的内部数据隐藏起来。</p>
</div>
<div class="paragraph">
<p>不幸的是，Java泛型降低了可读性。下面的两个泛型类是映射类与其返回类型类。只是简单的调用映射方法，并返回其结果（若有）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-n">CustomSqlExecution</span><span class="tok-o">&lt;</span><span class="tok-n">MyTestMapper</span><span class="tok-o">,</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;&gt;&gt;</span> <span class="tok-n">customSqlExecution</span> <span class="tok-o">=</span>
          <span class="tok-k">new</span> <span class="tok-n">AbstractCustomSqlExecution</span><span class="tok-o">&lt;</span><span class="tok-n">MyTestMapper</span><span class="tok-o">,</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;&gt;&gt;(</span><span class="tok-n">MyTestMapper</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;&gt;</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">MyTestMapper</span> <span class="tok-n">customMapper</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">customMapper</span><span class="tok-o">.</span><span class="tok-na">selectTasks</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>

<span class="tok-o">};</span>

<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;&gt;</span> <span class="tok-n">results</span> <span class="tok-o">=</span> <span class="tok-n">managementService</span><span class="tok-o">.</span><span class="tok-na">executeCustomSql</span><span class="tok-o">(</span><span class="tok-n">customSqlExecution</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子里，上面列出的Map只包含<em>id, name与创建时间</em>，而不是完整的任务对象。</p>
</div>
<div class="paragraph">
<p>按照上面的方法可以使用任何SQL。另一个更复杂的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span>    <span class="tok-nd">@Select</span><span class="tok-o">({</span>
        <span class="tok-s">&quot;SELECT task.ID_ as taskId, variable.LONG_ as variableValue FROM ACT_RU_VARIABLE variable&quot;</span><span class="tok-o">,</span>
        <span class="tok-s">&quot;inner join ACT_RU_TASK task on variable.TASK_ID_ = task.ID_&quot;</span><span class="tok-o">,</span>
        <span class="tok-s">&quot;where variable.NAME_ = #{variableName}&quot;</span>
    <span class="tok-o">})</span>
    <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;&gt;</span> <span class="tok-nf">selectTaskWithSpecificVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>任务表join变量表，只选择变量有特定名字的记录，并返回任务id与对应的数字值。</p>
</div>
<div class="paragraph">
<p>请参考单元测试<em>org.flowable.standalone.cfg.CustomMybatisMapperTest</em>及src/test/java/org/flowable/standalone/cfg/与src/test/resources/org/flowable/standalone/cfg/目录中的其它类与资源，了解基于注解的映射语句的更多使用例子。</p>
</div>
</div>
<div class="sect4">
<h5 id="_xml_based_mapped_statements">基于XML的映射语句</h5>
<div class="paragraph">
<p>可以使用基于XML的映射语句（XML based Mapped Statement），在XML文件中定义语句。对于不需要完整的任务数据，而只需要其中很少一部分数据的用例，XML文件像是下面这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-nt">&lt;mapper</span> <span class="tok-na">namespace=</span><span class="tok-s">&quot;org.flowable.standalone.cfg.TaskMapper&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;resultMap</span> <span class="tok-na">id=</span><span class="tok-s">&quot;customTaskResultMap&quot;</span> <span class="tok-na">type=</span><span class="tok-s">&quot;org.flowable.standalone.cfg.CustomTask&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;id</span> <span class="tok-na">property=</span><span class="tok-s">&quot;id&quot;</span> <span class="tok-na">column=</span><span class="tok-s">&quot;ID_&quot;</span> <span class="tok-na">jdbcType=</span><span class="tok-s">&quot;VARCHAR&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;result</span> <span class="tok-na">property=</span><span class="tok-s">&quot;name&quot;</span> <span class="tok-na">column=</span><span class="tok-s">&quot;NAME_&quot;</span> <span class="tok-na">jdbcType=</span><span class="tok-s">&quot;VARCHAR&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;result</span> <span class="tok-na">property=</span><span class="tok-s">&quot;createTime&quot;</span> <span class="tok-na">column=</span><span class="tok-s">&quot;CREATE_TIME_&quot;</span> <span class="tok-na">jdbcType=</span><span class="tok-s">&quot;TIMESTAMP&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/resultMap&gt;</span>

  <span class="tok-nt">&lt;select</span> <span class="tok-na">id=</span><span class="tok-s">&quot;selectCustomTaskList&quot;</span> <span class="tok-na">resultMap=</span><span class="tok-s">&quot;customTaskResultMap&quot;</span><span class="tok-nt">&gt;</span>
    select RES.ID_, RES.NAME_, RES.CREATE_TIME_ from ACT_RU_TASK RES
  <span class="tok-nt">&lt;/select&gt;</span>

<span class="tok-nt">&lt;/mapper&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>结果映射为如下的<em>org.flowable.standalone.cfg.CustomTask</em>类的实例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CustomTask</span> <span class="tok-o">{</span>

  <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">;</span>
  <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>
  <span class="tok-kd">protected</span> <span class="tok-n">Date</span> <span class="tok-n">createTime</span><span class="tok-o">;</span>

  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getId</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">id</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getName</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">name</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
  <span class="tok-kd">public</span> <span class="tok-n">Date</span> <span class="tok-nf">getCreateTime</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">createTime</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>必须像下面这样为流程引擎配置提供映射XML文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span>...
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;customMybatisXMLMappers&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;set&gt;</span>
    <span class="tok-nt">&lt;value&gt;</span>org/flowable/standalone/cfg/custom-mappers/CustomTaskMapper.xml<span class="tok-nt">&lt;/value&gt;</span>
  <span class="tok-nt">&lt;/set&gt;</span>
<span class="tok-nt">&lt;/property&gt;</span>
...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样执行语句：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">CustomTask</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">managementService</span><span class="tok-o">.</span><span class="tok-na">executeCommand</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Command</span><span class="tok-o">&lt;</span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">CustomTask</span><span class="tok-o">&gt;&gt;()</span> <span class="tok-o">{</span>

      <span class="tok-nd">@SuppressWarnings</span><span class="tok-o">(</span><span class="tok-s">&quot;unchecked&quot;</span><span class="tok-o">)</span>
      <span class="tok-nd">@Override</span>
      <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">CustomTask</span><span class="tok-o">&gt;</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">CommandContext</span> <span class="tok-n">commandContext</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-o">(</span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">CustomTask</span><span class="tok-o">&gt;)</span> <span class="tok-n">commandContext</span><span class="tok-o">.</span><span class="tok-na">getDbSqlSession</span><span class="tok-o">().</span><span class="tok-na">selectList</span><span class="tok-o">(</span><span class="tok-s">&quot;selectCustomTaskList&quot;</span><span class="tok-o">);</span>
      <span class="tok-o">}</span>
    <span class="tok-o">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>XML映射语句在需要更复杂语句的时候很好用。Flowable内部就使用XML映射语句，所以能使用底层功能。</p>
</div>
<div class="paragraph">
<p>假设某个用例下，需要基于id、name、type、userId等字段，查询附件数据。要实现这个用例，可以创建下面这样的扩展了<em>org.flowable.engine.impl.AbstractQuery</em>的查询类<em>AttachmentQuery</em>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AttachmentQuery</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractQuery</span><span class="tok-o">&lt;</span><span class="tok-n">AttachmentQuery</span><span class="tok-o">,</span> <span class="tok-n">Attachment</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>

  <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">attachmentId</span><span class="tok-o">;</span>
  <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">attachmentName</span><span class="tok-o">;</span>
  <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">attachmentType</span><span class="tok-o">;</span>
  <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">userId</span><span class="tok-o">;</span>

  <span class="tok-kd">public</span> <span class="tok-nf">AttachmentQuery</span><span class="tok-o">(</span><span class="tok-n">ManagementService</span> <span class="tok-n">managementService</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">managementService</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-n">AttachmentQuery</span> <span class="tok-nf">attachmentId</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">attachmentId</span><span class="tok-o">){</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">attachmentId</span> <span class="tok-o">=</span> <span class="tok-n">attachmentId</span><span class="tok-o">;</span>
    <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-n">AttachmentQuery</span> <span class="tok-nf">attachmentName</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">attachmentName</span><span class="tok-o">){</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">attachmentName</span> <span class="tok-o">=</span> <span class="tok-n">attachmentName</span><span class="tok-o">;</span>
    <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-n">AttachmentQuery</span> <span class="tok-nf">attachmentType</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">attachmentType</span><span class="tok-o">){</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">attachmentType</span> <span class="tok-o">=</span> <span class="tok-n">attachmentType</span><span class="tok-o">;</span>
    <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-n">AttachmentQuery</span> <span class="tok-nf">userId</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">userId</span><span class="tok-o">){</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">userId</span> <span class="tok-o">=</span> <span class="tok-n">userId</span><span class="tok-o">;</span>
    <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">long</span> <span class="tok-nf">executeCount</span><span class="tok-o">(</span><span class="tok-n">CommandContext</span> <span class="tok-n">commandContext</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-o">(</span><span class="tok-n">Long</span><span class="tok-o">)</span> <span class="tok-n">commandContext</span><span class="tok-o">.</span><span class="tok-na">getDbSqlSession</span><span class="tok-o">()</span>
                   <span class="tok-o">.</span><span class="tok-na">selectOne</span><span class="tok-o">(</span><span class="tok-s">&quot;selectAttachmentCountByQueryCriteria&quot;</span><span class="tok-o">,</span> <span class="tok-k">this</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Attachment</span><span class="tok-o">&gt;</span> <span class="tok-nf">executeList</span><span class="tok-o">(</span><span class="tok-n">CommandContext</span> <span class="tok-n">commandContext</span><span class="tok-o">,</span> <span class="tok-n">Page</span> <span class="tok-n">page</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">commandContext</span><span class="tok-o">.</span><span class="tok-na">getDbSqlSession</span><span class="tok-o">()</span>
            <span class="tok-o">.</span><span class="tok-na">selectList</span><span class="tok-o">(</span><span class="tok-s">&quot;selectAttachmentByQueryCriteria&quot;</span><span class="tok-o">,</span> <span class="tok-k">this</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意在扩展<em>AbstractQuery</em>时，子类需要为super构造函数传递一个<em>ManagementService</em>的实例，并需要实现<em>executeCount</em>与<em>executeList</em>来调用映射语句。</p>
</div>
<div class="paragraph">
<p>包含映射语句的XML文件如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</div></td><td class="code"><span></span><span class="tok-nt">&lt;mapper</span> <span class="tok-na">namespace=</span><span class="tok-s">&quot;org.flowable.standalone.cfg.AttachmentMapper&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;select</span> <span class="tok-na">id=</span><span class="tok-s">&quot;selectAttachmentCountByQueryCriteria&quot;</span> <span class="tok-na">parameterType=</span><span class="tok-s">&quot;org.flowable.standalone.cfg.AttachmentQuery&quot;</span> <span class="tok-na">resultType=</span><span class="tok-s">&quot;long&quot;</span><span class="tok-nt">&gt;</span>
    select count(distinct RES.ID_)
    <span class="tok-nt">&lt;include</span> <span class="tok-na">refid=</span><span class="tok-s">&quot;selectAttachmentByQueryCriteriaSql&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/select&gt;</span>

  <span class="tok-nt">&lt;select</span> <span class="tok-na">id=</span><span class="tok-s">&quot;selectAttachmentByQueryCriteria&quot;</span> <span class="tok-na">parameterType=</span><span class="tok-s">&quot;org.flowable.standalone.cfg.AttachmentQuery&quot;</span> <span class="tok-na">resultMap=</span><span class="tok-s">&quot;org.flowable.engine.impl.persistence.entity.AttachmentEntity.attachmentResultMap&quot;</span><span class="tok-nt">&gt;</span>
    ${limitBefore}
    select distinct RES.* ${limitBetween}
    <span class="tok-nt">&lt;include</span> <span class="tok-na">refid=</span><span class="tok-s">&quot;selectAttachmentByQueryCriteriaSql&quot;</span><span class="tok-nt">/&gt;</span>
    ${orderBy}
    ${limitAfter}
  <span class="tok-nt">&lt;/select&gt;</span>

  <span class="tok-nt">&lt;sql</span> <span class="tok-na">id=</span><span class="tok-s">&quot;selectAttachmentByQueryCriteriaSql&quot;</span><span class="tok-nt">&gt;</span>
  from ${prefix}ACT_HI_ATTACHMENT RES
  <span class="tok-nt">&lt;where&gt;</span>
   <span class="tok-nt">&lt;if</span> <span class="tok-na">test=</span><span class="tok-s">&quot;attachmentId != null&quot;</span><span class="tok-nt">&gt;</span>
     RES.ID_ = #{attachmentId}
   <span class="tok-nt">&lt;/if&gt;</span>
   <span class="tok-nt">&lt;if</span> <span class="tok-na">test=</span><span class="tok-s">&quot;attachmentName != null&quot;</span><span class="tok-nt">&gt;</span>
     and RES.NAME_ = #{attachmentName}
   <span class="tok-nt">&lt;/if&gt;</span>
   <span class="tok-nt">&lt;if</span> <span class="tok-na">test=</span><span class="tok-s">&quot;attachmentType != null&quot;</span><span class="tok-nt">&gt;</span>
     and RES.TYPE_ = #{attachmentType}
   <span class="tok-nt">&lt;/if&gt;</span>
   <span class="tok-nt">&lt;if</span> <span class="tok-na">test=</span><span class="tok-s">&quot;userId != null&quot;</span><span class="tok-nt">&gt;</span>
     and RES.USER_ID_ = #{userId}
   <span class="tok-nt">&lt;/if&gt;</span>
  <span class="tok-nt">&lt;/where&gt;</span>
  <span class="tok-nt">&lt;/sql&gt;</span>
<span class="tok-nt">&lt;/mapper&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以在语句中使用例如分页、排序、表名前缀等功能（因为parameterType为<em>AbstractQuery</em>的子类）。可以使用引擎定义的<em>org.flowable.engine.impl.persistence.entity.AttachmentEntity.attachmentResultMap</em>来映射结果。</p>
</div>
<div class="paragraph">
<p>最后，可以这样使用<em>AttachmentQuery</em>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-o">....</span>
<span class="tok-c1">// 获取附件的总数</span>
<span class="tok-kt">long</span> <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AttachmentQuery</span><span class="tok-o">(</span><span class="tok-n">managementService</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">();</span>

<span class="tok-c1">// 获取id为10025的附件</span>
<span class="tok-n">Attachment</span> <span class="tok-n">attachment</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AttachmentQuery</span><span class="tok-o">(</span><span class="tok-n">managementService</span><span class="tok-o">).</span><span class="tok-na">attachmentId</span><span class="tok-o">(</span><span class="tok-s">&quot;10025&quot;</span><span class="tok-o">).</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>

<span class="tok-c1">// 获取前10个附件</span>
<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Attachment</span><span class="tok-o">&gt;</span> <span class="tok-n">attachments</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AttachmentQuery</span><span class="tok-o">(</span><span class="tok-n">managementService</span><span class="tok-o">).</span><span class="tok-na">listPage</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">10</span><span class="tok-o">);</span>

<span class="tok-c1">// 获取用户kermit上传的所有附件</span>
<span class="tok-n">attachments</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AttachmentQuery</span><span class="tok-o">(</span><span class="tok-n">managementService</span><span class="tok-o">).</span><span class="tok-na">userId</span><span class="tok-o">(</span><span class="tok-s">&quot;kermit&quot;</span><span class="tok-o">).</span><span class="tok-na">list</span><span class="tok-o">();</span>
<span class="tok-o">....</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请参考单元测试<em>org.flowable.standalone.cfg.CustomMybatisXMLMapperTest</em>_及src/test/java/org/flowable/standalone/cfg/与src/test/resources/org/flowable/standalone/cfg/目录中的其它类与资源，了解基于XML的映射语句的更多使用例子。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="advanced.process.engine.configurators">3.9.6. 使用ProcessEngineConfigurator进行高级流程引擎配置</h4>
<div class="paragraph">
<p>深入控制流程引擎配置的高级方法是使用<em>ProcessEngineConfigurator</em>。创建一个<em>org.flowable.engine.cfg.ProcessEngineConfigurator</em>接口的实现，并将它注入到流程引擎配置中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;...SomeProcessEngineConfigurationClass&quot;</span><span class="tok-nt">&gt;</span>

    ...

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;configurators&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;list&gt;</span>
            <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;com.mycompany.MyConfigurator&quot;</span><span class="tok-nt">&gt;</span>
                ...
            <span class="tok-nt">&lt;/bean&gt;</span>
        <span class="tok-nt">&lt;/list&gt;</span>
    <span class="tok-nt">&lt;/property&gt;</span>

    ...

<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这个接口需要实现两个方法。<em>configure</em>方法，使用一个<em>ProcessEngineConfiguration</em>实例作为参数。可以使用这个方式添加自定义配置，并且这个方法会保证<strong>在流程引擎创建之前，所有默认配置已经完成之后</strong>被调用。另一个方法是<em>getPriority</em>方法，可以指定配置器的顺序，以备某些配置器对其他的有依赖。</p>
</div>
<div class="paragraph">
<p>这种配置器的一个例子是<a href="#chapter_ldap">集成LDAP</a>，使用配置器将默认的用户与组管理类替换为可以处理LDAP用户的实现。可见配置器可以相当大程度地改变及调整流程引擎，以适应非常高级的使用场景。另一个例子是使用自定义的缓存替换流程引擎缓存：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ProcessDefinitionCacheConfigurator</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractProcessEngineConfigurator</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">configure</span><span class="tok-o">(</span><span class="tok-n">ProcessEngineConfigurationImpl</span> <span class="tok-n">processEngineConfiguration</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">MyCache</span> <span class="tok-n">myCache</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">MyCache</span><span class="tok-o">();</span>
            <span class="tok-n">processEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">setProcessDefinitionCache</span><span class="tok-o">(</span><span class="tok-n">enterpriseProcessDefinitionCache</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用<a href="http://docs.oracle.com/javase/7/docs/api/java/util/ServiceLoader.html">ServiceLoader</a>的方法，从classpath中自动发现流程引擎配置器。也就是说必须将包含配置器实现的jar放在classpath下，并且jar的<em>META-INF/services</em>目录下需要有名为<strong>org.flowable.engine.cfg.ProcessEngineConfigurator</strong>的文件，内容是自定义实现的全限定类名。当流程引擎启动时，日志会提示找到这些配置器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO  org.flowable.engine.impl.cfg.ProcessEngineConfigurationImpl  - Found 1 auto-discoverable Process Engine Configurators
INFO  org.flowable.engine.impl.cfg.ProcessEngineConfigurationImpl  - Found 1 Process Engine Configurators in total:
INFO  org.flowable.engine.impl.cfg.ProcessEngineConfigurationImpl  - class org.flowable.MyCustomConfigurator</pre>
</div>
</div>
<div class="paragraph">
<p>请注意某些环境下可能不能使用ServiceLoader方法。可以通过ProcessEngineConfiguration的<em>enableConfiguratorServiceLoader</em>参数显式禁用（默认为true）。</p>
</div>
</div>
<div class="sect3">
<h4 id="advanced.task.query.switching">3.9.7. 高级查询API：在运行时与历史任务查询间无缝切换</h4>
<div class="paragraph">
<p>BPM用户界面的核心组件是任务列表。一般来说，最终用户执行待办任务，通过不同方式过滤收件箱中的任务。有时也需要在列表中显示历史任务，并进行类似的过滤。为了简化代码，<em>TaskQuery</em>与<em>HistoricTaskInstanceQuery</em>有共同的父接口，其中包含了所有公共操作（大多数操作都是公共的）。</p>
</div>
<div class="paragraph">
<p>这个公共接口是<em>org.flowable.engine.task.TaskInfoQuery</em>类。<em>org.flowable.engine.task.Task</em>与<em>org.flowable.engine.task.HistoricTaskInstance</em>都有公共父类<em>org.flowable.engine.task.TaskInfo</em>（并带有公共参数），作为<em>list()</em>等方法的返回值。然而，有时Java泛型会帮倒忙：如果想要直接使用<em>TaskInfoQuery</em>类型，将会像是这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">TaskInfoQuery</span><span class="tok-o">&lt;?</span> <span class="tok-kd">extends</span> <span class="tok-n">TaskInfoQuery</span><span class="tok-o">&lt;?,?&gt;,</span> <span class="tok-o">?</span> <span class="tok-kd">extends</span> <span class="tok-n">TaskInfo</span><span class="tok-o">&gt;</span> <span class="tok-n">taskInfoQuery</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>呃……好吧。为了“解决”这个问题，可以使用<em>org.flowable.engine.task.TaskInfoQueryWrapper</em>类来避免泛型（下面的代码来自REST的代码，将返回一个任务列表，且用户可以选择查看进行中还是已完成的任务）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-n">TaskInfoQueryWrapper</span> <span class="tok-n">taskInfoQueryWrapper</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">runtimeQuery</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-n">taskInfoQueryWrapper</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">TaskInfoQueryWrapper</span><span class="tok-o">(</span><span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">());</span>
<span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>
	<span class="tok-n">taskInfoQueryWrapper</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">TaskInfoQueryWrapper</span><span class="tok-o">(</span><span class="tok-n">historyService</span><span class="tok-o">.</span><span class="tok-na">createHistoricTaskInstanceQuery</span><span class="tok-o">());</span>
<span class="tok-o">}</span>

<span class="tok-n">List</span><span class="tok-o">&lt;?</span> <span class="tok-kd">extends</span> <span class="tok-n">TaskInfo</span><span class="tok-o">&gt;</span> <span class="tok-n">taskInfos</span> <span class="tok-o">=</span> <span class="tok-n">taskInfoQueryWrapper</span><span class="tok-o">.</span><span class="tok-na">getTaskInfoQuery</span><span class="tok-o">().</span><span class="tok-na">or</span><span class="tok-o">()</span>
	<span class="tok-o">.</span><span class="tok-na">taskNameLike</span><span class="tok-o">(</span><span class="tok-s">&quot;%k1%&quot;</span><span class="tok-o">)</span>
	<span class="tok-o">.</span><span class="tok-na">taskDueAfter</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">(</span><span class="tok-n">now</span><span class="tok-o">.</span><span class="tok-na">getTime</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-o">(</span><span class="tok-mi">3</span> <span class="tok-o">*</span> <span class="tok-mi">24L</span> <span class="tok-o">*</span> <span class="tok-mi">60L</span> <span class="tok-o">*</span> <span class="tok-mi">60L</span> <span class="tok-o">*</span> <span class="tok-mi">1000L</span><span class="tok-o">)))</span>
<span class="tok-o">.</span><span class="tok-na">endOr</span><span class="tok-o">()</span>
<span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="advanced.custom.session.manager">3.9.8. 通过覆盖标准SessionFactory自定义身份管理</h4>
<div class="paragraph">
<p>如果不想像<a href="#chapter_ldap">集成LDAP</a>中那样使用完整的<em>ProcessEngineConfigurator</em>实现，但仍然希望在框架中插入自定义的身份管理，也可以覆盖<em>IdmIdentityServiceImpl</em>类，或者直接实现<em>IdmIdentityService</em>接口，并使用实现类作为<em>ProcessEngineConfiguration</em>中的<em>idmIdentityService</em>参数。在Spring中，可以简单地向<em>ProcessEngineConfiguration</em>bean定义添加下面的代码实现：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;...SomeProcessEngineConfigurationClass&quot;</span><span class="tok-nt">&gt;</span>

    ...

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;idmIdentityService&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;com.mycompany.IdmIdentityServiceBean&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/property&gt;</span>

    ...

<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>LDAPIdentityServiceImpl</em>类是一个介绍如何实现<em>IdmIdentityService</em>接口中方法的很好的例子。你需要自行判断需要在自定义身份服务类中实现什么方法。例如下面的调用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-kt">long</span> <span class="tok-n">potentialOwners</span> <span class="tok-o">=</span> <span class="tok-n">identityService</span><span class="tok-o">.</span><span class="tok-na">createUserQuery</span><span class="tok-o">().</span><span class="tok-na">memberOfGroup</span><span class="tok-o">(</span><span class="tok-s">&quot;management&quot;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>会调用<em>IdmIdentityService</em>接口的下列成员：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">UserQuery</span> <span class="tok-nf">createUserQuery</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#chapter_ldap">集成LDAP</a>中的代码包含了如何实现这些的完整示例。可以在GitHub查看代码：<a href="https://github.com/flowable/flowable-engine/blob/master/modules/flowable-ldap/src/main/java/org/flowable/ldap/LDAPIdentityServiceImpl.java">LDAPIdentityServiceImpl</a>。</p>
</div>
</div>
<div class="sect3">
<h4 id="advanced.safe.bpmn.xml">3.9.9. 启用安全BPMN 2.0 XML</h4>
<div class="paragraph">
<p>在大多数情况下，部署至Flowable引擎的BPMN 2.0流程处在开发团队等的严格控制下。然而，有的时候会希望能够向引擎上传任意的BPMN 2.0 XML。在这种情况下，需要考虑动机不良的用户可能会像<a href="http://www.jorambarrez.be/blog/2013/02/19/uploading-a-funny-xml-can-bring-down-your-server/">这里</a>描述的一样，破坏服务器。</p>
</div>
<div class="paragraph">
<p>要避免上面链接中描述的攻击，可以在流程引擎配置中设置<em>enableSafeBpmnXml</em>参数：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;enableSafeBpmnXml&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>默认情况下这个功能是禁用的！</strong>原因是它依赖<a href="http://download.java.net/jdk7/archive/b123/docs/api/javax/xml/transform/stax/StAXSource.html">StaxSource</a>类。而不幸的是，某些平台（JDK6，JBoss等）不能使用这个类（由于使用的是过时的XML解析器），因此不能启用安全BPMN 2.0 XML功能。</p>
</div>
<div class="paragraph">
<p>如果运行Flowable的平台支持，请一定要启用这个功能。</p>
</div>
</div>
<div class="sect3">
<h4 id="advanced.event.logging">3.9.10. 事件日志</h4>
<div class="paragraph">
<p>Flowable引入了事件日志机制。日志机制基于<a href="#eventDispatcher">Flowable引擎的事件机制</a>，并默认禁用。总的来说，来源于引擎的事件会被捕获，并创建一个包含了所有事件数据（甚至更多）的map，提供给<em>org.flowable.engine.impl.event.logger.EventFlusher</em>，由它将这些数据保存其他地方。默认情况下，使用简单的基于数据库的事件处理器/保存器，用Jackson将上述map序列化为JSON，并将其作为<em>EventLogEntryEntity</em>实例存入数据库。默认会在数据库中创建<em>ACT_EVT_LOG</em>表保存事件日志。如果不使用事件日志，可以删除这个表。</p>
</div>
<div class="paragraph">
<p>要启用数据库记录器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">processEngineConfigurationImpl</span><span class="tok-o">.</span><span class="tok-na">setEnableDatabaseEventLogging</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>或在运行时：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-n">databaseEventLogger</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">EventLogger</span><span class="tok-o">(</span><span class="tok-n">processEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">getClock</span><span class="tok-o">(),</span>
                                      <span class="tok-n">processEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">getObjectMapper</span><span class="tok-o">());</span>
<span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">addEventListener</span><span class="tok-o">(</span><span class="tok-n">databaseEventLogger</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果默认的数据库记录不符合要求，可以扩展EventLogger类。<em>createEventFlusher()</em>方法需要返回<em>org.flowable.engine.impl.event.logger.EventFlusher</em>接口的实例。可以使用<em>managementService.getEventLogEntries(startLogNr, size);</em>获取<em>EventLogEntryEntity</em>实例。</p>
</div>
<div class="paragraph">
<p>显然，这个表中的数据也可以JSON的形式存入NoSQL存储，如MongoDB，Elastic Search等。也容易看出这里使用的类（org.flowable.engine.impl.event.logger.EventLogger/EventFlusher与许多其他EventHandler类）是可插拔的，可以按你的使用场景调整。（比如将JSON直接发送给队列或NoSQL，而不存入数据库）</p>
</div>
<div class="paragraph">
<p>请注意这个事件日志机制是独立于Flowable的“传统”历史管理器的。尽管所有数据都保存在数据库表中，但并未对查询或快速恢复做优化。实际使用场景主要是审计及存入大数据存储。</p>
</div>
</div>
<div class="sect3">
<h4 id="_disabling_bulk_inserts">3.9.11. 禁用批量插入</h4>
<div class="paragraph">
<p>默认情况下，引擎会将对同一个数据库表的多个插入语句组合在一起，作为<em>批量插入</em>。这样能够提高性能，并已在所有支持的数据库中实现及测试。</p>
</div>
<div class="paragraph">
<p>然而，即使是支持及测试过的数据库，也可能有某个特定版本不支持批量插入（例如有报告说DB2在z/OS上不支持，尽管一般来说DB2是支持的）。这时可以在流程引擎配置中禁用批量插入：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;bulkInsertEnabled&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="advancedSecureScripting">3.9.12. 安全脚本</h4>
<div class="paragraph">
<p>默认情况下，使用<a href="#bpmnScriptTask">脚本任务</a>时，执行的脚本与Java代码具有相似的能力。可以完全访问JVM，永远运行（无限循环），或占用大量内存。</p>
</div>
<div class="paragraph">
<p>相较而言，Java代码需要放在classpath的jar中，与流程定义的生命周期不一样。最终用户一般不会撰写Java代码，这基本上是开发者的工作。</p>
</div>
<div class="paragraph">
<p>而脚本是流程定义的一部分，生命周期一致。脚本任务不需要额外的jar部署步骤，而是在流程部署后就可以执行。有时，脚本任务中的脚本不是由开发者撰写的。所以会产生这个问题：脚本可以完全访问JVM，也可以在执行脚本时阻塞许多系统资源。因此允许执行来自任何人的脚本并不是一个好主意。</p>
</div>
<div class="paragraph">
<p>可以启用<em>安全脚本</em>功能解决这个问题。目前，这个功能只实现了<em>javascript</em>脚本，在项目中添加<em>flowable-secure-javascript</em>依赖启用。Maven：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>org.flowable<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>flowable-secure-javascript<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>${flowable.version}<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>添加这个依赖会同时引入Rhino依赖（参见<a href="$https://developer.mozilla.org/en-US/docs/Mozilla/Projects/Rhino$$"><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/Rhino" class="bare">https://developer.mozilla.org/en-US/docs/Mozilla/Projects/Rhino</a></a>）。Rhino是一个用于JDK的javascript引擎。过去包含在JDK6与7中，并已被Nashorn引擎取代。然而，Rhino项目仍然在继续开发。许多（包括Flowable用于实现安全脚本的）功能都在之后才加入。在撰写本手册的时候，Nashorn<strong>还没有</strong>实现安全脚本功能需要的功能。</p>
</div>
<div class="paragraph">
<p>这意味着脚本可能存在一些（基本很少）区别（例如，Rhino使用<em>importPackage</em>，而Nashorn使用<em>load()</em>）。</p>
</div>
<div class="paragraph">
<p>通过专门的<em>Configurator</em>对象配置安全脚本，并在流程引擎实例化之前将其传递给流程引擎配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-n">SecureJavascriptConfigurator</span> <span class="tok-n">configurator</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">SecureJavascriptConfigurator</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">setWhiteListedClasses</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">HashSet</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;(</span><span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">asList</span><span class="tok-o">(</span><span class="tok-s">&quot;java.util.ArrayList&quot;</span><span class="tok-o">)))</span>
  <span class="tok-o">.</span><span class="tok-na">setMaxStackDepth</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">setMaxScriptExecutionTime</span><span class="tok-o">(</span><span class="tok-mi">3000L</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">setMaxMemoryUsed</span><span class="tok-o">(</span><span class="tok-mi">3145728L</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">setNrOfInstructionsBeforeStateCheckCallback</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">);</span>

<span class="tok-n">processEngineConfig</span><span class="tok-o">.</span><span class="tok-na">addConfigurator</span><span class="tok-o">(</span><span class="tok-n">configurator</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用下列设置：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>enableClassWhiteListing</strong>: 为true时，会将所有类加入黑名单。需要在白名单中添加希望运行的所有类，严格控制暴露给脚本的东西。默认为<em>false</em>。</p>
</li>
<li>
<p><strong>whiteListedClasses</strong>: 一个全限定类名字符串的集合，表示允许在脚本中使用的类。例如，要在脚本中使用<em>execution</em>对象，需要在这个集合中添加<em>org.flowable.engine.impl.persistence.entity.ExecutionEntityImpl</em>字符串。默认为<em>空</em>。</p>
</li>
<li>
<p><strong>maxStackDepth</strong>: 限制在脚本中调用函数时的最大栈深度。可以用于避免在脚本中递归调用方法而导致的栈溢出异常。默认为<em>-1</em>（禁用）。</p>
</li>
<li>
<p><strong>maxScriptExecutionTime</strong>: 脚本允许运行的最大时间。默认为<em>-1</em>（禁用）。</p>
</li>
<li>
<p><strong>maxMemoryUsed</strong>: 脚本允许使用的最大内存数量，以字节计。请注意脚本引擎自己也要需要一定量的内存，也会算在这里。默认为<em>-1</em>（禁用）。</p>
</li>
<li>
<p><strong>nrOfInstructionsBeforeStateCheckCallback</strong>: 脚本每执行x个指令，就通过回调函数进行一次脚本执行时间与内存检测。请注意这不是指脚本指令，而是指java字节码指令（一行脚本可能有上百行字节码指令）。默认为100。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>请注意：</em><em>maxMemoryUsed</em>设置只能用于支持com.sun.management.ThreadMXBean#getThreadAllocatedBytes()方法的JVM，如Oracle JDK。</p>
</div>
<div class="paragraph">
<p>ScriptExecutionListener与ScriptTaskListener也有安全形式：<em>org.flowable.scripting.secure.listener.SecureJavascriptExecutionListener</em>与<em>org.flowable.scripting.secure.listener.SecureJavascriptTaskListener</em>。</p>
</div>
<div class="paragraph">
<p>像这样使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nt">&lt;flowable:executionListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.scripting.secure.listener.SecureJavascriptExecutionListener&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;script&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;flowable:string&gt;</span>
        <span class="tok-cp">&lt;![CDATA[</span>
<span class="tok-cp">            execution.setVariable(&#39;test&#39;);</span>
<span class="tok-cp">        ]]&gt;</span>
    <span class="tok-nt">&lt;/flowable:string&gt;</span>
  <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;language&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;javascript&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/flowable:executionListener&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以通过<a href="https://github.com/Flowable/Flowable/tree/master/modules/flowable-secure-javascript/src/test/resources">GitHub上的单元测试</a>，
查看不安全脚本以及通过<em>安全脚本</em>功能将其变得安全的例子，</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Tooling">3.10. 工具</h3>
<div class="sect3">
<h4 id="JMX">3.10.1. JMX</h4>
<div class="sect4">
<h5 id="jmxIntroduction">介绍</h5>
<div class="paragraph">
<p>可以使用标准Java管理扩展（Java Management Extensions, JMX）技术连接Flowable引擎，查询信息或修改配置。任何符合标准的JMX客户端都可以使用。通过JMX可以完成启用与禁用作业执行器、部署新的流程定义文件或删除流程等操作，而不需要写一行代码。</p>
</div>
</div>
<div class="sect4">
<h5 id="jmxQuickStart">快速开始</h5>
<div class="paragraph">
<p>默认情况下没有启用JMX。用Maven或其他方法将flowable-jmx jar文件加入classpath即可使用默认配置启动JMX。如果使用Maven，可以在pom.xml中添加下列依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.flowable<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>flowable-jmx<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>latest.version<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在添加依赖并启动流程引擎后，就可以使用JMX进行连接了。可以使用在标准JDK发行版中提供的jconsole。在本地线程列表中，可以找到运行Flowable的JVM。如果在“本地进程”中没有列出Flowable的JVM，可以尝试使用这个URL从“远程进程”中连接：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi/flowable</pre>
</div>
</div>
<div class="paragraph">
<p>可以在日志文件中找到正确的本地URL。连接成功后，可以看到标准的JVM信息以及MBean。选择MBeans页签，并在右侧面板选择"org.flowable.jmx.Mbeans"，查看Flowable的MBean。选择任何MBean，都可以查询相应的信息或修改配置。如下图所示：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/jmx.jconsole.png" alt="jmx.jconsole">
</div>
</div>
<div class="paragraph">
<p>不只是jconsole，任何JMX客户端都可以访问MBeans。大多数数据中心的监控工具都会提供连接至JMX MBeans的连接器。</p>
</div>
</div>
<div class="sect4">
<h5 id="_attributes_and_operations">属性与操作</h5>
<div class="paragraph">
<p>下表是目前可用的属性与操作的列表。这个列表可能根据需要在未来版本中扩展。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">MBean</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">名字</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ProcessDefinitionsMBean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">已部署流程定义的<code>Id</code>、<code>Name</code>、<code>Version</code>、<code>IsSuspended</code>等参数，是一个字符串的list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当前部署的<code>Id</code>、<code>Name</code>、<code>TenantId</code>参数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">getProcessDefinitionById(String id)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">给定id流程定义的<code>Id</code>、<code>Name</code>、<code>Version</code>与<code>IsSuspended</code>参数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deleteDeployment(String id)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">删除给定<code>Id</code>的部署</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">suspendProcessDefinitionById(String id)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">暂停给定<code>Id</code>的流程定义</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">activatedProcessDefinitionById(String id)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">激活给定<code>Id</code>的流程定义</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">suspendProcessDefinitionByKey(String id)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">暂停给定<code>key</code>的流程定义</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">activatedProcessDefinitionByKey(String id)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">激活给定<code>key</code>的流程定义</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployProcessDefinition(String resourceName, String processDefinitionFile)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部署流程定义文件</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JobExecutorMBean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">isJobExecutorActivated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回作业执行器是否在运行</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">setJobExecutorActivate(Boolean active)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">启用或停用作业执行器</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_configuration_3">配置</h5>
<div class="paragraph">
<p>JMX默认配置为最常使用的配置，以简化部署。但也可以很容易地以代码或配置文件的方式修改默认配置。下列代码展示了如何修改配置文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;...SomeProcessEngineConfigurationClass&quot;</span><span class="tok-nt">&gt;</span>
  ...
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;configurators&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;list&gt;</span>
	  <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.management.jmx.JMXConfigurator&quot;</span><span class="tok-nt">&gt;</span>

	    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;connectorPort&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;1912&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;serviceUrlPath&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;/jmxrmi/flowable&quot;</span> <span class="tok-nt">/&gt;</span>

		...
      <span class="tok-nt">&lt;/bean&gt;</span>
    <span class="tok-nt">&lt;/list&gt;</span>
  <span class="tok-nt">&lt;/property&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>下表展示了可配置的参数与其默认值：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名字</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若值为true，即使已添加依赖也不会启动JMX</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.flowable.jmx.Mbeans</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MBean的域</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">createConnector</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若值为true，则会创建一个连接器至MbeanServer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MBeanDomain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DefaultDomain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MBean服务器的域</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">registryPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1099</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">注册端口，组成服务URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serviceUrlPath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jmxrmi/flowable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">组成服务URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectorPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果大于0，则作为连接端口组成服务URL</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_jmx_service_url">JMX服务URL</h5>
<div class="paragraph">
<p>JMX服务URL格式如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>service:jmx:rmi://&lt;hostName&gt;:&lt;connectorPort&gt;/jndi/rmi://&lt;hostName&gt;:&lt;registryPort&gt;/&lt;serviceUrlPath&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><code>hostName</code>自动设置为机器的网络名。可以配置<code>connectorPort</code>、<code>registryPort</code>与<code>serviceUrlPath</code>。</p>
</div>
<div class="paragraph">
<p>如果<code>connectionPort</code>小于0，则服务URL不包括这部分，简化为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>service:jmx:rmi:///jndi/rmi://:&lt;hostname&gt;:&lt;registryPort&gt;/&lt;serviceUrlPath&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mavenArchetypes">3.10.2. Maven脚手架</h4>
<div class="sect4">
<h5 id="_create_test_case">创建测试用例</h5>
<div class="paragraph">
<p>在开发过程中，有时会需要在实际实现前，先构建一个小型的测试用例来测试想法或功能。这样可以用测试来明确目标。JUnit测试用例也是沟通功能需求及报告Bug的推荐工具。在一份bug报告或功能需求jira单中附加一个测试用例，可以显著减少修复所用的时间。</p>
</div>
<div class="paragraph">
<p>用maven脚手架可以快速创建标准测试用例，简化测试用例的创建过程。标准库中应该已经有脚手架了。如果没有，也可以在<strong>tooling/archtypes</strong>目录下键入<strong>mvn install</strong>，轻松安装到本地maven仓库目录中。</p>
</div>
<div class="paragraph">
<p>使用下列命令创建单元测试项目：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>mvn archetype:generate \
-DarchetypeGroupId=org.flowable \
-DarchetypeArtifactId=flowable-archetype-unittest \
-DarchetypeVersion=&lt;current version&gt; \
-DgroupId=org.myGroup \
-DartifactId=myArtifact</code></pre>
</div>
</div>
<div class="paragraph">
<p>下表介绍每个参数的作用：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. 单元测试脚手架生成参数</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">行</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">说明</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">archetypeGroupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">脚手架的Group id。需要为<strong>org.flowable</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">archetypeArtifactId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">脚手架Artifact id。需要为<strong>flowable-archetype-unittest</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">archetypeVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成的测试项目中使用的Flowable版本</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成的测试项目的Group id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">artifactId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成的测试项目的Artifact id</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>生成的项目的目录结构像是这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.
├── pom.xml
└── src
    └── test
        ├── java
        │   └── org
        │       └── myGroup
        │           └── MyUnitTest.java
        └── resources
            ├── flowable.cfg.xml
            ├── log4j.properties
            └── org
                └── myGroup
                    └── my-process.bpmn20.xml</pre>
</div>
</div>
<div class="paragraph">
<p>可以修改java单元测试用例及相应的流程模型，或者添加新的单元测试用例与流程模型。
如果用该项目来描述bug或功能，测试用例应该在初始时失败，并在修复了bug或实现了预期的功能以后成功。
请确保在发送之前键入<strong>mvn clean</strong>清理项目。</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="restApiChapter">4. REST API</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_bpmn_2">4.1. BPMN</h3>
<div class="sect3">
<h4 id="_deployment">4.1.1. Deployment</h4>
<div class="paragraph">
<p><strong>When using tomcat, please read <a href="#restUsageInTomcat">Usage in Tomcat</a>.</strong></p>
</div>
<div class="sect4">
<h5 id="_list_of_deployments">List of Deployments</h5>
<div class="listingblock">
<div class="content">
<pre>GET repository/deployments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. URL query parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return deployments with the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return deployments with a name like the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return deployments with the given category.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">categoryNotEquals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return deployments which don&#8217;t have the given category.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return deployments with the given tenantId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return deployments with a tenantId like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only returns deployments without a tenantId set. If <code>false</code>, the <code>withoutTenantId</code> parameter is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>id</em> (default), <em>name</em>, <em>deployTime</em> or <em>tenantId</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property to sort on, to be used together with the <em>order</em>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. REST Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the request was successful.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;10&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;flowable-examples.bar&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deploymentTime&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;2010-10-13T14:54:26.750+02:00&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;examples&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/repository/deployments/10&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;id&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_get_a_deployment">Get a deployment</h5>
<div class="listingblock">
<div class="content">
<pre>GET repository/deployments/{deploymentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Get a deployment - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the deployment to get.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Get a deployment - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the deployment was found and returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested deployment was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;10&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;flowable-examples.bar&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;deploymentTime&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;2010-10-13T14:54:26.750+02:00&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;examples&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/repository/deployments/10&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_create_a_new_deployment">Create a new deployment</h5>
<div class="listingblock">
<div class="content">
<pre>POST repository/deployments</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="paragraph">
<p>The request body should contain data of type <em>multipart/form-data</em>. There should be exactly one file in the request, any additional files will be ignored. The deployment name is the name of the file-field passed in. If multiple resources need to be deployed in a single deployment, compress the resources in a zip and make sure the file-name ends with <code>.bar</code> or <code>.zip</code>.</p>
</div>
<div class="paragraph">
<p>An additional parameter (form-field) can be passed in the request body with name <code>tenantId</code>. The value of this field will be used as the id of the tenant this deployment is done in.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Create a new deployment - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the deployment was created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates there was no content present in the request body or the content mime-type is not supported for deployment. The status-description contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;10&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;flowable-examples.bar&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;deploymentTime&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;2010-10-13T14:54:26.750+02:00&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/repository/deployments/10&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myTenant&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_delete_a_deployment">Delete a deployment</h5>
<div class="listingblock">
<div class="content">
<pre>DELETE repository/deployments/{deploymentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Delete a deployment - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the deployment to delete.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Delete a deployment - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the deployment was found and has been deleted. Response-body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested deployment was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_list_resources_in_a_deployment">List resources in a deployment</h5>
<div class="listingblock">
<div class="content">
<pre>GET repository/deployments/{deploymentId}/resources</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. List resources in a deployment - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the deployment to get the resources for.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. List resources in a deployment - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the deployment was found and the resource list has been returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested deployment was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-p">[</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;diagrams/my-process.bpmn20.xml&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/repository/deployments/10/resources/diagrams%2Fmy-process.bpmn20.xml&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;dataUrl&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/repository/deployments/10/resourcedata/diagrams%2Fmy-process.bpmn20.xml&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;mediaType&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;text/xml&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;processDefinition&quot;</span>
  <span class="tok-p">},</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;image.png&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/repository/deployments/10/resources/image.png&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;dataUrl&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/repository/deployments/10/resourcedata/image.png&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;mediaType&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;image/png&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;resource&quot;</span>
  <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mediaType</code>: Contains the media-type the resource has. This is resolved using a (pluggable) <code>MediaTypeResolver</code> and contains, by default, a limited number of mime-type mappings.</p>
</li>
<li>
<p><code>type</code>: Type of resource, possible values:</p>
</li>
<li>
<p><code>resource</code>: Plain old resource.</p>
</li>
<li>
<p><code>processDefinition</code>: Resource that contains one or more process-definitions. This resource is picked up by the deployer.</p>
</li>
<li>
<p><code>processImage</code>: Resource that represents a deployed process definition&#8217;s graphical layout.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>The dataUrl property in the resulting JSON for a single resource contains the actual URL to use for retrieving the binary resource.</em></p>
</div>
</div>
<div class="sect4">
<h5 id="_get_a_deployment_resource">Get a deployment resource</h5>
<div class="listingblock">
<div class="content">
<pre>GET repository/deployments/{deploymentId}/resources/{resourceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Get a deployment resource - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the deployment the requested resource is part of.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the resource to get. <strong>Make sure you URL-encode the resourceId in case it contains forward slashes. Eg: use <em>diagrams%2Fmy-process.bpmn20.xml</em> instead of <em>diagrams/Fmy-process.bpmn20.xml</em>.</strong></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Get a deployment resource - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates both deployment and resource have been found and the resource has been returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested deployment was not found or there is no resource with the given id present in the deployment. The status-description contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;diagrams/my-process.bpmn20.xml&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/repository/deployments/10/resources/diagrams%2Fmy-process.bpmn20.xml&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;dataUrl&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/repository/deployments/10/resourcedata/diagrams%2Fmy-process.bpmn20.xml&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;mediaType&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;text/xml&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;processDefinition&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mediaType</code>: Contains the media-type the resource has. This is resolved using a (pluggable) <code>MediaTypeResolver</code> and contains, by default, a limited number of mime-type mappings.</p>
</li>
<li>
<p><code>type</code>: Type of resource, possible values:</p>
</li>
<li>
<p><code>resource</code>: Plain old resource.</p>
</li>
<li>
<p><code>processDefinition</code>: Resource that contains one or more process-definitions. This resource is picked up by the deployer.</p>
</li>
<li>
<p><code>processImage</code>: Resource that represents a deployed process definition&#8217;s graphical layout.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_get_a_deployment_resource_content">Get a deployment resource content</h5>
<div class="listingblock">
<div class="content">
<pre>GET repository/deployments/{deploymentId}/resourcedata/{resourceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Get a deployment resource content - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the deployment the requested resource is part of.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the resource to get the data for. <strong>Make sure you URL-encode the resourceId in case it contains forward slashes. Eg: use <em>diagrams%2Fmy-process.bpmn20.xml</em> instead of <em>diagrams/Fmy-process.bpmn20.xml</em>.</strong></p></td>
</tr>
</tbody>
</table>
<div class="literalblock">
<div class="content">
<pre>.Get a deployment resource content - Response codes</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates both deployment and resource have been found and the resource data has been returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested deployment was not found or there is no resource with the given id present in the deployment. The status-description contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>The response body will contain the binary resource-content for the requested resource. The response content-type will be the same as the type returned in the resources <em>mimeType</em> property. Also, a content-disposition header is set, allowing browsers to download the file instead of displaying it.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_process_definitions">4.1.2. Process Definitions</h4>
<div class="sect4">
<h5 id="_list_of_process_definitions">List of process definitions</h5>
<div class="listingblock">
<div class="content">
<pre>GET repository/process-definitions</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. List of process definitions - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with the given version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with a name like the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with the given key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">keyLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with a name like the given key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with the given resource name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with a name like the given resource name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with the given category.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">categoryLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with a category like the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">categoryNotEquals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions which don&#8217;t have the given category.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions which are part of a deployment with the given id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startableByUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions which can be started by the given user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return the latest process definition versions. Can only be used together with <em>key</em> and <em>keyLike</em> parameters, using any other parameter will result in a 400-response.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">suspended</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only returns process definitions which are suspended. If <code>false</code>, only active process definitions (which are not suspended) are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>name</em> (default), <em>id</em>, <em>key</em>, <em>category</em>, <em>deploymentId</em> and <em>version</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property to sort on, to be used together with the <em>order</em>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. List of process definitions - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the process-definitions are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates a parameter was passed in the wrong format or that <em>latest</em> is used with other parameters other than <em>key</em> and <em>keyLike</em>. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess:1:4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;version&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;key&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;category&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Examples&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;suspended&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">false</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;The One Task Process&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a process for testing purposes&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deploymentId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deploymentUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/repository/deployments/2&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;graphicalNotationDefined&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">true</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;resource&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/deployments/2/resources/testProcess.xml&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;diagramResource&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/deployments/2/resources/testProcess.png&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startFormDefined&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">false</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>graphicalNotationDefined</code>: Indicates the process definition contains graphical information (BPMN DI).</p>
</li>
<li>
<p><code>resource</code>: Contains the actual deployed BPMN 2.0 xml.</p>
</li>
<li>
<p><code>diagramResource</code>: Contains a graphical representation of the process, null when no diagram is available.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_get_a_process_definition">Get a process definition</h5>
<div class="listingblock">
<div class="content">
<pre>GET repository/process-definitions/{processDefinitionId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. Get a process definition - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process definition to get.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. Get a process definition - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process definition was found and returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess:1:4&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;version&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;key&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;category&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Examples&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;suspended&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">false</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;The One Task Process&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a process for testing purposes&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;deploymentId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;deploymentUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/repository/deployments/2&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;graphicalNotationDefined&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">true</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;resource&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/deployments/2/resources/testProcess.xml&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;diagramResource&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/deployments/2/resources/testProcess.png&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;startFormDefined&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">false</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>graphicalNotationDefined</code>: Indicates the process definition contains graphical information (BPMN DI).</p>
</li>
<li>
<p><code>resource</code>: Contains the actual deployed BPMN 2.0 xml.</p>
</li>
<li>
<p><code>diagramResource</code>: Contains a graphical representation of the process, null when no diagram is available.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_update_category_for_a_process_definition">Update category for a process definition</h5>
<div class="listingblock">
<div class="content">
<pre>PUT repository/process-definitions/{processDefinitionId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;category&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;updatedcategory&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 22. Update category for a process definition - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process was category was altered.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates no category was defined in the request body.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong> see response for <code>repository/process-definitions/{processDefinitionId}</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_get_a_process_definition_resource_content">Get a process definition resource content</h5>
<div class="listingblock">
<div class="content">
<pre>GET repository/process-definitions/{processDefinitionId}/resourcedata</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 23. Get a process definition resource content - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process definition to get the resource data for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Response:</strong></p>
</div>
<div class="paragraph">
<p>Exactly the same response codes/boy as <code>GET repository/deployment/{deploymentId}/resourcedata/{resourceId}</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_get_a_process_definition_bpmn_model">Get a process definition BPMN model</h5>
<div class="listingblock">
<div class="content">
<pre>GET repository/process-definitions/{processDefinitionId}/model</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 24. Get a process definition BPMN model - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process definition to get the model for.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 25. Get a process definition BPMN model - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process definition was found and the model is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Response body:</strong>
The response body is a JSON representation of the <code>org.flowable.bpmn.model.BpmnModel</code> and contains the full process definition model.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;processes&quot;</span><span class="tok-p">:[</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;oneTaskProcess&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;xmlRowNumber&quot;</span><span class="tok-p">:</span><span class="tok-mi">7</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;xmlColumnNumber&quot;</span><span class="tok-p">:</span><span class="tok-mi">60</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;extensionElements&quot;</span><span class="tok-p">:{</span>

         <span class="tok-p">},</span>
         <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;The One Task Process&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;executable&quot;</span><span class="tok-p">:</span><span class="tok-kc">true</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;documentation&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;One task process description&quot;</span><span class="tok-p">,</span>

    <span class="tok-err">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_suspend_a_process_definition">Suspend a process definition</h5>
<div class="listingblock">
<div class="content">
<pre>PUT repository/process-definitions/{processDefinitionId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;suspend&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;includeProcessInstances&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;false&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;date&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-15T00:42:12Z&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table id="processDefinitionActionBodyParameters" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 26. Suspend a process definition - JSON Body parameters</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">action</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action to perform. Either <code>activate</code> or <code>suspend</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeProcessInstances</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether or not to suspend/activate running process-instances for this process-definition. If omitted, the process-instances are left in the state they are.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date (ISO-8601) when the suspension/activation should be executed. If omitted, the suspend/activation is effective immediately.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 27. Suspend a process definition - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process was suspended.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition is already suspended.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong> see response for <code>repository/process-definitions/{processDefinitionId}</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_activate_a_process_definition">Activate a process definition</h5>
<div class="listingblock">
<div class="content">
<pre>PUT repository/process-definitions/{processDefinitionId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;activate&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;includeProcessInstances&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;true&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;date&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-15T00:42:12Z&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>See suspend process definition <a href="#processDefinitionActionBodyParameters">JSON Body parameters</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 28. Activate a process definition - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process was activated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition is already active.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong> see response for <code>repository/process-definitions/{processDefinitionId}</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_get_all_candidate_starters_for_a_process_definition">Get all candidate starters for a process-definition</h5>
<div class="listingblock">
<div class="content">
<pre>GET repository/process-definitions/{processDefinitionId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 29. Get all candidate starters for a process-definition - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process definition to get the identity links for.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 30. Get all candidate starters for a process-definition - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process definition was found and the requested identity links are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-p">[</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4/identitylinks/groups/admin&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;user&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;group&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;admin&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;candidate&quot;</span>
   <span class="tok-p">},</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4/identitylinks/users/kermit&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;user&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;group&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;candidate&quot;</span>
   <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_add_a_candidate_starter_to_a_process_definition">Add a candidate starter to a process definition</h5>
<div class="listingblock">
<div class="content">
<pre>POST repository/process-definitions/{processDefinitionId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 31. Add a candidate starter to a process definition - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process definition.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body (user):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;user&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body (group):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;groupId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;sales&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 32. Add a candidate starter to a process definition - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process definition was found and the identity link was created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span>
<span class="tok-p">{</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4/identitylinks/users/kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;user&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;group&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;candidate&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_delete_a_candidate_starter_from_a_process_definition">Delete a candidate starter from a process definition</h5>
<div class="listingblock">
<div class="content">
<pre>DELETE repository/process-definitions/{processDefinitionId}/identitylinks/{family}/{identityId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 33. Delete a candidate starter from a process definition - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">family</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either <code>users</code> or <code>groups</code>, depending on the type of identity link.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">identityId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either the userId or groupId of the identity to remove as candidate starter.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 34. Delete a candidate starter from a process definition - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process definition was found and the identity link was removed. The response body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition was not found or the process definition doesn&#8217;t have an identity-link that matches the url.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span>
<span class="tok-p">{</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4/identitylinks/users/kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;user&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;group&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;candidate&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_get_a_candidate_starter_from_a_process_definition">Get a candidate starter from a process definition</h5>
<div class="listingblock">
<div class="content">
<pre>GET repository/process-definitions/{processDefinitionId}/identitylinks/{family}/{identityId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 35. Get a candidate starter from a process definition - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">family</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either <code>users</code> or <code>groups</code>, depending on the type of identity link.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">identityId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either the userId or groupId of the identity to get as candidate starter.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 36. Get a candidate starter from a process definition - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process definition was found and the identity link was returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition was not found or the process definition doesn&#8217;t have an identity-link that matches the url.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4/identitylinks/users/kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;user&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;group&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;candidate&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_models">4.1.3. Models</h4>
<div class="sect4">
<h5 id="_get_a_list_of_models">Get a list of models</h5>
<div class="listingblock">
<div class="content">
<pre>GET repository/models</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 37. Get a list of models - URL query parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models with the given id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models with the given category.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">categoryLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models with a category like the given value. Use the <code>%</code> character as wildcard.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">categoryNotEquals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models without the given category.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models with the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models with a name like the given value. Use the <code>%</code> character as wildcard.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models with the given key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models which are deployed in the given deployment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models with the given version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">latestVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only return models which are the latest version. Best used in combination with <code>key</code>. If <code>false</code> is passed in as value, this is ignored and all versions are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only deployed models are returned. If <code>false</code>, only undeployed models are returned (deploymentId is null).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models with the given tenantId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models with a tenantId like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only returns models without a tenantId set. If <code>false</code>, the <code>withoutTenantId</code> parameter is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>id</em> (default), <em>category</em>, <em>createTime</em>, <em>key</em>, <em>lastUpdateTime</em>, <em>name</em>, <em>version</em> or <em>tenantId</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property to sort on, to be used together with the <em>order</em>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 38. Get a list of models - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the models are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates a parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:[</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model name&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model key&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model category&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;metaInfo&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model metainfo&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;deploymentId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;7&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;10&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/models/10&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;createTime&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-06-12T14:31:08.612+0000&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;lastUpdateTime&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-06-12T14:31:08.612+0000&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;deploymentUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/deployments/7&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
      <span class="tok-p">},</span>

      <span class="tok-err">...</span>

   <span class="tok-p">],</span>
   <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;id&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_get_a_model">Get a model</h5>
<div class="listingblock">
<div class="content">
<pre>GET repository/models/{modelId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 39. Get a model - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the model to get.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 40. Get a model - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the model was found and returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested model was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/models/5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model name&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model key&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model category&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;metaInfo&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model metainfo&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;deploymentId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;deploymentUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/deployments/2&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;createTime&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-06-12T12:31:19.861+0000&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;lastUpdateTime&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-06-12T12:31:19.861+0000&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_update_a_model">Update a model</h5>
<div class="listingblock">
<div class="content">
<pre>PUT repository/models/{modelId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model name&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model key&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model category&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;metaInfo&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model metainfo&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;deploymentId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;updatedTenant&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All request values are optional. For example, you can only include the <em>name</em> attribute in the request body JSON-object, only updating the name of the model, leaving all other fields unaffected. When an attribute is explicitly included and is set to null, the model-value will be updated to null. Example: <code>{"metaInfo" : null}</code> will clear the metaInfo of the model).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 41. Update a model - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the model was found and updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested model was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/models/5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model name&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model key&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model category&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;metaInfo&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model metainfo&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;deploymentId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;deploymentUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/deployments/2&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;createTime&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-06-12T12:31:19.861+0000&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;lastUpdateTime&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-06-12T12:31:19.861+0000&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;&quot;</span><span class="tok-err">updatedTenant&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_create_a_model">Create a model</h5>
<div class="listingblock">
<div class="content">
<pre>POST repository/models</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model name&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model key&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model category&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span><span class="tok-mi">1</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;metaInfo&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model metainfo&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;deploymentId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;tenant&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All request values are optional. For example, you can only include the <em>name</em> attribute in the request body JSON-object, only setting the name of the model, leaving all other fields null.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 42. Create a model - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the model was created.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/models/5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model name&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model key&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model category&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span><span class="tok-mi">1</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;metaInfo&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model metainfo&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;deploymentId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;deploymentUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/deployments/2&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;createTime&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-06-12T12:31:19.861+0000&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;lastUpdateTime&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-06-12T12:31:19.861+0000&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;tenant&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_delete_a_model">Delete a model</h5>
<div class="listingblock">
<div class="content">
<pre>DELETE repository/models/{modelId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 43. Delete a model - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the model to delete.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 44. Delete a model - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the model was found and has been deleted. Response-body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested model was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_the_editor_source_for_a_model">Get the editor source for a model</h5>
<div class="listingblock">
<div class="content">
<pre>GET repository/models/{modelId}/source</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 45. Get the editor source for a model - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the model.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 46. Get the editor source for a model - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the model was found and source is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested model was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>Response body contains the model&#8217;s raw editor source. The response&#8217;s content-type is set to <code>application/octet-stream</code>, regardless of the content of the source.</p>
</div>
</div>
<div class="sect4">
<h5 id="_set_the_editor_source_for_a_model">Set the editor source for a model</h5>
<div class="listingblock">
<div class="content">
<pre>PUT repository/models/{modelId}/source</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 47. Set the editor source for a model - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the model.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="paragraph">
<p>The request should be of type <code>multipart/form-data</code>. There should be a single file-part included with the binary value of the source.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 48. Set the editor source for a model - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the model was found and the source has been updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested model was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>Response body contains the model&#8217;s raw editor source. The response&#8217;s content-type is set to <code>application/octet-stream</code>, regardless of the content of the source.</p>
</div>
</div>
<div class="sect4">
<h5 id="_get_the_extra_editor_source_for_a_model">Get the extra editor source for a model</h5>
<div class="listingblock">
<div class="content">
<pre>GET repository/models/{modelId}/source-extra</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 49. Get the extra editor source for a model - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the model.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 50. Get the extra editor source for a model - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the model was found and source is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested model was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>Response body contains the model&#8217;s raw extra editor source. The response&#8217;s content-type is set to <code>application/octet-stream</code>, regardless of the content of the extra source.</p>
</div>
</div>
<div class="sect4">
<h5 id="_set_the_extra_editor_source_for_a_model">Set the extra editor source for a model</h5>
<div class="listingblock">
<div class="content">
<pre>PUT repository/models/{modelId}/source-extra</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 51. Set the extra editor source for a model - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the model.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="paragraph">
<p>The request should be of type <code>multipart/form-data</code>. There should be a single file-part included with the binary value of the extra source.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 52. Set the extra editor source for a model - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the model was found and the extra source has been updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested model was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>Response body contains the model&#8217;s raw editor source. The response&#8217;s content-type is set to <code>application/octet-stream</code>, regardless of the content of the source.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_process_instances">4.1.4. Process Instances</h4>
<div class="sect4">
<h5 id="_get_a_process_instance">Get a process instance</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/process-instances/{processInstanceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 53. Get a process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to get.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 54. Get a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;7&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/7&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;businessKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myBusinessKey&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processDefinitionUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/processOne%3A1%3A4&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;processTask&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_delete_a_process_instance">Delete a process instance</h5>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/process-instances/{processInstanceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 55. Delete a process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to delete.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 56. Delete a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and deleted. Response body is left empty intentionally.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_activate_or_suspend_a_process_instance">Activate or suspend a process instance</h5>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/process-instances/{processInstanceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 57. Activate or suspend a process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to activate/suspend.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request response body (suspend):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;action&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;suspend&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request response body (activate):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;action&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;activate&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 58. Activate or suspend a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and action was executed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an invalid action was supplied.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance action cannot be executed since the process-instance is already activated/suspended.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_start_a_process_instance">Start a process instance</h5>
<div class="listingblock">
<div class="content">
<pre>POST runtime/process-instances</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body (start by process definition id):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;processDefinitionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;oneTaskProcess:1:158&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;businessKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myBusinessKey&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;returnVariables&quot;</span><span class="tok-p">:</span><span class="tok-kc">true</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
      <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myVar&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;This is a variable&quot;</span><span class="tok-p">,</span>
      <span class="tok-p">}</span>
   <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body (start by process definition key):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;processDefinitionKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;oneTaskProcess&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;businessKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myBusinessKey&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;returnVariables&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;tenant1&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
      <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myVar&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;This is a variable&quot;</span><span class="tok-p">,</span>
      <span class="tok-p">}</span>
   <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body (start by message):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;message&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;newOrderMessage&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;businessKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myBusinessKey&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;tenant1&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
      <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myVar&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;This is a variable&quot;</span><span class="tok-p">,</span>
      <span class="tok-p">}</span>
   <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that also a <em>transientVariables</em> property is accepted as part of this json, that follows the same structure as the <em>variables</em> property.</p>
</div>
<div class="paragraph">
<p>The <em>returnVariables</em> property can be used to get the existing variables in the process instance context back in the response. By default the variables are not returned.</p>
</div>
<div class="paragraph">
<p>Only one of <code>processDefinitionId</code>, <code>processDefinitionKey</code> or <code>message</code> can be used in the request body. Parameters <code>businessKey</code>, <code>variables</code> and <code>tenantId</code> are optional. If <code>tenantId</code> is omitted, the default tenant will be used. More information about the variable format can be found in <a href="#restVariables">the REST variables section</a>. Note that the variable-scope that is supplied is ignored, process-variables are always <code>local</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 59. Start a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates either the process-definition was not found (based on id or key), no process is started by sending the given message or an invalid variable has been passed. Status description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;7&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/7&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;businessKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myBusinessKey&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processDefinitionUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/processOne%3A1%3A4&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;processTask&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="restProcessInstancesGet">List of process instances</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/process-instances</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 60. List of process instances - URL query parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process instance with the given id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process instances with the given process definition key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process instances with the given process definition id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">businessKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process instances with the given businessKey.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">involvedUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process instances in which the given user is involved.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">suspended</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only return process instance which are suspended. If <code>false</code>, only return process instances which are not suspended (active).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">superProcessInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process instances which have the given super process-instance id (for processes that have a call-activities).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">subProcessInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process instances which have the given sub process-instance id (for processes started as a call-activity).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludeSubprocesses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only process instances which aren&#8217;t sub processes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeProcessVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication to include process variables in the result.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process instances with the given tenantId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process instances with a tenantId like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only returns process instances without a tenantId set. If <code>false</code>, the <code>withoutTenantId</code> parameter is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sort field, should be either one of <code>id</code> (default), <code>processDefinitionId</code>, <code>tenantId</code> or <code>processDefinitionKey</code>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 61. List of process instances - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the process-instances are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates a parameter was passed in the wrong format . The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:[</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;7&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/7&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;businessKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myBusinessKey&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processDefinitionUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/processOne%3A1%3A4&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;processTask&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
      <span class="tok-p">}</span>


   <span class="tok-p">],</span>
   <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;id&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_query_process_instances">Query process instances</h5>
<div class="listingblock">
<div class="content">
<pre>POST query/process-instances</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;processDefinitionKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;oneTaskProcess&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span>
  <span class="tok-p">[</span>
    <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myVariable&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">1234</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;operation&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;equals&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;long&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The request body can contain all possible filters that can be used in the <a href="#restProcessInstancesGet">List process instances</a> URL query. On top of these, it&#8217;s possible to provide an array of variables
to include in the query, with their format <a href="#restQueryVariable">described here</a>.</p>
</div>
<div class="paragraph">
<p>The general <a href="#restPagingAndSort">paging and sorting query-parameters</a> can be used for this URL.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 62. Query process instances - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the process-instances are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates a parameter was passed in the wrong format . The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:[</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;7&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/7&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;businessKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myBusinessKey&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processDefinitionUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/processOne%3A1%3A4&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;processTask&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
      <span class="tok-p">}</span>


   <span class="tok-p">],</span>
   <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;id&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_get_diagram_for_a_process_instance">Get diagram for a process instance</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/process-instances/{processInstanceId}/diagram</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 63. Get diagram for a process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to get the diagram for.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 64. Get diagram for a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and the diagram was returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found but the process doesn&#8217;t contain any graphical information (BPMN:DI) and no diagram can be created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;7&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/7&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;businessKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myBusinessKey&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processDefinitionUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/processOne%3A1%3A4&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;processTask&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_get_involved_people_for_process_instance">Get involved people for process instance</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/process-instances/{processInstanceId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 65. Get involved people for process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to the links for.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 66. Get involved people for process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and links are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-p">[</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5/identitylinks/users/john/customType&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;user&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;john&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;group&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;customType&quot;</span>
   <span class="tok-p">},</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5/identitylinks/users/paul/candidate&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;user&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;paul&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;group&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;candidate&quot;</span>
   <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>groupId</code> will always be null, as it&#8217;s only possible to involve users with a process-instance.</p>
</div>
</div>
<div class="sect4">
<h5 id="_add_an_involved_user_to_a_process_instance">Add an involved user to a process instance</h5>
<div class="listingblock">
<div class="content">
<pre>POST runtime/process-instances/{processInstanceId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 67. Add an involved user to a process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to the links for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;userId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;participant&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>userId</code> and <code>type</code> are required.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 68. Add an involved user to a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and the link is created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested body did not contain a userId or a type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5/identitylinks/users/john/customType&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;user&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;john&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;group&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;customType&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>groupId</code> will always be null, as it&#8217;s only possible to involve users with a process-instance.</p>
</div>
</div>
<div class="sect4">
<h5 id="_remove_an_involved_user_to_from_process_instance">Remove an involved user to from process instance</h5>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/process-instances/{processInstanceId}/identitylinks/users/{userId}/{type}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 69. Remove an involved user to from process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to delete link for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of link to delete.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 70. Remove an involved user to from process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and the link has been deleted. Response body is left empty intentionally.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found or the link to delete doesn&#8217;t exist. The response status contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5/identitylinks/users/john/customType&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;user&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;john&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;group&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;customType&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>groupId</code> will always be null, as it&#8217;s only possible to involve users with a process-instance.</p>
</div>
</div>
<div class="sect4">
<h5 id="_list_of_variables_for_a_process_instance">List of variables for a process instance</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/process-instances/{processInstanceId}/variables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 71. List of variables for a process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to the variables for.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 72. List of variables for a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and variables are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span></span><span class="tok-p">[</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;intProcVar&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;local&quot;</span>
   <span class="tok-p">},</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;byteArrayProcVar&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;binary&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;valueUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5/variables/byteArrayProcVar/data&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;local&quot;</span>
   <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In case the variable is a binary variable or serializable, the <code>valueUrl</code> points to an URL to fetch the raw value. If it&#8217;s a plain variable, the value is present in the response.
Note that only <code>local</code> scoped variables are returned, as there is no <code>global</code> scope for process-instance variables.</p>
</div>
</div>
<div class="sect4">
<h5 id="_get_a_variable_for_a_process_instance">Get a variable for a process instance</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/process-instances/{processInstanceId}/variables/{variableName}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 73. Get a variable for a process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to the variables for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the variable to get.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 74. Get a variable for a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates both the process instance and variable were found and variable is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the request body is incomplete or contains illegal values. The status description contains additional information about the error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found or the process instance does not have a variable with the given name. Status description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span>   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;intProcVar&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;local&quot;</span>
   <span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In case the variable is a binary variable or serializable, the <code>valueUrl</code> points to an URL to fetch the raw value. If it&#8217;s a plain variable, the value is present in the response.  Note that only <code>local</code> scoped variables are returned, as there is no <code>global</code> scope for process-instance variables.</p>
</div>
</div>
<div class="sect4">
<h5 id="_create_or_update_variables_on_a_process_instance">Create (or update) variables on a process instance</h5>
<div class="listingblock">
<div class="content">
<pre>POST runtime/process-instances/{processInstanceId}/variables</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/process-instances/{processInstanceId}/variables</pre>
</div>
</div>
<div class="paragraph">
<p>When using <code>POST</code>, all variables that are passed are created. In case one of the variables already exists on the process instance, the request results in an error (409 - CONFLICT). When <code>PUT</code> is used, nonexistent variables are created on the process-instance and existing ones are overridden without any error.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 75. Create (or update) variables on a process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to the variables for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>[
   {
      "name":"intProcVar"
      "type":"integer"
      "value":123
   },

   ...
]</pre>
</div>
</div>
<div class="paragraph">
<p>Any number of variables can be passed into the request body array. More information about the variable format can be found in <a href="#restVariables">the REST variables section</a>. Note that scope is ignored, only <code>local</code> variables can be set in a process instance.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 76. Create (or update) variables on a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and variable is created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the request body is incomplete or contains illegal values. The status description contains additional information about the error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found but already contains a variable with the given name (only thrown when POST method is used). Use the update-method instead.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>[
   {
      "name":"intProcVar",
      "type":"integer",
      "value":123,
      "scope":"local"
   },

   ...

]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_update_a_single_variable_on_a_process_instance">Update a single variable on a process instance</h5>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/process-instances/{processInstanceId}/variables/{variableName}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 77. Update a single variable on a process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to the variables for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the variable to get.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span> <span class="tok-p">{</span>
    <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;intProcVar&quot;</span>
    <span class="tok-s2">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span>
    <span class="tok-s2">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span>
 <span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>More information about the variable format can be found in <a href="#restVariables">the REST variables section</a>. Note that scope is ignored, only <code>local</code> variables can be set in a process instance.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 78. Update a single variable on a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates both the process instance and variable were found and variable is updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found or the process instance does not have a variable with the given name. Status description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;intProcVar&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;local&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In case the variable is a binary variable or serializable, the <code>valueUrl</code> points to an URL to fetch the raw value. If it&#8217;s a plain variable, the value is present in the response. Note that only <code>local</code> scoped variables are returned, as there is no <code>global</code> scope for process-instance variables.</p>
</div>
</div>
<div class="sect4">
<h5 id="_create_a_new_binary_variable_on_a_process_instance">Create a new binary variable on a process-instance</h5>
<div class="listingblock">
<div class="content">
<pre>POST runtime/process-instances/{processInstanceId}/variables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 79. Create a new binary variable on a process-instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to create the new variable for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="paragraph">
<p>The request should be of type <code>multipart/form-data</code>. There should be a single file-part included with the binary value of the variable. On top of that, the following additional form-fields can be present:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Required name of the variable.</p>
</li>
<li>
<p><code>type</code>: Type of variable that is created. If omitted, <code>binary</code> is assumed and the binary data in the request will be stored as an array of bytes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binaryVariable&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binary&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;valueUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://.../runtime/process-instances/123/variables/binaryVariable/data&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 80. Create a new binary variable on a process-instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the variable was created and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the name of the variable to create was missing. Status message provides additional information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance already has a variable with the given name. Use the PUT method to update the task variable instead.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">415</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the serializable data contains an object for which no class is present in the JVM running the Flowable engine and therefore cannot be deserialized.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_update_an_existing_binary_variable_on_a_process_instance">Update an existing binary variable on a process-instance</h5>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/process-instances/{processInstanceId}/variables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 81. Update an existing binary variable on a process-instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to create the new variable for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong>
The request should be of type <code>multipart/form-data</code>. There should be a single file-part included with the binary value of the variable. On top of that, the following additional form-fields can be present:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Required name of the variable.</p>
</li>
<li>
<p><code>type</code>: Type of variable that is created. If omitted, <code>binary</code> is assumed and the binary data in the request will be stored as an array of bytes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binaryVariable&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binary&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;valueUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://.../runtime/process-instances/123/variables/binaryVariable/data&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 82. Update an existing binary variable on a process-instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the variable was updated and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the name of the variable to update was missing. Status message provides additional information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found or the process instance does not have a variable with the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">415</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the serializable data contains an object for which no class is present in the JVM running the Flowable engine and therefore cannot be deserialized.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_executions">4.1.5. Executions</h4>
<div class="sect4">
<h5 id="_get_an_execution">Get an execution</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/executions/{executionId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 83. Get an execution - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the execution to get.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 84. Get an execution - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution was found and returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/executions/5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;parentId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;parentUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_execute_an_action_on_an_execution">Execute an action on an execution</h5>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/executions/{executionId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 85. Execute an action on an execution - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the execution to execute action on.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body (signal an execution):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;signal&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Both a <em>variables</em> and <em>transientVariables</em> property is accepted with following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;signal&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;variables&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;myVar&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;someValue&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body (signal event received for execution):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;signalEventReceived&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;signalName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;mySignal&quot;</span>
  <span class="tok-s2">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notifies the execution that a signal event has been received, requires a <code>signalName</code> parameter. Optional <code>variables</code> can be passed that are set on the execution before the action is executed.</p>
</div>
<div class="paragraph">
<p><strong>Request body (signal event received for execution):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;messageEventReceived&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;messageName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myMessage&quot;</span>
  <span class="tok-s2">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notifies the execution that a message event has been received, requires a <code>messageName</code> parameter. Optional <code>variables</code> can be passed that are set on the execution before the action is executed.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 86. Execute an action on an execution - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution was found and the action is performed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution was found, the action was performed and the action caused the execution to end.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an illegal action was requested, required parameters are missing in the request body or illegal variables are passed in. Status description contains additional information about the error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body (in case execution is not ended due to action):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/executions/5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;parentId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;parentUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_get_active_activities_in_an_execution">Get active activities in an execution</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/executions/{executionId}/activities</pre>
</div>
</div>
<div class="paragraph">
<p>Returns all activities which are active in the execution and in all child-executions (and their children, recursively), if any.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 87. Get active activities in an execution - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the execution to get activities for.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 88. Get active activities in an execution - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution was found and activities are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">[</span>
  <span class="tok-s2">&quot;userTaskForManager&quot;</span><span class="tok-p">,</span>
  <span class="tok-s2">&quot;receiveTask&quot;</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="restExecutionsGet">List of executions</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/executions</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 89. List of executions - URL query parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return executions with the given id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">activityId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return executions with the given activity id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return executions with the given process definition key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return executions with the given process definition id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return executions which are part of the process instance with the given id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">messageEventSubscriptionName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return executions which are subscribed to a message with the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">signalEventSubscriptionName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return executions which are subscribed to a signal with the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return executions which are a direct child of the given execution.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return executions with the given tenantId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return executions with a tenantId like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only returns executions without a tenantId set. If <code>false</code>, the <code>withoutTenantId</code> parameter is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sort field, should be either one of <code>processInstanceId</code> (default), <code>processDefinitionId</code>, <code>processDefinitionKey</code> or <code>tenantId</code>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 90. List of executions - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the executions are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates a parameter was passed in the wrong format . The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:[</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/executions/5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;parentId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;parentUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
      <span class="tok-p">},</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;7&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/executions/7&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;parentId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;parentUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/executions/5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;processTask&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
      <span class="tok-p">}</span>
   <span class="tok-p">],</span>
   <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;processInstanceId&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_query_executions">Query executions</h5>
<div class="listingblock">
<div class="content">
<pre>POST query/executions</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;processDefinitionKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;oneTaskProcess&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span>
  <span class="tok-p">[</span>
    <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myVariable&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">1234</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;operation&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;equals&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;long&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;processInstanceVariables&quot;</span><span class="tok-p">:</span>
  <span class="tok-p">[</span>
    <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;processVariable&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;some string&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;operation&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;equals&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The request body can contain all possible filters that can be used in the <a href="#restExecutionsGet">List executions</a> URL query. On top of these, it&#8217;s possible to provide an array of <code>variables</code> and <code>processInstanceVariables</code>
to include in the query, with their format <a href="#restQueryVariable">described here</a>.</p>
</div>
<div class="paragraph">
<p>The general <a href="#restPagingAndSort">paging and sorting query-parameters</a> can be used for this URL.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 91. Query executions - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the executions are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates a parameter was passed in the wrong format . The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:[</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/executions/5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;parentId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;parentUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
      <span class="tok-p">},</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;7&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/executions/7&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;parentId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;parentUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/executions/5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;processTask&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
      <span class="tok-p">}</span>
   <span class="tok-p">],</span>
   <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;processInstanceId&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_list_of_variables_for_an_execution">List of variables for an execution</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/executions/{executionId}/variables?scope={scope}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 92. List of variables for an execution - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the execution to the variables for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either <code>local</code> or <code>global</code>. If omitted, both local and global scoped variables are returned.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 93. List of variables for an execution - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution was found and variables are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested execution was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-p">[</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;intProcVar&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;global&quot;</span>
   <span class="tok-p">},</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;byteArrayProcVar&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;binary&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;valueUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5/variables/byteArrayProcVar/data&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;local&quot;</span>
   <span class="tok-p">}</span>


<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In case the variable is a binary variable or serializable, the <code>valueUrl</code> points to an URL to fetch the raw value. If it&#8217;s a plain variable, the value is present in the response.</p>
</div>
</div>
<div class="sect4">
<h5 id="_get_a_variable_for_an_execution">Get a variable for an execution</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/executions/{executionId}/variables/{variableName}?scope={scope}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 94. Get a variable for an execution - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the execution to the variables for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the variable to get.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either <code>local</code> or <code>global</code>. If omitted, local variable is returned (if exists). If not, a global variable is returned (if exists).</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 95. Get a variable for an execution - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates both the execution and variable were found and variable is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the request body is incomplete or contains illegal values. The status description contains additional information about the error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested execution was not found or the execution does not have a variable with the given name in the requested scope (in case scope-query parameter was omitted, variable doesn&#8217;t exist in local and global scope). Status description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span>   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;intProcVar&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;local&quot;</span>
   <span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In case the variable is a binary variable or serializable, the <code>valueUrl</code> points to an URL to fetch the raw value. If it&#8217;s a plain variable, the value is present in the response.</p>
</div>
</div>
<div class="sect4">
<h5 id="_create_or_update_variables_on_an_execution">Create (or update) variables on an execution</h5>
<div class="listingblock">
<div class="content">
<pre>POST runtime/executions/{executionId}/variables</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/executions/{executionId}/variables</pre>
</div>
</div>
<div class="paragraph">
<p>When using <code>POST</code>, all variables that are passed are created. In case one of the variables already exists on the execution in the requested scope, the request results in an error (409 - CONFLICT). When <code>PUT</code> is used, nonexistent variables are created on the execution and existing ones are overridden without any error.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 96. Create (or update) variables on an execution - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the execution to the variables for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">[</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;intProcVar&quot;</span>
      <span class="tok-s2">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span>
      <span class="tok-s2">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;local&quot;</span>
   <span class="tok-p">}</span>



<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>*Note that you can only provide variables that have the same scope. If the request-body array contains variables from mixed scopes, the request results in an error (400 - BAD REQUEST).*Any number of variables can be passed into the request body array. More information about the variable format can be found in <a href="#restVariables">the REST variables section</a>. Note that scope is ignored, only <code>local</code> variables can be set in a process instance.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 97. Create (or update) variables on an execution - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution was found and variable is created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the request body is incomplete or contains illegal values. The status description contains additional information about the error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested execution was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution was found but already contains a variable with the given name (only thrown when POST method is used). Use the update-method instead.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">[</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;intProcVar&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;local&quot;</span>
   <span class="tok-p">}</span>



<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_update_a_variable_on_an_execution">Update a variable on an execution</h5>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/executions/{executionId}/variables/{variableName}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 98. Update a variable on an execution - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the execution to update the variables for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the variable to update.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span> <span class="tok-p">{</span>
    <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;intProcVar&quot;</span>
    <span class="tok-s2">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span>
    <span class="tok-s2">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;global&quot;</span>
 <span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>More information about the variable format can be found in <a href="#restVariables">the REST variables section</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 99. Update a variable on an execution - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates both the process instance and variable were found and variable is updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found or the process instance does not have a variable with the given name. Status description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span>   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;intProcVar&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;global&quot;</span>
   <span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In case the variable is a binary variable or serializable, the <code>valueUrl</code> points to an URL to fetch the raw value. If it&#8217;s a plain variable, the value is present in the response.</p>
</div>
</div>
<div class="sect4">
<h5 id="_create_a_new_binary_variable_on_an_execution">Create a new binary variable on an execution</h5>
<div class="listingblock">
<div class="content">
<pre>POST runtime/executions/{executionId}/variables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 100. Create a new binary variable on an execution - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the execution to create the new variable for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="paragraph">
<p>The request should be of type <code>multipart/form-data</code>. There should be a single file-part included with the binary value of the variable. On top of that, the following additional form-fields can be present:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Required name of the variable.</p>
</li>
<li>
<p><code>type</code>: Type of variable that is created. If omitted, <code>binary</code> is assumed and the binary data in the request will be stored as an array of bytes.</p>
</li>
<li>
<p><code>scope</code>: Scope of variable that is created. If omitted, <code>local</code> is assumed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binaryVariable&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binary&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;valueUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://.../runtime/executions/123/variables/binaryVariable/data&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 101. Create a new binary variable on an execution - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the variable was created and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the name of the variable to create was missing. Status message provides additional information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested execution was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution already has a variable with the given name. Use the PUT method to update the task variable instead.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">415</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the serializable data contains an object for which no class is present in the JVM running the Flowable engine and therefore cannot be deserialized.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_update_an_existing_binary_variable_on_a_process_instance_2">Update an existing binary variable on a process-instance</h5>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/executions/{executionId}/variables/{variableName}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 102. Update an existing binary variable on a process-instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the execution to create the new variable for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the variable to update.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong>
The request should be of type <code>multipart/form-data</code>. There should be a single file-part included with the binary value of the variable. On top of that, the following additional form-fields can be present:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Required name of the variable.</p>
</li>
<li>
<p><code>type</code>: Type of variable that is created. If omitted, <code>binary</code> is assumed and the binary data in the request will be stored as an array of bytes.</p>
</li>
<li>
<p><code>scope</code>: Scope of variable that is created. If omitted, <code>local</code> is assumed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binaryVariable&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binary&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;valueUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://.../runtime/executions/123/variables/binaryVariable/data&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 103. Update an existing binary variable on a process-instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the variable was updated and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the name of the variable to update was missing. Status message provides additional information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested execution was not found or the execution does not have a variable with the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">415</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the serializable data contains an object for which no class is present in the JVM running the Flowable engine and therefore cannot be deserialized.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_tasks">4.1.6. Tasks</h4>
<div class="sect4">
<h5 id="_get_a_task">Get a task</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 104. Get a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 105. Get a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was found and returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;createTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;delegationState&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;pending&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Task description&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;dueDate&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;execution&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/executions/5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;8&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My task&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;owner&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;owner&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;parentTask&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/9&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;priority&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">50</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processDefinition&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstance&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;suspended&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">false</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskDefinitionKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;theTask&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/8&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>delegationState</code>: Delegation-state of the task, can be <code>null</code>, <code>"pending"</code> or <code>"resolved".</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="restTasksGet">List of tasks</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 106. List of tasks - URL query parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks with the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks with a name like the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks with the given description.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">priority</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks with the given priority.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">minimumPriority</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks with a priority greater than the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maximumPriority</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks with a priority lower than the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">assignee</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks assigned to the given user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">assigneeLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks assigned with an assignee like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">owner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks owned by the given user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ownerLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks assigned with an owner like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unassigned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks that are not assigned to anyone. If <code>false</code> is passed, the value is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">delegationState</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks that have the given delegation state. Possible values are <code>pending</code> and <code>resolved</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">candidateUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks that can be claimed by the given user. This includes both tasks where the user is an explicit candidate for and task that are claimable by a group that the user is a member of.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">candidateGroup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks that can be claimed by a user in the given group.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">candidateGroups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks that can be claimed by a user in the given groups. Values split by comma.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">involvedUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks in which the given user is involved.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks with the given task definition id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDefinitionKeyLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks with a given task definition id like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are part of the process instance with the given id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceBusinessKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are part of the process instance with the given business key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceBusinessKeyLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are part of the process instance which has a business key like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are part of a process instance which has a process definition with the given id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are part of a process instance which has a process definition with the given key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionKeyLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are part of a process instance which has a process definition with a key like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are part of a process instance which has a process definition with the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are part of a process instance which has a process definition with a name like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are part of the execution with the given id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">createdOn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are created on the given date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">createdBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are created before the given date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">createdAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are created after the given date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueOn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are due on the given date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are due before the given date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are due after the given date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutDueDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which don&#8217;t have a due date. The property is ignored if the value is <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludeSubTasks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks that are not a subtask of another task.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only return tasks that are not suspended (either part of a process that is not suspended or not part of a process at all). If false, only tasks that are part of suspended process instances are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeTaskLocalVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication to include task local variables in the result.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeProcessVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication to include process variables in the result.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks with the given tenantId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks with a tenantId like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only returns tasks without a tenantId set. If <code>false</code>, the <code>withoutTenantId</code> parameter is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">candidateOrAssigned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select tasks that has been claimed or assigned to user or waiting to claim by user (candidate user or groups).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select tasks with the given category. Note that this is the task category, not the category of the process definition (namespace within the BPMN Xml).</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 107. List of tasks - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the tasks are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates a parameter was passed in the wrong format or that <em>delegationState</em> has an invalid value (other than <em>pending</em> and <em>resolved</em>). The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;createTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;delegationState&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;pending&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Task description&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;dueDate&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;execution&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/executions/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;8&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My task&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;owner&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;owner&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;parentTask&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/9&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;priority&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">50</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinition&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstance&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;suspended&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">false</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskDefinitionKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;theTask&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/8&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_query_for_tasks">Query for tasks</h5>
<div class="listingblock">
<div class="content">
<pre>POST query/tasks</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My task&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;The task description&quot;</span><span class="tok-p">,</span>

  <span class="tok-err">...</span>

  <span class="tok-nt">&quot;taskVariables&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myVariable&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">1234</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;operation&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;equals&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;long&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>

    <span class="tok-nt">&quot;processInstanceVariables&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
      <span class="tok-p">{</span>
         <span class="tok-err">...</span>
      <span class="tok-p">}</span>
    <span class="tok-p">]</span>
  <span class="tok-err">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All supported JSON parameter fields allowed are exactly the same as the parameters found for <a href="#restTasksGet">getting a collection of tasks</a> (except for candidateGroupIn which is only available in this POST task query REST service), but passed in as JSON-body arguments rather than URL-parameters to allow for more advanced querying and preventing errors with request-uri&#8217;s that are too long. On top of that, the query allows for filtering based on task and process variables. The <code>taskVariables</code> and <code>processInstanceVariables</code> are both JSON-arrays containing objects with the format <a href="#restQueryVariable">as described here.</a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 108. Query for tasks - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the tasks are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates a parameter was passed in the wrong format or that <em>delegationState</em> has an invalid value (other than <em>pending</em> and <em>resolved</em>). The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;createTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;delegationState&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;pending&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Task description&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;dueDate&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;execution&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/executions/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;8&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My task&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;owner&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;owner&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;parentTask&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/9&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;priority&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">50</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinition&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstance&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;suspended&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">false</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskDefinitionKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;theTask&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/8&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_update_a_task">Update a task</h5>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/tasks/{taskId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;assignee&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;delegationState&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;resolved&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;New task description&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;dueDate&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T13:06:02.438+02:00&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;New task name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;owner&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;owner&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;parentTaskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;priority&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">20</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All request values are optional. For example, you can only include the <em>assignee</em> attribute in the request body JSON-object, only updating the assignee of the task, leaving all other fields unaffected. When an attribute is explicitly included and is set to null, the task-value will be updated to null. Example: <code>{"dueDate" : null}</code> will clear the duedate of the task).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 109. Update a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was updated simultaneously.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong> see response for <code>runtime/tasks/{taskId}</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_task_actions">Task actions</h5>
<div class="listingblock">
<div class="content">
<pre>POST runtime/tasks/{taskId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Complete a task - Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;complete&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;variables&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Completes the task. Optional variable array can be passed in using the <code>variables</code> property. More information about the variable format can be found in <a href="#restVariables">the REST variables section</a>. Note that the variable-scope that is supplied is ignored and the variables are set on the parent-scope unless a variable exists in a local scope, which is overridden in this case. This is the same behavior as the <code>TaskService.completeTask(taskId, variables)</code> invocation.</p>
</div>
<div class="paragraph">
<p>Note that also a <em>transientVariables</em> property is accepted as part of this json, that follows the same structure as the <em>variables</em> property.</p>
</div>
<div class="paragraph">
<p><strong>Claim a task - Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;claim&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;userWhoClaims&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Claims the task by the given assignee. If the assignee is <code>null</code>, the task is assigned to no-one, claimable again.</p>
</div>
<div class="paragraph">
<p><strong>Delegate a task - Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;delegate&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;userToDelegateTo&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Delegates the task to the given assignee. The assignee is required.</p>
</div>
<div class="paragraph">
<p><strong>Resolve a task - Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span>
<span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;resolve&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Resolves the task delegation. The task is assigned back to the task owner (if any).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 110. Task actions - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the action was executed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When the body contains an invalid value or when the assignee is missing when the action requires it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the action cannot be performed due to a conflict. Either the task was updates simultaneously or the task was claimed by another user, in case of the <em><code>claim</code></em> action.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong> see response for <code>runtime/tasks/{taskId}</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_delete_a_task">Delete a task</h5>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/tasks/{taskId}?cascadeHistory={cascadeHistory}&amp;deleteReason={deleteReason}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 111. &gt;Delete a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to delete.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cascadeHistory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether or not to delete the HistoricTask instance when deleting the task (if applicable). If not provided, this value defaults to false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deleteReason</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reason why the task is deleted. This value is ignored when <code>cascadeHistory</code> is true.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 112. &gt;Delete a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was found and has been deleted. Response-body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">403</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task cannot be deleted because it&#8217;s part of a workflow.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_all_variables_for_a_task">Get all variables for a task</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/variables?scope={scope}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 113. Get all variables for a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get variables for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope of variables to be returned. When <em><code>local</code></em>, only task-local variables are returned. When <em><code>global</code></em>, only variables from the task&#8217;s parent execution-hierarchy are returned. When the parameter is omitted, both local and global variables are returned.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 114. Get all variables for a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was found and the requested variables are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-p">[</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;doubleTaskVar&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;double&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-mf">99.99</span>
  <span class="tok-p">},</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;stringProcVar&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;global&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a ProcVariable&quot;</span>
  <span class="tok-p">}</span>



<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The variables are returned as a JSON array. Full response description can be found in the general <a href="#restVariables">REST-variables section</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_get_a_variable_from_a_task">Get a variable from a task</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/variables/{variableName}?scope={scope}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 115. Get a variable from a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get a variable for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the variable to get.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope of variable to be returned. When <em><code>local</code></em>, only task-local variable value is returned. When <em><code>global</code></em>, only variable value from the task&#8217;s parent execution-hierarchy are returned. When the parameter is omitted, a local variable will be returned if it exists, otherwise a global variable.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 116. Get a variable from a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was found and the requested variables are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the task doesn&#8217;t have a variable with the given name (in the given scope). Status message provides additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myTaskVariable&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Hello my friend&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Full response body description can be found in the general <a href="#restVariables">REST-variables section</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_get_the_binary_data_for_a_variable">Get the binary data for a variable</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/variables/{variableName}/data?scope={scope}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 117. Get the binary data for a variable - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get a variable data for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the variable to get data for. Only variables of type <code>binary</code> and <code>serializable</code> can be used. If any other type of variable is used, a <code>404</code> is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope of variable to be returned. When <em><code>local</code></em>, only task-local variable value is returned. When <em><code>global</code></em>, only variable value from the task&#8217;s parent execution-hierarchy are returned. When the parameter is omitted, a local variable will be returned if it exists, otherwise a global variable.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 118. Get the binary data for a variable - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was found and the requested variables are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the task doesn&#8217;t have a variable with the given name (in the given scope) or the variable doesn&#8217;t have a binary stream available. Status message provides additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>The response body contains the binary value of the variable. When the variable is of type <code>binary</code>, the content-type of the response is set to <code>application/octet-stream</code>, regardless of the content of the variable or the request accept-type header. In case of <code>serializable</code>, <code>application/x-java-serialized-object</code> is used as content-type.</p>
</div>
</div>
<div class="sect4">
<h5 id="_create_new_variables_on_a_task">Create new variables on a task</h5>
<div class="listingblock">
<div class="content">
<pre>POST runtime/tasks/{taskId}/variables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 119. Create new variables on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to create the new variable for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body for creating simple (non-binary) variables:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">[</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myTaskVariable&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Hello my friend&quot;</span>
  <span class="tok-p">},</span>
  <span class="tok-p">{</span>

  <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The request body should be an array containing one or more JSON-objects representing the variables that should be created.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Required name of the variable</p>
</li>
<li>
<p><code>scope</code>: Scope of variable that is created. If omitted, <code>local</code> is assumed.</p>
</li>
<li>
<p><code>type</code>: Type of variable that is created. If omitted, reverts to raw JSON-value type (string, boolean, integer or double).</p>
</li>
<li>
<p><code>value</code>: Variable value.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>More information about the variable format can be found in <a href="#restVariables">the REST variables section</a>.</p>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">[</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myTaskVariable&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Hello my friend&quot;</span>
  <span class="tok-p">},</span>
  <span class="tok-p">{</span>

  <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 120. Create new variables on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the variables were created and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the name of a variable to create was missing or that an attempt is done to create a variable on a standalone task (without a process associated) with scope <code>global</code> or an empty array of variables was included in the request or request did not contain an array of variables. Status message provides additional information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task already has a variable with the given name. Use the PUT method to update the task variable instead.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_create_a_new_binary_variable_on_a_task">Create a new binary variable on a task</h5>
<div class="listingblock">
<div class="content">
<pre>POST runtime/tasks/{taskId}/variables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 121. Create a new binary variable on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to create the new variable for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="paragraph">
<p>The request should be of type <code>multipart/form-data</code>. There should be a single file-part included with the binary value of the variable. On top of that, the following additional form-fields can be present:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Required name of the variable.</p>
</li>
<li>
<p><code>scope</code>: Scope of variable that is created. If omitted, <code>local</code> is assumed.</p>
</li>
<li>
<p><code>type</code>: Type of variable that is created. If omitted, <code>binary</code> is assumed and the binary data in the request will be stored as an array of bytes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binaryVariable&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binary&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;valueUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://.../runtime/tasks/123/variables/binaryVariable/data&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 122. Create a new binary variable on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the variable was created and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the name of the variable to create was missing or that an attempt is done to create a variable on a standalone task (without a process associated) with scope <code>global</code>. Status message provides additional information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task already has a variable with the given name. Use the PUT method to update the task variable instead.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">415</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the serializable data contains an object for which no class is present in the JVM running the Flowable engine and therefore cannot be deserialized.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_update_an_existing_variable_on_a_task">Update an existing variable on a task</h5>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/tasks/{taskId}/variables/{variableName}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 123. Update an existing variable on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to update the variable for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the variable to update.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body for updating simple (non-binary) variables:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myTaskVariable&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Hello my friend&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Required name of the variable</p>
</li>
<li>
<p><code>scope</code>: Scope of variable that is updated. If omitted, <code>local</code> is assumed.</p>
</li>
<li>
<p><code>type</code>: Type of variable that is updated. If omitted, reverts to raw JSON-value type (string, boolean, integer or double).</p>
</li>
<li>
<p><code>value</code>: Variable value.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>More information about the variable format can be found in <a href="#restVariables">the REST variables section</a>.</p>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myTaskVariable&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Hello my friend&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 124. Update an existing variable on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the variables was updated and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the name of a variable to update was missing or that an attempt is done to update a variable on a standalone task (without a process associated) with scope <code>global</code>. Status message provides additional information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the task doesn&#8217;t have a variable with the given name in the given scope. Status message contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_updating_a_binary_variable_on_a_task">Updating a binary variable on a task</h5>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/tasks/{taskId}/variables/{variableName}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 125. Updating a binary variable on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to update the variable for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the variable to update.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="paragraph">
<p>The request should be of type <code>multipart/form-data</code>. There should be a single file-part included with the binary value of the variable. On top of that, the following additional form-fields can be present:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Required name of the variable.</p>
</li>
<li>
<p><code>scope</code>: Scope of variable that is updated. If omitted, <code>local</code> is assumed.</p>
</li>
<li>
<p><code>type</code>: Type of variable that is updated. If omitted, <code>binary</code> is assumed and the binary data in the request will be stored as an array of bytes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binaryVariable&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binary&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;valueUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://.../runtime/tasks/123/variables/binaryVariable/data&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 126. Updating a binary variable on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the variable was updated and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the name of the variable to update was missing or that an attempt is done to update a variable on a standalone task (without a process associated) with scope <code>global</code>. Status message provides additional information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the variable to update doesn&#8217;t exist for the given task in the given scope.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">415</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the serializable data contains an object for which no class is present in the JVM running the Flowable engine and therefore cannot be deserialized.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_delete_a_variable_on_a_task">Delete a variable on a task</h5>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/tasks/{taskId}/variables/{variableName}?scope={scope}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 127. Delete a variable on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task the variable to delete belongs to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the variable to delete.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope of variable to delete in. Can be either <code>local</code> or <code>global</code>. If omitted, <code>local</code> is assumed.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 128. Delete a variable on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task variable was found and has been deleted. Response-body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the task doesn&#8217;t have a variable with the given name. Status message contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_delete_all_local_variables_on_a_task">Delete all local variables on a task</h5>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/tasks/{taskId}/variables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 129. Delete all local variables on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task the variable to delete belongs to.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 130. Delete all local variables on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates all local task variables have been deleted. Response-body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_all_identity_links_for_a_task">Get all identity links for a task</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 131. Get all identity links for a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get the identity links for.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 132. Get all identity links for a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was found and the requested identity links are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-p">[</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;userId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;groupId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;candidate&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/runtime/tasks/100/identitylinks/users/kermit/candidate&quot;</span>
  <span class="tok-p">},</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;userId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;groupId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;sales&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;candidate&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/runtime/tasks/100/identitylinks/groups/sales/candidate&quot;</span>
  <span class="tok-p">},</span>

  <span class="tok-err">...</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_get_all_identitylinks_for_a_task_for_either_groups_or_users">Get all identitylinks for a task for either groups or users</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/identitylinks/users
GET runtime/tasks/{taskId}/identitylinks/groups</pre>
</div>
</div>
<div class="paragraph">
<p>Returns only identity links targeting either users or groups. Response body and status-codes are exactly the same as when getting the full list of identity links for a task.</p>
</div>
</div>
<div class="sect4">
<h5 id="_get_a_single_identity_link_on_a_task">Get a single identity link on a task</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/identitylinks/{family}/{identityId}/{type}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 133. Get all identitylinks for a task for either groups or users - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task .</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">family</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either <code>groups</code> or <code>users</code>, depending on what kind of identity is targeted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">identityId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the identity.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of identity link.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 134. Get all identitylinks for a task for either groups or users - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task and identity link was found and returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the task doesn&#8217;t have the requested identityLink. The status contains additional information about this error.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;userId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;groupId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;sales&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;candidate&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/runtime/tasks/100/identitylinks/groups/sales/candidate&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_create_an_identity_link_on_a_task">Create an identity link on a task</h5>
<div class="listingblock">
<div class="content">
<pre>POST runtime/tasks/{taskId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 135. Create an identity link on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task .</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body (user):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;userId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;candidate&quot;</span><span class="tok-p">,</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body (group):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;groupId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;sales&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;candidate&quot;</span><span class="tok-p">,</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 136. Create an identity link on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was found and the identity link was created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the task doesn&#8217;t have the requested identityLink. The status contains additional information about this error.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;userId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;groupId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;sales&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;candidate&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/runtime/tasks/100/identitylinks/groups/sales/candidate&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_delete_an_identity_link_on_a_task">Delete an identity link on a task</h5>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/tasks/{taskId}/identitylinks/{family}/{identityId}/{type}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 137. Delete an identity link on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">family</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either <code>groups</code> or <code>users</code>, depending on what kind of identity is targeted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">identityId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the identity.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of identity link.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 138. Delete an identity link on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task and identity link were found and the link has been deleted. Response-body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the task doesn&#8217;t have the requested identityLink. The status contains additional information about this error.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_create_a_new_comment_on_a_task">Create a new comment on a task</h5>
<div class="listingblock">
<div class="content">
<pre>POST runtime/tasks/{taskId}/comments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 139. Create a new comment on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to create the comment for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a comment on the task.&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;saveProcessInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">true</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Parameter <code>saveProcessInstanceId</code> is optional, if <code>true</code> save process instance id of task with comment.</p>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;123&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/runtime/tasks/101/comments/123&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/history/historic-process-instances/100/comments/123&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a comment on the task.&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;author&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2014-07-13T13:13:52.232+08:00&quot;</span>
  <span class="tok-s2">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;101&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;100&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 140. Create a new comment on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the comment was created and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the comment is missing from the request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_all_comments_on_a_task">Get all comments on a task</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/comments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 141. Get all comments on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get the comments for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</div></td><td class="code"><span></span><span class="tok-p">[</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;123&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/runtime/tasks/101/comments/123&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/history/historic-process-instances/100/comments/123&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a comment on the task.&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;author&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span>
    <span class="tok-s2">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2014-07-13T13:13:52.232+08:00&quot;</span>
    <span class="tok-s2">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;101&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;100&quot;</span>
  <span class="tok-p">},</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;456&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/runtime/tasks/101/comments/456&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/history/historic-process-instances/100/comments/456&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is another comment on the task.&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;author&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;gonzo&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2014-07-13T13:13:52.232+08:00&quot;</span>
    <span class="tok-s2">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;101&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;100&quot;</span>
  <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 142. Get all comments on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was found and the comments are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_a_comment_on_a_task">Get a comment on a task</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/comments/{commentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 143. Get a comment on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get the comment for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">commentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the comment.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;123&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/runtime/tasks/101/comments/123&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/history/historic-process-instances/100/comments/123&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a comment on the task.&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;author&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2014-07-13T13:13:52.232+08:00&quot;</span>
  <span class="tok-s2">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;101&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;100&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 144. Get a comment on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task and comment were found and the comment is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the tasks doesn&#8217;t have a comment with the given ID.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_delete_a_comment_on_a_task">Delete a comment on a task</h5>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/tasks/{taskId}/comments/{commentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 145. Delete a comment on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to delete the comment for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">commentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the comment.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 146. Delete a comment on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task and comment were found and the comment is deleted. Response body is left empty intentionally.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the tasks doesn&#8217;t have a comment with the given ID.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_all_events_for_a_task">Get all events for a task</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/events</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 147. Get all events for a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get the events for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-p">[</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;action&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;AddUserLink&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span> <span class="tok-s2">&quot;gonzo&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;contributor&quot;</span> <span class="tok-p">],</span>
    <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-05-17T11:50:50.000+0000&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2/events/4&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;userId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
  <span class="tok-p">}</span>

<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 148. Get all events for a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was found and the events are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_an_event_on_a_task">Get an event on a task</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/events/{eventId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 149. Get an event on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get the event for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eventId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the event.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;AddUserLink&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span> <span class="tok-s2">&quot;gonzo&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;contributor&quot;</span> <span class="tok-p">],</span>
  <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-05-17T11:50:50.000+0000&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2/events/4&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;userId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 150. Get an event on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task and event were found and the event is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the tasks doesn&#8217;t have an event with the given ID.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_create_a_new_attachment_on_a_task_containing_a_link_to_an_external_resource">Create a new attachment on a task, containing a link to an external resource</h5>
<div class="listingblock">
<div class="content">
<pre>POST runtime/tasks/{taskId}/attachments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 151. Create a new attachment on a task, containing a link to an external resource - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to create the attachment for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Simple attachment&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Simple attachment description&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;simpleType&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;externalUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://flowable.org&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Only the attachment name is required to create a new attachment.</p>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2/attachments/3&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Simple attachment&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Simple attachment description&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;simpleType&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;externalUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://flowable.org&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;contentUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 152. Create a new attachment on a task, containing a link to an external resource - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the attachment was created and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the attachment name is missing from the request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_create_a_new_attachment_on_a_task_with_an_attached_file">Create a new attachment on a task, with an attached file</h5>
<div class="listingblock">
<div class="content">
<pre>POST runtime/tasks/{taskId}/attachments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 153. Create a new attachment on a task, with an attached file - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to create the attachment for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="paragraph">
<p>The request should be of type <code>multipart/form-data</code>. There should be a single file-part included with the binary value of the variable. On top of that, the following additional form-fields can be present:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Required name of the variable.</p>
</li>
<li>
<p><code>description</code>: Description of the attachment, optional.</p>
</li>
<li>
<p><code>type</code>: Type of attachment, optional. Supports any arbitrary string or a valid HTTP content-type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">{</span>
	<span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
	<span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2/attachments/5&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Binary attachment&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Binary attachment description&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;binaryType&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;taskUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;externalUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;contentUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2/attachments/5/content&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 154. Create a new attachment on a task, with an attached file - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the attachment was created and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the attachment name is missing from the request or no file was present in the request. The error-message contains additional information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_all_attachments_on_a_task">Get all attachments on a task</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/attachments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 155. Get all attachments on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get the attachments for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</div></td><td class="code"><span></span><span class="tok-p">[</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2/attachments/3&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Simple attachment&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Simple attachment description&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;simpleType&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;taskUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;externalUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://flowable.org&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;contentUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
  <span class="tok-p">},</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2/attachments/5&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Binary attachment&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Binary attachment description&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;binaryType&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;taskUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;externalUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;contentUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2/attachments/5/content&quot;</span>
  <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 156. Get all attachments on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was found and the attachments are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_an_attachment_on_a_task">Get an attachment on a task</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/attachments/{attachmentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 157. Get an attachment on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get the attachment for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">attachmentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the attachment.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2/attachments/5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Binary attachment&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Binary attachment description&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;binaryType&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;externalUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;contentUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2/attachments/5/content&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>externalUrl - contentUrl:</code>In case the attachment is a link to an external resource, the <code>externalUrl</code> contains the URL to the external content. If the attachment content is present in the Flowable engine, the <code>contentUrl</code> will contain an URL where the binary content can be streamed from.</p>
</li>
<li>
<p><code>type:</code>Can be any arbitrary value. When a valid formatted media-type (e.g. application/xml, text/plain) is included, the binary content HTTP response content-type will be set the the given value.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 158. Get an attachment on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task and attachment were found and the attachment is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the tasks doesn&#8217;t have a attachment with the given ID.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_the_content_for_an_attachment">Get the content for an attachment</h5>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/attachment/{attachmentId}/content</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 159. Get the content for an attachment - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get a variable data for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">attachmentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the attachment, a <code>404</code> is returned when the attachment points to an external URL rather than content attached in Flowable.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 160. Get the content for an attachment - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task and attachment was found and the requested content is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the task doesn&#8217;t have an attachment with the given id or the attachment doesn&#8217;t have a binary stream available. Status message provides additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>The response body contains the binary content. By default, the content-type of the response is set to <code>application/octet-stream</code> unless the attachment type contains a valid Content-type.</p>
</div>
</div>
<div class="sect4">
<h5 id="_delete_an_attachment_on_a_task">Delete an attachment on a task</h5>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/tasks/{taskId}/attachments/{attachmentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 161. Delete an attachment on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to delete the attachment for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">attachmentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the attachment.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 162. Delete an attachment on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task and attachment were found and the attachment is deleted. Response body is left empty intentionally.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the tasks doesn&#8217;t have a attachment with the given ID.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_history_2">4.1.7. History</h4>
<div class="sect4">
<h5 id="_get_a_historic_process_instance">Get a historic process instance</h5>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-process-instances/{processInstanceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 163. Get a historic process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that the historic process instances could be found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that the historic process instances could not be found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;businessKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myKey&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;endTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T14:06:32.715+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;durationInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">86400056</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startUserId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startActivityId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;startEvent&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;endActivityId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;endEvent&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deleteReason&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;superProcessInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="restHistoricProcessInstancesGet">List of historic process instances</h5>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-process-instances</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 164. List of historic process instances - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An id of the historic process instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process definition key of the historic process instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process definition id of the historic process instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">businessKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The business key of the historic process instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">involvedUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An involved user of the historic process instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">finished</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication if the historic process instance is finished.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">superProcessInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional parent process id of the historic process instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludeSubprocesses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic process instances which aren&#8217;t sub processes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">finishedAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic process instances that were finished after this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">finishedBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic process instances that were finished before this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startedAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic process instances that were started after this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startedBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic process instances that were started before this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startedBy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic process instances that were started by this user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeProcessVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An indication if the historic process instance variables should be returned as well.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return instances with the given tenantId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return instances with a tenantId like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only returns instances without a tenantId set. If <code>false</code>, the <code>withoutTenantId</code> parameter is ignored.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 165. List of historic process instances - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that historic process instances could be queried.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;businessKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myKey&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;endTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T14:06:32.715+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;durationInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">86400056</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startUserId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startActivityId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;startEvent&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;endActivityId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;endEvent&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deleteReason&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;superProcessInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span>
          <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;test&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;variableScope&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;myTest&quot;</span>
        <span class="tok-p">}</span>
      <span class="tok-p">],</span>
      <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_query_for_historic_process_instances">Query for historic process instances</h5>
<div class="listingblock">
<div class="content">
<pre>POST query/historic-process-instances</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>


  <span class="tok-nt">&quot;variables&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myVariable&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">1234</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;operation&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;equals&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;long&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All supported JSON parameter fields allowed are exactly the same as the parameters found for <a href="#restHistoricProcessInstancesGet">getting a collection of historic process instances</a>, but passed in as JSON-body arguments rather than URL-parameters to allow for more advanced querying and preventing errors with request-uri&#8217;s that are too long. On top of that, the query allows for filtering based on process variables. The <code>variables</code> property is a JSON-array containing objects with the format <a href="#restQueryVariable">as described here.</a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 166. Query for historic process instances - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the tasks are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;businessKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myKey&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;endTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T14:06:32.715+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;durationInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">86400056</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startUserId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startActivityId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;startEvent&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;endActivityId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;endEvent&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deleteReason&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;superProcessInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span>
          <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;test&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;variableScope&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;myTest&quot;</span>
        <span class="tok-p">}</span>
      <span class="tok-p">],</span>
      <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_delete_a_historic_process_instance">Delete a historic process instance</h5>
<div class="listingblock">
<div class="content">
<pre>DELETE history/historic-process-instances/{processInstanceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 167. Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that the historic process instance was deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that the historic process instance could not be found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_the_identity_links_of_a_historic_process_instance">Get the identity links of a historic process instance</h5>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-process-instance/{processInstanceId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 168. Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the identity links are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance could not be found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">[</span>
 <span class="tok-p">{</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;participant&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;userId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;groupId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/5&quot;</span>
 <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_get_the_binary_data_for_a_historic_process_instance_variable">Get the binary data for a historic process instance variable</h5>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-process-instances/{processInstanceId}/variables/{variableName}/data</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 169. Get the binary data for a historic process instance variable - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and the requested variable data is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found or the process instance doesn&#8217;t have a variable with the given name or the variable doesn&#8217;t have a binary stream available. Status message provides additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>The response body contains the binary value of the variable. When the variable is of type <code>binary</code>, the content-type of the response is set to <code>application/octet-stream</code>, regardless of the content of the variable or the request accept-type header. In case of <code>serializable</code>, <code>application/x-java-serialized-object</code> is used as content-type.</p>
</div>
</div>
<div class="sect4">
<h5 id="_create_a_new_comment_on_a_historic_process_instance">Create a new comment on a historic process instance</h5>
<div class="listingblock">
<div class="content">
<pre>POST history/historic-process-instances/{processInstanceId}/comments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 170. Create a new comment on a historic process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to create the comment for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a comment.&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;saveProcessInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">true</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Parameter <code>saveProcessInstanceId</code> is optional, if <code>true</code> save process instance id of task with comment.</p>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;123&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/runtime/tasks/101/comments/123&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/history/historic-process-instances/100/comments/123&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a comment on the task.&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;author&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2014-07-13T13:13:52.232+08:00&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;101&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;100&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 171. Create a new comment on a historic process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the comment was created and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the comment is missing from the request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested historic process instance was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_all_comments_on_a_historic_process_instance">Get all comments on a historic process instance</h5>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-process-instances/{processInstanceId}/comments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 172. Get all comments on a process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to get the comments for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</div></td><td class="code"><span></span><span class="tok-p">[</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;123&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/history/historic-process-instances/100/comments/123&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a comment on the task.&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;author&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2014-07-13T13:13:52.232+08:00&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;100&quot;</span>
  <span class="tok-p">},</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;456&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/history/historic-process-instances/100/comments/456&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is another comment.&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;author&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;gonzo&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2014-07-14T15:16:52.232+08:00&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;100&quot;</span>
  <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 173. Get all comments on a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and the comments are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_a_comment_on_a_historic_process_instance">Get a comment on a historic process instance</h5>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-process-instances/{processInstanceId}/comments/{commentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 174. Get a comment on a historic process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the historic process instance to get the comment for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">commentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the comment.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;123&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/history/historic-process-instances/100/comments/456&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is another comment.&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;author&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;gonzo&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2014-07-14T15:16:52.232+08:00&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;100&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 175. Get a comment on a historic process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the historic process instance and comment were found and the comment is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested historic process instance was not found or the historic process instance doesn&#8217;t have a comment with the given ID.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_delete_a_comment_on_a_historic_process_instance">Delete a comment on a historic process instance</h5>
<div class="listingblock">
<div class="content">
<pre>DELETE history/historic-process-instances/{processInstanceId}/comments/{commentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 176. Delete a comment on a historic process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the historic process instance to delete the comment for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">commentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the comment.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 177. Delete a comment on a historic process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the historic process instance and comment were found and the comment is deleted. Response body is left empty intentionally.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the historic process instance doesn&#8217;t have a comment with the given ID.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_a_single_historic_task_instance">Get a single historic task instance</h5>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-task-instances/{taskId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 178. Get a single historic task instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that the historic task instances could be found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that the historic task instances could not be found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processDefinitionUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/3&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;executionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My task name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My task description&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;deleteReason&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;owner&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;fozzie&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;startTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;endTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T14:06:32.715+0000&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;durationInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">86400056</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;workTimeInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">234890</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;claimTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T11:01:54.715+0000&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskDefinitionKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;taskKey&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;formKey&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;priority&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">50</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;dueDate&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-20T12:11:13.134+0000&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;parentTaskId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-task-instances/5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="restHistoricTaskInstancesGet">Get historic task instances</h5>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-task-instances</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 179. Get historic task instances - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An id of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process instance id of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process definition key of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionKeyLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process definition key of the historic task instance, which matches the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process definition id of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process definition name of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process definition name of the historic task instance, which matches the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processBusinessKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process instance business key of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processBusinessKeyLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process instance business key of the historic task instance that matches the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The execution id of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task definition key for tasks part of a process</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task name of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task name with <em>like</em> operator for the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDescription</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task description of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDescriptionLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task description with <em>like</em> operator for the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task identifier from the process definition for the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskCategory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select tasks with the given category. Note that this is the task category, not the category of the process definition (namespace within the BPMN Xml).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDeleteReason</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task delete reason of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDeleteReasonLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task delete reason with <em>like</em> operator for the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskAssignee</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The assignee of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskAssigneeLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The assignee with <em>like</em> operator for the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskOwner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The owner of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskOwnerLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The owner with <em>like</em> operator for the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskInvolvedUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An involved user of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskPriority</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The priority of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">finished</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication if the historic task instance is finished.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processFinished</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication if the process instance of the historic task instance is finished.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parentTaskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional parent task id of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic task instances that have a due date equal this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueDateAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic task instances that have a due date after this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueDateBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic task instances that have a due date before this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutDueDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic task instances that have no due-date. When <code>false</code> is provided as value, this parameter is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskCompletedOn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic task instances that have been completed on this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskCompletedAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic task instances that have been completed after this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskCompletedBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic task instances that have been completed before this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskCreatedOn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic task instances that were created on this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskCreatedBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic task instances that were created before this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskCreatedAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic task instances that were created after this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeTaskLocalVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An indication if the historic task instance local variables should be returned as well.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeProcessVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An indication if the historic task instance global variables should be returned as well.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return historic task instances with the given tenantId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return historic task instances with a tenantId like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only returns historic task instances without a tenantId set. If <code>false</code>, the <code>withoutTenantId</code> parameter is ignored.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 180. Get historic task instances - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that historic process instances could be queried.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;executionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My task name&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My task description&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deleteReason&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;owner&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;fozzie&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;endTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T14:06:32.715+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;durationInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">86400056</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;workTimeInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">234890</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;claimTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T11:01:54.715+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskDefinitionKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;taskKey&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;formKey&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;priority&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">50</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;dueDate&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-20T12:11:13.134+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;parentTaskId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-task-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskVariables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span>
          <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;test&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;variableScope&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;myTest&quot;</span>
        <span class="tok-p">}</span>
      <span class="tok-p">],</span>
      <span class="tok-nt">&quot;processVariables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span>
          <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;processTest&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;variableScope&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;global&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;myProcessTest&quot;</span>
        <span class="tok-p">}</span>
      <span class="tok-p">],</span>
      <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_query_for_historic_task_instances">Query for historic task instances</h5>
<div class="listingblock">
<div class="content">
<pre>POST query/historic-task-instances</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Query for historic task instances - Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
  <span class="tok-err">...</span>

  <span class="tok-nt">&quot;variables&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myVariable&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">1234</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;operation&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;equals&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;long&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All supported JSON parameter fields allowed are exactly the same as the parameters found for <a href="#restHistoricTaskInstancesGet">getting a collection of historic task instances</a>, but passed in as JSON-body arguments rather than URL-parameters to allow for more advanced querying and preventing errors with request-uri&#8217;s that are too long. On top of that, the query allows for filtering based on process variables. The <code>taskVariables</code> and <code>processVariables</code> properties are JSON-arrays containing objects with the format <a href="#restQueryVariable">as described here.</a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 181. Query for historic task instances - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the tasks are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;executionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My task name&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My task description&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deleteReason&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;owner&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;fozzie&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;endTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T14:06:32.715+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;durationInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">86400056</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;workTimeInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">234890</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;claimTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T11:01:54.715+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskDefinitionKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;taskKey&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;formKey&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;priority&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">50</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;dueDate&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-20T12:11:13.134+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;parentTaskId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-task-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskVariables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span>
          <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;test&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;variableScope&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;myTest&quot;</span>
        <span class="tok-p">}</span>
      <span class="tok-p">],</span>
      <span class="tok-nt">&quot;processVariables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span>
          <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;processTest&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;variableScope&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;global&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;myProcessTest&quot;</span>
        <span class="tok-p">}</span>
      <span class="tok-p">],</span>
      <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_delete_a_historic_task_instance">Delete a historic task instance</h5>
<div class="listingblock">
<div class="content">
<pre>DELETE history/historic-task-instances/{taskId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 182. Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that the historic task instance was deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that the historic task instance could not be found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_the_identity_links_of_a_historic_task_instance">Get the identity links of a historic task instance</h5>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-task-instance/{taskId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 183. Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the identity links are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task instance could not be found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">[</span>
 <span class="tok-p">{</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;assignee&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;userId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;groupId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;6&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-task-instances/5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
 <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_get_the_binary_data_for_a_historic_task_instance_variable">Get the binary data for a historic task instance variable</h5>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-task-instances/{taskId}/variables/{variableName}/data</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 184. Get the binary data for a historic task instance variable - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task instance was found and the requested variable data is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task instance was not found or the process instance doesn&#8217;t have a variable with the given name or the variable doesn&#8217;t have a binary stream available. Status message provides additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>The response body contains the binary value of the variable. When the variable is of type <code>binary</code>, the content-type of the response is set to <code>application/octet-stream</code>, regardless of the content of the variable or the request accept-type header. In case of <code>serializable</code>, <code>application/x-java-serialized-object</code> is used as content-type.</p>
</div>
</div>
<div class="sect4">
<h5 id="restHistoricActivityInstancesGet">Get historic activity instances</h5>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-activity-instances</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 185. Get historic activity instances - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">activityId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An id of the activity instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">activityInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An id of the historic activity instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">activityName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the historic activity instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">activityType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The element type of the historic activity instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The execution id of the historic activity instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">finished</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication if the historic activity instance is finished.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskAssignee</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The assignee of the historic activity instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process instance id of the historic activity instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process definition id of the historic activity instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return instances with the given tenantId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return instances with a tenantId like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only returns instances without a tenantId set. If <code>false</code>, the <code>withoutTenantId</code> parameter is ignored.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 186. Get historic activity instances - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that historic activity instances could be queried.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;activityId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;activityName&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My user task&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;activityType&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;userTask&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;executionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;calledProcessInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;fozzie&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;endTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T14:06:32.715+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;durationInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">86400056</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_query_for_historic_activity_instances">Query for historic activity instances</h5>
<div class="listingblock">
<div class="content">
<pre>POST query/historic-activity-instances</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All supported JSON parameter fields allowed are exactly the same as the parameters found for <a href="#restHistoricTaskInstancesGet">getting a collection of historic task instances</a>, but passed in as JSON-body arguments rather than URL-parameters to allow for more advanced querying and preventing errors with request-uri&#8217;s that are too long.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 187. Query for historic activity instances - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the activities are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;activityId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;activityName&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My user task&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;activityType&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;userTask&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;executionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;calledProcessInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;fozzie&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;endTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T14:06:32.715+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;durationInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">86400056</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="restHistoricVariableInstancesGet">List of historic variable instances</h5>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-variable-instances</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 188. List of historic variable instances - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process instance id of the historic variable instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task id of the historic variable instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludeTaskVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication to exclude the task variables from the result.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The variable name of the historic variable instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The variable name using the <em>like</em> operator for the historic variable instance.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 189. List of historic variable instances - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that historic variable instances could be queried.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;14&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;6&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;variable&quot;</span> <span class="tok-p">:</span> <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myVariable&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;variableScope&quot;</span><span class="tok-p">,</span> <span class="tok-nt">&quot;global&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;test&quot;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_query_for_historic_variable_instances">Query for historic variable instances</h5>
<div class="listingblock">
<div class="content">
<pre>POST query/historic-variable-instances</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
  <span class="tok-err">...</span>

  <span class="tok-nt">&quot;variables&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myVariable&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">1234</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;operation&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;equals&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;long&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All supported JSON parameter fields allowed are exactly the same as the parameters found for <a href="#restHistoricVariableInstancesGet">getting a collection of historic process instances</a>, but passed in as JSON-body arguments rather than URL-parameters to allow for more advanced querying and preventing errors with request-uri&#8217;s that are too long. On top of that, the query allows for filtering based on process variables. The <code>variables</code> property is a JSON-array containing objects with the format <a href="#restQueryVariable">as described here.</a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 190. Query for historic variable instances - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the tasks are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;14&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;6&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;variable&quot;</span> <span class="tok-p">:</span> <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myVariable&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;variableScope&quot;</span><span class="tok-p">,</span> <span class="tok-nt">&quot;global&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;test&quot;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>====Get the binary data for a historic task instance variable</p>
</div>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-variable-instances/{varInstanceId}/data</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 191. Get the binary data for a historic task instance variable - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the variable instance was found and the requested variable data is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested variable instance was not found or the variable instance doesn&#8217;t have a variable with the given name or the variable doesn&#8217;t have a binary stream available. Status message provides additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>The response body contains the binary value of the variable. When the variable is of type <code>binary</code>, the content-type of the response is set to <code>application/octet-stream</code>, regardless of the content of the variable or the request accept-type header. In case of <code>serializable</code>, <code>application/x-java-serialized-object</code> is used as content-type.</p>
</div>
</div>
<div class="sect4">
<h5 id="restHistoricDetailGet">Get historic detail</h5>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-detail</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 192. Get historic detail - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the historic detail.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process instance id of the historic detail.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The execution id of the historic detail.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">activityInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The activity instance id of the historic detail.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task id of the historic detail.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">selectOnlyFormProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication to only return form properties in the result.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">selectOnlyVariableUpdates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication to only return variable updates in the result.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 193. Get historic detail - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that historic detail could be queried.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;26&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;executionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;6&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;activityInstanceId&quot;</span><span class="tok-p">,</span> <span class="tok-nt">&quot;10&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;6&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-task-instances/6&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;detailType&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;variableUpdate&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;revision&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">2</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;variable&quot;</span> <span class="tok-p">:</span> <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myVariable&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;variableScope&quot;</span><span class="tok-p">,</span> <span class="tok-nt">&quot;global&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;test&quot;</span>
      <span class="tok-p">},</span>
      <span class="tok-nt">&quot;propertyId&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;propertyValue&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_query_for_historic_details">Query for historic details</h5>
<div class="listingblock">
<div class="content">
<pre>POST query/historic-detail</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "processInstanceId" : "5",
}</pre>
</div>
</div>
<div class="paragraph">
<p>All supported JSON parameter fields allowed are exactly the same as the parameters found for <a href="#restHistoricDetailGet">getting a collection of historic process instances</a>, but passed in as JSON-body arguments rather than URL-parameters to allow for more advanced querying and preventing errors with request-uri&#8217;s that are too long.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 194. Query for historic details - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the historic details are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;26&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;executionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;6&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;activityInstanceId&quot;</span><span class="tok-p">,</span> <span class="tok-nt">&quot;10&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;6&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-task-instances/6&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;detailType&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;variableUpdate&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;revision&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">2</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;variable&quot;</span> <span class="tok-p">:</span> <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myVariable&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;variableScope&quot;</span><span class="tok-p">,</span> <span class="tok-nt">&quot;global&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;test&quot;</span>
      <span class="tok-p">},</span>
      <span class="tok-nt">&quot;propertyId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;propertyValue&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_get_the_binary_data_for_a_historic_detail_variable">Get the binary data for a historic detail variable</h5>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-detail/{detailId}/data</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 195. Get the binary data for a historic detail variable - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the historic detail instance was found and the requested variable data is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested historic detail instance was not found or the historic detail instance doesn&#8217;t have a variable with the given name or the variable doesn&#8217;t have a binary stream available. Status message provides additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>The response body contains the binary value of the variable. When the variable is of type <code>binary</code>, the content-type of the response is set to <code>application/octet-stream</code>, regardless of the content of the variable or the request accept-type header. In case of <code>serializable</code>, <code>application/x-java-serialized-object</code> is used as content-type.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_forms_2">4.1.8. Forms</h4>
<div class="sect4">
<h5 id="_get_form_data">Get form data</h5>
<div class="listingblock">
<div class="content">
<pre>GET form/form-data</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 196. Get form data - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes (if no processDefinitionId)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task id corresponding to the form data that needs to be retrieved.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes (if no taskId)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process definition id corresponding to the start event form data that needs to be retrieved.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 197. Get form data - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that form data could be queried.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that form data could not be found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;formKey&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deploymentId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definition/3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;6&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/task/6&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;formProperties&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span>
          <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;room&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Room&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;readable&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">true</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;writable&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">true</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;required&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">true</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;datePattern&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;enumValues&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
            <span class="tok-p">{</span>
              <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;normal&quot;</span><span class="tok-p">,</span>
              <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Normal bed&quot;</span>
            <span class="tok-p">},</span>
            <span class="tok-p">{</span>
              <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kingsize&quot;</span><span class="tok-p">,</span>
              <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Kingsize bed&quot;</span>
            <span class="tok-p">},</span>
          <span class="tok-p">]</span>
        <span class="tok-p">}</span>
      <span class="tok-p">]</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_submit_task_form_data">Submit task form data</h5>
<div class="listingblock">
<div class="content">
<pre>POST form/form-data</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body for task form:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;properties&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;room&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;normal&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body for start event form:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;businessKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myKey&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;properties&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;room&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;normal&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 198. Submit task form data - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the form data was submitted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body for start event form data (no response for task form data):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;businessKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myKey&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span> <span class="tok-kc">false</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processDefinitionUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definition/3&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;activityId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myTask&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_database_tables">4.1.9. Database tables</h4>
<div class="sect4">
<h5 id="_list_of_tables">List of tables</h5>
<div class="listingblock">
<div class="content">
<pre>GET management/tables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 199. List of tables - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the request was successful.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-p">[</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;ACT_RU_VARIABLE&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/management/tables/ACT_RU_VARIABLE&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;count&quot;</span><span class="tok-p">:</span><span class="tok-mi">4528</span>
   <span class="tok-p">},</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;ACT_RU_EVENT_SUBSCR&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/management/tables/ACT_RU_EVENT_SUBSCR&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;count&quot;</span><span class="tok-p">:</span><span class="tok-mi">3</span>
   <span class="tok-p">}</span>

<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_get_a_single_table">Get a single table</h5>
<div class="listingblock">
<div class="content">
<pre>GET management/tables/{tableName}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 200. Get a single table - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the table to get.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;ACT_RE_PROCDEF&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/management/tables/ACT_RE_PROCDEF&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;count&quot;</span><span class="tok-p">:</span><span class="tok-mi">60</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 201. Get a single table - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the table exists and the table count is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested table does not exist.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_column_info_for_a_single_table">Get column info for a single table</h5>
<div class="listingblock">
<div class="content">
<pre>GET management/tables/{tableName}/columns</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 202. Get column info for a single table - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the table to get.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span>
<span class="tok-p">{</span>
   <span class="tok-nt">&quot;tableName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;ACT_RU_VARIABLE&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;columnNames&quot;</span><span class="tok-p">:[</span>
      <span class="tok-s2">&quot;ID_&quot;</span><span class="tok-p">,</span>
      <span class="tok-s2">&quot;REV_&quot;</span><span class="tok-p">,</span>
      <span class="tok-s2">&quot;TYPE_&quot;</span><span class="tok-p">,</span>
      <span class="tok-s2">&quot;NAME_&quot;</span>


   <span class="tok-p">],</span>
   <span class="tok-nt">&quot;columnTypes&quot;</span><span class="tok-p">:[</span>
      <span class="tok-s2">&quot;VARCHAR&quot;</span><span class="tok-p">,</span>
      <span class="tok-s2">&quot;INTEGER&quot;</span><span class="tok-p">,</span>
      <span class="tok-s2">&quot;VARCHAR&quot;</span><span class="tok-p">,</span>
      <span class="tok-s2">&quot;VARCHAR&quot;</span>


   <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 203. Get column info for a single table - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the table exists and the table column info is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested table does not exist.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_row_data_for_a_single_table">Get row data for a single table</h5>
<div class="listingblock">
<div class="content">
<pre>GET management/tables/{tableName}/data</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 204. Get row data for a single table - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the table to get.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 205. Get row data for a single table - URL query parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">start</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Index of the first row to fetch. Defaults to 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of rows to fetch, starting from <code>start</code>. Defaults to 10.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">orderAscendingColumn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the column to sort the resulting rows on, ascending.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">orderDescendingColumn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the column to sort the resulting rows on, descending.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span><span class="tok-mi">3</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span><span class="tok-mi">3</span><span class="tok-p">,</span>

   <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:[</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;TASK_ID_&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;NAME_&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;var1&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;REV_&quot;</span><span class="tok-p">:</span><span class="tok-mi">1</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;TEXT_&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;123&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;LONG_&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;ID_&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;TYPE_&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span>
      <span class="tok-p">}</span>



   <span class="tok-p">]</span>

<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 206. Get row data for a single table - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the table exists and the table row data is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested table does not exist.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_engine_2">4.1.10. Engine</h4>
<div class="sect4">
<h5 id="_get_engine_properties">Get engine properties</h5>
<div class="listingblock">
<div class="content">
<pre>GET management/properties</pre>
</div>
</div>
<div class="paragraph">
<p>Returns a read-only view of the properties used internally in the engine.</p>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;next.dbid&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;101&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;schema.history&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;create(5.15)&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;schema.version&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5.15&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 207. Get engine properties - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the properties are returned.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_engine_info">Get engine info</h5>
<div class="listingblock">
<div class="content">
<pre>GET management/engine</pre>
</div>
</div>
<div class="paragraph">
<p>Returns a read-only view of the engine that is used in this REST-service.</p>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;default&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5.15&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;resourceUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;file://flowable/flowable.cfg.xml&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;exception&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 208. Get engine info - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the engine info is returned.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_runtime">4.1.11. Runtime</h4>
<div class="sect4">
<h5 id="_signal_event_received">Signal event received</h5>
<div class="listingblock">
<div class="content">
<pre>POST runtime/signals</pre>
</div>
</div>
<div class="paragraph">
<p>Notifies the engine that a signal event has been received, not explicitly related to a specific execution.</p>
</div>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;signalName&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;My Signal&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;execute&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;async&quot;</span><span class="tok-p">:</span> <span class="tok-kc">true</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
      <span class="tok-p">{</span><span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;testVar&quot;</span><span class="tok-p">,</span> <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;This is a string&quot;</span><span class="tok-p">}</span>

  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 209. Signal event received - JSON Body parameters</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">signalName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the signal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the tenant that the signal event should be processed in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">async</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, handling of the signal will happen asynchronously. Return code will be <code>202 - Accepted</code> to indicate the request is accepted but not yet executed. If <code>false</code>,
                    handling the signal will be done immediately and result (<code>200 - OK</code>) will only return after this completed successfully. Defaults to <code>false</code> if omitted.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of variables (in the general variables format) to use as payload to pass along with the signal. Cannot be used in case <code>async</code> is set to <code>true</code>, this will result in an error.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 210. Signal event received - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicated signal has been processed and no errors occurred.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">202</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicated signal processing is queued as a job, ready to be executed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signal not processed. The signal name is missing or variables are used together with async, which is not allowed. Response body contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_jobs">4.1.12. Jobs</h4>
<div class="sect4">
<h5 id="_get_a_single_job">Get a single job</h5>
<div class="listingblock">
<div class="content">
<pre>GET management/jobs/{jobId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 211. Get a single job - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jobId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the job to get.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;8&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/management/jobs/8&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processDefinitionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;timerProcess:1:4&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processDefinitionUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/timerProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;executionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;7&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;executionUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/executions/7&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;retries&quot;</span><span class="tok-p">:</span><span class="tok-mi">3</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;exceptionMessage&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;dueDate&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-06-04T22:05:05.474+0000&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 212. Get a single job - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the job exists and is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested job does not exist.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_delete_a_job">Delete a job</h5>
<div class="listingblock">
<div class="content">
<pre>DELETE management/jobs/{jobId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 213. Delete a job - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jobId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the job to delete.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 214. Delete a job - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the job was found and has been deleted. Response-body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested job was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_execute_a_single_job">Execute a single job</h5>
<div class="listingblock">
<div class="content">
<pre>POST management/jobs/{jobId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;execute&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 215. Execute a single job - JSON Body parameters</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">action</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action to perform. Only <code>execute</code> is supported.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 216. Execute a single job - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the job was executed. Response-body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested job was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the an exception occurred while executing the job. The status-description contains additional detail about the error. The full error-stacktrace can be fetched later on if needed.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_the_exception_stacktrace_for_a_job">Get the exception stacktrace for a job</h5>
<div class="listingblock">
<div class="content">
<pre>GET management/jobs/{jobId}/exception-stacktrace</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 217. Get the exception stacktrace for a job - URL parameters</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jobId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Id of the job to get the stacktrace for.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 218. Get the exception stacktrace for a job - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested job was not found and the stacktrace has been returned. The response contains the raw stacktrace and always has a Content-type of <code>text/plain</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested job was not found or the job doesn&#8217;t have an exception stacktrace. Status-description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_a_list_of_jobs">Get a list of jobs</h5>
<div class="listingblock">
<div class="content">
<pre>GET management/jobs</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 219. Get a list of jobs - URL query parameters</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return job with the given id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return jobs part of a process with the given id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return jobs part of an execution with the given id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return jobs with the given process definition id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withRetriesLeft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only return jobs with retries left. If false, this parameter is ignored.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only return jobs which are executable. If false, this parameter is ignored.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timersOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only return jobs which are timers. If false, this parameter is ignored. Cannot be used together with <code>'messagesOnly'</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">messagesOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only return jobs which are messages. If false, this parameter is ignored. Cannot be used together with <code>'timersOnly'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only return jobs for which an exception occurred while executing it. If false, this parameter is ignored.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return jobs which are due to be executed before the given date. Jobs without duedate are never returned using this parameter.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return jobs which are due to be executed after the given date. Jobs without duedate are never returned using this parameter.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">exceptionMessage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return jobs with the given exception message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return jobs with the given tenantId.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return jobs with a tenantId like the given value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only returns jobs without a tenantId set. If <code>false</code>, the <code>withoutTenantId</code> parameter is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field to sort results on, should be one of <code>id</code>, <code>dueDate</code>, <code>executionId</code>, <code>processInstanceId</code>, <code>retries</code> or <code>tenantId</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:[</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;13&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/management/jobs/13&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processDefinitionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;timerProcess:1:4&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processDefinitionUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/timerProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;executionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;12&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;executionUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/executions/12&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;retries&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;exceptionMessage&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Can&#39;t find scripting engine for &#39;unexistinglanguage&#39;&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;dueDate&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-06-07T10:00:24.653+0000&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
      <span class="tok-p">}</span>



   <span class="tok-p">],</span>
   <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;id&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 220. Get a list of jobs - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested jobs were returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an illegal value has been used in a url query parameter or the both <code>'messagesOnly'</code> and <code>'timersOnly'</code> are used as parameters. Status description contains additional details about the error.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_users">4.1.13. Users</h4>
<div class="sect4">
<h5 id="_get_a_single_user">Get a single user</h5>
<div class="listingblock">
<div class="content">
<pre>GET identity/users/{userId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 221. Get a single user - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to get.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;testuser&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;firstName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Fred&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;lastName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;McDonald&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/users/testuser&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;email&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;no-reply@flowable.org&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 222. Get a single user - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user exists and is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user does not exist.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_a_list_of_users">Get a list of users</h5>
<div class="listingblock">
<div class="content">
<pre>GET identity/users</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 223. Get a list of users - URL query parameters</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return user with the given id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">firstName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return users with the given firstname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return users with the given lastname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return users with the given email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">firstNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return users with a firstname like the given value. Use <code>%</code> as wildcard-character.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return users with a lastname like the given value. Use <code>%</code> as wildcard-character.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">emailLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return users with an email like the given value. Use <code>%</code> as wildcard-character.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">memberOfGroup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return users which are a member of the given group.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">potentialStarter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return users which are potential starters for a process-definition with the given id.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field to sort results on, should be one of <code>id</code>, <code>firstName</code>, <code>lastname</code> or <code>email</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:[</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;anotherUser&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;firstName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Tijs&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;lastName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Barrez&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/users/anotherUser&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;email&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;no-reply@flowable.org&quot;</span>
      <span class="tok-p">},</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;firstName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Kermit&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;lastName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;the Frog&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/users/kermit&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;email&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
      <span class="tok-p">},</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;testuser&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;firstName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Fred&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;lastName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;McDonald&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/users/testuser&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;email&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;no-reply@flowable.org&quot;</span>
      <span class="tok-p">}</span>
   <span class="tok-p">],</span>
   <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span><span class="tok-mi">3</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;id&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span><span class="tok-mi">3</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 224. Get a list of users - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested users were returned.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_update_a_user">Update a user</h5>
<div class="listingblock">
<div class="content">
<pre>PUT identity/users/{userId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;firstName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Tijs&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;lastName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Barrez&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;email&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;no-reply@flowable.org&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;password&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;pass123&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All request values are optional. For example, you can only include the <em>firstName</em> attribute in the request body JSON-object, only updating the firstName of the user, leaving all other fields unaffected. When an attribute is explicitly included and is set to null, the user-value will be updated to null. Example: <code>{"firstName" : null}</code> will clear the firstName of the user).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 225. Update a user - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user was updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user was updated simultaneously.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong> see response for <code>identity/users/{userId}</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_create_a_user">Create a user</h5>
<div class="listingblock">
<div class="content">
<pre>POST identity/users</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "id":"tijs",
  "firstName":"Tijs",
  "lastName":"Barrez",
  "email":"no-reply@flowable.org",
  "password":"pass123"
}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 226. Create a user - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user was created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the id of the user was missing.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong> see response for <code>identity/users/{userId}</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_delete_a_user">Delete a user</h5>
<div class="listingblock">
<div class="content">
<pre>DELETE identity/users/{userId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 227. Delete a user - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to delete.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 228. Delete a user - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user was found and  has been deleted. Response-body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_a_users_picture">Get a user&#8217;s picture</h5>
<div class="listingblock">
<div class="content">
<pre>GET identity/users/{userId}/picture</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 229. Get a user&#8217;s picture - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to get the picture for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Response Body:</strong></p>
</div>
<div class="paragraph">
<p>The response body contains the raw picture data, representing the user&#8217;s picture. The Content-type of the response corresponds to the mimeType that was set when creating the picture.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 230. Get a user&#8217;s picture - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user was found and has a picture, which is returned in the body.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user was not found or the user does not have a profile picture. Status-description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_updating_a_users_picture">Updating a user&#8217;s picture</h5>
<div class="listingblock">
<div class="content">
<pre>GET identity/users/{userId}/picture</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 231. Updating a user&#8217;s picture - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to get the picture for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="paragraph">
<p>The request should be of type <code>multipart/form-data</code>. There should be a single file-part included with the binary value of the picture. On top of that, the following additional form-fields can be present:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mimeType</code>: Optional mime-type for the uploaded picture. If omitted, the default of <code>image/jpeg</code> is used as a mime-type for the picture.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 232. Updating a user&#8217;s picture - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user was found and the picture has been updated. The response-body is left empty intentionally.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_list_a_users_info">List a user&#8217;s info</h5>
<div class="listingblock">
<div class="content">
<pre>PUT identity/users/{userId}/info</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 233. List a user&#8217;s info - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to get the info for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Response Body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-p">[</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;key1&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/users/testuser/info/key1&quot;</span>
   <span class="tok-p">},</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;key2&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/users/testuser/info/key2&quot;</span>
   <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 234. List a user&#8217;s info - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user was found and list of info (key and url) is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_a_users_info">Get a user&#8217;s info</h5>
<div class="listingblock">
<div class="content">
<pre>GET identity/users/{userId}/info/{key}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 235. Get a user&#8217;s info - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to get the info for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key of the user info to get.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Response Body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;key1&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Value 1&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/users/testuser/info/key1&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 236. Get a user&#8217;s info - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user was found and the user has info for the given key..</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user was not found or the user doesn&#8217;t have info for the given key. Status description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_update_a_users_info">Update a user&#8217;s info</h5>
<div class="listingblock">
<div class="content">
<pre>PUT identity/users/{userId}/info/{key}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 237. Update a user&#8217;s info - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to update the info for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key of the user info to update.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request Body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;The updated value&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Response Body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;key1&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;The updated value&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/users/testuser/info/key1&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 238. Update a user&#8217;s info - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user was found and the info has been updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the value was missing from the request body.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user was not found or the user doesn&#8217;t have info for the given key. Status description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_create_a_new_users_info_entry">Create a new user&#8217;s info entry</h5>
<div class="listingblock">
<div class="content">
<pre>POST identity/users/{userId}/info</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 239. Create a new user&#8217;s info entry - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to create the info for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request Body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;key1&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;The value&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Response Body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;key1&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;The value&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/users/testuser/info/key1&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 240. Create a new user&#8217;s info entry - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user was found and the info has been created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the key or value was missing from the request body. Status description contains additional information about the error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates there is already an info-entry with the given key for the user, update the resource instance (<code>PUT</code>).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_delete_a_users_info">Delete a user&#8217;s info</h5>
<div class="listingblock">
<div class="content">
<pre>DELETE identity/users/{userId}/info/{key}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 241. Delete a user&#8217;s info - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to delete the info for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key of the user info to delete.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 242. Delete a user&#8217;s info - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user was found and the info for the given key has been deleted. Response body is left empty intentionally.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user was not found or the user doesn&#8217;t have info for the given key. Status description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_groups">4.1.14. Groups</h4>
<div class="sect4">
<h5 id="_get_a_single_group">Get a single group</h5>
<div class="listingblock">
<div class="content">
<pre>GET identity/groups/{groupId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 243. Get a single group - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the group to get.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;testgroup&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/groups/testgroup&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Test group&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Test type&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 244. Get a single group - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the group exists and is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested group does not exist.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_a_list_of_groups">Get a list of groups</h5>
<div class="listingblock">
<div class="content">
<pre>GET identity/groups</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 245. Get a list of groups - URL query parameters</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return group with the given id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return groups with the given name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return groups with the given type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return groups with a name like the given value. Use <code>%</code> as wildcard-character.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">member</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return groups which have a member with the given username.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">potentialStarter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return groups which members are potential starters for a process-definition with the given id.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field to sort results on, should be one of <code>id</code>, <code>name</code> or <code>type</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:[</span>
     <span class="tok-p">{</span>
        <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;testgroup&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/groups/testgroup&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Test group&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Test type&quot;</span>
     <span class="tok-p">}</span>
   <span class="tok-p">],</span>
   <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span><span class="tok-mi">3</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;id&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span><span class="tok-mi">3</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 246. Get a list of groups - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested groups were returned.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_update_a_group">Update a group</h5>
<div class="listingblock">
<div class="content">
<pre>PUT identity/groups/{groupId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Test group&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Test type&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All request values are optional. For example, you can only include the <em>name</em> attribute in the request body JSON-object, only updating the name of the group, leaving all other fields unaffected. When an attribute is explicitly included and is set to null, the group-value will be updated to null.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 247. Update a group - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the group was updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested group was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested group was updated simultaneously.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong> see response for <code>identity/groups/{groupId}</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_create_a_group">Create a group</h5>
<div class="listingblock">
<div class="content">
<pre>POST identity/groups</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;testgroup&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Test group&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Test type&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 248. Create a group - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the group was created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the id of the group was missing.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong> see response for <code>identity/groups/{groupId}</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_delete_a_group">Delete a group</h5>
<div class="listingblock">
<div class="content">
<pre>DELETE identity/groups/{groupId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 249. Delete a group - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the group to delete.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 250. Delete a group - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the group was found and  has been deleted. Response-body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested group was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_members_in_a_group">Get members in a group</h5>
<div class="paragraph">
<p>There is no GET allowed on <code>identity/groups/members</code>. Use the <code>identity/users?memberOfGroup=sales</code> URL to get all users that are part of a particular group.</p>
</div>
</div>
<div class="sect4">
<h5 id="_add_a_member_to_a_group">Add a member to a group</h5>
<div class="listingblock">
<div class="content">
<pre>POST identity/groups/{groupId}/members</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 251. Add a member to a group - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the group to add a member to.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;userId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;kermit&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 252. Add a member to a group - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the group was found and the member has been added.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the userId was not included in the request body.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested group was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user is already a member of the group.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Response Body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;userId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;groupId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;sales&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/groups/sales/members/kermit&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_delete_a_member_from_a_group">Delete a member from a group</h5>
<div class="listingblock">
<div class="content">
<pre>DELETE identity/groups/{groupId}/members/{userId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 253. Delete a member from a group - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the group to remove a member from.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to remove.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 254. Delete a member from a group - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the group was found and the member has been deleted. The response body is left empty intentionally.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested group was not found or that the user is not a member of the group. The status description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Response Body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;userId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;groupId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;sales&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/groups/sales/members/kermit&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dmn_2">4.2. DMN</h3>
<div class="sect3">
<h4 id="_部署">4.2.1. 部署</h4>
<div class="paragraph">
<p><strong>当使用tomcat时，请阅读 <a href="#restUsageInTomcat">Usage in Tomcat</a>.</strong></p>
</div>
<div class="sect4">
<h5 id="_获取多个dmn部署">获取多个DMN部署</h5>
<div class="listingblock">
<div class="content">
<pre>GET dmn-repository/deployments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 255. URL 查询参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必需</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回指定名称的部署.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">模糊查询指定名称.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回指定类别.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">categoryNotEquals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回指定类别以外的部署.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回指定tenantId的部署.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">模糊查询指定tenantId的部署.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果为true 则返回指定tenantId以外的部署，如果为false 则忽略掉该参数.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>id</em> (default), <em>name</em>, <em>deploytime</em> or <em>tenantId</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">属性进行排序，与“order”一起使用.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 256. REST 返回编码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the request was successful.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">返回编码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求成功.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong>
<strong>成功返回示例:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;03ab310d-c1de-11e6-a4f4-62ce84ef239e&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deploymentTime&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;2016-12-14T10:16:37.000+01:00&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8080/flowable-rest/dmn-api/dmn-repository/deployments/03ab310d-c1de-11e6-a4f4-62ce84ef239e&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;parentDeploymentId&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;17510&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;id&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_获取一个dmn部署">获取一个DMN部署</h5>
<div class="listingblock">
<div class="content">
<pre>GET dmn-repository/deployments/{deploymentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 257. 获取一个部署- URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必需</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部署唯一id.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 258. 获取一个部署- 返回编码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">返回编码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">找到并返回指定部署.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">为找到指定的部署.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功示例:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;03ab310d-c1de-11e6-a4f4-62ce84ef239e&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;deploymentTime&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;2016-12-14T10:16:37.000+01:00&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8080/flowable-rest/dmn-api/dmn-repository/deployments/03ab310d-c1de-11e6-a4f4-62ce84ef239e&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;parentDeploymentId&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;17510&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_create_a_new_dmn_deployment">Create a new DMN deployment</h5>
<div class="paragraph">
<p>（创建一个DMN部署）</p>
</div>
<div class="listingblock">
<div class="content">
<pre>POST dmn-repository/deployments</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong>
<strong>请求消息体:</strong></p>
</div>
<div class="paragraph">
<p>The request body should contain data of type <em>multipart/form-data</em>. There should be exactly one file in the request: any additional files will be ignored. The deployment name is the name of the file-field passed in.
（请求消息体应该包含 <em>multipart/form-data</em> 类型。请求中应该只有一个文件:任何额外的文件都将被忽略。file-field 的名称作为部署的名称）
An additional parameter (form-field) can be passed in the request body with name <code>tenantId</code>. The value of this field will be used as the identifier of the tenant in which this deployment is done.
（可以在请求体中通过name +tenantId+传递附加参数(表单字段)。此字段的值将用作执行此部署的租户的标识符。）
.Create a new DMN deployment - Response codes
（创建一个DMN部署-返回编码）</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the deployment was created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates there was no content present in the request body or the content mime-type is not supported for deployment. The status-description contains additional information.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">返回编码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定的部署已经存在.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求主体中不存在内容，或部署不支持该内容的mime-type。状态描述包含附加信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong>
(<strong>成功示例:</strong>)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;03ab310d-c1de-11e6-a4f4-62ce84ef239e&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;newDeployment1&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;deploymentTime&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;2016-12-14T10:16:37.000+01:00&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8080/flowable-rest/dmn-api/dmn-repository/deployments/03ab310d-c1de-11e6-a4f4-62ce84ef239e&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myTenant&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_delete_a_dmn_deployment">Delete a DMN deployment</h5>
<div class="paragraph">
<p>（删除一个部署）</p>
</div>
<div class="listingblock">
<div class="content">
<pre>DELETE dmn-repository/deployments/{deploymentId}</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Delete a DMN deployment - URL parameters</div>
<p>（删除一个部署- URL 参数）</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The identifier of the deployment to delete.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必需</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">需要删除的部署的编号.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Delete a DMN deployment - Response codes</div>
<p>（删除一个部署 - 返回编码）</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the deployment was found and has been deleted. Response-body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested deployment was not found.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">返回编码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定的部署已经被删除。返回内容特意为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未找到指定的部署。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_get_a_dmn_deployment_resource_content">Get a DMN deployment resource content</h5>
<div class="paragraph">
<p>（获取DMN部署资源内容）</p>
</div>
<div class="listingblock">
<div class="content">
<pre>GET dmn-repository/deployments/{deploymentId}/resourcedata/{resourceId}</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Get a deployment resource content - URL parameters</div>
<p>（获取DMN部署资源内容 - URL 参数）</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The identifier of the deployment the requested resource is part of.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The identifier of the resource to get the data for. <strong>Make sure you URL-encode the resourceId in case it contains forward slashes. For example, use <em>decisions%2Fmy-decision.dmn</em> instead of <em>decisions/my-decision.dmn</em>.</strong></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必需</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定部署编号。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定资源编号。确保resourceId的URL编码，以防它包含前斜杠。例如，使用 <em>decisions%2Fmy-decision.dmn</em>。而不是&#8217;decisions/my-decision.dmn'</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Get a deployment resource content - Response codes</div>
<p>（.获取DMN部署资源内容 - 返回编码）</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates both deployment and resource have been found and the resource data has been returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested deployment was not found or there is no resource with the given identifier present in the deployment. The status-description contains additional information.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">已找到指定的部署和资源，并返回资源数据。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未找到所请求的部署，或部署中不存在指定的资源。状态描述包含附加信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong>
（<strong>成功示例:</strong>）</p>
</div>
<div class="paragraph">
<p>The response body will contain the binary resource-content for the requested resource. The response content-type will be the same as the type returned in the resources <em>mimeType</em> property. Also, a content-disposition header is set, allowing browsers to download the file instead of displaying it.
（响应体将包含请求资源的二进制资源内容。响应内容类型将与资源“mimeType”属性中返回的类型相同。此外，header还设置了一个content-disposition ，允许浏览器下载文件而不是显示它。）</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_decision_tables">4.2.2. Decision Tables</h4>
<div class="paragraph">
<p>（决策表）</p>
</div>
<div class="sect4">
<h5 id="_list_of_decision_tables">List of decision tables</h5>
<div class="paragraph">
<p>（获取决策表列表）</p>
</div>
<div class="listingblock">
<div class="content">
<pre>GET dmn-repository/decision-tables</pre>
</div>
</div>
<div class="paragraph">
<div class="title">List of process definitions - URL parameters</div>
<p>（获取流程定义列表- URL 参数）</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with the given version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with a name like the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with the given key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">keyLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with a name like the given key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with the given resource name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with a name like the given resource name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with the given category.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">categoryLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with a category like the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">categoryNotEquals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions which don&#8217;t have the given category.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions which are part of a deployment with the given identifier.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return the latest process definition versions. Can only be used together with <em>key</em> and <em>keyLike</em> parameters, using any other parameter will result in a 400-response.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>name</em> (default), <em>id</em>, <em>key</em>, <em>category</em>, <em>deploymentId</em> and <em>version</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property to sort on, to be used together with the <em>order</em>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必需</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回指定版本的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回指定名称的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">模糊查询指定名称的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回指定key的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">keyLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">模糊查询指定key的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回指定资源名称的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">模糊查询指定资源名称的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回指定类别的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">categoryLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">模糊查询指定名称的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">categoryNotEquals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回指定类型以外的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回指定部署编号的流程定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回最新版本的流程定义。只能与“key”和“keyLike”参数一起使用，使用任何其他参数都会得到400个响应。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>name</em> (default), <em>id</em>, <em>key</em>, <em>category</em>, <em>deploymentId</em> and <em>version</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">排序，与“order”一起使用。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 259. 获取流程定义列表 - 返回编码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">返回编码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求成功，并返回决策表</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参数以错误的格式传递，或&#8217;latest' 与&#8217;key' 和 'keyLike&#8217;以外的其他参数一起使用。状态消息包含其他信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功示例:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;46b0379c-c0a1-11e6-bc93-6ab56fad108a&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8080/flowable-rest/dmn-api/dmn-repository/decision-tables/46b0379c-c0a1-11e6-bc93-6ab56fad108a&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Decision Table One&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;DecisionTableOne&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span> <span class="tok-mi">3</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;resourceName&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;dmn-DecisionTableOne.dmn&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deploymentId&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;46aa6b3a-c0a1-11e6-bc93-6ab56fad108a&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;parentDeploymentId&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;5001&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_获取一个决策表">获取一个决策表</h5>
<div class="listingblock">
<div class="content">
<pre>GET dmn-repository/decision-tables/{decisionTableId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 260. 获取一个决策表 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必需</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">decisionTableId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">决策表编号。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 261. 获取一个决策表 - 返回编码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">找到指定编号决策表并返回</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未找到指定编号决策表</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功示例:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;46b0379c-c0a1-11e6-bc93-6ab56fad108a&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8080/flowable-rest/dmn-api/dmn-repository/decision-tables/46b0379c-c0a1-11e6-bc93-6ab56fad108a&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Decision Table One&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;DecisionTableOne&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span> <span class="tok-mi">3</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;resourceName&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;dmn-DecisionTableOne.dmn&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;deploymentId&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;46aa6b3a-c0a1-11e6-bc93-6ab56fad108a&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;parentDeploymentId&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;5001&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_获取一个决策表资源内容">获取一个决策表资源内容</h5>
<div class="listingblock">
<div class="content">
<pre>GET dmn-repository/decision-tables/{decisionTableId}/resourcedata</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 262. 获取一个决策表资源内容 - URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必需</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">decisionTableId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">决策表编号。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>返回:</strong></p>
</div>
<div class="paragraph">
<p>与 <code>GET dmn-repository/deployment/{deploymentId}/resourcedata/{resourceId}</code> 相同.</p>
</div>
</div>
<div class="sect4">
<h5 id="_获取一个决策表dmn模型">获取一个决策表DMN模型</h5>
<div class="listingblock">
<div class="content">
<pre>GET dmn-repository/decision-tables/{decisionTableId}/model</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 263. 获取一个决策表DMN模型- URL 参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必需</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">decisionTableId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">决策表编号。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 264. 获取一个决策表DMN模型- 返回编码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">返回编码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">找到指定决策表并返回模型。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未找到指定决策表。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>返回内容:</strong>
返回内容是+org.flowable.dmn.model.DmnDefinition+的JSON。并包含完整的DMN定义模型。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;processes&quot;</span><span class="tok-p">:[</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;oneTaskProcess&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;xmlRowNumber&quot;</span><span class="tok-p">:</span><span class="tok-mi">7</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;xmlColumnNumber&quot;</span><span class="tok-p">:</span><span class="tok-mi">60</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;extensionElements&quot;</span><span class="tok-p">:{</span>

         <span class="tok-p">},</span>
         <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;The One Task Process&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;executable&quot;</span><span class="tok-p">:</span><span class="tok-kc">true</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;documentation&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;One task process description&quot;</span><span class="tok-p">,</span>

    <span class="tok-err">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dmn规则服务">4.2.3. DMN规则服务</h4>
<div class="sect4">
<h5 id="_执行一个决策">执行一个决策</h5>
<div class="listingblock">
<div class="content">
<pre>POST dmn-rule/execute</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="paragraph">
<p>请求体应该包含_multipart/form-data_类型的数据。需要decisionKey。tenantId、parentdeploymentd和inputVariables (restVariables)映射是可选的。</p>
</div>
<div class="paragraph">
<p><strong>Response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;resultVariables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">[</span>
      <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;output1&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;result 1&quot;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">],</span>
    <span class="tok-p">[</span>
      <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;output1&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;result 2&quot;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">],</span>
    <span class="tok-p">[</span>
      <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;output1&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;result 3&quot;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">]</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8080/flowable-rest/dmn-api/dmn-rule/execute&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 265. 执行一个决策 - 返回编码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">返回编码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">已执行该决策。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_执行一个单结果决策">执行一个单结果决策</h5>
<div class="listingblock">
<div class="content">
<pre>POST dmn-rule/execute/single-result</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="paragraph">
<p>请求体应该包含_multipart/form-data_类型的数据。需要decisionKey。tenantId、parentdeploymentd和inputVariables (restVariables)映射是可选的。</p>
</div>
<div class="paragraph">
<p>当多个规则有效时，返回500。</p>
</div>
<div class="paragraph">
<p><strong>注意:使用复合输出的单个命中是有效的(参见下面的响应)</strong></p>
</div>
<div class="paragraph">
<p><strong>Response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;resultVariables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;output1&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;compound 1&quot;</span>
    <span class="tok-p">},</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;output2&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;compound 2&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8080/flowable-rest/dmn-api/dmn-rule/execute/single-result&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 266. 执行一个单结果决策 - 返回编码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">返回编码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">已执行指定决策。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定决策返回多个结果。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_引擎">4.2.4. 引擎</h4>
<div class="sect4">
<h5 id="_获取一个dmn引擎信息">获取一个DMN引擎信息</h5>
<div class="listingblock">
<div class="content">
<pre>GET dmn-management/engine</pre>
</div>
</div>
<div class="paragraph">
<p>返回此rest服务中使用的DMN引擎的只读视图。</p>
</div>
<div class="paragraph">
<p><strong>响应成功:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;default&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;6.4.2-SNAPSHOT&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;resourceUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;file://flowable-dmn/flowable.dmn.cfg.xml&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;exception&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 267. 获取引擎信息 - 返回编码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">返回编码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回指定引擎信息。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_form">4.3. FORM</h3>
<div class="sect3">
<h4 id="_部署_2">4.3.1. 部署</h4>
<div class="paragraph">
<p><strong>当使用tomcat时, 请参考在<a href="#restTomcat">Tomcat</a>中的用法。</strong></p>
</div>
<div class="sect4">
<h5 id="_部署列表">部署列表</h5>
<div class="listingblock">
<div class="content">
<pre>GET form-repository/deployments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 268. URL查询参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名称</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">参数类型</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回根据名称查询返回的部署结果集.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name模糊查询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回根据名称模糊匹配的部署结果集.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回符合类别的部署结果集.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">不等于category</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回不等于该类别的其他部署结果集.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回给符合租户ID的部署结果集.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">模糊匹配tenantId值</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回模糊匹配到租户ID值的部署结果集.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">布尔</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果为 true 则仅返回未设置tenantId的部署。如果为 false 则忽略参数租户ID。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>id</em> (默认), <em>名称</em>, <em>部署时间</em> or <em>租户ID</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要排序的属性要与 <em>order</em> 一起使用.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 269. REST 响应编码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应编码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示请求成功.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应正文:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;10&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;flowable-form-examples&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deploymentTime&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;2010-10-13T14:54:26.750+02:00&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;examples&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/form-api/form-repository/deployments/10&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;id&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_获取单个部署">获取单个部署</h5>
<div class="listingblock">
<div class="content">
<pre>GET form-repository/deployments/{deploymentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 270. 获取单个部署信息 - 请求参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名称</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">值类型</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">部署ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">根据部署ID获取部署信息.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 271. 获取部署信息 - 响应编码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应编码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示该部署信息已经找到并且返回.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示请求的部署信息未找到.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应体:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;10&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;flowable-form-examples&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;deploymentTime&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;2010-10-13T14:54:26.750+02:00&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;examples&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/form-api/form-repository/deployments/10&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_创建部署信息">创建部署信息</h5>
<div class="listingblock">
<div class="content">
<pre>POST form-repository/deployments</pre>
</div>
</div>
<div class="paragraph">
<p><strong>请求正文:</strong></p>
</div>
<div class="paragraph">
<p>请求正文应包含multipart / form-data类型的数据。 请求中应该只有一个文件，任何其他文件都将被忽略。 部署名称是传入的文件字段的名称。</p>
</div>
<div class="paragraph">
<p>可以在名称为tenantId的请求正文中传递附加参数（表单字段）。 此字段的值将用作完成此部署的租户的标识符。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 272. 创建新的部署信息 - 响应编码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应编码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示已经部署成功.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示请求正文中不存在任何内容，或者部署不支持内容mime-type。 状态描述包含其他信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应正文:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;10&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;simple.form&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;deploymentTime&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;2010-10-13T14:54:26.750+02:00&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/form-api/form-repository/deployments/10&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myTenant&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_删除部署信息">删除部署信息</h5>
<div class="listingblock">
<div class="content">
<pre>DELETE form-repository/deployments/{deploymentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 273. 删除一个部署信息 - 传输参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">值类型</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">部署ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要删除的部署的标识符。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 274. 删除某个部署 - 响应编码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应编码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示已找到部署并已删除。 响应体是空的。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示未找到请求的部署。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_获取部署资源内容">获取部署资源内容</h5>
<div class="listingblock">
<div class="content">
<pre>GET form-repository/deployments/{deploymentId}/resourcedata/{resourceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 275. 获取部署资源内容 - 请求参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">值类型</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">部署ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求的资源所属的部署标识符。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">资源ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">获取数据的资源的标识符。 <strong>确保对resourceId进行URL编码，以防它包含正斜杠。 举个例子, 比如 <em>forms%2Fmy-form.form</em> 代替 <em>forms/my-form.form</em>.</strong></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 276. 获取部署资源内容 - 响应编码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应编码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示已找到部署和资源，并且已返回资源数据。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示未找到请求的部署，或者部署中不存在具有给定ID的资源。 状态描述包含其他信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应正文:</strong></p>
</div>
<div class="paragraph">
<p>响应正文将包含所请求资源的二进制资源内容。 响应内容类型将与资源&#8217;mimeType&#8217;属性中返回的类型相同。 此外，还设置了内容处置标题，允许浏览器下载文件而不是显示文件。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_表单定义_3">4.3.2. 表单定义</h4>
<div class="sect4">
<h5 id="_表单定义列表">表单定义列表</h5>
<div class="listingblock">
<div class="content">
<pre>GET form-repository/form-definitions</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 277. 表单定义列表 - 请求参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">参数类型</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">整型</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回给定版本定义的表单.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回给定名称的定义的表单。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">根据name模糊匹配</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返会根据名称模糊匹配到的定义表单</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回具有给定键的表单定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">模糊匹配key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回模糊匹配给定键的表单定义.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回具有给定资源名称的表单定义</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">模糊匹配resourceName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回具有模糊匹配资源名称的表单定义</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回给定类别的表单定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">模糊匹配category</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回模糊匹配给定类别的表单定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">不等于category</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回非给定类别的表单定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回作为具有给定标识符的部署的一部分的表单定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">布尔</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回最新的表单定义版本。 只能与&#8217;key&#8217;和&#8217;keyLike&#8217;参数一起使用，使用任何其他参数将导致400响应。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>name</em> (default), <em>id</em>, <em>key</em>, <em>category</em>, <em>deploymentId</em> 和 <em>version</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要排序的属性，与“order”一起使用。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 278. 表单定义列表 - 响应编码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应编码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示请求成功，并返回表单定义</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示参数以错误的格式传递，或者“latest”与“key”和“keyLike”以外的其他参数一起使用。 状态消息包含其他信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应正文:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;818e4703-f1d2-11e6-8549-acde48001122&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/form-repository/form-definitions/simpleForm&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;version&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;key&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;simpleForm&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;category&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Examples&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deploymentId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;818e4703-f1d2-11e6-8549-acde48001121&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;parentDeploymentId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;The Simple Form&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a form for testing purposes&quot;</span><span class="tok-p">,</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_获取定义的表单">获取定义的表单</h5>
<div class="listingblock">
<div class="content">
<pre>GET repository/form-definitions/{formDefinitionId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 279. 获取表单 - 请求参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">值类型</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">formDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取的流程定义的标识符。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 280. 获取定义的表单 - 响应编码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">响应编码</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">描述</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示已找到并返回表单定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示找不到请求的表单定义。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功返回例子:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;818e4703-f1d2-11e6-8549-acde48001122&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/form-repository/form-definitions/simpleForm&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;version&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;key&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;simpleForm&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;category&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Examples&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;deploymentId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;818e4703-f1d2-11e6-8549-acde48001121&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;parentDeploymentId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;The Simple Form&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a form for testing purposes&quot;</span><span class="tok-p">,</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_获取表单定义资源内容">获取表单定义资源内容</h5>
<div class="listingblock">
<div class="content">
<pre>GET repository/form-definitions/{formDefinitionId}/resourcedata</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 281. 获取表单定义资源内容 - 请求参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">参数类型</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">formDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于获取资源数据的表单定义的标识符。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>返回值:</strong></p>
</div>
<div class="paragraph">
<p>返回的编码和响应体与+GET form-repository/deployment/{deploymentId}/resourcedata/{resourceId}+ 一样.</p>
</div>
</div>
<div class="sect4">
<h5 id="_获取定义表单的表单模型">获取定义表单的表单模型</h5>
<div class="listingblock">
<div class="content">
<pre>GET form-repository/form-definitions/{formDefinitionId}/model</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 282. 获取定义表单的表单模型 - 请求参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">请求参数</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">参数类型</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">formDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">获取模型的表单定义的标识符。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 283. 获取定义表单的表单模型 - 响应编码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应编码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示找到了表单定义并返回了模型.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示找不到请求的表单定义。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>响应正文:</strong>
响应主体是+ org.flowable.form.model.FormModel +的JSON表示，并包含完整的表单定义模型。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_表单实例">4.3.3. 表单实例</h4>
<div class="sect4">
<h5 id="_获取表单实例">获取表单实例</h5>
<div class="listingblock">
<div class="content">
<pre>GET form/form-instances/{formInstanceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 284. 获取表单实例 - 请求参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">请求参数</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">参数类型</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">formInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取的表单实例的标识符。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 285. 获取表单实例 - 响应编码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应编码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示找到并返回了表单实例.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示找不到请求的表单实例。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应正文:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;48b9ac82-f1d3-11e6-8549-acde48001122&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/form/form-instances/48b9ac82-f1d3-11e6-8549-acde48001122&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;formDefinitionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;818e4703-f1d2-11e6-8549-acde48001122&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;taskId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;88&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;66&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processDefinitionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;oneTaskProcess:1:158&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;submittedDate&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;submittedBy&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;testUser&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;formValuesId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;818e4703-f1d2-11e6-8549-acde48001110&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_存储表单实例">存储表单实例</h5>
<div class="listingblock">
<div class="content">
<pre>POST form/form-instances</pre>
</div>
</div>
<div class="paragraph">
<p><strong>请求正文（以流程定义ID开头）:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;formDefinitionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;818e4703-f1d2-11e6-8549-acde48001122&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;taskId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;88&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;66&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processDefinitionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;oneTaskProcess:1:158&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
      <span class="tok-nt">&quot;input1&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;test&quot;</span>
   <span class="tok-p">}</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>请求正文（从表单定义键开始）：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;formDefinitionKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;simpleForm&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;taskId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;88&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;66&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processDefinitionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;oneTaskProcess:1:158&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
      <span class="tok-nt">&quot;input1&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;test&quot;</span>
   <span class="tok-p">}</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在请求正文中只能使用+ formDefinitionId <code>或</code> formDefinitionKey <code>中的一个。 参数+变量+和</code> tenantId <code>是可选的。 如果省略</code> tenantId +，将使用默认租户。 有关变量格式的更多信息可以在<a href="#restVariables">变量部分</a>中找到。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 286. 存储表单实例 - 响应代码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应吗</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示已创建表单实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示未找到表单定义（基于标识符或键），通过发送给定消息未存储表单实例，或者已传递无效变量。 状态描述包含有关错误的其他信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>响应成功正文:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;48b9ac82-f1d3-11e6-8549-acde48001122&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/form/form-instances/48b9ac82-f1d3-11e6-8549-acde48001122&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;formDefinitionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;818e4703-f1d2-11e6-8549-acde48001122&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;taskId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;88&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;66&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processDefinitionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;oneTaskProcess:1:158&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;submittedDate&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;submittedBy&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;testUser&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;formValuesId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;818e4703-f1d2-11e6-8549-acde48001110&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="restProcessInstancesGet">表单实例列表</h5>
<div class="listingblock">
<div class="content">
<pre>GET form/form-instances</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 287. 表单实例列表 - 请求参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">请求参数</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">值类型</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回具有给定标识符的流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">表单定义ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回具有给定表单定义标识符的表单实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">模糊匹配表单ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回具有表单定义标识符（模糊匹配给定值）的表单实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">任务ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回具有给定任务标识符的表单实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">模糊匹配任务ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回具有任务标识符（如模糊匹配给定值）的表单实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程实例ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回具有给定流程实例标识符的表单实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">模糊匹配表单实例ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回具有与给定值(模糊匹配流程实例标识符)的表单实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程定义ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回具有给定流程定义标识符的表单实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">模糊匹配流程定义ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回具有与给定值（模糊匹配的流程定义标识符）的表单实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">由&#8230;&#8203;提交</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回由&#8230;&#8203;提交的给定提交的表单实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">模糊匹配由&#8230;&#8203;提交</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只返回模糊匹配给定值的提交的表单实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">租户ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回具有给定租户ID的流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">模糊匹配租户ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅返回具有类似给定值的(模糊匹配租户ID)的流程实例。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">没有租户ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">布尔</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果 true，则仅返回没有设置租户ID的流程实例。 如果是false，则忽略 租户ID 参数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">排序</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">排序字段，应该是 提交日期 （默认）或 租户ID。</p>
<p class="tableblock">一般<a href="#restPagingAndSort">分页和排序 查询参数</a>可以用在本链接</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 288. 表单实例列表 - 响应编码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应编码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示请求成功，并返回表单实例</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示参数以错误的格式传递。 状态消息包含其他信息。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响应正文:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:[</span>
      <span class="tok-p">{</span>
	   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;48b9ac82-f1d3-11e6-8549-acde48001122&quot;</span><span class="tok-p">,</span>
	   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/form/form-instances/48b9ac82-f1d3-11e6-8549-acde48001122&quot;</span><span class="tok-p">,</span>
	   <span class="tok-nt">&quot;formDefinitionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;818e4703-f1d2-11e6-8549-acde48001122&quot;</span><span class="tok-p">,</span>
	   <span class="tok-nt">&quot;taskId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;88&quot;</span><span class="tok-p">,</span>
	   <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;66&quot;</span><span class="tok-p">,</span>
	   <span class="tok-nt">&quot;processDefinitionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;oneTaskProcess:1:158&quot;</span><span class="tok-p">,</span>
	   <span class="tok-nt">&quot;submittedDate&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
	   <span class="tok-nt">&quot;submittedBy&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;testUser&quot;</span><span class="tok-p">,</span>
	   <span class="tok-nt">&quot;formValuesId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;818e4703-f1d2-11e6-8549-acde48001110&quot;</span><span class="tok-p">,</span>
	   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span>
	  <span class="tok-p">}</span>
   <span class="tok-p">],</span>
   <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span><span class="tok-mi">1</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;submittedDate&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span><span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_查询表单实例">查询表单实例</h5>
<div class="listingblock">
<div class="content">
<pre>POST query/form-instances</pre>
</div>
</div>
<div class="paragraph">
<p><strong>请求正文:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;formDefinitionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;818e4703-f1d2-11e6-8549-acde48001122&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请求正文可以包含可以在查询<a href="#restFormInstancesGet">流程实例列表</a>中使用的所有可能的过滤器</p>
</div>
<div class="paragraph">
<p>普通 <a href="#restPagingAndSort">分页和排序，查询参数</a> 可用于此URL。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 289. 查询表单实例 - 响应编码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应编码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示请求成功，并返回表单实例</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示参数以错误的格式传递。 状态消息包含其他信息</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>成功响正文:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:[</span>
      <span class="tok-p">{</span>
	   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;48b9ac82-f1d3-11e6-8549-acde48001122&quot;</span><span class="tok-p">,</span>
	   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/form/form-instances/48b9ac82-f1d3-11e6-8549-acde48001122&quot;</span><span class="tok-p">,</span>
	   <span class="tok-nt">&quot;formDefinitionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;818e4703-f1d2-11e6-8549-acde48001122&quot;</span><span class="tok-p">,</span>
	   <span class="tok-nt">&quot;taskId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;88&quot;</span><span class="tok-p">,</span>
	   <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;66&quot;</span><span class="tok-p">,</span>
	   <span class="tok-nt">&quot;processDefinitionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;oneTaskProcess:1:158&quot;</span><span class="tok-p">,</span>
	   <span class="tok-nt">&quot;submittedDate&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
	   <span class="tok-nt">&quot;submittedBy&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;testUser&quot;</span><span class="tok-p">,</span>
	   <span class="tok-nt">&quot;formValuesId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;818e4703-f1d2-11e6-8549-acde48001110&quot;</span><span class="tok-p">,</span>
	   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span>
	  <span class="tok-p">}</span>
   <span class="tok-p">],</span>
   <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span><span class="tok-mi">1</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;submittedDate&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span><span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_表单引擎">4.3.4. 表单引擎</h4>
<div class="sect4">
<h5 id="_获取表单引擎信息">获取表单引擎信息</h5>
<div class="listingblock">
<div class="content">
<pre>GET form-management/engine</pre>
</div>
</div>
<div class="paragraph">
<p>返回此REST服务中使用的引擎的只读视图。</p>
</div>
<div class="paragraph">
<p><strong>成功响应正文:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;default&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;6.4.2-SNAPSHOT&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;resourceUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;file://flowable/flowable.form.cfg.xml&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;exception&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 290. 获取引擎信息 - 响应编码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应编码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示返回表单引擎信息。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_modelers">5. Modelers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="flowableDesigner">5.1. Eclipse Designer</h3>
<div class="paragraph">
<p>Flowable提供了名为Flowable Eclipse Designer的Eclipse插件，可以用于图形化地建模、测试与部署BPMN 2.0流程。</p>
</div>
<div class="sect3">
<h4 id="eclipseDesignerInstallation">5.1.1. 安装</h4>
<div class="paragraph">
<p>下面的安装指导在<a href="http://www.eclipse.org/downloads/">Eclipse Mars与Neon</a>下进行了验证。</p>
</div>
<div class="paragraph">
<p>选择<strong>Help &#8594; Install New Software</strong>。在下图面板中，点击<em>Add</em>按钮，并填写下列字段：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Name:</strong> Flowable BPMN 2.0 designer</p>
</li>
<li>
<p><strong>Location:</strong> <a href="http://www.flowable.org/designer/update/" class="bare">http://www.flowable.org/designer/update/</a></p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.add.update.site.png" alt="designer.add.update.site">
</div>
</div>
<div class="paragraph">
<p>确保<strong>已选中"Contact all updates sites.."</strong>复选框。这样Eclipse就可以下载需要的所有插件。</p>
</div>
</div>
<div class="sect3">
<h4 id="eclipseDesignerEditorFeatures">5.1.2. Flowable Designer编辑器功能</h4>
<div class="ulist">
<ul>
<li>
<p>创建Flowable项目与流程图（diagram）。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.create.flowable.project.png" alt="designer.create.flowable.project">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Flowable Designer在创建新的Flowable流程图时，会创建一个.bpmn文件。当使用Flowable Diagram Editor（Flowable流程图编辑器）视图打开时，将提供图形化的模型画布与画板。这个文件也可以使用XML编辑器打开，将显示流程定义的BPMN 2.0 XML元素。也就是说，Flowable Designer只用一个文件，既是流程图，也是BPMN 2.0 XML。请注意在早期版本中，不支持使用.bpmn扩展名作为流程定义的部署包。可以使用Flowable Designer的"create deployment artifacts（创建部署包）"功能，生成一个BAR文件，其中有一个.bpmn20.xml文件，包含.bpmn文件的内容。也可以方便的自己重命名。请注意，也可以使用Flowable Diagram Editor打开.bpmn20.xml文件。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.bpmn.file.png" alt="designer.bpmn.file">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>BPMN 2.0 XML文件导入Flowable Designer会自动显示流程图。只需要将BPMN 2.0 XML文件复制到项目中，并使用Flowable Diagram Editor视图打开它。Flowable Designer使用文件中的BPMN DI信息来创建流程图。如果BPMN 2.0 XML文件中没有BPMN DI信息，会使用Flowable BPMN自动布局模块，创建流程图。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.open.importedfile.png" alt="designer.open.importedfile" width="600">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>可以使用Flowable Designer创建BAR文件或JAR文件进行部署。在包浏览器中的Flowable项目上点击右键，在弹出菜单的下方选择<em>Create deployment artifacts（创建部署包）</em>选项。要了解关于Designer部署功能的更多信息，请查看<a href="#eclipseDesignerDeployment">部署</a>章节。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.create.deployment.png" alt="designer.create.deployment" width="500">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>生成单元测试（在包浏览器中的BPMN 2.0 XML文件上点击右键，选择<em>generate unit test 生成单元测试</em>）。将创建一个单元测试及运行在嵌入式H2数据库上的Flowable配置。这样就可以运行单元测试，来测试你的流程定义。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.unittest.generate.png" alt="designer.unittest.generate" width="600">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Flowable项目可以生成为Maven项目。要配置依赖，需要运行<em>mvn eclipse:eclipse</em>。请注意在流程设计时不需要Maven依赖。只在运行单元测试时才需要依赖。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.project.maven.png" alt="designer.project.maven" width="500">
</div>
</div>
</div>
<div class="sect3">
<h4 id="eclipseDesignerBPMNFeatures">5.1.3. Flowable Designer BPMN功能</h4>
<div class="ulist">
<ul>
<li>
<p>支持空启动事件，错误启动事件，定时器启动事件，空结束事件，错误结束事件，顺序流，并行网关，排他网关，包容网关，事件网关，嵌入式子流程，事件子流程，调用活动，泳池，泳道，脚本任务，用户任务，服务任务，邮件任务，手动任务，业务规则任务，接收任务，定时器边界事件，错误边界事件，信号边界事件，定时器捕获事件，信号捕获事件，信号抛出事件，空抛出事件，以及四个Flowable特殊元素（用户，脚本，邮件任务与启动事件）。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.model.process.png" alt="designer.model.process">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>可以在元素上悬停并选择新的任务类型，快速改变任务的类型。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.model.quick.change.png" alt="designer.model.quick.change">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>可以在元素上悬停并选择新的元素类型，快速添加新的元素。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.model.quick.new.png" alt="designer.model.quick.new">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Java服务任务支持Java类，表达式或代理表达式配置。另外也可以配置字段扩展。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.servicetask.property.png" alt="designer.servicetask.property">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>支持泳池与泳道。但由于Flowable会将不同的泳池认作不同的流程定义，因此最好只使用一个泳池。如果使用多个泳池，要小心不要在泳池间画顺序流，否则会在Flowable引擎中部署流程时发生错误。可以在一个泳池中添加任意多的泳道。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.model.poolandlanes.png" alt="designer.model.poolandlanes">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>可以通过填写name参数，为顺序流添加标签。可以决定放置标签的位置，位置将保存为BPMN 2.0 XML DI信息的一部分。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.model.labels.png" alt="designer.model.labels">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>支持事件子流程。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.model.eventsubprocess.png" alt="designer.model.eventsubprocess">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>支持展开嵌入式子流程。也可以在一个嵌入式子流程中加入另一个嵌入式子流程。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.embeddedprocess.canvas.png" alt="designer.embeddedprocess.canvas">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>支持在任务与嵌入式子流程上的定时器边界事件。然而，在Flowable Designer中，在用户任务或嵌入式子流程上使用定时器边界事件最合理。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.timerboundary.canvas.png" alt="designer.timerboundary.canvas">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>支持额外的Flowable扩展，例如邮件任务，用户任务的候选人配置，或脚本任务配置。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.mailtask.property.png" alt="designer.mailtask.property">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>支持Flowable执行与任务监听器。也可以为执行监听器添加字段扩展。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.listener.configuration.png" alt="designer.listener.configuration">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>支持在顺序流上添加条件。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.sequence.condition.png" alt="designer.sequence.condition">
</div>
</div>
</div>
<div class="sect3">
<h4 id="eclipseDesignerDeployment">5.1.4. Flowable Designer部署功能</h4>
<div class="paragraph">
<p>在Flowable引擎上部署流程定义与任务表单并不困难。只需要提供一个包含有流程定义BPMN 2.0 XML文件的BAR文件，与可选的用于在Flowable应用中查看的任务表单和流程图片。在Flowable Designer中，创建BAR文件十分简单。在完成流程实现后，只要在包浏览器中的Flowable项目上点击右键，在弹出菜单下方选择<strong>Create deployment artifacts（创建部署包）</strong>选项。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.create.deployment.png" alt="designer.create.deployment" width="600">
</div>
</div>
<div class="paragraph">
<p>然后就会创建一个部署目录，包含BAR文件与可能的JAR文件。其中JAR文件包含Flowable项目中的Java类。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.deployment.dir.png" alt="designer.deployment.dir">
</div>
</div>
<div class="paragraph">
<p>这样就可以在Flowable Admin应用的部署页签中，将这个文件上传至Flowable引擎。</p>
</div>
<div class="paragraph">
<p>如果项目包含Java类，部署时要多做一些工作。在这种情况下，Flowable Designer的<strong>Create deployment artifacts（创建部署包）</strong>操作也会创建包含编译后类的JAR文件。这个JAR文件必须部署在Flowable Tomcat（或其它容器）安装目录的flowable-XXX/WEB-INF/lib目录下。这样Flowable引擎的classpath就会添加这些类。</p>
</div>
</div>
<div class="sect3">
<h4 id="eclipseDesignerExtending">5.1.5. 扩展Flowable Designer</h4>
<div class="paragraph">
<p>可以扩展Flowable Designer提供的默认功能。这段文档介绍了可以使用哪些扩展，如何使用，并提供了一些例子。在建模业务流程时，如果默认功能不能满足需要，需要额外的功能，或有领域专门需求的时候，扩展Flowable Designer就很有用。扩展Flowable Designer分为两个不同领域，扩展画板与扩展输出格式。两者都需要专门的方法，与不同的技术知识。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>扩展Flowable Designer需要专业知识，更确切地说，Java编程的知识。取决于你想要创建的扩展类型，你可能需要熟悉Maven，Eclipse，OSGi，Eclipse扩展与SWT。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="eclipseDesignerCustomizingPalette">自定义画板</h5>
<div class="paragraph">
<p>可以自定义为用户建模流程提供的画板。画板是形状的集合，显示在画布的右侧，可以将形状拖放至画布中的流程图上。在默认画板中可以看到，默认形状进行了分组（被称为“抽屉 drawer”），如事件，网关，等等。Flowable Designer提供了两种选择，用于自定义画板中的抽屉与形状：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>将你自己的形状/节点添加到已有或新建的抽屉</p>
</li>
<li>
<p>禁用Flowable Designer提供的部分或全部BPMN 2.0默认形状，除了连线与选择工具</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>要自定义画板，需要创建一个JAR文件，并将其加入每一个Flowable Designer的安装目录（后面介绍<a href="#eclipseDesignerApplyingExtension">如何做</a>）。这个JAR文件叫做<em>扩展（extension）</em>。通过编写扩展中包含的类，就能让Flowable Designer知道需要自定义的形状。为此需要实现特定的接口。Flowable提供了一个集成类库，包含这些接口以及用于扩展的基类。</p>
</div>
<div class="paragraph">
<p>可以在下列地方找到代码示例：Flowable <a href="https://github.com/flowable/flowable-designer/tree/master/examples">源码</a>，<code>flowable-designer</code>仓库下的<code>examples/money-tasks</code>目录。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>可以使用你喜欢的任何工具设置项目，并使用你选择的构建工具构建JAR。在下面的介绍中，假设使用Eclipse Mars或Neon，并使用Maven（3.x）作为构建工具。但任何设置都可以创建相同的结果。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_extension_setup_eclipse_maven">设置扩展 (Eclipse/Maven)</h6>
<div class="paragraph">
<p>下载并解压缩<a href="http://www.eclipse.org/downloads">Eclipse</a>（应该可以使用最新版本），与<a href="http://maven.apache.org/download.html">Apache Maven</a>近期的版本（3.x）。如果使用2.x版本的Maven，可能会在构建项目时遇到错误，因此请确保版本是最新的。我们假设你已经熟悉Eclipse中的基本功能以及Java编辑器。可以使用Eclipse的Maven功能，或直接从命令行运行Maven命令。</p>
</div>
<div class="paragraph">
<p>在Eclipse中创建一个新项目。可以是通用类型项目。在项目的根路径创建一个<code>pom.xml</code>文件，以包含Maven项目配置。同时创建<code>src/main/java</code>与<code>src/main/resources</code>目录，这是Maven约定的Java源文件与资源文件目录。打开<code>pom.xml</code>文件并添加下列行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-nt">&lt;project</span>
  <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
  <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;modelVersion&gt;</span>4.0.0<span class="tok-nt">&lt;/modelVersion&gt;</span>

  <span class="tok-nt">&lt;groupId&gt;</span>org.acme<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>money-tasks<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>1.0.0<span class="tok-nt">&lt;/version&gt;</span>
  <span class="tok-nt">&lt;packaging&gt;</span>jar<span class="tok-nt">&lt;/packaging&gt;</span>
  <span class="tok-nt">&lt;name&gt;</span>Acme Corporation Money Tasks<span class="tok-nt">&lt;/name&gt;</span>
...
<span class="tok-nt">&lt;/project&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以看到，这只是一个基础的pom.xml文件，为项目定义了一个<code>groupId</code>、<code>artifactId</code>与<code>version</code>。我们会创建一个定制项，包含一个money业务要用的自定义节点。</p>
</div>
<div class="paragraph">
<p>在<code>pom.xml</code>文件中为项目添加这些集成库依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependencies&gt;</span>
  <span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>org.flowable.designer<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>org.flowable.designer.integration<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>5.22.0<span class="tok-nt">&lt;/version&gt;</span> <span class="tok-c">&lt;!-- 使用当前的Flowable Designer版本 --&gt;</span>
    <span class="tok-nt">&lt;scope&gt;</span>compile<span class="tok-nt">&lt;/scope&gt;</span>
  <span class="tok-nt">&lt;/dependency&gt;</span>
<span class="tok-nt">&lt;/dependencies&gt;</span>
...
<span class="tok-nt">&lt;repositories&gt;</span>
  <span class="tok-nt">&lt;repository&gt;</span>
      <span class="tok-nt">&lt;id&gt;</span>Flowable<span class="tok-nt">&lt;/id&gt;</span>
   <span class="tok-nt">&lt;/repository&gt;</span>
<span class="tok-nt">&lt;/repositories&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>最后，在<code>pom.xml</code>文件中，添加<code>maven-compiler-plugin</code>配置，设置Java源码级别为1.5以上（参见下面的代码片段）。要使用注解需要这个配置。也可以为Maven包含用于生成JAR的<code>MANIFEST.MF</code>文件。这不是必须的，但可以在这个manifest中使用特定参数，为你的扩展提供名字（这个名字可以在设计器的特定位置显示，主要用于在设计器中有多个扩展时使用）。如果想要这么做，在<code>pom.xml</code>中添加下列代码片段：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</div></td><td class="code"><span></span><span class="tok-nt">&lt;build&gt;</span>
  <span class="tok-nt">&lt;plugins&gt;</span>
    <span class="tok-nt">&lt;plugin&gt;</span>
      <span class="tok-nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="tok-nt">&lt;/artifactId&gt;</span>
      <span class="tok-nt">&lt;configuration&gt;</span>
        <span class="tok-nt">&lt;source&gt;</span>1.8<span class="tok-nt">&lt;/source&gt;</span>
        <span class="tok-nt">&lt;target&gt;</span>1.8<span class="tok-nt">&lt;/target&gt;</span>
        <span class="tok-nt">&lt;showDeprecation&gt;</span>true<span class="tok-nt">&lt;/showDeprecation&gt;</span>
        <span class="tok-nt">&lt;showWarnings&gt;</span>true<span class="tok-nt">&lt;/showWarnings&gt;</span>
        <span class="tok-nt">&lt;optimize&gt;</span>true<span class="tok-nt">&lt;/optimize&gt;</span>
      <span class="tok-nt">&lt;/configuration&gt;</span>
    <span class="tok-nt">&lt;/plugin&gt;</span>
    <span class="tok-nt">&lt;plugin&gt;</span>
      <span class="tok-nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tok-nt">&lt;/groupId&gt;</span>
      <span class="tok-nt">&lt;artifactId&gt;</span>maven-jar-plugin<span class="tok-nt">&lt;/artifactId&gt;</span>
      <span class="tok-nt">&lt;version&gt;</span>2.3.2<span class="tok-nt">&lt;/version&gt;</span>
      <span class="tok-nt">&lt;configuration&gt;</span>
        <span class="tok-nt">&lt;archive&gt;</span>
          <span class="tok-nt">&lt;index&gt;</span>true<span class="tok-nt">&lt;/index&gt;</span>
          <span class="tok-nt">&lt;manifest&gt;</span>
            <span class="tok-nt">&lt;addClasspath&gt;</span>false<span class="tok-nt">&lt;/addClasspath&gt;</span>
            <span class="tok-nt">&lt;addDefaultImplementationEntries&gt;</span>true<span class="tok-nt">&lt;/addDefaultImplementationEntries&gt;</span>
          <span class="tok-nt">&lt;/manifest&gt;</span>
          <span class="tok-nt">&lt;manifestEntries&gt;</span>
            <span class="tok-nt">&lt;FlowableDesigner-Extension-Name&gt;</span>Acme Money<span class="tok-nt">&lt;/FlowableDesigner-Extension-Name&gt;</span>
          <span class="tok-nt">&lt;/manifestEntries&gt;</span>
        <span class="tok-nt">&lt;/archive&gt;</span>
      <span class="tok-nt">&lt;/configuration&gt;</span>
    <span class="tok-nt">&lt;/plugin&gt;</span>
  <span class="tok-nt">&lt;/plugins&gt;</span>
<span class="tok-nt">&lt;/build&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>扩展的名字使用<code>FlowableDesigner-Extension-Name</code>参数描述。现在只剩下让Eclipse按照<code>pom.xml</code>的指导设置项目。因此打开命令行，并转到Eclipse工作空间中你项目的根目录。然后执行下列Maven命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn eclipse:eclipse</pre>
</div>
</div>
<div class="paragraph">
<p>等待构建完成。刷新项目（使用项目上下文菜单（右键点击），并选择<code>Refresh 刷新</code>）。现在Eclipse项目中应该已经建立了<code>src/main/java</code>与<code>src/main/resources</code>源码目录。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>当然也可以使用<a href="http://www.eclipse.org/m2e">m2eclipse</a>插件，并简单地在项目的上下文菜单（右键点击）中启用Maven依赖管理。然后在项目的上下文菜单中选择<code>Maven</code> &gt; <code>Update project configuration（更新项目配置）</code>。这也将配置源代码目录。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>这就完成了配置。现在可以开始为Flowable Designer创建自定义项了！</p>
</div>
</div>
<div class="sect5">
<h6 id="eclipseDesignerApplyingExtension">在Flowable Designer中应用你的扩展</h6>
<div class="paragraph">
<p>你也许想知道如何将你的扩展加入Flowable Designer，以便应用你的自定义项。需要这些步骤：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>创建扩展JAR（例如，使用Maven构建时，在项目中运行mvn install）后，需要将扩展传递至Flowable Designer安装的计算机；</p>
</li>
<li>
<p>将扩展存储在硬盘上，方便记忆的位置。<em>请注意：</em>必须保存在Flowable Designer的Eclipse工作空间之外——将扩展保存在工作空间内，会导致弹出错误消息弹框，扩展将不可用；</p>
</li>
<li>
<p>启动Flowable Designer，从菜单中，选择<code>Window</code> &gt; <code>Preferences</code>，或<code>Eclipse</code> &gt; <code>Preferences</code></p>
</li>
<li>
<p>在Preferences界面，键入<code>user</code>作为关键字。将可以看到在Eclipse中<code>Java</code>段落内，<code>User Libraries</code>的选项。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.preferences.userlibraries.png" alt="designer.preferences.userlibraries" width="250">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>选择<code>User Libraries</code>选项，将在右侧显示树形界面，可以添加库。应该可以看到一个默认组，可以用于添加Flowable Designer的扩展（根据Eclipse安装不同，也可能看到几个其他的）。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.preferences.userlibraries.flowable.empty.png" alt="designer.preferences.userlibraries.flowable.empty" width="600">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>选择<code>Flowable Designer Extensions</code>组，并点击<code>Add JARs&#8230;&#8203;</code>或<code>Add External JARs&#8230;&#8203;</code>按钮。跳转至存储扩展的目录，并选择希望添加的扩展文件。完成后，配置界面会将扩展作为<code>Flowable Designer Extensions</code>组的成员进行显示，像下面这样。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.preferences.userlibraries.flowable.moneytasks.png" alt="designer.preferences.userlibraries.flowable.moneytasks" width="600">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>点击<code>OK</code>按钮保存并关闭配置对话框。<code>Flowable Designer Extensions</code>会自动添加至你创建的新Flowable项目。可以在导航条或包管理器的项目树下的用户库条目中看到。如果工作空间中已经有了Flowable项目，也可以看到组中显示了新扩展，像下面这样。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.userlibraries.project.png" alt="designer.userlibraries.project" width="400">
</div>
</div>
<div class="paragraph">
<p>打开的流程图将在其画板上显示新扩展的图形（或者禁用部分图形，取决于扩展中的配置）。如果已经打开了流程图，关闭并重新打开就能在画板上看到变化。</p>
</div>
</div>
<div class="sect5">
<h6 id="_adding_shapes_to_the_palette">为画板添加图形</h6>
<div class="paragraph">
<p>项目配置完后，可以很轻松的为画板添加图形。每个添加的图形都表现为JAR中的一个类。请注意这些类并不是Flowable引擎运行时会使用的类。在扩展中可以为每个图形描述Flowable Designer可用的参数。在这些图形中，也可以定义运行时特性，并将由引擎在流程实例到达该节点时使用。运行时特性可以使用任何Flowable对普通<code>ServiceTask</code>支持的选项。查看<a href="#eclipseDesignerConfiguringRuntime">这个章节</a>了解更多信息。</p>
</div>
<div class="paragraph">
<p>图形的类是简单的Java类，加上一些注解。这个类需要实现<code>CustomServiceTask</code>接口，但不应该直接实现这个接口，而应该扩展<code>AbstractCustomServiceTask</code>基类（目前必须直接扩展这个类，而不能在中间使用abstract类）。在这个类的Javadoc中，可以看到其默认提供的，与需要覆盖的方法介绍。覆盖可以实现很多功能，例如为画板及画布中的图形提供图标（两个可以不一样），或者指定你希望节点实现的基图形（活动，时间，网关）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-cm">/**</span>
<span class="tok-cm"> * @author John Doe</span>
<span class="tok-cm"> * @version 1</span>
<span class="tok-cm"> * @since 1.0.0</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AcmeMoneyTask</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractCustomServiceTask</span> <span class="tok-o">{</span>
<span class="tok-o">...</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>需要实现<code>getName()</code>方法，来决定节点在画板上的名字。也可以将节点放在自己的抽屉中，并提供图标，只需要覆盖<code>AbstractCustomServiceTask</code>的对应方法就可以。如果希望提供图标，请确保放在JAR的<code>src/main/resources</code>包中，需要是16X16像素的JPEG或PNG格式图片。你要提供的路径是到这个目录的相对路径。</p>
</div>
<div class="paragraph">
<p>可以通过在类中添加成员，并使用<code>@Property</code>注解，来为形状添加参数。像这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nd">@Property</span><span class="tok-o">(</span><span class="tok-n">type</span> <span class="tok-o">=</span> <span class="tok-n">PropertyType</span><span class="tok-o">.</span><span class="tok-na">TEXT</span><span class="tok-o">,</span> <span class="tok-n">displayName</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Account Number&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Help</span><span class="tok-o">(</span><span class="tok-n">displayHelpShort</span> <span class="tok-o">=</span> <span class="tok-s">&quot;提供一个账户编码 Provide an account number&quot;</span><span class="tok-o">,</span> <span class="tok-n">displayHelpLong</span> <span class="tok-o">=</span> <span class="tok-n">HELP_ACCOUNT_NUMBER_LONG</span><span class="tok-o">)</span>
<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">accountNumber</span><span class="tok-o">;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用多种<code>PropertyType</code>值，在<a href="#eclipseDesignerPropertyTypes">这个章节</a>中详细描述。可以通过将required属性设置为true，将一个字段设为必填。如果用户没有填写这个字段，将会提示消息，背景也会变红。</p>
</div>
<div class="paragraph">
<p>如果想要调整类中多个参数在参数界面上的显示顺序，需要指定<code>@Property</code>注解的order属性。</p>
</div>
<div class="paragraph">
<p>可以看到有个<code>@Help</code>注解，它用于为用户提供一些填写字段的指导。也可以在类本身上使用<code>@Help</code>注解——这个信息将在显示给用户的参数表格最上面显示。</p>
</div>
<div class="paragraph">
<p>下面是<code>MoneyTask</code>详细介绍的列表。添加了一个备注字段，也可以看到节点包含了一个图标。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</div></td><td class="code"><span></span><span class="tok-cm">/**</span>
<span class="tok-cm"> * @author John Doe</span>
<span class="tok-cm"> * @version 1</span>
<span class="tok-cm"> * @since 1.0.0</span>
<span class="tok-cm"> */</span>
<span class="tok-nd">@Runtime</span><span class="tok-o">(</span><span class="tok-n">javaDelegateClass</span> <span class="tok-o">=</span> <span class="tok-s">&quot;org.acme.runtime.AcmeMoneyJavaDelegation&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Help</span><span class="tok-o">(</span><span class="tok-n">displayHelpShort</span> <span class="tok-o">=</span> <span class="tok-s">&quot;创建一个新的账户 Creates a new account&quot;</span><span class="tok-o">,</span> <span class="tok-n">displayHelpLong</span> <span class="tok-o">=</span>
    <span class="tok-s">&quot;使用给定的账户编码，创建一个新的账户 Creates a new account using the account number specified&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AcmeMoneyTask</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractCustomServiceTask</span> <span class="tok-o">{</span>

  <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">HELP_ACCOUNT_NUMBER_LONG</span> <span class="tok-o">=</span>
      <span class="tok-s">&quot;提供一个可用作账户编码的编码。 Provide a number that is suitable as an account number.&quot;</span><span class="tok-o">;</span>

  <span class="tok-nd">@Property</span><span class="tok-o">(</span><span class="tok-n">type</span> <span class="tok-o">=</span> <span class="tok-n">PropertyType</span><span class="tok-o">.</span><span class="tok-na">TEXT</span><span class="tok-o">,</span> <span class="tok-n">displayName</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Account Number&quot;</span><span class="tok-o">,</span> <span class="tok-n">required</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">)</span>
  <span class="tok-nd">@Help</span><span class="tok-o">(</span><span class="tok-n">displayHelpShort</span> <span class="tok-o">=</span> <span class="tok-s">&quot;提供一个账户编码 Provide an account number&quot;</span><span class="tok-o">,</span> <span class="tok-n">displayHelpLong</span> <span class="tok-o">=</span> <span class="tok-n">HELP_ACCOUNT_NUMBER_LONG</span><span class="tok-o">)</span>
  <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">accountNumber</span><span class="tok-o">;</span>

  <span class="tok-nd">@Property</span><span class="tok-o">(</span><span class="tok-n">type</span> <span class="tok-o">=</span> <span class="tok-n">PropertyType</span><span class="tok-o">.</span><span class="tok-na">MULTILINE_TEXT</span><span class="tok-o">,</span> <span class="tok-n">displayName</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Comments&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Help</span><span class="tok-o">(</span><span class="tok-n">displayHelpShort</span> <span class="tok-o">=</span> <span class="tok-s">&quot;提供备注 Provide comments&quot;</span><span class="tok-o">,</span> <span class="tok-n">displayHelpLong</span> <span class="tok-o">=</span>
      <span class="tok-s">&quot;可以为节点添加备注，以提供详细说明。 You can add comments to the node to provide a brief description.&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">comments</span><span class="tok-o">;</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">contributeToPaletteDrawer</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-s">&quot;Acme Corporation&quot;</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getName</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-s">&quot;Money node&quot;</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getSmallIconPath</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-s">&quot;icons/coins.png&quot;</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果使用这个图形扩展Flowable Designer，画板与相应的图形将像是这样：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.palette.add.money.png" alt="designer.palette.add.money" width="250">
</div>
</div>
<div class="paragraph">
<p>money任务的参数界面在下面显示。请注意<code>accountNumber</code>字段的必填信息。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.palette.add.money.properties.required.png" alt="designer.palette.add.money.properties.required">
</div>
</div>
<div class="paragraph">
<p>在创建流程图、填写参数字段时，用户可以使用静态文本，或者使用流程变量的表达式（如"This little piggy went to ${piggyLocation}"）。一般来说，用户可以在text字段自由填写任何文本。如果你希望用户使用表达式，并（使用<code>@Runtime</code>）为<code>CustomServiceTask</code>添加运行时行为，请确保在代理类中使用<code>Expression</code>字段，以便表达式可以在运行时正确解析。可以在<a href="#eclipseDesignerConfiguringRuntime">这个章节</a>找到更多关于运行时行为的信息。</p>
</div>
<div class="paragraph">
<p>字段的帮助信息由每个参数右侧的按钮提供。点击该按钮将弹出显示下列内容。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.palette.add.money.help.png" alt="designer.palette.add.money.help">
</div>
</div>
<div class="sect6">
<h7 id="eclipseDesignerConfiguringRuntime">配置自定义服务任务的运行时执行</h7>
<div class="paragraph">
<p>当设置好字段，并将扩展应用至Designer后，用户就可以在建模流程时，配置服务任务的这些参数。在大多数情况下，会希望在Flowable执行流程时，使用这些用户配置参数。要做到这一点，必须告诉Flowable，当流程到达你<code>CustomServiceTask</code>时，需要使用哪个类。</p>
</div>
<div class="paragraph">
<p>有一个特别的注解，<code>@Runtime</code>，用于指定<code>CustomServiceTask</code>的运行时特性。这里有些如何使用的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nd">@Runtime</span><span class="tok-o">(</span><span class="tok-n">javaDelegateClass</span> <span class="tok-o">=</span> <span class="tok-s">&quot;org.acme.runtime.AcmeMoneyJavaDelegation&quot;</span><span class="tok-o">)</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>使用时，<code>CustomServiceTask</code>将会表现为流程建模BPMN中的一个普通的<code>ServiceTask</code>。Flowable提供了<a href="#bpmnJavaServiceTask">多种方法</a>定义<code>ServiceTask</code>的运行时特性。因此，<code>@Runtime</code>可以使用Flowable提供的三个属性中的一个：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>javaDelegateClass</code>在BPMN输出中映射为<code>flowable:class</code>。指定一个实现了<code>JavaDelegate</code>的类的全限定类名。</p>
</li>
<li>
<p><code>expression</code>在BPMN输出中映射为<code>flowable:expression</code>。指定一个需要执行的方法的表达式，例如一个Spring Bean中的方法。当使用这个选项时，<em>不应</em>在字段上指定任何<code>@Property</code>注解。下面有更详细的说明。</p>
</li>
<li>
<p><code>javaDelegateExpression</code>在BPMN输出中映射为<code>flowable:delegateExpression</code>。指定一个实现了<code>JavaDelegate</code>的类的表达式。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>如果在类中为Flowable提供了可以注入的成员，就可以将用户的参数至注入到运行时类中。名字需要与<code>CustomServiceTask</code>的成员名一致。查看用户手册的<a href="#serviceTaskFieldInjection">这个部分</a>了解更多信息。请注意从Designer的5.11.0版本开始，可以为动态字段值使用<code>Expression</code>接口。这意味着Flowable Designer中参数的值必须要是表达式，并且这个表达式将在之后注入<code>JavaDelegate</code>实现类的<code>Expression</code>参数中。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>可以在<code>CustomServiceTask</code>的成员上使用<code>@Property</code>注解，但如果使用<code>@Runtime</code>的<code>expression</code>属性，则<code>@Property</code>注解将不会生效。原因是指定的表达式将被Flowable尝试解析为<em>方法</em>，而不是类。因此，不会有对类的注入。如果在<code>@Runtime</code>注解中使用<code>expression</code>，则注解为<code>@Property</code>的成员将被Designer忽略。Designer不会将它们渲染为节点参数页面的可编辑字段，也不会为这些参数在流程的BPMN中生成输出。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>请注意不应该在你的扩展JAR中包括运行时类，因为它与Flowable库是分离的。Flowable需要在运行时能够找到它们，因此需要将其放在Flowable引擎的clsspath中。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Designer代码树中的示例项目包含了配置<code>@Runtime</code>的不同选项的例子。可以从查看money-tasks项目开始。引用代理类的示例在money-delegates项目中。</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="eclipseDesignerPropertyTypes">参数类型</h6>
<div class="paragraph">
<p>这个章节介绍了<code>CustomServiceTask</code>能够使用的参数类型，可以将类型设置为<code>PropertyType</code>的值。</p>
</div>
<div class="sect6">
<h7 id="_propertytype_text">PropertyType.TEXT</h7>
<div class="paragraph">
<p>创建如下所示的单行文本字段。可以是必填字段，并将验证消息作为提示信息显示。验证失败会将字段的背景变为浅红色。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.text.invalid.png" alt="designer.property.text.invalid">
</div>
</div>
</div>
<div class="sect6">
<h7 id="_propertytype_multiline_text">PropertyType.MULTILINE_TEXT</h7>
<div class="paragraph">
<p>创建如下所示的多行文本字段（高度固定为80像素）。可以是必填字段，并将验证消息作为提示信息显示。验证失败会将字段的背景变为浅红色。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.multiline.text.invalid.png" alt="designer.property.multiline.text.invalid">
</div>
</div>
</div>
<div class="sect6">
<h7 id="_propertytype_period">PropertyType.PERIOD</h7>
<div class="paragraph">
<p>创建一个组合编辑框，可以使用转盘控件编辑每一个单位的数量，来指定一段时间长度，结果如下所示。可以是必填字段（含义是不能所有的值都是0，也就是至少有一个部分要有非零值），并将验证消息作为提示信息显示。验证失败会将整个字段的背景变为浅红色。字段的值保存为1y 2mo 3w 4d 5h 6m 7s格式的字符串，代表1年，2月，3周，4天，6分钟及7秒。即使有部分为0，也总是存储整个字符串。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.period.png" alt="designer.property.period">
</div>
</div>
</div>
<div class="sect6">
<h7 id="_propertytype_boolean_choice">PropertyType.BOOLEAN_CHOICE</h7>
<div class="paragraph">
<p>创建一个单独的boolean复选框，或者开关选择。请注意可以在<code>Property</code>注解上指定<code>required</code>属性，但不会生效，不然用户就无法选择是否选中复选框。流程图中存储的值为java.lang.Boolean.toString(boolean)，其结果为"true"或"false"。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.boolean.choice.png" alt="designer.property.boolean.choice">
</div>
</div>
</div>
<div class="sect6">
<h7 id="_propertytype_radio_choice">PropertyType.RADIO_CHOICE</h7>
<div class="paragraph">
<p>创建如下所示的一组单选按钮。选中任何一个单选按钮都自动排除任何其他的选择（也就是说，单选）。可以是必填字段，并将验证消息作为提示信息显示。验证失败会将组的背景变为浅红色。</p>
</div>
<div class="paragraph">
<p>这个参数类型需要注解的类成员同时使用<code>@PropertyItems</code>注解（例如如下所示）。可以使用这个额外的注解，以字符串数组的方式，指定条目的列表。需要为每一个条目添加两个数组项：第一个，用于显示的标签；第二个，用于存储的值。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nd">@Property</span><span class="tok-o">(</span><span class="tok-n">type</span> <span class="tok-o">=</span> <span class="tok-n">PropertyType</span><span class="tok-o">.</span><span class="tok-na">RADIO_CHOICE</span><span class="tok-o">,</span> <span class="tok-n">displayName</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Withdrawl limit&quot;</span><span class="tok-o">,</span> <span class="tok-n">required</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">)</span>
<span class="tok-nd">@Help</span><span class="tok-o">(</span><span class="tok-n">displayHelpShort</span> <span class="tok-o">=</span> <span class="tok-s">&quot;最大每日提款限额 The maximum daily withdrawl amount &quot;</span><span class="tok-o">,</span>
    <span class="tok-n">displayHelpLong</span> <span class="tok-o">=</span> <span class="tok-s">&quot;选择从该账户中每日最大能提取的额度。 Choose the maximum daily amount that can be withdrawn from the account.&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@PropertyItems</span><span class="tok-o">({</span> <span class="tok-n">LIMIT_LOW_LABEL</span><span class="tok-o">,</span> <span class="tok-n">LIMIT_LOW_VALUE</span><span class="tok-o">,</span> <span class="tok-n">LIMIT_MEDIUM_LABEL</span><span class="tok-o">,</span> <span class="tok-n">LIMIT_MEDIUM_VALUE</span><span class="tok-o">,</span>
    <span class="tok-n">LIMIT_HIGH_LABEL</span><span class="tok-o">,</span> <span class="tok-n">LIMIT_HIGH_VALUE</span> <span class="tok-o">})</span>
<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">withdrawlLimit</span><span class="tok-o">;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.radio.choice.png" alt="designer.property.radio.choice">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.radio.choice.invalid.png" alt="designer.property.radio.choice.invalid">
</div>
</div>
</div>
<div class="sect6">
<h7 id="_propertytype_combobox_choice">PropertyType.COMBOBOX_CHOICE</h7>
<div class="paragraph">
<p>创建如下所示的，带有固定选项的下拉框。可以是必填字段，并将验证消息作为提示信息显示。验证失败会将下拉框的背景变为浅红色。</p>
</div>
<div class="paragraph">
<p>这个参数类型需要注解的类成员同时使用<code>@PropertyItems</code>注解（例如如下所示）。可以使用这个额外的注解，以字符串数组的方式，指定条目的列表。需要为每一个条目添加两个数组项：第一个，用于显示的标签；第二个，用于存储的值。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-nd">@Property</span><span class="tok-o">(</span><span class="tok-n">type</span> <span class="tok-o">=</span> <span class="tok-n">PropertyType</span><span class="tok-o">.</span><span class="tok-na">COMBOBOX_CHOICE</span><span class="tok-o">,</span> <span class="tok-n">displayName</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Account type&quot;</span><span class="tok-o">,</span> <span class="tok-n">required</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">)</span>
<span class="tok-nd">@Help</span><span class="tok-o">(</span><span class="tok-n">displayHelpShort</span> <span class="tok-o">=</span> <span class="tok-s">&quot;账户的类型 The type of account&quot;</span><span class="tok-o">,</span>
    <span class="tok-n">displayHelpLong</span> <span class="tok-o">=</span> <span class="tok-s">&quot;从选项列表中选择账户的类型 Choose a type of account from the list of options&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@PropertyItems</span><span class="tok-o">({</span> <span class="tok-n">ACCOUNT_TYPE_SAVINGS_LABEL</span><span class="tok-o">,</span> <span class="tok-n">ACCOUNT_TYPE_SAVINGS_VALUE</span><span class="tok-o">,</span> <span class="tok-n">ACCOUNT_TYPE_JUNIOR_LABEL</span><span class="tok-o">,</span>
    <span class="tok-n">ACCOUNT_TYPE_JUNIOR_VALUE</span><span class="tok-o">,</span> <span class="tok-n">ACCOUNT_TYPE_JOINT_LABEL</span><span class="tok-o">,</span> <span class="tok-n">ACCOUNT_TYPE_JOINT_VALUE</span><span class="tok-o">,</span>
    <span class="tok-n">ACCOUNT_TYPE_TRANSACTIONAL_LABEL</span><span class="tok-o">,</span> <span class="tok-n">ACCOUNT_TYPE_TRANSACTIONAL_VALUE</span><span class="tok-o">,</span> <span class="tok-n">ACCOUNT_TYPE_STUDENT_LABEL</span><span class="tok-o">,</span>
    <span class="tok-n">ACCOUNT_TYPE_STUDENT_VALUE</span><span class="tok-o">,</span> <span class="tok-n">ACCOUNT_TYPE_SENIOR_LABEL</span><span class="tok-o">,</span> <span class="tok-n">ACCOUNT_TYPE_SENIOR_VALUE</span> <span class="tok-o">})</span>
<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">accountType</span><span class="tok-o">;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.combobox.choice.png" alt="designer.property.combobox.choice">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.combobox.choice.invalid.png" alt="designer.property.combobox.choice.invalid">
</div>
</div>
</div>
<div class="sect6">
<h7 id="_propertytype_date_picker">PropertyType.DATE_PICKER</h7>
<div class="paragraph">
<p>创建如下所示的日期选择控件。可以是必填字段，并将验证消息作为提示信息显示（请注意，这个控件会自动填入当前系统时间，因此值很难为空）。验证失败会将控件的背景变为浅红色。</p>
</div>
<div class="paragraph">
<p>这个参数类型需要注解的类成员同时使用<code>@DatePickerProperty</code>注解（例如如下所示）。可以使用这个额外的注解，指定在流程图中存储日期时使用的日期格式，以及要用于显示的日期选择类型。这些属性都是可选的，当没有指定时会使用默认值（<code>DatePickerProperty</code>注解的静态变量）。<code>dateTimePattern</code>属性应该使用<code>SimpleDateFormat</code>类支持的格式。当使用<code>swtStyle</code>属性时，应该指定<code>SWT</code>的<code>DateTime</code>控件支持的整形值，因为将使用这个控件渲染这个类型的参数。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nd">@Property</span><span class="tok-o">(</span><span class="tok-n">type</span> <span class="tok-o">=</span> <span class="tok-n">PropertyType</span><span class="tok-o">.</span><span class="tok-na">DATE_PICKER</span><span class="tok-o">,</span> <span class="tok-n">displayName</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Expiry date&quot;</span><span class="tok-o">,</span> <span class="tok-n">required</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">)</span>
<span class="tok-nd">@Help</span><span class="tok-o">(</span><span class="tok-n">displayHelpShort</span> <span class="tok-o">=</span> <span class="tok-s">&quot;账户过期的日期 The date the account expires.&quot;</span><span class="tok-o">,</span>
    <span class="tok-n">displayHelpLong</span> <span class="tok-o">=</span> <span class="tok-s">&quot;选择一个日期，如果账户未在该日期前延期，则将过期。Choose the date when the account will expire if not extended before the date.&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@DatePickerProperty</span><span class="tok-o">(</span><span class="tok-n">dateTimePattern</span> <span class="tok-o">=</span> <span class="tok-s">&quot;MM-dd-yyyy&quot;</span><span class="tok-o">,</span> <span class="tok-n">swtStyle</span> <span class="tok-o">=</span> <span class="tok-mi">32</span><span class="tok-o">)</span>
<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">expiryDate</span><span class="tok-o">;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.date.picker.png" alt="designer.property.date.picker">
</div>
</div>
</div>
<div class="sect6">
<h7 id="_propertytype_data_grid">PropertyType.DATA_GRID</h7>
<div class="paragraph">
<p>创建一个如下所示的数据表格控件。数据表格可以让用户输入任意行数据，并为每一行输入固定列数的值（每一组行列的组合代表一个单元格）。用户可以添加与删除行。</p>
</div>
<div class="paragraph">
<p>这个参数类型需要注解的类成员同时使用<code>@DataGridProperty</code>注解（例如如下所示）。可以使用这个额外的注解，指定数据表格的细节属性。需要用<code>itemClass</code>属性引用另一个类，来决定表格中有哪些列。Flowable Designer期望其成员类型为<code>List</code>。按照约定，可以将<code>itemClass</code>属性的类用作其泛型类型。如果，例如，在表格中编辑一个杂货清单，用<code>GroceryListItem</code>类定义表格的列。在<code>CustomServiceTask</code>中，可以这样引用它：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nd">@Property</span><span class="tok-o">(</span><span class="tok-n">type</span> <span class="tok-o">=</span> <span class="tok-n">PropertyType</span><span class="tok-o">.</span><span class="tok-na">DATA_GRID</span><span class="tok-o">,</span> <span class="tok-n">displayName</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Grocery List&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@DataGridProperty</span><span class="tok-o">(</span><span class="tok-n">itemClass</span> <span class="tok-o">=</span> <span class="tok-n">GroceryListItem</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-kd">private</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">GroceryListItem</span><span class="tok-o">&gt;</span> <span class="tok-n">groceryList</span><span class="tok-o">;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>与<code>CustomServiceTask</code>一样，"itemClass"可以使用相同的注解指定字段类型（除了数据表格）。目前支持<code>TEXT</code>，<code>MULTILINE_TEXT</code> 与<code>PERIOD</code>。你会注意到不论其<code>PropertyType</code>是什么，表格都会为每个字段创建一个单行文本控件。这是为了表格保持整洁与可读。如果考虑下<code>PERIOD</code>这种<code>PropertyType</code>的显示模式，就可以想象出它绝不适合在表格的单元格中显示。对于 <code>MULTILINE_TEXT</code> 与<code>PERIOD</code>，会为每个字段添加双击机制，并会为该<code>PropertyType</code>弹出更大的编辑器。数值将在用户点击OK后存储至字段，因此可以在表格中显示。</p>
</div>
<div class="paragraph">
<p>必选属性使用与普通<code>TEXT</code>字段类似的方式处理，当任何字段失去焦点时，会验证整个表格。验证失败的单元格，背景色将变为浅红色。</p>
</div>
<div class="paragraph">
<p>默认情况下，这个组件允许用户添加行，但不能决定行的顺序。如果希望允许排序，需要将<code>orderable</code>属性设置为true，这将在每一行末尾启用按钮，以将该行在表格内上移或下移。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>目前，这个参数类型不能正确注入运行时类。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.datagrid.png" alt="designer.property.datagrid">
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_disabling_default_shapes_in_the_palette">在画板中禁用默认图形</h6>
<div class="paragraph">
<p>这种自定义需要在你的扩展中引入一个实现了<code>DefaultPaletteCustomizer</code>接口的类。不应该直接实现这个接口，而要扩展<code>AbstractDefaultPaletteCustomizer</code>基类。目前，这个类不提供任何功能，但<code>DefaultPaletteCustomizer</code>未来的版本中会提供更多功能，这样基类将提供更多合理的默认值。因此最好使用它的子类，这样你的扩展将可以兼容未来的版本。</p>
</div>
<div class="paragraph">
<p>扩展<code>AbstractDefaultPaletteCustomizer</code>需要实现一个方法，<code>disablePaletteEntries()</code>，并必须返回一个<code>PaletteEntry</code>值的list。请注意如果从默认集合中移除图形，导致某个抽屉中没有图形，则该抽屉也会被移除。如果需要禁用所有的默认图形，只需要在结果中添加<code>PaletteEntry.ALL</code>。作为例子，下面的代码禁用了画板中的手动任务和脚本任务图形。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyPaletteCustomizer</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractDefaultPaletteCustomizer</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">PaletteEntry</span><span class="tok-o">&gt;</span> <span class="tok-nf">disablePaletteEntries</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">PaletteEntry</span><span class="tok-o">&gt;</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">PaletteEntry</span><span class="tok-o">&gt;();</span>
    <span class="tok-n">result</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">PaletteEntry</span><span class="tok-o">.</span><span class="tok-na">MANUAL_TASK</span><span class="tok-o">);</span>
    <span class="tok-n">result</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">PaletteEntry</span><span class="tok-o">.</span><span class="tok-na">SCRIPT_TASK</span><span class="tok-o">);</span>
    <span class="tok-k">return</span> <span class="tok-n">result</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>应用这个扩展的结果在下图显示。可以看到，在<code>Tasks</code>抽屉中不再显示手动任务与脚本任务图形。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.palette.disable.manual.and.script.png" alt="designer.palette.disable.manual.and.script">
</div>
</div>
<div class="paragraph">
<p>要禁用所有默认图形，需要使用类似下面的代码。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyPaletteCustomizer</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractDefaultPaletteCustomizer</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">PaletteEntry</span><span class="tok-o">&gt;</span> <span class="tok-nf">disablePaletteEntries</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">PaletteEntry</span><span class="tok-o">&gt;</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">PaletteEntry</span><span class="tok-o">&gt;();</span>
    <span class="tok-n">result</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">PaletteEntry</span><span class="tok-o">.</span><span class="tok-na">ALL</span><span class="tok-o">);</span>
    <span class="tok-k">return</span> <span class="tok-n">result</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>结果像是这样（请注意画板中不再显示默认图形所在的抽屉）：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.palette.disable.all.png" alt="designer.palette.disable.all">
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_validating_diagrams_and_exporting_to_custom_output_formats">验证流程图与输出为自定义格式</h5>
<div class="paragraph">
<p>除了自定义画板，也可以为Flowable Designer创建扩展，来进行流程图验证，以及将流程图的信息保存为Eclipse工作空间中的自定义资源。可以通过内建的扩展点实现 ，这个章节将介绍如何做。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>保存功能最近正在重构。我们仍在开发验证功能。下面的文档记录的是旧的情况，并将在新功能可用后更新。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Flowable Designer可以编写用于验证流程图的扩展。默认情况已经可以在工具中验证BPMN结构，但你也可以添加自己的，如果希望验证额外的条目，例如建模约定，或者<code>CustomServiceTask</code>中的参数值。这些扩展被称作<code>Process Validators</code>。</p>
</div>
<div class="paragraph">
<p>也可以自定义配置，在Flowable Designer保存流程图时，发布为其它格式。这些扩展被称作<code>Export Marshallers</code>，将在每次用户进行保存操作时，由Flowable Designer自动调用。这个行为可以在Eclipse配置对话框中，为每一种扩展检测出的格式，分别启用或禁用。Designer会根据用户的配置，确保在保存流程图时，调用你的<code>ExportMarshaller</code>。</p>
</div>
<div class="paragraph">
<p>通常，会想要将<code>ProcessValidator</code>与<code>ExportMarshaller</code>一起使用。例如有一些<code>CustomServiceTask</code>，带有一些希望在流程中使用的参数。然而，在生成流程前，希望验证其中一些值。联合使用<code>ProcessValidator</code>与<code>ExportMarshaller</code>是最佳的方式，Flowable Designer也允许你无缝拼接扩展。</p>
</div>
<div class="paragraph">
<p>要创建一个<code>ProcessValidator</code>或<code>ExportMarshaller</code>，需要创建与扩展画板不同的扩展类型。原因很简单：你的代码会需访问比集成库中提供的更多的API。特别是，会需要使用Eclipse的类。因此从一开始，就需要创建一个Eclipse插件（可以使用Eclipse的PDE支持完成），并将其打包为自定义Eclipse产品或特性。解释开发Eclipse插件的所有细节，已经不是本用户手册的范畴，因此下面的介绍仅限于扩展Flowable Designer的功能。</p>
</div>
<div class="paragraph">
<p>扩展包需要依赖下列库：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>org.eclipse.core.runtime</p>
</li>
<li>
<p>org.eclipse.core.resources</p>
</li>
<li>
<p>org.flowable.designer.eclipse</p>
</li>
<li>
<p>org.flowable.designer.libs</p>
</li>
<li>
<p>org.flowable.designer.util</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>可选的，如果希望在扩展中使用，可以通过Designer使用org.apache.commons.lang包。</p>
</div>
<div class="paragraph">
<p><code>ProcessValidator</code>与<code>ExportMarshaller</code>都是通过扩展基类创建的。这些基类从其父类<code>AbstractDiagramWorker</code>继承了一些有用的方法。使用这些方法，可以创建在Eclipse问题视图中显示的提示信息，警告，错误标记，以便用户了解错误与重要的信息。可以以<code>Resources</code>与<code>InputStreams</code>的格式获取流程图的信息，这些信息由<code>DiagramWorkerContext</code>提供，在<code>AbstractDiagramWorker</code>中可用。</p>
</div>
<div class="paragraph">
<p>不论是<code>ProcessValidator</code>还是<code>ExportMarshaller</code>中，做任何事情前最好调用<code>clearMarkers()</code>；这将清除任何已有的标记（标记自动连接至操作，清除一个操作的标记不会影响其他操作的标记）。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-c1">// 首先清除流程图的标记 Clear markers for this diagram first</span>
<span class="tok-n">clearMarkersForDiagram</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也需要使用（<code>DiagramWorkerContext</code>中）提供的进度监控，将你的进度报告给用户，因为验证与保存操作可能花费很多时间，而用户只能等待。报告进度需要了解如何使用Eclipse的功能。查看<a href="http://www.eclipse.org/articles/Article-Progress-Monitors/article.html">这篇文章</a>了解详细概念与用法。</p>
</div>
<div class="sect5">
<h6 id="_creating_a_processvalidator_extension">创建ProcessValidator扩展</h6>
<div class="paragraph">
<p>在你的<code>plugin.xml</code>文件中，创建一个<code>org.flowable.designer.eclipse.extension.validation.ProcessValidator</code>扩展点的扩展。这个扩展点需要扩展<code>AbstractProcessValidator</code>类。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-cp">&lt;?eclipse version=&quot;3.6&quot;?&gt;</span>
<span class="tok-nt">&lt;plugin&gt;</span>
  <span class="tok-nt">&lt;extension</span>
    <span class="tok-na">point=</span><span class="tok-s">&quot;org.flowable.designer.eclipse.extension.validation.ProcessValidator&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;ProcessValidator</span>
      <span class="tok-na">class=</span><span class="tok-s">&quot;org.acme.validation.AcmeProcessValidator&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;/ProcessValidator&gt;</span>
  <span class="tok-nt">&lt;/extension&gt;</span>
<span class="tok-nt">&lt;/plugin&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AcmeProcessValidator</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractProcessValidator</span> <span class="tok-o">{</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>需要实现一些方法。最重要的是实现<code>getValidatorId()</code>，为验证器返回全局唯一ID。这将使你可以在<code>ExportMarshaller</code>中调用它，或者允许其他<code>ExportMarshaller</code>调用你的验证器。实现<code>getValidatorName()</code>，为验证器返回逻辑名字。这个名字将在对话框中显示给用户。<code>getFormatName()</code>可以返回这个验证器通常验证的流程图类型。</p>
</div>
<div class="paragraph">
<p>验证工作通过<code>validateDiagram()</code>方法实现。从这里开始，就是你自己的功能代码了。然而，通常你会想从获取流程中的所有节点开始，这样就可以迭代访问，收集、比较与验证数据了。这段代码展示了如何进行这些操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-kd">final</span> <span class="tok-n">EList</span><span class="tok-o">&lt;</span><span class="tok-n">EObject</span><span class="tok-o">&gt;</span> <span class="tok-n">contents</span> <span class="tok-o">=</span> <span class="tok-n">getResourceForDiagram</span><span class="tok-o">(</span><span class="tok-n">diagram</span><span class="tok-o">).</span><span class="tok-na">getContents</span><span class="tok-o">();</span>
<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">EObject</span> <span class="tok-n">object</span> <span class="tok-o">:</span> <span class="tok-n">contents</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">object</span> <span class="tok-k">instanceof</span> <span class="tok-n">StartEvent</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-c1">// 验证启动事件 Perform some validations for StartEvents</span>
  <span class="tok-o">}</span>
  <span class="tok-c1">// 其它节点类型与验证 Other node types and validations</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>别忘了在验证过程中调用<code>addProblemToDiagram()</code>与/或<code>addWarningToDiagram()</code>等等。确保在结束时返回正确的boolean结果，以指示验证成功还是失败。可以由后续调用的<code>ExportMarshaller</code>判断下一步操作。</p>
</div>
</div>
<div class="sect5">
<h6 id="_creating_an_exportmarshaller_extension">创建ExportMarshaller扩展</h6>
<div class="paragraph">
<p>在你的<code>plugin.xml</code>文件中，创建一个<code>org.flowable.designer.eclipse.extension.ExportMarshaller</code>扩展点的扩展。这个扩展点需要扩展<code>AbstractExportMarshaller</code>类。这个基类提供了一些在保存为你自己的格式时有用的方法，但最重要的是提供了将资源保存至工作空间，以及调用验证器的功能。</p>
</div>
<div class="paragraph">
<p>Designer的示例目录下有一个示例实现。这个示例展示了如何使用基类中的方法完成基本操作，例如访问流程图的<code>InputStream</code>，使用其<code>BpmnModel</code>，以及将资源保存至工作空间。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-cp">&lt;?eclipse version=&quot;3.6&quot;?&gt;</span>
<span class="tok-nt">&lt;plugin&gt;</span>
  <span class="tok-nt">&lt;extension</span>
    <span class="tok-na">point=</span><span class="tok-s">&quot;org.flowable.designer.eclipse.extension.ExportMarshaller&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;ExportMarshaller</span>
      <span class="tok-na">class=</span><span class="tok-s">&quot;org.acme.export.AcmeExportMarshaller&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;/ExportMarshaller&gt;</span>
  <span class="tok-nt">&lt;/extension&gt;</span>
  <span class="tok-nt">&lt;/plugin&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AcmeExportMarshaller</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractExportMarshaller</span> <span class="tok-o">{</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>需要实现一些方法，例如<code>getMarshallerName()</code>与<code>getFormatName()</code>。这些方法用来为用户显示选项，并在流程对话框中显示信息，因此请确保你返回的描述反映了正在进行的操作。</p>
</div>
<div class="paragraph">
<p>大部分工作主要在<code>doMarshallDiagram()</code>方法中进行。</p>
</div>
<div class="paragraph">
<p>如果需要先进行一些验证，可以直接从保存器中调用验证器。从验证器可以获得boolean结果，就可以知道验证是否成功。在大多数情况下，在流程图验证失败时不会想要进行保存，但你也可以选择仍然继续，甚至在验证失败时创建不同的资源。</p>
</div>
<div class="paragraph">
<p>一旦获取了所有需要的数据，就可以调用<code>saveResource()</code>方法创建保存有数据的文件。在一个保存器中，可以调用<code>saveResource()</code>任意多次；因此一个验证器可以创建多于一个输出文件。</p>
</div>
<div class="paragraph">
<p>可以使用<code>AbstractDiagramWorker</code>类的<code>saveResource()</code>方法构建输出资源的文件名。可以使用一些有用的变量用于创建文件名，例如_original-filename__my-format-name.xml。这些变量在Javadocs中描述，通过<code>ExportMarshaller</code>接口定义。如果希望自行解析保存位置，也可以在一个字符串（例如一个路径）上使用<code>resolvePlaceholders()</code>。<code>getURIRelativeToDiagram()</code>会为你调用它。</p>
</div>
<div class="paragraph">
<p>应该使用提供的进度监控将你的进度报告给用户。<a href="http://www.eclipse.org/articles/Article-Progress-Monitors/article.html">这个文章</a>描述了如何做。</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="flowableUIApps">6. Flowable UI应用</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Flowable提供了几个web应用，用于演示及介绍Flowable项目提供的功能：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Flowable IDM: 身份管理应用。为所有Flowable UI应用提供单点登录认证功能，并且为拥有IDM管理员权限的用户提供了管理用户、组与权限的功能。</p>
</li>
<li>
<p>Flowable Modeler: 让具有建模权限的用户可以创建流程模型、表单、选择表与应用定义。</p>
</li>
<li>
<p>Flowable Task: 运行时任务应用。提供了启动流程实例、编辑任务表单、完成任务，以及查询流程实例与任务的功能。</p>
</li>
<li>
<p>Flowable Admin: 管理应用。让具有管理员权限的用户可以查询BPMN、DMN、Form及Content引擎，并提供了许多选项用于修改流程实例、任务、作业等。管理应用通过REST API连接至引擎，并与Flowable Task应用及Flowable REST应用一同部署。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>所有其他的应用都需要Flowable IDM提供认证。每个应用的WAR文件可以部署在相同的servlet容器（如Apache Tomcat）中，也可以部署在不同的容器中。由于每个应用使用相同的cookie进行认证，因此应用需要运行在相同的域名下。</p>
</div>
<div class="paragraph">
<p>应用基于Spring Boot 2.0。也就是说WAR文件实际上可以作为独立应用直接运行。参见Spring Boot文档中的<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/build-tool-plugins-maven-plugin.html#build-tool-plugins-maven-packaging">可执行的Jar</a>章节。</p>
</div>
<div class="sect2">
<h3 id="uiAppInstallation">6.1. 安装</h3>
<div class="paragraph">
<p>如前所述，全部四个UI应用可以部署在同一个Tomcat服务器里，并且作为入门，这大概也是最简单的方式。也可以选择只安装Modeler应用，但是必须也要部署、运行Flowable IDM应用。在这个安装指导中，我们会介绍如何将所有的四个应用安装至Tomcat服务。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>下载最新稳定版本的<a href="http://tomcat.apache.org">Apache Tomcat</a>。</p>
</li>
<li>
<p>下载最新稳定版本的<a href="http://www.flowable.org/downloads.html">Flowable 6</a>。</p>
</li>
<li>
<p>将Flowable发行包中，<em>wars</em>文件夹下的flowable-admin.war、flowable-idm.war、flowable-modeler.war与flowable-task.war文件，复制到Tomcat的webapps文件夹下。</p>
</li>
<li>
<p>运行bin/startup.sh（在Mac OS或Linux下），或bin/startup.bat（在Windows下）脚本，启动Tomcat服务器。</p>
</li>
<li>
<p>打开web浏览器，访问<a href="http://localhost:8080/flowable-modeler"><a href="http://localhost:8080/flowable-modeler" class="bare">http://localhost:8080/flowable-modeler</a></a>。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>这样所有的Flowable UI应用都将运行在H2内存数据库下，并且可以在浏览器中看到如下登录界面：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_idm_login_screen.png" alt="flowable idm login screen">
</div>
</div>
<div class="paragraph">
<p>默认情况下，Flowable IDM应用将创建一个具有访问所有Flowable UI应用所需的权限的admin用户。使用admin/test登录，浏览器会跳转至Flowable Modeler应用：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_startup_screen.png" alt="flowable modeler startup screen">
</div>
</div>
<div class="paragraph">
<p>作为可执行的Spring Boot应用，可以直接以独立应用模式运行UI，而不需要应用服务器。
可以像这样启动一个应用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>java -jar flowable-idm.war</code></pre>
</div>
</div>
<div class="paragraph">
<p>通常会需要将默认的H2内存数据库配置，修改为MySQL或Postgres（或其他持久化数据库）。
可以修改每个应用<em>WEB-INF/classes/</em>文件夹下的application.properties。
也可以使用Spring Boot的<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html">显式配置</a>。
<a href="https://github.com/flowable/flowable-engine/blob/master/modules/flowable-ui-task/flowable-ui-task-app/src/main/resources/application.properties">Github</a>上也提供了配置示例。
要将默认配置修改为MySQL，需要如下修改配置文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="linenums"><span></span>spring.datasource.driver-class-name=com.mysql.jdbc.Driver
spring.datasource.url=jdbc:mysql://127.0.0.1:3306/flowable?characterEncoding=UTF-8
spring.datasource.username=flowable
spring.datasource.password=flowable</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个配置需要MySQL服务器中有一个flowable数据库，UI应用会自动生成必要的数据库表。对于Postgres，需要做如下修改：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="linenums"><span></span>spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.url=jdbc:postgresql://localhost:5432/flowable
spring.datasource.username=flowable
spring.datasource.password=flowable</code></pre>
</div>
</div>
<div class="paragraph">
<p>除了修改配置，还需要确保在classpath中有对应的数据库驱动。类似的，可以对每个web应用分别操作，将驱动JAR文件添加到WEB-INF/lib目录下；也可以直接将JAR文件添加到Tomcat的lib目录下。MySQL与Postgres的数据库驱动可以从这里下载：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MySQL: <a href="https://dev.mysql.com/downloads/connector/j"><a href="https://dev.mysql.com/downloads/connector/j" class="bare">https://dev.mysql.com/downloads/connector/j</a></a></p>
</li>
<li>
<p>Postgres: <a href="https://jdbc.postgresql.org/"><a href="https://jdbc.postgresql.org/" class="bare">https://jdbc.postgresql.org/</a></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以独立应用方式运行应用时，可以使用 <code>loader.path</code> 参数添加数据库驱动。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>java -Dloader.path=/location/to/your/driverfolder -jar flowable-idm.war</code></pre>
</div>
</div>
<div class="paragraph">
<p>参阅Spring Boot文档<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/executable-jar.html#executable-jar-property-launcher-features"><code>PropertiesLauncher</code> 功能</a>介绍了解更多信息。</p>
</div>
</div>
<div class="sect2">
<h3 id="_flowable_ui_applications_configurations">6.2. 配置Flowable UI应用</h3>
<div class="paragraph">
<p>作为Spring Boot应用，Flowable UI应用可以使用Spring Boot提供的全部参数。
参阅Spring Boot文档的<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html">显式配置</a>章节，了解如何进行自定义配置。</p>
</div>
<div class="paragraph">
<p>提示：也可以使用YAML格式的配置文件。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 291. 通用UI应用参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">原参数</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.idm-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">idm.app.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDM应用的URL，用于获取用户信息与令牌信息的REST GET调用。也用做UI应用重定向的登录页。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.idm-redirect-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">idm.app.redirect.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDM应用的重定向URL，在未设置cookie或cookie失效时，重定向至该页面进行登录。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.redirect-on-auth-success</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">app.redirect.url.on.authsuccess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登录成功后需要重定向的页面URL。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.role-prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ROLE_</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Security需要的默认角色前缀。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.tenant-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DefaultTenantProvider所用的静态租户id。modeler用来判断需要将模型存储及发布在哪个租户id下。
 当未设置该值、值为空，或只包含空白时：如果能够获取用户的租户id，则会使用该租户id；否则不使用租户id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.cache-login-tokens.max-age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache.login-tokens.max.age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">login token的缓存时间，以秒记。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.cache-login-tokens.max-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache.login-tokens.max.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">login token缓存的最大尺寸。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.cache-login-users.max-age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache.login-users.max.age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">login user的缓存时间，以秒记。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.cache-login-users.max-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache.login-users.max.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">login user缓存的最大尺寸。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.cache-users.max-age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache.users.max.age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">user的缓存时间，以秒记。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.cache-users.max-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache.users.max.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">user缓存的最大尺寸。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.idm-admin.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">idm.admin.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">对IDM REST服务进行REST调用（使用基础认证）的密码。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.idm-admin.user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">idm.admin.user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">对IDM REST服务进行REST调用（使用基础认证）的用户名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.rest.app.authentication-mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rest.authentication.mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">verify-privilege</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置REST API验证用户身份的方式：
 <em>any-user</em> ：用户存在且密码匹配。任何用户都可以进行调用（6.3.0之前的方式）
 <em>verify-privilege</em> :用户存在且密码匹配，并且用户拥有<em>rest-api</em>权限</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>一些旧参数改由Flowable Spring Boot starter（或Spring Boot）进行管理</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 292. 由Flowable Spring Boot Starter管理的旧参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">原参数</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.async-executor-activate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">engine.process.asyncexecutor.activate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否启用异步执行器。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.database-schema-update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">engine.process.schema.update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否执行数据库表结构升级。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.history-level</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">engine.process.history.level</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史级别。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.process.servlet.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.rest-api-servlet-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flowable BPMN Rest API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程servlet的名字。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.process.servlet.path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.rest-api-mapping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/process-api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程REST servlet的上下文路径。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.content.storage.create-root</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">contentstorage.fs.create-root</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果root目录不存在，是否需要创建它？</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.content.storage.root-folder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">contentstorage.fs.root-folder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">存储内容文件（任务附件、表单上传文件等）的root目录。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.db-identity-used</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否启动IDM引擎。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.password-encoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.passwordencoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">密码加密方式。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.base-dn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.basedn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询用户及组的基础DN（<em>标识名 distinguished name</em>）。如果用户及组使用不同的基础DN，请改用<em>user-base-dn</em>及<em>group-base-dn</em>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否启用LDAP IDM服务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接LDAP系统所用的密码。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP系统的端口号。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP系统所在的服务器地址。例如<em>ldap://localhost</em>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接LDAP系统所用的用户ID。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.attribute.email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.attribute.email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户邮件地址的LDAP属性名。用于查询并将LDAP对象映射至Flowable <em>org.flowable.idm.api.User</em>对象。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.attribute.first-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.attribute.firstname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户名字的LDAP属性名。用于查询并将LDAP对象映射至Flowable <em>org.flowable.idm.api.User</em>对象。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.attribute.group-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.attribute.groupid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户组ID的LDAP属性名。用于查询并将LDAP对象映射至Flowable <em>org.flowable.idm.api.Group</em>对象。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.attribute.group-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.attribute.groupname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户组名称的LDAP属性名。用于查询并将LDAP对象映射至Flowable <em>org.flowable.idm.api.Group</em>对象。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.attribute.last-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.attribute.lastname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户姓的LDAP属性名。用于查询并将LDAP对象映射至Flowable <em>org.flowable.idm.api.User</em>对象。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.attribute.user-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.attribute.userid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户ID的LDAP属性名。用于查询并将LDAP对象映射至Flowable <em>org.flowable.idm.api.User</em>对象。仅在使用Flowable API查询<em>org.flowable.idm.api.User</em>对象时需要设置。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.cache.group-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.cache.groupsize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设置<em>org.flowable.ldap.LDAPGroupCache</em>缓存的尺寸。
这是用户所在组的LRU缓存。避免每次需要查询用户所在组时都访问LDAP系统。
若值小于0，则不会启用缓存。默认值为-1，所以不会进行缓存。
请注意组缓存在<em>org.flowable.ldap.LDAPIdentityServiceImpl</em>中初始化。
因此，自行实现<em>org.flowable.ldap.LDAPIdentityServiceImpl</em>时，请不要忘记添加组缓存功能。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.query.all-groups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.query.groupall</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询所有组所用的语句。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.query.all-users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.query.userall</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询所有用户所用的语句。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.query.groups-for-user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.query.groupsforuser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询给定用户所在组所用的语句。
 比如：<code>(&amp;(objectClass=groupOfUniqueNames)(uniqueMember={0}))</code>
 返回LDAP中所有<em>groupOfUniqueNames</em>类、DN为<em>uniqueMember</em>的对象。
 上例中，使用{@link java.text.MessageFormat}即<em>{0}</em>注入用户ID。
 如果不能通过简单的语句进行查询，可以改用 <code>org.flowable.ldap.LDAPQueryBuilder</code> ，进行定制化查询。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.query.user-by-full-name-like</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.query.userbyname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通过全名查询用户所用的语句。
 比如：<code>(&amp;(objectClass=inetOrgPerson)(|({0}=**{1}**)({2}={3})))</code>
 返回LDAP中所有<em>inetOrgPerson</em>类、姓或名匹配的对象。
 注入到表达式中的值：{0} : 名字属性名 {1} : 查询文本 {2} : 姓属性名 {3} : 查询文本
 如果不能通过简单的语句进行查询，可以改用 <code>org.flowable.ldap.LDAPQueryBuilder</code>，进行定制化查询。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.query.user-by-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.query.userbyid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通过ID查询用户所用的语句。
 比如：<code>(&amp;(objectClass=inetOrgPerson)(uid={0}))</code>
 返回LDAP中所有<em>inetOrgPerson</em>类、<em>uid</em>属性值匹配的对象。
 上例中，使用{@link java.text.MessageFormat}即<em>{0}</em>注入用户ID。
 如果不能通过简单的语句进行查询，可以改用 <code>org.flowable.ldap.LDAPQueryBuilder</code> ，进行定制化查询。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail.server.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">email.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">localhost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件服务器地址。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail.server.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">email.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件服务器的密码。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail.server.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">email.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1025</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件服务器的端口号。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail.server.use-ssl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">email.use-ssl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否需要为SMTP协议启用SSL/TLS加密（即SMTPS/POPS）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail.server.use-tls</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">email.use-tls</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否启用STARTTLS加密。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail.server.username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">email.username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件服务器的用户名。
 为空则不进行认证。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.process.definition-cache-limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.process-definitions.cache.max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程定义缓存的最大数量。
 默认值为-1，即缓存所有流程定义。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 293. 由Spring Boot管理的旧参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">原参数</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.driver-class-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.driver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDBC驱动的全限定名。默认通过URL自动检测。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.jndi-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.jndi.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据源的JNDI。若设置JNDI，则忽略Class、url、username及password设置。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库的登录密码。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库的JDBC URL。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库的登录用户名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.connection-test-query</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.preferred-test-query</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于验证连接的SQL语句。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.connection-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.connection.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">客户端等待获取连接的最大时间，以毫秒计。如果获取连接超时，会抛出SQLException。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.idle-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.connection.idletimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接池中连接的最大空闲时间，以毫秒计。
 实际销毁连接前，会多等平均+15秒，最大+30秒的额外时间。
 不会在空闲超时前销毁连接。
 值为0代表连接池不会销毁空闲连接。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.max-lifetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.connection.maxlifetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接池中连接的最大存活时间。如果连接超过存活时间，即使该连接刚被使用过，也会被连接池销毁。不会销毁正在使用的连接，只会销毁空闲的连接。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.maximum-pool-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.connection.maxpoolsize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接池的最大容量，包括空闲及使用中的连接。这个配置决定了到数据库的实际连接数。如果连接池尺寸到达上限，且没有可用的空闲连接，则getConnection()会等待connectionTimeout设置的时间，然后超时。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.minimum-idle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.connection.minidle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HikariCP连接池保留的最小空闲连接数量。如果空闲连接数量少于设置，HikariCP会尽最大努力尽快有效地恢复。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.servlet.multipart.max-file-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">file.upload.max.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">文件的最大尺寸，可以使用“MB”或“KB”后缀。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 294. 不再使用的旧参数</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">旧参数</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.jndi.resource-ref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Boot不支持配置JNDI resourceRef，而是按名称直接引用。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">email.use-credentials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果邮件服务器不使用认证，直接将用户名及密码置空即可。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="flowableIDMApp">6.3. Flowable IDM应用</h3>
<div class="paragraph">
<p>Flowable IDM应用，用于其他三个Flowable web应用的认证与授权。因此如果你想要运行Modeler，Task或者Admin应用，就需要运行IDM应用。Flowable IDM应用是一个简单的身份管理应用，目标是为Flowable web应用提供单点登录能力，并提供定义用户、组与权限的能力。</p>
</div>
<div class="paragraph">
<p>IDM应用在启动时启动IDM引擎，并按照配置参数中定义的数据源创建IDM引擎所需的身份表。</p>
</div>
<div class="paragraph">
<p>当Flowable IDM应用部署及启动时，将检查是否在ACT_ID_USER表中有用户。如果没有，将在表中使用 <code>flowable.common.app.idm-admin.user</code> 参数创建默认管理员用户。
同时也会为新创建的管理员用户添加Flowable项目中的所有权限：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>access-idm: 提供管理用户、组与权限的权限</p>
</li>
<li>
<p>access-admin: 使用户可以登录Flowable Admin应用，管理Flowable引擎，以及访问所有应用的Actuator Endpoint。</p>
</li>
<li>
<p>access-modeler: 提供访问Flowable Modeler应用的权限</p>
</li>
<li>
<p>access-task: 提供访问Flowable Task应用的权限</p>
</li>
<li>
<p>access-rest-api: 提供调用REST API的权限。否则调用会返回403（无权限）HTTP状态码。请注意需要将<em>flowable.rest.app.authentication-mode</em>设置为<em>verify-privilege</em>，即默认设置。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>第一次使用admin/test登录<a href="http://localhost:8080/flowable-idm"><a href="http://localhost:8080/flowable-idm" class="bare">http://localhost:8080/flowable-idm</a></a>时，会显示如下用户总览界面：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_idm_startup_screen.png" alt="flowable idm startup screen">
</div>
</div>
<div class="paragraph">
<p>在这个界面中，可以添加、删除与更新用户。组页签用于创建、删除与更新组。在组详情界面中，可以向组添加与删除用户。权限界面为用户与组添加及删除权限：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_idm_privilege_screen.png" alt="flowable idm privilege screen">
</div>
</div>
<div class="paragraph">
<p>暂时还不能定义新的权限。但是可以为用户与组添加及删除已有的四个权限。</p>
</div>
<div class="paragraph">
<p>下表是IDM UI应用的专用参数。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 295. IDM UI应用参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">原参数</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.bootstrap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">idm.bootstrap.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否为IDM应用启用bootstrap。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.rest-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rest.idm-app.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">启用REST API（指的是使用基础身份认证的API，而不是UI使用的REST API）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.admin.email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin.email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin用户的邮箱。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.admin.first-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin.firstname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin用户的名字。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.admin.last-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin.lastname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin用户的姓。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.admin.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin用户的密码。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.admin.user-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin.userid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin用户的ID。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.security.remember-me-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.rememberme.key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">testKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Security对密码加密时所用的哈希值。请一定要修改这个参数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.security.user-validity-period</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache.users.recheck.period</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">对于可缓存的CustomUserDetailsService服务，缓存用户的时间。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.security.cookie.domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.cookie.domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cookie的域。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.security.cookie.max-age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.cookie.max-age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2678400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cookie的存活时间，以秒记。默认为31天。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.security.cookie.refresh-age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.cookie.refresh-age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">86400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cookie的刷新周期，以秒记。默认为1天。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>除了使用默认的身份表之外，IDM应用也可以使用LDAP服务。
在application.properties文件中（或使用其他配置方式）加入下列配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="linenums"><span></span>#
# LDAP
#
flowable.idm.ldap.enabled=true
flowable.idm.ldap.server=ldap://localhost
flowable.idm.ldap.port=10389
flowable.idm.ldap.user=uid=admin, ou=system
flowable.idm.ldap.password=secret
flowable.idm.ldap.base-dn=o=flowable
flowable.idm.ldap.query.user-by-id=(&amp;(objectClass=inetOrgPerson)(uid={0}))
flowable.idm.ldap.query.user-by-full-name-like=(&amp;(objectClass=inetOrgPerson)(|({0}=*{1}*)({2}=*{3}*)))
flowable.idm.ldap.query.all-users=(objectClass=inetOrgPerson)
flowable.idm.ldap.query.groups-for-user=(&amp;(objectClass=groupOfUniqueNames)(uniqueMember={0}))
flowable.idm.ldap.query.all-groups=(objectClass=groupOfUniqueNames)
flowable.idm.ldap.attribute.user-id=uid
flowable.idm.ldap.attribute.first-name=cn
flowable.idm.ldap.attribute.last-name=sn
flowable.idm.ldap.attribute.group-id=cn
flowable.idm.ldap.attribute.group-name=cn
flowable.idm.ldap.cache.group-size=10000
flowable.idm.ldap.cache.group-expiration=180000</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>flowable.idm.ldap.enabled</code> 参数设置为true时，需要同时填入其他的LDAP参数。
在这个示例配置中使用Apache Directory的服务器配置 + LDAP查询。
其他LDAP服务器如Active Directory使用不同的配置值。</p>
</div>
<div class="paragraph">
<p>配置LDAP后将通过LDAP服务器进行认证及从组中获取用户，但仍然从Flowable身份表中获取权限。因此需要确保每一个LDAP用户都在IDM应用中定义了正确的权限。</p>
</div>
<div class="paragraph">
<p>如果IDM应用配置为使用LDAP，则启动时将检查Flowable身份表中是否存在权限。
（第一次启动时）如果没有权限，则会创建4个默认权限，并为ID为（application.properties或其他配置环境中的） <code>flowable.common.app.idm-admin.user</code> 参数的用户赋予这4个权限。
因此请确保 <code>flowable.common.app.idm-admin.user</code> 参数设置为有效的LDAP用户，否则将没有人能够登录任何Flowable UI应用。</p>
</div>
</div>
<div class="sect2">
<h3 id="flowableModelerApp">6.4. Flowable Modeler应用</h3>
<div class="paragraph">
<p>Flowable Modeler用于建模BPMN流程、DMN选择表、表单定义，以及创建应用定义。BPMN Modeler使用与Flowable 5相同的Oryx与Angular架构，只是迁移为独立的Modeler应用中。在使用Flowable Modeler应用时，请确保Flowable IDM应用已经部署并正常运行（用于认证与授权）。</p>
</div>
<div class="paragraph">
<p>使用自己的账户（或者默认的admin/test用户）登录Modeler应用后(<a href="http://localhost:8080/flowable-modeler"><a href="http://localhost:8080/flowable-modeler" class="bare">http://localhost:8080/flowable-modeler</a></a>)，可以看到流程总览页面。可以点击Create Process(创建流程)按钮或Import Process(导入流程)按钮，创建新的BPMN流程模型。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_createmodel_popup.png" alt="flowable modeler createmodel popup" width="600">
</div>
</div>
<div class="paragraph">
<p>在创建流程模型（以及其他模型）时，需要谨慎选择模型key。模型key是模型仓库中该模型的唯一标识。如果使用了已经存在的模型key，则会显示错误，模型也不会保存。</p>
</div>
<div class="paragraph">
<p>在弹出窗口中创建模型后，会显示BPMN模型画布。这个BPMN编辑器与Flowable 5中（作为Explorer的组件）的BPMN编辑器十分相像。在设计流程模型时，可以使用Flowable引擎支持的所有BPMN元素。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_design_screen.png" alt="flowable modeler design screen">
</div>
</div>
<div class="paragraph">
<p>BPMN编辑器分为4个部分：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>画板(Palette): 用于设计流程模型的所有BPMN元素</p>
</li>
<li>
<p>工具条(Toolbar): 修改模型画布的操作。如缩放、布局、保存等</p>
</li>
<li>
<p>模型画布(Model canvas): 在模型画布上拖放BPMN元素，设计流程模型</p>
</li>
<li>
<p>参数面板(Properties panel): 如果没有选择元素，则显示主流程模型的参数；否则显示所选中BPMN元素的参数</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>用户任务元素的参数面板中有一个<em>Referenced form(引用表单)</em>参数。选择这个参数会弹出窗口，使你可以在仓库中选择一个表单定义，或者创建一个新的表单。如果选择创建一个新的表单，会显示一个类似于流程模型创建对话框的弹窗。填入表单名及表单模型key之后，就会打开表单编辑器。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_formdesign_screen.png" alt="flowable modeler formdesign screen">
</div>
</div>
<div class="paragraph">
<p>可以从表单画板中将表单字段拖入表单画布。在这个例子中，在表单画布上添加了一个Name（姓名）文本框，两个日期框，以及一个Remarks（说明）多行文本框。在编辑表单字段时，可以配置Label(标签)、Id、Required(是否必填)，以及Placeholder(占位符)。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_editfield_popup.png" alt="flowable modeler editfield popup" width="600">
</div>
</div>
<div class="paragraph">
<p>id是一个重要的参数。流程使用这个id为表单字段创建流程变量。填写label参数时，会自动为id参数赋值。如果需要的话，也可以选中Override Id?(覆盖Id)复选框，并填入所需的id。</p>
</div>
<div class="paragraph">
<p>保存表单模型并关闭表单编辑器之后，（如果表单编辑器是从BPMN编辑器打开的话）会自动跳转回流程模型。再次选择用户任务元素，并点击<em>Referenced form</em>参数，就可以看到已经将新创建的表单定义附加至用户任务。点击Modeler应用头部的<em>Form(表单)</em>页签，也可以看到模型仓库中保存的所有表单定义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_formoverview_screen.png" alt="flowable modeler formoverview screen">
</div>
</div>
<div class="paragraph">
<p>可以打开表单定义的详情界面，查看各表单定义。在详情页面中，可以修改表单名、key及描述，也可以查阅表单模型的修改历史。也可以复制表单定义，创建一个具有相同表单字段的新的表单定义。</p>
</div>
<div class="paragraph">
<p>接下来，再次打开BPMN编辑器中的vacation request（请假）流程模型，向流程模型中添加一个脚本任务，用于计算假期开始到结束之间的日数。点击<em>Script form(脚本表单)</em>参数，填入<em>groovy</em>，这样Flowable引擎就会使用Groovy脚本引擎。然后点击<em>Script(脚本)</em>参数，并填入用于计算日数的脚本。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_script_popup.png" alt="flowable modeler script popup" width="600">
</div>
</div>
<div class="paragraph">
<p>这样就定义了<em>amountOfVacationDays</em>流程变量，接下来可以在流程模型中添加一个选择任务（Decision task）。选择任务用于在Flowable DMN引擎中执行DMN选择表。使用<em>Decision table reference(引用选择表)</em>参数，创建一个新的选择表模型，并打开DMN编辑器。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_dmneditor_screen.png" alt="flowable modeler dmneditor screen">
</div>
</div>
<div class="paragraph">
<p>DMN编辑器提供了一个列表式的编辑器。包括输入列——使用流程中的流程变量定义输入条件；以及输出列——定义输出变量。在这个简单的例子里，只使用一个输入列，并使用<em>amountOfVacationDays</em>变量。如果天数少于10，<em>managerApprovalNeeded</em>变量返回值false。否则返回true。可以定义多个输入列，每条规则也可以有多个输入条件。也可以将一个输入列置空，代表其永远为true。也可以定义一个或多个输出变量。</p>
</div>
<div class="paragraph">
<p>DMN选择表定义的另一个重要部分是命中策略(Hit Policy)。目前，Flowable支持第一(First)与任意(Any)命中策略。对于第一命中策略，DMN会返回第一条计算为true的规则定义的输出变量，并停止计算。对于任意命中策略，会计算所有的规则，并输出计算为true的最后一条规则定义的输出变量。</p>
</div>
<div class="paragraph">
<p>保存并关闭DMN编辑器后，Modeler应用跳转回BPMN编辑器，并将新创建的DMN选择表附加至选择任务。在BPMN XML中生成如下的选择任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;decisionTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Is manager approval needed?&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;dmn&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;extensionElements&gt;</span>
        <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;decisionTableReferenceKey&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;flowable:string&gt;</span><span class="tok-cp">&lt;![CDATA[managerApprovalNeeded]]&gt;</span><span class="tok-nt">&lt;/flowable:string&gt;</span>
        <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样就可以创建带有一个条件顺序流的排他网关，以使用DMN引擎的计算结果，即<em>managerApprovalNeeded</em>变量。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_sequenceflowcondition_popup.png" alt="flowable modeler sequenceflowcondition popup" width="500">
</div>
</div>
<div class="paragraph">
<p>完整的BPMN流程模型为：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_vacationrequest_screen.png" alt="flowable modeler vacationrequest screen">
</div>
</div>
<div class="paragraph">
<p>完成流程模型之后，就可以创建应用定义(app definition)，将一个或多个流程模型及关联的模型（如选择表和表单定义）打包为一个整体。应用定义可以导出为BAR文件(zip格式)，并可以在Flowable引擎中部署。创建完成请假应用定义后，应用编辑器将如下显示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_appeditor_screen.png" alt="flowable modeler appeditor screen">
</div>
</div>
<div class="paragraph">
<p>还可以在应用编辑器中选择图标和主题色，调整Flowable Task应用在看板(dashboard)中的显示效果。重点步骤是添加请假流程模型，并通过选择流程模型，自动引入对应的表单定义和DMN选择表。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_modelselection_popup.png" alt="flowable modeler modelselection popup">
</div>
</div>
<div class="paragraph">
<p>点击预览图选中流程模型。选择一个或多个模型之后，就可以关闭弹窗，保存并关闭应用定义。在详情页面查看新创建的请假应用定义，如下所示：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_appdetails_screen.png" alt="flowable modeler appdetails screen">
</div>
</div>
<div class="paragraph">
<p>在这个页面中，可以通过两种不同格式下载应用定义。第一个下载按钮（带有下箭头）下载每个模型的JSON格式模型文件，用于在不同的Flowable Modeler应用之间共享应用定义。第二个下载按钮（带有指向右上的箭头）下载应用定义模型的BAR文件，用于在Flowable引擎中部署。在BAR文件中，只包含了可以部署的工件，如BPMN 2.0 XML文件和DMN XML文件，而不会包含JSON模型文件。这是因为在Flowable引擎部署时，BAR文件中的所有文件都会保存在数据库中。因此需要避免将不需要部署的文件放在BAR中。</p>
</div>
<div class="paragraph">
<p>在应用定义详情页面，也可以直接向Flowable引擎<em>发布(Publish)</em>应用定义。Flowable Modeler使用application.properties文件中，<em>flowable.modeler.app.deployment-api-url</em>参数设置的URL部署应用定义。默认部署URL配置为Flowable Task应用。但也可以修改，比如改为使用Flowable REST应用。确保Flowable Task应用正在运行，点击<em>Publish</em>按钮。这样应用定义就会做为一个BAR文件部署到Flowable Task应用。</p>
</div>
<div class="paragraph">
<p>下表是Modeler UI应用的专用参数。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 296. Modeler UI应用参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">原参数</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.modeler.app.data-source-prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库表名的前缀。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.modeler.app.deployment-api-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment.api.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8080/flowable-task/process-api" class="bare">http://localhost:8080/flowable-task/process-api</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flowable引擎REST服务的根URL，Flowable Modeler用来向引擎部署应用定义BAR文件。
 Flowable Task应用的默认URL为
 <a href="http://localhost:8080/flowable-task/process-api" class="bare">http://localhost:8080/flowable-task/process-api</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.modeler.app.rest-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rest.modeler-app.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">启用REST API（指的是使用基础身份认证的API，而不是UI使用的REST API）。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="flowableTaskApp">6.5. Flowable Task应用</h3>
<div class="paragraph">
<p>Flowable Task应用是Flowable项目的运行时应用，默认包括Flowable BPMN、DMN、Form以及Content引擎。可以使用Flowable Task应用，启动新流程实例、完成任务、渲染任务表单等。在之前的章节中，已经通过Flowable Task应用REST API在Flowable引擎中部署了请假应用定义。在Flowable数据库中可以看到BPMN引擎的ACT_RE_DEPLOYMENT表中已经创建了新的部署实体。DMN引擎的ACT_DMN_DEPLOYMENT，和Form引擎的ACT_FO_FORM_DEPLOYMENT表中也创建了新的实体。</p>
</div>
<div class="paragraph">
<p>在<a href="http://localhost:8080/flowable-task"><a href="http://localhost:8080/flowable-task" class="bare">http://localhost:8080/flowable-task</a></a>的看板中，可以看到请假应用及默认的Task应用，和其他已经在Flowable引擎中部署的应用。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_task_dashboard_screen.png" alt="flowable task dashboard screen">
</div>
</div>
<div class="paragraph">
<p>点击请假应用，会显示当前登录用户的任务列表（现在很可能是空的）。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_task_tasklist_screen.png" alt="flowable task tasklist screen">
</div>
</div>
<div class="paragraph">
<p>点击打开<em>Processes(流程)</em>页签后，可以点击<em>Start a process(启动流程)</em>按钮，启动一个新的流程实例。会列表显示当前应用定义上下文中所有可用的流程定义。选择请假流程定义后，可以点击<em>Start process</em>按钮，启动一个新的请假流程实例。</p>
</div>
<div class="paragraph">
<p>Flowable Task应用将自动跳转至流程实例详情页面。可以看到已经激活了<em>Provide vacation information(提供请假信息)</em>任务。可以添加备注，或者使用<em>Show diagram(显示流程图)</em>按钮，图形化显示流程实例状态。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_task_processdetails_screen.png" alt="flowable task processdetails screen">
</div>
</div>
<div class="paragraph">
<p>转至任务列表，也可以看到这里也列出了<em>Provide vacation information</em>任务。这个界面会显示任务详情及渲染的请假信息表单。也可以点击<em>Show details(显示详情)</em>按钮，转至详情页面。在详情页面中，可以添加备注，引入用户，为任务添加附件，或者修改任务的到期时间和办理人。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_task_taskdetails_screen.png" alt="flowable task taskdetails screen">
</div>
</div>
<div class="paragraph">
<p>开始填写表单并完成任务。首先，选择间隔超过10天的开始日期和结束日期。这样就可以生成<em>Manager approval(经理审批)</em>任务。请假信息表单填写完毕后，点击<em>Complete(完成)</em>按钮，Flowable Task应用就会跳转至<em>Manager approval</em>任务界面。直接完成这个任务（不需要填写任务表单），流程实例就结束了。</p>
</div>
<div class="paragraph">
<p>返回<em>Processes</em>页签，点击<em>Showing running processes(显示运行中的流程)</em>选项，可以选择<em>show completed process instances（显示已完成的流程实例）</em>。这样就会显示已完成的流程实例列表。点击刚才完成的请假流程，可以看到两个完成的任务。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_task_processhistory_screen.png" alt="flowable task processhistory screen">
</div>
</div>
<div class="paragraph">
<p>每个任务的完成表单（complete form）都存储在Flowable Form引擎的ACT_FO_FORM_INSTANCE表中。因此，在查看完成的任务时，就可以看到每一个完成表单的数据。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_task_completedform_screen.png" alt="flowable task completedform screen">
</div>
</div>
<div class="paragraph">
<p>请确保选择回<em>showing running processes</em>，否则就不能看到新启动的流程实例。也可以在任务列表界面进行过滤，选择查找任务名、任务状态，特定流程定义的任务，以及指定的办理人。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_task_taskfilter_screen.png" alt="flowable task taskfilter screen" width="400">
</div>
</div>
<div class="paragraph">
<p>默认情况下，办理人过滤设置为<em>Tasks where I am involved(我参与的任务)</em>。这样不会显示用户作为候选人而没有指定为办理人的任务。要显示候选任务，可以选择<em>Tasks where I am one of the candidates(我参与候选的任务)</em>。</p>
</div>
<div class="paragraph">
<p>下表是Task UI应用的专用参数。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 297. Task UI应用参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">原参数</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.experimental.debugger.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">debugger.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否启用流程调试器。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.task.app.rest-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rest.task-app.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">启用REST API（指的是使用基础身份认证的API，而不是UI使用的REST API）。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="flowableAdminApp">6.6. Flowable Admin应用</h3>
<div class="paragraph">
<p>Flowable Admin应用是Flowable项目提供的第四个UI应用。用于查询BPMN、DMN及Form引擎中的部署，也可以显示流程实例的当前状态，包括当前的任务和流程变量。也提供了将任务指派给不同的办理人，以及完成任务的操作。Flowable Admin应用使用REST API与Flowable引擎通信。默认情况下，配置为连接至Flowable Task REST API，但是也可以很容易的修改为连接至Flowable REST应用的REST API。访问<a href="http://localhost:8080/flowable-admin"><a href="http://localhost:8080/flowable-admin" class="bare">http://localhost:8080/flowable-admin</a></a>时会显示配置界面（也可以直接点击Flowable logo右上方的箭头）。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/flowable_admin_configuration_screen.png" alt="flowable admin configuration screen"></span></p>
</div>
<div class="paragraph">
<p>每一个引擎都可以配置REST端点的基本认证。每个引擎需要单独配置，因为有可能会分开部署引擎，比如将DMN引擎与BPMN引擎部署在不同的服务器上。</p>
</div>
<div class="paragraph">
<p>如果配置正确，就可以选择<em>Process Engine(流程引擎)</em>来管理Flowable BPMN引擎。默认情况下，会显示Flowable BPMN引擎的部署情况。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_admin_deployments_screen.png" alt="flowable admin deployments screen">
</div>
</div>
<div class="paragraph">
<p>可以使用名字及租户id过滤查找部署。也可以为Flowable引擎部署新的BPMN XML或BAR文件。点击其中一个部署，会显示部署详情界面。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_admin_deploymentdetails_screen.png" alt="flowable admin deploymentdetails screen">
</div>
</div>
<div class="paragraph">
<p>这里会显示部署的详细信息，以及部署中包含的流程定义。也可以删除部署。如果希望删除已部署的应用定义，也可以在Flowable Task应用看板中删除应用定义。点击其中一个流程定义，会显示流程定义详情页面。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_admin_processdefinitiondetails_screen.png" alt="flowable admin processdefinitiondetails screen">
</div>
</div>
<div class="paragraph">
<p>在流程定义详情页面中，首先显示的是流程实例，以及流程定义中使用的选择表定义和表单定义。请假流程定义有一个关联的选择表，以及一个关联的表单定义。点击选择表定义，就会从Flowable Admin应用跳转至DMN引擎。可以点击<em>Parent Deployment ID(父部署ID)</em>链接，返回流程引擎。</p>
</div>
<div class="paragraph">
<p>除了部署与定义之外，还可以查询流程引擎中的流程实例、任务、作业，以及事件订阅情况。界面与前面介绍的类似。</p>
</div>
<div class="paragraph">
<p>下表是Admin UI应用的专用参数。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 298. Admin UI应用参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">原参数</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.admin.app.data-source-prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.prefix</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库表名的前缀。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.admin.app.security.encryption.credentials-i-v-spec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.encryption.credentials-i-v-spec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">创建IvParameterSpec对象所用的bytes。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.admin.app.security.encryption.credentials-secret-spec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.encryption.credentials-secret-spec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">创建SecretKeySpec对象所用的bytes。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>除了这些参数之外，Flowable Admin应用还有一些其他参数。可以在<a href="{sc-flowable-ui-admin}/flowable-ui-admin-app/src/main/resources/application.properties">Github</a>查看配置文件的完整内容。这些参数主要用于为不同的引擎定义REST端点的初始值。
Admin应用使用这些配置连接Flowable引擎。可以使用Admin应用的配置界面修改这些值。这些值保存在<em>ACT_ADM_SERVER_CONFIG</em>表中。
下面是一个BPMN引擎REST的配置示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="linenums"><span></span>flowable.admin.app.server-config.process.app.name=Flowable Process app
flowable.admin.app.server-config.process.description=Flowable Process REST config
flowable.admin.app.server-config.process.server-address=http://localhost
flowable.admin.app.server-config.process.app.port=8080
flowable.admin.app.server-config.process.context-root=flowable-task
flowable.admin.app.server-config.process.rest-root=process-api
flowable.admin.app.server-config.process.app.user=admin
flowable.admin.app.server-config.process.app.password=test</code></pre>
</div>
</div>
<div class="paragraph">
<p>在Flowable Task应用（及全部Flowable引擎）由Flowable Admin应用管理时，可以使用这些参数。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 299. 由Spring Boot管理的Admin UI应用参数</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">原参数</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">message.reloading.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">改为使用Spring Boot MessageSourceAutoConfiguration的 <code>spring.messages.cache-duration</code> 设置。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_internationalization">6.7. 国际化</h3>
<div class="paragraph">
<p>Flowable UI应用支持国际化(internationalization, i18n)。项目组维护英语版本。但也可以使用自己的翻译文件支持其他语言。</p>
</div>
<div class="paragraph">
<p><a href="$$https://github.com/angular-translate/angular-translate">Angular Translate</a>库会试着基于浏览器的语言代码，从（每一个UI应用的）<em>i18n</em>目录下载入对应的语言文件。如果无法加载匹配的语言文件，框架会退回使用英语版本。</p>
</div>
<div class="paragraph">
<p>也可以（在Angular应用配置中），将多个浏览器语言代码关联至某个翻译文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="linenums"><span></span>// 初始化angular-translate
$translateProvider.useStaticFilesLoader({
    prefix: &#39;./i18n/&#39;,
    suffix: &#39;.json&#39;
})
/*
    将多个浏览器语言代码映射至同一个翻译。
*/
// .registerAvailableLanguageKeys([&#39;en&#39;], {
//     &#39;en-*&#39;: &#39;en&#39;
// })
.useCookieStorage()
.useSanitizeValueStrategy(&#39;sanitizeParameters&#39;)
.uniformLanguageTag(&#39;bcp47&#39;)
.determinePreferredLanguage();</code></pre>
</div>
</div>
<div class="paragraph">
<p>例如，如果浏览器配置为使用英语（美国）——English (United States)，即语言代码为<em>en-US</em>。如果不做映射配置，Angular Translate会尝试获取对应的语言文件<em>en-US.json</em>。（如果无法加载，会退回为<em>en</em>，并加载<em>en.json</em>语言文件）</p>
</div>
<div class="paragraph">
<p>取消注释<em>.registerAvailableLanguageKeys</em>块，就可以将<em>en-US</em>（以及所有其他的<em>en</em>语言代码）映射至<em>en.json</em>语言文件。</p>
</div>
</div>
<div class="sect2">
<h3 id="_production_ready_endpoints">6.8. 生产可用的端点</h3>
<div class="paragraph">
<p>所有应用都可以使用Spring Boot提供的<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-endpoints.html">生产可用的端点</a>。参阅<a href="https://docs.spring.io/spring-boot/docs/current/actuator-api/html/">Actuator Web API Documentation</a>了解所有可用的端点。</p>
</div>
<div class="paragraph">
<p>默认使用下列配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="linenums"><span></span># 暴露所有Actuator Endpoint
# 尽管会暴露所有的端点，但非认证用户无法访问，认证用户可以访问/info及/health，只有具有access-admin权限的用户可以访问其他端点
management.endpoints.web.exposure.include=*
# 只有认证用户可以访问完整的健康度信息
management.endpoint.health.show-details=when_authorized
# 只有access-admin角色可以访问完整的健康度信息
management.endpoint.health.roles=access-admin</code></pre>
</div>
</div>
<div class="paragraph">
<p>安全策略配置为：只有认证用户可以访问 <code>info</code> 及 <code>health</code> 端点。
只有 <code>access-admin</code> 角色可以查看 <code>health</code> 端点的完整信息。
只有 <code>access-admin</code> 角色可以查看其他的任何端点。</p>
</div>
</div>
</div>
</div>
</div>
</body>
</html>