<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<title>Flowable BPMN 用户手册 (v 6.4.2-SNAPSHOT)</title>
<style>

/* normalize.css */

button,hr,input{overflow:visible}audio,canvas,progress,video{display:inline-block}progress,sub,sup{vertical-align:baseline}html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0} menu,article,aside,details,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{}button,select{text-transform:none}[type=submit], [type=reset],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}[hidden],template{display:none}/*# sourceMappingURL=normalize.min.css.map */

/* tocbot 2.1.4 */

.toc{overflow-y:auto}.toc>ul{overflow:hidden;position:relative}.toc-list{margin:0;padding-left:10px}a.toc-link{color:currentColor;height:100%}.is-collapsible{max-height:1000px;overflow:hidden;transition:all 300ms ease-in-out}.is-collapsed{max-height:0}.is-position-fixed{position:fixed !important;top:0}.is-active-link{font-weight:700}.toc-link::before{background-color:#f9f9fb;content:' ';display:inline-block;height:inherit;left:8px;margin-top:-1px;position:absolute;width:2px}.is-active-link::before{background-color:#54BC4B}


/* Activiti Specific */

body {
  color: #494d55;
  font-size: 16px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

html, body {
  height: 100%;
  width: 100%;
  background: #f9f9f9;
  font-family: "Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;
  color: #484848
}

.page-wrapper {
  min-height: 100%;
  /* equal to footer height */
  margin-bottom: -50px;
}

.page-wrapper:after {
  content: "";
  display: block;
  height: 50px;
}

#header {
  position:fixed;
  top:0px;
  z-index:100000;
  width:100%;
}

#header > h1 {
    background: #a0cc47;
    color: #f9f9f9;
    border-bottom: 2px solid #042944;
    padding: 20px 0 20px 20px;
    font-size: 40px;
    font-weight: 800;
    line-height: 1.1;
    margin: 0;
}

#header > h1:before {
  background:url('images/logo.png');
  background-size: 337px 54px; background-repeat: no-repeat;
  width: 337px;
  height: 54px;
  display:inline-block;
  content:'';
  margin-right: 30px;
}

#author {
  margin-left: 25%;
  font-size: 40px;
}

#content {
  margin: 129px 0 0 27%;
  padding: 10px 40px 0 20px;
  padding-right: 40px;
  line-height: 1.7;
  width: 65%;
  overflow-x: auto;
}

h2, h3, h4, h5, h6 {
  color: #00345a;
}

h2 {
  font-size: 26px;
  margin-top: 0;
  margin-bottom: 20px;
  font-weight: bold;
  padding-bottom: 10px;
  border-bottom: 1px solid #d7d7d7;
}

h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 0;
  font-weight: bold;
  padding-bottom: 10px;
  /*border-bottom: 1px solid #d7d7d7;*/
}

h4 {
    font-size: 16px;
    font-weight: bold;
}

h5 {
    font-size: 14px;
    font-weight: bold;
}

h6, h7 {
    font-size: 14px;
    font-weight: bold;
    margin-top: 0;
    margin-bottom: 0;
}

.sect1, .sect2 {
  margin-bottom: 20px;
}

.clear
{
  clear: both;
}

.note, .listingblock, .literalblock{
  padding-left: 8px;
  padding-right: 8px;
  margin-bottom: 14px;
  background-color: #f7f7f9;
  border: 1px solid #e1e1e8;
  border-radius: 4px;
  color: #808080;
}

table.tableblock {
  width: 100%;
  max-width: 100%;
  margin-bottom: 20px;
  background-color: transparent;
  border-spacing: 0;
  border-collapse: collapse;
  border: 1px solid #ddd;
  table-layout: fixed;
}

table.tableblock>caption+thead>tr:first-child>td, table.tableblock>caption+thead>tr:first-child>th, table.tableblock>colgroup+thead>tr:first-child>td, table.tableblock>colgroup+thead>tr:first-child>th, table.tableblock>thead:first-child>tr:first-child>td, table.tableblock>thead:first-child>tr:first-child>th {
    border-top: 0;
}

table.tableblock > thead > tr > th {
    border-bottom-color: #8bd6d8;
}

table.tableblock>thead>tr>th {
    vertical-align: bottom;
    border-bottom: 1px solid #ddd;
}

table.tableblock>tbody>tr>td, table.tableblock>tbody>tr>th, table.tableblock>tfoot>tr>td, table.tableblock>tfoot>tr>th, table.tableblock>thead>tr>td, table.tableblock>thead>tr>th {
    padding: 8px;
    line-height: 1.42857143;
    vertical-align: top;
    border-top: 1px solid #ddd;
}

th {
    text-align: left;
}

table.tableblock > tbody > tr:nth-of-type(odd) {
    background-color: #f5f5f5;
}

table.tableblock > tbody > tr:nth-of-type(odd) {
    background-color: #f9f9f9;
}

td > p {
  margin:0;
}

td.content {
  white-space: normal;
}

pre, td, th {
   white-space: pre-wrap;
   white-space: -moz-pre-wrap;
   white-space: -pre-wrap;
   white-space: -o-pre-wrap;
   word-wrap: break-word;
}

img {
  max-width: 100%;
}

a {
  color: #007387;
}

a:hover {
  color: #004c59;
}

#toc-parent {
  width: 25%;
  float: left;
  height: 100%;
  overflow-y: auto;
  position: fixed;
  padding: 10px;
  border-right: 1px solid #ccc;
}

#generated-toc {
    width: 100%;
    height: 100%;
    font-size: 16px;
}

.toc-link {
  text-decoration: none;
}

.toc-list {
  margin: 0 20px 0 10px;
}

.toc-list-item {
  padding: 4px 0 4px 0;
}


div.sect5  p {
    margin-top: 0;
    margin-bottom: 0;
}

div.sect5  code {
    font-family: "Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments, .listingblock .pygments code { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
<script type="text/javascript">

/*
 * Tocbot.min.js version 2.1.4
 */

 !function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([/*!*************************!*\
   !*** ./src/js/index.js ***!
   \*************************/
 function(e,t,n){var o,i,r;(function(l){!function(n,l){i=[],o=l(n),r="function"==typeof o?o.apply(t,i):o,!(void 0!==r&&(e.exports=r))}("undefined"!=typeof l?l:this.window||this.global,function(e){"use strict";function t(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var o in n)h.call(n,o)&&(e[o]=n[o])}return e}function o(e,t,n){t||(t=250);var o,i;return function(){var r=n||this,l=+new Date,s=arguments;o&&l<o+t?(clearTimeout(i),i=setTimeout(function(){o=l,e.apply(r,s)},t)):(o=l,e.apply(r,s))}}var i,r,l,s=n(/*! smooth-scroll */1),c=n(/*! ./default-options.js */2),a={},u={},d=n(/*! ./build-html.js */3),f=n(/*! ./parse-content.js */4),m=(e.document,document.body,!!e.document.querySelector&&!!e.addEventListener),h=Object.prototype.hasOwnProperty;return u.destroy=function(){try{document.querySelector(a.tocSelector).innerHTML=""}catch(e){console.warn("Element not found: "+a.tocSelector)}document.removeEventListener("scroll",this._scrollListener,!1),document.removeEventListener("resize",this._scrollListener,!1),i&&document.removeEventListener("click",this._clickListener,!1),s&&s.destroy()},u.init=function(e){if(m&&(a=t(c,e||{}),this.options=a,this.state={},i=d(a),r=f(a),this._buildHtml=i,this._parseContent=r,u.destroy(),l=r.selectHeadings(a.contentSelector,a.headingSelector),null!==l)){var n=r.nestHeadingsArray(l),h=n.nest;return i.render(a.tocSelector,h),this._scrollListener=o(function(){i.updateToc(l)},a.throttleTimeout),this._scrollListener(),document.addEventListener("scroll",this._scrollListener,!1),document.addEventListener("resize",this._scrollListener,!1),this._clickListener=o(function(e){i.disableTocAnimation(e),i.updateToc(l)},a.throttleTimeout),document.addEventListener("click",this._clickListener,!1),s&&(this.smoothScroll=s.init(t(a.smoothScrollOptions,{callback:i.enableTocAnimation}))),this}},u.refresh=function(e){u.destroy(),u.init(e||this.options)},e.tocbot=u,u})}).call(t,function(){return this}())},/*!******************************************************!*\
   !*** ./~/smooth-scroll/dist/js/smooth-scroll.min.js ***!
   \******************************************************/
 function(e,t,n){var o,i,r;(function(n){/*! smooth-scroll v10.0.1 | (c) 2016 Chris Ferdinandi | MIT License | http://github.com/cferdinandi/smooth-scroll */
 !function(n,l){i=[],o=l(n),r="function"==typeof o?o.apply(t,i):o,!(void 0!==r&&(e.exports=r))}("undefined"!=typeof n?n:this.window||this.global,function(e){"use strict";var t,n,o,i,r,l,s,c={},a="querySelector"in document&&"addEventListener"in e,u={selector:"[data-scroll]",selectorHeader:null,speed:500,easing:"easeInOutCubic",offset:0,callback:function(){}},d=function(){var e={},t=!1,n=0,o=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(t=arguments[0],n++);for(var i=function(n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t&&"[object Object]"===Object.prototype.toString.call(n[o])?e[o]=d(!0,e[o],n[o]):e[o]=n[o])};o>n;n++){var r=arguments[n];i(r)}return e},f=function(e){return Math.max(e.scrollHeight,e.offsetHeight,e.clientHeight)},m=function(e,t){var n,o,i=t.charAt(0),r="classList"in document.documentElement;for("["===i&&(t=t.substr(1,t.length-2),n=t.split("="),n.length>1&&(o=!0,n[1]=n[1].replace(/"/g,"").replace(/'/g,"")));e&&e!==document&&1===e.nodeType;e=e.parentNode){if("."===i)if(r){if(e.classList.contains(t.substr(1)))return e}else if(new RegExp("(^|\\s)"+t.substr(1)+"(\\s|$)").test(e.className))return e;if("#"===i&&e.id===t.substr(1))return e;if("["===i&&e.hasAttribute(n[0])){if(!o)return e;if(e.getAttribute(n[0])===n[1])return e}if(e.tagName.toLowerCase()===t)return e}return null},h=function(e){"#"===e.charAt(0)&&(e=e.substr(1));for(var t,n=String(e),o=n.length,i=-1,r="",l=n.charCodeAt(0);++i<o;){if(t=n.charCodeAt(i),0===t)throw new InvalidCharacterError("Invalid character: the input contains U+0000.");r+=t>=1&&31>=t||127==t||0===i&&t>=48&&57>=t||1===i&&t>=48&&57>=t&&45===l?"\\"+t.toString(16)+" ":t>=128||45===t||95===t||t>=48&&57>=t||t>=65&&90>=t||t>=97&&122>=t?n.charAt(i):"\\"+n.charAt(i)}return"#"+r},p=function(e,t){var n;return"easeInQuad"===e&&(n=t*t),"easeOutQuad"===e&&(n=t*(2-t)),"easeInOutQuad"===e&&(n=.5>t?2*t*t:-1+(4-2*t)*t),"easeInCubic"===e&&(n=t*t*t),"easeOutCubic"===e&&(n=--t*t*t+1),"easeInOutCubic"===e&&(n=.5>t?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1),"easeInQuart"===e&&(n=t*t*t*t),"easeOutQuart"===e&&(n=1- --t*t*t*t),"easeInOutQuart"===e&&(n=.5>t?8*t*t*t*t:1-8*--t*t*t*t),"easeInQuint"===e&&(n=t*t*t*t*t),"easeOutQuint"===e&&(n=1+--t*t*t*t*t),"easeInOutQuint"===e&&(n=.5>t?16*t*t*t*t*t:1+16*--t*t*t*t*t),n||t},v=function(e,t,n){var o=0;if(e.offsetParent)do o+=e.offsetTop,e=e.offsetParent;while(e);return o=Math.max(o-t-n,0),Math.min(o,b()-g())},g=function(){return Math.max(document.documentElement.clientHeight,e.innerHeight||0)},b=function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)},C=function(e){return e&&"object"==typeof JSON&&"function"==typeof JSON.parse?JSON.parse(e):{}},S=function(e){return e?f(e)+e.offsetTop:0},y=function(t,n,o){o||(t.focus(),document.activeElement.id!==t.id&&(t.setAttribute("tabindex","-1"),t.focus(),t.style.outline="none"),e.scrollTo(0,n))};c.animateScroll=function(n,o,l){var c=C(o?o.getAttribute("data-options"):null),a=d(t||u,l||{},c),f="[object Number]"===Object.prototype.toString.call(n),m=f||!n.tagName?null:n;if(f||m){var h=e.pageYOffset;a.selectorHeader&&!i&&(i=document.querySelector(a.selectorHeader)),r||(r=S(i));var g,x,N=f?n:v(m,r,parseInt(a.offset,10)),L=N-h,O=b(),E=0,A=function(t,i,r){var l=e.pageYOffset;(t==i||l==i||e.innerHeight+l>=O)&&(clearInterval(r),y(n,i,f),a.callback(n,o))},H=function(){E+=16,g=E/parseInt(a.speed,10),g=g>1?1:g,x=h+L*p(a.easing,g),e.scrollTo(0,Math.floor(x)),A(x,N,s)},T=function(){clearInterval(s),s=setInterval(H,16)};0===e.pageYOffset&&e.scrollTo(0,0),T()}};var x=function(t){e.location.hash,n&&(n.id=n.getAttribute("data-scroll-id"),c.animateScroll(n,o),n=null,o=null)},N=function(i){if(0===i.button&&!i.metaKey&&!i.ctrlKey&&(o=m(i.target,t.selector),o&&"a"===o.tagName.toLowerCase()&&o.hostname===e.location.hostname&&o.pathname===e.location.pathname&&/#/.test(o.href))){var r=h(o.hash);if("#"===r){i.preventDefault(),n=document.body;var l=n.id?n.id:"smooth-scroll-top";return n.setAttribute("data-scroll-id",l),n.id="",void(e.location.hash.substring(1)===l?x():e.location.hash=l)}n=document.querySelector(r),n&&(n.setAttribute("data-scroll-id",n.id),n.id="",o.hash===e.location.hash&&(i.preventDefault(),x()))}},L=function(e){l||(l=setTimeout(function(){l=null,r=S(i)},66))};return c.destroy=function(){t&&(document.removeEventListener("click",N,!1),e.removeEventListener("resize",L,!1),t=null,n=null,o=null,i=null,r=null,l=null,s=null)},c.init=function(n){a&&(c.destroy(),t=d(u,n||{}),i=t.selectorHeader?document.querySelector(t.selectorHeader):null,r=S(i),document.addEventListener("click",N,!1),e.addEventListener("hashchange",x,!1),i&&e.addEventListener("resize",L,!1))},c})}).call(t,function(){return this}())},/*!***********************************!*\
   !*** ./src/js/default-options.js ***!
   \***********************************/
 function(e,t){e.exports={tocSelector:".js-toc",contentSelector:".js-toc-content",headingSelector:"h1, h2, h3",ignoreSelector:".js-toc-ignore",linkClass:"toc-link",extraLinkClasses:"",activeLinkClass:"is-active-link",listClass:"toc-list",extraListClasses:"",isCollapsedClass:"is-collapsed",collapsibleClass:"is-collapsible",listItemClass:"toc-list-item",collapseDepth:0,smoothScrollOptions:{easing:"easeInOutCubic",offset:0,speed:300,updateURL:!0},headingsOffset:0,throttleTimeout:50,positionFixedSelector:null,positionFixedClass:"is-position-fixed",fixedSidebarOffset:"auto",includeHtml:!1}},/*!******************************!*\
   !*** ./src/js/build-html.js ***!
   \******************************/
 function(e,t){e.exports=function(e){function t(e,n){var r=n.appendChild(o(e));if(e.children.length){var l=i(e.isCollapsed);e.children.forEach(function(e){t(e,l)}),r.appendChild(l)}}function n(e,n){var o=!1,r=i(o);n.forEach(function(e){t(e,r)});var l=document.querySelector(e);if(null!==l)return l.firstChild&&l.removeChild(l.firstChild),l.appendChild(r)}function o(t){var n=document.createElement("li"),o=document.createElement("a");return e.listItemClass&&n.setAttribute("class",e.listItemClass),e.includeHtml&&t.childNodes.length?u.call(t.childNodes,function(e){o.appendChild(e.cloneNode(!0))}):o.textContent=t.textContent,o.setAttribute("data-scroll",""),o.setAttribute("href","#"+t.id),o.setAttribute("class",e.linkClass+h+"node-name--"+t.nodeName+h+e.extraLinkClasses),n.appendChild(o),n}function i(t){var n=document.createElement("ul"),o=e.listClass+h+e.extraListClasses;return t&&(o+=h+e.collapsibleClass,o+=h+e.isCollapsedClass),n.setAttribute("class",o),n}function r(){var t=document.documentElement.scrollTop||f.scrollTop,n=document.querySelector(e.positionFixedSelector);"auto"===e.fixedSidebarOffset&&(e.fixedSidebarOffset=document.querySelector(e.tocSelector).offsetTop),t>e.fixedSidebarOffset?n.className.indexOf(e.positionFixedClass)===-1&&(n.className+=h+e.positionFixedClass):n.className=n.className.split(h+e.positionFixedClass).join("")}function l(t){var n=document.documentElement.scrollTop||f.scrollTop;e.positionFixedSelector&&r();var o,i=t;if(m&&null!==document.querySelector(e.tocSelector)&&i.length>0){d.call(i,function(t,r){if(t.offsetTop>n+e.headingsOffset){var l=0===r?r:r-1;return o=i[l],!0}if(r===i.length-1)return o=i[i.length-1],!0});var l=document.querySelector(e.tocSelector).querySelectorAll("."+e.linkClass);u.call(l,function(t){t.className=t.className.split(h+e.activeLinkClass).join("")});var c=document.querySelector(e.tocSelector).querySelector("."+e.linkClass+".node-name--"+o.nodeName+'[href="#'+o.id+'"]');c.className+=h+e.activeLinkClass;var a=document.querySelector(e.tocSelector).querySelectorAll("."+e.listClass+"."+e.collapsibleClass);u.call(a,function(t){var n=h+e.isCollapsedClass;t.className.indexOf(n)===-1&&(t.className+=h+e.isCollapsedClass)}),c.nextSibling&&(c.nextSibling.className=c.nextSibling.className.split(h+e.isCollapsedClass).join("")),s(c.parentNode.parentNode)}}function s(t){return t.className.indexOf(e.collapsibleClass)!==-1?(t.className=t.className.split(h+e.isCollapsedClass).join(""),s(t.parentNode.parentNode)):t}function c(t){var n=t.target||t.srcElement;n.className.indexOf(e.linkClass)!==-1&&(m=!1)}function a(){m=!0}var u=[].forEach,d=[].some,f=document.body,m=!0,h=" ";return{enableTocAnimation:a,disableTocAnimation:c,render:n,updateToc:l}}},/*!*********************************!*\
   !*** ./src/js/parse-content.js ***!
   \*********************************/
 function(e,t){e.exports=function(e){function t(e){return e[e.length-1]}function n(e){return+e.nodeName.split("H").join("")}function o(t){var o={id:t.id,children:[],nodeName:t.nodeName,headingLevel:n(t),textContent:t.textContent.trim()};return e.includeHtml&&(o.childNodes=t.childNodes),o}function i(i,r){for(var l=o(i),s=n(i),c=r,a=t(c),u=a?a.headingLevel:0,d=s-u;d>0;)a=t(c),a&&void 0!==a.children&&(c=a.children),d--;return s>=e.collapseDepth&&(l.isCollapsed=!0),c.push(l),c}function r(t,n){var o=n;e.ignoreSelector&&(o=n.split(",").map(function(t){return t.trim()+":not("+e.ignoreSelector+")"}));try{return document.querySelector(t).querySelectorAll(o)}catch(i){return console.warn("Element not found: "+t),null}}function l(e){return s.call(e,function(e,t){var n=o(t);return i(n,e.nest),e},{nest:[]})}var s=[].reduce;return{nestHeadingsArray:l,selectHeadings:r}}}]);
 //# sourceMappingURL=tocbot.min.js.map

</script>

<script type="text/javascript">

  var generateToc = function() {
    var readyState = document.readyState;
    if (readyState === 'interactive' || readyState == 'complete') {

      var headerSize = 140;

      var tocParentNode = document.createElement("div");
      tocParentNode.setAttribute("id", "toc-parent");

      var generatedTocNode = document.createElement("div");
      generatedTocNode.setAttribute("id", "generated-toc");
      tocParentNode.appendChild(generatedTocNode);

      var contentNode = document.getElementById("content");
      contentNode.parentNode.insertBefore(tocParentNode, contentNode);

      var clearNode = document.createElement("div");
      clearNode.setAttribute("class", "clear");
      contentNode.parentNode.appendChild(clearNode);

      tocbot.init({
        tocSelector: '#generated-toc',
        contentSelector: '#content',
        headingSelector: 'h2, h3, h4, h5',
        headingsOffset: headerSize,
        smoothScrollOptions: {
          easing: 'easeInOutCubic',
          offset: headerSize,
          speed: 300, // animation duration.
          updateURL: true
        },
        collapseDepth: 0
      });

    } else {
      window.setTimeout(function(){
        generateToc();
      }, 50);
    }

  }
  generateToc();

</script>
</head>
<body class="book">
<div id="header">
<h1>Flowable BPMN 用户手册 (v 6.4.2-SNAPSHOT)</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">1. 简介</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="license">1.1. 翻译(说明)</h3>
<div class="paragraph">
<p>由[分享牛Flowable中国社区] 翻译，任何意见建议,欢迎联系QQ:3152981878。
如果想一起成为开源代码贡献人员，欢迎大家加入qq交流群为社区贡献添砖加瓦。qq贡献群：1023773998</p>
</div>
</div>
<div class="sect2">
<h3 id="_协议">1.2. 协议</h3>
<div class="paragraph">
<p>Flowable在<a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache V2 协议</a>下发布。</p>
</div>
</div>
<div class="sect2">
<h3 id="download">1.3. 下载</h3>
<div class="paragraph">
<p><a href="http://www.flowable.org/downloads.html"><a href="http://www.flowable.org/downloads.html" class="bare">http://www.flowable.org/downloads.html</a></a></p>
</div>
</div>
<div class="sect2">
<h3 id="sources">1.4. 源码</h3>
<div class="paragraph">
<p>Flowable的发布包里包含了大部分源码，以JAR文件方式提供。Flowable的源码也可以通过以下链接获得：
  <a href="https://github.com/flowable/flowable-engine"><a href="https://github.com/flowable/flowable-engine" class="bare">https://github.com/flowable/flowable-engine</a></a></p>
</div>
</div>
<div class="sect2">
<h3 id="required.software">1.5. 必要的软件</h3>
<div class="sect3">
<h4 id="_jdk_8">1.5.1. JDK 8+</h4>
<div class="paragraph">
<p>运行Flowable需要JDK 8或以上版本。可以访问 <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Oracle Java SE downloads页面</a> 点击“Download JDK”按钮获取。该页面上也有安装指导。安装完成后，可以执行 <code>java -version</code> 。能看到JDK的版本信息就说明安装成功了。</p>
</div>
</div>
<div class="sect3">
<h4 id="_ide">1.5.2. IDE</h4>
<div class="paragraph">
<p>可以自行选择用于Flowable开发的IDE。如果想要使用Flowable Designer，则需要Eclipse Mars或Neon。
到 <a href="http://www.eclipse.org/downloads/">Eclipse下载页面</a>选择Eclipse版本并下载。解压下载的文件，
然后执行<code>eclipse</code>文件夹下的eclipse文件。手册后续有专门一章介绍如何<a href="#eclipseDesignerInstallation">安装我们的Eclipse Designer插件</a>。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reporting.problems">1.6. 反馈问题</h3>
<div class="paragraph">
<p>我们希望开发者在报告或提问之前，先看看<a href="http://www.catb.org/~esr/faqs/smart-questions.html">提问的智慧</a>。</p>
</div>
<div class="paragraph">
<p>看完提问的智慧，你可以在<a href="http://forums.flowable.org">用户论坛</a>提问、评论以及提交改进建议，也可以在<a href="https://github.com/flowable/flowable-engine/issues">我们的Github问题跟踪系统</a>创建bug报告。</p>
</div>
</div>
<div class="sect2">
<h3 id="experimental">1.7. 实验性功能</h3>
<div class="paragraph">
<p>标记有<strong>[实验性]</strong>的章节介绍的功能还不够稳定。</p>
</div>
<div class="paragraph">
<p><code>.impl.</code>包下的类都是内部实现类，不保证稳定。但是，在用户手册中作为配置参数介绍的类则是被官方支持的，可以保证稳定。</p>
</div>
</div>
<div class="sect2">
<h3 id="internal">1.8. 内部实现类</h3>
<div class="paragraph">
<p>在JAR文件中，所有<code>.impl.</code>包下的类（比如<code>org.flowable.engine.impl.db</code>）都是实现类，只应在内部使用。实现类中的所有类或接口都不保证稳定。</p>
</div>
</div>
<div class="sect2">
<h3 id="_versioning_strategy">1.9. 版本策略</h3>
<div class="paragraph">
<p>使用三个整数的形式标记版本：<strong>MAJOR.MINOR.MICRO</strong>。其中 <strong>MAJOR</strong>版本代表核心引擎的演进。<strong>MINOR</strong>版本代表新功能与新API。<strong>MICRO</strong>版本代表bug修复与改进。</p>
</div>
<div class="paragraph">
<p>总的来说，Flowable希望在<strong>MINOR</strong>与<strong>MICRO</strong>版本中，对所有非内部实现类保持“源代码兼容性”，即应用可以正确构建，且不改变语义。Flowable也希望在<strong>MINOR</strong>与<strong>MICRO</strong>版本中，保持“二进制兼容性”，即用新版本的Flowable直接替换老版本的Jar文件，仍然可以正常工作。</p>
</div>
<div class="paragraph">
<p>如果在<strong>MINOR</strong>版本中修改了API，将保留原有版本，并使用<em>@Deprecated</em>注解。这种废弃的API将在两个<strong>MINOR</strong>版本之后移除。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started">2. 开始</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_flowable">2.1. Flowable是什么？</h3>
<div class="paragraph">
<p>Flowable是一个使用Java编写的轻量级业务流程引擎。Flowable流程引擎可用于部署BPMN 2.0流程定义（用于定义流程的行业XML标准），
创建这些流程定义的流程实例，进行查询，访问运行中或历史的流程实例与相关数据，等等。这个章节将用一个可以在你自己的开发环境中使用的例子，逐步介绍各种概念与API。</p>
</div>
<div class="paragraph">
<p>Flowable可以十分灵活地加入你的应用/服务/构架。可以将JAR形式发布的Flowable库加入应用或服务，来<em>嵌入</em>引擎。
以JAR形式发布使Flowable可以轻易加入任何Java环境：Java SE；Tomcat、Jetty或Spring之类的servlet容器；JBoss或WebSphere之类的Java EE服务器，等等。
另外，也可以使用Flowable REST API进行HTTP调用。也有许多Flowable应用（Flowable Modeler, Flowable Admin, Flowable IDM 与 Flowable Task），提供了直接可用的UI示例，可以使用流程与任务。</p>
</div>
<div class="paragraph">
<p>所有使用Flowable方法的共同点是核心引擎。核心引擎是一组服务的集合，并提供管理与执行业务流程的API。
下面的教程从设置与使用核心引擎的介绍开始。后续章节都建立在之前章节中获取的知识之上。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#getting.started.command.line">第一节</a>展示了以最简单的方式运行Flowable的方法：只使用Java SE的标准Java main方法。这里也会介绍许多核心概念与API。</p>
</li>
<li>
<p><a href="#getting.started.rest">Flowable REST API</a>章节展示了如何通过REST运行及使用相同的API。</p>
</li>
<li>
<p><a href="#getting.started.flowable.app">Flowable APP</a>章节将介绍直接可用的Flowable UI示例的基本方法。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_flowable_and_activiti">2.2. Flowable与Activiti</h3>
<div class="paragraph">
<p>Flowable是Activiti(Alfresco持有的注册商标)的fork。在下面的章节中，你会注意到包名，配置文件等等，都使用<em>flowable</em>。</p>
</div>
</div>
<div class="sect2">
<h3 id="getting.started.command.line">2.3. 构建命令行程序</h3>
<div class="sect3">
<h4 id="_creating_a_process_engine">2.3.1. 创建流程引擎</h4>
<div class="paragraph">
<p>在这个初步教程中，将构建一个简单的例子，以展示如何创建一个Flowable流程引擎，介绍一些核心概念，并展示如何使用API。
截图时使用的是Eclipse，但实际上可以使用任何IDE。我们使用Maven获取Flowable依赖及管理构建，但是类似的任何其它方法也都可以使用（Gradle，Ivy，等等）。</p>
</div>
<div class="paragraph">
<p>我们将构建的例子是一个简单的<em>请假(holiday request)</em>流程：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>雇员(employee)</em>申请几天的假期</p>
</li>
<li>
<p><em>经理(manager)</em>批准或驳回申请</p>
</li>
<li>
<p>我们会模拟将申请注册到某个外部系统，并给雇员发送结果邮件</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>首先，通过<em>File &#8594; New &#8594; Other &#8594; Maven Project</em>创建一个新的Maven项目</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/getting.started.new.maven.png" alt="getting.started.new.maven">
</div>
</div>
<div class="paragraph">
<p>在下一界面中，选中'<em>create a simple project (skip archetype selection)</em>'</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/getting.started.new.maven2.png" alt="getting.started.new.maven2">
</div>
</div>
<div class="paragraph">
<p>填入<em>'Group Id'</em>与<em>'Artifact id'</em>:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/getting.started.new.maven3.png" alt="getting.started.new.maven3">
</div>
</div>
<div class="paragraph">
<p>这样就建立了空的Maven项目，然后添加两个依赖：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Flowable流程引擎。使我们可以创建一个ProcessEngine流程引擎对象，并访问Flowable API。</p>
</li>
<li>
<p>一个内存数据库。本例中为H2，因为Flowable引擎在运行流程实例时，需要使用数据库来存储执行与历史数据。
请注意H2依赖包含了数据库<em>及</em>驱动。如果使用其他数据库（例如PostgreSQL，MySQL等），需要添加对应的数据库驱动依赖。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在<em>pom.xml</em>文件中添加下列行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependencies&gt;</span>
  <span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>org.flowable<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>flowable-engine<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>6.4.2-SNAPSHOT<span class="tok-nt">&lt;/version&gt;</span>
  <span class="tok-nt">&lt;/dependency&gt;</span>
  <span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>com.h2database<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>h2<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>1.3.176<span class="tok-nt">&lt;/version&gt;</span>
  <span class="tok-nt">&lt;/dependency&gt;</span>
<span class="tok-nt">&lt;/dependencies&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果由于某些原因，依赖JAR无法自动获取，可以右键点击项目，并选择'<em>Maven &#8594; Update Project</em>'以强制手动刷新（一般不会需要这么操作）。
在这个项目中的'<em>Maven Dependencies</em>'下，可以看到<em>flowable-engine</em>与许多其他（传递的）依赖。</p>
</div>
<div class="paragraph">
<p>创建一个新的Java类，并添加标准的Java main方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-kn">package</span> <span class="tok-nn">org.flowable</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HolidayRequest</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>

  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>首先要做的是初始化<strong>ProcessEngine</strong>流程引擎实例。这是一个线程安全的对象，因此通常只需要在一个应用中初始化一次。
<em>ProcessEngine</em>由<strong>ProcessEngineConfiguration</strong>实例创建。该实例可以配置与调整流程引擎的设置。
通常使用一个配置XML文件创建<em>ProcessEngineConfiguration</em>，但是（像在这里做的一样）也可以编程方式创建它。
<em>ProcessEngineConfiguration</em>所需的最小配置，是数据库JDBC连接：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-kn">package</span> <span class="tok-nn">org.flowable</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">org.flowable.engine.ProcessEngine</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.flowable.engine.ProcessEngineConfiguration</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HolidayRequest</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">ProcessEngineConfiguration</span> <span class="tok-n">cfg</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">StandaloneProcessEngineConfiguration</span><span class="tok-o">()</span>
      <span class="tok-o">.</span><span class="tok-na">setJdbcUrl</span><span class="tok-o">(</span><span class="tok-s">&quot;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=-1&quot;</span><span class="tok-o">)</span>
      <span class="tok-o">.</span><span class="tok-na">setJdbcUsername</span><span class="tok-o">(</span><span class="tok-s">&quot;sa&quot;</span><span class="tok-o">)</span>
      <span class="tok-o">.</span><span class="tok-na">setJdbcPassword</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">)</span>
      <span class="tok-o">.</span><span class="tok-na">setJdbcDriver</span><span class="tok-o">(</span><span class="tok-s">&quot;org.h2.Driver&quot;</span><span class="tok-o">)</span>
      <span class="tok-o">.</span><span class="tok-na">setDatabaseSchemaUpdate</span><span class="tok-o">(</span><span class="tok-n">ProcessEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">DB_SCHEMA_UPDATE_TRUE</span><span class="tok-o">);</span>

    <span class="tok-n">ProcessEngine</span> <span class="tok-n">processEngine</span> <span class="tok-o">=</span> <span class="tok-n">cfg</span><span class="tok-o">.</span><span class="tok-na">buildProcessEngine</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的代码中，第10行创建了一个<em>独立(standalone)</em>配置对象。这里的<em>'独立'</em>指的是引擎是完全独立创建及使用的（而不是在Spring环境中使用，这时需要使用<em>SpringProcessEngineConfiguration</em>类代替）。第11至14行中，传递了一个内存H2数据库实例的JDBC连接参数。
重要：请注意这样的数据库在JVM重启后会消失。如果需要永久保存数据，需要切换为持久化数据库，并相应切换连接参数。
第15行中，设置了<em>true</em>，确保在JDBC参数连接的数据库中，数据库表结构不存在时，会创建相应的表结构。
另外，Flowable也提供了一组SQL文件，可用于手动创建所有表的数据库表结构。</p>
</div>
<div class="paragraph">
<p>然后使用这个配置创建<strong>ProcessEngine</strong>对象（第17行）。</p>
</div>
<div class="paragraph">
<p>这样就可以运行了。在Eclipse中最简单的方法是右键点击类文件，选择<em>Run As &#8594; Java Application</em> ：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/getting.started.run.main.png" alt="getting.started.run.main">
</div>
</div>
<div class="paragraph">
<p>应用运行没有问题，但也没有在控制台提供有用的信息，只有一条消息提示日志没有正确配置：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/getting.started.console.logging.png" alt="getting.started.console.logging">
</div>
</div>
<div class="paragraph">
<p>Flowable使用<a href="http://www.slf4j.org/">SLF4J</a>作为内部日志框架。在这个例子中，我们使用log4j作为SLF4J的实现。因此在pom.xml文件中添加下列依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.slf4j<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>slf4j-api<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>1.7.21<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.slf4j<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>slf4j-log4j12<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>1.7.21<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Log4j需要一个配置文件。在<em>src/main/resources</em>文件夹下添加<em>log4j.properties</em>文件，并写入下列内容：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>log4j.rootLogger=DEBUG, CA

log4j.appender.CA=org.apache.log4j.ConsoleAppender
log4j.appender.CA.layout=org.apache.log4j.PatternLayout
log4j.appender.CA.layout.ConversionPattern= %d{hh:mm:ss,SSS} [%t] %-5p %c %x - %m%n</pre>
</div>
</div>
<div class="paragraph">
<p>重新运行应用。应该可以看到关于引擎启动与创建数据库表结构的提示日志：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/getting.started.console.logging2.png" alt="getting.started.console.logging2">
</div>
</div>
<div class="paragraph">
<p>这样就得到了一个启动可用的流程引擎。接下来为它提供一个流程！</p>
</div>
</div>
<div class="sect3">
<h4 id="_deploying_a_process_definition">2.3.2. 部署流程定义</h4>
<div class="paragraph">
<p>我们要构建的流程是一个非常简单的请假流程。Flowable引擎需要流程定义为BPMN 2.0格式，这是一个业界广泛接受的XML标准。
在Flowable术语中，我们将其称为一个<strong>流程定义(process definition)</strong>。一个<em>流程定义</em>可以启动多个<strong>流程实例(process instance)</strong>。<em>流程定义</em>可以看做是重复执行流程的蓝图。
在这个例子中，<em>流程定义</em>定义了请假的各个步骤，而一个<em>流程实例</em>对应某个雇员提出的一个请假申请。</p>
</div>
<div class="paragraph">
<p>BPMN 2.0存储为XML，并包含可视化的部分：使用标准方式定义了每个步骤类型（人工任务，自动服务调用，等等）如何呈现，以及如何互相连接。这样BPMN 2.0标准使技术人员与业务人员能用双方都能理解的方式交流业务流程。</p>
</div>
<div class="paragraph">
<p>我们要使用的流程定义为：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/getting.started.bpmn.process.png" alt="getting.started.bpmn.process">
</div>
</div>
<div class="paragraph">
<p>这个流程应该已经十分自我解释了。但为了明确起见，说明一下几个要点：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>我们假定启动流程需要提供一些信息，例如雇员名字、请假时长以及说明。当然，这些可以单独建模为流程中的第一步。
但是如果将它们作为流程的“输入信息”，就能保证只有在实际请求时才会建立一个流程实例。否则（将提交作为流程的第一步），用户可能在提交之前改变主意并取消，但流程实例已经创建了。
在某些场景中，就可能影响重要的指标（例如启动了多少申请，但还未完成），取决于业务目标。</p>
</li>
<li>
<p>左侧的圆圈叫做<strong>启动事件(start event)</strong>。这是一个流程实例的起点。</p>
</li>
<li>
<p>第一个矩形是一个<strong>用户任务(user task)</strong>。这是流程中人类用户操作的步骤。在这个例子中，经理需要批准或驳回申请。</p>
</li>
<li>
<p>取决于经理的决定，<strong>排他网关(exclusive gateway)</strong> (带叉的菱形)会将流程实例路由至批准或驳回路径。</p>
</li>
<li>
<p>如果批准，则需要将申请注册至某个外部系统，并跟着另一个用户任务，将经理的决定通知给申请人。当然也可以改为发送邮件。</p>
</li>
<li>
<p>如果驳回，则为雇员发送一封邮件通知他。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>一般来说，这样的<em>流程定义</em>使用可视化建模工具建立，如Flowable Designer(Eclipse)或Flowable Web Modeler(Web应用)。</p>
</div>
<div class="paragraph">
<p>但在这里我们直接撰写XML，以熟悉BPMN 2.0及其概念。</p>
</div>
<div class="paragraph">
<p>与上面展示的流程图对应的BPMN 2.0 XML在下面显示。请注意这只包含了“流程部分”。如果使用图形化建模工具，实际的XML文件还将包含“可视化部分”，用于描述图形信息，如流程定义中各个元素的坐标（所有的图形化信息包含在XML的<em>BPMNDiagram</em>标签中，作为<em>definitions</em>标签的子元素）。</p>
</div>
<div class="paragraph">
<p>将下面的XML保存在<em>src/main/resources</em>文件夹下名为<em>holiday-request.bpmn20.xml</em>的文件中。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54</div></td><td class="code"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-nt">&lt;definitions</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot;</span>
  <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="tok-na">xmlns:xsd=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>
  <span class="tok-na">xmlns:bpmndi=</span><span class="tok-s">&quot;http://www.omg.org/spec/BPMN/20100524/DI&quot;</span>
  <span class="tok-na">xmlns:omgdc=</span><span class="tok-s">&quot;http://www.omg.org/spec/DD/20100524/DC&quot;</span>
  <span class="tok-na">xmlns:omgdi=</span><span class="tok-s">&quot;http://www.omg.org/spec/DD/20100524/DI&quot;</span>
  <span class="tok-na">xmlns:flowable=</span><span class="tok-s">&quot;http://flowable.org/bpmn&quot;</span>
  <span class="tok-na">typeLanguage=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>
  <span class="tok-na">expressionLanguage=</span><span class="tok-s">&quot;http://www.w3.org/1999/XPath&quot;</span>
  <span class="tok-na">targetNamespace=</span><span class="tok-s">&quot;http://www.flowable.org/processdef&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;holidayRequest&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Holiday Request&quot;</span> <span class="tok-na">isExecutable=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;startEvent&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;startEvent&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;approveTask&quot;</span><span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;approveTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Approve or reject request&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;approveTask&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;decision&quot;</span><span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;exclusiveGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;decision&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;decision&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;externalSystemCall&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-cp">&lt;![CDATA[</span>
<span class="tok-cp">          ${approved}</span>
<span class="tok-cp">        ]]&gt;</span>
      <span class="tok-nt">&lt;/conditionExpression&gt;</span>
    <span class="tok-nt">&lt;/sequenceFlow&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span>  <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;decision&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;sendRejectionMail&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-cp">&lt;![CDATA[</span>
<span class="tok-cp">          ${!approved}</span>
<span class="tok-cp">        ]]&gt;</span>
      <span class="tok-nt">&lt;/conditionExpression&gt;</span>
    <span class="tok-nt">&lt;/sequenceFlow&gt;</span>

    <span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;externalSystemCall&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Enter holidays in external system&quot;</span>
        <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;org.flowable.CallExternalSystemDelegate&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;externalSystemCall&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;holidayApprovedTask&quot;</span><span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;holidayApprovedTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Holiday approved&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;holidayApprovedTask&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;approveEnd&quot;</span><span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sendRejectionMail&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Send out rejection email&quot;</span>
        <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;org.flowable.SendRejectionMail&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;sendRejectionMail&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;rejectEnd&quot;</span><span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;approveEnd&quot;</span><span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;rejectEnd&quot;</span><span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;/process&gt;</span>

<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>第2至11行看起来挺吓人，但其实在大多数的流程定义中都是一样的。这是一种<em>样板文件</em>，需要与BPMN 2.0标准规范完全一致。</p>
</div>
<div class="paragraph">
<p>每一个步骤（在BPMN 2.0术语中称作<strong><em>活动(activity)</em></strong>）都有一个<em>id</em>属性，为其提供一个在XML文件中唯一的标识符。所有的<em>活动</em>都可以设置一个名字，以提高流程图的可读性。</p>
</div>
<div class="paragraph">
<p><em>活动</em>之间通过<strong>顺序流(sequence flow)</strong>连接，在流程图中是一个有向箭头。在执行流程实例时，执行(execution)会从<em>启动事件</em>沿着<em>顺序流</em>流向下一个<em>活动</em>。</p>
</div>
<div class="paragraph">
<p>离开<em>排他网关(带有X的菱形)</em>的<em>顺序流</em>很特别：都以<em>表达式(expression)</em>的形式定义了<em>条件(condition)</em> （见第25至32行）。当流程实例的执行到达这个<em>网关</em>时，会计算<em>条件</em>，并使用第一个计算为<em>true</em>的顺序流。这就是<em>排他</em>的含义：只选择一个。当然如果需要不同的路由策略，可以使用其他类型的网关。</p>
</div>
<div class="paragraph">
<p>这里用作条件的<em>表达式</em>为<em>${approved}</em>，这是<em>${approved == true}</em>的简写。变量&#8217;approved&#8217;被称作<strong>流程变量(process variable)</strong>。<em>流程变量</em>是持久化的数据，与流程实例存储在一起，并可以在流程实例的生命周期中使用。在这个例子里，我们需要在特定的地方（当经理用户任务提交时，或者以Flowable的术语来说，<em>完成(complete)</em>时）设置这个<em>流程变量</em>，因为这不是流程实例启动时就能获取的数据。</p>
</div>
<div class="paragraph">
<p>现在我们已经有了流程BPMN 2.0 XML文件，下来需要将它<strong><em>部署(deploy)</em></strong>到引擎中。<em>部署</em>一个流程定义意味着：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>流程引擎会将XML文件存储在数据库中，这样可以在需要的时候获取它。</p>
</li>
<li>
<p>流程定义转换为内部的、可执行的对象模型，这样使用它就可以启动<em>流程实例</em>。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>将流程定义<em>部署</em>至Flowable引擎，需要使用<em>RepositoryService</em>，其可以从<em>ProcessEngine</em>对象获取。使用<em>RepositoryService</em>，可以通过XML文件的路径创建一个新的<em>部署(Deployment)</em>，并调用<em>deploy()</em>方法实际执行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">RepositoryService</span> <span class="tok-n">repositoryService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getRepositoryService</span><span class="tok-o">();</span>
<span class="tok-n">Deployment</span> <span class="tok-n">deployment</span> <span class="tok-o">=</span> <span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">addClasspathResource</span><span class="tok-o">(</span><span class="tok-s">&quot;holiday-request.bpmn20.xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>我们现在可以通过API查询验证流程定义已经部署在引擎中（并学习一些API）。通过<em>RepositoryService</em>创建的<em>ProcessDefinitionQuery</em>对象实现。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">ProcessDefinition</span> <span class="tok-n">processDefinition</span> <span class="tok-o">=</span> <span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">createProcessDefinitionQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">deploymentId</span><span class="tok-o">(</span><span class="tok-n">deployment</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
  <span class="tok-o">.</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Found process definition : &quot;</span> <span class="tok-o">+</span> <span class="tok-n">processDefinition</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_starting_a_process_instance">2.3.3. 启动流程实例</h4>
<div class="paragraph">
<p>现在已经在流程引擎中<em>部署</em>了流程定义，因此可以使用这个<em>流程定义</em>作为“蓝图”启动<em>流程实例</em>。</p>
</div>
<div class="paragraph">
<p>要启动流程实例，需要提供一些初始化<em>流程变量</em>。一般来说，可以通过呈现给用户的表单，或者在流程由其他系统自动触发时通过REST API，来获取这些变量。在这个例子里，我们简化为使用java.util.Scanner类在命令行输入一些数据：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-n">Scanner</span> <span class="tok-n">scanner</span><span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Scanner</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">in</span><span class="tok-o">);</span>

<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Who are you?&quot;</span><span class="tok-o">);</span>
<span class="tok-n">String</span> <span class="tok-n">employee</span> <span class="tok-o">=</span> <span class="tok-n">scanner</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">();</span>

<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;How many holidays do you want to request?&quot;</span><span class="tok-o">);</span>
<span class="tok-n">Integer</span> <span class="tok-n">nrOfHolidays</span> <span class="tok-o">=</span> <span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">valueOf</span><span class="tok-o">(</span><span class="tok-n">scanner</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">());</span>

<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Why do you need them?&quot;</span><span class="tok-o">);</span>
<span class="tok-n">String</span> <span class="tok-n">description</span> <span class="tok-o">=</span> <span class="tok-n">scanner</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>截下来，我们使用<em>RuntimeService</em>启动一个<em>流程实例</em>。收集的数据作为一个<em>java.util.Map</em>实例传递，其中的键就是之后用于获取变量的标识符。这个流程实例使用<em>key</em>启动。这个<em>key</em>就是BPMN 2.0 XML文件中设置的<em>id</em>属性，在这个例子里是<em>holidayRequest</em>。</p>
</div>
<div class="paragraph">
<p>（请注意：除了使用key之外，在后面你还会看到有很多其他方式启动一个流程实例）</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;holidayRequest&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Holiday Request&quot;</span> <span class="tok-na">isExecutable=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-n">RuntimeService</span> <span class="tok-n">runtimeService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getRuntimeService</span><span class="tok-o">();</span>

<span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">variables</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;();</span>
<span class="tok-n">variables</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;employee&quot;</span><span class="tok-o">,</span> <span class="tok-n">employee</span><span class="tok-o">);</span>
<span class="tok-n">variables</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;nrOfHolidays&quot;</span><span class="tok-o">,</span> <span class="tok-n">nrOfHolidays</span><span class="tok-o">);</span>
<span class="tok-n">variables</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;description&quot;</span><span class="tok-o">,</span> <span class="tok-n">description</span><span class="tok-o">);</span>
<span class="tok-n">ProcessInstance</span> <span class="tok-n">processInstance</span> <span class="tok-o">=</span>
  <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;holidayRequest&quot;</span><span class="tok-o">,</span> <span class="tok-n">variables</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在流程实例启动后，会创建一个<strong>执行(execution)</strong>，并将其放在启动事件上。从这里开始，这个<em>执行</em>沿着顺序流移动到经理审批的用户任务，并执行用户任务行为。这个行为将在数据库中创建一个任务，该任务可以之后使用查询找到。用户任务是一个<em>等待状态(wait state)</em>，引擎会停止执行，返回API调用处。</p>
</div>
</div>
<div class="sect3">
<h4 id="_sidetrack_transactionality">2.3.4. 另一个话题：事务</h4>
<div class="paragraph">
<p>在Flowable中，数据库事务扮演了关键角色，用于保证数据一致性，并解决并发问题。当调用Flowable API时，默认情况下，所有操作都是同步的，并处于同一个事务下。这意味着，当方法调用返回时，会启动并提交一个事务。</p>
</div>
<div class="paragraph">
<p>流程启动后，会有<strong>一个数据库事务</strong>从流程实例启动时持续到下一个<em>等待状态</em>。在这个例子里，指的是第一个用户任务。当引擎到达这个用户任务时，状态会持久化至数据库，提交事务，并返回API调用处。</p>
</div>
<div class="paragraph">
<p>在Flowable中，当一个流程实例运行时，总会有一个数据库事务从前一个<em>等待状态</em>持续到下一个<em>等待状态</em>。数据持久化之后，可能在数据库中保存很长时间，甚至几年，直到某个API调用使流程实例继续执行。请注意当流程处在等待状态时，不会消耗任何计算或内存资源，直到下一次APi调用。</p>
</div>
<div class="paragraph">
<p>在这个例子中，当第一个用户任务完成时，会启动一个数据库事务，从用户任务开始，经过排他网关（自动逻辑），直到第二个用户任务。或通过另一条路径直接到达结束。</p>
</div>
</div>
<div class="sect3">
<h4 id="_querying_and_completing_tasks">2.3.5. 查询与完成任务</h4>
<div class="paragraph">
<p>在更实际的应用中，会为雇员及经理提供用户界面，让他们可以登录并查看任务列表。其中可以看到作为<em>流程变量</em>存储的流程实例数据，并决定如何操作任务。在这个例子中，我们通过执行API调用来模拟任务列表，通常这些API都是由UI驱动的服务在后台调用的。</p>
</div>
<div class="paragraph">
<p>我们还没有为用户任务配置办理人。我们想将第一个任务指派给"经理(managers)"组，而第二个用户任务指派给请假申请的提交人。因此需要为第一个任务添加<em>candidateGroups</em>属性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;approveTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Approve or reject request&quot;</span> <span class="tok-na">flowable:candidateGroups=</span><span class="tok-s">&quot;managers&quot;</span><span class="tok-nt">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>并如下所示为第二个任务添加<em>assignee</em>属性。请注意我们没有像上面的&#8217;managers&#8217;一样使用静态值，而是使用一个流程变量动态指派。这个流程变量是在流程实例启动时传递的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;holidayApprovedTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Holiday approved&quot;</span> <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;${employee}&quot;</span><span class="tok-nt">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>要获得实际的任务列表，需要通过<em>TaskService</em>创建一个<em>TaskQuery</em>。我们配置这个查询只返回&#8217;managers&#8217;组的任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-n">TaskService</span> <span class="tok-n">taskService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getTaskService</span><span class="tok-o">();</span>
<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">taskCandidateGroup</span><span class="tok-o">(</span><span class="tok-s">&quot;managers&quot;</span><span class="tok-o">).</span><span class="tok-na">list</span><span class="tok-o">();</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;You have &quot;</span> <span class="tok-o">+</span> <span class="tok-n">tasks</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; tasks:&quot;</span><span class="tok-o">);</span>
<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span><span class="tok-o">=</span><span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">&lt;</span><span class="tok-n">tasks</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">();</span> <span class="tok-n">i</span><span class="tok-o">++)</span> <span class="tok-o">{</span>
  <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">((</span><span class="tok-n">i</span><span class="tok-o">+</span><span class="tok-mi">1</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-s">&quot;) &quot;</span> <span class="tok-o">+</span> <span class="tok-n">tasks</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">i</span><span class="tok-o">).</span><span class="tok-na">getName</span><span class="tok-o">());</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用任务Id获取特定流程实例的变量，并在屏幕上显示实际的申请：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Which task would you like to complete?&quot;</span><span class="tok-o">);</span>
<span class="tok-kt">int</span> <span class="tok-n">taskIndex</span> <span class="tok-o">=</span> <span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">valueOf</span><span class="tok-o">(</span><span class="tok-n">scanner</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">());</span>
<span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">=</span> <span class="tok-n">tasks</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">taskIndex</span> <span class="tok-o">-</span> <span class="tok-mi">1</span><span class="tok-o">);</span>
<span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">processVariables</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">getVariables</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">processVariables</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-s">&quot;employee&quot;</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-s">&quot; wants &quot;</span> <span class="tok-o">+</span>
    <span class="tok-n">processVariables</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-s">&quot;nrOfHolidays&quot;</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-s">&quot; of holidays. Do you approve this?&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>运行结果像下面这样：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/getting.started.console.logging3.png" alt="getting.started.console.logging3">
</div>
</div>
<div class="paragraph">
<p>经理现在就可以<strong>完成任务</strong>了。在现实中，这通常意味着由用户提交一个表单。表单中的数据作为<em>流程变量</em>传递。在这里，我们在完成任务时传递带有&#8217;approved&#8217;变量（这个名字很重要，因为之后会在顺序流的条件中使用！）的map来模拟：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-kt">boolean</span> <span class="tok-n">approved</span> <span class="tok-o">=</span> <span class="tok-n">scanner</span><span class="tok-o">.</span><span class="tok-na">nextLine</span><span class="tok-o">().</span><span class="tok-na">toLowerCase</span><span class="tok-o">().</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;y&quot;</span><span class="tok-o">);</span>
<span class="tok-n">variables</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;();</span>
<span class="tok-n">variables</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;approved&quot;</span><span class="tok-o">,</span> <span class="tok-n">approved</span><span class="tok-o">);</span>
<span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">complete</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">(),</span> <span class="tok-n">variables</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>现在任务完成，并会在离开排他网关的两条路径中，基于&#8217;approved&#8217;流程变量选择一条。</p>
</div>
</div>
<div class="sect3">
<h4 id="getting.started.delegate">2.3.6. 实现JavaDelegate</h4>
<div class="paragraph">
<p>拼图还缺了一块：我们还没有实现申请通过后执行的自动逻辑。在BPMN 2.0 XML中，这是一个<strong>服务任务(service task)</strong>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;externalSystemCall&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Enter holidays in external system&quot;</span>
    <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;org.flowable.CallExternalSystemDelegate&quot;</span><span class="tok-nt">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>在现实中，这个逻辑可以做任何事情：向某个系统发起一个HTTP REST服务调用，或调用某个使用了好几十年的系统中的遗留代码。我们不会在这里实现实际的逻辑，而只是简单的日志记录<em>流程</em>。</p>
</div>
<div class="paragraph">
<p>创建一个新的类(在Eclipse里<em>File &#8594; New &#8594; Class</em>)，填入<em>org.flowable</em>作为包名，<em>CallExternalSystemDelegate</em>作为类名。让这个类实现<em>org.flowable.engine.delegate.JavaDelegate</em>接口，并实现<em>execute</em>方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-kn">package</span> <span class="tok-nn">org.flowable</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">org.flowable.engine.delegate.DelegateExecution</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.flowable.engine.delegate.JavaDelegate</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CallExternalSystemDelegate</span> <span class="tok-kd">implements</span> <span class="tok-n">JavaDelegate</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">DelegateExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Calling the external system for employee &quot;</span>
            <span class="tok-o">+</span> <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">getVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;employee&quot;</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当<em>执行</em>到达<em>服务任务</em>时，会初始化并调用BPMN 2.0 XML中所引用的类。</p>
</div>
<div class="paragraph">
<p>现在执行这个例子的时候，就会显示出日志信息，说明已经执行了自定义逻辑：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/getting.started.console.logging4.png" alt="getting.started.console.logging4">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_working_with_historical_data">2.3.7. 使用历史数据</h4>
<div class="paragraph">
<p>选择使用Flowable这样的流程引擎的原因之一，是它可以自动存储所有流程实例的<strong>审计数据</strong>或<strong>历史数据</strong>。这些数据可以用于创建报告，深入展现组织运行的情况，瓶颈在哪里，等等。</p>
</div>
<div class="paragraph">
<p>例如，如果希望显示流程实例已经执行的时间，就可以从<em>ProcessEngine</em>获取<em>HistoryService</em>，并创建<em>历史活动(historical activities)</em>的查询。在下面的代码片段中，可以看到我们添加了一些额外的过滤条件：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>只选择一个特定流程实例的活动</p>
</li>
<li>
<p>只选择已完成的活动</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>结果按照结束时间排序，代表其执行顺序。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-n">HistoryService</span> <span class="tok-n">historyService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getHistoryService</span><span class="tok-o">();</span>
<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">HistoricActivityInstance</span><span class="tok-o">&gt;</span> <span class="tok-n">activities</span> <span class="tok-o">=</span>
  <span class="tok-n">historyService</span><span class="tok-o">.</span><span class="tok-na">createHistoricActivityInstanceQuery</span><span class="tok-o">()</span>
   <span class="tok-o">.</span><span class="tok-na">processInstanceId</span><span class="tok-o">(</span><span class="tok-n">processInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
   <span class="tok-o">.</span><span class="tok-na">finished</span><span class="tok-o">()</span>
   <span class="tok-o">.</span><span class="tok-na">orderByHistoricActivityInstanceEndTime</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
   <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>

<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">HistoricActivityInstance</span> <span class="tok-n">activity</span> <span class="tok-o">:</span> <span class="tok-n">activities</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">activity</span><span class="tok-o">.</span><span class="tok-na">getActivityId</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; took &quot;</span>
    <span class="tok-o">+</span> <span class="tok-n">activity</span><span class="tok-o">.</span><span class="tok-na">getDurationInMillis</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; milliseconds&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>再次运行例子，可以看到控制台中显示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>startEvent took 1 milliseconds
approveTask took 2638 milliseconds
decision took 3 milliseconds
externalSystemCall took 1 milliseconds</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_conclusion">2.3.8. 小结</h4>
<div class="paragraph">
<p>这个教程介绍了很多Flowable与BPMN 2.0的概念与术语，也展示了如何编程使用Flowable API。</p>
</div>
<div class="paragraph">
<p>当然，这只是个开始。下面的章节会更深入介绍许多Flowable引擎支持的选项与特性。其他章节介绍安装与使用Flowable引擎的不同方法，并详细介绍了所有可用的BPMN 2.0结构。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="getting.started.rest">2.4. 开始使用Flowable REST API</h3>
<div class="paragraph">
<p>这个章节展示了与<a href="#getting.started.command.line">上一章节</a>相同的例子：部署一个流程定义，启动一个流程实例，获取任务列表并完成一个任务。最好先快速浏览上一章节以了解所做的事情。</p>
</div>
<div class="paragraph">
<p>这一次，将使用Flowable REST API而不是Java API。你很快就会意识到REST API与Java API紧密关联。只要了解一个，就能很快学会另一个。</p>
</div>
<div class="paragraph">
<p>可以在<a href="#restApiChapter">REST API</a>章节找到Flowable REST API的完整细节。</p>
</div>
<div class="sect3">
<h4 id="_setting_up_the_rest_application">2.4.1. 安装REST应用</h4>
<div class="paragraph">
<p>从flowable.org网站下载.zip文件后，可以在<em>wars</em>文件夹下找到REST应用。要运行这个WAR文件，需要一个servlet容器，例如<a href="http://tomcat.apache.org/">Tomcat</a>、<a href="http://www.eclipse.org/jetty/">Jetty</a>等。</p>
</div>
<div class="paragraph">
<p>使用Tomcat的步骤如下：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>下载并解压缩最新的Tomcat zip文件（在Tomcat网站中选择&#8217;Core&#8217;发行版）。</p>
</li>
<li>
<p>将flowable-rest.war文件从解压的Flowable发行版的<em>wars</em>文件夹中复制到解压的Tomcat文件夹下的<em>webapps</em>文件夹下。</p>
</li>
<li>
<p>使用命令行，转到Tomcat文件夹下的<em>bin</em>文件夹。</p>
</li>
<li>
<p>执行'<em>./catalina run</em>'启动Tomcat服务器。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在服务启动过程中，会显示一些Flowable日志信息。在最后显示的一条类似'<em>INFO [main] org.apache.catalina.startup.Catalina.start Server startup in xyz ms</em>'的消息标志着服务器已经启动，可以接受请求。请注意默认情况下，使用H2内存数据库，这意味着数据在服务器重启后会丢失。</p>
</div>
<div class="paragraph">
<p>在下面的章节中，我们使用cURL展示各种REST调用。所有的REST调用默认都使用<em>基本认证</em>保护，所有的调用的用户都是 <em>rest-admin</em>，密码为&#8217;test'。</p>
</div>
<div class="paragraph">
<p>在启动后，通过执行下列命令验证应用运行正常：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl --user rest-admin:test http://localhost:8080/flowable-rest/service/management/engine</pre>
</div>
</div>
<div class="paragraph">
<p>如果能获得正确的json响应，则说明REST API已经启动并在工作。</p>
</div>
</div>
<div class="sect3">
<h4 id="_deploying_a_process_definition_2">2.4.2. 部署流程定义</h4>
<div class="paragraph">
<p>第一步是部署一个流程定义。使用REST API时，需要将一个.bpmn20.xml文件（或对于多个流程引擎，一个.zip文件）作为&#8217;multipart/formdata&#8217;上传：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl --user rest-admin:test -F "file=@holiday-request.bpmn20.xml" http://localhost:8080/flowable-rest/service/repository/deployments</pre>
</div>
</div>
<div class="paragraph">
<p>要验证流程定义已经正确部署，可以请求流程定义的列表：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl --user rest-admin:test http://localhost:8080/flowable-rest/service/repository/process-definitions</pre>
</div>
</div>
<div class="paragraph">
<p>这将返回当前引擎中部署的所有流程定义的列表。</p>
</div>
</div>
<div class="sect3">
<h4 id="_start_a_process_instance">2.4.3. 启动流程实例</h4>
<div class="paragraph">
<p>使用REST API启动一个流程实例与使用Java API很像：提供<em>key</em>作为流程定义的标识，并使用一个map作为初始化流程变量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl --user rest-admin:test -H "Content-Type: application/json" -X POST -d '{ "processDefinitionKey":"holidayRequest", "variables": [ { "name":"employee", "value": "John Doe" }, { "name":"nrOfHolidays", "value": 7 }]}' http://localhost:8080/flowable-rest/service/runtime/process-instances</pre>
</div>
</div>
<div class="paragraph">
<p>将返回：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"id":"43","url":"http://localhost:8080/flowable-rest/service/runtime/process-instances/43","businessKey":null,"suspended":false,"ended":false,"processDefinitionId":"holidayRequest:1:42","processDefinitionUrl":"http://localhost:8080/flowable-rest/service/repository/process-definitions/holidayRequest:1:42","activityId":null,"variables":[],"tenantId":"","completed":false}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_task_list_and_completing_a_task">2.4.4. 任务列表与完成任务</h4>
<div class="paragraph">
<p>当流程实例启动后，第一个任务会指派给&#8217;managers&#8217;组。要获取这个组的所有任务，可以通过REST API进行任务查询：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl --user rest-admin:test -H "Content-Type: application/json" -X POST -d '{ "candidateGroup" : "managers" }' http://localhost:8080/flowable-rest/service/query/tasks</pre>
</div>
</div>
<div class="paragraph">
<p>这将返回&#8217;manager&#8217;组的所有任务的列表。</p>
</div>
<div class="paragraph">
<p>可以这样完成任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl --user rest-admin:test -H "Content-Type: application/json" -X POST -d '{ "action" : "complete", "variables" : [ { "name" : "approved", "value" : true} ]  }' http://localhost:8080/flowable-rest/service/runtime/tasks/25</pre>
</div>
</div>
<div class="paragraph">
<p>然而，很可能会产生如下的错误：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"message":"Internal server error","exception":"couldn't instantiate class org.flowable.CallExternalSystemDelegate"}</pre>
</div>
</div>
<div class="paragraph">
<p>这意味着引擎无法找到服务任务引用的<em>CallExternalSystemDelegate</em>类。要解决这个错误，需要将该类放在应用的classpath下（并需要重启应用）。按照<a href="#getting.started.delegate">上一章节</a>的介绍创建该类，并将其打包为JAR，放在Tomcat的<em>webapps</em>目录下的flowable-rest目录下的<em>WEB-INF/lib</em>目录下。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">3. 配置</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="configuration">3.1. 创建ProcessEngine</h3>
<div class="paragraph">
<p>Flowable流程引擎通过名为<code>flowable.cfg.xml</code>的XML文件进行配置。请注意这种方式与<a href="#springintegration">使用Spring创建流程引擎</a><strong>不</strong>一样。</p>
</div>
<div class="paragraph">
<p>获取<code>ProcessEngine</code>，最简单的方式是使用<code>org.flowable.engine.ProcessEngines</code>类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">ProcessEngine</span> <span class="tok-n">processEngine</span> <span class="tok-o">=</span> <span class="tok-n">ProcessEngines</span><span class="tok-o">.</span><span class="tok-na">getDefaultProcessEngine</span><span class="tok-o">()</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样会从classpath寻找<code>flowable.cfg.xml</code>，并用这个文件中的配置构造引擎。下面的代码展示了一个配置的例子。后续章节会对配置参数进行详细介绍。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUrl&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcDriver&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.h2.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUsername&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sa&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcPassword&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;asyncExecutorActivate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;mailServerHost&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;mail.my-corp.com&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;mailServerPort&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;5025&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意这个配置XML文件实际上是一个Spring配置文件。<strong>但这并不意味着Flowable只能用于Spring环境！</strong>我们只是利用Spring内部的解析与依赖注入功能来简化引擎的构建过程。</p>
</div>
<div class="paragraph">
<p>也可以通过编程方式使用配置文件，来构造ProcessEngineConfiguration对象。也可以使用不同的bean id(例如第3行)。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-n">ProcessEngineConfiguration</span><span class="tok-o">.</span>
  <span class="tok-nf">createProcessEngineConfigurationFromResourceDefault</span><span class="tok-o">();</span>
  <span class="tok-n">createProcessEngineConfigurationFromResource</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">resource</span><span class="tok-o">);</span>
  <span class="tok-n">createProcessEngineConfigurationFromResource</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">resource</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">beanName</span><span class="tok-o">);</span>
  <span class="tok-n">createProcessEngineConfigurationFromInputStream</span><span class="tok-o">(</span><span class="tok-n">InputStream</span> <span class="tok-n">inputStream</span><span class="tok-o">);</span>
  <span class="tok-n">createProcessEngineConfigurationFromInputStream</span><span class="tok-o">(</span><span class="tok-n">InputStream</span> <span class="tok-n">inputStream</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">beanName</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以不使用配置文件，使用默认配置（参考<a href="#configurationClasses">不同的支持类</a>获得更多信息）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">ProcessEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneProcessEngineConfiguration</span><span class="tok-o">();</span>
<span class="tok-n">ProcessEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneInMemProcessEngineConfiguration</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>所有的<code>ProcessEngineConfiguration.createXXX()</code>方法都返回<code>ProcessEngineConfiguration</code>，并可以继续按需调整。调用<code>buildProcessEngine()</code>后，生成一个<code>ProcessEngine</code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">ProcessEngine</span> <span class="tok-n">processEngine</span> <span class="tok-o">=</span> <span class="tok-n">ProcessEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneInMemProcessEngineConfiguration</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">setDatabaseSchemaUpdate</span><span class="tok-o">(</span><span class="tok-n">ProcessEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">DB_SCHEMA_UPDATE_FALSE</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">setJdbcUrl</span><span class="tok-o">(</span><span class="tok-s">&quot;jdbc:h2:mem:my-own-db;DB_CLOSE_DELAY=1000&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">setAsyncExecutorActivate</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">buildProcessEngine</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configurationRoot">3.2. ProcessEngineConfiguration bean</h3>
<div class="paragraph">
<p><code>flowable.cfg.xml</code>文件中必须包含一个id为'processEngineConfiguration'的bean。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span> <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这个bean用于构建<code>ProcessEngine</code>。有多个类可以用于定义<code>processEngineConfiguration</code>。这些类用于不同的环境，并各自设置一些默认值。最佳实践是选择最匹配你环境的类，以便减少配置引擎需要的参数。目前可以使用的类为：<a id="configurationClasses"></a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration</strong>：流程引擎独立运行。Flowable自行处理事务。在默认情况下，数据库检查只在引擎启动时进行（如果Flowable表结构不存在或表结构版本不对，会抛出异常）。</p>
</li>
<li>
<p><strong>org.flowable.engine.impl.cfg.StandaloneInMemProcessEngineConfiguration</strong>：这是一个便于使用单元测试的类。Flowable自行处理事务。默认使用H2内存数据库。数据库会在引擎启动时创建，并在引擎关闭时删除。使用这个类时，很可能不需要更多的配置（除了使用任务执行器或邮件等功能时）。</p>
</li>
<li>
<p><strong>org.flowable.spring.SpringProcessEngineConfiguration</strong>：在流程引擎处于Spring环境时使用。查看<a href="#springintegration">Spring集成</a>章节了解更多信息。</p>
</li>
<li>
<p><strong>org.flowable.engine.impl.cfg.JtaProcessEngineConfiguration</strong>：用于引擎独立运行，并使用JTA事务的情况。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="databaseConfiguration">3.3. 配置数据库</h3>
<div class="paragraph">
<p>有两种方式配置Flowable引擎使用的数据库。第一种方式是定义数据库的JDBC参数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>jdbcUrl</strong>: 数据库的JDBC URL。</p>
</li>
<li>
<p><strong>jdbcDriver</strong>: 对应数据库类型的驱动。</p>
</li>
<li>
<p><strong>jdbcUsername</strong>: 用于连接数据库的用户名。</p>
</li>
<li>
<p><strong>jdbcPassword</strong>: 用于连接数据库的密码。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>通过提供的JDBC参数构造的数据源，使用默认的<a href="http://www.mybatis.org/">MyBatis</a>连接池设置。可用下列属性调整这个连接池（来自MyBatis文档）：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>jdbcMaxActiveConnections</strong>: 连接池能够容纳的最大活动连接数量。默认值为10.</p>
</li>
<li>
<p><strong>jdbcMaxIdleConnections</strong>: 连接池能够容纳的最大空闲连接数量。</p>
</li>
<li>
<p><strong>jdbcMaxCheckoutTime</strong>: 连接从连接池“取出”后，被强制返回前的最大时间间隔，单位为毫秒。默认值为20000（20秒）。</p>
</li>
<li>
<p><strong>jdbcMaxWaitTime</strong>: 这是一个底层设置，在连接池获取连接的时间异常长时，打印日志并尝试重新获取连接（避免连接池配置错误，导致没有异常提示）。默认值为20000（20秒）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>数据库配置示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUrl&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcDriver&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.h2.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUsername&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sa&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcPassword&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>我们的跑分显示MyBatis连接池在处理大量并发请求时，并不是最经济或最具弹性的。因此，建议使用<code>javax.sql.DataSource</code>的实现，并将其注入到流程引擎配置中（如Hikari、Tomcat JDBC连接池，等等）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;driverClassName&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;com.mysql.jdbc.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;url&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:mysql://localhost:3306/flowable&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;username&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;flowable&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;flowable&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;defaultAutoCommit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-nt">/&gt;</span>
  ...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意Flowable发布时不包括用于定义数据源的库。需要自行把库放在classpath中。</p>
</div>
<div class="paragraph">
<p>无论使用JDBC还是数据源方式配置，都可以使用下列参数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>databaseType</strong>: 通常不需要专门设置这个参数，因为它可以从数据库连接信息中自动检测得出。只有在自动检测失败时才需要设置。可用值：{h2, mysql, oracle, postgres, mssql, db2}。这个选项会决定创建、删除与查询时使用的脚本。查看<a href="#supporteddatabases">“支持的数据库”</a>章节了解我们支持哪些类型的数据库。</p>
</li>
<li>
<p><strong>databaseSchemaUpdate</strong>: 用于设置流程引擎启动关闭时使用的数据库表结构控制策略。</p>
<div class="ulist">
<ul>
<li>
<p><code>false</code> (默认): 当引擎启动时，检查数据库表结构的版本是否匹配库文件版本。版本不匹配时抛出异常。</p>
</li>
<li>
<p><code>true</code>: 构建引擎时，检查并在需要时更新表结构。表结构不存在则会创建。</p>
</li>
<li>
<p><code>create-drop</code>: 引擎创建时创建表结构，并在引擎关闭时删除表结构。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="jndiDatasourceConfig">3.4. 配置JNDI数据源</h3>
<div class="paragraph">
<p>默认情况下，Flowable的数据库配置保存在每个web应用WEB-INF/classes文件夹下的db.properties文件中。有时这样并不合适，因为这需要用户修改Flowable源码中的db.properties文件并重新编译war包，或者在部署后解开war包并修改db.properties文件。</p>
</div>
<div class="paragraph">
<p>通过使用JNDI（Java Naming and Directory Interface，Java命名和目录接口）获取数据库连接，连接就完全交由Servlet容器管理，并可以在WAR部署之外管理配置。同时也提供了比db.properties中更多的控制连接的参数。</p>
</div>
<div class="sect3">
<h4 id="jndi_configuration">3.4.1. 配置</h4>
<div class="paragraph">
<p>根据你使用的servlet容器应用不同，配置JNDI数据源的方式也不同。下面的介绍用于Tomcat，对于其他容器应用，请参考对应的文档。</p>
</div>
<div class="paragraph">
<p>Tomcat的JNDI资源配置在$CATALINA_BASE/conf/[enginename]/[hostname]/[warname].xml (对于Flowable UI通常会是$CATALINA_BASE/conf/Catalina/localhost/flowable-app.xml)。当应用第一次部署时，默认会从Flowable war包中复制context.xml。所以如果存在这个文件则需要替换。例如，如果需要将JNDI资源修改为应用连接MySQL而不是H2，需要如下修改：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
    <span class="tok-nt">&lt;Context</span> <span class="tok-na">antiJARLocking=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">path=</span><span class="tok-s">&quot;/flowable-app&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;Resource</span> <span class="tok-na">auth=</span><span class="tok-s">&quot;Container&quot;</span>
            <span class="tok-na">name=</span><span class="tok-s">&quot;jdbc/flowableDB&quot;</span>
            <span class="tok-na">type=</span><span class="tok-s">&quot;javax.sql.DataSource&quot;</span>
            <span class="tok-na">description=</span><span class="tok-s">&quot;JDBC DataSource&quot;</span>
            <span class="tok-na">url=</span><span class="tok-s">&quot;jdbc:mysql://localhost:3306/flowable&quot;</span>
            <span class="tok-na">driverClassName=</span><span class="tok-s">&quot;com.mysql.jdbc.Driver&quot;</span>
            <span class="tok-na">username=</span><span class="tok-s">&quot;sa&quot;</span>
            <span class="tok-na">password=</span><span class="tok-s">&quot;&quot;</span>
            <span class="tok-na">defaultAutoCommit=</span><span class="tok-s">&quot;false&quot;</span>
            <span class="tok-na">initialSize=</span><span class="tok-s">&quot;5&quot;</span>
            <span class="tok-na">maxWait=</span><span class="tok-s">&quot;5000&quot;</span>
            <span class="tok-na">maxActive=</span><span class="tok-s">&quot;120&quot;</span>
            <span class="tok-na">maxIdle=</span><span class="tok-s">&quot;5&quot;</span><span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;/Context&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jndi_properties">3.4.2. JNDI参数</h4>
<div class="paragraph">
<p>在Flowable UI的配置文件中使用下列参数配置JNDI数据源：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>spring.datasource.jndi-name=: 数据源的JNDI名</p>
</li>
<li>
<p>datasource.jndi.resourceRef: 设置是否在J2EE容器中查找。也就是说，如果JNDI名中没有包含"java:comp/env/"前缀，是否需要添加它。默认为"true"。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="supporteddatabases">3.5. 支持的数据库</h3>
<div class="paragraph">
<p>下面列出Flowable用于引用数据库的类型（区分大小写！）。</p>
</div>
<table id="databaseTypes" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flowable数据库类型</th>
<th class="tableblock halign-left valign-top">示例JDBC URL</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">h2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:h2:tcp://localhost/flowable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认配置的数据库</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mysql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:mysql://localhost:3306/flowable?autoReconnect=true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">已使用mysql-connector-java数据库驱动测试</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">oracle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:oracle:thin:@localhost:1521:xe</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">postgres</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:postgresql://localhost:5432/flowable</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">db2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:db2://localhost:50000/flowable</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mssql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:sqlserver://localhost:1433;databaseName=flowable (jdbc.driver=com.microsoft.sqlserver.jdbc.SQLServerDriver) <em>OR</em> jdbc:jtds:sqlserver://localhost:1433/flowable (jdbc.driver=net.sourceforge.jtds.jdbc.Driver)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">已使用Microsoft JDBC Driver 4.0 (sqljdbc4.jar)与JTDS Driver测试</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="creatingDatabaseTable">3.6. 创建数据库表</h3>
<div class="paragraph">
<p>在你的数据库中创建数据库表，最简单的方法是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在classpath中添加flowable-engine JAR</p>
</li>
<li>
<p>添加合适的数据库驱动</p>
</li>
<li>
<p>在classpath中添加Flowable配置文件(<em>flowable.cfg.xml</em>)，指向你的数据库(参考<a href="#databaseConfiguration">数据库配置</a>)</p>
</li>
<li>
<p>执行<em>DbSchemaCreate</em>类的main方法</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>然而，通常只有数据库管理员可以在数据库中执行DDL语句，在生产环境中这也是最明智的选择。DDL的SQL脚本可以在Flowable下载页面或Flowable发布文件夹中找到，位于<code>database</code>子文件夹。引擎JAR (<em>flowable-engine-x.jar</em>)的<em>org/flowable/db/create</em>包中也有一份(<em>drop</em>文件夹存放删除脚本)。SQL文件的格式为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>flowable.{db}.{create|drop}.{type}.sql</pre>
</div>
</div>
<div class="paragraph">
<p>其中<em>db</em>为<a href="#supporteddatabases">支持的数据库</a>，而<em>type</em>为：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>engine:</strong> 引擎执行所需的表，必需。</p>
</li>
<li>
<p><strong>history:</strong> 存储历史与审计信息的表。当历史级别设置为<em>none</em>时不需要。请注意不使用这些表会导致部分使用历史数据的功能失效（如任务备注）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>MySQL用户请注意：</strong>低于5.6.4的MySQL版本不支持timestamps或包含毫秒精度的日期。更糟的是部分版本会在创建类似的列时抛出异常，而另一些版本则不会。当使用自动创建/升级时，引擎在执行时会自动修改DDL语句。当使用DDL文件方式建表时，可以使用通用版本，或使用文件名包含<em>mysql55</em>的特殊版本（用于5.6.4以下的任何版本）。特殊版本的文件中不会使用毫秒精度的列类型。</p>
</div>
<div class="paragraph">
<p>具体地说，对于MySQL的版本：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>&lt;5.6:</strong> 不支持毫秒精度。可以使用DDL文件（使用包含<em>mysql55</em>的文件）。可以使用自动创建/升级。</p>
</li>
<li>
<p><strong>5.6.0 - 5.6.3:</strong> 不支持毫秒精度。<strong>不</strong>可以使用自动创建/升级。建议升级为较新版本的数据库。如果确实需要，可以使用包含<em>mysql55</em>的DDL文件。</p>
</li>
<li>
<p><strong>5.6.4+:</strong> 支持毫秒精度。可以使用DDL文件（默认的包含<em>mysql</em>的文件）。可以使用自动创建/升级。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意如果在Flowable表已经创建/升级后，再升级MySQL数据库，则需要手工修改列类型！</p>
</div>
</div>
<div class="sect2">
<h3 id="database.tables.explained">3.7. 数据库表名说明</h3>
<div class="paragraph">
<p>Flowable的所有数据库表都以<strong>ACT_</strong>开头。第二部分是说明表用途的两字符标示符。服务API的命名也大略符合这个规则。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ACT_RE_</strong>*: 'RE&#8217;代表<code>repository</code>。带有这个前缀的表包含“静态”信息，例如流程定义与流程资源（图片、规则等）。</p>
</li>
<li>
<p><strong>ACT_RU_</strong>*: 'RU&#8217;代表<code>runtime</code>。这些表存储运行时信息，例如流程实例（process instance）、用户任务（user task）、变量（variable）、作业（job）等。Flowable只在流程实例运行中保存运行时数据，并在流程实例结束时删除记录。这样保证运行时表小和快。</p>
</li>
<li>
<p><strong>ACT_HI_</strong>*: 'HI&#8217;代表<code>history</code>。这些表存储历史数据，例如已完成的流程实例、变量、任务等。</p>
</li>
<li>
<p><strong>ACT_GE_</strong>*: 通用数据。在多处使用。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="databaseUpgrade">3.8. 数据库升级</h3>
<div class="paragraph">
<p>在升级前，请确保你已经（使用数据库的备份功能）备份了数据库。</p>
</div>
<div class="paragraph">
<p>默认情况下，每次流程引擎创建时会进行版本检查，通常是在你的应用或者Flowable web应用启动的时候。如果Flowable发现库版本与Flowable数据库表版本不同，会抛出异常。</p>
</div>
<div class="paragraph">
<p>要进行升级，首先需要将下列配置参数放入你的flowable.cfg.xml配置文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans</span> <span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span>
      <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-c">&lt;!-- ... --&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-c">&lt;!-- ... --&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>同时，在classpath中加上合适的数据库驱动。</strong>升级应用中的Flowable库，或者启动一个新版本的Flowable，并将它指向包含旧版本数据的数据库。将<code>databaseSchemaUpdate</code>设置为<code>true</code>。当Flowable发现库与数据库表结构不一致时，会自动将数据库表结构升级至新版本。</p>
</div>
<div class="paragraph">
<p><strong>也可以直接运行升级DDL语句。</strong>也可以从Flowable下载页面获取升级数据库脚本并运行。</p>
</div>
</div>
<div class="sect2">
<h3 id="jobExecutorConfiguration">3.9. 作业执行器（从6.0.1版本起）</h3>
<div class="paragraph">
<p>在Flowable V6中唯一可用的作业执行器，是Flowable V5中的异步执行器(async executor)。因为它为Flowable引擎提供了性能更好，对数据库也更友好的执行异步作业的方式。
Flowable V5中的作业执行器(job executor)在V6中不再可用。可以在用户手册的高级章节找到更多信息。</p>
</div>
<div class="paragraph">
<p>此外，如果在Java EE 7下运行，容器还可以使用符合JSR-236标准的<code>ManagedAsyncJobExecutor</code>来管理线程。要启用这个功能，需要在配置中如下加入线程工厂：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;threadFactory&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.springframework.jndi.JndiObjectFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
   <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jndiName&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;java:jboss/ee/concurrency/factory/default&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;customJobExecutor&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.jobexecutor.ManagedAsyncJobExecutor&quot;</span><span class="tok-nt">&gt;</span>
   <span class="tok-c">&lt;!-- ... --&gt;</span>
   <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;threadFactory&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;threadFactory&quot;</span> <span class="tok-nt">/&gt;</span>
   <span class="tok-c">&lt;!-- ... --&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果没有设置线程工厂，ManagedAsyncJobExecutor实现会退化为默认实现（AsyncJobExecutor）。</p>
</div>
</div>
<div class="sect2">
<h3 id="_job_executor_activation">3.10. 启用作业执行器</h3>
<div class="paragraph">
<p><code>AsyncExecutor</code>是管理线程池的组件，用于触发定时器与其他异步任务。也可以使用其他实现（如使用消息队列，参见用户手册的高级章节）。</p>
</div>
<div class="paragraph">
<p>默认情况下，<code>AsyncExecutor</code>并未启用，也不会启动。如下配置使异步执行器与Flowable引擎一同启动：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;asyncExecutorActivate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>asyncExecutorActivate这个参数使Flowable引擎在启动同时启动异步执行器。</p>
</div>
</div>
<div class="sect2">
<h3 id="mailServerConfiguration">3.11. 配置邮件服务器</h3>
<div class="paragraph">
<p>配置邮件服务器是可选的。Flowable支持在业务流程中发送电子邮件。发送电子邮件需要配置有效的SMTP邮件服务器。查看<a href="#bpmnEmailTaskServerConfiguration">电子邮件任务</a>了解配置选项。</p>
</div>
</div>
<div class="sect2">
<h3 id="historyConfiguration">3.12. 配置历史</h3>
<div class="paragraph">
<p>历史存储的配置是可选的。你可以通过调整配置控制<a href="#history">历史功能</a>。查看<a href="#historyConfig">配置历史</a>章节了解更多细节。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;history&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;audit&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="asyncHistoryConfiguration">3.13. 配置异步历史</h3>
<div class="paragraph">
<p>[实验性] 从Flowable 6.1.0起，添加了异步历史功能。当启用异步历史时，历史数据将由历史任务执行器负责持久化，而不是与运行时执行持久化同步保存。
查看<a href="#asyncHistoryConfig">配置异步历史</a>章节了解更多细节。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;asyncHistoryEnabled&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="exposingConfigurationBeans">3.14. 配置在表达式与脚本中可用的bean</h3>
<div class="paragraph">
<p>默认情况下，所有通过<code>flowable.cfg.xml</code>或你自己的Spring配置文件声明的bean，都可以在表达式与脚本中使用。如果你希望限制配置文件中bean的可见性，可以使用流程引擎配置的<code>beans</code>参数。<code>ProcessEngineConfiguration</code>中的<code>beans</code>参数是一个map。当你配置这个参数时，只有在这个map中声明的bean可以在表达式与脚本中使用。bean会使用你在map中指定的名字暴露。</p>
</div>
</div>
<div class="sect2">
<h3 id="processDefinitionCacheConfiguration">3.15. 配置部署缓存</h3>
<div class="paragraph">
<p>鉴于流程定义信息不会改变，为了避免每次使用流程定义时都读取数据库，所有的流程定义都会（在解析后）被缓存。默认情况下，这个缓存没有限制。要限制流程定义缓存，加上如下的参数</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;processDefinitionCacheLimit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;10&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>设置这个参数，会将默认的hashmap缓存替换为LRU缓存，以进行限制。当然，参数的“最佳”取值，取决于总的流程定义数量，以及实际使用的流程定义数量。</p>
</div>
<div class="paragraph">
<p>也可以注入自己的缓存实现。必须是一个实现了<code>org.flowable.engine.impl.persistence.deploy.DeploymentCache</code>接口的bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;processDefinitionCache&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.MyCache&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/property&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>类似的，可以使用名为<code>knowledgeBaseCacheLimit</code>与<code>knowledgeBaseCache</code>的参数配置规则缓存(rules cache)。只有在流程中使用规则任务(rules task)时才需要设置。</p>
</div>
</div>
<div class="sect2">
<h3 id="loggingConfiguration">3.16. 日志</h3>
<div class="paragraph">
<p>所有的日志（Flowable、Spring、MyBatis等）都通过SLF4J路由，并允许你自行选择日志实现。</p>
</div>
<div class="paragraph">
<p><strong>默认情况下，Flowable引擎依赖中不提供SFL4J绑定JAR。你需要自行将其加入你的项目，以便使用所选的日志框架。</strong>如果没有加入实现JAR，SLF4J会使用NOP-logger。这时除了一条警告外，不会记录任何日志。可以从<a href="http://www.slf4j.org/codes.html#StaticLoggerBinder"><a href="http://www.slf4j.org/codes.html#StaticLoggerBinder" class="bare">http://www.slf4j.org/codes.html#StaticLoggerBinder</a></a>了解关于绑定的更多信息。</p>
</div>
<div class="paragraph">
<p>可以像这样（这里使用Log4j）使用Maven添加依赖，请注意你还需要加上版本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.slf4j<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>slf4j-log4j12<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Flowable-UI与Flowable-rest web应用配置为使用Log4j绑定。运行所有flowable-*模块的测试时也会使用Log4j。</p>
</div>
<div class="paragraph">
<p><strong>重要提示：当使用classpath中带有commons-logging的容器时：</strong>为了将spring的日志路由至SLF4j，需要使用桥接（参考<a href="http://www.slf4j.org/legacy.html#jclOverSLF4J"><a href="http://www.slf4j.org/legacy.html#jclOverSLF4J" class="bare">http://www.slf4j.org/legacy.html#jclOverSLF4J</a></a>）。如果你的容器提供了commons-logging实现，请按照<a href="http://www.slf4j.org/codes.html#release"><a href="http://www.slf4j.org/codes.html#release" class="bare">http://www.slf4j.org/codes.html#release</a></a>页面的指示调整。</p>
</div>
<div class="paragraph">
<p>使用Maven的示例（省略了版本）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.slf4j<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>jcl-over-slf4j<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="MDC">3.17. 映射诊断上下文</h3>
<div class="paragraph">
<p>Flowable支持SLF4J的映射诊断上下文特性。下列基本信息会与需要日志记录的信息一起，传递给底层日志实现：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>processDefinition Id 作为 mdcProcessDefinitionID</p>
</li>
<li>
<p>processInstance Id 作为 mdcProcessInstanceID</p>
</li>
<li>
<p>execution Id 作为 mdcExecutionId</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>默认情况下这些信息都不会被日志记录，但可以通过配置logger，按照你想要的格式，与其他日志信息一起显示。例如在Log4j中进行如下简单的格式定义，就可以让logger显示上述信息：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="properties"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-na">log4j.appender.consoleAppender.layout.ConversionPattern</span><span class="tok-o">=</span><span class="tok-s">ProcessDefinitionId=%X{mdcProcessDefinitionID}</span>
<span class="tok-na">executionId</span><span class="tok-o">=</span><span class="tok-s">%X{mdcExecutionId} mdcProcessInstanceID=%X{mdcProcessInstanceID} mdcBusinessKey=%X{mdcBusinessKey} %m%n</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果需要使用日志中包含的信息进行实时监测（如使用日志分析器），就会很有帮助。</p>
</div>
</div>
<div class="sect2">
<h3 id="eventDispatcher">3.18. 事件处理器</h3>
<div class="paragraph">
<p>Flowable引擎中的事件机制可以让你在引擎中发生多种事件的时候得到通知。查看<a href="#eventDispatcherEventTypes">所有支持的事件类型</a>了解可用的事件。</p>
</div>
<div class="paragraph">
<p>可以只为特定种类的事件注册监听器，而不是在任何类型的事件发送时都被通知。可以<a href="#eventDispatcherConfiguration">通过配置</a>添加引擎全局的事件监听器，<a href="#eventDispatcherConfigurationRuntime">在运行时通过API</a>添加引擎全局的事件监听器，也可以<a href="#eventDispatcherConfigurationProcessDefinition">在BPMN XML文件为个别流程定义</a>添加事件监听器。</p>
</div>
<div class="paragraph">
<p>所有被分发的事件都是<code>org.flowable.engine.common.api.delegate.event.FlowableEvent</code>的子类。事件（在可用时）提供<code>type</code>, <code>executionId</code>, <code>processInstanceId</code>与<code>processDefinitionId</code>。部分事件含有关于发生事件的上下文信息。关于事件包含的附加信息，请参阅<a href="#eventDispatcherEventTypes">所有支持的事件类型</a>。</p>
</div>
<div class="sect3">
<h4 id="eventDispatcherListener">3.18.1. 实现事件监听器</h4>
<div class="paragraph">
<p>对事件监听器的唯一要求，是要实现<code>org.flowable.engine.delegate.event.FlowableEventListener</code>接口。下面是一个监听器实现的例子，它将接收的所有事件打印至标准输出，并对作业执行相关的事件特别处理：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyEventListener</span> <span class="tok-kd">implements</span> <span class="tok-n">FlowableEventListener</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onEvent</span><span class="tok-o">(</span><span class="tok-n">FlowableEvent</span> <span class="tok-n">event</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">switch</span> <span class="tok-o">(</span><span class="tok-n">event</span><span class="tok-o">.</span><span class="tok-na">getType</span><span class="tok-o">())</span> <span class="tok-o">{</span>

      <span class="tok-k">case</span> <span class="tok-n">JOB_EXECUTION_SUCCESS</span><span class="tok-o">:</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;A job well done!&quot;</span><span class="tok-o">);</span>
        <span class="tok-k">break</span><span class="tok-o">;</span>

      <span class="tok-k">case</span> <span class="tok-n">JOB_EXECUTION_FAILURE</span><span class="tok-o">:</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;A job has failed...&quot;</span><span class="tok-o">);</span>
        <span class="tok-k">break</span><span class="tok-o">;</span>

<span class="tok-nl">      default:</span>
        <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Event received: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">event</span><span class="tok-o">.</span><span class="tok-na">getType</span><span class="tok-o">());</span>
    <span class="tok-o">}</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isFailOnException</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-c1">// onEvent方法中的逻辑并不重要，可以忽略日志失败异常……</span>

    <span class="tok-k">return</span> <span class="tok-kc">false</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>isFailOnException()</code>方法决定了当事件分发后，<code>onEvent(..)</code>方法抛出异常时的行为。若返回<code>false</code>，忽略异常；若返回<code>true</code>，异常不会被忽略而会被上抛，使当前执行的命令失败。如果事件是API调用（或其他事务操作，例如作业执行）的一部分，事务将被回滚。如果事件监听器中并不是重要的业务操作，建议返回<code>false</code>。</p>
</div>
<div class="paragraph">
<p>Flowable提供了少量基础实现，以简化常用的事件监听器使用场景。它们可以被用作监听器的示例或基类：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>org.flowable.engine.delegate.event.BaseEntityEventListener</strong>: 事件监听器基类，可用来监听实体（entity）相关事件，特定或所有实体的事件都可以。它隐藏了类型检测，提供了4个需要覆盖的方法：<code>onCreate(..)</code>, <code>onUpdate(..)</code>与<code>onDelete(..)</code>在实体创建、更新及删除时调用；对所有其他实体相关事件，<code>onEntityEvent(..)</code>会被调用。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="eventDispatcherConfiguration">3.18.2. 配置与使用</h4>
<div class="paragraph">
<p>在流程引擎中配置的事件监听器会在流程引擎启动时生效，引擎重启后也会保持有效。</p>
</div>
<div class="paragraph">
<p><code>eventListeners</code>参数为<code>org.flowable.engine.delegate.event.FlowableEventListener</code>类实例的列表(list)。与其他地方一样，你可以声明内联bean定义，也可以用<code>ref</code>指向已有的bean。下面的代码片段在配置中添加了一个事件监听器，无论任何类型的事件分发时，都会得到通知：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span>
    <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    ...
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;eventListeners&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;list&gt;</span>
         <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.example.MyEventListener&quot;</span> <span class="tok-nt">/&gt;</span>
      <span class="tok-nt">&lt;/list&gt;</span>
    <span class="tok-nt">&lt;/property&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>要在特定类型的事件分发时得到通知，使用<code>typedEventListeners</code>参数，值为map。map的key为逗号分隔的事件名字列表（或者一个事件的名字），取值为<code>org.flowable.engine.delegate.event.FlowableEventListener</code>实例的列表。下面的代码片段在配置中添加了一个事件监听器，它会在作业执行成功或失败时得到通知：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span>
    <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    ...
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;typedEventListeners&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;map&gt;</span>
        <span class="tok-nt">&lt;entry</span> <span class="tok-na">key=</span><span class="tok-s">&quot;JOB_EXECUTION_SUCCESS,JOB_EXECUTION_FAILURE&quot;</span> <span class="tok-nt">&gt;</span>
          <span class="tok-nt">&lt;list&gt;</span>
            <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.example.MyJobEventListener&quot;</span> <span class="tok-nt">/&gt;</span>
          <span class="tok-nt">&lt;/list&gt;</span>
        <span class="tok-nt">&lt;/entry&gt;</span>
      <span class="tok-nt">&lt;/map&gt;</span>
    <span class="tok-nt">&lt;/property&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>事件分发的顺序由加入监听器的顺序决定。首先，所有普通(<code>eventListeners</code>参数定义的)事件监听器按照在<code>list</code>里的顺序被调用；之后，如果分发的是某类型的事件，则(<code>typedEventListeners</code> 参数定义的)该类型监听器被调用。</p>
</div>
</div>
<div class="sect3">
<h4 id="eventDispatcherConfigurationRuntime">3.18.3. 在运行时添加监听器</h4>
<div class="paragraph">
<p>可以使用API(<code>RuntimeService</code>)为引擎添加或删除事件监听器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</div></td><td class="code"><span></span>
<span class="tok-cm">/**</span>
<span class="tok-cm"> * 新增一个监听器，会在所有事件发生时被通知。</span>
<span class="tok-cm"> * @param listenerToAdd 要新增的监听器</span>
<span class="tok-cm"> */</span>
<span class="tok-kt">void</span> <span class="tok-nf">addEventListener</span><span class="tok-o">(</span><span class="tok-n">FlowableEventListener</span> <span class="tok-n">listenerToAdd</span><span class="tok-o">);</span>

<span class="tok-cm">/**</span>
<span class="tok-cm"> * 新增一个监听器，在给定类型的事件发生时被通知。</span>
<span class="tok-cm"> * @param listenerToAdd 要新增的监听器</span>
<span class="tok-cm"> * @param types 监听器需要监听的事件类型</span>
<span class="tok-cm"> */</span>
<span class="tok-kt">void</span> <span class="tok-nf">addEventListener</span><span class="tok-o">(</span><span class="tok-n">FlowableEventListener</span> <span class="tok-n">listenerToAdd</span><span class="tok-o">,</span> <span class="tok-n">FlowableEventType</span><span class="tok-o">...</span> <span class="tok-n">types</span><span class="tok-o">);</span>

<span class="tok-cm">/**</span>
<span class="tok-cm"> * 从分发器中移除指定监听器。该监听器将不再被通知，无论该监听器注册为监听何种类型。</span>
<span class="tok-cm"> * @param listenerToRemove 要移除的监听器</span>
<span class="tok-cm"> */</span>
 <span class="tok-kt">void</span> <span class="tok-nf">removeEventListener</span><span class="tok-o">(</span><span class="tok-n">FlowableEventListener</span> <span class="tok-n">listenerToRemove</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，运行时新增的监听器<strong>在引擎重启后不会保持。</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="eventDispatcherConfigurationProcessDefinition">3.18.4. 为流程定义增加监听器</h4>
<div class="paragraph">
<p>可以为某一流程定义增加监听器。只有与该流程定义相关，或使用该流程定义启动的流程实例相关的事件，才会调用这个监听器。监听器实现可以用完全限定类名（fully qualified classname）定义；也可以定义为表达式，该表达式需要能被解析为实现监听器接口的bean；也可以配置为抛出消息（message）/信号（signal）/错误（error）的BPMN事件。</p>
</div>
<div class="sect4">
<h5 id="_listeners_executing_user_defined_logic">执行用户定义逻辑的监听器</h5>
<div class="paragraph">
<p>下面的代码片段为流程定义增加了2个监听器。第一个监听器接收任何类型的事件，使用完全限定类名定义。第二个监听器只在作业成功执行或失败时被通知，使用流程引擎配置中<code>beans</code>参数定义的bean作为监听器。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;testEventListeners&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:eventListener</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.test.MyEventListener&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:eventListener</span> <span class="tok-na">delegateExpression=</span><span class="tok-s">&quot;${testEventListener}&quot;</span> <span class="tok-na">events=</span><span class="tok-s">&quot;JOB_EXECUTION_SUCCESS,JOB_EXECUTION_FAILURE&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>

  ...

<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>实体相关的事件也可以在流程定义中增加监听器，只有在特定实体类型的事件发生时得到通知。下面的代码片段展示了如何设置。可以响应实体的所有事件（第一个例子），或只响应实体的特定类型事件（第二个例子）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;testEventListeners&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:eventListener</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.test.MyEventListener&quot;</span> <span class="tok-na">entityType=</span><span class="tok-s">&quot;task&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:eventListener</span> <span class="tok-na">delegateExpression=</span><span class="tok-s">&quot;${testEventListener}&quot;</span> <span class="tok-na">events=</span><span class="tok-s">&quot;ENTITY_CREATED&quot;</span> <span class="tok-na">entityType=</span><span class="tok-s">&quot;task&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>

  ...

<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>entityType</code>可用的值有：<code>attachment</code>（附件）, <code>comment</code>（备注）, <code>execution</code>（执行）, <code>identity-link</code>（身份关联）, <code>job</code>（作业）, <code>process-instance</code>（流程实例）, <code>process-definition</code>（流程定义）, <code>task</code>（任务）。</p>
</div>
</div>
<div class="sect4">
<h5 id="_listeners_throwing_bpmn_events">抛出BPMN事件的监听器</h5>
<div class="paragraph">
<p>处理分发的事件的另一个方法，是抛出BPMN事件。请牢记在心，只有特定种类的Flowable事件类型，抛出BPMN事件才合理。例如，在流程实例被删除时抛出BPMN事件，会导致错误。下面的代码片段展示了如何在流程实例中抛出信号，向外部流程（全局）抛出信号，在流程实例中抛出消息事件，以及在流程实例中抛出错误事件。这里不使用<code>class</code>或<code>delegateExpression</code>，而要使用<code>throwEvent</code>属性，以及一个附加属性，用于指定需要抛出的事件类型。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;testEventListeners&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:eventListener</span> <span class="tok-na">throwEvent=</span><span class="tok-s">&quot;signal&quot;</span> <span class="tok-na">signalName=</span><span class="tok-s">&quot;My signal&quot;</span> <span class="tok-na">events=</span><span class="tok-s">&quot;TASK_ASSIGNED&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;testEventListeners&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:eventListener</span> <span class="tok-na">throwEvent=</span><span class="tok-s">&quot;globalSignal&quot;</span> <span class="tok-na">signalName=</span><span class="tok-s">&quot;My signal&quot;</span> <span class="tok-na">events=</span><span class="tok-s">&quot;TASK_ASSIGNED&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;testEventListeners&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:eventListener</span> <span class="tok-na">throwEvent=</span><span class="tok-s">&quot;message&quot;</span> <span class="tok-na">messageName=</span><span class="tok-s">&quot;My message&quot;</span> <span class="tok-na">events=</span><span class="tok-s">&quot;TASK_ASSIGNED&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;testEventListeners&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:eventListener</span> <span class="tok-na">throwEvent=</span><span class="tok-s">&quot;error&quot;</span> <span class="tok-na">errorCode=</span><span class="tok-s">&quot;123&quot;</span> <span class="tok-na">events=</span><span class="tok-s">&quot;TASK_ASSIGNED&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果需要使用额外的逻辑判断是否需要抛出BPMN事件，可以扩展Flowable提供的监听器类。通过在你的子类中覆盖<code>isValidEvent(FlowableEvent event)</code>，可以阻止抛出BPMN事件。相关的类为<code>org.flowable.engine.test.api.event.SignalThrowingEventListenerTest</code>, <code>org.flowable.engine.impl.bpmn.helper.MessageThrowingEventListener</code>与<code>org.flowable.engine.impl.bpmn.helper.ErrorThrowingEventListener</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_notes_on_listeners_on_a_process_definition">关于流程定义监听器的说明</h5>
<div class="ulist">
<ul>
<li>
<p>事件监听器只能作为<code>extensionElements</code>的子元素，声明在<code>process</code>元素上。不能在个别节点（activity）上定义（事件）监听器。</p>
</li>
<li>
<p><code>delegateExpression</code>中的表达式，与其他表达式（例如在网关中的）不一样，不可以访问执行上下文。只能够引用在流程引擎配置中<code>beans</code>参数定义的bean；或是在使用spring（且没有定义beans参数）时，引用任何实现了监听器接口的spring bean。</p>
</li>
<li>
<p>使用监听器的<code>class</code>属性时，只会创建唯一一个该类的实例。请确保监听器实现不依赖于成员变量，或确保多线程/上下文的使用安全。</p>
</li>
<li>
<p>如果<code>events</code>属性使用了不合法的事件类型，或者使用了不合法的<code>throwEvent</code>值，会在流程定义部署时抛出异常（导致部署失败）。如果<code>class</code>或<code>delegateExecution</code>指定了不合法的值（不存在的类，不存在的bean引用，或者代理类没有实现监听器接口），在流程启动（或该流程定义的第一个有效事件分发给这个监听器）时，会抛出异常。请确保引用的类在classpath中，并且保证表达式能够解析为有效的实例。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="eventDispatcherCustomEvents">3.18.5. 通过API分发事件</h4>
<div class="paragraph">
<p>可以通过API提供事件分发机制，向任何在引擎中注册的监听器分发自定义事件。建议（但不强制）只分发<code>CUSTOM</code>类型的<code>FlowableEvents</code>。使用<code>RuntimeService</code>分发事件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span>
<span class="tok-cm">/**</span>
<span class="tok-cm"> * 将给定事件分发给所有注册监听器。</span>
<span class="tok-cm"> * @param event 要分发的事件。</span>
<span class="tok-cm"> *</span>
<span class="tok-cm"> * @throws FlowableException 当分发事件发生异常，或者{@link FlowableEventDispatcher}被禁用。</span>
<span class="tok-cm"> * @throws FlowableIllegalArgumentException 当给定事件不可分发</span>
<span class="tok-cm"> */</span>
 <span class="tok-kt">void</span> <span class="tok-nf">dispatchEvent</span><span class="tok-o">(</span><span class="tok-n">FlowableEvent</span> <span class="tok-n">event</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="eventDispatcherEventTypes">3.18.6. 支持的事件类型</h4>
<div class="paragraph">
<p>下表列出引擎中的所有事件类型。每种类型对应<code>org.flowable.engine.common.api.delegate.event.FlowableEventType</code>中的一个枚举值。</p>
</div>
<table id="eventTypes" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Supported events</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">事件名称</th>
<th class="tableblock halign-left valign-top">说明</th>
<th class="tableblock halign-left valign-top">事件类</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENGINE_CREATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">本监听器所属的流程引擎已经创建，并可以响应API调用。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENGINE_CLOSED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">本监听器所属的流程引擎已经关闭，不能再对该引擎进行API调用。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENTITY_CREATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">新的实体已经创建。该实体包含在本事件里。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENTITY_INITIALIZED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">新的实体已经创建并完全初始化。如果任何子实体作为该实体的一部分被创建，本事件会在子实体创建/初始化后触发，与 <code>ENTITY_CREATE</code> 事件相反。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENTITY_UPDATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实体已经更新。该实体包含在本事件里。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENTITY_DELETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实体已经删除。该实体包含在本事件里。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENTITY_SUSPENDED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实体已经暂停。该实体包含在本事件里。ProcessDefinitions（流程定义）, ProcessInstances（流程实例）与Tasks（任务）会分发本事件。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENTITY_ACTIVATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实体已经激活。该实体包含在本事件里。ProcessDefinitions, ProcessInstances与Tasks会分发本事件。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JOB_EXECUTION_SUCCESS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">作业已经成功执行。该作业包含在本事件里。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JOB_EXECUTION_FAILURE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">作业执行失败。该作业与异常包含在本事件里。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code> 及 <code>org.flowable&#8230;&#8203;FlowableExceptionEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JOB_RETRIES_DECREMENTED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">作业重试次数已经由于执行失败而减少。该作业包含在本事件里。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIMER_SCHEDULED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">已创建一个定时作业，并预计在未来时间点执行。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIMER_FIRED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定时器已经触发。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JOB_CANCELED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">作业已经取消。该作业包含在本事件里。作业会由于API调用取消，任务完成导致关联的边界定时器取消，也会由于新流程定义的部署而取消。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_STARTED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">节点开始执行</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableActivityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_COMPLETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">节点成功完成</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableActivityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_CANCELLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">节点将要取消。节点的取消有三个原因（MessageEventSubscriptionEntity, SignalEventSubscriptionEntity, TimerEntity）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableActivityCancelledEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_SIGNALED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">节点收到了一个信号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableSignalEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_MESSAGE_RECEIVED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">节点收到了一个消息。事件在节点接收消息前分发。节点接收消息后，会为该节点分发 <code>ACTIVITY_SIGNAL</code> 或 <code>ACTIVITY_STARTED</code> 事件，取决于其类型（边界事件，或子流程启动事件）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableMessageEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_MESSAGE_WAITING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个节点已经创建了一个消息事件订阅，并正在等待接收消息。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableMessageEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_MESSAGE_CANCELLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个节点已经取消了一个消息事件订阅，因此接收这个消息不会再触发该节点。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableMessageEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_ERROR_RECEIVED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">节点收到了错误事件。在节点实际处理错误前分发。该事件的<code>activityId</code>为处理错误的节点。如果错误成功传递，后续会为节点发送 <code>ACTIVITY_SIGNALLED</code> 或 <code>ACTIVITY_COMPLETE</code> 消息。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableErrorEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNCAUGHT_BPMN_ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">抛出了未捕获的BPMN错误。流程没有该错误的处理器。该事件的<code>activityId</code>为空。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableErrorEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVITY_COMPENSATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">节点将要被补偿(compensate)。该事件包含将要执行补偿的节点id。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableActivityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULTI_INSTANCE_ACTIVITY_STARTED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">多实例节点开始执行</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableMultiInstanceActivityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULTI_INSTANCE_ACTIVITY_COMPLETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">多实例节点成功完成</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableMultiInstanceActivityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MULTI_INSTANCE_ACTIVITY_CANCELLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">多实例节点将要取消。多实例节点的取消有三个原因（MessageEventSubscriptionEntity, SignalEventSubscriptionEntity, TimerEntity）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableMultiInstanceActivityCancelledEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARIABLE_CREATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程变量已经创建。本事件包含变量名、取值，及关联的执行和任务（若有）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableVariableEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARIABLE_UPDATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">变量已经更新。本事件包含变量名、取值，及关联的执行和任务（若有）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableVariableEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VARIABLE_DELETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">变量已经删除。本事件包含变量名、最后取值，及关联的执行和任务（若有）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableVariableEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TASK_ASSIGNED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任务已经分派给了用户。该任务包含在本事件里。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TASK_CREATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任务已经创建。本事件在 <code>ENTITY_CREATE</code> 事件之后分发。若该任务是流程的一部分，本事件会在任务监听器执行前触发。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TASK_COMPLETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">任务已经完成。本事件在 <code>ENTITY_DELETE</code> 事件前分发。若该任务是流程的一部分，本事件会在流程前进之前触发，并且会跟随一个 <code>ACTIVITY_COMPLETE</code> 事件，指向代表该任务的节点。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PROCESS_CREATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程实例已经创建。已经设置所有的基础参数，但还未设置变量。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PROCESS_STARTED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程实例已经启动。在启动之前创建的流程时分发。PROCESS_STARTED事件在相关的ENTITY_INITIALIZED事件，以及设置变量之后分发。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PROCESS_COMPLETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程实例已经完成。在最后一个节点的 <code>ACTIVITY_COMPLETED </code> 事件后分发。当流程实例没有任何路径可以继续时，流程结束。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableEntityEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PROCESS_COMPLETED_WITH_TERMINATE_END_EVENT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程已经到达终止结束事件(terminate end event)并结束。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableProcessTerminatedEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PROCESS_CANCELLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程已经被取消。在流程实例从运行时中删除前分发。流程实例由API调用<code>RuntimeService.deleteProcessInstance</code>取消。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableCancelledEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MEMBERSHIP_CREATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用户已经加入组。本事件包含了相关的用户和组的id。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableMembershipEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MEMBERSHIP_DELETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用户已经从组中移出。本事件包含了相关的用户和组的id。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableMembershipEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MEMBERSHIPS_DELETED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">组的所有用户将被移出。本事件在用户移出前抛出，因此关联关系仍然可以访问。因为性能原因，不会再为每个被移出的用户抛出 <code>MEMBERSHIP_DELETED</code> 事件。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.flowable&#8230;&#8203;FlowableMembershipEvent</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>引擎中所有的 <code>ENTITY_\*</code> 事件都与实体关联。下表列出每个实体分发的实体事件：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>ENTITY_CREATED, ENTITY_INITIALIZED, ENTITY_DELETED</code></strong>: 附件(Attachment)，备注(Comment)，部署(Deployment)，执行(Execution)，组(Group)，身份关联(IdentityLink)，作业(Job)，模型(Model)，流程定义(ProcessDefinition)，流程实例(ProcessInstance)，任务(Task)，用户(User)。</p>
</li>
<li>
<p><strong><code>ENTITY_UPDATED</code></strong>: 附件，部署，执行，组，身份关联，作业，模型，流程定义，流程实例，任务，用户。</p>
</li>
<li>
<p><strong><code>ENTITY_SUSPENDED, ENTITY_ACTIVATED</code></strong>: 流程定义，流程实例/执行，任务。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="eventDispatcherRemarks">3.18.7. 附加信息</h4>
<div class="paragraph">
<p><strong>监听器只会响应其所在引擎分发的事件。</strong>因此如果在同一个数据库上运行不同的引擎，则只有该监听器注册的引擎生成的事件，才会分发给该监听器。其他引擎生成的事件不会分发给这个监听器，而不论这些引擎是否运行在同一个JVM下。</p>
</div>
<div class="paragraph">
<p>某些事件类型（与实体相关）暴露了目标实体。按照事件类型的不同，有些实体不能被更新（如实体删除事件中的实体）。如果可能的话，请使用事件暴露的<code>EngineServices</code>来安全地操作引擎。即使这样，更新、操作事件中暴露的实体仍然需要小心。</p>
</div>
<div class="paragraph">
<p>历史不会分发实体事件，因为它们都有对应的运行时实体分发事件。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chapterApi">4. Flowable API</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="apiEngine">4.1. 流程引擎API与服务</h3>
<div class="paragraph">
<p>引擎API是与Flowable交互的最常用手段。总入口点是<code>ProcessEngine</code>。像<a href="#configuration">配置</a>章节中介绍的一样，ProcessEngine可以使用多种方式创建。使用ProcessEngine，可以获得各种提供工作流/BPM方法的服务。ProcessEngine与服务对象都是线程安全的，因此可以在服务器中保存并共用同一个引用。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.services.png" alt="api.services">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-n">ProcessEngine</span> <span class="tok-n">processEngine</span> <span class="tok-o">=</span> <span class="tok-n">ProcessEngines</span><span class="tok-o">.</span><span class="tok-na">getDefaultProcessEngine</span><span class="tok-o">();</span>

<span class="tok-n">RuntimeService</span> <span class="tok-n">runtimeService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getRuntimeService</span><span class="tok-o">();</span>
<span class="tok-n">RepositoryService</span> <span class="tok-n">repositoryService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getRepositoryService</span><span class="tok-o">();</span>
<span class="tok-n">TaskService</span> <span class="tok-n">taskService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getTaskService</span><span class="tok-o">();</span>
<span class="tok-n">ManagementService</span> <span class="tok-n">managementService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getManagementService</span><span class="tok-o">();</span>
<span class="tok-n">IdentityService</span> <span class="tok-n">identityService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getIdentityService</span><span class="tok-o">();</span>
<span class="tok-n">HistoryService</span> <span class="tok-n">historyService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getHistoryService</span><span class="tok-o">();</span>
<span class="tok-n">FormService</span> <span class="tok-n">formService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getFormService</span><span class="tok-o">();</span>
<span class="tok-n">DynamicBpmnService</span> <span class="tok-n">dynamicBpmnService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getDynamicBpmnService</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在<code>ProcessEngines.getDefaultProcessEngine()</code>第一次被调用时，将初始化并构建流程引擎，之后的重复调用都会返回同一个流程引擎。可以通过<code>ProcessEngines.init()</code>创建流程引擎，并由<code>ProcessEngines.destroy()</code>关闭流程引擎。</p>
</div>
<div class="paragraph">
<p>ProcessEngines会扫描<code>flowable.cfg.xml</code>与<code>flowable-context.xml</code>文件。对于<code>flowable.cfg.xml</code>文件，流程引擎会以标准Flowable方式构建引擎：<code>ProcessEngineConfiguration.createProcessEngineConfigurationFromInputStream(inputStream).buildProcessEngine()</code>。对于<code>flowable-context.xml</code>文件，流程引擎会以Spring的方式构建：首先构建Spring应用上下文，然后从该上下文中获取流程引擎。</p>
</div>
<div class="paragraph">
<p>所有的服务都是无状态的。这意味着你可以很容易的在集群环境的多个节点上运行Flowable，使用同一个数据库，而不用担心上一次调用实际在哪台机器上执行。不论在哪个节点执行，对任何服务的任何调用都是幂等（idempotent）的。</p>
</div>
<div class="paragraph">
<p><strong>RepositoryService</strong>很可能是使用Flowable引擎要用的第一个服务。这个服务提供了管理与控制<code>部署(deployments)</code>与<code>流程定义(process definitions)</code>的操作。在这里简单说明一下，流程定义是BPMN 2.0流程对应的Java对象，体现流程中每一步的结构与行为。<code>部署</code>是Flowable引擎中的包装单元，一个部署中可以包含多个BPMN 2.0 XML文件及其他资源。开发者可以决定在一个部署中包含的内容，可以是单个流程的BPMN 2.0 XML文件，也可以包含多个流程及其相关资源（如&#8217;hr-processes&#8217;部署可以包含所有与人力资源流程相关的的东西）。<code>RepositoryService</code>可用于<code>部署</code>这样的包。部署意味着将它上传至引擎，引擎将在储存至数据库之前检查与分析所有的流程。在部署操作后，可以在系统中使用这个部署包，部署包中的所有流程都可以启动。</p>
</div>
<div class="paragraph">
<p>此外，这个服务还可以：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>查询引擎现有的部署与流程定义。</p>
</li>
<li>
<p>暂停或激活部署中的某些流程，或整个部署。暂停意味着不能再对它进行操作，激活刚好相反，重新使它可以操作。</p>
</li>
<li>
<p>获取各种资源，比如部署中保存的文件，或者引擎自动生成的流程图。</p>
</li>
<li>
<p>获取POJO版本的流程定义。它可以用Java而不是XML的方式查看流程。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>与提供静态信息（也就是不会改变，至少不会经常改变的信息）的<code>RepositoryService</code>相反，<strong>RuntimeService</strong>用于启动流程定义的新流程实例。前面介绍过，<code>流程定义</code>中定义了流程中不同步骤的结构与行为。流程实例则是流程定义的实际执行过程。同一时刻，一个流程定义通常有多个运行中的实例。<code>RuntimeService</code>也用于读取与存储<code>流程变量</code>。流程变量是流程实例中的数据，可以在流程的许多地方使用（例如排他网关经常使用流程变量判断流程下一步要走的路径）。<code>RuntimeService</code>还可以用于查询流程实例与执行(Execution)。执行也就是BPMN 2.0中 <code>'token'</code> 的概念。通常执行是指向流程实例当前位置的指针。最后，还可以在流程实例等待外部触发时使用<code>RuntimeService</code>，使流程可以继续运行。流程有许多<code>等待状态(wait states)</code>，<code>RuntimeService</code>服务提供了许多操作用于“通知”流程实例：已经接收到外部触发，流程实例可以继续运行。</p>
</div>
<div class="paragraph">
<p>对于像Flowable这样的BPM引擎来说，核心是需要人类用户操作的任务。所有任务相关的东西都组织在<strong>TaskService</strong>中，例如：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>查询分派给用户或组的任务</p>
</li>
<li>
<p>创建<em>独立运行(standalone)</em>任务。这是一种没有关联到流程实例的任务。</p>
</li>
<li>
<p>决定任务的执行用户(assignee)，或者将用户通过某种方式与任务关联。</p>
</li>
<li>
<p>认领(claim)与完成(complete)任务。认领是指某人决定成为任务的执行用户，也即他将会完成这个任务。完成任务是指“做这个任务要求的工作”，通常是填写某个表单。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>IdentityService</strong>很简单。它用于管理（创建，更新，删除，查询……）组与用户。请注意，Flowable实际上在运行时并不做任何用户检查。例如任务可以分派给任何用户，而引擎并不会验证系统中是否存在该用户。这是因为Flowable有时要与LDAP、Active Directory等服务结合使用。</p>
</div>
<div class="paragraph">
<p><strong>FormService</strong>是可选服务。也就是说Flowable没有它也能很好地运行，而不必牺牲任何功能。这个服务引入了<em>开始表单(start form)</em>与<em>任务表单(task form)</em>的概念。 <em>开始表单</em>是在流程实例启动前显示的表单，而<em>任务表单</em>是用户完成任务时显示的表单。Flowable可以在BPMN 2.0流程定义中定义这些表单。表单服务通过简单的方式暴露这些数据。再次重申，表单不一定要嵌入流程定义，因此这个服务是可选的。</p>
</div>
<div class="paragraph">
<p><strong>HistoryService</strong>暴露Flowable引擎收集的所有历史数据。当执行流程时，引擎会保存许多数据（可配置），例如流程实例启动时间、谁在执行哪个任务、完成任务花费的事件、每个流程实例的执行路径，等等。这个服务主要提供查询这些数据的能力。</p>
</div>
<div class="paragraph">
<p><strong>ManagementService</strong>通常在用Flowable编写用户应用时不需要使用。它可以读取数据库表与表原始数据的信息，也提供了对作业(job)的查询与管理操作。Flowable中很多地方都使用作业，例如定时器(timer)，异步操作(asynchronous continuation)，延时暂停/激活(delayed suspension/activation)等等。后续会详细介绍这些内容。</p>
</div>
<div class="paragraph">
<p><strong>DynamicBpmnService</strong>可用于修改流程定义中的部分内容，而不需要重新部署它。例如可以修改流程定义中一个用户任务的办理人设置，或者修改一个服务任务中的类名。</p>
</div>
<div class="paragraph">
<p>参考<a href="http://www.flowable.org/docs/javadocs/index.html">javadocs</a>了解服务操作与引擎API的更多信息。</p>
</div>
</div>
<div class="sect2">
<h3 id="_exception_strategy">4.2. 异常策略</h3>
<div class="paragraph">
<p>Flowable的异常基类是<code>org.flowable.engine.FlowableException</code>，这是一个非受检异常(unchecked exception)。在任何API操作时都可能会抛出这个异常，<a href="http://www.flowable.org/docs/javadocs/index.html">javadoc</a>提供了每个方法可能抛出的异常。例如，从<code>TaskService</code>中摘录：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-cm">/**</span>
<span class="tok-cm"> * 当任务成功执行时调用。</span>
<span class="tok-cm"> * @param taskId 需要完成的任务id，不能为null。</span>
<span class="tok-cm"> * @throws FlowableObjectNotFoundException 若给定id找不到任务。</span>
<span class="tok-cm"> */</span>
 <span class="tok-kt">void</span> <span class="tok-nf">complete</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">taskId</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在上例中，如果所用的id找不到任务，就会抛出异常。并且，由于javadoc中<strong>明确要求taskId不能为null，因此如果传递了<code>null</code>值，会抛出<code>FlowableIllegalArgumentException</code>异常</strong>。</p>
</div>
<div class="paragraph">
<p>尽管我们想避免过大的异常层次结构，但在特定情况下仍然会抛出下述异常子类。所有流程执行与API调用中发生的错误，如果不符合下面列出的异常，会统一抛出<code>FlowableExceptions</code>。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FlowableWrongDbException</code>: 当Flowable引擎检测到数据库表结构版本与引擎版本不匹配时抛出。</p>
</li>
<li>
<p><code>FlowableOptimisticLockingException</code>: 当对同一数据实体的并发访问导致数据存储发生乐观锁异常时抛出。</p>
</li>
<li>
<p><code>FlowableClassLoadingException</code>: 当需要载入的类（如JavaDelegate, TaskListener, &#8230;&#8203;）无法找到，或载入发生错误时抛出。</p>
</li>
<li>
<p><code>FlowableObjectNotFoundException</code>: 当请求或要操作的对象不存在时抛出。</p>
</li>
<li>
<p><code>FlowableIllegalArgumentException</code>: 当调用Flowable API时使用了不合法的参数时抛出。可能是引擎配置中的不合法值，或者是API调用传递的不合法参数，也可能是流程定义中的不合法值。</p>
</li>
<li>
<p><code>FlowableTaskAlreadyClaimedException</code>: 当对已被认领的任务调用<code>taskService.claim(&#8230;&#8203;)</code>时抛出。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="queryAPI">4.3. 查询API</h3>
<div class="paragraph">
<p>从引擎中查询数据有两种方式：查询API与原生(native)查询。查询API可以使用链式API，通过编程方式进行类型安全的查询。你可以在查询中增加各种条件（所有条件都用做AND逻辑），也可以明确指定排序方式。下面是示例代码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">taskAssignee</span><span class="tok-o">(</span><span class="tok-s">&quot;kermit&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">processVariableValueEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;orderId&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;0815&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">orderByDueDate</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>有时需要更复杂的查询，例如使用OR操作符查询，或者使用查询API不能满足查询条件要求。我们为这种需求提供了可以自己写SQL查询的原生查询。返回类型由使用的查询对象决定，数据会映射到正确的对象中（Task、ProcessInstance、Execution，等等）。查询在数据库中进行，因此需要使用数据库中定义的表名与列名。这需要了解内部数据结构，因此建议小心使用原生查询。数据库表名可以通过API读取，这样可以将依赖关系减到最小。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createNativeTaskQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">sql</span><span class="tok-o">(</span><span class="tok-s">&quot;SELECT count(*) FROM &quot;</span> <span class="tok-o">+</span> <span class="tok-n">managementService</span><span class="tok-o">.</span><span class="tok-na">getTableName</span><span class="tok-o">(</span><span class="tok-n">Task</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span> <span class="tok-o">+</span>
      <span class="tok-s">&quot; T WHERE T.NAME_ = #{taskName}&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">parameter</span><span class="tok-o">(</span><span class="tok-s">&quot;taskName&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;gonzoTask&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>

<span class="tok-kt">long</span> <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createNativeTaskQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">sql</span><span class="tok-o">(</span><span class="tok-s">&quot;SELECT count(*) FROM &quot;</span> <span class="tok-o">+</span> <span class="tok-n">managementService</span><span class="tok-o">.</span><span class="tok-na">getTableName</span><span class="tok-o">(</span><span class="tok-n">Task</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-s">&quot; T1, &quot;</span> <span class="tok-o">+</span>
      <span class="tok-n">managementService</span><span class="tok-o">.</span><span class="tok-na">getTableName</span><span class="tok-o">(</span><span class="tok-n">VariableInstanceEntity</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-s">&quot; V1 WHERE V1.TASK_ID_ = T1.ID_&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">count</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="apiVariables">4.4. 变量</h3>
<div class="paragraph">
<p>流程实例按步骤执行时，需要使用一些数据。在Flowable中，这些数据称作<em>变量(variable)</em>，并会存储在数据库中。变量可以用在表达式中（例如在排他网关中用于选择正确的出口路径），也可以在Java服务任务(service task)中用于调用外部服务（例如为服务调用提供输入或结果存储），等等。</p>
</div>
<div class="paragraph">
<p>流程实例可以持有变量（称作<em>流程变量 process variables</em>）；用户任务以及<em>执行(executions)</em>——流程当前活动节点的指针——也可以持有变量。流程实例可以持有任意数量的变量，每个变量存储为<em>ACT_RU_VARIABLE</em>数据库表的一行。</p>
</div>
<div class="paragraph">
<p>所有的<em>startProcessInstanceXXX</em>方法都有一个可选参数，用于在流程实例创建及启动时设置变量。例如，在<em>RuntimeService</em>中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">ProcessInstance</span> <span class="tok-nf">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">processDefinitionKey</span><span class="tok-o">,</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">variables</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以在流程执行中加入变量。例如，(<em>RuntimeService</em>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-kt">void</span> <span class="tok-nf">setVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">);</span>
<span class="tok-kt">void</span> <span class="tok-nf">setVariableLocal</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">);</span>
<span class="tok-kt">void</span> <span class="tok-nf">setVariables</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">,</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-o">?</span> <span class="tok-kd">extends</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">variables</span><span class="tok-o">);</span>
<span class="tok-kt">void</span> <span class="tok-nf">setVariablesLocal</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">,</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-o">?</span> <span class="tok-kd">extends</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">variables</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意可以为给定执行（请记住，流程实例由一颗执行的树(tree of executions)组成）设置<em>局部(local)</em>变量。局部变量将只在该执行中可见，对执行树的上层则不可见。这可以用于 数据不应该暴露给流程实例的其他执行，或者变量在流程实例的不同路径中有不同的值（例如使用并行路径时）的情况。</p>
</div>
<div class="paragraph">
<p>可以用下列方法读取变量。请注意<em>TaskService</em>中有类似的方法。这意味着任务与执行一样，可以持有局部变量，其生存期为任务持续的时间。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getVariables</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">);</span>
<span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getVariablesLocal</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">);</span>
<span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getVariables</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">,</span> <span class="tok-n">Collection</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">variableNames</span><span class="tok-o">);</span>
<span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getVariablesLocal</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">,</span> <span class="tok-n">Collection</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">variableNames</span><span class="tok-o">);</span>
<span class="tok-n">Object</span> <span class="tok-nf">getVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">);</span>
<span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">T</span> <span class="tok-nf">getVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">,</span> <span class="tok-n">Class</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">variableClass</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>变量通常用于<a href="#bpmnJavaServiceTask">Java代理（Java delegates）</a>、<a href="#apiExpressions">表达式（expressions）</a>、执行（execution）、任务监听器（tasklisteners）、脚本（scripts）等等。在这些结构中，提供了当前的<em>execution</em>或<em>task</em>对象，可用于变量的设置、读取。简单示例如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">getVariables</span><span class="tok-o">();</span>
<span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">getVariables</span><span class="tok-o">(</span><span class="tok-n">Collection</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">variableNames</span><span class="tok-o">);</span>
<span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">getVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">);</span>

<span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariables</span><span class="tok-o">(</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">object</span><span class="tok-o">&gt;</span> <span class="tok-n">variables</span><span class="tok-o">);</span>
<span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意也可以使用上例中方法的<em>局部变量</em>版本。</p>
</div>
<div class="paragraph">
<p>由于历史（与向后兼容）原因，当调用上述任何方法时，引擎会从数据库中取出<strong>所有</strong>变量。也就是说，如果你有10个变量，使用<em>getVariable("myVariable")</em>获取其中的一个，实际上其他9个变量也会从数据库取出并缓存。这并不坏，因为后续的调用可以不必再读取数据库。比如，如果流程定义包含三个连续的服务任务（因此它们在同一个数据库事务里），在第一个服务任务里通过一次调用获取全部变量，也许比在每个服务任务里分别获取需要的变量要好。请注意对读取与设置变量<strong>都是这样</strong>。</p>
</div>
<div class="paragraph">
<p>当然，如果使用大量变量，或者你希望精细控制数据库查询与流量，上述的做法就不合适了。我们引入了可以更精细控制的方法。这个方法有一个可选的参数，告诉引擎是否需要读取并缓存所有变量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getVariables</span><span class="tok-o">(</span><span class="tok-n">Collection</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">variableNames</span><span class="tok-o">,</span> <span class="tok-kt">boolean</span> <span class="tok-n">fetchAllVariables</span><span class="tok-o">);</span>
<span class="tok-n">Object</span> <span class="tok-nf">getVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">,</span> <span class="tok-kt">boolean</span> <span class="tok-n">fetchAllVariables</span><span class="tok-o">);</span>
<span class="tok-kt">void</span> <span class="tok-nf">setVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">value</span><span class="tok-o">,</span> <span class="tok-kt">boolean</span> <span class="tok-n">fetchAllVariables</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当<em>fetchAllVariables</em>参数为<em>true</em>时，行为与上面描述的完全一样：读取或设置一个变量时，所有的变量都将被读取并缓存。</p>
</div>
<div class="paragraph">
<p>而当参数值为<em>false</em>时，会使用明确的查询，其他变量不会被读取或缓存。只有指定的变量的值会被缓存并用于后续使用。</p>
</div>
</div>
<div class="sect2">
<h3 id="apiTransientVariables">4.5. 瞬时变量</h3>
<div class="paragraph">
<p>瞬时变量(Transient variable)类似普通变量，只是不会被持久化。通常来说，瞬时变量用于高级使用场景。如果不明确，还是使用普通流程变量为好。</p>
</div>
<div class="paragraph">
<p>瞬时变量具有下列特性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>瞬时变量完全不存储历史。</p>
</li>
<li>
<p>与<em>普通</em>变量类似，设置瞬时变量时会存入<em>最上层父</em>中。这意味着在一个执行中设置一个变量时，瞬时变量实际上会存储在流程实例执行中。与普通变量类似，可以使用<em>局部(local)</em>的对应方法，将变量设置为某个执行或任务的局部变量。</p>
</li>
<li>
<p>瞬时变量只能在下一个“等待状态”之前访问。之后该变量即消失。等待状态意味着流程实例会持久化至数据存储中。请注意在这个定义中，<em>异步</em>活动也是“等待状态”！</p>
</li>
<li>
<p>只能使用<em>setTransientVariable(name, value)</em>设置瞬时变量，但是调用<em>getVariable(name)</em>也会返回瞬时变量（也有<em>getTransientVariable(name)</em>方法，它只会返回瞬时变量）。这是为了简化表达式的撰写，并保证已有逻辑可以使用这两种类型的变量。</p>
</li>
<li>
<p>瞬时变量<em>屏蔽(shadow)</em>同名的持久化变量。也就是说当一个流程实例中设置了同名的持久化变量与瞬时变量时，<em>getVariable("someVariable")</em>会返回瞬时变量的值。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在大多数可以使用普通变量的地方，都可以获取、设置瞬时变量：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在<em>JavaDelegate</em>实现中的<em>DelegateExecution</em>内</p>
</li>
<li>
<p>在<em>ExecutionListener</em>实现中的<em>DelegateExecution</em>内，以及在<em>TaskListener</em>实现中的<em>DelegateTask</em>内</p>
</li>
<li>
<p>通过<em>execution</em>对象在脚本任务内</p>
</li>
<li>
<p>通过RuntimeService启动流程实例时</p>
</li>
<li>
<p>完成任务时</p>
</li>
<li>
<p>调用<em>runtimeService.trigger</em>方法时</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>瞬时变量相关的方法遵循普通流程变量方法的命名约定：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-kt">void</span> <span class="tok-nf">setTransientVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">variableValue</span><span class="tok-o">);</span>
<span class="tok-kt">void</span> <span class="tok-nf">setTransientVariableLocal</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">,</span> <span class="tok-n">Object</span> <span class="tok-n">variableValue</span><span class="tok-o">);</span>
<span class="tok-kt">void</span> <span class="tok-nf">setTransientVariables</span><span class="tok-o">(</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">transientVariables</span><span class="tok-o">);</span>
<span class="tok-kt">void</span> <span class="tok-nf">setTransientVariablesLocal</span><span class="tok-o">(</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">transientVariables</span><span class="tok-o">);</span>

<span class="tok-n">Object</span> <span class="tok-nf">getTransientVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">);</span>
<span class="tok-n">Object</span> <span class="tok-nf">getTransientVariableLocal</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">);</span>

<span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getTransientVariables</span><span class="tok-o">();</span>
<span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getTransientVariablesLocal</span><span class="tok-o">();</span>

<span class="tok-kt">void</span> <span class="tok-nf">removeTransientVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">);</span>
<span class="tok-kt">void</span> <span class="tok-nf">removeTransientVariableLocal</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>下面的BPMN流程图展示了一个典型例子：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.transient.variable.example.png" alt="api.transient.variable.example">
</div>
</div>
<div class="paragraph">
<p>假设&#8217;Fetch Data(获取数据)'服务任务调用某个远程服务（例如使用REST）。也假设需要其需要一些配置参数，并需要在启动流程实例时提供。同时，这些配置参数对于历史审计并不重要，因此我们将它们作为瞬时变量传递：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-n">ProcessInstance</span> <span class="tok-n">processInstance</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createProcessInstanceBuilder</span><span class="tok-o">()</span>
       <span class="tok-o">.</span><span class="tok-na">processDefinitionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;someKey&quot;</span><span class="tok-o">)</span>
       <span class="tok-o">.</span><span class="tok-na">transientVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;configParam01&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;A&quot;</span><span class="tok-o">)</span>
       <span class="tok-o">.</span><span class="tok-na">transientVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;configParam02&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;B&quot;</span><span class="tok-o">)</span>
       <span class="tok-o">.</span><span class="tok-na">transientVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;configParam03&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;C&quot;</span><span class="tok-o">)</span>
       <span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意在到达用户任务并持久化之前，都可以使用这些瞬时变量。例如，在&#8217;Additional Work(额外工作)'用户任务中它们就不再可用。也请注意如果&#8217;Fetch Data&#8217;是异步的，则瞬时变量在该步骤之后也不再可用。</p>
</div>
<div class="paragraph">
<p><em>Fetch Data</em>（的简化版本）可以像是：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">FetchDataServiceTask</span> <span class="tok-kd">implements</span> <span class="tok-n">JavaDelegate</span> <span class="tok-o">{</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">DelegateExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">configParam01</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">)</span> <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">getVariable</span><span class="tok-o">(</span><span class="tok-n">configParam01</span><span class="tok-o">);</span>
    <span class="tok-c1">// ...</span>

    <span class="tok-n">RestReponse</span> <span class="tok-n">restResponse</span> <span class="tok-o">=</span> <span class="tok-n">executeRestCall</span><span class="tok-o">();</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setTransientVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;response&quot;</span><span class="tok-o">,</span> <span class="tok-n">restResponse</span><span class="tok-o">.</span><span class="tok-na">getBody</span><span class="tok-o">());</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setTransientVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;status&quot;</span><span class="tok-o">,</span> <span class="tok-n">restResponse</span><span class="tok-o">.</span><span class="tok-na">getStatus</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>'Process Data（处理数据）'可以获取response瞬时变量，解析并将其相关数据存储在实际流程变量中，因为之后还需要使用它们。</p>
</div>
<div class="paragraph">
<p>离开排他网关的顺序流上的条件表达式，不关注使用的是持久化还是瞬时变量（在这个例子中<em>status</em>是瞬时变量）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>${status == 200}<span class="tok-nt">&lt;/conditionExpression&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="apiExpressions">4.6. 表达式</h3>
<div class="paragraph">
<p>Flowable使用UEL进行表达式解析。UEL代表<em>Unified Expression Language</em>，是EE6规范的一部分（查看<a href="http://docs.oracle.com/javaee/6/tutorial/doc/gjddd.html">EE6规范</a>了解更多信息）。</p>
</div>
<div class="paragraph">
<p>表达式可以用于<a href="#bpmnJavaServiceTaskXML">Java服务任务(Java Service task)</a>、<a href="#executionListeners">执行监听器(Execution Listener)</a>、<a href="#taskListeners">任务监听器(Task Listener)</a> 与 <a href="#conditionalSequenceFlowXml">条件顺序流(Conditional sequence flow)</a>等。尽管有值表达式与方法表达式这两种不同的表达式，Flowable通过抽象，使它们都可以在需要<code>表达式</code>的地方使用。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>值表达式 Value expression</strong>: 解析为一个值。默认情况下，所有流程变量都可以使用。（若使用Spring）所有的Spring bean也可以用在表达式里。例如：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>${myVar}
${myBean.myProperty}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>方法表达式 Method expression</strong>: 调用一个方法，可以带或不带参数。<strong>当调用不带参数的方法时，要确保在方法名后添加空括号（以避免与值表达式混淆）。</strong>传递的参数可以是字面值(literal value)，也可以是表达式，它们会被自动解析。例如：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>${printer.print()}
${myBean.addNewOrder('orderName')}
${myBean.doSomething(myVar, execution)}</pre>
</div>
</div>
<div class="paragraph">
<p>请注意，表达式支持解析（及比较）原始类型(primitive)、bean、list、array与map。
Note that these expressions support resolving primitives (including comparing them), beans, lists, arrays and maps.</p>
</div>
<div class="paragraph">
<p>除了所有流程变量外，还有一些默认对象可在表达式中使用：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>execution</code>: <code>DelegateExecution</code>+，持有正在运行的执行的额外信息。</p>
</li>
<li>
<p><code>task</code>: <code>DelegateTask</code>持有当前任务的额外信息。<strong>请注意：只在任务监听器的表达式中可用。</strong></p>
</li>
<li>
<p><code>authenticatedUserId</code>: 当前已验证的用户id。如果没有已验证的用户，该变量不可用。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>更多实际使用例子，请查看<a href="#springExpressions">Spring中的表达式</a>、<a href="#bpmnJavaServiceTaskXML">Java服务任务</a>、<a href="#executionListeners">执行监听器</a>、<a href="#taskListeners">任务监听器</a>或者<a href="#conditionalSequenceFlowXml">条件顺序流</a>等章节。</p>
</div>
</div>
<div class="sect2">
<h3 id="apiUnitTesting">4.7. 单元测试</h3>
<div class="paragraph">
<p>业务流程是软件项目的必要组成部分，也需要使用测试一般应用逻辑的方法——单元测试——测试它们。Flowable是嵌入式的Java引擎，因此为业务流程编写单元测试就同编写一般的单元测试一样简单。</p>
</div>
<div class="paragraph">
<p>Flowable支持JUnit 3及4的单元测试风格。按照JUnit 3的风格，必须扩展(extended)<code>org.flowable.engine.test.FlowableTestCase</code>。它通过保护(protected)成员变量提供对ProcessEngine与服务的访问。在测试的<code>setup()</code>中，processEngine会默认使用classpath中的<code>flowable.cfg.xml</code>资源初始化。如果要指定不同的配置文件，请覆盖<em>getConfigurationResource()</em>方法。当使用相同的配置资源时，流程引擎会静态缓存，用于多个单元测试。</p>
</div>
<div class="paragraph">
<p>通过扩展<code>FlowableTestCase</code>，可以使用<code>org.flowable.engine.test.Deployment</code>注解测试方法。在测试运行前，会部署与测试类在同一个包下的格式为<code>testClassName.testMethod.bpmn20.xml</code>的资源文件。在测试结束时，会删除这个部署，包括所有相关的流程实例、任务，等等。也可以使用<code>Deployment</code>注解显式指定资源位置。查看该类以获得更多信息。</p>
</div>
<div class="paragraph">
<p>综上所述，JUnit 3风格的测试看起来类似：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyBusinessProcessTest</span> <span class="tok-kd">extends</span> <span class="tok-n">FlowableTestCase</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Deployment</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testSimpleProcess</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;simpleProcess&quot;</span><span class="tok-o">);</span>

    <span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;My Task&quot;</span><span class="tok-o">,</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>

    <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">complete</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createProcessInstanceQuery</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>要使用JUnit 4的风格书写单元测试并达成同样的功能，必须使用<code>org.flowable.engine.test.FlowableRule</code> Rule。这样能够通过它的getter获得流程引擎与服务。对于<code>FlowableTestCase</code>（上例），包含<code>@Rule</code>就可以使用<code>org.flowable.engine.test.Deployment</code>注解（参见上例解释其用途及配置），并且会自动在classpath中寻找默认配置文件。当使用相同的配置资源时，流程引擎会静态缓存，以用于多个单元测试。</p>
</div>
<div class="paragraph">
<p>下面的代码片段展示了JUnit 4风格的测试与<code>FlowableRule</code>的用法。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyBusinessProcessTest</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Rule</span>
  <span class="tok-kd">public</span> <span class="tok-n">FlowableRule</span> <span class="tok-n">flowableRule</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">FlowableRule</span><span class="tok-o">();</span>

  <span class="tok-nd">@Test</span>
  <span class="tok-nd">@Deployment</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">ruleUsageExample</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">RuntimeService</span> <span class="tok-n">runtimeService</span> <span class="tok-o">=</span> <span class="tok-n">flowableRule</span><span class="tok-o">.</span><span class="tok-na">getRuntimeService</span><span class="tok-o">();</span>
    <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;ruleUsage&quot;</span><span class="tok-o">);</span>

    <span class="tok-n">TaskService</span> <span class="tok-n">taskService</span> <span class="tok-o">=</span> <span class="tok-n">flowableRule</span><span class="tok-o">.</span><span class="tok-na">getTaskService</span><span class="tok-o">();</span>
    <span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;My Task&quot;</span><span class="tok-o">,</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>

    <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">complete</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createProcessInstanceQuery</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="apiDebuggingUnitTest">4.8. 调试单元测试</h3>
<div class="paragraph">
<p>当使用H2内存数据库进行单元测试时，下面的方法可以让你在调试过程中方便地检查Flowable数据库中的数据。截图来自Eclipse，但其他IDE方式相似。</p>
</div>
<div class="paragraph">
<p>假设我们的单元测试的某处放置了<em>断点(breakpoint)</em>（在Eclipse里可以通过在代码左侧条上双击实现）：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.test.debug.breakpoint.png" alt="api.test.debug.breakpoint">
</div>
</div>
<div class="paragraph">
<p>如果我们在<em>debug</em>模式（在测试类中右键，选择“Run as”，然后选择“JUnit test”）下运行单元测试，测试进程会在断点处暂停，这样我们就可以在右上窗口中查看测试中的变量。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.test.debug.view.png" alt="api.test.debug.view">
</div>
</div>
<div class="paragraph">
<p>要检查Flowable的数据，打开<em>Display</em>窗口（如果没有找到这个窗口，打开 Window&#8594;Show View&#8594;Other，然后选择<em>Display</em>），并键入（可以使用代码补全）<code>org.h2.tools.Server.createWebServer("-web").start()</code></p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.test.debug.start.h2.server.png" alt="api.test.debug.start.h2.server">
</div>
</div>
<div class="paragraph">
<p>选中刚键入的行并右键点击。然后选择&#8217;Display'（或者用快捷键执行）</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.test.debug.start.h2.server.2.png" alt="api.test.debug.start.h2.server.2">
</div>
</div>
<div class="paragraph">
<p>现在打开浏览器并访问<a href="http://localhost:8082"><a href="http://localhost:8082" class="bare">http://localhost:8082</a></a>，填入内存数据库的JDBC URL（默认为<code>jdbc:h2:mem:flowable</code>），然后点击connect按钮。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.test.debug.h2.login.png" alt="api.test.debug.h2.login">
</div>
</div>
<div class="paragraph">
<p>这样就可以看到Flowable的数据。便于理解单元测试执行流程的方式。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/api.test.debug.h2.tables.png" alt="api.test.debug.h2.tables">
</div>
</div>
</div>
<div class="sect2">
<h3 id="apiProcessEngineInWebApp">4.9. Web应用中的流程引擎</h3>
<div class="paragraph">
<p><code>ProcessEngine</code>是线程安全的类，可以很容易地在多个线程间共享。在web应用中，这意味着可以在容器启动时创建引擎，并在容器关闭时关闭引擎。</p>
</div>
<div class="paragraph">
<p>下面的代码片段展示了如何在Servlet环境中，通过<code>ServletContextListener</code>初始化与销毁流程引擎。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ProcessEnginesServletContextListener</span> <span class="tok-kd">implements</span> <span class="tok-n">ServletContextListener</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">contextInitialized</span><span class="tok-o">(</span><span class="tok-n">ServletContextEvent</span> <span class="tok-n">servletContextEvent</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">ProcessEngines</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">contextDestroyed</span><span class="tok-o">(</span><span class="tok-n">ServletContextEvent</span> <span class="tok-n">servletContextEvent</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">ProcessEngines</span><span class="tok-o">.</span><span class="tok-na">destroy</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>contextInitialized</code>方法会调用<code>ProcessEngines.init()</code>。它会在classpath中查找<code>flowable.cfg.xml</code>资源文件，并为每个文件分别创建<code>ProcessEngine</code>（如果多个JAR都包含配置文件）。如果在classpath中有多个这样的资源文件，请确保它们使用不同的引擎名。需要使用流程引擎时，可以这样获取：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">ProcessEngines</span><span class="tok-o">.</span><span class="tok-na">getDefaultProcessEngine</span><span class="tok-o">()</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>或者</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">ProcessEngines</span><span class="tok-o">.</span><span class="tok-na">getProcessEngine</span><span class="tok-o">(</span><span class="tok-s">&quot;myName&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当然，就像<a href="#configuration">配置</a>章节中介绍的，还可以使用各种不同的方式创建流程引擎。</p>
</div>
<div class="paragraph">
<p>context-listener的<code>contextDestroyed</code>方法会调用<code>ProcessEngines.destroy()</code>。它会妥善关闭所有已初始化的流程引擎。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="springintegration">5. 集成Spring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>尽管完全可以脱离Spring使用Flowable，我们仍提供了很多非常好的集成特性，并将在这一章节介绍。</p>
</div>
<div class="sect2">
<h3 id="_processenginefactorybean">5.1. ProcessEngineFactoryBean</h3>
<div class="paragraph">
<p>可以将<code>ProcessEngine</code>配置为普通的Spring bean。入口是<code>org.flowable.spring.ProcessEngineFactoryBean</code>类。这个bean处理流程引擎配置，并创建流程引擎。所以在Spring中创建与设置的参数与<a href="#configuration">配置</a>章节中介绍的相同。Spring集成所用的配置与引擎bean为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.SpringProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    ...
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngine&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.ProcessEngineFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意<code>processEngineConfiguration</code> bean现在使用<code>org.flowable.spring.SpringProcessEngineConfiguration</code>类。</p>
</div>
</div>
<div class="sect2">
<h3 id="_transactions">5.2. 事务</h3>
<div class="paragraph">
<p>我们会逐步说明(Flowable)发行版里，Spring示例中的<code>SpringTransactionIntegrationTest</code>。下面是我们示例中使用的Spring配置文件（SpringTransactionIntegrationTest-context.xml）。下面的小节包含了dataSource(数据源)，transactionManager(事务管理器)，processEngine(流程引擎)以及Flowable引擎服务。</p>
</div>
<div class="paragraph">
<p>将DataSource传递给<code>SpringProcessEngineConfiguration</code>（使用“dataSource”参数）时，Flowable会在内部使用<code>org.springframework.jdbc.datasource.TransactionAwareDataSourceProxy</code>对得到的数据源进行包装（wrap）。这是为了保证从数据源获取的SQL连接与Spring的事务可以协同工作。这样也就不需要在Spring配置中对数据源进行代理（proxy）。但仍然可以将代理<code>TransactionAwareDataSourceProxy</code>传递给<code>SpringProcessEngineConfiguration</code>——在这种情况下，不会再进行包装。</p>
</div>
<div class="paragraph">
<p><strong>请确保如果自行在Spring配置中声明了<code>TransactionAwareDataSourceProxy</code>，则不要将它用在已经配置Spring事务的资源上（例如DataSourceTransactionManager与JPATransactionManager。它们需要未经代理的数据源）。</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="tok-na">xmlns:context=</span><span class="tok-s">&quot;http://www.springframework.org/schema/context&quot;</span>
       <span class="tok-na">xmlns:tx=</span><span class="tok-s">&quot;http://www.springframework.org/schema/tx&quot;</span>
       <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans</span>
<span class="tok-s">                             http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="tok-s">                           http://www.springframework.org/schema/context</span>
<span class="tok-s">                             http://www.springframework.org/schema/context/spring-context-2.5.xsd</span>
<span class="tok-s">                           http://www.springframework.org/schema/tx</span>
<span class="tok-s">                             http://www.springframework.org/schema/tx/spring-tx-3.0.xsd&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.springframework.jdbc.datasource.SimpleDriverDataSource&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;driverClass&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.h2.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;url&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;username&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sa&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.SpringProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;asyncExecutorActivate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngine&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.ProcessEngineFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;repositoryService&quot;</span> <span class="tok-na">factory-bean=</span><span class="tok-s">&quot;processEngine&quot;</span> <span class="tok-na">factory-method=</span><span class="tok-s">&quot;getRepositoryService&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;runtimeService&quot;</span> <span class="tok-na">factory-bean=</span><span class="tok-s">&quot;processEngine&quot;</span> <span class="tok-na">factory-method=</span><span class="tok-s">&quot;getRuntimeService&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;taskService&quot;</span> <span class="tok-na">factory-bean=</span><span class="tok-s">&quot;processEngine&quot;</span> <span class="tok-na">factory-method=</span><span class="tok-s">&quot;getTaskService&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;historyService&quot;</span> <span class="tok-na">factory-bean=</span><span class="tok-s">&quot;processEngine&quot;</span> <span class="tok-na">factory-method=</span><span class="tok-s">&quot;getHistoryService&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;managementService&quot;</span> <span class="tok-na">factory-bean=</span><span class="tok-s">&quot;processEngine&quot;</span> <span class="tok-na">factory-method=</span><span class="tok-s">&quot;getManagementService&quot;</span> <span class="tok-nt">/&gt;</span>

...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这个Spring配置文件也包含了在这个示例中要用到的bean与配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans&gt;</span>
  ...
  <span class="tok-nt">&lt;tx:annotation-driven</span> <span class="tok-na">transaction-manager=</span><span class="tok-s">&quot;transactionManager&quot;</span><span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;userBean&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.test.UserBean&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;runtimeService&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;runtimeService&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;printer&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.test.Printer&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用任何Spring支持的方式创建应用上下文(application context)。在这个例子中，可以使用classpath中的XML资源配置来创建Spring应用上下文：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">ClassPathXmlApplicationContext</span> <span class="tok-n">applicationContext</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ClassPathXmlApplicationContext</span><span class="tok-o">(</span>
	<span class="tok-s">&quot;org/flowable/examples/spring/SpringTransactionIntegrationTest-context.xml&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>或者在单元测试中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-nd">@ContextConfiguration</span><span class="tok-o">(</span>
  <span class="tok-s">&quot;classpath:org/flowable/spring/test/transaction/SpringTransactionIntegrationTest-context.xml&quot;</span><span class="tok-o">)</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>然后就可以获取服务bean，并调用它们的方法。ProcessEngineFactoryBean会为服务加上额外的拦截器(interceptor)，并为Flowable服务方法设置Propagation.REQUIRED事务级别。这样，我们就可以使用repositoryService部署流程：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-n">RepositoryService</span> <span class="tok-n">repositoryService</span> <span class="tok-o">=</span>
  <span class="tok-o">(</span><span class="tok-n">RepositoryService</span><span class="tok-o">)</span> <span class="tok-n">applicationContext</span><span class="tok-o">.</span><span class="tok-na">getBean</span><span class="tok-o">(</span><span class="tok-s">&quot;repositoryService&quot;</span><span class="tok-o">);</span>
<span class="tok-n">String</span> <span class="tok-n">deploymentId</span> <span class="tok-o">=</span> <span class="tok-n">repositoryService</span>
  <span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">addClasspathResource</span><span class="tok-o">(</span><span class="tok-s">&quot;org/flowable/spring/test/hello.bpmn20.xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>还有另一种方法也可以使用。如果userBean.hello()方法在Spring事务中，Flowable服务方法调用就会加入这个事务。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">UserBean</span> <span class="tok-n">userBean</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">UserBean</span><span class="tok-o">)</span> <span class="tok-n">applicationContext</span><span class="tok-o">.</span><span class="tok-na">getBean</span><span class="tok-o">(</span><span class="tok-s">&quot;userBean&quot;</span><span class="tok-o">);</span>
<span class="tok-n">userBean</span><span class="tok-o">.</span><span class="tok-na">hello</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>UserBean看起来像下面这样。请记着在上面的Spring bean配置中，我们已经将repositoryService注入了userBean。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">UserBean</span> <span class="tok-o">{</span>

  <span class="tok-cm">/** 已经由Spring注入 */</span>
  <span class="tok-kd">private</span> <span class="tok-n">RuntimeService</span> <span class="tok-n">runtimeService</span><span class="tok-o">;</span>

  <span class="tok-nd">@Transactional</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">hello</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-c1">// 可以在你的领域模型（domain model）中进行事务操作，</span>
    <span class="tok-c1">// 它会与Flowable RuntimeService的startProcessInstanceByKey</span>
    <span class="tok-c1">// 合并在同一个事务里</span>
    <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;helloProcess&quot;</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setRuntimeService</span><span class="tok-o">(</span><span class="tok-n">RuntimeService</span> <span class="tok-n">runtimeService</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">runtimeService</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="springExpressions">5.3. 表达式</h3>
<div class="paragraph">
<p>当使用ProcessEngineFactoryBean时，默认BPMN流程中所有的<a href="#apiExpressions">表达式</a>都可以“看见”所有的Spring bean。可以通过配置的map，限制表达式能使用的bean，甚至可以完全禁止表达式使用bean。下面的例子只暴露了一个bean（printer），可以使用“printer”作为key访问。<strong>要完全禁止表达式使用bean，可以将SpringProcessEngineConfiguration的‘beans’参数设为空list。如果不设置‘beans’参数，则上下文中的所有bean都将可以使用。</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.SpringProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  ...
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;beans&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;map&gt;</span>
      <span class="tok-nt">&lt;entry</span> <span class="tok-na">key=</span><span class="tok-s">&quot;printer&quot;</span> <span class="tok-na">value-ref=</span><span class="tok-s">&quot;printer&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/map&gt;</span>
  <span class="tok-nt">&lt;/property&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;printer&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.examples.spring.Printer&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样就可以在表达式中使用这个bean了。例如，SpringTransactionIntegrationTest <code>hello.bpmn20.xml</code>展示了如何通过UEL方法表达式(method expression)调用Spring bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span> <span class="tok-na">id=</span><span class="tok-s">&quot;definitions&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;helloProcess&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;print&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;print&quot;</span> <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;#{printer.printMessage()}&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;print&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;/process&gt;</span>

<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>其中<code>Printer</code>为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Printer</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">printMessage</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;hello world&quot;</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring bean配置（上面已经展示过）为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans&gt;</span>
  ...

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;printer&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.examples.spring.Printer&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_automatic_resource_deployment">5.4. 自动部署资源</h3>
<div class="paragraph">
<p>集成Spring也提供了部署资源的特殊方式。在流程引擎配置中，可以指定一组资源。当创建流程引擎时，会扫描并部署这些资源。可以用过滤器阻止重复部署：只有当资源确实发生变化时，才会重新部署至Flowable数据库。在Spring容器经常重启（例如测试时）的时候，这很有用。</p>
</div>
<div class="paragraph">
<p>这里有个例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.SpringProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  ...
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;deploymentResources&quot;</span>
    <span class="tok-na">value=</span><span class="tok-s">&quot;classpath*:/org/flowable/spring/test/autodeployment/autodeploy.*.bpmn20.xml&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngine&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.ProcessEngineFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>默认情况下，上面的配置方式会将符合这个过滤器的所有资源组织在一起，作为Flowable引擎的一个部署。重复检测过滤器将作用于整个部署，避免重复地部署未改变资源。有时这不是你想要的。例如，如果用这种方式部署了一组资源，即使只有其中的一个资源发生了改变，整个部署都会被视作已改变，因此这个部署中所有的所有流程定义都会被重新部署。这将导致每个流程定义都会刷新版本号（流程定义id会变化），即使实际上只有一个流程发生了变化。</p>
</div>
<div class="paragraph">
<p>可以使用<code>SpringProcessEngineConfiguration</code>中的额外参数+deploymentMode+，定制部署的方式。这个参数定义了对于一组符合过滤器的资源，组织部署的方式。默认这个参数有3个可用值：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>default</code>: 将所有资源组织在一个部署中，整体用于重复检测过滤。这是默认值，在未设置这个参数时也会用这个值。</p>
</li>
<li>
<p><code>single-resource</code>: 为每个资源创建一个单独的部署，并用于重复检测过滤。如果希望单独部署每一个流程定义，并且只有在它发生变化时才创建新的流程定义版本，就应该使用这个值。</p>
</li>
<li>
<p><code>resource-parent-folder</code>: 为同一个目录下的资源创建一个单独的部署，并用于重复检测过滤。这个参数值可以为大多数资源创建独立的部署。同时仍可以通过将部分资源放在同一个目录下，将它们组织在一起。这里有一个将<code>deploymentMode</code>设置为<code>single-resource</code>的例子：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span>
    <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.SpringProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  ...
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;deploymentResources&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;classpath*:/flowable/*.bpmn&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;deploymentMode&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;single-resource&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果上述<code>deploymentMode</code>的参数值不能满足要求，还可以自定义组织部署的行为。创建<code>SpringProcessEngineConfiguration</code>的子类，并覆盖<code>getAutoDeploymentStrategy(String deploymentMode)</code>方法。这个方法用于确定对给定的<code>deploymentMode</code>参数值，应使用何种部署策略。</p>
</div>
</div>
<div class="sect2">
<h3 id="springUnitTest">5.5. 单元测试</h3>
<div class="paragraph">
<p>与Spring集成后，业务流程可以非常简单地使用标准的 <a href="#apiUnitTesting">Flowable测试工具</a>进行测试。下面的例子展示了如何通过典型的基于Spring的单元测试，对业务流程进行测试：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</div></td><td class="code"><span></span><span class="tok-nd">@RunWith</span><span class="tok-o">(</span><span class="tok-n">SpringJUnit4ClassRunner</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-nd">@ContextConfiguration</span><span class="tok-o">(</span><span class="tok-s">&quot;classpath:org/flowable/spring/test/junit4/springTypicalUsageTest-context.xml&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyBusinessProcessTest</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Autowired</span>
  <span class="tok-kd">private</span> <span class="tok-n">RuntimeService</span> <span class="tok-n">runtimeService</span><span class="tok-o">;</span>

  <span class="tok-nd">@Autowired</span>
  <span class="tok-kd">private</span> <span class="tok-n">TaskService</span> <span class="tok-n">taskService</span><span class="tok-o">;</span>

  <span class="tok-nd">@Autowired</span>
  <span class="tok-nd">@Rule</span>
  <span class="tok-kd">public</span> <span class="tok-n">FlowableRule</span> <span class="tok-n">flowableSpringRule</span><span class="tok-o">;</span>

  <span class="tok-nd">@Test</span>
  <span class="tok-nd">@Deployment</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">simpleProcessTest</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;simpleProcess&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;My Task&quot;</span><span class="tok-o">,</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>

    <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">complete</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createProcessInstanceQuery</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">());</span>

  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意要让这个例子可以正常工作，需要在Spring配置中定义<em>org.flowable.engine.test.FlowableRule</em> bean（在上面的例子中通过@Autowire注入）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flowableRule&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.test.Flowable&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;processEngine&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;processEngine&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jpa_with_hibernate_4_2_x">5.6. 通过Hibernate 4.2.x使用JPA</h3>
<div class="paragraph">
<p>要在Flowable引擎的服务任务或者监听器逻辑中使用Hibernate 4.2.x JPA，需要添加Spring ORM的额外依赖。对Hibernate 4.1.x或更低则不需要。需要添加的依赖为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.springframework<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>spring-orm<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>${org.springframework.version}<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="springSpringBoot">5.7. Spring Boot</h3>
<div class="paragraph">
<p>Spring Boot是一个应用框架。按照<a href="http://projects.spring.io/spring-boot/">其官网</a>的介绍，可以<em>轻松地创建独立运行的，生产级别的，基于Spring的应用，并且可以“直接运行”。它基于约定大于配置的原则使用Spring框架与第三方库，使你可以轻松地开始使用。大多数Spring Boot应用只需要很少的Spring配置</em>。</p>
</div>
<div class="paragraph">
<p>要获得更多关于Spring Boot的信息，请查阅<a href="http://projects.spring.io/spring-boot/"><a href="http://projects.spring.io/spring-boot/" class="bare">http://projects.spring.io/spring-boot/</a></a></p>
</div>
<div class="paragraph">
<p>Flowable与Spring Boot的集成是我们与Spring的提交者共同开发的。</p>
</div>
<div class="sect3">
<h4 id="_compatibility">5.7.1. 兼容性</h4>
<div class="paragraph">
<p>Flowable使用同一个starter支持Spring Boot 2.0及1.5。主要支持Spring Boot 2.0。所以监控(actuator) endpoint只支持2.0。Flowable的starter直接引用Spring Boot starter，所以如果需要使用1.5版的Spring Boot starter，需要自行定义。</p>
</div>
</div>
<div class="sect3">
<h4 id="_getting_started_2">5.7.2. 开始</h4>
<div class="paragraph">
<p>Spring Boot提倡约定大于配置。要开始工作，只需在项目中添加<em>flowable-spring-boot-starter</em>或<em>flowable-spring-boot-starter-rest</em>依赖。如果不需要引入所有的引擎，可以查看其它的<a href="#springBootFlowableStarter">Flowable starter</a>。
如使用Maven：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>org.flowable<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>flowable-spring-boot-starter<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>${flowable.version}<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>就这么简单。这个依赖会自动向classpath添加正确的Flowable与Spring依赖。现在可以编写Spring Boot应用了：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-kn">import</span> <span class="tok-nn">org.springframework.boot.SpringApplication</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="tok-o">;</span>

<span class="tok-nd">@SpringBootApplication</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyApplication</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">SpringApplication</span><span class="tok-o">.</span><span class="tok-na">run</span><span class="tok-o">(</span><span class="tok-n">MyApplication</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-n">args</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Flowable需要数据库来存储数据。运行上面的代码会得到异常提示，指出需要在classpath中添加数据库驱动依赖。现在添加H2数据库依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
	<span class="tok-nt">&lt;groupId&gt;</span>com.h2database<span class="tok-nt">&lt;/groupId&gt;</span>
	<span class="tok-nt">&lt;artifactId&gt;</span>h2<span class="tok-nt">&lt;/artifactId&gt;</span>
	<span class="tok-nt">&lt;version&gt;</span>1.4.197<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>应用这次可以启动了。你会看到类似这样的输出：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::        (v2.0.0.RELEASE)

MyApplication                            : Starting MyApplication on ...
MyApplication                            : No active profile set, falling back to default profiles: default
ConfigServletWebServerApplicationContext : Refreshing org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext@4fdfa676: startup date [Wed Mar 28 12:04:00 CEST 2018]; root of context hierarchy
o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)
o.apache.catalina.core.StandardService   : Starting service [Tomcat]
org.apache.catalina.core.StandardEngine  : Starting Servlet Engine: Apache Tomcat/8.5.28
o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 3085 ms
o.s.b.w.servlet.ServletRegistrationBean  : Servlet dispatcherServlet mapped to [/]
o.s.b.w.servlet.ServletRegistrationBean  : Servlet Flowable IDM Rest API mapped to [/idm-api/*]
o.s.b.w.servlet.ServletRegistrationBean  : Servlet Flowable Form Rest API mapped to [/form-api/*]
o.s.b.w.servlet.ServletRegistrationBean  : Servlet Flowable DMN Rest API mapped to [/dmn-api/*]
o.s.b.w.servlet.ServletRegistrationBean  : Servlet Flowable Content Rest API mapped to [/content-api/*]
o.s.b.w.servlet.ServletRegistrationBean  : Servlet Flowable CMMN Rest API mapped to [/cmmn-api/*]
o.s.b.w.servlet.ServletRegistrationBean  : Servlet Flowable BPMN Rest API mapped to [/process-api/*]
o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'characterEncodingFilter' to: [/*]
o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'hiddenHttpMethodFilter' to: [/*]
o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'httpPutFormContentFilter' to: [/*]
o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: 'requestContextFilter' to: [/*]
uration$$EnhancerBySpringCGLIB$$3d0c70ac : No deployment resources were found for autodeployment
uration$$EnhancerBySpringCGLIB$$8131eb1a : No deployment resources were found for autodeployment
o.f.e.i.c.ProcessEngineConfigurationImpl : Found 5 Engine Configurators in total:
o.f.e.i.c.ProcessEngineConfigurationImpl : class org.flowable.spring.configurator.SpringIdmEngineConfigurator (priority:100000)
o.f.e.i.c.ProcessEngineConfigurationImpl : class org.flowable.dmn.spring.configurator.SpringDmnEngineConfigurator (priority:200000)
o.f.e.i.c.ProcessEngineConfigurationImpl : class org.flowable.form.spring.configurator.SpringFormEngineConfigurator (priority:300000)
o.f.e.i.c.ProcessEngineConfigurationImpl : class org.flowable.content.spring.configurator.SpringContentEngineConfigurator (priority:400000)
o.f.e.i.c.ProcessEngineConfigurationImpl : class org.flowable.cmmn.spring.configurator.SpringCmmnEngineConfigurator (priority:500000)
o.f.e.i.c.ProcessEngineConfigurationImpl : Executing beforeInit() of class org.flowable.spring.configurator.SpringIdmEngineConfigurator (priority:100000)
o.f.e.i.c.ProcessEngineConfigurationImpl : Executing beforeInit() of class org.flowable.dmn.spring.configurator.SpringDmnEngineConfigurator (priority:200000)
o.f.e.i.c.ProcessEngineConfigurationImpl : Executing beforeInit() of class org.flowable.form.spring.configurator.SpringFormEngineConfigurator (priority:300000)
o.f.e.i.c.ProcessEngineConfigurationImpl : Executing beforeInit() of class org.flowable.content.spring.configurator.SpringContentEngineConfigurator (priority:400000)
o.f.e.i.c.ProcessEngineConfigurationImpl : Executing beforeInit() of class org.flowable.cmmn.spring.configurator.SpringCmmnEngineConfigurator (priority:500000)
com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
o.f.e.i.c.ProcessEngineConfigurationImpl : Executing configure() of class org.flowable.spring.configurator.SpringIdmEngineConfigurator (priority:100000)
.d.AbstractSqlScriptBasedDbSchemaManager : performing create on identity with resource org/flowable/idm/db/create/flowable.h2.create.identity.sql
o.f.idm.engine.impl.IdmEngineImpl        : IdmEngine default created
o.f.e.i.c.ProcessEngineConfigurationImpl : Executing configure() of class org.flowable.dmn.spring.configurator.SpringDmnEngineConfigurator (priority:200000)
o.f.dmn.engine.impl.DmnEngineImpl        : DmnEngine default created
o.f.e.i.c.ProcessEngineConfigurationImpl : Executing configure() of class org.flowable.form.spring.configurator.SpringFormEngineConfigurator (priority:300000)
o.f.form.engine.impl.FormEngineImpl      : FormEngine default created
o.f.e.i.c.ProcessEngineConfigurationImpl : Executing configure() of class org.flowable.content.spring.configurator.SpringContentEngineConfigurator (priority:400000)
o.f.c.engine.ContentEngineConfiguration  : Content file system root : ...
o.f.c.engine.impl.ContentEngineImpl      : ContentEngine default created
o.f.e.i.c.ProcessEngineConfigurationImpl : Executing configure() of class org.flowable.cmmn.spring.configurator.SpringCmmnEngineConfigurator (priority:500000)
o.f.cmmn.engine.CmmnEngineConfiguration  : Found 1 Engine Configurators in total:
o.f.cmmn.engine.CmmnEngineConfiguration  : class org.flowable.cmmn.engine.impl.cfg.IdmEngineConfigurator (priority:100000)
o.f.cmmn.engine.CmmnEngineConfiguration  : Executing beforeInit() of class org.flowable.cmmn.engine.impl.cfg.IdmEngineConfigurator (priority:100000)
o.f.cmmn.engine.CmmnEngineConfiguration  : Executing configure() of class org.flowable.cmmn.engine.impl.cfg.IdmEngineConfigurator (priority:100000)
o.f.idm.engine.impl.IdmEngineImpl        : IdmEngine default created
o.f.cmmn.engine.impl.CmmnEngineImpl      : CmmnEngine default created
o.f.engine.impl.ProcessEngineImpl        : ProcessEngine default created
o.f.j.s.i.a.AbstractAsyncExecutor        : Starting up the async job executor [org.flowable.spring.job.service.SpringAsyncExecutor].
o.f.j.s.i.a.AcquireAsyncJobsDueRunnable  : starting to acquire async jobs due
o.f.j.s.i.a.AcquireTimerJobsRunnable     : starting to acquire async jobs due
o.f.j.s.i.a.ResetExpiredJobsRunnable     : starting to reset expired jobs
o.f.e.impl.cmd.ValidateV5EntitiesCmd     : Total of v5 deployments found: 0
s.w.s.m.m.a.RequestMappingHandlerAdapter : Looking for @ControllerAdvice: org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext@4fdfa676: startup date [Wed Mar 28 12:04:00 CEST 2018]; root of context hierarchy
s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped "{[/error]}" onto public org.springframework.http.ResponseEntity&lt;java.util.Map&lt;java.lang.String, java.lang.Object&gt;&gt; org.springframework.boot.autoconfigure.web.servlet.error.BasicErrorController.error(javax.servlet.http.HttpServletRequest)
s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped "{[/error],produces=[text/html]}" onto public org.springframework.web.servlet.ModelAndView org.springframework.boot.autoconfigure.web.servlet.error.BasicErrorController.errorHtml(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse)
o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/webjars/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/**/favicon.ico] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
o.s.j.e.a.AnnotationMBeanExporter        : Registering beans for JMX exposure on startup
o.s.j.e.a.AnnotationMBeanExporter        : Bean with name 'dataSource' has been autodetected for JMX exposure
o.s.j.e.a.AnnotationMBeanExporter        : Located MBean 'dataSource': registering with JMX server as MBean [com.zaxxer.hikari:name=dataSource,type=HikariDataSource]
o.s.c.support.DefaultLifecycleProcessor  : Starting beans in phase -20
o.s.c.support.DefaultLifecycleProcessor  : Starting beans in phase 0
o.s.c.support.DefaultLifecycleProcessor  : Starting beans in phase 20
o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''
flowable.Application                     : Started Application in 18.235 seconds (JVM running for 19.661)</pre>
</div>
</div>
<div class="paragraph">
<p>只是在classpath中添加依赖，并使用<em>@SpringBootAplication</em>注解，就会在幕后发生很多事情：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>自动创建了内存数据库（因为classpath中有H2驱动），并传递给Flowable流程引擎配置</p>
</li>
<li>
<p>创建并暴露了Flowable的ProcessEngine、CmmnEngine、DmnEngine、FormEngine、ContentEngine及IdmEngine bean</p>
</li>
<li>
<p>所有的Flowable服务都暴露为Spring bean</p>
</li>
<li>
<p>创建了Spring Job Executor</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>并且：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>processes</em>目录下的任何BPMN 2.0流程定义都会被自动部署。创建<em>processes</em>目录，并在其中创建示例流程定义（命名为<em>one-task-process.bpmn20.xml</em>）。</p>
</li>
<li>
<p><em>cases</em>目录下的任何CMMN 1.1事例都会被自动部署。</p>
</li>
<li>
<p><em>forms</em>目录下的任何Form定义都会被自动部署。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-nt">&lt;definitions</span>
        <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot;</span>
        <span class="tok-na">xmlns:flowable=</span><span class="tok-s">&quot;http://flowable.org/bpmn&quot;</span>
        <span class="tok-na">targetNamespace=</span><span class="tok-s">&quot;Examples&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;oneTaskProcess&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;The One Task Process&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;my task&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/process&gt;</span>

<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>然后添加下列代码，以测试部署是否生效。<em>CommandLineRunner</em>是一个特殊的Spring bean，在应用启动时执行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</div></td><td class="code"><span></span><span class="tok-nd">@SpringBootApplication</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyApplication</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">SpringApplication</span><span class="tok-o">.</span><span class="tok-na">run</span><span class="tok-o">(</span><span class="tok-n">MyApplication</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-n">args</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Bean</span>
    <span class="tok-kd">public</span> <span class="tok-n">CommandLineRunner</span> <span class="tok-nf">init</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">RepositoryService</span> <span class="tok-n">repositoryService</span><span class="tok-o">,</span>
                                  <span class="tok-kd">final</span> <span class="tok-n">RuntimeService</span> <span class="tok-n">runtimeService</span><span class="tok-o">,</span>
                                  <span class="tok-kd">final</span> <span class="tok-n">TaskService</span> <span class="tok-n">taskService</span><span class="tok-o">)</span> <span class="tok-o">{</span>

        <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-n">CommandLineRunner</span><span class="tok-o">()</span> <span class="tok-o">{</span>
            <span class="tok-nd">@Override</span>
            <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">...</span> <span class="tok-n">strings</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
                <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Number of process definitions : &quot;</span>
                	<span class="tok-o">+</span> <span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">createProcessDefinitionQuery</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">());</span>
                <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Number of tasks : &quot;</span> <span class="tok-o">+</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">());</span>
                <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;oneTaskProcess&quot;</span><span class="tok-o">);</span>
                <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Number of tasks after process start: &quot;</span>
                    <span class="tok-o">+</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">());</span>
            <span class="tok-o">}</span>
        <span class="tok-o">};</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>会得到这样的输出：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Number of process definitions : 1
Number of tasks : 0
Number of tasks after process start : 1</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_changing_the_database_and_connection_pool">5.7.3. 更换数据源与连接池</h4>
<div class="paragraph">
<p>上面也提到过，Spring Boot的约定大于配置。默认情况下，如果classpath中只有H2，就会创建内存数据库，并传递给Flowable流程引擎配置。</p>
</div>
<div class="paragraph">
<p>只要添加一个数据库驱动的依赖并提供数据库URL，就可以更换数据源。例如，要切换到MySQL数据库：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="linenums"><span></span>spring.datasource.url=jdbc:mysql://127.0.0.1:3306/flowable-spring-boot?characterEncoding=UTF-8
spring.datasource.username=flowable
spring.datasource.password=flowable</code></pre>
</div>
</div>
<div class="paragraph">
<p>从Maven依赖中移除H2，并在classpath中添加MySQL驱动：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>mysql<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>5.1.45<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这次应用启动后，可以看到使用了MySQL作为数据库（并使用HikariCP连接池框架）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>org.flowable.engine.impl.db.DbSqlSession   : performing create on engine with resource org/flowable/db/create/flowable.mysql.create.engine.sql
org.flowable.engine.impl.db.DbSqlSession   : performing create on history with resource org/flowable/db/create/flowable.mysql.create.history.sql
org.flowable.engine.impl.db.DbSqlSession   : performing create on identity with resource org/flowable/db/create/flowable.mysql.create.identity.sql</pre>
</div>
</div>
<div class="paragraph">
<p>多次重启应用，会发现任务的数量增加了（H2内存数据库在关闭后会丢失，而MySQL不会）。</p>
</div>
<div class="paragraph">
<p>关于配置数据源的更多信息，可以在Spring Boot的参考手册中<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-sql.html#boot-features-configure-datasource">Configure a DataSource(配置数据源)</a>章节查看。</p>
</div>
</div>
<div class="sect3">
<h4 id="_rest_support">5.7.4. REST 支持</h4>
<div class="paragraph">
<p>通常会在嵌入的Flowable引擎之上，使用REST API（用于与公司的不同服务交互）。Spring Boot让这变得很容易。在classpath中添加下列依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>org.springframework.boot<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>${spring.boot.version}<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>创建一个新的Spring服务类，并创建两个方法：一个用于启动流程，另一个用于获得给定任务办理人的任务列表。在这里只是简单地包装了Flowable调用，但在实际使用场景中会比这复杂得多。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-nd">@Service</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyService</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Autowired</span>
    <span class="tok-kd">private</span> <span class="tok-n">RuntimeService</span> <span class="tok-n">runtimeService</span><span class="tok-o">;</span>

    <span class="tok-nd">@Autowired</span>
    <span class="tok-kd">private</span> <span class="tok-n">TaskService</span> <span class="tok-n">taskService</span><span class="tok-o">;</span>

    <span class="tok-nd">@Transactional</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">startProcess</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;oneTaskProcess&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Transactional</span>
    <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-nf">getTasks</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">assignee</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">taskAssignee</span><span class="tok-o">(</span><span class="tok-n">assignee</span><span class="tok-o">).</span><span class="tok-na">list</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>现在可以用<em>@RestController</em>来注解类，以创建REST endpoint。在这里我们简单地调用上面定义的服务。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</div></td><td class="code"><span></span><span class="tok-nd">@RestController</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyRestController</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Autowired</span>
    <span class="tok-kd">private</span> <span class="tok-n">MyService</span> <span class="tok-n">myService</span><span class="tok-o">;</span>

    <span class="tok-nd">@RequestMapping</span><span class="tok-o">(</span><span class="tok-n">value</span><span class="tok-o">=</span><span class="tok-s">&quot;/process&quot;</span><span class="tok-o">,</span> <span class="tok-n">method</span><span class="tok-o">=</span> <span class="tok-n">RequestMethod</span><span class="tok-o">.</span><span class="tok-na">POST</span><span class="tok-o">)</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">startProcessInstance</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">myService</span><span class="tok-o">.</span><span class="tok-na">startProcess</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@RequestMapping</span><span class="tok-o">(</span><span class="tok-n">value</span><span class="tok-o">=</span><span class="tok-s">&quot;/tasks&quot;</span><span class="tok-o">,</span> <span class="tok-n">method</span><span class="tok-o">=</span> <span class="tok-n">RequestMethod</span><span class="tok-o">.</span><span class="tok-na">GET</span><span class="tok-o">,</span> <span class="tok-n">produces</span><span class="tok-o">=</span><span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">APPLICATION_JSON_VALUE</span><span class="tok-o">)</span>
    <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">TaskRepresentation</span><span class="tok-o">&gt;</span> <span class="tok-nf">getTasks</span><span class="tok-o">(</span><span class="tok-nd">@RequestParam</span> <span class="tok-n">String</span> <span class="tok-n">assignee</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">myService</span><span class="tok-o">.</span><span class="tok-na">getTasks</span><span class="tok-o">(</span><span class="tok-n">assignee</span><span class="tok-o">);</span>
        <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">TaskRepresentation</span><span class="tok-o">&gt;</span> <span class="tok-n">dtos</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">TaskRepresentation</span><span class="tok-o">&gt;();</span>
        <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">:</span> <span class="tok-n">tasks</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">dtos</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TaskRepresentation</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">(),</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">()));</span>
        <span class="tok-o">}</span>
        <span class="tok-k">return</span> <span class="tok-n">dtos</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">TaskRepresentation</span> <span class="tok-o">{</span>

        <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">;</span>
        <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>

        <span class="tok-kd">public</span> <span class="tok-nf">TaskRepresentation</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">id</span> <span class="tok-o">=</span> <span class="tok-n">id</span><span class="tok-o">;</span>
            <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">name</span> <span class="tok-o">=</span> <span class="tok-n">name</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>

        <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getId</span><span class="tok-o">()</span> <span class="tok-o">{</span>
            <span class="tok-k">return</span> <span class="tok-n">id</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>
        <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setId</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">id</span> <span class="tok-o">=</span> <span class="tok-n">id</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>
        <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getName</span><span class="tok-o">()</span> <span class="tok-o">{</span>
            <span class="tok-k">return</span> <span class="tok-n">name</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>
        <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setName</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">name</span> <span class="tok-o">=</span> <span class="tok-n">name</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>

    <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring Boot会自动扫描组件，并找到我们添加在应用类上的<em>@Service</em>与<em>@RestController</em>。再次运行应用，现在可以与REST API交互了。例如使用cURL：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl http://localhost:8080/tasks?assignee=kermit
[]

curl -X POST  http://localhost:8080/process
curl http://localhost:8080/tasks?assignee=kermit
[{"id":"10004","name":"my task"}]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jpa_support">5.7.5. JPA 支持</h4>
<div class="paragraph">
<p>要为Spring Boot中的Flowable添加JPA支持，增加下列依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>org.flowable<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>flowable-spring-boot-starter<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>${flowable.version}<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>org.springframework.boot<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>spring-boot-starter-data-jpa<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>${spring-boot.version<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这会加入JPA用的Spring配置以及bean。默认使用Hibernate作为JPA提供者。</p>
</div>
<div class="paragraph">
<p>创建一个简单的实体类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65</div></td><td class="code"><span></span><span class="tok-nd">@Entity</span>
<span class="tok-kd">class</span> <span class="tok-nc">Person</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Id</span>
    <span class="tok-nd">@GeneratedValue</span>
    <span class="tok-kd">private</span> <span class="tok-n">Long</span> <span class="tok-n">id</span><span class="tok-o">;</span>

    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">username</span><span class="tok-o">;</span>

    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">firstName</span><span class="tok-o">;</span>

    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">lastName</span><span class="tok-o">;</span>

    <span class="tok-kd">private</span> <span class="tok-n">Date</span> <span class="tok-n">birthDate</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">Person</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-nf">Person</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">username</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">firstName</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">lastName</span><span class="tok-o">,</span> <span class="tok-n">Date</span> <span class="tok-n">birthDate</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">username</span> <span class="tok-o">=</span> <span class="tok-n">username</span><span class="tok-o">;</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">firstName</span> <span class="tok-o">=</span> <span class="tok-n">firstName</span><span class="tok-o">;</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">lastName</span> <span class="tok-o">=</span> <span class="tok-n">lastName</span><span class="tok-o">;</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">birthDate</span> <span class="tok-o">=</span> <span class="tok-n">birthDate</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">Long</span> <span class="tok-nf">getId</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">id</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setId</span><span class="tok-o">(</span><span class="tok-n">Long</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">id</span> <span class="tok-o">=</span> <span class="tok-n">id</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getUsername</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">username</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setUsername</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">username</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">username</span> <span class="tok-o">=</span> <span class="tok-n">username</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getFirstName</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">firstName</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setFirstName</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">firstName</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">firstName</span> <span class="tok-o">=</span> <span class="tok-n">firstName</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getLastName</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">lastName</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setLastName</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">lastName</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">lastName</span> <span class="tok-o">=</span> <span class="tok-n">lastName</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">Date</span> <span class="tok-nf">getBirthDate</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">birthDate</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setBirthDate</span><span class="tok-o">(</span><span class="tok-n">Date</span> <span class="tok-n">birthDate</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">birthDate</span> <span class="tok-o">=</span> <span class="tok-n">birthDate</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>默认情况下，如果没有使用内存数据库则不会自动创建数据库表。在classpath中创建<em>application.properties</em>文件并加入下列参数：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring.jpa.hibernate.ddl-auto=update</pre>
</div>
</div>
<div class="paragraph">
<p>添加下列类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nd">@Repository</span>
<span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">PersonRepository</span> <span class="tok-kd">extends</span> <span class="tok-n">JpaRepository</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">,</span> <span class="tok-n">Long</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>

    <span class="tok-n">Person</span> <span class="tok-nf">findByUsername</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">username</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这是一个Spring repository，提供了直接可用的增删改查。我们添加了通过username查找Person的方法。Spring会基于约定自动实现它（也就是使用names属性）。</p>
</div>
<div class="paragraph">
<p>现在进一步增强我们的服务：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在类上添加<em>@Transactional</em>。请注意，通过上面添加的JPA依赖，之前使用的DataSourceTransactionManager会自动替换为JpaTransactionManager。</p>
</li>
<li>
<p><em>startProcess</em>增加了任务办理人入参，用于查找Person，并将Person JPA对象作为流程变量存入流程实例。</p>
</li>
<li>
<p>添加了创建示例用户的方法。CommandLineRunner使用它打桩数据库。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</div></td><td class="code"><span></span><span class="tok-nd">@Service</span>
<span class="tok-nd">@Transactional</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyService</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Autowired</span>
    <span class="tok-kd">private</span> <span class="tok-n">RuntimeService</span> <span class="tok-n">runtimeService</span><span class="tok-o">;</span>

    <span class="tok-nd">@Autowired</span>
    <span class="tok-kd">private</span> <span class="tok-n">TaskService</span> <span class="tok-n">taskService</span><span class="tok-o">;</span>

    <span class="tok-nd">@Autowired</span>
    <span class="tok-kd">private</span> <span class="tok-n">PersonRepository</span> <span class="tok-n">personRepository</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">startProcess</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">assignee</span><span class="tok-o">)</span> <span class="tok-o">{</span>

        <span class="tok-n">Person</span> <span class="tok-n">person</span> <span class="tok-o">=</span> <span class="tok-n">personRepository</span><span class="tok-o">.</span><span class="tok-na">findByUsername</span><span class="tok-o">(</span><span class="tok-n">assignee</span><span class="tok-o">);</span>

        <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">variables</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;();</span>
        <span class="tok-n">variables</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;person&quot;</span><span class="tok-o">,</span> <span class="tok-n">person</span><span class="tok-o">);</span>
        <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;oneTaskProcess&quot;</span><span class="tok-o">,</span> <span class="tok-n">variables</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-nf">getTasks</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">assignee</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">taskAssignee</span><span class="tok-o">(</span><span class="tok-n">assignee</span><span class="tok-o">).</span><span class="tok-na">list</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">createDemoUsers</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">personRepository</span><span class="tok-o">.</span><span class="tok-na">findAll</span><span class="tok-o">().</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">personRepository</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;jbarrez&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Joram&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Barrez&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()));</span>
            <span class="tok-n">personRepository</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;trademakers&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Tijs&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Rademakers&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()));</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>CommandLineRunner现在为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nd">@Bean</span>
<span class="tok-kd">public</span> <span class="tok-n">CommandLineRunner</span> <span class="tok-nf">init</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">MyService</span> <span class="tok-n">myService</span><span class="tok-o">)</span> <span class="tok-o">{</span>

    <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-n">CommandLineRunner</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">run</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">...</span> <span class="tok-n">strings</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
        	<span class="tok-n">myService</span><span class="tok-o">.</span><span class="tok-na">createDemoUsers</span><span class="tok-o">();</span>
        <span class="tok-o">}</span>
    <span class="tok-o">};</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>RestController也有小改动（只展示新方法），以配合上面的修改。HTTP POST使用body传递办理人用户名：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</div></td><td class="code"><span></span><span class="tok-nd">@RestController</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyRestController</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Autowired</span>
    <span class="tok-kd">private</span> <span class="tok-n">MyService</span> <span class="tok-n">myService</span><span class="tok-o">;</span>

    <span class="tok-nd">@RequestMapping</span><span class="tok-o">(</span><span class="tok-n">value</span><span class="tok-o">=</span><span class="tok-s">&quot;/process&quot;</span><span class="tok-o">,</span> <span class="tok-n">method</span><span class="tok-o">=</span> <span class="tok-n">RequestMethod</span><span class="tok-o">.</span><span class="tok-na">POST</span><span class="tok-o">)</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">startProcessInstance</span><span class="tok-o">(</span><span class="tok-nd">@RequestBody</span> <span class="tok-n">StartProcessRepresentation</span> <span class="tok-n">startProcessRepresentation</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">myService</span><span class="tok-o">.</span><span class="tok-na">startProcess</span><span class="tok-o">(</span><span class="tok-n">startProcessRepresentation</span><span class="tok-o">.</span><span class="tok-na">getAssignee</span><span class="tok-o">());</span>
    <span class="tok-o">}</span>

   <span class="tok-o">...</span>

    <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">StartProcessRepresentation</span> <span class="tok-o">{</span>

        <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">assignee</span><span class="tok-o">;</span>

        <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getAssignee</span><span class="tok-o">()</span> <span class="tok-o">{</span>
            <span class="tok-k">return</span> <span class="tok-n">assignee</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>

        <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setAssignee</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">assignee</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">assignee</span> <span class="tok-o">=</span> <span class="tok-n">assignee</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>最后，为了试用Spring-JPA-Flowable集成，我们在流程定义中，将Person JPA对象的ID指派为任务办理人：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;my task&quot;</span> <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;${person.id}&quot;</span><span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>现在可以在POST body中提供用户名，启动一个新的流程实例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -H "Content-Type: application/json" -d '{"assignee" : "jbarrez"}' http://localhost:8080/process</pre>
</div>
</div>
<div class="paragraph">
<p>可以使用Person id获取任务列表：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl http://localhost:8080/tasks?assignee=1

[{"id":"12505","name":"my task"}]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="springBootActuatorEndpoint">5.7.6. Flowable Actuator Endpoint</h4>
<div class="paragraph">
<p>Flowable提供了Spring Boot Actuator Endpoint，以提供正在运行的流程的信息。
默认情况下 <code>flowable</code> 端点映射至 <code>/actuator/flowable</code> 。
Spring Boot默认只提供 <code>info</code> 与 <code>health</code> 端点。要启用 <code>flowable</code> 端点，需要在 <code>application.properties</code> 中添加 <code>management.endpoint.flowable.enabled=true</code> 。</p>
</div>
<div class="paragraph">
<p><code>curl http://localhost:8080/actuator/flowable</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span>
<span class="tok-p">{</span>
  <span class="tok-nt">&quot;completedTaskCountToday&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;deployedProcessDefinitions&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-s2">&quot;oneTaskProcess (v1)&quot;</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;processDefinitionCount&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;cachedProcessDefinitionCount&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;runningProcessInstanceCount&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
    <span class="tok-nt">&quot;oneTaskProcess (v1)&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span>
  <span class="tok-p">},</span>
  <span class="tok-nt">&quot;completedTaskCount&quot;</span><span class="tok-p">:</span> <span class="tok-mi">2</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;completedActivities&quot;</span><span class="tok-p">:</span> <span class="tok-mi">3</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;completedProcessInstanceCount&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
    <span class="tok-nt">&quot;oneTaskProcess (v1)&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span>
  <span class="tok-p">},</span>
  <span class="tok-nt">&quot;openTaskCount&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>要了解Spring Boot Actuator的更多信息，可以在Spring Boot参考手册中查看<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-endpoints.html">Production Ready Endpoint(生产可用的端点)</a>。</p>
</div>
</div>
<div class="sect3">
<h4 id="springBootInfoContributor">5.7.7. Flowable Info Contributor</h4>
<div class="paragraph">
<p>Flowable也提供了Spring Boot的 <code>InfoContributor</code> ：</p>
</div>
<div class="paragraph">
<p><code>curl http://localhost:8080/actuator/info</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;flowable&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
    <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;6.3.0.1&quot;</span>
  <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="springBootFlowableProperties">5.7.8. 配置Flowable应用</h4>
<div class="paragraph">
<p>Flowable会自动配置用于控制Spring Boot的参数与配置。参见Spring Boot参考手册中的<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto-properties-and-configuration.html">Properties and Configuration(参数与配置)</a>。</p>
</div>
<div class="paragraph">
<p>下面是Flowable Spring Boot支持的配置参数列表。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="properties"><span></span>
<span class="tok-c"># ===================================================================</span>
<span class="tok-c"># Common Flowable Spring Boot Properties</span>
<span class="tok-c"># 通用Flowable Spring Boot参数</span>
<span class="tok-c">#</span>
<span class="tok-c"># This sample file is provided as a guideline. Do NOT copy it in its</span>
<span class="tok-c"># entirety to your own application.	           ^^^</span>
<span class="tok-c"># 本示例文件只作为指导。请不要直接拷贝至你自己的应用中。</span>
<span class="tok-c"># ===================================================================</span>

<span class="tok-c"># Core (Process) <a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/FlowableProperties.java">FlowableProperties</a></span>
<span class="tok-c"># 核心（流程）</span>
<span class="tok-na">flowable.check-process-definitions</span><span class="tok-o">=</span><span class="tok-s">true # 是否需要自动部署流程定义。</span>
<span class="tok-na">flowable.custom-mybatis-mappers</span><span class="tok-o">=</span> <span class="tok-s"># 需要添加至引擎的自定义Mybatis映射的FQN。</span>
<span class="tok-na">flowable.custom-mybatis-x-m-l-mappers</span><span class="tok-o">=</span> <span class="tok-s"># 需要添加至引擎的自定义Mybatis XML映射的路径。</span>
<span class="tok-na">flowable.database-schema</span><span class="tok-o">=</span> <span class="tok-s"># 如果数据库返回的元数据不正确，可以在这里设置schema用于检测/生成表。</span>
<span class="tok-na">flowable.database-schema-update</span><span class="tok-o">=</span><span class="tok-s">true # 数据库schema更新策略。</span>
<span class="tok-na">flowable.db-history-used</span><span class="tok-o">=</span><span class="tok-s">true # 是否要使用db历史。</span>
<span class="tok-na">flowable.deployment-name</span><span class="tok-o">=</span><span class="tok-s">SpringBootAutoDeployment # 自动部署的名称。</span>
<span class="tok-na">flowable.history-level</span><span class="tok-o">=</span><span class="tok-s">audit # 要使用的历史级别。</span>
<span class="tok-na">flowable.process-definition-location-prefix</span><span class="tok-o">=</span><span class="tok-s">classpath*:/processes/ # 自动部署时查找流程的目录。</span>
<span class="tok-na">flowable.process-definition-location-suffixes</span><span class="tok-o">=</span><span class="tok-s">**.bpmn20.xml,**.bpmn # &#39;processDefinitionLocationPrefix&#39;路径下需要部署的文件的后缀（扩展名）。</span>

<span class="tok-c"># Process <a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/process/FlowableProcessProperties.java">FlowableProcessProperties</a></span>
<span class="tok-c"># 流程</span>
<span class="tok-na">flowable.process.definition-cache-limit</span><span class="tok-o">=</span><span class="tok-s">-1 # 流程定义缓存中保存流程定义的最大数量。默认值为-1（缓存所有流程定义）。</span>
<span class="tok-na">flowable.process.enable-safe-xml</span><span class="tok-o">=</span><span class="tok-s">true # 在解析BPMN XML文件时进行额外检查。参见 <a href="https://www.flowable.org/docs/userguide/index.html#advanced.safe.bpmn.xml" class="bare">https://www.flowable.org/docs/userguide/index.html#advanced.safe.bpmn.xml</a> 。不幸的是，部分平台（JDK 6，JBoss）上无法使用这个功能，因此如果你所用的平台在XML解析时不支持StaxSource，需要禁用这个功能。</span>
<span class="tok-na">flowable.process.servlet.load-on-startup</span><span class="tok-o">=</span><span class="tok-s">-1 # 启动时加载Process servlet。</span>
<span class="tok-na">flowable.process.servlet.name</span><span class="tok-o">=</span><span class="tok-s">Flowable BPMN Rest API # Process servlet的名字。</span>
<span class="tok-na">flowable.process.servlet.path</span><span class="tok-o">=</span><span class="tok-s">/process-api # Process servelet的context path。</span>

<span class="tok-c"># Process Async Executor</span>
<span class="tok-c"># 流程异步执行器</span>
<span class="tok-na">flowable.process.async-executor-activate</span><span class="tok-o">=</span><span class="tok-s">true # 是否启用异步执行器。</span>
<span class="tok-na">flowable.process.async.executor.async-job-lock-time-in-millis</span><span class="tok-o">=</span><span class="tok-s">300000 # 异步作业在被异步执行器取走后的锁定时间（以毫秒计）。在这段时间内，其它异步执行器不会尝试获取及锁定这个任务。</span>
<span class="tok-na">flowable.process.async.executor.default-async-job-acquire-wait-time-in-millis</span><span class="tok-o">=</span><span class="tok-s">10000 # 异步作业获取线程在进行下次获取查询前的等待时间（以毫秒计）。只在当次没有取到新的异步作业，或者只取到很少的异步作业时生效。默认值 = 10秒。</span>
<span class="tok-na">flowable.process.async.executor.default-queue-size-full-wait-time-in-millis</span><span class="tok-o">=</span><span class="tok-s">0 # 异步作业（包括定时器作业与异步执行）获取线程在队列满时，等待执行下次查询的等待时间（以毫秒计）。默认值为0（以向后兼容）</span>
<span class="tok-na">flowable.process.async.executor.default-timer-job-acquire-wait-time-in-millis</span><span class="tok-o">=</span><span class="tok-s">10000 # 定时器作业获取线程在进行下次获取查询前的等待时间（以毫秒计）。只在当次没有取到新的定时器作业，或者只取到很少的定时器作业时生效。默认值 = 10秒。</span>
<span class="tok-na">flowable.process.async.executor.max-async-jobs-due-per-acquisition</span><span class="tok-o">=</span><span class="tok-s">1 # （译者补）单次查询的异步作业数量。默认值为1，以降低乐观锁异常的可能性。除非你知道自己在做什么，否则请不要修改这个值。</span>
<span class="tok-na">flowable.process.async.executor.retry-wait-time-in-millis</span><span class="tok-o">=</span><span class="tok-s">500 # ???（译者补不了了）</span>
<span class="tok-na">flowable.process.async.executor.timer-lock-time-in-millis</span><span class="tok-o">=</span><span class="tok-s">300000 # 定时器作业在被异步执行器取走后的锁定时间（以毫秒计）。在这段时间内，其它异步执行器不会尝试获取及锁定这个任务。</span>


<span class="tok-c"># CMMN <a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/cmmn/FlowableCmmnProperties.java">FlowableCmmnProperties</a></span>
<span class="tok-na">flowable.cmmn.deploy-resources</span><span class="tok-o">=</span><span class="tok-s">true # 是否部署资源。默认值为&#39;true&#39;。</span>
<span class="tok-na">flowable.cmmn.deployment-name</span><span class="tok-o">=</span><span class="tok-s">SpringBootAutoDeployment # CMMN资源部署的名字。</span>
<span class="tok-na">flowable.cmmn.enable-safe-xml</span><span class="tok-o">=</span><span class="tok-s">true # 在解析CMMN XML文件时进行额外检查。参见 <a href="https://www.flowable.org/docs/userguide/index.html#advanced.safe.bpmn.xml" class="bare">https://www.flowable.org/docs/userguide/index.html#advanced.safe.bpmn.xml</a> 。不幸的是，部分平台（JDK 6，JBoss）上无法使用这个功能，因此如果你所用的平台在XML解析时不支持StaxSource，需要禁用这个功能。</span>
<span class="tok-na">flowable.cmmn.enabled</span><span class="tok-o">=</span><span class="tok-s">true # 是否启用CMMN引擎。</span>
<span class="tok-na">flowable.cmmn.resource-location</span><span class="tok-o">=</span><span class="tok-s">classpath*:/cases/ # CMMN资源的路径。</span>
<span class="tok-na">flowable.cmmn.resource-suffixes</span><span class="tok-o">=</span><span class="tok-s">**.cmmn,**.cmmn11,**.cmmn.xml,**.cmmn11.xml # 需要扫描的资源后缀名。</span>
<span class="tok-na">flowable.cmmn.servlet.load-on-startup</span><span class="tok-o">=</span><span class="tok-s">-1 # 启动时加载CMMN servlet。</span>
<span class="tok-na">flowable.cmmn.servlet.name</span><span class="tok-o">=</span><span class="tok-s">Flowable CMMN Rest API # CMMN servlet的名字。</span>
<span class="tok-na">flowable.cmmn.servlet.path</span><span class="tok-o">=</span><span class="tok-s">/cmmn-api # CMMN servlet的context path。</span>

<span class="tok-c"># CMMN Async Executor</span>
<span class="tok-c"># CMMN异步执行器</span>
<span class="tok-na">flowable.cmmn.async-executor-activate</span><span class="tok-o">=</span><span class="tok-s">true # 是否启用异步执行器。</span>
<span class="tok-na">flowable.cmmn.async.executor.async-job-lock-time-in-millis</span><span class="tok-o">=</span><span class="tok-s">300000 # 异步作业在被异步执行器取走后的锁定时间（以毫秒计）。在这段时间内，其它异步执行器不会尝试获取及锁定这个任务。</span>
<span class="tok-na">flowable.cmmn.async.executor.default-async-job-acquire-wait-time-in-millis</span><span class="tok-o">=</span><span class="tok-s">10000 # 异步作业获取线程在进行下次获取查询前的等待时间（以毫秒计）。只在当次没有取到新的异步作业，或者只取到很少的异步作业时生效。默认值 = 10秒。</span>
<span class="tok-na">flowable.cmmn.async.executor.default-queue-size-full-wait-time-in-millis</span><span class="tok-o">=</span><span class="tok-s">0 # 异步作业（包括定时器作业与异步执行）获取线程在队列满时，等待执行下次查询的等待时间（以毫秒计）。默认值为0（以向后兼容）</span>
<span class="tok-na">flowable.cmmn.async.executor.default-timer-job-acquire-wait-time-in-millis</span><span class="tok-o">=</span><span class="tok-s">10000 # 定时器作业获取线程在进行下次获取查询前的等待时间（以毫秒计）。只在当次没有取到新的定时器作业，或者只取到很少的定时器作业时生效。默认值 = 10秒。</span>
<span class="tok-na">flowable.cmmn.async.executor.max-async-jobs-due-per-acquisition</span><span class="tok-o">=</span><span class="tok-s">1 # （译者补）单次查询的异步作业数量。默认值为1，以降低乐观锁异常的可能性。除非你知道自己在做什么，否则请不要修改这个值。</span>
<span class="tok-na">flowable.cmmn.async.executor.retry-wait-time-in-millis</span><span class="tok-o">=</span><span class="tok-s">500 #（译者补不了了）</span>
<span class="tok-na">flowable.cmmn.async.executor.timer-lock-time-in-millis</span><span class="tok-o">=</span><span class="tok-s">300000 # 定时器作业在被异步执行器取走后的锁定时间（以毫秒计）。在这段时间内，其它异步执行器不会尝试获取及锁定这个任务。</span>

<span class="tok-c"># Content <a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/content/FlowableContentProperties.java">FlowableContentProperties</a></span>
<span class="tok-na">flowable.content.enabled</span><span class="tok-o">=</span><span class="tok-s">true # 是否启动Content引擎。</span>
<span class="tok-na">flowable.content.servlet.load-on-startup</span><span class="tok-o">=</span><span class="tok-s">-1 # 启动时加载Content servlet。</span>
<span class="tok-na">flowable.content.servlet.name</span><span class="tok-o">=</span><span class="tok-s">Flowable Content Rest API # Content servlet的名字。</span>
<span class="tok-na">flowable.content.servlet.path</span><span class="tok-o">=</span><span class="tok-s">/content-api # Content servlet的context path。</span>
<span class="tok-na">flowable.content.storage.create-root</span><span class="tok-o">=</span><span class="tok-s">true # 如果根路径不存在，是否需要创建？</span>
<span class="tok-na">flowable.content.storage.root-folder</span><span class="tok-o">=</span> <span class="tok-s"># 存储content文件（如上传的任务附件，或表单文件）的根路径。</span>

<span class="tok-c"># DMN <a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/dmn/FlowableDmnProperties.java">FlowableDmnProperties</a></span>
<span class="tok-na">flowable.dmn.deploy-resources</span><span class="tok-o">=</span><span class="tok-s">true # 是否部署资源。默认为&#39;true&#39;。</span>
<span class="tok-na">flowable.dmn.deployment-name</span><span class="tok-o">=</span><span class="tok-s">SpringBootAutoDeployment # DMN资源部署的名字。</span>
<span class="tok-na">flowable.dmn.enable-safe-xml</span><span class="tok-o">=</span><span class="tok-s">true # 在解析DMN XML文件时进行额外检查。参见 <a href="https://www.flowable.org/docs/userguide/index.html#advanced.safe.bpmn.xml" class="bare">https://www.flowable.org/docs/userguide/index.html#advanced.safe.bpmn.xml</a> 。不幸的是，部分平台（JDK 6，JBoss）上无法使用这个功能，因此如果你所用的平台在XML解析时不支持StaxSource，需要禁用这个功能。</span>
<span class="tok-na">flowable.dmn.enabled</span><span class="tok-o">=</span><span class="tok-s">true # 是否启用DMN引擎。</span>
<span class="tok-na">flowable.dmn.history-enabled</span><span class="tok-o">=</span><span class="tok-s">true # 是否启用DMN引擎的历史。</span>
<span class="tok-na">flowable.dmn.resource-location</span><span class="tok-o">=</span><span class="tok-s">classpath*:/dmn/ # DMN资源的路径。</span>
<span class="tok-na">flowable.dmn.resource-suffixes</span><span class="tok-o">=</span><span class="tok-s">**.dmn,**.dmn.xml,**.dmn11,**.dmn11.xml # 需要扫描的资源后缀名。</span>
<span class="tok-na">flowable.dmn.servlet.load-on-startup</span><span class="tok-o">=</span><span class="tok-s">-1 # 启动时加载DMN servlet。</span>
<span class="tok-na">flowable.dmn.servlet.name</span><span class="tok-o">=</span><span class="tok-s">Flowable DMN Rest API # DMN servlet的名字。</span>
<span class="tok-na">flowable.dmn.servlet.path</span><span class="tok-o">=</span><span class="tok-s">/dmn-api # DMN servlet的context path。</span>
<span class="tok-na">flowable.dmn.strict-mode</span><span class="tok-o">=</span><span class="tok-s">true # 如果希望避免抉择表命中策略检查导致失败，可以将本参数设置为false。如果检查发现了错误，会直接返回错误前一刻的中间结果。</span>

<span class="tok-c"># Form <a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/form/FlowableFormProperties.java">FlowableFormProperties</a></span>
<span class="tok-na">flowable.form.deploy-resources</span><span class="tok-o">=</span><span class="tok-s">true # 是否部署资源。默认为&#39;true&#39;。</span>
<span class="tok-na">flowable.form.deployment-name</span><span class="tok-o">=</span><span class="tok-s">SpringBootAutoDeployment # Form资源部署的名字。</span>
<span class="tok-na">flowable.form.enabled</span><span class="tok-o">=</span><span class="tok-s">true # 是否启用Form引擎。</span>
<span class="tok-na">flowable.form.resource-location</span><span class="tok-o">=</span><span class="tok-s">classpath*:/forms/ # Form资源的路径。</span>
<span class="tok-na">flowable.form.resource-suffixes</span><span class="tok-o">=</span><span class="tok-s">**.form # 需要扫描的资源后缀名。</span>
<span class="tok-na">flowable.form.servlet.load-on-startup</span><span class="tok-o">=</span><span class="tok-s">-1 # 启动时加载Form servlet。</span>
<span class="tok-na">flowable.form.servlet.name</span><span class="tok-o">=</span><span class="tok-s">Flowable Form Rest API # Form servlet的名字。</span>
<span class="tok-na">flowable.form.servlet.path</span><span class="tok-o">=</span><span class="tok-s">/form-api # Form servlet的context path。</span>

<span class="tok-c"># IDM <a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/idm/FlowableIdmProperties.java">FlowableIdmProperties</a></span>
<span class="tok-na">flowable.idm.enabled</span><span class="tok-o">=</span><span class="tok-s">true # 是否启用IDM引擎。</span>
<span class="tok-na">flowable.idm.password-encoder</span><span class="tok-o">=</span> <span class="tok-s"># 使用的密码编码类型。</span>
<span class="tok-na">flowable.idm.servlet.load-on-startup</span><span class="tok-o">=</span><span class="tok-s">-1 # 启动时加载IDM servlet。</span>
<span class="tok-na">flowable.idm.servlet.name</span><span class="tok-o">=</span><span class="tok-s">Flowable IDM Rest API # IDM servlet的名字。</span>
<span class="tok-na">flowable.idm.servlet.path</span><span class="tok-o">=</span><span class="tok-s">/idm-api # IDM servlet的context path。</span>

<span class="tok-c"># IDM Ldap <a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/ldap/FlowableLdapProperties.java">FlowableLdapProperties</a></span>
<span class="tok-na">flowable.idm.ldap.attribute.email</span><span class="tok-o">=</span> <span class="tok-s"># 用户email的属性名。</span>
<span class="tok-na">flowable.idm.ldap.attribute.first-name</span><span class="tok-o">=</span> <span class="tok-s"># 用户名字的属性名。</span>
<span class="tok-na">flowable.idm.ldap.attribute.group-id</span><span class="tok-o">=</span> <span class="tok-s"># 用户组ID的属性名。</span>
<span class="tok-na">flowable.idm.ldap.attribute.group-name</span><span class="tok-o">=</span> <span class="tok-s"># 用户组名的属性名。</span>
<span class="tok-na">flowable.idm.ldap.attribute.group-type</span><span class="tok-o">=</span> <span class="tok-s"># 用户组类型的属性名。</span>
<span class="tok-na">flowable.idm.ldap.attribute.last-name</span><span class="tok-o">=</span> <span class="tok-s"># 用户姓的属性名。</span>
<span class="tok-na">flowable.idm.ldap.attribute.user-id</span><span class="tok-o">=</span> <span class="tok-s"># 用户ID的属性名。</span>
<span class="tok-na">flowable.idm.ldap.base-dn</span><span class="tok-o">=</span> <span class="tok-s"># 查找用户与组的DN（标志名称 distinguished name）。</span>
<span class="tok-na">flowable.idm.ldap.cache.group-size</span><span class="tok-o">=</span><span class="tok-s">-1 # 设置{@link org.flowable.ldap.LDAPGroupCache}的大小。这是LRU缓存，用于缓存用户及组，以避免每次都查询LDAP系统。</span>
<span class="tok-na">flowable.idm.ldap.custom-connection-parameters</span><span class="tok-o">=</span> <span class="tok-s"># 用于设置所有没有专用setter的LDAP连接参数。查看 <a href="http://docs.oracle.com/javase/tutorial/jndi/ldap/jndi.html" class="bare">http://docs.oracle.com/javase/tutorial/jndi/ldap/jndi.html</a> 介绍的自定义参数。参数包括配置链接池，安全设置，等等。</span>
<span class="tok-na">flowable.idm.ldap.enabled</span><span class="tok-o">=</span><span class="tok-s">false # 是否启用LDAP IDM 服务。</span>
<span class="tok-na">flowable.idm.ldap.group-base-dn</span><span class="tok-o">=</span> <span class="tok-s"># 组查找的DN。</span>
<span class="tok-na">flowable.idm.ldap.initial-context-factory</span><span class="tok-o">=</span><span class="tok-s">com.sun.jndi.ldap.LdapCtxFactory # 初始化上下文工厂的类名。</span>
<span class="tok-na">flowable.idm.ldap.password</span><span class="tok-o">=</span> <span class="tok-s"># 连接LDAP系统的密码。</span>
<span class="tok-na">flowable.idm.ldap.port</span><span class="tok-o">=</span><span class="tok-s">-1 # LDAP系统的端口。</span>
<span class="tok-na">flowable.idm.ldap.query.all-groups</span><span class="tok-o">=</span> <span class="tok-s"># 查询所有组所用的语句。</span>
<span class="tok-na">flowable.idm.ldap.query.all-users</span><span class="tok-o">=</span> <span class="tok-s"># 查询所有用户所用的语句。</span>
<span class="tok-na">flowable.idm.ldap.query.groups-for-user</span><span class="tok-o">=</span> <span class="tok-s"># 按照指定用户查询所属组所用的语句</span>
<span class="tok-na">flowable.idm.ldap.query.user-by-full-name-like</span><span class="tok-o">=</span> <span class="tok-s"># 按照给定全名查找用户所用的语句。</span>
<span class="tok-na">flowable.idm.ldap.query.user-by-id</span><span class="tok-o">=</span> <span class="tok-s"># 按照userId查找用户所用的语句。</span>
<span class="tok-na">flowable.idm.ldap.search-time-limit</span><span class="tok-o">=</span><span class="tok-s">0 # 查询LDAP的超时时间（以毫秒计）。默认值为&#39;0&#39;，即“一直等待”。</span>
<span class="tok-na">flowable.idm.ldap.security-authentication</span><span class="tok-o">=</span><span class="tok-s">simple # 连接LDAP系统所用的&#39;java.naming.security.authentication&#39;参数的值。</span>
<span class="tok-na">flowable.idm.ldap.server</span><span class="tok-o">=</span> <span class="tok-s"># LDAP系统的主机名。如&#39;ldap://localhost&#39;。</span>
<span class="tok-na">flowable.idm.ldap.user</span><span class="tok-o">=</span> <span class="tok-s"># 连接LDAP系统的用户ID。</span>
<span class="tok-na">flowable.idm.ldap.user-base-dn</span><span class="tok-o">=</span> <span class="tok-s"># 查找用户的DN。</span>

<span class="tok-c"># Flowable Mail <a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/FlowableMailProperties.java">FlowableMailProperties</a></span>
<span class="tok-na">flowable.mail.server.default-from</span><span class="tok-o">=</span><span class="tok-s">flowable@localhost # 发送邮件时使用的默认发信人地址。</span>
<span class="tok-na">flowable.mail.server.host</span><span class="tok-o">=</span><span class="tok-s">localhost # 邮件服务器。</span>
<span class="tok-na">flowable.mail.server.password</span><span class="tok-o">=</span> <span class="tok-s"># 邮件服务器的登录密码。</span>
<span class="tok-na">flowable.mail.server.port</span><span class="tok-o">=</span><span class="tok-s">1025 # 邮件服务器的端口号。</span>
<span class="tok-na">flowable.mail.server.use-ssl</span><span class="tok-o">=</span><span class="tok-s">false # 是否使用SSL/TLS加密SMTP传输连接（即SMTPS/POPS)。</span>
<span class="tok-na">flowable.mail.server.use-tls</span><span class="tok-o">=</span><span class="tok-s">false # 使用或禁用STARTTLS加密。</span>
<span class="tok-na">flowable.mail.server.username</span><span class="tok-o">=</span> <span class="tok-s"># 邮件服务器的登录用户名。如果为空，则不需要登录。</span>

<span class="tok-c"># Flowable Http <a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/FlowableHttpProperties.java">FlowableHttpProperties</a></span>
<span class="tok-na">flowable.http.user-system-properties</span><span class="tok-o">=</span><span class="tok-s">false # 是否使用系统属性 (e.g. http.proxyPort).</span>
<span class="tok-na">flowable.http.connect-timeout</span><span class="tok-o">=</span><span class="tok-s">5s # 连接http客户端的超时时间</span>
<span class="tok-na">flowable.http.socket-timeout</span><span class="tok-o">=</span><span class="tok-s">5s #  http客户端的Socket超时时间</span>
<span class="tok-na">flowable.http.connection-request-timeout</span><span class="tok-o">=</span><span class="tok-s">5s #  http客户端的连接请求超时时间</span>
<span class="tok-na">flowable.http.request-retry-limit</span><span class="tok-o">=</span><span class="tok-s">3 #  请求http客户端的重试限制</span>
<span class="tok-na">flowable.http.disable-cert-verify</span><span class="tok-o">=</span><span class="tok-s">false # 是否禁用http客户端的证书验证</span>

<span class="tok-c"># Actuator</span>
<span class="tok-na">management.endpoint.flowable.cache.time-to-live</span><span class="tok-o">=</span><span class="tok-s">0ms # 缓存响应的最大时间。</span>
<span class="tok-na">management.endpoint.flowable.enabled</span><span class="tok-o">=</span><span class="tok-s">true # 是否启用flowable端点。</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. 弃用的参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">现参数</th>
<th class="tableblock halign-left valign-top">原参数</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.process.servlet.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.rest-api-servlet-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flowable BPMN Rest API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Process servlet的名字。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.process.servlet.path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.rest-api-mapping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/process-api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Process servlet的context path。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail.server.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail-server-host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">localhost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件服务器。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail.server.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail-server-password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件服务器的密码。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail.server.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail-server-port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1025</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件服务器的端口号。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail.server.use-ssl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail-server-use-ssl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否使用SSL/TLS加密SMTP传输连接（即SMTPS/POPS)。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail.server.use-tls</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail-server-use-tls</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用或禁用STARTTLS加密。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail.server.username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail-server-user-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件服务器的登录用户名。如果为空，则不需要登录。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.process.definition-cache-limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.process-definitions.cache.max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程定义缓存中保存流程定义的最大数量。默认值为-1（缓存所有流程定义）。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="springBootFlowableAutoConfiguration">5.7.9. Flowable自动配置类</h4>
<div class="paragraph">
<p>这是Flowable提供的所有自动配置类的列表，并包括了文档及源码的连接。记得查看你的应用的conditions报告，以确认具体启用了哪些功能。（使用&#8212;&#8203;debug或-Ddebug或在Actuator应用中启动应用，并使用 <code>conditions</code> 端点）。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">配置类</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/content/ContentEngineAutoConfiguration.java">ContentEngineAutoConfiguration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/content/ContentEngineServicesAutoConfiguration.java">ContentEngineServicesAutoConfiguration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/cmmn/CmmnEngineAutoConfiguration.java">CmmnEngineAutoConfiguration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/cmmn/CmmnEngineServicesAutoConfiguration.java">CmmnEngineServicesAutoConfiguration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/dmn/DmnEngineAutoConfiguration.java">DmnEngineAutoConfiguration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/dmn/DmnEngineServicesAutoConfiguration.java">DmnEngineServicesAutoConfiguration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/EndpointAutoConfiguration.java">EndpointAutoConfiguration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/actuate/info/FlowableInfoAutoConfiguration.java">FlowableInfoAutoConfiguration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/ldap/FlowableLdapAutoConfiguration.java">FlowableLdapAutoConfiguration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/FlowableTransactionAutoConfiguration.java">FlowableTransactionAutoConfiguration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/form/FormEngineAutoConfiguration.java">FormEngineAutoConfiguration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/form/FormEngineServicesAutoConfiguration.java">FormEngineServicesAutoConfiguration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/idm/IdmEngineAutoConfiguration.java">IdmEngineAutoConfiguration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/idm/IdmEngineServicesAutoConfiguration.java">IdmEngineServicesAutoConfiguration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/ProcessEngineAutoConfiguration.java">ProcessEngineAutoConfiguration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/RestApiAutoConfiguration.java">RestApiAutoConfiguration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/SecurityAutoConfiguration.java">SecurityAutoConfiguration</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="springBootFlowableStarter">5.7.10. Flowable Starter</h4>
<div class="paragraph">
<p>这是Flowable Spring Boot stater的列表。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Starter</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-starter-cmmn/pom.xml">flowable-spring-boot-starter-cmmn</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供以独立运行模式启动CMMN引擎的依赖</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-starter-cmmn-rest/pom.xml">flowable-spring-boot-starter-cmmn-rest</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供以独立运行模式启动CMMN引擎，并提供其REST API的依赖。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-starter-dmn/pom.xml">flowable-spring-boot-starter-dmn</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供以独立运行模式启动DMN引擎的依赖。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-starter-dmn-rest/pom.xml">flowable-spring-boot-starter-dmn-rest</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供以独立运行模式启动DMN引擎，并提供其REST API的依赖。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-starter-process/pom.xml">flowable-spring-boot-starter-process</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供以独立运行模式启动流程引擎的依赖。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-starter-process-rest/pom.xml">flowable-spring-boot-starter-process-rest</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供以独立运行模式启动流程引擎，并提供其REST API的依赖。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-starter/pom.xml">flowable-spring-boot-starter</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供启动所有Flowable引擎（流程，CMMN，DMN，Form，Content及IDM）的依赖。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-starter-rest/pom.xml">flowable-spring-boot-starter-rest</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供启动所有Flowable引擎，并提供其REST API的依赖。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-starter-actuator/pom.xml">flowable-spring-boot-starter-actuator</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供Spring Boot Actuator所需的依赖。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_using_liquibase">5.7.11. 使用Liquibase</h4>
<div class="paragraph">
<p>Flowable引擎使用Liquibase管理数据库版本。
因此Spring Boot的 <code>LiquibaseAutoConfiguration</code> 会自动启用。
然而，如果你并未使用Liquibase，则应用将无法启动，并抛出异常。
因此Flowable将 <code>spring.liquibase.enabled</code> 设置为 <code>false</code> ，也即如果需要使用Liquibase，则需手动启用它。</p>
</div>
</div>
<div class="sect3">
<h4 id="_further_reading">5.7.12. 扩展阅读</h4>
<div class="paragraph">
<p>很明显还有很多Spring Boot相关的内容还没有提及，如非常简单的JTA集成、构建能在主流应用服务器上运行的WAR文件。也还有很多Spring Boot集成：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Actuator支持</p>
</li>
<li>
<p>Spring Integration支持</p>
</li>
<li>
<p>Rest API集成：启动Spring应用中嵌入的Flowable Rest API</p>
</li>
<li>
<p>Spring Security支持</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_advanced_configuration">5.7.13. 高级配置</h4>
<div class="sect4">
<h5 id="_customizing_engine_configuration">自定义引擎配置</h5>
<div class="paragraph">
<p>实现<em>org.flowable.spring.boot.EngineConfigurationConfigurer&lt;T&gt;</em>接口，可以获取引擎配置对象。其中<em>T</em>是具体引擎配置的Spring类型。
这样可以在参数尚未公开时，进行高级配置，或简化配置。
例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyConfigurer</span> <span class="tok-kd">implements</span> <span class="tok-n">EngineConfigurationConfigurer</span><span class="tok-o">&lt;</span><span class="tok-n">SpringProcessEngineConfiguration</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">configure</span><span class="tok-o">(</span><span class="tok-n">SpringProcessEngineConfiguration</span> <span class="tok-n">processEngineConfiguration</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-c1">// advanced configuration</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在Spring Boot配置中使用<em>@Bean</em>发布该类的实例，这样配置类会在流程引擎创建前调用。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>可以用这种方法实现自定义的Flowable服务。参见 <a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-spring-boot/flowable-spring-boot-starters/flowable-spring-boot-autoconfigure/src/main/java/org/flowable/spring/boot/ldap/FlowableLdapAutoConfiguration.java">FlowableLdapAutoConfiguration</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_combining_starters">整合starter</h5>
<div class="paragraph">
<p>如果需要一组引擎，则只能依次添加依赖。
比如要使用流程、CMMN、Form与IDM引擎，并使用LDAP，则需要添加这些依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>org.flowable<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>flowable-spring-boot-starter-process<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>${flowable.version}<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>org.flowable<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>flowable-spring-boot-starter-cmmn<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>${flowable.version}<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>org.flowable<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>flowable-content-spring-configurator<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>${flowable.version}<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>org.flowable<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>flowable-ldap<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>${flowable.version}<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configuring_async_executors">配置异步执行器</h5>
<div class="paragraph">
<p>流程及CMMN引擎使用专门的 <code>AsyncExecutor</code> ，并可使用 <code>flowable.{engine}.async.executor</code> 参数组进行配置。
其中 <code>engine</code> 代表 <code>process</code> 或 <code>cmmn</code> 。</p>
</div>
<div class="paragraph">
<p>默认情况下， <code>AsyncExecutor</code> 共享同一个Spring <code>TaskExecutor</code> 及 <code>SpringRejectedJobsHandler</code> 。
如果需要为引擎提供专门的执行器，则需要使用 <code>@Process</code> 及 <code>@Cmmn</code> 定义的bean。</p>
</div>
<div class="paragraph">
<p>可以使用如下方法配置自定义的执行器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span></span><span class="tok-nd">@Configuration</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyConfiguration</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Process</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-nd">@Bean</span>
    <span class="tok-kd">public</span> <span class="tok-n">TaskExecutor</span> <span class="tok-nf">processTaskExecutor</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-n">SimpleAsyncTaskExecutor</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Cmmn</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tok-nd">@Bean</span>
    <span class="tok-kd">public</span> <span class="tok-n">TaskExecutor</span> <span class="tok-nf">cmmnTaskExecutor</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-n">SyncTaskExecutor</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>流程引擎将使用 <code>SimpleAsyncTaskExecutor</code> 作为异步执行器</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>CMMN引擎将使用 <code>SyncTaskExecutor</code> 作为异步执行器</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果使用了自定义的 <code>TaskExecutor</code> bean，则Flowable将不会再创建自己的bean。
也就是说如果使用 <code>@Process</code> 定义了bean，也需要使用 <code>@Cmmn</code> 或 <code>@Primary</code> 再定义一个bean。否则Cmmn异步执行器将使用流程引擎所用的bean。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chDeployment">6. 部署</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_business_archives">6.1. 业务存档</h3>
<div class="paragraph">
<p>要部署流程，需要将它们包装在业务存档(BAR, Business archive)里。业务存档是Flowable引擎的部署单元，也就是一个ZIP文件。可以包含BPMN 2.0流程、表单定义、DMN规则，与其他类型的文件。总的来说，业务存档包含一组具名资源。</p>
</div>
<div class="paragraph">
<p>当部署业务存档时，会扫描具有<code>.bpmn20.xml</code>或<code>.bpmn</code>扩展名的BPMN文件。每一个这种文件都会被处理，并可以包含多个流程定义。
当启用DMN引擎时，也会解析<code>.dmn</code>。当启用表单引擎时，会处理<code>.form</code>文件。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>业务存档中的Java类<strong>不会添加至classpath</strong>。业务存档中，所有流程定义使用的自定义类（例如Java服务任务或者事件监听器），都需要放在运行流程的flowable引擎的classpath内。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_deploying_programmatically">6.1.1. 编程方式部署</h4>
<div class="paragraph">
<p>从ZIP文件部署业务存档，可以这样做：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-n">String</span> <span class="tok-n">barFileName</span> <span class="tok-o">=</span> <span class="tok-s">&quot;path/to/process-one.bar&quot;</span><span class="tok-o">;</span>
<span class="tok-n">ZipInputStream</span> <span class="tok-n">inputStream</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ZipInputStream</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">FileInputStream</span><span class="tok-o">(</span><span class="tok-n">barFileName</span><span class="tok-o">));</span>

<span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">name</span><span class="tok-o">(</span><span class="tok-s">&quot;process-one.bar&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">addZipInputStream</span><span class="tok-o">(</span><span class="tok-n">inputStream</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以为单个资源构建部署。查看javadoc以获取更多信息。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_external_resources">6.2. 外部资源</h3>
<div class="paragraph">
<p>流程定义保存在Flowable数据库中。这些流程定义在使用服务任务、执行监听器，或执行Flowable配置文件中定义的Spring bean时，可以引用委托类。这些类及Spring配置文件都需要在可能运行这个流程定义的流程引擎中可用。</p>
</div>
<div class="sect3">
<h4 id="_java_classes">6.2.1. Java类</h4>
<div class="paragraph">
<p>在流程启动时，引擎的classpath中需要有所有流程中用到的自定义类（例如服务任务、事件监听器、任务监听器等中用到的JavaDelegate）。</p>
</div>
<div class="paragraph">
<p>但是在部署业务存档时，classpath中可以没有这些类。这意味着，比如使用Ant部署新业务存档时，代理类不必提前放在classpath中。</p>
</div>
<div class="paragraph">
<p>当使用演示配置且希望添加自定义类时，需要在flowable-task或flowable-rest的webapp lib中，添加包含有你的自定义类的JAR。别忘了也要添加你的自定义类的依赖（若有）。或者，也可以将你的依赖添加到Tomcat的库文件夹<code>${tomcat.home}/lib</code>中。</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_spring_beans_from_a_process">6.2.2. 在流程中使用Spring bean</h4>
<div class="paragraph">
<p>在表达式或脚本中使用Spring bean时，执行该流程定义的引擎需要可以使用这些bean。可以简单直接地自行构建web应用，并按照<a href="#springintegration">集成Spring</a>章节的介绍在上下文中配置流程引擎。但也请牢记在心，如果使用Flowable task和rest web应用，就需要更新它的上下文配置。</p>
</div>
</div>
<div class="sect3">
<h4 id="_creating_a_single_app">6.2.3. 创建单独应用</h4>
<div class="paragraph">
<p>如果不想费心在所有流程引擎的classpath中都包含所有需要的代理类，及保证它们都使用了正确的Spring配置，也可以考虑将Flowable rest web应用嵌入你自己的web应用。也就是说只使用一个单独的<code>ProcessEngine</code>。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="versioningOfProcessDefinitions">6.3. 流程定义的版本</h3>
<div class="paragraph">
<p>BPMN并没有版本的概念。这其实很好，因为可执行的BPMN流程文件很可能已经作为开发项目的一部分，保存在版本管理系统仓库中了（例如Subversion，Git，或者Mercurial）。但是，作为部署过程的一部分，引擎会创建流程定义的版本。在部署时，Flowable会在保存至Flowable数据库前，为<code>ProcessDefinition</code>指定版本。</p>
</div>
<div class="paragraph">
<p>对于业务存档中的每个流程定义，为了初始化<code>key</code>、<code>version</code>、<code>name</code>与<code>id</code>参数，会执行下列步骤：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>XML文件中的流程定义<code>id</code>属性用作流程定义的<code>key</code>参数。</p>
</li>
<li>
<p>XML文件中的流程定义<code>name</code>属性用作流程定义的<code>name</code>参数。如果未给定<code>name</code>属性，会使用id作为name。</p>
</li>
<li>
<p>当每个key的流程第一次部署时，指定版本为1。对其后所有使用相同key的流程定义，部署时版本会在该key当前已部署的最高版本号基础上加1。key参数用于区分流程定义。</p>
</li>
<li>
<p>id参数设置为{processDefinitionKey}:{processDefinitionVersion}:{generated-id}，其中<code>generated-id</code>是一个唯一数字，用以保证在集群环境下，流程定义缓存中，流程id的唯一性。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以下面的流程为例</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myDefinitions&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myProcess&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My important process&quot;</span> <span class="tok-nt">&gt;</span>
    ...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当部署这个流程定义时，数据库中的流程定义会是这个样子：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess:1:676</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>如果我们现在部署同一个流程的更新版本（例如修改部分用户任务），且保持流程定义的<code>id</code>不变，那么流程定义表中会包含下面的记录：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess:1:676</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess:2:870</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>当调用<code>runtimeService.startProcessInstanceByKey("myProcess")</code>时，会使用版本<code>2</code>的流程定义，因为这是这个流程定义的最新版本。</p>
</div>
<div class="paragraph">
<p>如果再创建第二个流程，如下定义并部署至Flowable，表中会增加第三行。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myNewDefinitions&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myNewProcess&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My important process&quot;</span> <span class="tok-nt">&gt;</span>
    ...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>表数据类似：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess:1:676</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess:2:870</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">myNewProcess:1:1033</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myNewProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>请注意新流程的key与第一个流程的key不同。即使name是相同的（我们也可以修改它），Flowable也只用<code>id</code>属性来区分流程。因此新的流程部署时版本为1.</p>
</div>
</div>
<div class="sect2">
<h3 id="providingProcessDiagram">6.4. 提供流程图</h3>
<div class="paragraph">
<p>可以在部署中添加流程图片。这个图片将存储在Flowable数据库中，并可以使用API访问。图片可以用在Flowable应用中，使流程可视化。</p>
</div>
<div class="paragraph">
<p>如果在classpath中，有一个<code>org/flowable/expenseProcess.bpmn20.xml</code>流程，key为&#8217;expense'。则流程图片会使用下列命名约定（按顺序）：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果部署中有图片资源，并且文件名包含BPMN 2.0 XML流程定义文件名以及流程key，并具有图形格式，则使用这个图片。在我们的例子中，就是<code>org/flowable/expenseProcess.expense.png</code>（或者.jpg/gif）。使用key的原因是，一个BPMN 2.0 XML文件中可以有多个流程定义。因此使用流程key区分每一个流程图的文件。</p>
</li>
<li>
<p>如果没有这种图片，就会寻找部署中匹配BPMN 2.0 XML文件名的图片资源。在我们的例子中，就是<code>org/flowable/expenseProcess.png</code>。请注意，这意味着同一个BPMN 2.0文件中的<strong>每一个流程定义</strong>，都会使用同一个流程图图片。当然，如果每个BPMN 2.0 XML文件中都只有一个流程定义，就没有问题。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>用编程方式部署的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span>
<span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">name</span><span class="tok-o">(</span><span class="tok-s">&quot;expense-process.bar&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">addClasspathResource</span><span class="tok-o">(</span><span class="tok-s">&quot;org/flowable/expenseProcess.bpmn20.xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">addClasspathResource</span><span class="tok-o">(</span><span class="tok-s">&quot;org/flowable/expenseProcess.png&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>图片资源可用下面的API获取：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-n">ProcessDefinition</span> <span class="tok-n">processDefinition</span> <span class="tok-o">=</span> <span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">createProcessDefinitionQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">processDefinitionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;expense&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>

<span class="tok-n">String</span> <span class="tok-n">diagramResourceName</span> <span class="tok-o">=</span> <span class="tok-n">processDefinition</span><span class="tok-o">.</span><span class="tok-na">getDiagramResourceName</span><span class="tok-o">();</span>
<span class="tok-n">InputStream</span> <span class="tok-n">imageStream</span> <span class="tok-o">=</span> <span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">getResourceAsStream</span><span class="tok-o">(</span>
    <span class="tok-n">processDefinition</span><span class="tok-o">.</span><span class="tok-na">getDeploymentId</span><span class="tok-o">(),</span> <span class="tok-n">diagramResourceName</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="generatingProcessDiagram">6.5. 生成流程图</h3>
<div class="paragraph">
<p>如果部署时没有按<a href="#providingProcessDiagram">上小节</a>介绍的方式提供图片，且流程定义中包含必要的“图形交换(diagram interchange)”信息，Flowable引擎会生成流程图。</p>
</div>
<div class="paragraph">
<p>可以用与部署时<a href="#providingProcessDiagram">提供图片</a>完全相同的方法获取图片资源。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/deployment.image.generation.png" alt="deployment.image.generation">
</div>
</div>
<div class="paragraph">
<p>如果不需要或不希望在部署时生成流程图，可以在流程引擎配置中设置<code>isCreateDiagramOnDeploy</code>参数：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;createDiagramOnDeploy&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样就不会生成流程图了。</p>
</div>
</div>
<div class="sect2">
<h3 id="deploymentCategory">6.6. 类别</h3>
<div class="paragraph">
<p>部署与流程定义都可以自定义类别。流程定义的类别使用BPMN文件中targetNamespace的值设置：<code>&lt;definitions &#8230;&#8203; targetNamespace="yourCategory" &#8230;&#8203;/&gt;</code>。</p>
</div>
<div class="paragraph">
<p>部署的类别也可用API如此设定：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">repositoryService</span>
    <span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">category</span><span class="tok-o">(</span><span class="tok-s">&quot;yourCategory&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">...</span>
    <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bpmn20">7. BPMN 2.0介绍</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="whatIsBpmn">7.1. BPMN是什么？</h3>
<div class="paragraph">
<p>BPMN是一个广泛接受与支持的，展现流程的注记方法。<a href="http://www.bpmn.org/">OMG BPMN标准</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="bpmnDefiningProcess">7.2. 定义流程</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>本篇文档假设你使用<a href="http://eclipse.org/">Eclipse IDE</a>创建与编辑文件。但其实文档中只有少数几处使用了Eclipse的特性。你可以使用喜欢的任何其他工具创建BPMN 2.0 XML文件。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>创建一个新的XML文件（<em>在任意项目上右击，选择New&#8594;Other&#8594;XML-XML File</em>）并命名。确保该文件名<strong>以.bpmn20.xml或.bpmn结尾</strong>，否则引擎不会在部署时使用这个文件。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/new.bpmn.procdef.png" alt="new.bpmn.procdef">
</div>
</div>
<div class="paragraph">
<p>BPMN 2.0概要（schema）的根元素（root element）是<code>definitions</code>元素。在这个元素中，可以定义多个流程定义（然而我们建议在每个文件中，只有一个流程定义。这样可以简化之后的部署过程）。下面给出的是一个空流程定义。请注意<code>definitions</code>元素最少需要包含<code>xmlns</code>与<code>targetNamespace</code>声明。<code>targetNamespace</code>可以为空，它用于对流程定义进行分类。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span>
  <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot;</span>
  <span class="tok-na">xmlns:flowable=</span><span class="tok-s">&quot;http://flowable.org/bpmn&quot;</span>
  <span class="tok-na">targetNamespace=</span><span class="tok-s">&quot;Examples&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myProcess&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My First Process&quot;</span><span class="tok-nt">&gt;</span>
    ..
  <span class="tok-nt">&lt;/process&gt;</span>

<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>除了使用Eclipse中的XML分类选项，也可以使用在线概要作为BPMN 2.0 XML概要。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span>xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
xsi:schemaLocation=&quot;http://www.omg.org/spec/BPMN/20100524/MODEL
                    http://www.omg.org/spec/BPMN/2.0/20100501/BPMN20.xsd
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>process</code>元素有两个属性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>id</strong>: <strong>必填</strong>属性，将映射为Flowable <code>ProcessDefinition</code>对象的<strong>key</strong>参数。可以使用<code>RuntimeService</code>中的<code>startProcessInstanceByKey</code>方法，使用<code>id</code>来启动这个流程定义的新流程实例。这个方法总会使用流程定义的<strong>最新部署版本</strong>。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">ProcessInstance</span> <span class="tok-n">processInstance</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;myProcess&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>请注意这与调用<code>startProcessInstanceById</code>方法不同。<code>startProcessInstanceById</code>方法的参数为Flowable引擎在部署时生成的字符串ID(可以通过调用<code>processDefinition.getId()</code>方法获取)。生成ID的格式为<strong><em>key:version</em></strong>，长度<strong>限制为64字符</strong>。请注意限制流程<em>key</em>的长度，否则会抛出<code>FlowableException</code>异常，提示生成的ID过长。</p>
</li>
<li>
<p><strong>name</strong>: <strong>可选</strong>属性，将映射为<code>ProcessDefinition</code>的<em>name</em>参数。引擎本身不会使用这个参数。可以用于在用户界面上显示更友好的名字。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="bpmn10minutetutorial">7.3. 开始：十分钟教程</h3>
<div class="paragraph">
<p>这个章节包含了一个很简单的业务流程，用于介绍一些基本的Flowable概念以及Flowable API。</p>
</div>
<div class="sect3">
<h4 id="bpmn10MinuteTutorialPrerequisites">7.3.1. 必要条件</h4>
<div class="paragraph">
<p>这个教程需要你已经<a href="#demo.setup.one.minute.version">运行了Flowable演示配置</a>，并使用独立的H2服务器。编辑<code>db.properties</code>并设置<code>jdbc.url=jdbc:h2:tcp://localhost/flowable</code>，然后按照<a href="http://www.h2database.com/html/tutorial.html#using_server">H2文档</a>的介绍运行独立服务器。</p>
</div>
</div>
<div class="sect3">
<h4 id="bpmn10MinuteTutorialGoal">7.3.2. 目标</h4>
<div class="paragraph">
<p>这个教程的目标是学习Flowable以及BPMN 2.0的一些基础概念。最后成果是一个简单的Java SE程序，部署了一个流程定义，并可以通过Flowable引擎API与流程进行交互。当然，在这个教程里学到的东西，也可以按照你的业务流程用于构建你自己的web应用程序。</p>
</div>
</div>
<div class="sect3">
<h4 id="bpmnFirstExampleUseCase">7.3.3. 用例</h4>
<div class="paragraph">
<p>用例很简单：有一个公司，叫做BPMCorp。在BPMCorp中，由会计部门负责，每月需要为投资人撰写一份报告。在报告完成后，需要高层经理中的一人进行审核，然后才能发给所有投资人。</p>
</div>
</div>
<div class="sect3">
<h4 id="bpmnFirstExampleDiagram">7.3.4. 流程图</h4>
<div class="paragraph">
<p>上面描述的业务流程可以使用<a href="#flowableDesigner">Flowable Designer</a>直接画出。但是在这个教程里我们自己写XML，这样可以学习更多。这个流程的图形化BPMN 2.0注记像是这样：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/financial.report.example.diagram.png" alt="financial.report.example.diagram">
</div>
</div>
<div class="paragraph">
<p>我们看到的是一个<a href="#bpmnNoneStartEvent">空启动事件</a>（左边的圆圈），接下来是两个<a href="#bpmnUserTask">用户任务</a>：<em>'Write monthly financial report（撰写月度财务报告）'</em>与<em>'Verify monthly financial report（审核月度财务报告）'</em>。最后是<a href="#bpmnNoneEndEvent">空结束事件</a>（右边的粗线条圆圈）。</p>
</div>
</div>
<div class="sect3">
<h4 id="bpmnFirstExampleXml">7.3.5. XML格式</h4>
<div class="paragraph">
<p>这个业务流程的XML版本（<em>FinancialReportProcess.bpmn20.xml</em>）在下面展示。很容易认出流程的主要元素（点击链接可以跳转到BPMN 2.0结构的详细章节）：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#bpmnNoneStartEvent">(空)开始事件</a>是流程的<em>入口点（entry point）</em>。</p>
</li>
<li>
<p><a href="#bpmnUserTask">用户任务</a>表示流程中的人工任务。请注意第一个任务分配给<em>accountancy</em>组，而第二个任务分配给<em>management</em>组。查看<a href="#bpmnUserTaskAssignment">用户任务分配</a>章节了解更多关于用户与组如何分配用户任务的信息。</p>
</li>
<li>
<p>流程在到达<a href="#bpmnNoneEndEvent">空结束事件</a>时结束。</p>
</li>
<li>
<p>各元素间通过<a href="#bpmnSequenceFlow">顺序流</a>链接。顺序流用<code>source</code> 与<code>target</code>定义顺序流的<em>流向（direction）</em>。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span> <span class="tok-na">id=</span><span class="tok-s">&quot;definitions&quot;</span>
  <span class="tok-na">targetNamespace=</span><span class="tok-s">&quot;http://flowable.org/bpmn20&quot;</span>
  <span class="tok-na">xmlns:flowable=</span><span class="tok-s">&quot;http://flowable.org/bpmn&quot;</span>
  <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;financialReport&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Monthly financial report reminder process&quot;</span><span class="tok-nt">&gt;</span>

      <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-nt">/&gt;</span>

      <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;writeReportTask&quot;</span> <span class="tok-nt">/&gt;</span>

      <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;writeReportTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Write monthly financial report&quot;</span> <span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;documentation&gt;</span>
          Write monthly financial report for publication to shareholders.
        <span class="tok-nt">&lt;/documentation&gt;</span>
        <span class="tok-nt">&lt;potentialOwner&gt;</span>
          <span class="tok-nt">&lt;resourceAssignmentExpression&gt;</span>
            <span class="tok-nt">&lt;formalExpression&gt;</span>accountancy<span class="tok-nt">&lt;/formalExpression&gt;</span>
          <span class="tok-nt">&lt;/resourceAssignmentExpression&gt;</span>
        <span class="tok-nt">&lt;/potentialOwner&gt;</span>
      <span class="tok-nt">&lt;/userTask&gt;</span>

      <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;writeReportTask&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;verifyReportTask&quot;</span> <span class="tok-nt">/&gt;</span>

      <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;verifyReportTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Verify monthly financial report&quot;</span> <span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;documentation&gt;</span>
          Verify monthly financial report composed by the accountancy department.
          This financial report is going to be sent to all the company shareholders.
        <span class="tok-nt">&lt;/documentation&gt;</span>
        <span class="tok-nt">&lt;potentialOwner&gt;</span>
          <span class="tok-nt">&lt;resourceAssignmentExpression&gt;</span>
            <span class="tok-nt">&lt;formalExpression&gt;</span>management<span class="tok-nt">&lt;/formalExpression&gt;</span>
          <span class="tok-nt">&lt;/resourceAssignmentExpression&gt;</span>
        <span class="tok-nt">&lt;/potentialOwner&gt;</span>
      <span class="tok-nt">&lt;/userTask&gt;</span>

      <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow3&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;verifyReportTask&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>

      <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;/process&gt;</span>

<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnFirstExamplStartProcess">7.3.6. 启动流程实例</h4>
<div class="paragraph">
<p>现在我们已经创建了业务流程的<strong>流程定义</strong>。使用这样的流程定义，可以创建<strong>流程实例</strong>。在这个例子中，一个流程实例将对应某一月份的财经报告创建与审核工作。所有月份的流程实例共享相同的流程定义。</p>
</div>
<div class="paragraph">
<p>要用给定的流程定义创建流程实例，需要首先<strong>部署（deploy）</strong>流程定义。部署流程定义意味着两件事：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>流程定义将会存储在Flowable引擎配置的持久化数据库中。因此部署业务流程保证了引擎在重启后也能找到流程定义。</p>
</li>
<li>
<p>BPMN 2.0流程XML会解析为内存中的对象模型，供Flowable API使用。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>更多关于部署的信息可以在<a href="#chDeployment">部署</a>章节中找到。</p>
</div>
<div class="paragraph">
<p>与该章节的描述一样，部署有很多种方式。其中一种是通过下面展示的API。请注意所有与Flowable引擎的交互都要通过它的<em>服务（services）</em>进行。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-n">Deployment</span> <span class="tok-n">deployment</span> <span class="tok-o">=</span> <span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">addClasspathResource</span><span class="tok-o">(</span><span class="tok-s">&quot;FinancialReportProcess.bpmn20.xml&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>现在可以使用在流程定义中定义的<code>id</code>（参见XML中的process元素）启动新流程实例。请注意这个<code>id</code>在Flowable术语中被称作<strong>key</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">ProcessInstance</span> <span class="tok-n">processInstance</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;financialReport&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这会创建流程实例，并首先通过开始事件。在开始事件后，会沿着所有出口顺序流（在这个例子中只有一个）继续执行，并到达第一个任务（<em>write monthly financial report 撰写月度财务报告</em>）。这时，Flowable引擎会在持久化数据库中存储一个任务。同时也会解析并保存这个任务附加的分配用户或组。请注意，Flowable引擎会持续执行流程，直到到达<em>等待状态（wait state）</em>，例如用户任务。在等待状态，流程实例的当前状态会存储在数据库中并保持，直到用户决定完成任务。这时，引擎会继续执行，直到遇到新的等待状态，或者流程结束。如果在这期间引擎重启或崩溃，流程的状态也仍在数据库中安全的保存。</p>
</div>
<div class="paragraph">
<p>用户任务活动是一个<em>等待状态</em>，因此<code>startProcessInstanceByKey</code>方法会在任务创建后返回。在这个例子里，这个任务分配给一个组。这意味着这个组的每一个成员都是处理这个任务的<strong>候选人（candidate）</strong>。</p>
</div>
<div class="paragraph">
<p>现在可以将前面这些东西整合起来，构造一个简单的Java程序。创建一个新的Eclipse项目，在它的classpath中添加Flowable JAR与依赖（可以在Flowable发行版的<em>libs</em>目录下找到）。在调用Flowable服务前，需要首先构建<code>ProcessEngine</code>，用于访问服务。这里我们使用<em>'独立(standalone)'</em>配置，这个配置会构建<code>ProcessEngine</code>，并使用与演示配置中相同的数据库。</p>
</div>
<div class="paragraph">
<p>可以从<a href="images/FinancialReportProcess.bpmn20.xml">这里</a>下载流程定义XML。这个文件包含了上面展示的XML，同时包含了必要的BPMN<a href="#generatingProcessDiagram">图形交互信息</a>，用于在Flowable的工具中可视化地展示流程。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>

  <span class="tok-c1">// 创建Flowable流程引擎</span>
  <span class="tok-n">ProcessEngine</span> <span class="tok-n">processEngine</span> <span class="tok-o">=</span> <span class="tok-n">ProcessEngineConfiguration</span>
    <span class="tok-o">.</span><span class="tok-na">createStandaloneProcessEngineConfiguration</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">buildProcessEngine</span><span class="tok-o">();</span>

  <span class="tok-c1">// 获取Flowable服务</span>
  <span class="tok-n">RepositoryService</span> <span class="tok-n">repositoryService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getRepositoryService</span><span class="tok-o">();</span>
  <span class="tok-n">RuntimeService</span> <span class="tok-n">runtimeService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getRuntimeService</span><span class="tok-o">();</span>

  <span class="tok-c1">// 部署流程定义</span>
  <span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">addClasspathResource</span><span class="tok-o">(</span><span class="tok-s">&quot;FinancialReportProcess.bpmn20.xml&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">();</span>

  <span class="tok-c1">// 启动流程实例</span>
  <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;financialReport&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnFirstExampleCandidateList">7.3.7. 任务列表</h4>
<div class="paragraph">
<p>现在可以通过如下代码获取这个任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">taskCandidateUser</span><span class="tok-o">(</span><span class="tok-s">&quot;kermit&quot;</span><span class="tok-o">).</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意传递给这个操作的用户需要是<em>accountancy</em>组的成员，因为在流程定义中是这么声明的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;potentialOwner&gt;</span>
  <span class="tok-nt">&lt;resourceAssignmentExpression&gt;</span>
    <span class="tok-nt">&lt;formalExpression&gt;</span>accountancy<span class="tok-nt">&lt;/formalExpression&gt;</span>
  <span class="tok-nt">&lt;/resourceAssignmentExpression&gt;</span>
<span class="tok-nt">&lt;/potentialOwner&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用任务查询API，用组名查得相同结果。可以在代码中添加下列逻辑：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">TaskService</span> <span class="tok-n">taskService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getTaskService</span><span class="tok-o">();</span>
<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">taskCandidateGroup</span><span class="tok-o">(</span><span class="tok-s">&quot;accountancy&quot;</span><span class="tok-o">).</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>因为我们使用与演示配置中相同的数据库配置<code>ProcessEngine</code>，因此可以直接登录<a href="http://localhost:8080/flowable-idm/">Flowable IDM</a>。使用admin/test登录，创建两个新用户<em>kermit</em>与<em>fozzie</em>，并将<em>Access the workflow application(访问工作流应用)</em>权限授予他们。然后创建两个组，命名为<em>accountancy</em>与<em>management</em>，并将fozzie添加至accountancy组，将kermit添加至management组。
然后以fozzie登录<a href="http://localhost:8080/flowable-task/">Flowable task</a>应用。选择Task应用，再选择其<em>Processes</em>页面，选择<em>'Monthly financial report （月度财务报告）'</em>，这样就可以启动我们的业务流程。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.financial.report.example.start.process.png" alt="bpmn.financial.report.example.start.process">
</div>
</div>
<div class="paragraph">
<p>前面已经解释过，流程会执行直到第一个用户任务。因为登录为fozzie，所以可以看到在启动流程实例后，他有一个新的候选任务（candidate task）。选择<em>Task</em>页面来查看这个新任务。请注意即使流程是由其他人启动的，accountancy组中的每一个人仍然都能看到这个候选任务。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.financial.report.example.task.assigned.png" alt="bpmn.financial.report.example.task.assigned">
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnFirstExampleClaimTask">7.3.8. 申领任务</h4>
<div class="paragraph">
<p>会计师（accountancy组的成员）现在需要<strong>申领任务（claim）</strong>。申领任务后，这个用户会成为任务的<strong>执行人（assignee）</strong>，这个任务也会从accountancy组的其他成员的任务列表中消失。可以通过如下代码实现申领任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">claim</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">(),</span> <span class="tok-s">&quot;fozzie&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这个任务现在在<strong>申领任务者的个人任务列表中</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">taskAssignee</span><span class="tok-o">(</span><span class="tok-s">&quot;fozzie&quot;</span><span class="tok-o">).</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在Flowable Task应用中，点击<em>claim</em>按钮会执行相同操作。这个任务会转移到登录用户的个人任务列表中。也可以看到任务执行人变更为当前登录用户。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.financial.report.example.claim.task.png" alt="bpmn.financial.report.example.claim.task">
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnFirstExampleCompleteTask">7.3.9. 完成任务</h4>
<div class="paragraph">
<p>会计师（accountancy组的成员）现在需要开始撰写财务报告了。完成报告后，他就可以<strong>完成任务（complete）</strong>，代表任务的所有工作都已完成。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">complete</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>对于Flowable引擎来说，这是个外部信号，指示流程实例可以继续执行。Flowable会从运行时数据中移除任务，并沿着这个任务唯一的出口转移线（outgoing transition），将执行移至第二个任务（<em>'verification of the report 审核报告'</em>）。为第二个任务分配执行人的机制，与上面介绍的第一个任务使用的机制相同。唯一的区别是这个任务会分配给<em>management</em>组。</p>
</div>
<div class="paragraph">
<p>在演示设置中，完成任务可以通过点击任务列表中的<em>complete</em>按钮。因为Fozzie不是经理，我们需要登出Flowable Task应用，并用<em>kermit</em>（他是经理）登录。这样就可以在未分配任务列表中看到第二个任务。</p>
</div>
</div>
<div class="sect3">
<h4 id="bpmnFirstExampleEndingProcess">7.3.10. 结束流程</h4>
<div class="paragraph">
<p>可以使用与之前完全相同的方式获取并申领审核任务。完成这个第二个任务会将流程执行移至结束事件，并结束流程实例。这个流程实例，及所有相关的运行时执行数据都会从数据库中移除。</p>
</div>
<div class="paragraph">
<p>也可以通过编程方式，使用<code>historyService</code>验证流程已经结束</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">HistoryService</span> <span class="tok-n">historyService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getHistoryService</span><span class="tok-o">();</span>
<span class="tok-n">HistoricProcessInstance</span> <span class="tok-n">historicProcessInstance</span> <span class="tok-o">=</span>
<span class="tok-n">historyService</span><span class="tok-o">.</span><span class="tok-na">createHistoricProcessInstanceQuery</span><span class="tok-o">().</span><span class="tok-na">processInstanceId</span><span class="tok-o">(</span><span class="tok-n">procId</span><span class="tok-o">).</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Process instance end time: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">historicProcessInstance</span><span class="tok-o">.</span><span class="tok-na">getEndTime</span><span class="tok-o">());</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnFirstExampleCode">7.3.11. 代码总结</h4>
<div class="paragraph">
<p>将之前章节的所有代码片段整合起来，会得到类似这样的代码。这段代码考虑到了你可能已经使用Flowable UI应用启动了一些流程实例。代码中总是获取任务列表而不是一个任务，因此可以正确执行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TenMinuteTutorial</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kt">void</span> <span class="tok-nf">main</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">args</span><span class="tok-o">)</span> <span class="tok-o">{</span>

    <span class="tok-c1">// 创建Flowable流程引擎</span>
    <span class="tok-n">ProcessEngine</span> <span class="tok-n">processEngine</span> <span class="tok-o">=</span> <span class="tok-n">ProcessEngineConfiguration</span>
      <span class="tok-o">.</span><span class="tok-na">createStandaloneProcessEngineConfiguration</span><span class="tok-o">()</span>
      <span class="tok-o">.</span><span class="tok-na">buildProcessEngine</span><span class="tok-o">();</span>

    <span class="tok-c1">// 获取Flowable服务</span>
    <span class="tok-n">RepositoryService</span> <span class="tok-n">repositoryService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getRepositoryService</span><span class="tok-o">();</span>
    <span class="tok-n">RuntimeService</span> <span class="tok-n">runtimeService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getRuntimeService</span><span class="tok-o">();</span>

    <span class="tok-c1">// 部署流程定义</span>
    <span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
      <span class="tok-o">.</span><span class="tok-na">addClasspathResource</span><span class="tok-o">(</span><span class="tok-s">&quot;FinancialReportProcess.bpmn20.xml&quot;</span><span class="tok-o">)</span>
      <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">();</span>

    <span class="tok-c1">// 启动流程实例</span>
    <span class="tok-n">String</span> <span class="tok-n">procId</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;financialReport&quot;</span><span class="tok-o">).</span><span class="tok-na">getId</span><span class="tok-o">();</span>

    <span class="tok-c1">// 获取第一个任务</span>
    <span class="tok-n">TaskService</span> <span class="tok-n">taskService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getTaskService</span><span class="tok-o">();</span>
    <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">taskCandidateGroup</span><span class="tok-o">(</span><span class="tok-s">&quot;accountancy&quot;</span><span class="tok-o">).</span><span class="tok-na">list</span><span class="tok-o">();</span>
    <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">:</span> <span class="tok-n">tasks</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Following task is available for accountancy group: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>

      <span class="tok-c1">// 申领任务</span>
      <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">claim</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">(),</span> <span class="tok-s">&quot;fozzie&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-c1">// 验证Fozzie获取了任务</span>
    <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">taskAssignee</span><span class="tok-o">(</span><span class="tok-s">&quot;fozzie&quot;</span><span class="tok-o">).</span><span class="tok-na">list</span><span class="tok-o">();</span>
    <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">:</span> <span class="tok-n">tasks</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Task for fozzie: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>

      <span class="tok-c1">// 完成任务</span>
      <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">complete</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
    <span class="tok-o">}</span>

    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Number of tasks for fozzie: &quot;</span>
            <span class="tok-o">+</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">taskAssignee</span><span class="tok-o">(</span><span class="tok-s">&quot;fozzie&quot;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">());</span>

    <span class="tok-c1">// 获取并申领第二个任务</span>
    <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">taskCandidateGroup</span><span class="tok-o">(</span><span class="tok-s">&quot;management&quot;</span><span class="tok-o">).</span><span class="tok-na">list</span><span class="tok-o">();</span>
    <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">:</span> <span class="tok-n">tasks</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Following task is available for management group: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
      <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">claim</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">(),</span> <span class="tok-s">&quot;kermit&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-c1">// 完成第二个任务并结束流程</span>
    <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">:</span> <span class="tok-n">tasks</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">complete</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
    <span class="tok-o">}</span>

    <span class="tok-c1">// 验证流程已经结束</span>
    <span class="tok-n">HistoryService</span> <span class="tok-n">historyService</span> <span class="tok-o">=</span> <span class="tok-n">processEngine</span><span class="tok-o">.</span><span class="tok-na">getHistoryService</span><span class="tok-o">();</span>
    <span class="tok-n">HistoricProcessInstance</span> <span class="tok-n">historicProcessInstance</span> <span class="tok-o">=</span>
      <span class="tok-n">historyService</span><span class="tok-o">.</span><span class="tok-na">createHistoricProcessInstanceQuery</span><span class="tok-o">().</span><span class="tok-na">processInstanceId</span><span class="tok-o">(</span><span class="tok-n">procId</span><span class="tok-o">).</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
    <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Process instance end time: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">historicProcessInstance</span><span class="tok-o">.</span><span class="tok-na">getEndTime</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnFirstExampleFutureEnhancements">7.3.12. 后续增强</h4>
<div class="paragraph">
<p>可以看出这个业务流程太简单了，不能实际使用。但只要继续学习Flowable中可用的BPMN 2.0结构，就可以通过以下元素增强业务流程：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>定义<strong>网关（gateway）</strong>使经理可以选择：驳回财务报告，并重新为会计师创建任务；或者接受报告。</p>
</li>
<li>
<p>定义并使用<strong>变量（variables）</strong>存储或引用报告，并可以在表单中显示它。</p>
</li>
<li>
<p>在流程结束处定义<strong>服务任务（service task）</strong>，将报告发送给每一个投资人。</p>
</li>
<li>
<p>等等。</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bpmnConstructs">8. BPMN 2.0结构</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本章节介绍Flowable支持的BPMN 2.0结构，以及Flowable对BPMN标准的自定义扩展。</p>
</div>
<div class="sect2">
<h3 id="bpmnCustomExtensions">8.1. 自定义扩展</h3>
<div class="paragraph">
<p>BPMN 2.0标准对流程的所有的参与者都很有用。最终用户不会因为依赖专有解决方案，而被供应商“绑架”。Flowable之类的开源框架，也可以提供与大型供应商的解决方案相同（经常是更好;-）的实现。有了BPMN 2.0标准，从大型供应商解决方案向Flowable的迁移，可以十分简单平滑。</p>
</div>
<div class="paragraph">
<p>缺点则是标准通常是不同公司（不同观点）大量讨论与妥协的结果。作为阅读BPMN 2.0 XML流程定义的开发者，有时会觉得某些结构或方法十分笨重。Flowable将开发者的感受放在最高优先，因此引入了一些<strong><em>Flowable BPMN扩展（extensions）</em></strong>。这些“扩展”并不在BPMN 2.0规格中，有些是新结构，有些是对特定结构的简化。</p>
</div>
<div class="paragraph">
<p>尽管BPMN 2.0规格明确指出可以支持自定义扩展，我们仍做了如下保证：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>自定义扩展<strong>保证是</strong>在<strong>标准方式</strong>的基础上进行简化。因此当你决定使用自定义扩展时，不用担心无路可退（仍然可以用标准方式）。</p>
</li>
<li>
<p>使用自定义扩展时，总是通过<strong>flowable:</strong>命名空间前缀，明确标识出XML元素、属性等。请注意Flowable引擎也支持<strong>activiti:</strong>命名空间前缀。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>因此是否使用自定义扩展，完全取决于你自己。有些其他因素会影响选择（图形化编辑器的使用，公司策略，等等）。我们提供扩展，只是因为相信标准中的某些地方可以用更简单或效率更高的方式处理。请不要吝啬给我们反馈你对扩展的评价（正面的或负面的），也可以给我们提供关于自定义扩展的新想法。说不定某一天，你的想法会成为标准的一部分！</p>
</div>
</div>
<div class="sect2">
<h3 id="bpmnEvents">8.2. 事件</h3>
<div class="paragraph">
<p>事件（event）通常用于为流程生命周期中发生的事情建模。事件总是图形化为圆圈。在BPMN 2.0中，有两种主要的事件分类：<em>捕获（catching）</em>与<em>抛出（throwing）</em>事件。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>捕获:</strong> 当流程执行到达这个事件时，会等待直到触发器动作。触发器的类型由其中的图标，或者说XML中的类型声明而定义。捕获事件与抛出事件显示上的区别，是其内部的图标没有填充（即是白色的）。</p>
</li>
<li>
<p><strong>抛出:</strong> 当流程执行到达这个事件时，会触发一个触发器。触发器的类型，由其中的图标，或者说XML中的类型声明而定义。抛出事件与捕获事件显示上的区别，是其内部的图标填充为黑色。</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="eventDefinitions">8.2.1. 事件定义</h4>
<div class="paragraph">
<p>事件定义（event definition），用于定义事件的语义。没有事件定义的话，事件就“不做什么特别的事情”。例如，一个没有事件定义的开始事件，并不限定具体是什么启动了流程。如果为这个开始事件添加事件定义（例如定时器事件定义），就声明了启动流程的“类型”（例如对于定时器事件定义，就是到达了特定的时间点）。</p>
</div>
</div>
<div class="sect3">
<h4 id="timerEventDefinitions">8.2.2. 定时器事件定义</h4>
<div class="paragraph">
<p>定时器事件（timer event definition），是由定时器所触发的事件。可以用于<a href="#bpmnTimerStartEvent">开始事件</a>，<a href="#bpmnIntermediateCatchingEvent">中间事件</a>，或<a href="#bpmnTimerBoundaryEvent">边界事件</a>。定时器事件的行为取决于所使用的业务日历（business calendar）。定时器事件有默认的业务日历，但也可以为每个定时器事件定义，单独定义业务日历。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;timerEventDefinition</span> <span class="tok-na">flowable:businessCalendarName=</span><span class="tok-s">&quot;custom&quot;</span><span class="tok-nt">&gt;</span>
    ...
<span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>其中businessCalendarName指向流程引擎配置中的业务日历。如果省略业务日历定义，则使用默认业务日历。</p>
</div>
<div class="paragraph">
<p>定时器定义必须且只能包含下列的一种元素：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>timeDate</strong>。这个元素指定了<a href="http://en.wikipedia.org/wiki/ISO_8601#Dates">ISO 8601</a>格式的固定时间。在这个时间就会触发触发器。例如：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;timerEventDefinition&gt;</span>
    <span class="tok-nt">&lt;timeDate&gt;</span>2011-03-11T12:13:14<span class="tok-nt">&lt;/timeDate&gt;</span>
<span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>timeDuration</strong>。要定义定时器需要等待多长时间再触发，可以用<em>timerEventDefinition</em>的子元素<em>timeDuration</em>。使用<a href="http://en.wikipedia.org/wiki/ISO_8601#Durations">ISO 8601</a>格式（BPMN 2.0规范要求）。例如（等待10天）：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;timerEventDefinition&gt;</span>
    <span class="tok-nt">&lt;timeDuration&gt;</span>P10D<span class="tok-nt">&lt;/timeDuration&gt;</span>
<span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>timeCycle</strong>。指定重复周期，可用于周期性启动流程，或者为超期用户任务多次发送提醒。这个元素可以使用两种格式。第一种是按照<a href="http://en.wikipedia.org/wiki/ISO_8601#Repeating_intervals">ISO 8601</a>标准定义的循环时间周期。例如（三次重复间隔，每次间隔为10小时）：</p>
</li>
<li>
<p>也可以使用<em>timeCycle</em>的可选属性<em>endDate</em>，或者像这样直接写在时间表达式的结尾：<code>R3/PT10H/${EndDate}</code>。
当到达endDate时，应用会停止，并为该任务创建其他作业。
可以使用<a href="http://en.wikipedia.org/wiki/ISO_8601#Dates">ISO 8601</a>标准的常量，如<em>"2015-02-25T16:42:11+00:00"</em>。也可以使用变量，如<em>${EndDate}</em></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;timerEventDefinition&gt;</span>
    <span class="tok-nt">&lt;timeCycle</span> <span class="tok-na">flowable:endDate=</span><span class="tok-s">&quot;2015-02-25T16:42:11+00:00&quot;</span><span class="tok-nt">&gt;</span>R3/PT10H<span class="tok-nt">&lt;/timeCycle&gt;</span>
<span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;timerEventDefinition&gt;</span>
    <span class="tok-nt">&lt;timeCycle&gt;</span>R3/PT10H/${EndDate}<span class="tok-nt">&lt;/timeCycle&gt;</span>
<span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果同时使用了两种格式，则系统会使用以属性方式定义的endDate。</p>
</div>
<div class="paragraph">
<p>目前只有<em>BoundaryTimerEvents</em>与<em>CatchTimerEvent</em>可以使用<em>EndDate</em>。</p>
</div>
<div class="paragraph">
<p>另外，也可以使用cron表达式指定定时周期。下面的例子展示了一个整点启动，每5分钟触发的触发器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>0 0/5 * * * ?</pre>
</div>
</div>
<div class="paragraph">
<p>请参考<a href="http://www.quartz-scheduler.org/documentation/quartz-2.x/tutorials/crontrigger.html">这个教程</a>了解如何使用cron表达式。</p>
</div>
<div class="paragraph">
<p><strong>请注意:</strong> 与普通的Unix cron不同，第一个符号代表的是秒，而不是分钟。</p>
</div>
<div class="paragraph">
<p>重复时间周期更适合使用相对时间，也就是从某个特定时间点开始计算（比如用户任务开始的时间）。而cron表达式可以使用绝对时间，因此更适合用于<a href="#timerStartEventDescription">定时启动事件</a>。</p>
</div>
<div class="paragraph">
<p>可以在定时事件定义中使用表达式，也就是使用流程变量控制定时。这个流程变量必须是包含合适时间格式的字符串，ISO 8601（或者对于循环类型，cron）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;boundaryEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;escalationTimer&quot;</span> <span class="tok-na">cancelActivity=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">attachedToRef=</span><span class="tok-s">&quot;firstLineSupport&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;timerEventDefinition&gt;</span>
    <span class="tok-nt">&lt;timeDuration&gt;</span>${duration}<span class="tok-nt">&lt;/timeDuration&gt;</span>
  <span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
<span class="tok-nt">&lt;/boundaryEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>定时器只有在异步执行器启用时才能触发（需要在<code>flowable.cfg.xml</code>中，将<em>asyncExecutorActivate</em>设置为<code>true</code>。因为默认情况下异步执行器都是禁用的）。</p>
</div>
</div>
<div class="sect3">
<h4 id="bpmnErrorEventDefinition">8.2.3. 错误事件定义</h4>
<div class="paragraph">
<p>（error event definition）</p>
</div>
<div class="paragraph">
<p><strong>重要提示：</strong> BPMN错误与Java异常<strong>不</strong>是一回事。事实上，这两者毫无共同点。BPMN错误事件是建模<em>业务异常（business exceptions）</em>的方式。而Java异常会按<a href="#serviceTaskExceptionHandling">它们自己的方式</a>处理。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myErrorEndEvent&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;errorEventDefinition</span> <span class="tok-na">errorRef=</span><span class="tok-s">&quot;myError&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/endEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnSignalEventDefinition">8.2.4. 信号事件定义</h4>
<div class="paragraph">
<p>信号事件（signal event），是引用具名信号的事件。信号是全局范围（广播）的事件，并会被传递给所有激活的处理器（等待中的流程实例/捕获信号事件 catching signal events）。</p>
</div>
<div class="paragraph">
<p>使用<code>signalEventDefinition</code>元素声明信号事件定义。其<code>signalRef</code>属性引用一个<code>signal</code>元素，该<code>signal</code>元素需要声明为<code>definitions</code>根元素的子元素。下面摘录一个流程，使用中间事件（intermediate event）抛出与捕获信号事件。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions...</span> <span class="tok-nt">&gt;</span>
    <span class="tok-c">&lt;!-- 声明信号 --&gt;</span>
    <span class="tok-nt">&lt;signal</span> <span class="tok-na">id=</span><span class="tok-s">&quot;alertSignal&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;alert&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;catchSignal&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;intermediateThrowEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;throwSignalEvent&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Alert&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-c">&lt;!-- 信号事件定义 --&gt;</span>
            <span class="tok-nt">&lt;signalEventDefinition</span> <span class="tok-na">signalRef=</span><span class="tok-s">&quot;alertSignal&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;/intermediateThrowEvent&gt;</span>
        ...
        <span class="tok-nt">&lt;intermediateCatchEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;catchSignalEvent&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;On Alert&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-c">&lt;!-- 信号事件定义 --&gt;</span>
            <span class="tok-nt">&lt;signalEventDefinition</span> <span class="tok-na">signalRef=</span><span class="tok-s">&quot;alertSignal&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;/intermediateCatchEvent&gt;</span>
        ...
    <span class="tok-nt">&lt;/process&gt;</span>
<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>两个<code>signalEventDefinition</code>引用同一个<code>signal</code>元素。</p>
</div>
<div class="sect4">
<h5 id="bpmnSignalEventDefinitionThrow">抛出信号事件</h5>
<div class="paragraph">
<p>信号可以由流程实例使用BPMN结构抛出（throw），也可以通过编程方式使用Java API抛出。下面<code>org.flowable.engine.RuntimeService</code>中的方法可以用编程方式抛出信号：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">RuntimeService</span><span class="tok-o">.</span><span class="tok-na">signalEventReceived</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">signalName</span><span class="tok-o">);</span>
<span class="tok-n">RuntimeService</span><span class="tok-o">.</span><span class="tok-na">signalEventReceived</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">signalName</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>signalEventReceived(String signalName)</code>与<code>signalEventReceived(String signalName, String executionId)</code>的区别，是前者在全局范围为所有已订阅处理器抛出信号（广播），而后者只为指定的执行传递信号。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnSignalEventDefinitionCatch">捕获信号事件</h5>
<div class="paragraph">
<p>可以使用信号捕获中间事件（intermediate catch signal event）或者信号边界事件（signal boundary event）捕获信号事件。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnSignalEventDefinitionQuery">查询信号事件订阅</h5>
<div class="paragraph">
<p>可以查询订阅了某一信号事件的所有执行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Execution</span><span class="tok-o">&gt;</span> <span class="tok-n">executions</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createExecutionQuery</span><span class="tok-o">()</span>
      <span class="tok-o">.</span><span class="tok-na">signalEventSubscriptionName</span><span class="tok-o">(</span><span class="tok-s">&quot;alert&quot;</span><span class="tok-o">)</span>
      <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用<code>signalEventReceived(String signalName, String executionId)</code>方法为这些执行传递这个信号。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnSignalEventDefinitionScope">信号事件的范围</h5>
<div class="paragraph">
<p>默认情况下，信号事件在<em>流程引擎全局广播</em>。这意味着你可以在一个流程实例中抛出一个信号事件，而不同流程定义的不同流程实例都会响应这个事件。</p>
</div>
<div class="paragraph">
<p>但有时也会希望只在<em>同一个流程实例</em>中响应信号事件。例如，在流程实例中使用异步机制，而两个或多个活动彼此互斥的时候。</p>
</div>
<div class="paragraph">
<p>要限制信号事件的<em>范围（scope）</em>，在信号事件定义中添加（非BPMN 2.0标准！）<em>scope属性</em>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;signal</span> <span class="tok-na">id=</span><span class="tok-s">&quot;alertSignal&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;alert&quot;</span> <span class="tok-na">flowable:scope=</span><span class="tok-s">&quot;processInstance&quot;</span><span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这个属性的默认值为<em>"global（全局）"</em>。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnSignalEventDefinitionExample">信号事件示例</h5>
<div class="paragraph">
<p>下面是一个不同流程通过信号通信的例子。第一个流程在保险政策更新或变更时启动。在变更由人工审核之后，会抛出信号事件，指出政策已经发生了变更：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.signal.event.throw.png" alt="bpmn.signal.event.throw">
</div>
</div>
<div class="paragraph">
<p>这个事件可以被所有感兴趣的流程实例捕获。下面是一个订阅这个事件的流程的例子。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.signal.event.catch.png" alt="bpmn.signal.event.catch">
</div>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>要理解信号事件会广播给<strong>所有</strong>激活的处理器，这很重要。这意味着在上面的例子中，所有订阅这个信号的流程实例都会接收这个信号。在这个例子中这就是我们期望的。然而，有的情况下，不希望使用广播方式。考虑下面的流程：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.signal.event.warning.1.png" alt="bpmn.signal.event.warning.1">
</div>
</div>
<div class="paragraph">
<p>Flowable不支持上面流程中描述的模式。我们的想法是，在执行"do something"任务时抛出的错误，由错误边界事件捕获，并通过信号抛出事件传播至执行的并行分支，最终中断"do something in parallel"任务。到目前为止Flowable会按照预期效果执行。<strong>然而，由于信号的广播效应，它也会被传播至所有其他订阅了这个信号事件的流程实例。</strong>这可能并非我们希望的效果。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>信号事件与特定的流程实例无关，而是会广播给所有流程实例。如果你需要只为某一特定的流程实例传递信号，则需要使用<code>signalEventReceived(String signalName, String executionId)</code>手动建立关联，并使用适当的的<a href="#bpmnSignalEventDefinitionQuery">查询机制</a>。</p>
</div>
<div class="paragraph">
<p>Flowable提供了解决的方法。可以在信号事件上添加<em>scope</em>属性，并将其设置为<em>processInstance</em>。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnMessageEventDefinition">8.2.5. 消息事件定义</h4>
<div class="paragraph">
<p>消息事件（message event），是指引用具名消息的事件。消息具有名字与载荷。与信号不同，消息事件只有一个接收者。</p>
</div>
<div class="paragraph">
<p>消息事件定义使用<code>messageEventDefinition</code>元素声明。其<code>messageRef</code>属性引用一个<code>message</code>元素，该<code>message</code>元素需要声明为<code>definitions</code>根元素的子元素。下面摘录一个流程，声明了两个消息事件，并由开始事件与消息捕获中间事件（intermediate catching message event）引用。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span> <span class="tok-na">id=</span><span class="tok-s">&quot;definitions&quot;</span>
  <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot;</span>
  <span class="tok-na">xmlns:flowable=</span><span class="tok-s">&quot;http://flowable.org/bpmn&quot;</span>
  <span class="tok-na">targetNamespace=</span><span class="tok-s">&quot;Examples&quot;</span>
  <span class="tok-na">xmlns:tns=</span><span class="tok-s">&quot;Examples&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;message</span> <span class="tok-na">id=</span><span class="tok-s">&quot;newInvoice&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;newInvoiceMessage&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;message</span> <span class="tok-na">id=</span><span class="tok-s">&quot;payment&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;paymentMessage&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;invoiceProcess&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;messageStart&quot;</span> <span class="tok-nt">&gt;</span>
    	<span class="tok-nt">&lt;messageEventDefinition</span> <span class="tok-na">messageRef=</span><span class="tok-s">&quot;newInvoice&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/startEvent&gt;</span>
    ...
    <span class="tok-nt">&lt;intermediateCatchEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;paymentEvt&quot;</span> <span class="tok-nt">&gt;</span>
    	<span class="tok-nt">&lt;messageEventDefinition</span> <span class="tok-na">messageRef=</span><span class="tok-s">&quot;payment&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/intermediateCatchEvent&gt;</span>
    ...
  <span class="tok-nt">&lt;/process&gt;</span>

<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="bpmnMessageEventDefinitionThrow">抛出消息事件</h5>
<div class="paragraph">
<p>作为嵌入式的流程引擎，Flowable并不关心实际如何接收消息。因为这可能与环境相关，或需要进行平台定义的操作。例如连接至JMS（Java Messaging Service，Java消息服务）队列（Queue）/主题（Topic），或者处理Webservice或者REST请求。因此接收消息需要作为应用的一部分，或者是流程引擎所嵌入的基础框架中的一部分，由你自行实现。</p>
</div>
<div class="paragraph">
<p>在应用中接收到消息后，需要决定如何处理它。如果这个消息需要启动新的流程实例，可以选择一种由runtime服务提供的方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">ProcessInstance</span> <span class="tok-nf">startProcessInstanceByMessage</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">messageName</span><span class="tok-o">);</span>
<span class="tok-n">ProcessInstance</span> <span class="tok-nf">startProcessInstanceByMessage</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">messageName</span><span class="tok-o">,</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">processVariables</span><span class="tok-o">);</span>
<span class="tok-n">ProcessInstance</span> <span class="tok-nf">startProcessInstanceByMessage</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">messageName</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">businessKey</span><span class="tok-o">,</span>
    <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">processVariables</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这些方法使用消息启动流程实例。</p>
</div>
<div class="paragraph">
<p>如果需要由已有的流程实例接收消息，需要首先将消息与特定的流程实例关联（查看后续章节），然后触发等待中的执行，让流程继续进行。runtime服务提供了下列方法，可以触发订阅了消息事件的执行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-kt">void</span> <span class="tok-nf">messageEventReceived</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">messageName</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">);</span>
<span class="tok-kt">void</span> <span class="tok-nf">messageEventReceived</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">messageName</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">executionId</span><span class="tok-o">,</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">processVariables</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnMessageEventDefinitionQuery">查询消息事件订阅</h5>
<div class="ulist">
<ul>
<li>
<p>对于消息启动事件（message start event），消息事件的订阅与的<em>流程定义</em>相关。可以使用<code>ProcessDefinitionQuery</code>查询这种类型的消息订阅：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-n">ProcessDefinition</span> <span class="tok-n">processDefinition</span> <span class="tok-o">=</span> <span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">createProcessDefinitionQuery</span><span class="tok-o">()</span>
      <span class="tok-o">.</span><span class="tok-na">messageEventSubscription</span><span class="tok-o">(</span><span class="tok-s">&quot;newCallCenterBooking&quot;</span><span class="tok-o">)</span>
      <span class="tok-o">.</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>因为一个消息只能被一个流程定义订阅，因此这个查询总是返回0或1个结果。如果流程定义更新了，只有该流程定义的最新版本会订阅这个消息事件。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>对于消息捕获中间事件（intermediate catch message event），消息事件的订阅与<em>执行</em>相关。可以使用<code>ExecutionQuery</code>查询这种类型的消息订阅：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">Execution</span> <span class="tok-n">execution</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createExecutionQuery</span><span class="tok-o">()</span>
      <span class="tok-o">.</span><span class="tok-na">messageEventSubscriptionName</span><span class="tok-o">(</span><span class="tok-s">&quot;paymentReceived&quot;</span><span class="tok-o">)</span>
      <span class="tok-o">.</span><span class="tok-na">variableValueEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;orderId&quot;</span><span class="tok-o">,</span> <span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">getOrderId</span><span class="tok-o">())</span>
      <span class="tok-o">.</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这种查询通常都会有关联查询，并且通常需要了解流程的情况（在这个例子里，对于给定的orderId，至多只有一个流程实例）。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnMessageEventDefinitionExample">消息事件示例</h5>
<div class="paragraph">
<p>下面是一个流程的例子，可以使用两种不同的消息启动：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.start.message.event.example.1.png" alt="bpmn.start.message.event.example.1">
</div>
</div>
<div class="paragraph">
<p>在流程需要通过不同的方式启动，但是后续使用统一的方式处理时，就可以使用这种方法。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnStartEvents">8.2.6. 启动事件</h4>
<div class="paragraph">
<p>启动事件（start event）是流程的起点。启动事件的类型（流程在消息到达时启动，在指定的时间间隔后启动，等等），定义了流程<em>如何</em>启动，并显示为启动事件中的小图标。在XML中，类型由子元素声明来定义。</p>
</div>
<div class="paragraph">
<p>启动事件<strong>随时捕获</strong>：启动事件（保持）等候，直到特定的触发器被触发。</p>
</div>
<div class="paragraph">
<p>在启动事件中，可以使用下列Flowable自定义参数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>initiator</strong>: 指明保存认证用户（authenticated user）ID用的变量名。在流程启动时，操作用户的ID会保存在这个变量中。例如：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;request&quot;</span> <span class="tok-na">flowable:initiator=</span><span class="tok-s">&quot;initiator&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>认证用户必须在try-finally块中调用<code>IdentityService.setAuthenticatedUserId(String)</code>方法进行设置。像这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-k">try</span> <span class="tok-o">{</span>
  <span class="tok-n">identityService</span><span class="tok-o">.</span><span class="tok-na">setAuthenticatedUserId</span><span class="tok-o">(</span><span class="tok-s">&quot;bono&quot;</span><span class="tok-o">);</span>
  <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;someProcessKey&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span> <span class="tok-k">finally</span> <span class="tok-o">{</span>
  <span class="tok-n">identityService</span><span class="tok-o">.</span><span class="tok-na">setAuthenticatedUserId</span><span class="tok-o">(</span><span class="tok-kc">null</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这段代码已经集成在Flowable应用中，可以在<a href="#forms">表单</a>中使用。</p>
</div>
</div>
<div class="sect3">
<h4 id="bpmnNoneStartEvent">8.2.7. 空启动事件</h4>
<div class="sect4">
<h5 id="noneStartEventDescription">描述</h5>
<div class="paragraph">
<p>“空”启动事件（none Start Event），指的是未指定启动流程实例触发器的启动事件。引擎将无法预知何时启动流程实例。空启动事件用于流程实例通过调用下列<em>startProcessInstanceByXXX</em> API方法启动的情况。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">ProcessInstance</span> <span class="tok-n">processInstance</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByXXX</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>请注意：</em>子流程（sub-process）必须有空启动事件。</p>
</div>
</div>
<div class="sect4">
<h5 id="noneStartEventGraphicalNotation">图示</h5>
<div class="paragraph">
<p>空启动事件用空心圆圈表示，中间没有图标（也就是说，没有触发器）。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.none.start.event.png" alt="bpmn.none.start.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="noneStartEventXml">XML表示</h5>
<div class="paragraph">
<p>空启动事件的XML表示格式，就是普通的启动事件声明，而没有任何子元素（其他种类的启动事件都有用于声明其类型的子元素）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;my start event&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="noneStartEventCustomExtension">空启动事件的自定义扩展</h5>
<div class="paragraph">
<p><strong>formKey</strong>: 引用表单定义，用户需要在启动新流程实例时填写该表单。可以在<a href="#forms">表单章节</a>找到更多信息。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;request&quot;</span> <span class="tok-na">flowable:formKey=</span><span class="tok-s">&quot;request&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnTimerStartEvent">8.2.8. 定时器启动事件</h4>
<div class="sect4">
<h5 id="timerStartEventDescription">描述</h5>
<div class="paragraph">
<p>定时器启动事件（timer start event）在指定时间创建流程实例。在流程只需要启动一次，或者流程需要在特定的时间间隔重复启动时，都可以使用。</p>
</div>
<div class="paragraph">
<p><em>请注意：</em>子流程不能有定时器启动事件。</p>
</div>
<div class="paragraph">
<p><em>请注意：</em>定时器启动事件，在流程部署的同时就开始计时。不需要调用startProcessInstanceByXXX就会在时间启动。调用startProcessInstanceByXXX时会在定时启动之外额外启动一个流程。</p>
</div>
<div class="paragraph">
<p><em>请注意：</em>当部署带有定时器启动事件的流程的更新版本时，上一版本的定时器作业会被移除。这是因为通常并不希望旧版本的流程仍然自动启动新的流程实例。</p>
</div>
</div>
<div class="sect4">
<h5 id="timerStartEventGraphicalNotation">图示</h5>
<div class="paragraph">
<p>定时器启动事件，用其中有一个钟表图标的圆圈来表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.clock.start.event.png" alt="bpmn.clock.start.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="timerStartEventXml">XML表示</h5>
<div class="paragraph">
<p>定时器启动事件的XML表示格式，是普通的启动事件声明加上定时器定义子元素。请参考<a href="#timerEventDefinitions">定时器定义</a>了解详细配置方法。</p>
</div>
<div class="paragraph">
<p>示例：流程会启动4次，间隔5分钟，从2011年3月11日，12:13开始</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;timerEventDefinition&gt;</span>
    <span class="tok-nt">&lt;timeCycle&gt;</span>R4/2011-03-11T12:13/PT5M<span class="tok-nt">&lt;/timeCycle&gt;</span>
  <span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
<span class="tok-nt">&lt;/startEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>示例：流程会在设定的时间启动一次</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;timerEventDefinition&gt;</span>
    <span class="tok-nt">&lt;timeDate&gt;</span>2011-03-11T12:13:14<span class="tok-nt">&lt;/timeDate&gt;</span>
  <span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
<span class="tok-nt">&lt;/startEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnMessageStartEvent">8.2.9. 消息启动事件</h4>
<div class="sect4">
<h5 id="messageStartEventDescription">描述</h5>
<div class="paragraph">
<p><a href="#bpmnMessageEventDefinition">消息</a>启动事件（message start event）使用具名消息启动流程实例。消息名用于<em>选择</em>正确的启动事件。</p>
</div>
<div class="paragraph">
<p>当<strong>部署</strong>具有一个或多个消息启动事件的流程定义时，会做如下判断：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>给定流程定义中，消息启动事件的名字必须是唯一的。一个流程定义不得包含多个同名的消息启动事件。如果流程定义中有两个或多个消息启动事件引用同一个消息，或者两个或多个消息启动事件引用了具有相同消息名字的消息，则Flowable会在部署这个流程定义时抛出异常。</p>
</li>
<li>
<p>在所有已部署的流程定义中，消息启动事件的名字必须是唯一的。如果在流程定义中，一个或多个消息启动事件引用了已经部署的另一流程定义中消息启动事件的消息名，则Flowable会在部署这个流程定义时抛出异常。</p>
</li>
<li>
<p>流程版本：在部署流程定义的新版本时，会取消上一版本的消息订阅，即使新版本中并没有这个消息事件）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在<strong>启动</strong>流程实例时，可以使用下列<code>RuntimeService</code>中的方法，触发消息启动事件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">ProcessInstance</span> <span class="tok-nf">startProcessInstanceByMessage</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">messageName</span><span class="tok-o">);</span>
<span class="tok-n">ProcessInstance</span> <span class="tok-nf">startProcessInstanceByMessage</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">messageName</span><span class="tok-o">,</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">processVariables</span><span class="tok-o">);</span>
<span class="tok-n">ProcessInstance</span> <span class="tok-nf">startProcessInstanceByMessage</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">messageName</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">businessKey</span><span class="tok-o">,</span>
    <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&lt;</span> <span class="tok-n">processVariables</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>messageName</code>是由<code>message</code>元素的<code>name</code>属性给定的名字。<code>messageEventDefinition</code>的<code>messageRef</code>属性会引用<code>message</code>元素。当<strong>启动</strong>流程实例时，会做如下判断：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>只有顶层流程（top-level process）才支持消息启动事件。嵌入式子流程不支持消息启动事件。</p>
</li>
<li>
<p>如果一个流程定义中有多个消息启动事件，可以使用<code>runtimeService.startProcessInstanceByMessage(&#8230;&#8203;)</code>选择合适的启动事件。</p>
</li>
<li>
<p>如果一个流程定义中有多个消息启动事件与一个空启动事件，则<code>runtimeService.startProcessInstanceByKey(&#8230;&#8203;)</code>与<code>runtimeService.startProcessInstanceById(&#8230;&#8203;)</code>会使用空启动事件启动流程实例。</p>
</li>
<li>
<p>如果一个流程定义中有多个消息启动事件而没有空启动事件，则<code>runtimeService.startProcessInstanceByKey(&#8230;&#8203;)</code>与<code>runtimeService.startProcessInstanceById(&#8230;&#8203;)</code>会抛出异常。</p>
</li>
<li>
<p>如果一个流程定义中只有一个消息启动事件，则<code>runtimeService.startProcessInstanceByKey(&#8230;&#8203;)</code>与<code>runtimeService.startProcessInstanceById(&#8230;&#8203;)</code>会使用这个消息启动事件启动新流程实例。</p>
</li>
<li>
<p>如果流程由调用活动（call activity）启动，则只有在下列情况下才支持消息启动事件</p>
<div class="ulist">
<ul>
<li>
<p>除了消息启动事件之外，流程还有唯一的空启动事件</p>
</li>
<li>
<p>或者流程只有唯一的消息启动事件，而没有其他启动事件。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="messageStartEventGraphicalNotation">图示</h5>
<div class="paragraph">
<p>消息启动事件用其中有一个消息事件标志的圆圈表示。这个标志并未填充，用以表示捕获（接收）行为。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.start.message.event.png" alt="bpmn.start.message.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="messageStartEventXml">XML表示</h5>
<div class="paragraph">
<p>消息启动事件的XML表示格式，为普通启动事件声明加上messageEventDefinition子元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span> <span class="tok-na">id=</span><span class="tok-s">&quot;definitions&quot;</span>
  <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot;</span>
  <span class="tok-na">xmlns:flowable=</span><span class="tok-s">&quot;http://flowable.org/bpmn&quot;</span>
  <span class="tok-na">targetNamespace=</span><span class="tok-s">&quot;Examples&quot;</span>
  <span class="tok-na">xmlns:tns=</span><span class="tok-s">&quot;Examples&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;message</span> <span class="tok-na">id=</span><span class="tok-s">&quot;newInvoice&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;newInvoiceMessage&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;invoiceProcess&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;messageStart&quot;</span> <span class="tok-nt">&gt;</span>
    	<span class="tok-nt">&lt;messageEventDefinition</span> <span class="tok-na">messageRef=</span><span class="tok-s">&quot;tns:newInvoice&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/startEvent&gt;</span>
    ...
  <span class="tok-nt">&lt;/process&gt;</span>

<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnSignalStartEvent">8.2.10. 信号启动事件</h4>
<div class="sect4">
<h5 id="bpmnSignalStartEventDescription">描述</h5>
<div class="paragraph">
<p><a href="#bpmnSignalEventDefinition">信号</a>启动事件（signal start event），使用具名信号启动流程实例。这个信号可以由流程实例中的信号抛出中间事件（intermediary signal throw event），或者API（<em>runtimeService.signalEventReceivedXXX</em>方法）触发。两种方式都会启动所有拥有相同名字信号启动事件的流程定义。</p>
</div>
<div class="paragraph">
<p>请注意可以选择异步还是同步启动流程实例。</p>
</div>
<div class="paragraph">
<p>需要为API传递的<code>signalName</code>，是由<code>signal</code>元素的<code>name</code>属性决定的名字。<code>signal</code>元素由<code>signalEventDefinition</code>的<code>signalRef</code>属性引用。</p>
</div>
</div>
<div class="sect4">
<h5 id="signalStartEventGraphicalNotation">图示</h5>
<div class="paragraph">
<p>信号启动事件用其中有一个信号事件标志的圆圈表示。这个标志并未填充，用以表示捕获（接收）行为。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.start.signal.event.png" alt="bpmn.start.signal.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="signalStartEventXml">XML表示</h5>
<div class="paragraph">
<p>信号启动事件的XML表示格式，为普通启动事件声明，加上signalEventDefinition子元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-nt">&lt;signal</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theSignal&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;The Signal&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processWithSignalStart1&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;signalEventDefinition</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theSignalEventDefinition&quot;</span> <span class="tok-na">signalRef=</span><span class="tok-s">&quot;theSignal&quot;</span>  <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/startEvent&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Task in process A&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnErrorStartEvent">8.2.11. 错误启动事件</h4>
<div class="sect4">
<h5 id="errorStartEventDescription">描述</h5>
<div class="paragraph">
<p><a href="#bpmnErrorEventDefinition">错误</a>启动事件（error start event），可用于触发事件子流程（Event Sub-Process）。<strong>错误启动事件不能用于启动流程实例</strong>。</p>
</div>
<div class="paragraph">
<p>错误启动事件总是中断。</p>
</div>
</div>
<div class="sect4">
<h5 id="errorStartEventGraphicalNotation">图示</h5>
<div class="paragraph">
<p>错误启动事件用其中有一个错误事件标志的圆圈表示。这个标志并未填充，用以表示捕获（接收）行为。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.start.error.event.png" alt="bpmn.start.error.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="errorStartEventXml">XML表示</h5>
<div class="paragraph">
<p>错误启动事件的XML表示格式，为普通启动事件声明加上errorEventDefinition子元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;messageStart&quot;</span> <span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;errorEventDefinition</span> <span class="tok-na">errorRef=</span><span class="tok-s">&quot;someError&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/startEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnEndEvent">8.2.12. 结束事件</h4>
<div class="paragraph">
<p>结束事件（end event）标志着流程或子流程中一个分支的结束。结束事件<strong>总是抛出（型）事件</strong>。这意味着当流程执行到达结束事件时，会抛出一个<em>结果</em>。结果的类型由事件内部的黑色图标表示。在XML表示中，类型由子元素声明给出。</p>
</div>
</div>
<div class="sect3">
<h4 id="bpmnNoneEndEvent">8.2.13. 空结束事件</h4>
<div class="sect4">
<h5 id="noneEndEventDescription">描述</h5>
<div class="paragraph">
<p>“空”结束事件(none end event)，意味着当到达这个事件时，没有特别指定抛出的<em>结果</em>。因此，引擎除了结束当前执行分支之外，不会多做任何事情。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnNoneEndEventDescription">图示</h5>
<div class="paragraph">
<p>空结束事件，用其中没有图标（没有结果类型）的粗圆圈表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.none.end.event.png" alt="bpmn.none.end.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnNoneStartEventXml">XML表示</h5>
<div class="paragraph">
<p>空事件的XML表示格式为普通结束事件声明，没有任何子元素（其它种类的结束事件都有子元素，用于声明其类型）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;my end event&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnErrorEndEvent">8.2.14. 错误结束事件</h4>
<div class="sect4">
<h5 id="bpmnErrorEndEventDescription">描述</h5>
<div class="paragraph">
<p>当流程执行到达<strong>错误结束事件（error end event）</strong>时，结束执行的当前分支，并抛出错误。这个错误可以<a href="#bpmnBoundaryErrorEvent">由匹配的错误边界中间事件捕获</a>。如果找不到匹配的错误边界事件，将会抛出异常。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnErrorEndEventGraphicalNotation">图示</h5>
<div class="paragraph">
<p>错误结束事件事件用内部有一个错误图标的标准结束事件（粗圆圈）表示。错误图标是全黑的，代表抛出的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.error.end.event.png" alt="bpmn.error.end.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnErrorEndEventXml">XML表示</h5>
<div class="paragraph">
<p>错误结束事件表示为结束事件，加上<em>errorEventDefinition</em>子元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myErrorEndEvent&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;errorEventDefinition</span> <span class="tok-na">errorRef=</span><span class="tok-s">&quot;myError&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/endEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>errorRef</em>属性可以引用在流程外定义的<em>error</em>元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;error</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myError&quot;</span> <span class="tok-na">errorCode=</span><span class="tok-s">&quot;123&quot;</span> <span class="tok-nt">/&gt;</span>
...
<span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myProcess&quot;</span><span class="tok-nt">&gt;</span>
...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>error</em>的<strong>errorCode</strong>用于查找匹配的错误捕获边界事件。如果<em>errorRef</em>不匹配任何已定义的<em>error</em>，则该<em>errorRef</em>会用做<em>errorCode</em>的快捷方式。这个快捷方式是Flowable特有的。下面的代码片段在功能上是相同的。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-nt">&lt;error</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myError&quot;</span> <span class="tok-na">errorCode=</span><span class="tok-s">&quot;error123&quot;</span> <span class="tok-nt">/&gt;</span>
...
<span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myProcess&quot;</span><span class="tok-nt">&gt;</span>
...
  <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myErrorEndEvent&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;errorEventDefinition</span> <span class="tok-na">errorRef=</span><span class="tok-s">&quot;myError&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/endEvent&gt;</span>
...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>与下面的代码功能相同</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myErrorEndEvent&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;errorEventDefinition</span> <span class="tok-na">errorRef=</span><span class="tok-s">&quot;error123&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/endEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意<em>errorRef</em>必须遵从BPMN 2.0概要（schema），且必须是合法的QName。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnTerminateEndEvent">8.2.15. 终止结束事件</h4>
<div class="sect4">
<h5 id="_描述">描述</h5>
<div class="paragraph">
<p>当到达<em>终止结束事件（terminate end event）</em>时，当前的流程实例或子流程会被终止。也就是说，当执行到达终止结束事件时，会判断第一个<em>范围 scope</em>（流程或子流程）并终止它。请注意在BPMN 2.0中，子流程可以是嵌入式子流程，调用活动，事件子流程，或事务子流程。有一条通用规则：当存在多实例的调用过程或嵌入式子流程时，只会终止一个实例，其他的实例与流程实例不会受影响。</p>
</div>
<div class="paragraph">
<p>可以添加一个可选属性<em>terminateAll</em>。当其为<em>true</em>时，无论该终止结束事件在流程定义中的位置，也无论它是否在子流程（甚至是嵌套子流程）中，都会终止（根）流程实例。</p>
</div>
</div>
<div class="sect4">
<h5 id="_图示">图示</h5>
<div class="paragraph">
<p>终止结束事件用内部有一个全黑圆的标准结束事件（粗圆圈）表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.terminate.end.event.png" alt="bpmn.terminate.end.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_xml表示">XML表示</h5>
<div class="paragraph">
<p>终止结束事件，表示为结束事件，加上<em>terminateEventDefinition</em>子元素。</p>
</div>
<div class="paragraph">
<p>请注意<em>terminateAll</em>属性是可选的（默认为<em>false</em>）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myEndEvent &gt;</span>
<span class="tok-s">  &lt;terminateEventDefinition flowable:terminateAll=&quot;</span><span class="tok-err">true&quot;</span><span class="tok-nt">&gt;&lt;/terminateEventDefinition&gt;</span>
<span class="tok-nt">&lt;/endEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnCancelEndEvent">8.2.16. 取消结束事件</h4>
<div class="sect4">
<h5 id="bpmnCancelEndEventDescription">描述</h5>
<div class="paragraph">
<p>取消结束事件（cancel end event）只能与BPMN事务子流程（BPMN transaction subprocess）一起使用。当到达取消结束事件时，会抛出取消事件，且必须由取消边界事件（cancel boundary event）捕获。取消边界事件将取消事务，并触发补偿（compensation）。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCancelEndEventGraphicalNotation">图示</h5>
<div class="paragraph">
<p>取消结束事件用内部有一个取消图标的标准结束事件（粗圆圈）表示。取消图标是全黑的，代表抛出的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.cancel.end.event.png" alt="bpmn.cancel.end.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCancelEndEventXml">XML表示</h5>
<div class="paragraph">
<p>取消结束事件，表示为结束事件，加上<em>cancelEventDefinition</em>子元素。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myCancelEndEvent&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;cancelEventDefinition</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/endEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnBoundaryEvent">8.2.17. 边界事件</h4>
<div class="paragraph">
<p>边界事件（boundary event）是<em>捕获型</em>事件，依附在活动（activity）上。边界事件永远不会抛出。这意味着当活动运行时，事件将<em>监听</em>特定类型的触发器。当<em>捕获</em>到事件时，会终止活动，并沿该事件的出口顺序流继续。</p>
</div>
<div class="paragraph">
<p>所有的边界事件都用相同的方式定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;boundaryEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myBoundaryEvent&quot;</span> <span class="tok-na">attachedToRef=</span><span class="tok-s">&quot;theActivity&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;XXXEventDefinition/&gt;</span>
<span class="tok-nt">&lt;/boundaryEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>边界事件由下列元素定义：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>（流程范围内）唯一的标识符</p>
</li>
<li>
<p>由<strong>attachedToRef</strong>属性定义的，对该事件所依附的活动的引用。请注意边界事件及其所依附的活动，应定义在相同级别（也就是说，边界事件并不包含在活动内）。</p>
</li>
<li>
<p>定义了边界事件的类型的，形如<em>XXXEventDefinition</em>的XML子元素（例如<em>TimerEventDefinition</em>，<em>ErrorEventDefinition</em>，等等）。查阅特定的边界事件类型，以了解更多细节。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="bpmnTimerBoundaryEvent">8.2.18. 定时器边界事件</h4>
<div class="sect4">
<h5 id="timerBoundaryEventDescription">描述</h5>
<div class="paragraph">
<p>定时器边界事件（timer boundary event）的行为像是跑表与闹钟。当执行到达边界事件所依附的活动时，将启动定时器。当定时器触发时（例如在特定时间间隔后），可以中断活动，并沿着边界事件的出口顺序流继续执行。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnTimerBoundaryEventGraphicalNotation">图示</h5>
<div class="paragraph">
<p>定时器边界事件用内部有一个定时器图标的标准边界事件（圆圈）表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.timer.event.png" alt="bpmn.boundary.timer.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnTimerBoundaryEventXml">XML表示</h5>
<div class="paragraph">
<p>定时器边界事件与<a href="#bpmnBoundaryEvent">一般边界事件</a>一样定义。其中类型子元素为<strong>timerEventDefinition</strong>元素。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;boundaryEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;escalationTimer&quot;</span> <span class="tok-na">cancelActivity=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">attachedToRef=</span><span class="tok-s">&quot;firstLineSupport&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;timerEventDefinition&gt;</span>
    <span class="tok-nt">&lt;timeDuration&gt;</span>PT4H<span class="tok-nt">&lt;/timeDuration&gt;</span>
  <span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
<span class="tok-nt">&lt;/boundaryEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请参考<a href="#timerEventDefinitions">定时器事件定义</a>了解定时器配置的细节。</p>
</div>
<div class="paragraph">
<p>在图示中圆圈画为虚线，如下：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.non.interrupting.boundary.timer.event.png" alt="bpmn.non.interrupting.boundary.timer.event">
</div>
</div>
<div class="paragraph">
<p>中断与非中断定时器事件是不同的。非中断意味着最初的活动<strong>不会</strong>被中断，而会保持原样。默认为中断行为。在XML表示中，<em>cancelActivity</em>属性设置为false。</p>
</div>
<div class="paragraph">
<p>一个典型使用场景，是在一段时间之后发送提醒邮件，但不影响正常的流程流向。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;boundaryEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;escalationTimer&quot;</span> <span class="tok-na">cancelActivity=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-na">attachedToRef=</span><span class="tok-s">&quot;firstLineSupport&quot;</span><span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>定时器边界事件只有在异步执行器（async executor）启用时才能触发（也就是说，需要在<code>flowable.cfg.xml</code>中，将<em>asyncExecutorActivate</em>设置为<code>true</code>。因为异步执行器默认情况下是禁用的。）</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnKnownIssueBoundaryEvent">边界事件的已知问题</h5>
<div class="paragraph">
<p>所有类型的边界事件，都有一个关于并发的已知问题：不能在边界事件上附加多个出口顺序流。这个问题的解决方案，是使用一条出口顺序流，指向并行网关。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.known.issue.boundary.event.png" alt="bpmn.known.issue.boundary.event">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnBoundaryErrorEvent">8.2.19. 错误边界事件</h4>
<div class="sect4">
<h5 id="bpmnBoundaryErrorEventDescription">描述</h5>
<div class="paragraph">
<p>在活动边界上的错误<em>捕获</em>中间（事件），或简称<strong>错误边界事件（error boundary event）</strong>，捕获其所依附的活动范围内抛出的错误。</p>
</div>
<div class="paragraph">
<p>在<a href="#bpmnSubProcess">嵌入式子流程</a>或者<a href="#bpmnCallActivity">调用活动</a>上定义错误边界事件最有意义，因为子流程的范围会包括其中的所有活动。错误可以由<a href="#bpmnErrorEndEvent">错误结束事件</a>抛出。这样的错误会逐层向其上级父范围传播，直到在范围内找到一个匹配错误事件定义的错误边界事件。</p>
</div>
<div class="paragraph">
<p>当捕获错误事件时，会销毁边界事件定义所在的活动，同时销毁其中所有的当前执行（例如，并行活动，嵌套子流程，等等）。流程执行将沿着边界事件的出口顺序流继续。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryErrorEventgraphicalNotation">图示</h5>
<div class="paragraph">
<p>错误边界事件用内部有一个错误图标的标准中间事件（两层圆圈）表示。错误图标是白色的，代表<em>捕获</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.error.event.png" alt="bpmn.boundary.error.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryErrorEventXml">XML表示</h5>
<div class="paragraph">
<p>错误边界事件与标准<a href="#bpmnBoundaryEvent">边界事件</a>一样定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;boundaryEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;catchError&quot;</span> <span class="tok-na">attachedToRef=</span><span class="tok-s">&quot;mySubProcess&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;errorEventDefinition</span> <span class="tok-na">errorRef=</span><span class="tok-s">&quot;myError&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/boundaryEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在<a href="#bpmnBoundaryEvent">边界事件</a>中，<em>errorRef</em>引用一个流程元素外定义的错误：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;error</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myError&quot;</span> <span class="tok-na">errorCode=</span><span class="tok-s">&quot;123&quot;</span> <span class="tok-nt">/&gt;</span>
...
<span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myProcess&quot;</span><span class="tok-nt">&gt;</span>
...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>errorCode</strong>用于匹配捕获的错误：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果省略了<em>errorRef</em>，错误边界事件会捕获<strong>所有错误事件</strong>，无论<em>error</em>的errorCode是什么。</p>
</li>
<li>
<p>如果提供了<em>errorRef</em>，并且其引用了存在的<em>error</em>，则边界事件<strong>只会捕获相同错误代码的错误</strong>。</p>
</li>
<li>
<p>如果提供了<em>errorRef</em>，但BPMN 2.0文件中没有定义<em>error</em>，则<strong>errorRef会用作errorCode</strong>（与错误结束事件类似）。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryErrorEventExample">示例</h5>
<div class="paragraph">
<p>下面的示例流程展示了如何使用错误结束事件。当<em>'Review profitability (审核盈利能力)'</em>用户任务完成，并指出提供的信息不足时，会抛出错误。当这个错误被子流程边界捕获时，<em>'Review sales lead (审核销售线索)'</em>子流程中的所有运行中活动都会被销毁（即使<em>'Review customer rating 审核客户等级'</em>还没有完成），并会创建<em>'Provide additional details (提供更多信息)'</em>用户任务。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.error.example.png" alt="bpmn.boundary.error.example">
</div>
</div>
<div class="paragraph">
<p>这个流程作为演示配置的示例提供。可以在<em>org.flowable.examples.bpmn.event.error</em>包中找到流程XML与单元测试。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnBoundarySignalEvent">8.2.20. 信号边界事件</h4>
<div class="sect4">
<h5 id="bpmnBoundarySignalEventDescription">描述</h5>
<div class="paragraph">
<p>依附在活动边界上的<a href="#bpmnSignalEventDefinition">信号</a>捕获中间（事件），或简称<strong>信号边界事件（signal boundary event）</strong>，捕获与其信号定义具有相同名称的信号。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>与其他事件例如错误边界事件不同的是，信号边界事件不只是捕获其所依附范围抛出的信号。信号边界事件为全局范围（广播）的，意味着信号可以从任何地方抛出，甚至可以是不同的流程实例。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>与其他事件（如错误事件）不同，信号在被捕获后不会被消耗。如果有两个激活的信号边界事件，捕获相同的信号事件，则两个边界事件都会被触发，哪怕它们不在同一个流程实例里。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundarySignalEventGraphicalNotation">图示</h5>
<div class="paragraph">
<p>信号边界事件，用内部有一个信号图标的标准中间事件（两层圆圈）表示。信号图标是白色的，代表<em>捕获</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.signal.event.png" alt="bpmn.boundary.signal.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundarySignalEventXml">XML表示</h5>
<div class="paragraph">
<p>信号边界事件与标准<a href="#bpmnBoundaryEvent">边界事件</a>一样定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;boundaryEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;boundary&quot;</span> <span class="tok-na">attachedToRef=</span><span class="tok-s">&quot;task&quot;</span> <span class="tok-na">cancelActivity=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;signalEventDefinition</span> <span class="tok-na">signalRef=</span><span class="tok-s">&quot;alertSignal&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/boundaryEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundarySignalEventExample">示例</h5>
<div class="paragraph">
<p>参见<a href="#bpmnSignalEventDefinition">信号事件定义</a>章节。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnBoundaryMessageEvent">8.2.21. 消息边界事件</h4>
<div class="sect4">
<h5 id="bpmnBoundaryMessageEventDescription">描述</h5>
<div class="paragraph">
<p>在活动边界上的<a href="#bpmnMessageEventDefinition">消息</a><em>捕获</em>中间（事件），或简称<strong>消息边界事件（message boundary event）</strong>，捕获与其消息定义具有相同消息名的消息。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryMessageEventGraphicalNotation">图示</h5>
<div class="paragraph">
<p>消息边界事件，用内部有一个消息图标的标准中间事件（两层圆圈）表示。信号图标是白色的，代表<em>捕获</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.message.event.png" alt="bpmn.boundary.message.event">
</div>
</div>
<div class="paragraph">
<p>请注意消息边界事件既可以是中断型的（右图），也可以是非中断型的（左图）。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryMessageEventXml">XML表示</h5>
<div class="paragraph">
<p>消息边界事件与标准<a href="#bpmnBoundaryEvent">边界事件</a>一样定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;boundaryEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;boundary&quot;</span> <span class="tok-na">attachedToRef=</span><span class="tok-s">&quot;task&quot;</span> <span class="tok-na">cancelActivity=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;messageEventDefinition</span> <span class="tok-na">messageRef=</span><span class="tok-s">&quot;newCustomerMessage&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/boundaryEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryMessageEventExample">示例</h5>
<div class="paragraph">
<p>参见<a href="#bpmnMessageEventDefinition">消息事件定义</a>章节。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnBoundaryCancelEvent">8.2.22. 取消边界事件</h4>
<div class="sect4">
<h5 id="bpmnBoundaryCancelEventDescription">描述</h5>
<div class="paragraph">
<p>依附在事务子流程边界上的取消<em>捕获</em>中间事件，或简称<strong>取消边界事件（cancel boundary event）</strong>，在事务取消时触发。当取消边界事件触发时，首先会中断当前范围的所有活动执行。接下来，启动事务范围内所有有效的的补偿边界事件（compensation boundary event）。补偿会同步执行，也就是说在离开事务前，边界事件会等待补偿完成。当补偿完成时，沿取消边界事件的任何出口顺序流离开事务子流程。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>一个事务子流程只允许使用一个取消边界事件。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>如果事务子流程中有嵌套的子流程，只会对成功完成的子流程触发补偿。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>如果取消边界事件放置在具有多实例特性的事务子流程上，如果一个实例触发了取消，则边界事件将取消所有实例。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryCancelEventGraphicalNotation">图示</h5>
<div class="paragraph">
<p>取消边界事件，用内部有一个取消图标的标准中间事件（两层圆圈）表示。取消图标是白色的（未填充），代表<em>捕获</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.cancel.event.png" alt="bpmn.boundary.cancel.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryCancelEventXml">XML表示</h5>
<div class="paragraph">
<p>取消边界事件与标准<a href="#bpmnBoundaryEvent">边界事件</a>一样定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;boundaryEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;boundary&quot;</span> <span class="tok-na">attachedToRef=</span><span class="tok-s">&quot;transaction&quot;</span> <span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;cancelEventDefinition</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/boundaryEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>因为取消边界事件总是中断型的，因此没有<code>cancelActivity</code>属性。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnBoundaryCompensationEvent">8.2.23. 补偿边界事件</h4>
<div class="sect4">
<h5 id="bpmnBoundaryCompensationEventDescription">描述</h5>
<div class="paragraph">
<p>依附在活动边界上的补偿<em>捕获</em>中间（事件），或简称<strong>补偿边界事件（compensation boundary event）</strong>，可以为活动附加补偿处理器。</p>
</div>
<div class="paragraph">
<p>补偿边界事件必须使用直接关联的方式引用单个的补偿处理器。</p>
</div>
<div class="paragraph">
<p>补偿边界事件与其它边界事件的活动策略不同。其它边界事件，例如信号边界事件，在其依附的活动启动时激活；当该活动结束时会被解除，并取消相应的事件订阅。而补偿边界事件不是这样。补偿边界事件在其依附的活动<strong>成功完成</strong>时激活，同时创建补偿事件的相应订阅。当补偿事件被触发，或者相应的流程实例结束时，才会移除订阅。请考虑下列因素：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>当补偿被触发时，会调用补偿边界事件关联的补偿处理器。调用次数与其依附的活动成功完成的次数相同。</p>
</li>
<li>
<p>如果补偿边界事件依附在具有多实例特性的活动上，则会为每一个实例创建补偿事件订阅。</p>
</li>
<li>
<p>如果补偿边界事件依附在位于循环内部的活动上，则每次该活动执行时，都会创建一个补偿事件订阅。</p>
</li>
<li>
<p>如果流程实例结束，则取消补偿事件的订阅。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>嵌入式子流程不支持补偿边界事件。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryCompensationEventGraphicalNotation">图示</h5>
<div class="paragraph">
<p>补偿边界事件，用内部有一个补偿图标的标准中间事件（两层圆圈）表示。补偿图标是白色的（未填充），代表<em>捕获</em>的含义。另外，补偿边界事件使用单向连接关联补偿处理器，如下图所示：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.compensation.event.png" alt="bpmn.boundary.compensation.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBoundaryCompensationEventXml">XML表示</h5>
<div class="paragraph">
<p>补偿边界事件与标准<a href="#bpmnBoundaryEvent">边界事件</a>一样定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-nt">&lt;boundaryEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;compensateBookHotelEvt&quot;</span> <span class="tok-na">attachedToRef=</span><span class="tok-s">&quot;bookHotel&quot;</span> <span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;compensateEventDefinition</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/boundaryEvent&gt;</span>

<span class="tok-nt">&lt;association</span> <span class="tok-na">associationDirection=</span><span class="tok-s">&quot;One&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;a1&quot;</span>
    <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;compensateBookHotelEvt&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;undoBookHotel&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;undoBookHotel&quot;</span> <span class="tok-na">isForCompensation=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;...&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>补偿边界事件在活动完成后才激活，因此不支持<code>cancelActivity</code>属性。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnIntermediateCatchingEvent">8.2.24. 捕获中间事件</h4>
<div class="paragraph">
<p>所有的捕获中间事件（intermediate catching events）都使用相同方式定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;intermediateCatchEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myIntermediateCatchEvent&quot;</span> <span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;XXXEventDefinition/&gt;</span>
<span class="tok-nt">&lt;/intermediateCatchEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>捕获中间事件由下列元素定义:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>（流程范围内）唯一的标识符</p>
</li>
<li>
<p>定义了捕获中间事件类型的，形如<em>XXXEventDefinition</em>的XML子元素（例如<em>TimerEventDefinition</em>等）。查阅特定中间捕获事件类型，以了解更多细节。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="bpmnTimerIntermediateEvent">8.2.25. 定时器捕获中间事件</h4>
<div class="sect4">
<h5 id="bpmnTimerIntermediateEventDescription">描述</h5>
<div class="paragraph">
<p>定时器捕获中间事件（timer intermediate catching event）的行为像是跑表。当执行到达捕获事件时，启动定时器；当定时器触发时（例如在一段时间间隔后），沿定时器中间事件的出口顺序流继续执行。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnTimerIntermediateEventGraphicalNotation">图示</h5>
<div class="paragraph">
<p>定时器中间事件用内部有定时器图标的中间捕获事件表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.intermediate.timer.event.png" alt="bpmn.intermediate.timer.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnTimerIntermediateEventXml">XML表示</h5>
<div class="paragraph">
<p>定时器中间事件与<a href="#bpmnIntermediateCatchingEvent">捕获中间事件</a>一样定义。子元素为<strong>timerEventDefinition</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;intermediateCatchEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;timer&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;timerEventDefinition&gt;</span>
    <span class="tok-nt">&lt;timeDuration&gt;</span>PT5M<span class="tok-nt">&lt;/timeDuration&gt;</span>
  <span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
<span class="tok-nt">&lt;/intermediateCatchEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>查看<a href="#timerEventDefinitions">定时器事件定义</a>了解详细配置。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnIntermediateSignalEvent">8.2.26. 信号捕获中间事件</h4>
<div class="sect4">
<h5 id="bpmnIntermediateSignalEventDescription">描述</h5>
<div class="paragraph">
<p><a href="#bpmnSignalEventDefinition">信号</a><em>捕获</em>中间事件（signal intermediate catching event），捕获与其引用的信号定义具有相同信号名称的信号。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>与其他事件如错误事件不同，信号在被捕获后不会被消耗。如果有两个激活的信号中间事件，捕获相同的信号事件，则两个中间事件都会被触发，哪怕它们不在同一个流程实例里。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateSignalEventGraphicalNotation">图示</h5>
<div class="paragraph">
<p>信号捕获中间事件用内部有信号图标的标准中间事件（两层圆圈）表示。信号图标是白色的（未填充），代表<em>捕获</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.intermediate.signal.catch.event.png" alt="bpmn.intermediate.signal.catch.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateSignalEventXml">XML表示</h5>
<div class="paragraph">
<p>信号中间事件与<a href="#bpmnIntermediateCatchingEvent">捕获中间事件</a>一样定义。子元素为<strong>signalEventDefinition</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;intermediateCatchEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;signal&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;signalEventDefinition</span> <span class="tok-na">signalRef=</span><span class="tok-s">&quot;newCustomerSignal&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/intermediateCatchEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateSignalEventExample">示例</h5>
<div class="paragraph">
<p>参阅<a href="#bpmnSignalEventDefinition">信号事件定义</a>章节。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnIntermediateMessageEvent">8.2.27. 消息捕获中间事件</h4>
<div class="sect4">
<h5 id="bpmnIntermediateMessageEventDescription">描述</h5>
<div class="paragraph">
<p><a href="#bpmnMessageEventDefinition">消息</a><em>捕获</em>中间事件（message intermediate catching event），捕获特定名字的消息。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateMessageEventGraphicalNotation">图示</h5>
<div class="paragraph">
<p>消息捕获中间事件用内部有消息图标的标准中间事件（两层圆圈）表示。消息图标是白色的（未填充），代表<em>捕获</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.intermediate.message.catch.event.png" alt="bpmn.intermediate.message.catch.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateMessageEventXml">XML表示</h5>
<div class="paragraph">
<p>消息中间事件与<a href="#bpmnIntermediateCatchingEvent">捕获中间事件</a>一样定义。子元素为<strong>messageEventDefinition</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;intermediateCatchEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;message&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;messageEventDefinition</span> <span class="tok-na">signalRef=</span><span class="tok-s">&quot;newCustomerMessage&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/intermediateCatchEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateMessageEventExample">示例</h5>
<div class="paragraph">
<p>参阅<a href="#bpmnMessageEventDefinition">消息事件定义</a>章节。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnIntermediateThrowEvent">8.2.28. 抛出中间事件</h4>
<div class="paragraph">
<p>所有的抛出中间事件（intermediate throwing evnet）都使用相同方式定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;intermediateThrowEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myIntermediateThrowEvent&quot;</span> <span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;XXXEventDefinition/&gt;</span>
<span class="tok-nt">&lt;/intermediateThrowEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>抛出中间事件由下列元素定义:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>（流程范围内）唯一的标识符</p>
</li>
<li>
<p>定义了抛出中间事件类型的，形如<em>XXXEventDefinition</em>的XML子元素（例如<em>signalEventDefinition</em>等）。查阅特定中间抛出事件类型，以了解更多细节。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="bpmnIntermediateThrowNoneEvent">8.2.29. 空抛出中间事件</h4>
<div class="paragraph">
<p>下面的流程图展示了空抛出中间事件（intermediate throwing none event）的简单例子。其用于指示流程已经到达了某种状态。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.intermediate.none.event.png" alt="bpmn.intermediate.none.event">
</div>
</div>
<div class="paragraph">
<p>添加一个<a href="#executionListeners">执行监听器</a>后，空中间事件就可以成为很好的监视某些KPI（Key Performance Indicators 关键绩效指标）的钩子。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;intermediateThrowEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;noneEvent&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:executionListener</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.test.bpmn.event.IntermediateNoneEventTest$MyExecutionListener&quot;</span> <span class="tok-na">event=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/intermediateThrowEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>你也可以添加一些自己的代码，将部分事件发送给你的BAM（Business Activity Monitoring 业务活动监控）工具，或者DWH（Data Warehouse 数据仓库）。在这种情况下，引擎本身不会做任何事情，只是从中穿过。</p>
</div>
</div>
<div class="sect3">
<h4 id="bpmnIntermediateThrowSignalEvent">8.2.30. 信号抛出中间事件</h4>
<div class="sect4">
<h5 id="bpmnIntermediateThrowSignalEventDescription">描述</h5>
<div class="paragraph">
<p><a href="#bpmnSignalEventDefinition">信号</a><em>抛出</em>中间事件（signal intermediate throwing event），抛出所定义信号的信号事件。</p>
</div>
<div class="paragraph">
<p>在Flowable中，信号会广播至所有的激活的处理器（也就是说，所有的信号捕获事件）。可以同步或异步地发布信号。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在默认配置中，信号<strong>同步</strong>地传递。这意味着抛出信号的流程实例会等待，直到信号传递至所有的捕获信号的流程实例。所有的捕获流程实例也会在与抛出流程实例相同的事务中，也就是说如果收到通知的流程实例中，有一个实例产生了技术错误（抛出异常），则所有相关的实例都会失败。</p>
</li>
<li>
<p>信号也可以<strong>异步</strong>地传递。这是由到达抛出信号事件时的发送处理器来决定的。对于每个激活的处理器，JobExecutor会为其存储并传递一个异步通知消息(asynchronous notification message),即作业（Job）。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateThrowSignalEventGraphicalNotation">图示</h5>
<div class="paragraph">
<p>消息抛出中间事件用内部有信号图标的标准中间事件（两层圆圈）表示。信号图标是黑色的（已填充），代表<em>抛出</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.intermediate.signal.throw.event.png" alt="bpmn.intermediate.signal.throw.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateThrowSignalEventXml">XML表示</h5>
<div class="paragraph">
<p>信号中间事件与<a href="#bpmnIntermediateThrowEvent">抛出中间事件</a>一样定义。子元素为<strong>signalEventDefinition</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;intermediateThrowEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;signal&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;signalEventDefinition</span> <span class="tok-na">signalRef=</span><span class="tok-s">&quot;newCustomerSignal&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/intermediateThrowEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>异步信号事件这样定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;intermediateThrowEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;signal&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;signalEventDefinition</span> <span class="tok-na">signalRef=</span><span class="tok-s">&quot;newCustomerSignal&quot;</span> <span class="tok-na">flowable:async=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/intermediateThrowEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateThrowSignalEventExample">示例</h5>
<div class="paragraph">
<p>参阅<a href="#bpmnSignalEventDefinition">信号事件定义</a>章节。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnIntermediateThrowCompensationEvent">8.2.31. 补偿抛出中间事件</h4>
<div class="sect4">
<h5 id="bpmnIntermediateThrowCompensationEventDescription">描述</h5>
<div class="paragraph">
<p>补偿<em>抛出</em>中间事件（compensation intermediate throwing event）用于触发补偿。</p>
</div>
<div class="paragraph">
<p><strong>触发补偿：</strong>既可以为设计的活动触发补偿，也可以为补偿事件所在的范围触发补偿。补偿由活动所关联的补偿处理器执行。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>活动抛出补偿时，活动关联的补偿处理器将执行的次数，为活动成功完成的次数。</p>
</li>
<li>
<p>抛出补偿时，当前范围中所有的活动，包括并行分支上的活动都会被补偿。</p>
</li>
<li>
<p>补偿分层触发：如果将要被补偿的活动是一个子流程，则该子流程中所有的活动都会触发补偿。如果该子流程有嵌套的活动，则会递归地抛出补偿。然而，补偿不会传播至流程的<strong>上层</strong>：如果子流程中触发了补偿，该补偿不会传播至子流程范围外的活动。BPMN规范指出，对“与子流程在相同级别”的活动触发补偿。</p>
</li>
<li>
<p>在Flowable中，补偿按照执行的相反顺序运行。这意味着最后完成的活动会第一个补偿。</p>
</li>
<li>
<p>可以使用补偿抛出中间事件补偿已经成功完成的事务子流程。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>如果抛出补偿的范围中有一个子流程，而该子流程包含有关联了补偿处理器的活动，则当抛出补偿时，只有该子流程成功完成时，补偿才会传播至该子流程。如果子流程内嵌套的部分活动已经完成，并附加了补偿处理器，但包含这些活动的子流程还没有完成，则这些补偿处理器仍不会执行。参考下面的例子：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.throw.compensation.example1.png" alt="bpmn.throw.compensation.example1">
</div>
</div>
<div class="paragraph">
<p>在这个流程中，有两个并行的执行：一个执行嵌入子流程，另一个执行“charge credit card（信用卡付款）”活动。假定两个执行都已开始，且第一个执行正等待用户完成“review bookings（检查预定）”任务。第二个执行进行了“charge credit card（信用卡付款）”活动的操作，抛出了错误，导致“cancel reservations（取消预订）”事件触发补偿。这时并行子流程还未完成，意味着补偿不会传播至该子流程，因此不会执行“cancel hotel reservation（取消酒店预订）”补偿处理器。而如果“cancel reservations（取消预订）”运行前，这个用户任务（因此该嵌入式子流程也）已经完成，则补偿会传播至该嵌入式子流程。</p>
</div>
<div class="paragraph">
<p><strong>流程变量：</strong>当补偿嵌入式子流程时，用于执行补偿处理器的执行，可以访问子流程的局部流程变量在子流程完成时的值。为此，会对范围执行（为执行子流程所创建的执行）所关联的流程变量进行快照。意味着：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>补偿执行器无法访问子流程范围内并行执行所添加的变量。</p>
</li>
<li>
<p>上层执行所关联的流程变量（例如流程实例关联的流程变量）不在该快照中。因为补偿处理器可以直接访问这些流程变量在抛出补偿时的值。</p>
</li>
<li>
<p>只会为嵌入式子流程进行变量快照。其他活动不会进行变量快照。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>目前的限制：</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>目前不支持<code>waitForCompletion="false"</code>。当补偿抛出中间事件触发补偿时，只有在补偿成功完成时，才会离开该事件。</p>
</li>
<li>
<p>补偿由并行执行运行。并行执行会按照补偿活动完成的逆序启动。</p>
</li>
<li>
<p>补偿不会传播至调用活动（call activity）生成的子流程。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateThrowCompensationEventGraphicalNotation">图示</h5>
<div class="paragraph">
<p>补偿抛出中间事件用内部有补偿图标的标准中间事件（两层圆圈）表示。补偿图标是黑色的（已填充），代表<em>抛出</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.intermediate.compensation.throw.event.png" alt="bpmn.intermediate.compensation.throw.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnIntermediateThrowCompensationEventXml">XML表示</h5>
<div class="paragraph">
<p>补偿中间事件与<a href="#bpmnIntermediateThrowEvent">抛出中间事件</a>一样定义。子元素为<strong>compensateEventDefinition</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;intermediateThrowEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;throwCompensation&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;compensateEventDefinition</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/intermediateThrowEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>另外，<code>activityRef</code>可选项用于为指定的范围或活动触发补偿：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;intermediateThrowEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;throwCompensation&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;compensateEventDefinition</span> <span class="tok-na">activityRef=</span><span class="tok-s">&quot;bookHotel&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/intermediateThrowEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bpmnSequenceFlow">8.3. 顺序流</h3>
<div class="sect3">
<h4 id="sequenceFlowDescription">8.3.1. 描述</h4>
<div class="paragraph">
<p>顺序流（sequence flow）是流程中两个元素间的连接器。在流程执行过程中，一个元素被访问后，会沿着其所有出口顺序流继续执行。这意味着BPMN 2.0的默认是并行执行的：两个出口顺序流就会创建两个独立的、并行的执行路径。</p>
</div>
</div>
<div class="sect3">
<h4 id="sequenceFlowGraphicalNotation">8.3.2. 图示</h4>
<div class="paragraph">
<p>顺序流，用从源元素指向目标元素的箭头表示。箭头总是指向目标元素。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.sequence.flow.png" alt="bpmn.sequence.flow">
</div>
</div>
</div>
<div class="sect3">
<h4 id="sequenceFlowXml">8.3.3. XML表示</h4>
<div class="paragraph">
<p>顺序流需要有流程唯一的<strong>id</strong>，并引用存在的<strong>源</strong>与<strong>目标</strong>元素。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnConditionalSequenceFlow">8.3.4. 条件顺序流</h4>
<div class="sect4">
<h5 id="condSeqFlowDescription">描述</h5>
<div class="paragraph">
<p>在顺序流上可以定义条件（conditional sequence flow）。当离开BPMN 2.0活动时，默认行为是计算其每个出口顺序流上的条件。当条件计算为<em>true</em>时，选择该出口顺序流。如果该方法选择了多条顺序流，则会生成多个<em>执行</em>，流程会以并行方式继续。</p>
</div>
<div class="paragraph">
<p><strong>请注意：</strong>上面的介绍针对BPMN 2.0活动（与事件），但不适用于网关（gateway）。不同类型的网关，会用不同的方式处理带有条件的顺序流。</p>
</div>
</div>
<div class="sect4">
<h5 id="conditionalSequenceFlowGraphicalNotation">图示</h5>
<div class="paragraph">
<p>条件顺序流用起点带有小菱形的顺序流表示。在顺序流旁显示条件表达式。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.conditional.sequence.flow.png" alt="bpmn.conditional.sequence.flow">
</div>
</div>
</div>
<div class="sect4">
<h5 id="conditionalSequenceFlowXml">XML表示</h5>
<div class="paragraph">
<p>条件顺序流的XML表示格式为含有<strong>conditionExpression（条件表达式）</strong>子元素的普通顺序流。请注意目前只支持<em>tFormalExpressions</em>。可以省略<em>xsi:type=""</em>定义，默认为唯一支持的表达式类型。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theTask&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-cp">&lt;![CDATA[${order.price &gt; 100 &amp;&amp; order.price &lt; 250}]]&gt;</span>
  <span class="tok-nt">&lt;/conditionExpression&gt;</span>
<span class="tok-nt">&lt;/sequenceFlow&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>目前conditionalExpressions<strong>只能使用UEL</strong>。详细信息可以在<a href="#apiExpressions">表达式</a>章节找到。使用的表达式需要能解析为boolean值，否则当计算条件时会抛出异常。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>下面的例子，通过典型的JavaBean的方式，使用getter引用流程变量的数据。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-cp">&lt;![CDATA[${order.price &gt; 100 &amp;&amp; order.price &lt; 250}]]&gt;</span>
<span class="tok-nt">&lt;/conditionExpression&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>这个例子调用了一个解析为boolean值的方法。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-cp">&lt;![CDATA[${order.isStandardOrder()}]]&gt;</span>
<span class="tok-nt">&lt;/conditionExpression&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Flowable发行版中包含了下列示例流程，用于展示值表达式与方法表达式的使用（参见<em>org.flowable.examples.bpmn.expression</em>）。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.uel-expression.on.seq.flow.png" alt="bpmn.uel expression.on.seq.flow">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnDefaultSequenceFlow">8.3.5. 默认顺序流</h4>
<div class="sect4">
<h5 id="bpmnDefaultSequenceFlowDescription">描述</h5>
<div class="paragraph">
<p>所有的BPMN 2.0任务与网关都可以使用<strong>默认顺序流（default sequence flow）</strong>。只有当没有其他顺序流可以选择时，才会选择默认顺序流作为活动的出口顺序流。流程会忽略默认顺序流上的条件。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnDefaultSequenceFlowGraphicalNotation">图示</h5>
<div class="paragraph">
<p>默认顺序流用起点带有“斜线”标记的一般顺序流表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.default.sequence.flow.png" alt="bpmn.default.sequence.flow">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnDefaultSequenceFlowXmlRepresentation">XML表示</h5>
<div class="paragraph">
<p>活动的默认顺序流由该活动的<strong>default属性</strong>定义。下面的XML片段展示了一个排他网关（exclusive gateway），带有默认顺序流<em>flow 2</em>。只有当<em>conditionA</em>与<em>conditionB</em>都计算为false时，才会选择默认顺序流作为网关的出口顺序流。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-nt">&lt;exclusiveGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Exclusive Gateway&quot;</span> <span class="tok-na">default=</span><span class="tok-s">&quot;flow2&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;task1&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>${conditionA}<span class="tok-nt">&lt;/conditionExpression&gt;</span>
<span class="tok-nt">&lt;/sequenceFlow&gt;</span>

<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;task2&quot;</span><span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow3&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;task3&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>${conditionB}<span class="tok-nt">&lt;/conditionExpression&gt;</span>
<span class="tok-nt">&lt;/sequenceFlow&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>对应下面的图示：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.default.sequence.flow.example.png" alt="bpmn.default.sequence.flow.example">
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bpmnGateways">8.4. 网关</h3>
<div class="paragraph">
<p>网关（gateway）用于控制执行的流向（或者按BPMN 2.0的用词：执行的<em>“标志（token）”</em>）。网关可以<em>消费（consuming）</em>与<em>生成（generating）</em>标志。</p>
</div>
<div class="paragraph">
<p>网关用其中带有图标的菱形表示。该图标显示了网关的类型。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.gateway.png" alt="bpmn.gateway">
</div>
</div>
<div class="sect3">
<h4 id="bpmnExclusiveGateway">8.4.1. 排他网关</h4>
<div class="sect4">
<h5 id="exclusiveGatewayDescription">描述</h5>
<div class="paragraph">
<p>排他网关（exclusive gateway）（也叫<em>异或网关 XOR gateway</em>，或者更专业的，<em>基于数据的排他网关 exclusive data-based gateway</em>），用于对流程中的<strong>决策</strong>建模。当执行到达这个网关时，会按照所有出口顺序流定义的顺序对它们进行计算。选择第一个条件计算为true的顺序流（当没有设置条件时，认为顺序流为<em>true</em>）继续流程。</p>
</div>
<div class="paragraph">
<p><strong>请注意这里出口顺序流的含义与BPMN 2.0中的一般情况不一样。一般情况下，会选择所有条件计算为true的顺序流，并行执行。而使用排他网关时，只会选择一条顺序流。当多条顺序流的条件都计算为true时，会且仅会选择在XML中最先定义的顺序流继续流程。如果没有可选的顺序流，会抛出异常。</strong></p>
</div>
</div>
<div class="sect4">
<h5 id="exclusiveGatewayGraphNotation">图示</h5>
<div class="paragraph">
<p>排他网关用内部带有&#8217;X&#8217;图标的标准网关（菱形）表示，'X&#8217;图标代表<em>异或</em>的含义。请注意内部没有图标的网关默认为排他网关。BPMN 2.0规范不允许在同一个流程中混合使用有及没有X的菱形标志。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.exclusive.gateway.notation.png" alt="bpmn.exclusive.gateway.notation">
</div>
</div>
</div>
<div class="sect4">
<h5 id="exclusiveGatewayXML">XML表示</h5>
<div class="paragraph">
<p>排他网关的XML表示格式很简洁：一行定义网关的XML。条件表达式定义在其出口顺序流上。查看<a href="#bpmnConditionalSequenceFlow">条件顺序流</a>章节了解这种表达式的可用选项。</p>
</div>
<div class="paragraph">
<p>以下面的模型为例：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.exclusive.gateway.png" alt="bpmn.exclusive.gateway">
</div>
</div>
<div class="paragraph">
<p>其XML表示如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-nt">&lt;exclusiveGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Exclusive Gateway&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theTask1&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>${input == 1}<span class="tok-nt">&lt;/conditionExpression&gt;</span>
<span class="tok-nt">&lt;/sequenceFlow&gt;</span>

<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow3&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theTask2&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>${input == 2}<span class="tok-nt">&lt;/conditionExpression&gt;</span>
<span class="tok-nt">&lt;/sequenceFlow&gt;</span>

<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow4&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theTask3&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>${input == 3}<span class="tok-nt">&lt;/conditionExpression&gt;</span>
<span class="tok-nt">&lt;/sequenceFlow&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnParallelGateway">8.4.2. 并行网关</h4>
<div class="sect4">
<h5 id="bpmnParallelGatewayDescription">描述</h5>
<div class="paragraph">
<p>网关也可以建模流程中的并行执行。在流程模型中引入并行的最简单的网关，就是<strong>并行网关（parallel gateway）</strong>。它可以将执行<em>分支（fork）</em>为多条路径，也可以<em>合并（join）</em>多条入口路径的执行。</p>
</div>
<div class="paragraph">
<p>并行网关的功能取决于其入口与出口顺序流：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>分支：</strong>所有的出口顺序流都并行执行，为每一条顺序流创建一个并行执行。</p>
</li>
<li>
<p><strong>合并：</strong>所有到达并行网关的并行执行都会在网关处等待，直到每一条入口顺序流都到达了有个执行。然后流程经过该合并网关继续。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意，如果并行网关同时具有多条入口与出口顺序流，可以<strong>同时具有分支与合并的行为</strong>。在这种情况下，网关首先合并所有入口顺序流，然后分裂为多条并行执行路径。</p>
</div>
<div class="paragraph">
<p><strong>与其他网关类型有一个重要区别：并行网关不计算条件。如果连接到并行网关的顺序流上定义了条件，会直接忽略该条件。</strong></p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnParallelGatewayGraphicalNotation">图示</h5>
<div class="paragraph">
<p>并行网关，用内部带有&#8217;加号&#8217;图标的网关（菱形）表示，代表<em>与（AND）</em>的含义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.parallel.gateway.png" alt="bpmn.parallel.gateway">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnParallelGatewayXML">XML表示</h5>
<div class="paragraph">
<p>定义并行网关只需要一行XML：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;parallelGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myParallelGateway&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>实际行为（分支，合并或两者皆有），由连接到该并行网关的顺序流定义。</p>
</div>
<div class="paragraph">
<p>例如，上面的模型表示为下面的XML：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;fork&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;parallelGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;fork&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;fork&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;receivePayment&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;fork&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;shipOrder&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;receivePayment&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Receive Payment&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;receivePayment&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;join&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;shipOrder&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Ship Order&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;shipOrder&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;join&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;parallelGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;join&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;join&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;archiveOrder&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;archiveOrder&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Archive Order&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;archiveOrder&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的例子中，当流程启动后会创建两个任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-n">ProcessInstance</span> <span class="tok-n">pi</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;forkJoin&quot;</span><span class="tok-o">);</span>
<span class="tok-n">TaskQuery</span> <span class="tok-n">query</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">processInstanceId</span><span class="tok-o">(</span><span class="tok-n">pi</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
    <span class="tok-o">.</span><span class="tok-na">orderByTaskName</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">asc</span><span class="tok-o">();</span>

<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">query</span><span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
<span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-n">tasks</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">());</span>

<span class="tok-n">Task</span> <span class="tok-n">task1</span> <span class="tok-o">=</span> <span class="tok-n">tasks</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">);</span>
<span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Receive Payment&quot;</span><span class="tok-o">,</span> <span class="tok-n">task1</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
<span class="tok-n">Task</span> <span class="tok-n">task2</span> <span class="tok-o">=</span> <span class="tok-n">tasks</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">);</span>
<span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Ship Order&quot;</span><span class="tok-o">,</span> <span class="tok-n">task2</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当这两个任务完成后，第二个并行网关会合并这两个执行。由于它只有一条出口顺序流，因此就不会再创建并行执行路径，而只是激活<em>Archive Order(存档订单)</em>任务。</p>
</div>
<div class="paragraph">
<p>请注意并行网关不需要“平衡”（也就是说，前后对应的两个并行网关，其入口/出口顺序流的数量不需要一致）。每个并行网关都会简单地等待所有入口顺序流，并为每一条出口顺序流创建并行执行，而不受流程模型中的其他结构影响。因此，下面的流程在BPMN 2.0中是合法的：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.unbalanced.parallel.gateway.png" alt="bpmn.unbalanced.parallel.gateway">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnInclusiveGateway">8.4.3. 包容网关</h4>
<div class="sect4">
<h5 id="bpmnInclusiveGatewayDescription">描述</h5>
<div class="paragraph">
<p>可以把<strong>包容网关（inclusive gateway）</strong>看做排他网关与并行网关的组合。与排他网关一样，可以在包容网关的出口顺序流上定义条件，包容网关会计算条件。然而主要的区别是，包容网关与并行网关一样，可以同时选择多于一条出口顺序流。</p>
</div>
<div class="paragraph">
<p>包容网关的功能取决于其入口与出口顺序流：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>分支：</strong>流程会计算所有出口顺序流的条件。对于每一条计算为true的顺序流，流程都会创建一个并行执行。</p>
</li>
<li>
<p><strong>合并：</strong>所有到达包容网关的并行执行，都会在网关处等待。直到每一条具有流程标志（process token）的入口顺序流，都有一个执行到达。这是与并行网关的重要区别。换句话说，包容网关只会等待可以被执行的入口顺序流。在合并后，流程穿过合并并行网关继续。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意，如果包容网关同时具有多条入口与出口顺序流，可以<strong>同时具有分支与合并的行为</strong>。在这种情况下，网关首先合并所有具有流程标志的入口顺序流，然后为每一个条件计算为true的出口顺序流分裂出并行执行路径。</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>包容网关的汇聚行为比并行网关更复杂。所有到达包容网关的并行执行，都会在网关等待，直到所有“可以到达”包容网关的执行都“到达”包容网关。
判断方法为：计算当前流程实例中的所有执行，检查从其位置是否有一条到达包容网关的路径（忽略顺序流上的任何条件）。如果存在这样的执行（可到达但尚未到达），则不会触发包容网关的汇聚行为。</p>
</div>
</blockquote>
<div class="attribution">
&#8212; 译者附（翻译自alfresco文档 http://docs.alfresco.com/process-services1.6/topics/inclusive_gateway.html）
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnInclusiveGatewayGraphicalNotation">图示</h5>
<div class="paragraph">
<p>包容网关，用内部带有&#8217;圆圈&#8217;图标的网关（菱形）表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.inclusive.gateway.png" alt="bpmn.inclusive.gateway">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnInclusiveGatewayXML">XML表示</h5>
<div class="paragraph">
<p>定义包容网关需要一行XML：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;inclusiveGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myInclusiveGateway&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>实际行为（分支，合并或两者皆有），由连接到该包容网关的顺序流定义。</p>
</div>
<div class="paragraph">
<p>例如，上面的模型表现为下面的XML：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;fork&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;inclusiveGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;fork&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;fork&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;receivePayment&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>${paymentReceived == false}<span class="tok-nt">&lt;/conditionExpression&gt;</span>
<span class="tok-nt">&lt;/sequenceFlow&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;fork&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;shipOrder&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>${shipOrder == true}<span class="tok-nt">&lt;/conditionExpression&gt;</span>
<span class="tok-nt">&lt;/sequenceFlow&gt;</span>

<span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;receivePayment&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Receive Payment&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;receivePayment&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;join&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;shipOrder&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Ship Order&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;shipOrder&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;join&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;inclusiveGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;join&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;join&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;archiveOrder&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;archiveOrder&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Archive Order&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;archiveOrder&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的例子中，当流程启动后，如果流程变量paymentReceived == false且shipOrder == true，会创建两个任务。如果只有一个流程变量等于true，则只会创建一个任务。如果没有条件计算为true，会抛出异常（可通过指定默出口顺序流避免）。在下面的例子中，只会创建ship order（传递订单）一个任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">variableMap</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;();</span>
<span class="tok-n">variableMap</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;receivedPayment&quot;</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="tok-n">variableMap</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;shipOrder&quot;</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">);</span>

<span class="tok-n">ProcessInstance</span> <span class="tok-n">pi</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;forkJoin&quot;</span><span class="tok-o">);</span>

<span class="tok-n">TaskQuery</span> <span class="tok-n">query</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">processInstanceId</span><span class="tok-o">(</span><span class="tok-n">pi</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
    <span class="tok-o">.</span><span class="tok-na">orderByTaskName</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">asc</span><span class="tok-o">();</span>

<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">query</span><span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
<span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-n">tasks</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">());</span>

<span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">=</span> <span class="tok-n">tasks</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">);</span>
<span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Ship Order&quot;</span><span class="tok-o">,</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当这个任务完成后，第二个包容网关会合并这两个执行。并且由于它只有一条出口顺序流，所有不会再创建并行执行路径，而只会激活<em>Archive Order(存档订单)</em>任务。</p>
</div>
<div class="paragraph">
<p>请注意包容网关不需要“平衡”（也就是说，对应的包容网关，其入口/出口顺序流的数量不需要匹配）。包容网关会简单地等待所有入口顺序流，并为每一条出口顺序流创建并行执行，不受流程模型中的其他结构影响。</p>
</div>
<div class="paragraph">
<p>请注意包容网关不需要“平衡”（也就是说，前后对应的两个包容网关，其入口/出口顺序流的数量不需要一致）。每个包容网关都会简单地等待所有入口顺序流，并为每一条出口顺序流创建并行执行，不受流程模型中的其他结构影响。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnEventbasedGateway">8.4.4. 基于事件的网关</h4>
<div class="sect4">
<h5 id="eventBasedGatewayDescription">描述</h5>
<div class="paragraph">
<p>基于事件的网关（event-based gateway）提供了根据事件做选择的方式。网关的每一条出口顺序流都需要连接至一个捕获中间事件。当流程执行到达基于事件的网关时，与等待状态类似，网关会暂停执行，并且为每一条出口顺序流创建一个事件订阅。</p>
</div>
<div class="paragraph">
<p>请注意：基于事件的网关的出口顺序流与一般的顺序流不同。这些顺序流从不实际<strong>执行</strong>。相反，它们用于告知流程引擎：当执行到达一个基于事件的网关时，需要订阅什么事件。有以下限制：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>一个基于事件的网关，必须有两条或更多的出口顺序流。</p>
</li>
<li>
<p>基于事件的网关，只能连接至<code>intermediateCatchEvent（捕获中间事件）</code>类型的元素（Flowable不支持在基于事件的网关之后连接“接收任务 Receive Task”）。</p>
</li>
<li>
<p>连接至基于事件的网关的<code>intermediateCatchEvent</code>，必须只有一个入口顺序流。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="eventBasedGatewayGraphNotation">图示</h5>
<div class="paragraph">
<p>基于事件的网关，用内部带有特殊图标的网关（菱形）表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.event.based.gateway.notation.png" alt="bpmn.event.based.gateway.notation">
</div>
</div>
</div>
<div class="sect4">
<h5 id="eventBasedGatewayXML">XML表示</h5>
<div class="paragraph">
<p>用于定义基于事件的网关的XML元素为<code>eventBasedGateway</code>。</p>
</div>
</div>
<div class="sect4">
<h5 id="eventBasedGatewayExample">示例</h5>
<div class="paragraph">
<p>下面是一个带有基于事件的网关的示例流程。当执行到达基于事件的网关时，流程执行暂停。流程实例订阅alert信号事件，并创建一个10分钟后触发的定时器。流程引擎会等待10分钟，并同时等待信号事件。如果信号在10分钟内触发，则会取消定时器，流程沿着信号继续执行，激活Handle alert用户任务。如果10分钟内没有触发信号，则会继续执行，并取消信号订阅。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.event.based.gateway.example.png" alt="bpmn.event.based.gateway.example">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</div></td><td class="code"><span></span><span class="tok-nt">&lt;definitions</span> <span class="tok-na">id=</span><span class="tok-s">&quot;definitions&quot;</span>
	<span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot;</span>
	<span class="tok-na">xmlns:flowable=</span><span class="tok-s">&quot;http://flowable.org/bpmn&quot;</span>
	<span class="tok-na">targetNamespace=</span><span class="tok-s">&quot;Examples&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;signal</span> <span class="tok-na">id=</span><span class="tok-s">&quot;alertSignal&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;alert&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;catchSignal&quot;</span><span class="tok-nt">&gt;</span>

        <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-nt">/&gt;</span>

        <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;gw1&quot;</span> <span class="tok-nt">/&gt;</span>

        <span class="tok-nt">&lt;eventBasedGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;gw1&quot;</span> <span class="tok-nt">/&gt;</span>

        <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;gw1&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;signalEvent&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;gw1&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;timerEvent&quot;</span> <span class="tok-nt">/&gt;</span>

        <span class="tok-nt">&lt;intermediateCatchEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;signalEvent&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Alert&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;signalEventDefinition</span> <span class="tok-na">signalRef=</span><span class="tok-s">&quot;alertSignal&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;/intermediateCatchEvent&gt;</span>

        <span class="tok-nt">&lt;intermediateCatchEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;timerEvent&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Alert&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;timerEventDefinition&gt;</span>
                <span class="tok-nt">&lt;timeDuration&gt;</span>PT10M<span class="tok-nt">&lt;/timeDuration&gt;</span>
            <span class="tok-nt">&lt;/timerEventDefinition&gt;</span>
        <span class="tok-nt">&lt;/intermediateCatchEvent&gt;</span>

        <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;timerEvent&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;exGw1&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;signalEvent&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;task&quot;</span> <span class="tok-nt">/&gt;</span>

        <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;task&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Handle alert&quot;</span><span class="tok-nt">/&gt;</span>

        <span class="tok-nt">&lt;exclusiveGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;exGw1&quot;</span> <span class="tok-nt">/&gt;</span>

        <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;task&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;exGw1&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;exGw1&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-nt">/&gt;</span>

        <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/process&gt;</span>
<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bpmnTask">8.5. 任务</h3>
<div class="sect3">
<h4 id="bpmnUserTask">8.5.1. 用户任务</h4>
<div class="sect4">
<h5 id="bpmnUserTaskDescription">描述</h5>
<div class="paragraph">
<p>“用户任务（user task）”用于对需要人工执行的任务进行建模。当流程执行到达用户任务时，会为指派至该任务的用户或组的任务列表创建一个新任务。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnUserTaskGraphicalNotation">图示</h5>
<div class="paragraph">
<p>用户任务用左上角有一个小用户图标的标准任务（圆角矩形）表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.user.task.png" alt="bpmn.user.task">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnUserTaskXml">XML表示</h5>
<div class="paragraph">
<p>用户任务在XML中如下定义。其中<em>id</em>是必须属性，<em>name</em>是可选属性。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Important task&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以为用户任务添加描述（description）。事实上任何BPMN 2.0元素都可以有描述。描述由<strong>documentation</strong>元素定义。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span>
<span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Schedule meeting&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;documentation&gt;</span>
      Schedule an engineering meeting for next week with the new hire.
  <span class="tok-nt">&lt;/documentation&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用标准Java方式获取描述文本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getDescription</span><span class="tok-o">()</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnUserTaskDueDate">到期日期</h5>
<div class="paragraph">
<p>每个任务都可以使用一个字段标志该任务的到期日期（due date）。可以使用查询API，查询在给定日期前或后到期的任务。</p>
</div>
<div class="paragraph">
<p>可以在任务定义中使用扩展指定表达式，以在任务创建时设定到期日期。该表达式<strong>必须解析为<code>java.util.Date</code>，<code>java.util.String (ISO8601格式)</code>，ISO8601时间长度（例如PT50M），或者<code>null</code></strong>。例如，可以使用在流程里前一个表单中输入的日期，或者由前一个服务任务计算出的日期。如果使用的是时间长度，则到期日期基于当前时间加上给定长度计算。例如当dueDate使用“PT30M”时，任务在从现在起30分钟后到期。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Important task&quot;</span> <span class="tok-na">flowable:dueDate=</span><span class="tok-s">&quot;${dateVariable}&quot;</span><span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>任务的到期日期也可以使用<code>TaskService</code>，或者在<code>TaskListener</code>中使用传递的<code>DelegateTask</code>修改。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnUserTaskAssignment">用户指派</h5>
<div class="paragraph">
<p>用户任务可以直接指派（assign）给用户。可以定义<strong>humanPerformer</strong>子元素来实现。<em>humanPerformer</em>需要<strong>resourceAssignmentExpression</strong>来实际定义用户。目前，只支持<strong>formalExpressions</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-nt">&gt;</span>

  ...

  <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&#39;theTask&#39;</span> <span class="tok-na">name=</span><span class="tok-s">&#39;important task&#39;</span> <span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;humanPerformer&gt;</span>
      <span class="tok-nt">&lt;resourceAssignmentExpression&gt;</span>
        <span class="tok-nt">&lt;formalExpression&gt;</span>kermit<span class="tok-nt">&lt;/formalExpression&gt;</span>
      <span class="tok-nt">&lt;/resourceAssignmentExpression&gt;</span>
    <span class="tok-nt">&lt;/humanPerformer&gt;</span>
  <span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>只能指定一个</strong>用户作为任务的<em>humanPerformer</em>。在Flowable术语中，这个用户被称作<strong>办理人（assignee）</strong>。拥有办理人的任务，在其他人的任务列表中不可见，而只能在该办理人的<strong>个人任务列表</strong>中看到。</p>
</div>
<div class="paragraph">
<p>可以通过TaskService获取特定用户办理的任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">taskAssignee</span><span class="tok-o">(</span><span class="tok-s">&quot;kermit&quot;</span><span class="tok-o">).</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>任务也可以放在用户的<strong>候选任务列表</strong>中。在这个情况下，需要使用<strong>potentialOwner（潜在用户）</strong>结构。用法与<em>humanPerformer</em>结构类似。请注意需要指定表达式中的每一个元素为用户还是组（引擎无法自行判断）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-nt">&gt;</span>

  ...

  <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&#39;theTask&#39;</span> <span class="tok-na">name=</span><span class="tok-s">&#39;important task&#39;</span> <span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;potentialOwner&gt;</span>
      <span class="tok-nt">&lt;resourceAssignmentExpression&gt;</span>
        <span class="tok-nt">&lt;formalExpression&gt;</span>user(kermit), group(management)<span class="tok-nt">&lt;/formalExpression&gt;</span>
      <span class="tok-nt">&lt;/resourceAssignmentExpression&gt;</span>
    <span class="tok-nt">&lt;/potentialOwner&gt;</span>
  <span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可用如下方法获取定义了<em>potentialOwner</em>结构的任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">taskCandidateUser</span><span class="tok-o">(</span><span class="tok-s">&quot;kermit&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>将获取所有kermit作为<strong>候选用户</strong>的任务，也就是说，表达式含有<em>user(kermit)</em>的任务。同时也将获取所有<strong>指派给kermit为其成员的组</strong>的任务（例如，kermit时<em>management</em>组的成员，且任务指派给<em>management</em>组）。组在运行时解析，并可通过<a href="#apiEngine">身份服务</a>管理。</p>
</div>
<div class="paragraph">
<p>如果并未指定给定字符串是用户还是组，引擎默认其为组。下列代码与<em>声明group(accountancy)</em>效果一样。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;formalExpression&gt;</span>accountancy<span class="tok-nt">&lt;/formalExpression&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnUserTaskUserAssignmentExtension">用于任务指派的Flowable扩展</h5>
<div class="paragraph">
<p>很明显，当指派关系不复杂时，这种用户与组的指派方式十分笨重。为避免这种复杂性，可以在用户任务上使用<a href="#bpmnCustomExtensions">自定义扩展</a>。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>assignee（办理人）属性</strong>：这个自定义扩展用于直接将用户指派至用户任务。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;my task&quot;</span> <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;kermit&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>与<a href="#bpmnUserTaskAssignment">上面</a>定义的<strong>humanPerformer</strong>结构效果完全相同。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>candidateUsers（候选用户）属性</strong>：这个自定义扩展用于为任务指定候选用户。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;my task&quot;</span> <span class="tok-na">flowable:candidateUsers=</span><span class="tok-s">&quot;kermit, gonzo&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>与使用<a href="#bpmnUserTaskAssignment">上面</a>定义的<strong>potentialOwner</strong>结构效果完全相同。请注意不需要像在<em>potentialOwner</em>中一样，使用<em>user(kermit)</em>的声明，因为这个属性只能用于用户。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>candidateGroups（候选组）attribute</strong>：这个自定义扩展用于为任务指定候选组。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;my task&quot;</span> <span class="tok-na">flowable:candidateGroups=</span><span class="tok-s">&quot;management, accountancy&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>与使用<a href="#bpmnUserTaskAssignment">上面</a>定义的<strong>potentialOwner</strong>结构效果完全相同。请注意不需要像在<em>potentialOwner</em>中一样，使用<em>group(management)</em>的声明，因为这个属性只能用于组。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>可以定义在一个用户任务上同时定义<em>candidateUsers</em>与<em>candidateGroups</em>。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意：尽管Flowable提供了<a href="#apiEngine">IdentityService</a>身份管理组件，但并不会检查给定的用户是否实际存在。这是为了便于将Flowable嵌入应用时，与已有的身份管理解决方案进行集成。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnUserTaskUserCustomIdentityLinkAssignmentExtension">自定义身份关联类型</h5>
<div class="paragraph">
<p>在<a href="#bpmnUserTaskAssignment">用户指派</a>中已经介绍过，BPMN标准支持单个指派用户即<strong>hunamPerformer</strong>，或者由一组用户构成<strong>potentialOwners</strong>潜在用户池。另外，Flowable为用户任务定义了<a href="#bpmnUserTaskUserAssignmentExtension">扩展属性元素</a>，用于代表任务的<strong>办理人</strong>或者<strong>候选用户</strong>。</p>
</div>
<div class="paragraph">
<p>Flowable支持的身份关联（identity link）类型有：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">IdentityLinkType</span> <span class="tok-o">{</span>
  <span class="tok-cm">/* Flowable内置角色 */</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">ASSIGNEE</span> <span class="tok-o">=</span> <span class="tok-s">&quot;assignee&quot;</span><span class="tok-o">;</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">CANDIDATE</span> <span class="tok-o">=</span> <span class="tok-s">&quot;candidate&quot;</span><span class="tok-o">;</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">OWNER</span> <span class="tok-o">=</span> <span class="tok-s">&quot;owner&quot;</span><span class="tok-o">;</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">STARTER</span> <span class="tok-o">=</span> <span class="tok-s">&quot;starter&quot;</span><span class="tok-o">;</span>
  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">PARTICIPANT</span> <span class="tok-o">=</span> <span class="tok-s">&quot;participant&quot;</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>BPMN标准及Flowable示例中，身份认证是<strong>用户</strong>与<strong>组</strong>。在前一章节提到过，Flowable的身份管理实现并不适用于生产环境，而需要在支持的认证概要下自行扩展。</p>
</div>
<div class="paragraph">
<p>如果需要添加额外的关联类型，可按照下列语法，使用自定义资源作为扩展元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;make profit&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:customResource</span> <span class="tok-na">flowable:name=</span><span class="tok-s">&quot;businessAdministrator&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;resourceAssignmentExpression&gt;</span>
        <span class="tok-nt">&lt;formalExpression&gt;</span>user(kermit), group(management)<span class="tok-nt">&lt;/formalExpression&gt;</span>
      <span class="tok-nt">&lt;/resourceAssignmentExpression&gt;</span>
    <span class="tok-nt">&lt;/flowable:customResource&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>自定义关联表达式添加至<em>TaskDefinition</em>类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</div></td><td class="code"><span></span>
<span class="tok-kd">protected</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Expression</span><span class="tok-o">&gt;&gt;</span> <span class="tok-n">customUserIdentityLinkExpressions</span> <span class="tok-o">=</span>
    <span class="tok-k">new</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Expression</span><span class="tok-o">&gt;&gt;();</span>
<span class="tok-kd">protected</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Expression</span><span class="tok-o">&gt;&gt;</span> <span class="tok-n">customGroupIdentityLinkExpressions</span> <span class="tok-o">=</span>
    <span class="tok-k">new</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Expression</span><span class="tok-o">&gt;&gt;();</span>

<span class="tok-kd">public</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Expression</span><span class="tok-o">&gt;&gt;</span> <span class="tok-nf">getCustomUserIdentityLinkExpressions</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">customUserIdentityLinkExpressions</span><span class="tok-o">;</span>
<span class="tok-o">}</span>

<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">addCustomUserIdentityLinkExpression</span><span class="tok-o">(</span>
        <span class="tok-n">String</span> <span class="tok-n">identityLinkType</span><span class="tok-o">,</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Expression</span><span class="tok-o">&gt;</span> <span class="tok-n">idList</span><span class="tok-o">)</span> <span class="tok-o">{</span>

    <span class="tok-n">customUserIdentityLinkExpressions</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-n">identityLinkType</span><span class="tok-o">,</span> <span class="tok-n">idList</span><span class="tok-o">);</span>
<span class="tok-o">}</span>

<span class="tok-kd">public</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Expression</span><span class="tok-o">&gt;&gt;</span> <span class="tok-nf">getCustomGroupIdentityLinkExpressions</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">customGroupIdentityLinkExpressions</span><span class="tok-o">;</span>
<span class="tok-o">}</span>

<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">addCustomGroupIdentityLinkExpression</span><span class="tok-o">(</span>
        <span class="tok-n">String</span> <span class="tok-n">identityLinkType</span><span class="tok-o">,</span> <span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">Expression</span><span class="tok-o">&gt;</span> <span class="tok-n">idList</span><span class="tok-o">)</span> <span class="tok-o">{</span>

    <span class="tok-n">customGroupIdentityLinkExpressions</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-n">identityLinkType</span><span class="tok-o">,</span> <span class="tok-n">idList</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这些方法将在运行时，由<em>UserTaskActivityBehavior</em>的<em>handleAssignments</em>方法调用。</p>
</div>
<div class="paragraph">
<p>最后，需要扩展<em>IdentityLinkType</em>类，以支持自定义身份关联类型：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-kn">package</span> <span class="tok-nn">com.yourco.engine.task</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">IdentityLinkType</span> <span class="tok-kd">extends</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">flowable</span><span class="tok-o">.</span><span class="tok-na">engine</span><span class="tok-o">.</span><span class="tok-na">task</span><span class="tok-o">.</span><span class="tok-na">IdentityLinkType</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">ADMINISTRATOR</span> <span class="tok-o">=</span> <span class="tok-s">&quot;administrator&quot;</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">EXCLUDED_OWNER</span> <span class="tok-o">=</span> <span class="tok-s">&quot;excludedOwner&quot;</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnUserTaskUserCustomAssignmentTaskListeners">通过任务监听器自定义指派</h5>
<div class="paragraph">
<p>如果上面的方式仍不能满足要求，可以在创建事件（create event）上使用<a href="#taskListeners">任务监听器</a>，调用自定义指派逻辑：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;task1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My task&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:taskListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;create&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.MyAssignmentHandler&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>传递至<code>TaskListener</code>的<code>DelegateTask</code>，可用于设置办理人与候选用户/组：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyAssignmentHandler</span> <span class="tok-kd">implements</span> <span class="tok-n">TaskListener</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">notify</span><span class="tok-o">(</span><span class="tok-n">DelegateTask</span> <span class="tok-n">delegateTask</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-c1">// 在这里执行自定义身份查询</span>

    <span class="tok-c1">// 然后调用如下命令：</span>
    <span class="tok-n">delegateTask</span><span class="tok-o">.</span><span class="tok-na">setAssignee</span><span class="tok-o">(</span><span class="tok-s">&quot;kermit&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">delegateTask</span><span class="tok-o">.</span><span class="tok-na">addCandidateUser</span><span class="tok-o">(</span><span class="tok-s">&quot;fozzie&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">delegateTask</span><span class="tok-o">.</span><span class="tok-na">addCandidateGroup</span><span class="tok-o">(</span><span class="tok-s">&quot;management&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">...</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当使用Spring时，可以按上面章节的介绍使用自定义指派属性，并交由使用<a href="#taskListeners">任务监听器</a>、带有<a href="#springExpressions">表达式</a>的Spring bean，监听任务<em>创建</em>事件。在下面的例子中，通过调用<code>ldapService</code> Spring bean的<code>findManagerOfEmployee</code>方法设置办理人。传递的<em>emp</em>参数是一个流程变量。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;task&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My Task&quot;</span> <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;${ldapService.findManagerForEmployee(emp)}&quot;</span><span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以用于候选用户与组：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;task&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My Task&quot;</span> <span class="tok-na">flowable:candidateUsers=</span><span class="tok-s">&quot;${ldapService.findAllSales()}&quot;</span><span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意调用方法的返回类型必须是<code>String</code>或<code>Collection&lt;String&gt;</code>（候选用户或组）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">FakeLdapService</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">findManagerForEmployee</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">employee</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-s">&quot;Kermit The Frog&quot;</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-nf">findAllSales</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">asList</span><span class="tok-o">(</span><span class="tok-s">&quot;kermit&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;gonzo&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;fozzie&quot;</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnScriptTask">8.5.2. 脚本任务</h4>
<div class="sect4">
<h5 id="bpmnScriptTaskDescription">描述</h5>
<div class="paragraph">
<p>脚本任务（script task）是自动执行的活动。当流程执行到达脚本任务时，会执行相应的脚本。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnScriptTaskGraphicalNotation">图示</h5>
<div class="paragraph">
<p>脚本任务用左上角有一个小“脚本”图标的标准BPMN 2.0任务（圆角矩形）表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.scripttask.png" alt="bpmn.scripttask">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnScriptTaskXml">XML表示</h5>
<div class="paragraph">
<p>脚本任务使用<strong>script</strong>与<strong>scriptFormat</strong>元素定义。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-nt">&lt;scriptTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theScriptTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Execute script&quot;</span> <span class="tok-na">scriptFormat=</span><span class="tok-s">&quot;groovy&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;script&gt;</span>
    sum = 0
    for ( i in inputArray ) {
      sum += i
    }
  <span class="tok-nt">&lt;/script&gt;</span>
<span class="tok-nt">&lt;/scriptTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>scriptFormat</strong>属性的值，必须是兼容<a href="http://jcp.org/en/jsr/detail?id=223">JSR-223</a>（Java平台脚本）的名字。默认情况下，JavaScript包含在每一个JDK中，因此不需要添加任何JAR文件。如果想使用其它（兼容JSR-223的）脚本引擎，则需要在classpath中添加相应的jar，并使用适当的名字。例如，Flowable单元测试经常使用Groovy，因为其语法与Java十分相似。</p>
</div>
<div class="paragraph">
<p>请注意Groovy脚本引擎与groovy-all JAR捆绑在一起。在Groovy 2.0版本以前，脚本引擎是Groovy JAR的一部分。因此，必须添加如下依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>org.codehaus.groovy<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>groovy-all<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>2.x.x<span class="tok-nt">&lt;version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnScriptTaskVariables">脚本中的变量</h5>
<div class="paragraph">
<p>到达脚本引擎的执行中，所有的流程变量都可以在脚本中使用。在这个例子里，脚本变量<em>'inputArray'</em>实际上就是一个流程变量（一个integer的数组）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;script&gt;</span>
    sum = 0
    for ( i in inputArray ) {
      sum += i
    }
<span class="tok-nt">&lt;/script&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以简单地调用<em>execution.setVariable("variableName", variableValue)</em>，在脚本中设置流程变量。默认情况下，变量不会自动储存（<strong>请注意，在一些早期版本中是会储存的！</strong>）。可以将<code>scriptTask</code>的<code>autoStoreVariables</code>参数设置为<code>true</code>，以自动保存任何在脚本中定义的变量（例如上例中的<em>sum</em>）。然而这并不是最佳实践。<strong>最佳实践是显式调用execution.setVariable()</strong>，因为在JDK近期的一些版本中，某些脚本语言不能自动保存变量。查看<a href="http://www.jorambarrez.be/blog/2013/03/25/bug-on-jdk-1-7-0_17-when-using-scripttask-in-activiti/">这个链接</a>了解更多信息。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;scriptTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;script&quot;</span> <span class="tok-na">scriptFormat=</span><span class="tok-s">&quot;JavaScript&quot;</span> <span class="tok-na">flowable:autoStoreVariables=</span><span class="tok-s">&quot;false&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这个参数的默认值为<code>false</code>。也就是说如果在脚本任务定义中忽略这个参数，则脚本声明的所有变量将只在脚本执行期间有效。</p>
</div>
<div class="paragraph">
<p>在脚本中设置变量的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;script&gt;</span>
    def scriptVar = &quot;test123&quot;
    execution.setVariable(&quot;myVar&quot;, scriptVar)
<span class="tok-nt">&lt;/script&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意：下列名字是保留字，<strong>不能用于</strong>变量名：<strong>out，out:print，lang:import，context，elcontext</strong>。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnScriptTaskResultValue">脚本任务的结果</h5>
<div class="paragraph">
<p>脚本任务的返回值，可以通过为脚本任务定义的<em>'flowable:resultVariable'</em>属性设置为流程变量。可以是已经存在的，或者新的流程变量。如果指定为已存在的流程变量，则流程变量的值会被脚本执行的结果值覆盖。如果不指定结果变量名，则脚本结果值将被忽略。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;scriptTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theScriptTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Execute script&quot;</span> <span class="tok-na">scriptFormat=</span><span class="tok-s">&quot;juel&quot;</span> <span class="tok-na">flowable:resultVariable=</span><span class="tok-s">&quot;myVar&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;script&gt;</span>#{echo}<span class="tok-nt">&lt;/script&gt;</span>
<span class="tok-nt">&lt;/scriptTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的例子中，脚本执行的结果（解析表达式<em>'#{echo}'</em>的值），将在脚本完成后，设置为名为<em>'myVar'</em>的流程变量。</p>
</div>
</div>
<div class="sect4">
<h5 id="_security">安全性</h5>
<div class="paragraph">
<p>当使用<em>javascript</em>作为脚本语言时，可以使用<em>“安全脚本（secure scripting）”</em>。参见<a href="#advancedSecureScripting">安全脚本</a>章节。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnJavaServiceTask">8.5.3. Java服务任务</h4>
<div class="sect4">
<h5 id="bpmnJavaServiceTaskDescription">描述</h5>
<div class="paragraph">
<p>Java服务任务（Java service task）用于调用Java类。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnJavaServiceTaskGraphicalNotation">图示</h5>
<div class="paragraph">
<p>服务任务用左上角有一个小齿轮图标的圆角矩形表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.java.service.task.png" alt="bpmn.java.service.task">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnJavaServiceTaskXML">XML表示</h5>
<div class="paragraph">
<p>有四种方法声明如何调用Java逻辑：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>指定实现了JavaDelegate或ActivityBehavior的类</p>
</li>
<li>
<p>调用解析为委托对象（delegation object）的表达式</p>
</li>
<li>
<p>调用方法表达式（method expression）</p>
</li>
<li>
<p>对值表达式（value expression）求值</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>使用<strong><em>flowable:class</em></strong>属性提供全限定类名（fully qualified classname），指定流程执行时调用的类。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;javaService&quot;</span>
             <span class="tok-na">name=</span><span class="tok-s">&quot;My Java Service Task&quot;</span>
             <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;org.flowable.MyJavaDelegate&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>查看<a href="#bpmnJavaServiceTaskImplementation">实现</a>章节，了解使用这种类的更多信息。</p>
</div>
<div class="paragraph">
<p>也可以使用解析为对象的表达式。该对象必须遵循的规则，与使用<code>flowable:class</code>创建的对象规则相同（查看<a href="#bpmnJavaServiceTaskImplementation">更多</a>）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceTask&quot;</span> <span class="tok-na">flowable:delegateExpression=</span><span class="tok-s">&quot;${delegateExpressionBean}&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>delegateExpressionBean</code>是一个实现了<code>JavaDelegate</code>接口的bean，定义在Spring容器中。</p>
</div>
<div class="paragraph">
<p>使用<strong>flowable:expression</strong>属性指定需要计算的UEL方法表达式。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;javaService&quot;</span>
             <span class="tok-na">name=</span><span class="tok-s">&quot;My Java Service Task&quot;</span>
             <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;#{printer.printMessage()}&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>将在名为<code>printer</code>的对象上调用<code>printMessage</code>方法（不带参数）。</p>
</div>
<div class="paragraph">
<p>也可以为表达式中使用的方法传递变量。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;javaService&quot;</span>
             <span class="tok-na">name=</span><span class="tok-s">&quot;My Java Service Task&quot;</span>
             <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;#{printer.printMessage(execution, myVar)}&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>将在名为<code>printer</code>的对象上调用<code>printMessage</code>方法。传递的第一个参数为<code>DelegateExecution</code>，名为<code>execution</code>，在表达式上下文中默认可用。传递的第二个参数，是当前执行中，名为<code>myVar</code>变量的值。</p>
</div>
<div class="paragraph">
<p>可以使用<strong>flowable:expression</strong>属性指定需要计算的UEL值表达式。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;javaService&quot;</span>
             <span class="tok-na">name=</span><span class="tok-s">&quot;My Java Service Task&quot;</span>
             <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;#{split.ready}&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>会调用名为<code>split</code>的bean的<code>ready</code>参数的getter方法，<code>getReady</code>（不带参数）。该对象会被解析为执行的流程变量或（如果可用的话）Spring上下文中的bean。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnJavaServiceTaskImplementation">实现</h5>
<div class="paragraph">
<p>要实现可以在流程执行中调用的类，需要实现<em>org.flowable.engine.delegate.JavaDelegate</em>接口，并在<em>execute</em>方法中提供所需逻辑。当流程执行到达该活动时，会执行方法中定义的逻辑，并按照BPMN 2.0的默认方法离开活动。</p>
</div>
<div class="paragraph">
<p>下面是一个Java类的示例，用于将流程变量String改为大写。这个类需要实现<em>org.flowable.engine.delegate.JavaDelegate</em>接口，因此需要实现<em>execute(DelegateExecution)</em>方法。这个方法就是引擎将调用的方法，需要实现业务逻辑。可以通过<a href="http://flowable.org/javadocs/org/flowable/engine/delegate/DelegateExecution.html">DelegateExecution</a>接口（点击链接获取该接口操作的详细Javadoc）访问流程实例信息，如流程变量等。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ToUppercase</span> <span class="tok-kd">implements</span> <span class="tok-n">JavaDelegate</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">DelegateExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">var</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">)</span> <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">getVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;input&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">var</span> <span class="tok-o">=</span> <span class="tok-n">var</span><span class="tok-o">.</span><span class="tok-na">toUpperCase</span><span class="tok-o">();</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;input&quot;</span><span class="tok-o">,</span> <span class="tok-n">var</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意：<strong>只会为serviceTask上定义的Java类创建一个实例</strong>。所有流程实例共享同一个类实例，用于调用<em>execute(DelegateExecution)</em>。这意味着该类不能有任何成员变量，并需要是线程安全的，因为它可能会在不同线程中同时执行。这也影响了<a href="#serviceTaskFieldInjection">字段注入</a>的使用方法。（译者注：原文可能较老，不正确。5.21中，flowable:class指定的类，会在流程实例启动时，为每个活动分别进行实例化。不过，当该活动在流程中重复执行，或者为多实例时，使用的都会是同一个类实例。）</p>
</div>
<div class="paragraph">
<p>在流程定义中引用（如<code>flowable:class</code>）的类，<strong>不会在部署时实例化</strong>。只有当流程执行第一次到达该类使用的地方时，才会创建该类的实例。如果找不到这个类，会抛出<code>FlowableException</code>。这是因为部署时的环境（更准确的说<em>classpath</em>），与实际运行的环境经常不一样。例如当使用<em>ant</em>或者Flowable应用中业务存档上传的方式部署的流程，其classpath中不会自动包含流程引用的类。</p>
</div>
<div class="paragraph">
<p><a href="#internal">[内部：非公开实现类]</a>也可以使用实现了<em>org.flowable.engine.impl.delegate.ActivityBehavior</em>接口的类。该实现可以访问更强大的引擎功能，例如，可以影响流程的控制流程。请注意这并不是很好的实践，需要避免这么使用。建议只有在高级使用场景下，并且你确知在做什么的时候，才使用<em>ActivityBehavior</em>接口。</p>
</div>
</div>
<div class="sect4">
<h5 id="serviceTaskFieldInjection">字段注入</h5>
<div class="paragraph">
<p>可以为委托类的字段注入值。支持下列注入方式：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>字符串常量</p>
</li>
<li>
<p>表达式</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>如果可以的话，会按照Java Bean命名约定（例如，<code>firstName</code>成员使用setter <code>setFirstName(&#8230;&#8203;)</code>），通过委托类的公有setter方法，注入变量。如果该字段没有可用的setter，会直接设置该委托类的私有成员的值。有的环境中，SecurityManagers不允许修改私有字段，因此为想要注入的字段暴露一个公有setter方法，是更安全的做法。</p>
</div>
<div class="paragraph">
<p><strong>不论在流程定义中声明的是什么类型的值，注入对象的setter/私有字段的类型，总是<code>org.flowable.engine.delegate.Expression</code>。解析表达式后，可以被转型为合适的类型。</strong></p>
</div>
<div class="paragraph">
<p><em>'flowable:class'</em>属性支持字段注入。也可以在使用<em>flowable:delegateExpression</em>属性时，进行字段注入。然而考虑到线程安全，需要遵循特殊的规则（参见下一章节）。</p>
</div>
<div class="paragraph">
<p>下面的代码片段展示了如何为类中声明的字段注入常量值。请注意按照BPMN 2.0 XML概要的要求，<strong>在实际字段注入声明前，需要先声明&#8217;extensionElements&#8217;XML元素</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;javaService&quot;</span>
    <span class="tok-na">name=</span><span class="tok-s">&quot;Java service invocation&quot;</span>
    <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;org.flowable.examples.bpmn.servicetask.ToUpperCaseFieldInjected&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;extensionElements&gt;</span>
      <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;Hello World&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ToUpperCaseFieldInjected</code>类有一个字段<code>text</code>，为<code>org.flowable.engine.delegate.Expression</code>类型。当调用<code>text.getValue(execution)</code>时，会返回配置的字符串<code>Hello World</code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ToUpperCaseFieldInjected</span> <span class="tok-kd">implements</span> <span class="tok-n">JavaDelegate</span> <span class="tok-o">{</span>

  <span class="tok-kd">private</span> <span class="tok-n">Expression</span> <span class="tok-n">text</span><span class="tok-o">;</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">DelegateExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;var&quot;</span><span class="tok-o">,</span> <span class="tok-o">((</span><span class="tok-n">String</span><span class="tok-o">)</span><span class="tok-n">text</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">)).</span><span class="tok-na">toUpperCase</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>另外，对于较长文本（例如邮件正文），可以使用<em>'flowable:string'</em>子元素：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;javaService&quot;</span>
    <span class="tok-na">name=</span><span class="tok-s">&quot;Java service invocation&quot;</span>
    <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;org.flowable.examples.bpmn.servicetask.ToUpperCaseFieldInjected&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;text&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;flowable:string&gt;</span>
          This is a long string with a lot of words and potentially way longer even!
      <span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用表达式在运行时动态解析注入的值。这种表达式可以使用流程变量，或者（若使用Spring）Spring定义的Bean。在<a href="#bpmnJavaServiceTaskImplementation">服务任务实现</a>中提到过，当服务任务中使用<em>flowable:class</em>属性时，该Java类的实例在所有流程实例中共享。要动态地为字段注入值，可以在<code>org.flowable.engine.delegate.Expression</code>中注入值或方法表达式，它们会通过<code>execute</code>方法传递的<code>DelegateExecution</code>计算/调用。</p>
</div>
<div class="paragraph">
<p>下面的示例类使用了注入的表达式，并使用当前的<code>DelegateExecution</code>解析它们。调用<em>genderBean</em>方法时传递的是<em>gender</em>变量。完整的代码与测试可以在<code>org.flowable.examples.bpmn.servicetask.JavaServiceTaskTest.testExpressionFieldInjection</code>中找到</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;javaService&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Java service invocation&quot;</span>
  <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;org.flowable.examples.bpmn.servicetask.ReverseStringsFieldInjected&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;text1&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:expression&gt;</span>${genderBean.getGenderString(gender)}<span class="tok-nt">&lt;/flowable:expression&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;text2&quot;</span><span class="tok-nt">&gt;</span>
       <span class="tok-nt">&lt;flowable:expression&gt;</span>Hello ${gender == &#39;male&#39; ? &#39;Mr.&#39; : &#39;Mrs.&#39;} ${name}<span class="tok-nt">&lt;/flowable:expression&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;/ extensionElements&gt;</span>
<span class="tok-nt">&lt;/ serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ReverseStringsFieldInjected</span> <span class="tok-kd">implements</span> <span class="tok-n">JavaDelegate</span> <span class="tok-o">{</span>

  <span class="tok-kd">private</span> <span class="tok-n">Expression</span> <span class="tok-n">text1</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-n">Expression</span> <span class="tok-n">text2</span><span class="tok-o">;</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">DelegateExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">value1</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">)</span> <span class="tok-n">text1</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">);</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;var1&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">StringBuffer</span><span class="tok-o">(</span><span class="tok-n">value1</span><span class="tok-o">).</span><span class="tok-na">reverse</span><span class="tok-o">().</span><span class="tok-na">toString</span><span class="tok-o">());</span>

    <span class="tok-n">String</span> <span class="tok-n">value2</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">)</span> <span class="tok-n">text2</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">);</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;var2&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">StringBuffer</span><span class="tok-o">(</span><span class="tok-n">value2</span><span class="tok-o">).</span><span class="tok-na">reverse</span><span class="tok-o">().</span><span class="tok-na">toString</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>另外，为避免XML太过冗长，可以将表达式设置为属性，而不是子元素。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;text1&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${genderBean.getGenderString(gender)}&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;text1&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;Hello ${gender == &#39;male&#39; ? &#39;Mr.&#39; : &#39;Mrs.&#39;} ${name}&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="serviceTaskFieldInjectionThreadSafety">字段注入与线程安全</h5>
<div class="paragraph">
<p>通常情况下，在服务任务中使用Java委托与字段注入是线程安全的。然而，有些情况下不能保证线程安全。这取决于设置，或Flowable运行的环境。</p>
</div>
<div class="paragraph">
<p>当使用<em>flowable:class</em>属性时，使用字段注入总是线程安全的（译者注：仍不完全安全，如对于多实例服务任务，使用的是同一个实例）。对于引用了某个类的每一个服务任务，都会实例化新的实例，并且在创建实例时注入一次字段。在不同的任务或流程定义中多次使用同一个类没有问题。</p>
</div>
<div class="paragraph">
<p>当使用<em>flowable:expression</em>属性时，不能使用字段注入。只能通过方法调用传递变量。总是线程安全的。</p>
</div>
<div class="paragraph">
<p>当使用<em>flowable:delegateExpression</em>属性时，委托实例的线程安全性，取决于表达式解析的方式。如果该委托表达式在多个任务或流程定义中重复使用，并且表达式总是返回相同的示例，则字段注入<strong>不是线程安全的</strong>。让我们看几个例子。</p>
</div>
<div class="paragraph">
<p>假设表达式为<em>${factory.createDelegate(someVariable)}</em>，其中factory为引擎可用的Java bean（例如使用Spring集成时的Spring bean），并在每次表达式解析时创建新的实例。这种情况下，使用字段注入时，没有线程安全性问题：每次表达式解析时，都会注入新实例的字段。</p>
</div>
<div class="paragraph">
<p>然而，如果表达式为<em>${someJavaDelegateBean}</em>，解析为JavaDelegate的实现，并且在创建单例的环境（如Spring）中运行。当在不同的任务或流程定义中使用这个表达式时，表达式总会解析为相同的实例。这种情况下，使用字段注入不是线程安全的。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceTask1&quot;</span> <span class="tok-na">flowable:delegateExpression=</span><span class="tok-s">&quot;${someJavaDelegateBean}&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;extensionElements&gt;</span>
        <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;someField&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${input * 2}&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>

<span class="tok-c">&lt;!-- 其它流程定义元素 --&gt;</span>

<span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceTask2&quot;</span> <span class="tok-na">flowable:delegateExpression=</span><span class="tok-s">&quot;${someJavaDelegateBean}&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;extensionElements&gt;</span>
        <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;someField&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${input * 2000}&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这段示例代码有两个服务任务，使用同一个委托表达式，但是<em>expression</em>字段填写不同的值。<strong>如果该表达式解析为相同的实例，就会在并发场景下，注入<em>someField</em>字段时出现竞争条件</strong>。</p>
</div>
<div class="paragraph">
<p>最简单的解决方法是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用表达式代替直接使用Java委托，并将所需数据通过方法参数传递给委托。</p>
</li>
<li>
<p>或者，在每次委托表达式解析时，返回委托类的新实例。这意味着这个bean的scope必须是<strong>prototype（原型）</strong>（例如在委托类上加上@Scope(SCOPE_PROTOTYPE)注解）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在Flowable 5.22版本中，可以通过配置流程引擎配置，禁用在委托表达式上使用字段注入。需要设置<em>delegateExpressionFieldInjectionMode</em>参数（取<em>org.flowable.engine.imp.cfg.DelegateExpressionFieldInjectionMode</em>枚举中的值）。</p>
</div>
<div class="paragraph">
<p>可使用下列选项：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>DISABLED（禁用）</strong>：当使用委托表达式时，完全禁用字段注入。不会再尝试进行字段注入。这是最安全的方式，保证线程安全。</p>
</li>
<li>
<p><strong>COMPATIBILITY（兼容）</strong>：在这个模式下，行为与V5.21之前完全一样：可以在委托表达式中使用字段注入，如果委托类中没有定义该字段，会抛出异常。这是最不线程安全的模式，但可以保证历史版本兼容性，也可以在委托表达式只在一个任务中使用的时候（因此不会产生并发竞争条件），安全使用。</p>
</li>
<li>
<p><strong>MIXED（混合）</strong>：可以在使用委托表达式时注入，但当委托中没有定义字段时，不会抛出异常。这样可以在部分委托（比如不是单例的实例）中使用注入，而在部分委托中不使用注入。</p>
</li>
<li>
<p><strong>Flowable 5.x版本的默认模式为COMPATIBILITY</strong>。</p>
</li>
<li>
<p><strong>Flowable 6.x版本的默认模式为MIXED</strong>。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例如，假设使用<em>MIXED</em>模式，并使用Spring集成，在Spring配置中定义了如下bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;singletonDelegateExpressionBean&quot;</span>
  <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.test.fieldinjection.SingletonDelegateExpressionBean&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;prototypeDelegateExpressionBean&quot;</span>
  <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.test.fieldinjection.PrototypeDelegateExpressionBean&quot;</span>
  <span class="tok-na">scope=</span><span class="tok-s">&quot;prototype&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>第一个bean是一般的Spring bean，因此是单例的。第二个bean的scope为<em>prototype</em>，因此每次请求这个bean时，Spring容器都会返回一个新实例。</p>
</div>
<div class="paragraph">
<p>在以下流程定义中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceTask1&quot;</span> <span class="tok-na">flowable:delegateExpression=</span><span class="tok-s">&quot;${prototypeDelegateExpressionBean}&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;fieldA&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${input * 2}&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;fieldB&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${1 + 1}&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resultVariableName&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;resultServiceTask1&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>

<span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceTask2&quot;</span> <span class="tok-na">flowable:delegateExpression=</span><span class="tok-s">&quot;${prototypeDelegateExpressionBean}&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;fieldA&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${123}&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;fieldB&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${456}&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resultVariableName&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;resultServiceTask2&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>

<span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceTask3&quot;</span> <span class="tok-na">flowable:delegateExpression=</span><span class="tok-s">&quot;${singletonDelegateExpressionBean}&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;fieldA&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${input * 2}&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;fieldB&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${1 + 1}&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resultVariableName&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;resultServiceTask1&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>

<span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceTask4&quot;</span> <span class="tok-na">flowable:delegateExpression=</span><span class="tok-s">&quot;${singletonDelegateExpressionBean}&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;fieldA&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${123}&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;fieldB&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${456}&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resultVariableName&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;resultServiceTask2&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>有四个服务任务，第一、二个使用<em>${prototypeDelegateExpressionBean}</em>委托表达式，第三、四个使用<em>${singletonDelegateExpressionBean}</em>委托表达式。</p>
</div>
<div class="paragraph">
<p>先看原型bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">PrototypeDelegateExpressionBean</span> <span class="tok-kd">implements</span> <span class="tok-n">JavaDelegate</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">AtomicInteger</span> <span class="tok-n">INSTANCE_COUNT</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AtomicInteger</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">);</span>

  <span class="tok-kd">private</span> <span class="tok-n">Expression</span> <span class="tok-n">fieldA</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-n">Expression</span> <span class="tok-n">fieldB</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-n">Expression</span> <span class="tok-n">resultVariableName</span><span class="tok-o">;</span>

  <span class="tok-kd">public</span> <span class="tok-nf">PrototypeDelegateExpressionBean</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">INSTANCE_COUNT</span><span class="tok-o">.</span><span class="tok-na">incrementAndGet</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">DelegateExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-o">{</span>

    <span class="tok-n">Number</span> <span class="tok-n">fieldAValue</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Number</span><span class="tok-o">)</span> <span class="tok-n">fieldA</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">);</span>
    <span class="tok-n">Number</span> <span class="tok-n">fieldValueB</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Number</span><span class="tok-o">)</span> <span class="tok-n">fieldB</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">);</span>

    <span class="tok-kt">int</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">fieldAValue</span><span class="tok-o">.</span><span class="tok-na">intValue</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-n">fieldValueB</span><span class="tok-o">.</span><span class="tok-na">intValue</span><span class="tok-o">();</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-n">resultVariableName</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">).</span><span class="tok-na">toString</span><span class="tok-o">(),</span> <span class="tok-n">result</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在运行上面流程定义的流程实例后，<em>INSTANCE_COUNT</em>的值为<em>2</em>。这是因为每次解析<em>${prototypeDelegateExpressionBean}</em>时，都会创建新实例。可以看到三个<em>Expression</em>成员字段的注入没有任何问题。</p>
</div>
<div class="paragraph">
<p>单例bean则有一点区别：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SingletonDelegateExpressionBean</span> <span class="tok-kd">implements</span> <span class="tok-n">JavaDelegate</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">AtomicInteger</span> <span class="tok-n">INSTANCE_COUNT</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AtomicInteger</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">);</span>

  <span class="tok-kd">public</span> <span class="tok-nf">SingletonDelegateExpressionBean</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">INSTANCE_COUNT</span><span class="tok-o">.</span><span class="tok-na">incrementAndGet</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">DelegateExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-o">{</span>

    <span class="tok-n">Expression</span> <span class="tok-n">fieldAExpression</span> <span class="tok-o">=</span> <span class="tok-n">DelegateHelper</span><span class="tok-o">.</span><span class="tok-na">getFieldExpression</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">,</span> <span class="tok-s">&quot;fieldA&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">Number</span> <span class="tok-n">fieldA</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Number</span><span class="tok-o">)</span> <span class="tok-n">fieldAExpression</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">);</span>

    <span class="tok-n">Expression</span> <span class="tok-n">fieldBExpression</span> <span class="tok-o">=</span> <span class="tok-n">DelegateHelper</span><span class="tok-o">.</span><span class="tok-na">getFieldExpression</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">,</span> <span class="tok-s">&quot;fieldB&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">Number</span> <span class="tok-n">fieldB</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Number</span><span class="tok-o">)</span> <span class="tok-n">fieldBExpression</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">);</span>

    <span class="tok-kt">int</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">fieldA</span><span class="tok-o">.</span><span class="tok-na">intValue</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-n">fieldB</span><span class="tok-o">.</span><span class="tok-na">intValue</span><span class="tok-o">();</span>

    <span class="tok-n">String</span> <span class="tok-n">resultVariableName</span> <span class="tok-o">=</span> <span class="tok-n">DelegateHelper</span><span class="tok-o">.</span><span class="tok-na">getFieldExpression</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">,</span>
        <span class="tok-s">&quot;resultVariableName&quot;</span><span class="tok-o">).</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">).</span><span class="tok-na">toString</span><span class="tok-o">();</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-n">resultVariableName</span><span class="tok-o">,</span> <span class="tok-n">result</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在对于单例bean，<em>INSTANCE_COUNT</em>总是<em>1</em>。在这个委托中，没有<em>Expression</em>成员字段（使用<em>MIXED</em>模式）。而在<em>COMPATIBILITY</em>模式下，就会抛出异常，因为需要有成员字段。这个bean也可以使用<em>DISABLED</em>模式，但会禁用上面进行了字段注入的原型bean。</p>
</div>
<div class="paragraph">
<p>在委托的代码里，使用了<strong>org.flowable.engine.delegate.DelegateHelper</strong>。它提供了一些有用的工具方法，用于执行相同的逻辑，并且在单例中是线程安全的。与注入<em>Expression</em>不同，它通过<em>getFieldExpression</em>读取。这意味着在服务任务的XML里，字段定义与单例bean完全相同。查看上面的XML代码，可以看到定义是相同的，只是实现逻辑不同。</p>
</div>
<div class="paragraph">
<p>技术提示：<em>getFieldExpression</em>直接读取BpmnModel，并在方法执行时创建表达式，因此是线程安全的。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在Flowable V5.x版本中，（由于架构缺陷）不能在<em>ExecutionListener</em>或<em>TaskListener</em>中使用DelegateHelper。要保证监听器的线程安全，仍需使用表达式，或确保每次解析委托表达式时，都创建新实例。</p>
</li>
<li>
<p>在Flowable V6.x版本中，在<em>ExecutionListener</em>或<em>TaskListener</em>中可以使用DelegateHelper。例如在V6.x版本中，下列代码可以使用<strong>DelegateHelper</strong>：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;extensionElements&gt;</span>
  <span class="tok-nt">&lt;flowable:executionListener</span>
      <span class="tok-na">delegateExpression=</span><span class="tok-s">&quot;${testExecutionListener}&quot;</span> <span class="tok-na">event=</span><span class="tok-s">&quot;start&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;input&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${startValue}&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resultVar&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;processStartValue&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/flowable:executionListener&gt;</span>
<span class="tok-nt">&lt;/extensionElements&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>其中<em>testExecutionListener</em>解析为ExecutionListener接口的一个实现的实例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span></span><span class="tok-nd">@Component</span><span class="tok-o">(</span><span class="tok-s">&quot;testExecutionListener&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TestExecutionListener</span> <span class="tok-kd">implements</span> <span class="tok-n">ExecutionListener</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">notify</span><span class="tok-o">(</span><span class="tok-n">DelegateExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">Expression</span> <span class="tok-n">inputExpression</span> <span class="tok-o">=</span> <span class="tok-n">DelegateHelper</span><span class="tok-o">.</span><span class="tok-na">getFieldExpression</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">,</span> <span class="tok-s">&quot;input&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">Number</span> <span class="tok-n">input</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Number</span><span class="tok-o">)</span> <span class="tok-n">inputExpression</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">);</span>

    <span class="tok-kt">int</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">input</span><span class="tok-o">.</span><span class="tok-na">intValue</span><span class="tok-o">()</span> <span class="tok-o">*</span> <span class="tok-mi">100</span><span class="tok-o">;</span>

    <span class="tok-n">Expression</span> <span class="tok-n">resultVarExpression</span> <span class="tok-o">=</span> <span class="tok-n">DelegateHelper</span><span class="tok-o">.</span><span class="tok-na">getFieldExpression</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">,</span> <span class="tok-s">&quot;resultVar&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-n">resultVarExpression</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">).</span><span class="tok-na">toString</span><span class="tok-o">(),</span> <span class="tok-n">result</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="serviceTaskResultValue">服务任务的结果</h5>
<div class="paragraph">
<p>服务执行的返回值（仅对使用表达式的服务任务），可以通过为服务任务定义的<em>'flowable:resultVariable'</em>属性设置为流程变量。可以是已经存在的，或者新的流程变量。
如果指定为已存在的流程变量，则流程变量的值会被服务执行的结果值覆盖。
如果使用<em>'flowable:useLocalScopeForResultVariable'</em>，则会将结果值设置为局部变量。
如果不指定结果变量名，则服务任务的结果值将被忽略。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;aMethodExpressionServiceTask&quot;</span>
    <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;#{myService.doSomething()}&quot;</span>
    <span class="tok-na">flowable:resultVariable=</span><span class="tok-s">&quot;myVar&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在上例中，服务执行的结果（流程变量或Spring bean中，使用<em>'myService'</em>名字所获取的对象，调用<em>'doSomething()'</em>方法的返回值），在服务执行完成后，会设置为名为<em>'myVar'</em>的流程变量。</p>
</div>
</div>
<div class="sect4">
<h5 id="serviceTaskTriggerable">可触发</h5>
<div class="paragraph">
<p>一种常见的模式是发送JMS消息或HTTP调用触发外部服务，然后流程实例进入等待状态。之后外部系统会回复响应，流程实例继续执行下一个活动。在默认的BPMN中，需要使用服务任务和接收任务（receive task）。但是这样会引入竞争条件：外部服务的响应可能会早于流程实例持久化及接收任务激活。为了解决这个问题，Flowable为服务任务增加了triggerable（可触发）属性，可以将服务任务转变为执行服务逻辑，并在继续执行之前等待外部触发的任务。如果在可触发服务任务上同时设置异步（async 为 true），则流程实例会先持久化，然后在异步作业中执行服务任务逻辑。在BPMN XML中，可以这样实现可触发服务任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;aTriggerableServiceTask&quot;</span>
    <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;#{myService.doSomething()}&quot;</span>
    <span class="tok-na">flowable:triggerable=</span><span class="tok-s">&quot;true&quot;</span>
    <span class="tok-na">flowable:async=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>外部服务可以同步或异步地触发等待中的流程实例。为了避免乐观锁异常，最好使用异步触发。默认情况下，异步作业是排他的，也就是说流程实例会被锁定，以保证流程实例中的其他活动不会影响到触发器的逻辑。可以使用RuntimeService的triggerAsync方法，异步触发等待中的流程实例。当然还是可以使用RuntimeService的trigger方法，同步触发。</p>
</div>
</div>
<div class="sect4">
<h5 id="serviceTaskExceptionHandling">处理异常</h5>
<div class="paragraph">
<p>当执行自定义逻辑时，通常需要捕获并在流程中处理特定的业务异常。Flowable提供了多种选择。</p>
</div>
<div class="sect5">
<h6 id="serviceTaskBpmnErrors">抛出BPMN错误</h6>
<div class="paragraph">
<p>可以在服务任务或脚本任务的用户代码中抛出BPMN错误。可以在Java委托、脚本、表达式与委托表达式中，抛出特殊的FlowableException：<em>BpmnError</em>。引擎会捕获这个异常，并将其转发至合适的错误处理器，如错误边界事件或错误事件子流程。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ThrowBpmnErrorDelegate</span> <span class="tok-kd">implements</span> <span class="tok-n">JavaDelegate</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">DelegateExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
    <span class="tok-k">try</span> <span class="tok-o">{</span>
      <span class="tok-n">executeBusinessLogic</span><span class="tok-o">();</span>
    <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">BusinessException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">BpmnError</span><span class="tok-o">(</span><span class="tok-s">&quot;BusinessExceptionOccurred&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>构造函数的参数是错误代码。错误代码决定了处理这个错误的错误处理器。参见<a href="#bpmnBoundaryErrorEvent">错误边界事件</a>了解如何捕获BPMN错误。</p>
</div>
<div class="paragraph">
<p>这个机制<strong>只应该用于业务错误</strong>，需要通过流程中定义的错误边界事件或错误事件子流程处理。技术错误应该通过其他异常类型表现，并且通常不在流程内部处理。</p>
</div>
</div>
<div class="sect5">
<h6 id="exceptionMapping">异常映射</h6>
<div class="paragraph">
<p>也可以使用<code>mapException</code>扩展，直接将Java异常映射至业务异常（错误）。单映射是最简单的形式：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;servicetask1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Service Task&quot;</span> <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;...&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:mapException</span>
          <span class="tok-na">errorCode=</span><span class="tok-s">&quot;myErrorCode1&quot;</span><span class="tok-nt">&gt;</span>org.flowable.SomeException<span class="tok-nt">&lt;/flowable:mapException&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的代码中，如果服务任务抛出<code>org.flowable.SomeException</code>的实例，引擎会捕获该异常，并将其转换为带有给定errorCode的BPMN错误。然后就可以像普通BPMN错误完全一样地处理。其他的异常没有映射，仍将抛出至API调用处。</p>
</div>
<div class="paragraph">
<p>也可以在单行中使用<code>includeChildExceptions</code>属性，映射特定异常的所有子异常。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;servicetask1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Service Task&quot;</span> <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;...&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:mapException</span> <span class="tok-na">errorCode=</span><span class="tok-s">&quot;myErrorCode1&quot;</span>
           <span class="tok-na">includeChildExceptions=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">&gt;</span>org.flowable.SomeException<span class="tok-nt">&lt;/flowable:mapException&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的代码中，Flowable会将<code>SomeException</code>的任何直接或间接的子类，转换为带有指定错误代码的BPMN错误。
当未指定<code>includeChildExceptions</code>时，视为“false”。</p>
</div>
<div class="paragraph">
<p>默认映射最泛用。默认映射是一个不指定类的映射，可以匹配任何Java异常：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;servicetask1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Service Task&quot;</span> <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;...&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:mapException</span> <span class="tok-na">errorCode=</span><span class="tok-s">&quot;myErrorCode1&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>除了默认映射，会按照从上至下的顺序检查映射，使用第一个匹配的映射。只在所有映射都不能成功匹配时使用默认映射。
只有第一个不指定类的映射会作为默认映射。默认映射忽略<code>includeChildExceptions</code>。</p>
</div>
</div>
<div class="sect5">
<h6 id="serviceTaskExceptionSequenceFlow">异常顺序流</h6>
<div class="paragraph">
<p><a href="#internal">[内部：非公开实现类]</a></p>
</div>
<div class="paragraph">
<p>也可以选择在发生异常时，将流程执行路由至另一条路径。下面是一个例子。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;javaService&quot;</span>
  <span class="tok-na">name=</span><span class="tok-s">&quot;Java service invocation&quot;</span>
  <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;org.flowable.ThrowsExceptionBehavior&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>

<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;no-exception&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;javaService&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;exception&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;javaService&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;fixException&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>服务任务有两条出口顺序流，命名为<code>exception</code>与<code>no-exception</code>。在发生异常时，使用顺序流ID控制流程流向：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ThrowsExceptionBehavior</span> <span class="tok-kd">implements</span> <span class="tok-n">ActivityBehavior</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">DelegateExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">String</span> <span class="tok-n">var</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">)</span> <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">getVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;var&quot;</span><span class="tok-o">);</span>

    <span class="tok-n">String</span> <span class="tok-n">sequenceFlowToTake</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
    <span class="tok-k">try</span> <span class="tok-o">{</span>
      <span class="tok-n">executeLogic</span><span class="tok-o">(</span><span class="tok-n">var</span><span class="tok-o">);</span>
      <span class="tok-n">sequenceFlowToTake</span> <span class="tok-o">=</span> <span class="tok-s">&quot;no-exception&quot;</span><span class="tok-o">;</span>
    <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">Exception</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-n">sequenceFlowToTake</span> <span class="tok-o">=</span> <span class="tok-s">&quot;exception&quot;</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
    <span class="tok-n">DelegateHelper</span><span class="tok-o">.</span><span class="tok-na">leaveDelegate</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">,</span> <span class="tok-n">sequenceFlowToTake</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="serviceTaskCallActivitiService">在JavaDelegate中使用Flowable服务</h5>
<div class="paragraph">
<p>有的时候，需要在Java服务任务中使用Flowable服务（例如调用活动（call activity）不满足需要的场景下，使用RuntimeService启动流程实例）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">StartProcessInstanceTestDelegate</span> <span class="tok-kd">implements</span> <span class="tok-n">JavaDelegate</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">DelegateExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
    <span class="tok-n">RuntimeService</span> <span class="tok-n">runtimeService</span> <span class="tok-o">=</span> <span class="tok-n">Context</span><span class="tok-o">.</span><span class="tok-na">getProcessEngineConfiguration</span><span class="tok-o">().</span><span class="tok-na">getRuntimeService</span><span class="tok-o">();</span>
    <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;myProcess&quot;</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用这个接口访问所有Flowable服务API。</p>
</div>
<div class="paragraph">
<p>使用这些API调用造成的所有数据变更都在当前事务中。在依赖注入的环境（如Spring或CDI，无论是否使用启用JTA的数据源）下也可以使用这个接口。例如，下面的代码片段与上面的代码具有相同功能，但通过注入而不是<em>org.flowable.engine.EngineServices</em>接口获得RuntimeService。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-nd">@Component</span><span class="tok-o">(</span><span class="tok-s">&quot;startProcessInstanceDelegate&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">StartProcessInstanceTestDelegateWithInjection</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Autowired</span>
    <span class="tok-kd">private</span> <span class="tok-n">RuntimeService</span> <span class="tok-n">runtimeService</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">startProcess</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;oneTaskProcess&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>重要技术提示：</strong>由于服务调用是在当前事务中完成的，因此在服务任务执行前产生或修改的数据尚未存入数据库。所有API调用都基于数据库数据处理，这意味着这些未提交的修改在服务任务的API调用中“不可见”。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnWebserviceTask">8.5.4. Web服务任务</h4>
<div class="sect4">
<h5 id="bpmnWebserviceTaskDescription">描述</h5>
<div class="paragraph">
<p>Web服务任务（Web service task）用于同步地调用外部的Web服务。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnWebserviceTaskGraphicalNotation">图示</h5>
<div class="paragraph">
<p>Web服务任务与Java服务任务图标一样。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.web.service.task.png" alt="bpmn.web.service.task">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnWebserviceTaskXML">XML表示</h5>
<div class="paragraph">
<p>使用Web服务之前，需要导入其操作及复杂的类型。可以使用导入标签（import tag）指向Web服务的WSDL，自动处理：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;import</span> <span class="tok-na">importType=</span><span class="tok-s">&quot;http://schemas.xmlsoap.org/wsdl/&quot;</span>
	<span class="tok-na">location=</span><span class="tok-s">&quot;http://localhost:63081/counter?wsdl&quot;</span>
	<span class="tok-na">namespace=</span><span class="tok-s">&quot;http://webservice.flowable.org/&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>按照上面的声明，Flowable会导入定义，但不会创建条目定义（item definition）与消息。如果需要调用一个名为&#8217;prettyPrint&#8217;的方法，则需要先为请求及回复消息创建对应的消息与条目定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;message</span> <span class="tok-na">id=</span><span class="tok-s">&quot;prettyPrintCountRequestMessage&quot;</span> <span class="tok-na">itemRef=</span><span class="tok-s">&quot;tns:prettyPrintCountRequestItem&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;message</span> <span class="tok-na">id=</span><span class="tok-s">&quot;prettyPrintCountResponseMessage&quot;</span> <span class="tok-na">itemRef=</span><span class="tok-s">&quot;tns:prettyPrintCountResponseItem&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;itemDefinition</span> <span class="tok-na">id=</span><span class="tok-s">&quot;prettyPrintCountRequestItem&quot;</span> <span class="tok-na">structureRef=</span><span class="tok-s">&quot;counter:prettyPrintCount&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;itemDefinition</span> <span class="tok-na">id=</span><span class="tok-s">&quot;prettyPrintCountResponseItem&quot;</span> <span class="tok-na">structureRef=</span><span class="tok-s">&quot;counter:prettyPrintCountResponse&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在声明服务任务前，需要定义实际引用Web服务的BPMN接口与操作。基本上，是定义“接口”与所需的“操作”。对每一个操作都可以重复使用之前定义的“传入”与“传出”消息。例如，下面的声明定义了“counter”接口及“prettyPrintCountOperation”操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;interface</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Counter Interface&quot;</span> <span class="tok-na">implementationRef=</span><span class="tok-s">&quot;counter:Counter&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;operation</span> <span class="tok-na">id=</span><span class="tok-s">&quot;prettyPrintCountOperation&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;prettyPrintCount Operation&quot;</span>
			<span class="tok-na">implementationRef=</span><span class="tok-s">&quot;counter:prettyPrintCount&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">&lt;inMessageRef&gt;</span>tns:prettyPrintCountRequestMessage<span class="tok-nt">&lt;/inMessageRef&gt;</span>
		<span class="tok-nt">&lt;outMessageRef&gt;</span>tns:prettyPrintCountResponseMessage<span class="tok-nt">&lt;/outMessageRef&gt;</span>
	<span class="tok-nt">&lt;/operation&gt;</span>
<span class="tok-nt">&lt;/interface&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样就可以使用##WebService实现，声明Web服务任务，并引用Web服务操作。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;webService&quot;</span>
	<span class="tok-na">name=</span><span class="tok-s">&quot;Web service invocation&quot;</span>
	<span class="tok-na">implementation=</span><span class="tok-s">&quot;##WebService&quot;</span>
	<span class="tok-na">operationRef=</span><span class="tok-s">&quot;tns:prettyPrintCountOperation&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnWebserviceTaskIOSpecification">Web服务任务IO规范</h5>
<div class="paragraph">
<p>除非使用简化方法处理输入与输出数据关联（见下），否则需要为每个Web服务任务声明IO规范，指出任务的输入与输出是什么。这个方法很简单，也兼容BPMN 2.0。在prettyPrint例子中，根据之前声明的条目定义，定义输入与输出：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nt">&lt;ioSpecification&gt;</span>
    <span class="tok-nt">&lt;dataInput</span> <span class="tok-na">itemSubjectRef=</span><span class="tok-s">&quot;tns:prettyPrintCountRequestItem&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dataInputOfServiceTask&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;dataOutput</span> <span class="tok-na">itemSubjectRef=</span><span class="tok-s">&quot;tns:prettyPrintCountResponseItem&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dataOutputOfServiceTask&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;inputSet&gt;</span>
        <span class="tok-nt">&lt;dataInputRefs&gt;</span>dataInputOfServiceTask<span class="tok-nt">&lt;/dataInputRefs&gt;</span>
    <span class="tok-nt">&lt;/inputSet&gt;</span>
    <span class="tok-nt">&lt;outputSet&gt;</span>
        <span class="tok-nt">&lt;dataOutputRefs&gt;</span>dataOutputOfServiceTask<span class="tok-nt">&lt;/dataOutputRefs&gt;</span>
    <span class="tok-nt">&lt;/outputSet&gt;</span>
<span class="tok-nt">&lt;/ioSpecification&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnWebserviceTaskDataInputAssociation">Web服务任务数据输入关联</h5>
<div class="paragraph">
<p>有两种指定数据输入关联的方式：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用表达式</p>
</li>
<li>
<p>使用简化方法</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>使用表达式指定数据输入关联，需要定义源及目标条目，并指定每个条目与字段的关联。下面的例子中，我们针对每个条目，指定prefix与suffix字段：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-nt">&lt;dataInputAssociation&gt;</span>
    <span class="tok-nt">&lt;sourceRef&gt;</span>dataInputOfProcess<span class="tok-nt">&lt;/sourceRef&gt;</span>
    <span class="tok-nt">&lt;targetRef&gt;</span>dataInputOfServiceTask<span class="tok-nt">&lt;/targetRef&gt;</span>
    <span class="tok-nt">&lt;assignment&gt;</span>
        <span class="tok-nt">&lt;from&gt;</span>${dataInputOfProcess.prefix}<span class="tok-nt">&lt;/from&gt;</span>
        <span class="tok-nt">&lt;to&gt;</span>${dataInputOfServiceTask.prefix}<span class="tok-nt">&lt;/to&gt;</span>
    <span class="tok-nt">&lt;/assignment&gt;</span>
    <span class="tok-nt">&lt;assignment&gt;</span>
        <span class="tok-nt">&lt;from&gt;</span>${dataInputOfProcess.suffix}<span class="tok-nt">&lt;/from&gt;</span>
        <span class="tok-nt">&lt;to&gt;</span>${dataInputOfServiceTask.suffix}<span class="tok-nt">&lt;/to&gt;</span>
    <span class="tok-nt">&lt;/assignment&gt;</span>
<span class="tok-nt">&lt;/dataInputAssociation&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用更简单明了的简化方法。'sourceRef&#8217;元素是一个Flowable变量名，'targetRef&#8217;是条目定义的参数。在下面的例子里，将&#8217;PrefixVariable&#8217;变量的值关联至&#8217;prefix&#8217;字段，并将&#8217;SuffixVariable&#8217;变量的值关联至&#8217;suffix&#8217;字段。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-nt">&lt;dataInputAssociation&gt;</span>
    <span class="tok-nt">&lt;sourceRef&gt;</span>PrefixVariable<span class="tok-nt">&lt;/sourceRef&gt;</span>
    <span class="tok-nt">&lt;targetRef&gt;</span>prefix<span class="tok-nt">&lt;/targetRef&gt;</span>
<span class="tok-nt">&lt;/dataInputAssociation&gt;</span>
<span class="tok-nt">&lt;dataInputAssociation&gt;</span>
    <span class="tok-nt">&lt;sourceRef&gt;</span>SuffixVariable<span class="tok-nt">&lt;/sourceRef&gt;</span>
    <span class="tok-nt">&lt;targetRef&gt;</span>suffix<span class="tok-nt">&lt;/targetRef&gt;</span>
<span class="tok-nt">&lt;/dataInputAssociation&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnWebserviceTaskDataOutputAssociation">Web服务任务数据输出关联</h5>
<div class="paragraph">
<p>有两种指定数据输出关联的方式：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用表达式</p>
</li>
<li>
<p>使用简化方法</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>使用表达式指定数据输出关联，需要定义目标变量及源表达式。这种方法很简单，与数据输入关联类似：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;dataOutputAssociation&gt;</span>
    <span class="tok-nt">&lt;targetRef&gt;</span>dataOutputOfProcess<span class="tok-nt">&lt;/targetRef&gt;</span>
    <span class="tok-nt">&lt;transformation&gt;</span>${dataOutputOfServiceTask.prettyPrint}<span class="tok-nt">&lt;/transformation&gt;</span>
<span class="tok-nt">&lt;/dataOutputAssociation&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用更简单明了的简化方法。'sourceRef&#8217;是条目定义的参数，'targetRef&#8217;元素是Flowable变量名。这种方法很简单，与数据输入关联类似：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;dataOutputAssociation&gt;</span>
    <span class="tok-nt">&lt;sourceRef&gt;</span>prettyPrint<span class="tok-nt">&lt;/sourceRef&gt;</span>
    <span class="tok-nt">&lt;targetRef&gt;</span>OutputVariable<span class="tok-nt">&lt;/targetRef&gt;</span>
<span class="tok-nt">&lt;/dataOutputAssociation&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnBusinessRuleTask">8.5.5. 业务规则任务</h4>
<div class="sect4">
<h5 id="bpmnBusinessRuleTaskDescription">描述</h5>
<div class="paragraph">
<p>业务规则任务（business rule task）用于同步地执行一条或多条规则。Flowable使用名为Drools Expert的Drools规则引擎执行业务规则。目前，业务规则中包含的.drl文件，必须与定义了业务规则服务并执行规则的流程定义一起部署。这意味着流程中使用的所有.drl文件都需要打包在流程BAR文件中，与任务表单等类似。要了解如何为Drools Expert创建业务规则，请访问位于<a href="http://www.jboss.org/drools/documentation">JBoss Drools</a>的Drools文档。</p>
</div>
<div class="paragraph">
<p>如果想要使用自己的规则任务实现，比如希望通过不同方法使用Drools，或者想使用完全不同的规则引擎，则可以使用BusinessRuleTask的class或expression属性。这样它会与<a href="#bpmnJavaServiceTask">服务任务</a>的行为完全相同。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBusinessRuleTaskGraphicalNotation">图示</h5>
<div class="paragraph">
<p>业务规则任务显示为带有表格图标的圆角矩形。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.business.rule.task.png" alt="bpmn.business.rule.task">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnBusinessRuleTaskXML">XML表示</h5>
<div class="paragraph">
<p>要执行与流程定义在同一个BAR文件中部署的一条或多条业务规则，需要定义输入与结果变量。输入变量可以用流程变量的列表定义，使用逗号分隔。输出变量只能有一个变量名，将执行业务规则后的输出对象存储至流程变量。请注意结果变量会包含对象的List。如果没有指定结果变量名，默认为org.flowable.engine.rules.OUTPUT。</p>
</div>
<div class="paragraph">
<p>下面的业务规则任务，执行与流程定义一起部署的所有业务规则：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;simpleBusinessRuleProcess&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;businessRuleTask&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;businessRuleTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;businessRuleTask&quot;</span> <span class="tok-na">flowable:ruleVariablesInput=</span><span class="tok-s">&quot;${order}&quot;</span>
      <span class="tok-na">flowable:resultVariable=</span><span class="tok-s">&quot;rulesOutput&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;businessRuleTask&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以将业务规则任务配置为只执行部署的.drl文件中的一组规则。要做到这一点，需要指定规则名字的列表，用逗号分隔。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-nt">&lt;businessRuleTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;businessRuleTask&quot;</span> <span class="tok-na">flowable:ruleVariablesInput=</span><span class="tok-s">&quot;${order}&quot;</span>
      <span class="tok-na">flowable:rules=</span><span class="tok-s">&quot;rule1, rule2&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样只会执行rule1与rule2。</p>
</div>
<div class="paragraph">
<p>也可以定义需要从执行中排除的规则列表。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-nt">&lt;businessRuleTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;businessRuleTask&quot;</span> <span class="tok-na">flowable:ruleVariablesInput=</span><span class="tok-s">&quot;${order}&quot;</span>
      <span class="tok-na">flowable:rules=</span><span class="tok-s">&quot;rule1, rule2&quot;</span> <span class="tok-na">exclude=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这个例子中，除了rule1与rule2之外，其它所有与流程定义一起部署在同一个BAR文件中的规则都会被执行。</p>
</div>
<div class="paragraph">
<p>前面提到过，还可以自行指定BusinessRuleTask的实现：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;businessRuleTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;businessRuleTask&quot;</span> <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;${MyRuleServiceDelegate}&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样配置的业务规则任务与服务任务的行为完全一样，但仍保持业务规则任务的图标，代表在这里处理业务规则。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnEmailTask">8.5.6. 邮件任务</h4>
<div class="paragraph">
<p>Flowable让你可以通过自动的邮件服务任务（email task），增强业务流程。可以向一个或多个收信人发送邮件，支持cc，bcc，HTML文本，等等。请注意邮件任务<strong>不是</strong>BPMN 2.0规范的“官方”任务（所以也没有专用图标）。因此，在Flowable中，邮件任务实现为一种特殊的服务任务。</p>
</div>
<div class="sect4">
<h5 id="bpmnEmailTaskServerConfiguration">配置邮件服务器</h5>
<div class="paragraph">
<p>Flowable引擎使用支持SMTP的外部邮件服务器发送邮件。为了发送邮件，引擎需要了解如何连接邮件服务器。可以在<em>flowable.cfg.xml</em>配置文件中设置下面的参数：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填?</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailServerHost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件服务器的主机名（如mail.mycorp.com）。默认为<code>localhost</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailServerPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是，如果不使用默认端口</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件服务器的SMTP端口。默认值为<em>25</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailServerDefaultFrom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若用户没有提供地址，默认使用的邮件发件人地址。默认为<em>flowable@localhost</em>_</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailServerUsername</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若服务器需要</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部分邮件服务器发信时需要进行认证。默认为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailServerPassword</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若服务器需要</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部分邮件服务器发信时需要进行认证。默认为空。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailServerUseSSL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若服务器需要</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部分邮件服务器要求ssl通信。默认设置为false。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailServerUseTLS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若服务器需要</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部分邮件服务器要求TLS通信（例如gmail）。默认设置为false。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="bpmnEmailTaskUsage">定义邮件任务</h5>
<div class="paragraph">
<p>邮件任务实现为特殊的<a href="#bpmnJavaServiceTask">服务任务</a>，将服务任务的<em>type</em>定义为<em>'mail'</em>进行设置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sendMail&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;mail&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>邮件任务通过<a href="#serviceTaskFieldInjection">字段注入</a>配置。这些参数的值可以使用EL表达式，并将在流程执行运行时解析。可以设置下列参数：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填?</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件的收信人。可以使用逗号分隔的列表定义多个接收人</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">from</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件的发信人地址。如果不设置，会使用<a href="#bpmnEmailTaskServerConfiguration">默认配置</a>的地址</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">subject</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件的主题</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件的抄送人。可以使用逗号分隔的列表定义多个接收人</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bcc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件的密送人。可以使用逗号分隔的列表定义多个接收人</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">charset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可以指定邮件的字符集，对许多非英语语言很必要。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">html</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件的HTML文本</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件的内容，用于纯文本邮件。对于不支持富文本内容的客户端，可以与<em>html</em>一起使用。邮件客户端可以回退为显式纯文本格式。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">htmlVar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">存储邮件HTML内容的流程变量名。与<em>html</em>参数的最大区别，是这个参数会在邮件任务发送前，使用其内容进行表达式替换。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">textVar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">存储邮件纯文本内容的流程变量名。与<em>text</em>参数的最大区别，是这个参数会在邮件任务发送前，使用其内容进行表达式替换。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ignoreException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">处理邮件失败时，是忽略还是抛出FlowableException。默认设置为false。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">exceptionVariableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果设置<em>ignoreException = true</em>，而处理邮件失败时，则使用给定名字的变量保存失败信息</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="bpmnEmailTaskExampleUsage">示例 usage</h5>
<div class="paragraph">
<p>下面的XML代码片段是使用邮件任务的示例。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sendMail&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;mail&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;from&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;order-shipping@thecompany.com&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;to&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${recipient}&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;subject&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;Your order ${orderId} has been shipped&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;html&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:expression&gt;</span>
        <span class="tok-cp">&lt;![CDATA[</span>
<span class="tok-cp">          &lt;html&gt;</span>
<span class="tok-cp">            &lt;body&gt;</span>
<span class="tok-cp">              Hello ${male ? &#39;Mr.&#39; : &#39;Mrs.&#39; } ${recipientName},&lt;br/&gt;&lt;br/&gt;</span>

<span class="tok-cp">              As of ${now}, your order has been &lt;b&gt;processed and shipped&lt;/b&gt;.&lt;br/&gt;&lt;br/&gt;</span>

<span class="tok-cp">              Kind regards,&lt;br/&gt;</span>

<span class="tok-cp">              TheCompany.</span>
<span class="tok-cp">            &lt;/body&gt;</span>
<span class="tok-cp">          &lt;/html&gt;</span>
<span class="tok-cp">        ]]&gt;</span>
      <span class="tok-nt">&lt;/flowable:expression&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnHttpTask">8.5.7. Http任务</h4>
<div class="paragraph">
<p>Http任务（Http task）用于发出HTTP请求，增强了Flowable的集成能力。请注意Http任务不是BPMN 2.0规范的“官方”任务（所以也没有专用图标）。因此，在Flowable中，Http任务实现为一种特殊的服务任务。</p>
</div>
<div class="sect4">
<h5 id="bpmnHttpTaskClientConfiguration">配置Http客户端</h5>
<div class="paragraph">
<p>Flowable使用可配置的Http客户端发出Http请求。如果不进行设置，会使用默认配置。</p>
</div>
<div class="paragraph">
<p>示例配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span>  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span>
        <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-c">&lt;!-- http客户端配置 --&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;httpClientConfig&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;httpClientConfig&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;httpClientConfig&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.cfg.HttpClientConfig&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;connectTimeout&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;5000&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;socketTimeout&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;5000&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;connectionRequestTimeout&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;5000&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestRetryLimit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;5&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填?</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接超时时间，以毫秒计。<br>
默认值 5000。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">socketTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Socket超时时间，以毫秒计。<br>
默认值 5000。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionRequestTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求连接超时时间。以毫秒计<br>
默认值 5000。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestRetryLimit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求重试次数（“0”代表不重试）<br>
默认值 3。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disableCertVerify</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">禁用SSL证书验证。<br>
默认值 false。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="bpmnHttpTaskUsage">定义Http任务</h5>
<div class="paragraph">
<p>Http任务实现为特殊的<a href="#bpmnJavaServiceTask">服务任务</a>，将服务任务的<em>type</em>定义为<em>'http'</em>进行设置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;httpGet&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;http&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用自定义的实现，覆盖Http任务的默认行为。
需要扩展org.flowable.http.HttpActivityBehavior，并覆盖perform()方法。</p>
</div>
<div class="paragraph">
<p>需要在任务定义中设置<em>httpActivityBehaviorClass</em>字段（默认值为 <em>org.flowable.http.impl.HttpActivityBehaviorImpl</em>）。</p>
</div>
<div class="paragraph">
<p>当前使用的默认实现<em>HttpActivityBehaviorImpl</em>基于Apache Http Client。尽管Apache Http Client可以使用很多方法自定义，但我们并没有在Http客户端配置中使用全部选项。</p>
</div>
<div class="paragraph">
<p>参考 <a href="http://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/impl/client/HttpClientBuilder.html">Http Client builder</a> 创建自定义客户端。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;serviceTask id="httpGet" flowable:type="http"&gt;
  &lt;extensionElements&gt;
    &lt;flowable:field name="httpActivityBehaviorClass"&gt;
        &lt;flowable:string&gt;
          &lt;![CDATA[org.example.flowable.HttpActivityBehaviorCustomImpl]]&gt;
        &lt;/flowable:string&gt;
    &lt;/flowable:field&gt;
  &lt;/extensionElements&gt;
&lt;/sericeTask&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnHttpTaskConfiguration">配置Http任务</h5>
<div class="paragraph">
<p>Http任务通过<a href="#serviceTaskFieldInjection">字段注入</a>配置。所有参数都可以配置为EL表达式，在运行时进行解析。可以设置下列参数：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填?</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestMethod</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求方法<br>
（GET,POST,PUT,DELETE）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求URL<br>
（例如 - <a href="http://flowable.org）。" class="bare">http://flowable.org）。</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestHeaders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">行分隔的Http请求头。<br>
例如 -<br>
Content-Type: application/json<br>
Authorization: Basic aGFRlc3Q=</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestBody</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求体<br>
例如 - ${sampleBody}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求超时时间。单位为毫秒<br>
（例如 - 5000）。<br>
默认值为“0”，即没有超时。<br>
链接相关的超时设置为<a href="#bpmnHttpTaskClientConfiguration">配置Http客户端</a>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disallowRedirects</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否禁用Http重定向。<br>
默认为false。<br>
（例如 - true）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">failStatusCodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">逗号分隔的Http状态码，将令请求失败并抛出FlowableException。<br>
例如：400, 404, 500, 503<br>
例如：400, 5XX</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">handleStatusCodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">逗号分隔的Http状态码，将令任务抛出BpmnError，并可用错误边界事件捕获。<br>
BpmnError的错误码为<em>HTTP&lt;statuscode&gt;</em>。<br>
例如，404状态码会将错误码设置为<em>HTTP404</em>。<br>
仅当<em>disallowRedirects</em>字段设置为true时，3XX状态码才会被抛出。若同一个状态码在<em>handleStatusCodes</em>及<em>failStatusCodes</em>中都有配置，则<em>handleStatusCodes</em>生效。<br>
例如：400, 404, 500, 503<br>
例如：3XX, 4XX, 5XX<br></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ignoreException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否忽略异常。异常将被捕获，并存储在名为<em>&lt;taskId&gt;.errorMessage</em>的变量中。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">saveRequestVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否保存请求变量。<br>
默认情况下，只会保存将响应相关的变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">saveResponseParameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否保存全部的响应变量，包括HTTP状态码，响应头等。<br>
默认情况下，只会将响应体保存为变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resultVariablePrefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">执行变量名的前缀。<br>
如果不设置前缀，变量名为<em>&lt;taskId&gt;.fieldName</em>。<br>
例如，对于id为<em>task7</em>的任务，其请求URL将保存为<em>task7.requestUrl</em>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">saveResponseParametersTransient</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若为true，则会将响应体变量（如果设置了保存响应头，状态码，也包括在内）设置为瞬时变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">saveResponseVariableAsJson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若为true，则响应体会保存为JSON变量，而非String。如果HTTP服务返回JSON，并且想使用点注记方式使用字段（如<em>myResponse.user.name</em>），这个配置就很有用。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">httpActivityBehaviorClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.flowable.http.HttpActivityBehavior类的自定义扩展的全限定类名。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>除了上面提到的字段，使用<em>saveResponseParameters</em>还会在执行成功后设置下列变量。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">变量</th>
<th class="tableblock halign-left valign-top">可选？</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">responseProtocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Http版本。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">responseReason</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Http响应原因短语。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">responseStatusCode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Http响应状态码（例如 - 200）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">responseHeaders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">行分隔的Http响应头。<br>
例如 -<br>
Content-Type: application/json<br>
Content-Length: 777</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">responseBody</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串形式的响应体，若有。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">errorMessage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">被忽略的异常信息，若有。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_result_variables">结果变量</h5>
<div class="paragraph">
<p>请注意上述执行变量名都会使用<em>resultVariablePrefix</em>前缀。
例如，可以在其他活动中，使用<em>task7.responseStatusCode</em>获取响应状态码。
其中<em>task7</em>是服务任务的<em>id</em>。可以设置<em>resultVariablePrefix</em>覆盖这个行为。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnHttpTaskExampleUsage">示例</h5>
<div class="paragraph">
<p>下面的XML片段是使用Http任务的例子。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;httpGet&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;http&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestMethod&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;GET&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestUrl&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;http://flowable.org&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestHeaders&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:expression&gt;</span>
        <span class="tok-cp">&lt;![CDATA[</span>
<span class="tok-cp">          Accept: text/html</span>
<span class="tok-cp">          Cache-Control: no-cache</span>
<span class="tok-cp">        ]]&gt;</span>
      <span class="tok-nt">&lt;/flowable:expression&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestTimeout&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:expression&gt;</span>
        <span class="tok-cp">&lt;![CDATA[</span>
<span class="tok-cp">          ${requestTimeout}</span>
<span class="tok-cp">        ]]&gt;</span>
      <span class="tok-nt">&lt;/flowable:expression&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resultVariablePrefix&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:string&gt;</span>task7<span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnHttpTaskErrorHandling">错误处理</h5>
<div class="paragraph">
<p>默认情况下，当发生链接、IO或其他未处理的异常时，Http任务抛出FlowableException。
默认情况下，不会处理任何重定向/客户端/服务端错误状态码。</p>
</div>
<div class="paragraph">
<p>可以设置<em>failStatusCodes</em>及/或<em>handleStatusCodes</em>字段，配置Http任务处理异常及Http状态的方式。参见<a href="#bpmnHttpTaskConfiguration">配置Http任务</a>。</p>
</div>
<div class="paragraph">
<p>由<em>handleStatusCodes</em>抛出的BpmnError与其他BPMN异常一样，需要由对应的错误边界事件处理。
下面是一些Http任务错误处理及重试的例子。</p>
</div>
<div class="sect5">
<h6 id="_400及5xx失败异步执行并按照failedjobretrytimecycle重试的http任务"><em>400</em>及5XX失败，异步执行，并按照failedJobRetryTimeCycle重试的Http任务</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;failGet&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Fail test&quot;</span> <span class="tok-na">flowable:async=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;http&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestMethod&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:string&gt;</span><span class="tok-cp">&lt;![CDATA[GET]]&gt;</span><span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestUrl&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:string&gt;</span><span class="tok-cp">&lt;![CDATA[http://localhost:9798/api/fail]]&gt;</span><span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;failStatusCodes&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:string&gt;</span><span class="tok-cp">&lt;![CDATA[400, 5XX]]&gt;</span><span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;flowable:failedJobRetryTimeCycle&gt;</span>R3/PT5S<span class="tok-nt">&lt;/flowable:failedJobRetryTimeCycle&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_将400处理为bmpnerror">将<em>400</em>处理为BmpnError</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;handleGet&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;HTTP Task&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;http&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestMethod&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:string&gt;</span><span class="tok-cp">&lt;![CDATA[GET]]&gt;</span><span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestUrl&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:string&gt;</span><span class="tok-cp">&lt;![CDATA[http://localhost:9798/api/fail]]&gt;</span><span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;handleStatusCodes&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:string&gt;</span><span class="tok-cp">&lt;![CDATA[4XX]]&gt;</span><span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
<span class="tok-nt">&lt;boundaryEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;catch400&quot;</span> <span class="tok-na">attachedToRef=</span><span class="tok-s">&quot;handleGet&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;errorEventDefinition</span> <span class="tok-na">errorRef=</span><span class="tok-s">&quot;HTTP400&quot;</span><span class="tok-nt">&gt;&lt;/errorEventDefinition&gt;</span>
<span class="tok-nt">&lt;/boundaryEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_忽略异常">忽略异常</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;ignoreTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Fail test&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;http&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestMethod&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:string&gt;</span><span class="tok-cp">&lt;![CDATA[GET]]&gt;</span><span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;requestUrl&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:string&gt;</span><span class="tok-cp">&lt;![CDATA[http://nohost:9798/api]]&gt;</span><span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;ignoreException&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:string&gt;</span><span class="tok-cp">&lt;![CDATA[true]]&gt;</span><span class="tok-nt">&lt;/flowable:string&gt;</span>
    <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_异常映射">异常映射</h6>
<div class="paragraph">
<p>参见<a href="#exceptionMapping">异常映射</a></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnMuleTask">8.5.8. Mule任务</h4>
<div class="paragraph">
<p>Mule任务可以向Mule发送消息，增强Flowable的集成特性。请注意Mule任务<strong>不是</strong>BPMN 2.0规范的“官方”任务（所以也没有专用图标）。因此，在Flowable中，Mule任务实现为一种特殊的服务任务。</p>
</div>
<div class="sect4">
<h5 id="bpmnMuleTaskUsage">定义Mule任务</h5>
<div class="paragraph">
<p>Mule任务实现为特殊的<a href="#bpmnJavaServiceTask">服务任务</a>，将服务任务的<em>type</em>定义为<em>'mule'</em>进行设置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sendMule&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;mule&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mule任务通过<a href="#serviceTaskFieldInjection">字段注入</a>配置。这些参数的值可以使用EL表达式，将在流程执行运行时解析。可以设置下列参数：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填?</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">endpointUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">希望调用的Mule端点（endpoint）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">language</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">计算payloadExpression字段所用的语言。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">payloadExpression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">消息载荷的表达式。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resultVariable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">存储调用结果的变量名。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="bpmnMuleTaskExampleUsage">示例</h5>
<div class="paragraph">
<p>下面的XML代码片段是使用Mule任务的例子。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-nt">&lt;extensionElements&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;endpointUrl&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;flowable:string&gt;</span>vm://in<span class="tok-nt">&lt;/flowable:string&gt;</span>
  <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;language&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;flowable:string&gt;</span>juel<span class="tok-nt">&lt;/flowable:string&gt;</span>
  <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;payloadExpression&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;flowable:string&gt;</span>&quot;hi&quot;<span class="tok-nt">&lt;/flowable:string&gt;</span>
  <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resultVariable&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;flowable:string&gt;</span>theVariable<span class="tok-nt">&lt;/flowable:string&gt;</span>
  <span class="tok-nt">&lt;/flowable:field&gt;</span>
<span class="tok-nt">&lt;/extensionElements&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnCamelTask">8.5.9. Camel任务</h4>
<div class="paragraph">
<p>Camel任务（Camel task）可以向Camel发送消息，增强Flowable的集成特性。请注意Camel任务<strong>不是</strong>BPMN 2.0规范的“官方”任务（所以也没有专用图标）。因此，在Flowable中，Camel任务实现为一种特殊的服务任务。还请注意，需要在项目中包含Flowable Camel模块才能使用Camel任务。</p>
</div>
<div class="sect4">
<h5 id="bpmnCamelTaskUsage">定义Camel任务</h5>
<div class="paragraph">
<p>Camel任务实现为特殊的<a href="#bpmnJavaServiceTask">服务任务</a>，将服务任务的<em>type</em>定义为<em>'camel'</em>进行设置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sendCamel&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;camel&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>只需要在流程定义的服务任务上定义Camel类型即可。集成逻辑都通过Camel容器委托。默认情况下Flowable引擎在Spring容器中查找camelContext Bean。camelContext Bean定义由Camel容器装载的Camel路由。在下面的例子中，按照指定的Java包装载路由。但也可以自行在Spring配置中直接定义路由。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;camelContext</span> <span class="tok-na">id=</span><span class="tok-s">&quot;camelContext&quot;</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://camel.apache.org/schema/spring&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;packageScan&gt;</span>
    <span class="tok-nt">&lt;package&gt;</span>org.flowable.camel.route<span class="tok-nt">&lt;/package&gt;</span>
  <span class="tok-nt">&lt;/packageScan&gt;</span>
<span class="tok-nt">&lt;/camelContext&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以在<a href="http://camel.apache.org/">Camel网站</a>找到关于Camel路由的更多文档。下面只通过几个小例子展示基本概念。在第一个例子中，在Flowable工作流中进行最简单的Camel调用。叫做SimpleCamelCall。</p>
</div>
<div class="paragraph">
<p>如果想要定义多个Camel上下文Bean，或想使用不同的Bean名字，可以在Camel任务定义中像这样覆盖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceTask1&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;camel&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;camelContext&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;customCamelContext&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCamelTaskSimpleCamelCall">简单Camel调用示例</h5>
<div class="paragraph">
<p>这个例子相关的所有文件，都可以在flowable-camel模块的org.flowable.camel.examples.simpleCamelCall包中找到。目标是简单地启动一个Camel路由。首先需要一个配置了上面提到的路由的Spring上下文。下面的代码实现这个目的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;camelContext</span> <span class="tok-na">id=</span><span class="tok-s">&quot;camelContext&quot;</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://camel.apache.org/schema/spring&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;packageScan&gt;</span>
    <span class="tok-nt">&lt;package&gt;</span>org.flowable.camel.examples.simpleCamelCall<span class="tok-nt">&lt;/package&gt;</span>
  <span class="tok-nt">&lt;/packageScan&gt;</span>
<span class="tok-nt">&lt;/camelContext&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SimpleCamelCallRoute</span> <span class="tok-kd">extends</span> <span class="tok-n">RouteBuilder</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">configure</span><span class="tok-o">()</span> <span class="tok-kd">throws</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
    <span class="tok-n">from</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable:SimpleCamelCallProcess:simpleCall&quot;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s">&quot;log:org.flowable.camel.examples.SimpleCamelCall&quot;</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>路由只是记录消息体，不做更多事情。请注意from端点（endpoint）的格式，包含冒号分隔的三个部分：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">端点URL部分</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指向引擎端点</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SimpleCamelCallProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">simpleCall</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程中Camel服务的名字</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>现在已经配置好路由，可以访问Camel。下面需要像这样定义工作流：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;SimpleCamelCallProcess&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;start&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;simpleCall&quot;</span><span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;simpleCall&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;camel&quot;</span><span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;simpleCall&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;end&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;end&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCamelTaskPingPong">连通性测试示例</h5>
<div class="paragraph">
<p>示例已经可以工作，但实际上Camel与Flowable之间并没有通信，因此没有太多价值。在这个例子里，将试着从Camel接收与发送消息。我们将发送一个字符串，Camel在其上附加一些文字并返回作为结果。发送部分比较普通，即以变量的格式将信息发送给Camel服务。这是我们的调用代码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-nd">@Deployment</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testPingPong</span><span class="tok-o">()</span> <span class="tok-o">{</span>
  <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">variables</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;();</span>

  <span class="tok-n">variables</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;input&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Hello&quot;</span><span class="tok-o">);</span>
  <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">outputMap</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">String</span><span class="tok-o">&gt;();</span>
  <span class="tok-n">variables</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;outputMap&quot;</span><span class="tok-o">,</span> <span class="tok-n">outputMap</span><span class="tok-o">);</span>

  <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;PingPongProcess&quot;</span><span class="tok-o">,</span> <span class="tok-n">variables</span><span class="tok-o">);</span>
  <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-n">outputMap</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">());</span>
  <span class="tok-n">assertNotNull</span><span class="tok-o">(</span><span class="tok-n">outputMap</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-s">&quot;outputValue&quot;</span><span class="tok-o">));</span>
  <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Hello World&quot;</span><span class="tok-o">,</span> <span class="tok-n">outputMap</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-s">&quot;outputValue&quot;</span><span class="tok-o">));</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>“input”变量是实际上是Camel路由的输入，而outputMap用于捕获Camel传回的结果。流程像是这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;PingPongProcess&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;start&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;ping&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;ping&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;camel&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;ping&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;saveOutput&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;saveOutput&quot;</span> <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;org.flowable.camel.examples.pingPong.SaveOutput&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow3&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;saveOutput&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;end&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;end&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意SaveOutput服务任务会从上下文中取出“Output”变量，并存储至上面提到的OutputMap。现在需要了解变量如何发送至Camel，以及如何返回。这就需要了解Camel行为（Behavior）的概念。变量与Camel通信的方式可以通过CamelBehavior配置。在这个例子里使用默认配置，其它配置在后面会进行简短介绍。可以使用类似的代码配置期望的Camel行为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceTask1&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;camel&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;camelBehaviorClass&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;org.flowable.camel.impl.CamelBehaviorCamelBodyImpl&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果不指定行为，则会设置为org.flowable.camel.impl.CamelBehaviorDefaultImpl。这个行为会将变量复制到相同名字的Camel参数。无论选择什么行为，对于返回值：如果Camel消息体是一个map，则其中的每个元素都将复制为变量；否则整个对象将复制为名为"camelBody"的特定变量。以第二个例子作为Camel路由的总结：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">configure</span><span class="tok-o">()</span> <span class="tok-kd">throws</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
  <span class="tok-n">from</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable:PingPongProcess:ping&quot;</span><span class="tok-o">).</span><span class="tok-na">transform</span><span class="tok-o">().</span><span class="tok-na">simple</span><span class="tok-o">(</span><span class="tok-s">&quot;${property.input} World&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个路由中，字符串"world"会在结尾连接上名为“input”的参数，并将结果作为消息体返回。可以通过Java服务任务访问"camelBody"变量。也可以访问“outputMap”获取。除了这个例子中使用的默认行为之外，我们还可以看看其他的方式。在每个Camel路由开始时，流程实例ID会复制为名为"PROCESS_ID_PROPERTY"的Camel参数。之后会用于将流程实例与Camel路由相关联。也可以在Camel路由中直接使用。</p>
</div>
<div class="paragraph">
<p>Flowable提供了三种不同的行为。可以通过修改路由URL中特定的部分覆写行为。这里有个在URL中覆写已有行为的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">from</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable:asyncCamelProcess:serviceTaskAsync2?copyVariablesToProperties=true&quot;</span><span class="tok-o">).</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>下表展示了三种可用的Camel行为：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">行为</th>
<th class="tableblock halign-left valign-top">URL中</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CamelBehaviorDefaultImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyVariablesToProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">将Flowable变量复制为Camel参数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CamelBehaviorCamelBodyImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyCamelBodyToBody</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只将名为"camelBody"的Flowable变量复制为Camel消息体。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CamelBehaviorBodyAsMapImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyVariablesToBodyAsMap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">将一个map中的所有Flowable变量复制为Camel消息体。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>上表展示了Flowable变量如何传递给Camel。下表展示Camel变量如何返回至Flowable。需要在路由URL中进行配置。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">URL</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果Camel消息体是一个map，则将其中每一对象复制为Flowable变量；否则将整个Camel消息体复制为"camelBody" Flowable变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyVariablesFromProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">将Camel参数以同名复制为Flowable变量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyCamelBodyToBodyAsString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">与default相同，但如果Camel消息体不是map，则首先将其转换为字符串，然后再复制为"camelBody"。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyVariablesFromHeader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">额外地，将Camel头复制为Flowable的同名变量。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_returning_back_the_variables">返回变量</h5>
<div class="paragraph">
<p>上面提到的变量传递，不论是从Camel到Flowable还是反向，都只用于变量传递的起始侧。
要特别注意，由于Flowable的行为是非阻塞的，Flowable不会自动向Camel返回变量。
为此提供了特殊的语法。可以在Camel路由URL中，以<code>var.return.someVariableName</code>的格式，指定一个或多个参数。与这些参数同名（但没有<code>var.return</code>部分）的变量会作为输出变量。因此将会以相同的名字复制回Camel参数。<br>
例如在如下路由中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>from("direct:start").to("flowable:process?var.return.exampleVar").to("mock:result");</pre>
</div>
</div>
<div class="paragraph">
<p>名为<code>exampleVar</code>的Flowable变量会作为输出变量。因此会以同名复制回Camel参数。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCamelTaskAsyncPingPong">异步连通性测试示例</h5>
<div class="paragraph">
<p>上面的例子全都是同步的。流程实例等待，直到Camel路由结束并返回。有时，需要Flowable流程实例继续运行。这时可以使用Camel服务任务的异步功能。可以将Camel服务任务的<em>async</em>参数设置为true，启用这个功能。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;serviceAsyncPing&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;camel&quot;</span> <span class="tok-na">flowable:async=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>设置这个参数后，Camel路由会由Flowable作业执行器异步启动。如果在Camel路由中定义了队列，Flowable流程实例会继续执行流程定义中Camel服务任务之后的活动。Camel路由会与流程执行完全异步地执行。如果需要在流程定义的某处等待Camel服务任务的响应，可以使用接收任务（receive task）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;receiveTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;receiveAsyncPing&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Wait State&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>流程实例会等待，直到接收到来自Camel的信号。可以在Camel中向特定的Flowable端点发送消息，来为流程实例发送信号。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span> <span class="tok-n">from</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable:asyncPingProcess:serviceAsyncPing&quot;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable:asyncPingProcess:receiveAsyncPing&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>“flowable”字符串常量</p>
</li>
<li>
<p>流程名</p>
</li>
<li>
<p>接收任务名</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCamelInstantiateWorkflowFromCamelRoute">使用Camel路由实例化工作流</h5>
<div class="paragraph">
<p>上面的例子都是先启动Flowable流程实例，然后在流程实例中启动Camel路由。也可以反过来，在已经启动的Camel路由中启动或调用流程实例。类似于为接收任务发送消息。例如，一个简单的路由：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">from</span><span class="tok-o">(</span><span class="tok-s">&quot;direct:start&quot;</span><span class="tok-o">).</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable:camelProcess&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以看到，URL包含两部分：第一部分是“flowable”字符串常量，第二部分是流程定义的名字。当然，需要提前在Flowable引擎中部署这个流程定义。</p>
</div>
<div class="paragraph">
<p>也可以在Camel头中，将流程实例起动人设置为某个已认证用户ID。为此，首先需要在流程定义中指定启动人变量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-na">flowable:initiator=</span><span class="tok-s">&quot;initiator&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>然后使用Camel头<em>CamelProcessInitiatorHeader</em>指定用户ID。Camel路由定义如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-n">from</span><span class="tok-o">(</span><span class="tok-s">&quot;direct:startWithInitiatorHeader&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">setHeader</span><span class="tok-o">(</span><span class="tok-s">&quot;CamelProcessInitiatorHeader&quot;</span><span class="tok-o">,</span> <span class="tok-n">constant</span><span class="tok-o">(</span><span class="tok-s">&quot;kermit&quot;</span><span class="tok-o">))</span>
    <span class="tok-o">.</span><span class="tok-na">to</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable:InitiatorCamelCallProcess?processInitiatorHeaderName=CamelProcessInitiatorHeader&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnManualTask">8.5.10. 手动任务</h4>
<div class="sect4">
<h5 id="bpmnManualTaskDescription">描述</h5>
<div class="paragraph">
<p><em>手动任务（manual task）</em>定义在BPM引擎之外的任务。它用于建模引擎不需要了解，也不需要提供系统或用户界面的工作。对于引擎来说，手动任务将按<strong>直接穿过活动</strong>处理，在流程执行到达手动任务时，自动继续执行流程。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnManualTaskGraphicalNotation">图示</h5>
<div class="paragraph">
<p>手动任务用左上角有一个小“手”图标的标准BPMN 2.0任务（圆角矩形）表示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.manual.task.png" alt="bpmn.manual.task">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnManualTaskXml">XML表示</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;manualTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myManualTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Call client for more information&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnReceiveTask">8.5.11. Java接收任务</h4>
<div class="sect4">
<h5 id="bpmnReceiveTaskDescription">描述</h5>
<div class="paragraph">
<p>接收任务（receive task），是等待特定消息到达的简单任务。目前，我们只为这个任务实现了Java语义。当流程执行到达接收任务时，流程状态将提交至持久化存储。这意味着流程将保持等待状态，直到引擎接收到特定的消息，触发流程穿过接收任务继续执行。</p>
</div>
</div>
<div class="sect4">
<h5 id="_graphical_notation_2">图示</h5>
<div class="paragraph">
<p>接收任务用左上角有一个消息图标的标准BPMN 2.0任务（圆角矩形）表示。消息图标是白色的（对应的黑色消息图标代表发送的含义）。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.receive.task.png" alt="bpmn.receive.task">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_xml_representation_2">XML表示</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;receiveTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;waitState&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;wait&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>要使流程实例从接收任务的等待状态中继续执行，需要使用到达接收任务的执行id，调用<em>runtimeService.signal(executionId)</em>。下面的代码片段展示了如何操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-n">ProcessInstance</span> <span class="tok-n">pi</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span><span class="tok-s">&quot;receiveTask&quot;</span><span class="tok-o">);</span>
<span class="tok-n">Execution</span> <span class="tok-n">execution</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createExecutionQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">processInstanceId</span><span class="tok-o">(</span><span class="tok-n">pi</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">())</span>
  <span class="tok-o">.</span><span class="tok-na">activityId</span><span class="tok-o">(</span><span class="tok-s">&quot;waitState&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
<span class="tok-n">assertNotNull</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">);</span>

<span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">trigger</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnShellTask">8.5.12. Shell任务</h4>
<div class="sect4">
<h5 id="bpmnShellTaskDescription">描述</h5>
<div class="paragraph">
<p>Shell任务（Shell task）可以运行Shell脚本与命令。请注意Shell任务<strong>不是</strong>BPMN 2.0规范的“官方”任务（因此也没有专用图标）。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnShellTaskUsage">定义Shell任务</h5>
<div class="paragraph">
<p>Shell任务实现为特殊的<a href="#bpmnJavaServiceTask">服务任务</a>，将服务任务的<em>type</em>定义为<em>'shell'</em>进行设置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;shellEcho&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;shell&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Shell任务通过<a href="#serviceTaskFieldInjection">字段注入</a>配置。这些参数的值可以使用EL表达式，将在流程执行运行时解析。可以设置下列参数：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填?</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">command</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要执行的Shell命令。</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">arg1-5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参数1至参数5</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wait</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true/false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否等待Shell进程终止。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">redirectError</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true/false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否将标准错误（standard error）并入标准输出（standard output）。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cleanEnv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true/false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否避免Shell进程继承当前环境。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outputVariable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">保存输出的变量名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不会记录输出。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">errorCodeVariable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">保存结果错误码的变量名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不会记录错误码。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shell进程的默认目录</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当前目录</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="bpmnShellTaskExampleUsage">示例</h5>
<div class="paragraph">
<p>下面的XML代码片段是使用Shell任务的例子。将会运行"cmd /c echo EchoTest" Shell脚本，等待其结束，并将其结果存入<em>resultVar</em>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;shellEcho&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;shell&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;command&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;cmd&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;arg1&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;/c&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;arg2&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;echo&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;arg3&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;EchoTest&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;wait&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;outputVariable&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;resultVar&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="executionListeners">8.5.13. 执行监听器</h4>
<div class="paragraph">
<p>执行监听器（execution listener）可以在流程执行中发生特定的事件时，执行外部Java代码或计算表达式。可以被捕获的事件有：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>流程实例的启动和结束。</p>
</li>
<li>
<p>流程执行转移。</p>
</li>
<li>
<p>活动的启动和结束。</p>
</li>
<li>
<p>网关的启动和结束。</p>
</li>
<li>
<p>中间事件的启动和结束。</p>
</li>
<li>
<p>启动事件的结束，和结束事件的启动。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>下面的流程定义包含了三个执行监听器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;executionListenersProcess&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:executionListener</span>
      <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.examples.bpmn.executionlistener.ExampleExecutionListenerOne&quot;</span>
      <span class="tok-na">event=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>

  <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;firstTask&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;firstTask&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;firstTask&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;secondTask&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;extensionElements&gt;</span>
      <span class="tok-nt">&lt;flowable:executionListener</span>
        <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.examples.bpmn.executionListener.ExampleExecutionListenerTwo&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/extensionElements&gt;</span>
  <span class="tok-nt">&lt;/sequenceFlow&gt;</span>

  <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;secondTask&quot;</span> <span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;extensionElements&gt;</span>
      <span class="tok-nt">&lt;flowable:executionListener</span>
        <span class="tok-na">expression=</span><span class="tok-s">&quot;${myPojo.myMethod(execution.event)}&quot;</span>
        <span class="tok-na">event=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/extensionElements&gt;</span>
  <span class="tok-nt">&lt;/userTask&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;secondTask&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;thirdTask&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;thirdTask&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;thirdTask&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>第一个执行监听器将在流程启动时收到通知。这个监听器是一个外部Java类（<code>ExampleExecutionListenerOne</code>），并且需要实现<code>org.flowable.engine.delegate.ExecutionListener</code>接口。当该事件发生时（这里是<code>start</code>事件），会调用<code>notify(ExecutionListenerExecution execution)</code>方法。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ExampleExecutionListenerOne</span> <span class="tok-kd">implements</span> <span class="tok-n">ExecutionListener</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">notify</span><span class="tok-o">(</span><span class="tok-n">ExecutionListenerExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;variableSetInExecutionListener&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;firstValue&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;eventReceived&quot;</span><span class="tok-o">,</span> <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">getEventName</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用实现了<code>org.flowable.engine.delegate.JavaDelegate</code>接口的委托类。这些委托类也可以用于其他的结构，如服务任务的委托。</p>
</div>
<div class="paragraph">
<p>第二个执行监听器在流程执行转移时被调用。请注意<code>listener</code>元素并未定义<code>event</code>，因为在转移上只会触发<code>take</code>事件。<strong>当监听器定义在转移上时，<code>event</code>属性的值将被忽略。</strong></p>
</div>
<div class="paragraph">
<p>最后一个执行监听器在<code>secondTask</code>活动结束时被调用。监听器声明中没有使用<code>class</code>，而是定义了<code>expression</code>。这个表达式将在事件触发时计算/调用。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;flowable:executionListener</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${myPojo.myMethod(execution.eventName)}&quot;</span> <span class="tok-na">event=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>与其他表达式一样，可以使用与解析<em>execution</em>变量。execution对象提供了露事件名参数，可以使用<code>execution.eventName</code>向你的方法传递事件名。</p>
</div>
<div class="paragraph">
<p><a href="#bpmnJavaServiceTaskXML">与服务任务类似</a>，执行监听器也支持使用<code>delegateExpression</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;flowable:executionListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-na">delegateExpression=</span><span class="tok-s">&quot;${myExecutionListenerBean}&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>较早之前，我们也引入了新的执行监听器类型，org.flowable.engine.impl.bpmn.listener.ScriptExecutionListener。这个脚本执行监听器可以为执行监听器事件执行一段脚本代码。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span></span><span class="tok-nt">&lt;flowable:executionListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;start&quot;</span>
    <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.bpmn.listener.ScriptExecutionListener&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;script&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;flowable:string&gt;</span>
      def bar = &quot;BAR&quot;;  // 局部变量
      foo = &quot;FOO&quot;; // 将变量放入执行上下文
      execution.setVariable(&quot;var1&quot;, &quot;test&quot;); // 测试访问执行实例
      bar // 隐式返回值
    <span class="tok-nt">&lt;/flowable:string&gt;</span>
  <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;language&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;groovy&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resultVariable&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;myVar&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;/flowable:executionListener&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="executionListenerFieldInjection">执行监听器上的字段注入</h5>
<div class="paragraph">
<p>使用通过<code>class</code>属性配置的执行监听器时，可以使用字段注入。与<a href="#serviceTaskFieldInjection">服务任务字段注入</a>使用完全相同的机制，可以在那里看到字段注入的各种用法。</p>
</div>
<div class="paragraph">
<p>下面的代码片段展示了一个简单的示例流程，带有一个使用了字段注入的执行监听器。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;executionListenersProcess&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:executionListener</span>
        <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.examples.bpmn.executionListener.ExampleFieldInjectedExecutionListener&quot;</span>
        <span class="tok-na">event=</span><span class="tok-s">&quot;start&quot;</span><span class="tok-nt">&gt;</span>

      <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;fixedValue&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;Yes, I am &quot;</span> <span class="tok-nt">/&gt;</span>
      <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dynamicValue&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;${myVar}&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;/flowable:executionListener&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>

  <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;firstTask&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;firstTask&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;firstTask&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theEnd&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/process&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ExampleFieldInjectedExecutionListener</span> <span class="tok-kd">implements</span> <span class="tok-n">ExecutionListener</span> <span class="tok-o">{</span>

  <span class="tok-kd">private</span> <span class="tok-n">Expression</span> <span class="tok-n">fixedValue</span><span class="tok-o">;</span>

  <span class="tok-kd">private</span> <span class="tok-n">Expression</span> <span class="tok-n">dynamicValue</span><span class="tok-o">;</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">notify</span><span class="tok-o">(</span><span class="tok-n">ExecutionListenerExecution</span> <span class="tok-n">execution</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">Exception</span> <span class="tok-o">{</span>
    <span class="tok-n">execution</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;var&quot;</span><span class="tok-o">,</span> <span class="tok-n">fixedValue</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">).</span><span class="tok-na">toString</span><span class="tok-o">()</span> <span class="tok-o">+</span>
        <span class="tok-n">dynamicValue</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">(</span><span class="tok-n">execution</span><span class="tok-o">).</span><span class="tok-na">toString</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ExampleFieldInjectedExecutionListener</code>类将连接两个字段（一个是固定值-fixedValue，另一个是动态值-dynamicValue），并将其存储在'<code>var</code>'流程变量中。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-nd">@Deployment</span><span class="tok-o">(</span><span class="tok-n">resources</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
  <span class="tok-s">&quot;org/flowable/examples/bpmn/executionListener/ExecutionListenersFieldInjectionProcess.bpmn20.xml&quot;</span><span class="tok-o">})</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testExecutionListenerFieldInjection</span><span class="tok-o">()</span> <span class="tok-o">{</span>
  <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">variables</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;();</span>
  <span class="tok-n">variables</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;myVar&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;listening!&quot;</span><span class="tok-o">);</span>

  <span class="tok-n">ProcessInstance</span> <span class="tok-n">processInstance</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span>
      <span class="tok-s">&quot;executionListenersProcess&quot;</span><span class="tok-o">,</span> <span class="tok-n">variables</span><span class="tok-o">);</span>

  <span class="tok-n">Object</span> <span class="tok-n">varSetByListener</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">getVariable</span><span class="tok-o">(</span><span class="tok-n">processInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">(),</span> <span class="tok-s">&quot;var&quot;</span><span class="tok-o">);</span>
  <span class="tok-n">assertNotNull</span><span class="tok-o">(</span><span class="tok-n">varSetByListener</span><span class="tok-o">);</span>
  <span class="tok-n">assertTrue</span><span class="tok-o">(</span><span class="tok-n">varSetByListener</span> <span class="tok-k">instanceof</span> <span class="tok-n">String</span><span class="tok-o">);</span>

  <span class="tok-c1">// 结果为固定注入字段及注入表达式的连接</span>
  <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Yes, I am listening!&quot;</span><span class="tok-o">,</span> <span class="tok-n">varSetByListener</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，与服务任务使用相同的线程安全规则。请阅读<a href="#serviceTaskFieldInjectionThreadSafety">相应章节</a>了解更多信息。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="taskListeners">8.5.14. 任务监听器</h4>
<div class="paragraph">
<p><em>任务监听器（task listener）</em>用于在特定的任务相关事件发生时，执行自定义的Java逻辑或表达式。</p>
</div>
<div class="paragraph">
<p>任务监听器只能在流程定义中作为<a href="#bpmnUserTask">用户任务</a>的子元素。请注意，任务监听器是一个Flowable自定义结构，因此也需要作为<em>BPMN 2.0 extensionElements</em>，放在<em>flowable</em>命名空间下。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My Task&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:taskListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;create&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.MyTaskCreateListener&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>任务监听器</em>包含下列属性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>event（事件）</strong>（必填）：触发任务监听器的任务事件类型。可用的事件有：</p>
<div class="ulist">
<ul>
<li>
<p><strong>create（创建）</strong>：当任务已经创建，并且<strong>所有任务参数都已经设置</strong>时触发。</p>
</li>
<li>
<p><strong>assignment（指派）</strong>：当任务已经指派给某人时触发。请注意：当流程执行到达用户任务时，在触发<em>create</em>事件<strong>之前</strong>，会首先触发<em>assignment</em>事件。这顺序看起来不太自然，但是有实际原因的：当收到<em>create</em>事件时，我们通常希望能看到任务的所有参数，包括办理人。</p>
</li>
<li>
<p><strong>complete（完成）</strong>：当任务已经完成，从运行时数据中删除前触发。</p>
</li>
<li>
<p><strong>delete（删除）</strong>：在任务即将被删除前触发。请注意任务由completeTask正常完成时也会触发。</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>class</strong>：需要调用的委托类。这个类必须实现<code>org.flowable.engine.delegate.TaskListener</code>接口。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyTaskCreateListener</span> <span class="tok-kd">implements</span> <span class="tok-n">TaskListener</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">notify</span><span class="tok-o">(</span><span class="tok-n">DelegateTask</span> <span class="tok-n">delegateTask</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-c1">// 这里是要实现的业务逻辑</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用<a href="#serviceTaskFieldInjection">字段注入</a>，为委托类传递流程变量或执行。请注意委托类的实例在流程部署时创建（与Flowable中其它的委托类一样），这意味着该实例会在所有流程实例执行中共享。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>expression</strong>：（不能与<em>class</em>属性一起使用）：指定在事件发生时要执行的表达式。可以为被调用的对象传递<code>DelegateTask</code>对象与事件名（使用<code>task.eventName</code>）作为参数。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-o">&lt;</span><span class="tok-n">flowable</span><span class="tok-o">:</span><span class="tok-n">taskListener</span> <span class="tok-n">event</span><span class="tok-o">=</span><span class="tok-s">&quot;create&quot;</span> <span class="tok-n">expression</span><span class="tok-o">=</span><span class="tok-s">&quot;${myObject.callMethod(task, task.eventName)}&quot;</span> <span class="tok-o">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>delegateExpression</strong>：指定一个能够解析为<code>TaskListener</code>接口实现类的对象的表达式。<a href="#bpmnJavaServiceTaskXML">与服务任务类似</a>。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;flowable:taskListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;create&quot;</span> <span class="tok-na">delegateExpression=</span><span class="tok-s">&quot;${myTaskListenerBean}&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>较早之前，我们也引入了新的执行监听器类型，org.flowable.engine.impl.bpmn.listener.ScriptTaskListener。这个脚本任务监听器可以为一个任务监听器事件执行一段脚本代码。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-nt">&lt;flowable:taskListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;complete&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.bpmn.listener.ScriptTaskListener&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;script&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;flowable:string&gt;</span>
      def bar = &quot;BAR&quot;;  // 局部变量
      foo = &quot;FOO&quot;; // 将变量放入执行上下文
      task.setOwner(&quot;kermit&quot;); // 测试访问任务实例
      bar // 隐式返回值
    <span class="tok-nt">&lt;/flowable:string&gt;</span>
  <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;language&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;groovy&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resultVariable&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;myVar&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/flowable:taskListener&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnMultiInstance">8.5.15. 多实例（for each）</h4>
<div class="sect4">
<h5 id="bpmnMultiInstanceDescription">描述</h5>
<div class="paragraph">
<p><em>多实例活动（multi-instance activity）</em>是在业务流程中，为特定步骤定义重复的方式。在编程概念中，多实例类似<strong>for each</strong>结构：可以为给定集合中的每一条目，<strong>顺序或并行地</strong>，执行特定步骤，甚至是整个子流程。</p>
</div>
<div class="paragraph">
<p><em>多实例</em>是一个普通活动，加上定义（被称作“<em>多实例</em>特性的”）额外参数，会使得活动在运行时被多次执行。下列活动可以成为<em>多实例活动：</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#bpmnUserTask">用户任务</a></p>
</li>
<li>
<p><a href="#bpmnScriptTask">脚本任务</a></p>
</li>
<li>
<p><a href="#bpmnJavaServiceTask">Java服务任务</a></p>
</li>
<li>
<p><a href="#bpmnWebserviceTask">Web服务任务</a></p>
</li>
<li>
<p><a href="#bpmnBusinessRuleTask">业务规则任务</a></p>
</li>
<li>
<p><a href="#bpmnEmailTask">邮件任务</a></p>
</li>
<li>
<p><a href="#bpmnManualTask">人工任务</a></p>
</li>
<li>
<p><a href="#bpmnReceiveTask">接收任务</a></p>
</li>
<li>
<p><a href="#bpmnSubProcess">（嵌入式）子流程</a></p>
</li>
<li>
<p><a href="#bpmnCallActivity">调用活动</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#bpmnGateways">网关</a>与<a href="#bpmnEvents">事件</a><strong>不能</strong>设置为多实例。</p>
</div>
<div class="paragraph">
<p>按照BPMN2.0规范的要求，用于为每个实例创建执行的父执行，会提供下列变量：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>nrOfInstances</strong>：实例总数。</p>
</li>
<li>
<p><strong>nrOfActiveInstances</strong>：当前活动的（即未完成的），实例数量。对于顺序多实例，这个值总为1。</p>
</li>
<li>
<p><strong>nrOfCompletedInstances</strong>：已完成的实例数量。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>可以调用<code>execution.getVariable(x)</code>方法获取这些值。</p>
</div>
<div class="paragraph">
<p>另外，每个被创建的执行，都有局部变量（对其他执行不可见，也不存储在流程实例级别）：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>loopCounter</strong>：给定实例在<em>for-each循环中的index</em>。可以通过Flowable的<strong>elementIndexVariable</strong>属性为loopCounter变量重命名。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="bpmnMultiInstanceGraphicalNotation">图示</h5>
<div class="paragraph">
<p>如果一个活动是多实例，将通过在该活动底部的三条短线表示。三条<em>竖</em>线代表实例会并行执行，而三条<em>横</em>线代表顺序执行。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.multi.instance.png" alt="bpmn.multi.instance">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnMultiInstanceXml">XML表示</h5>
<div class="paragraph">
<p>要将活动变成多实例，该活动的XML元素必须有<code>multiInstanceLoopCharacteristics</code>子元素</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;multiInstanceLoopCharacteristics</span> <span class="tok-na">isSequential=</span><span class="tok-s">&quot;false|true&quot;</span><span class="tok-nt">&gt;</span>
 ...
<span class="tok-nt">&lt;/multiInstanceLoopCharacteristics&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>isSequential</strong>属性代表了活动的实例为顺序还是并行执行。</p>
</div>
<div class="paragraph">
<p>实例的数量<strong>在进入活动时，计算一次</strong>。有几种不同方法可以配置数量。一个方法是通过<strong>loopCardinality</strong>子元素，直接指定数字。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;multiInstanceLoopCharacteristics</span> <span class="tok-na">isSequential=</span><span class="tok-s">&quot;false|true&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;loopCardinality&gt;</span>5<span class="tok-nt">&lt;/loopCardinality&gt;</span>
<span class="tok-nt">&lt;/multiInstanceLoopCharacteristics&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用解析为正整数的表达式：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;multiInstanceLoopCharacteristics</span> <span class="tok-na">isSequential=</span><span class="tok-s">&quot;false|true&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;loopCardinality&gt;</span>${nrOfOrders-nrOfCancellations}<span class="tok-nt">&lt;/loopCardinality&gt;</span>
<span class="tok-nt">&lt;/multiInstanceLoopCharacteristics&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>另一个定义实例数量的方法，是使用<code>loopDataInputRef</code>子元素，指定一个集合型流程变量的名字。对集合中的每一项，都会创建一个实例。可以使用<code>inputDataItem</code>子元素，将该项设置给该实例的局部变量。在下面的XML示例中展示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;miTasks&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My Task ${loopCounter}&quot;</span> <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;${assignee}&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;multiInstanceLoopCharacteristics</span> <span class="tok-na">isSequential=</span><span class="tok-s">&quot;false&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;loopDataInputRef&gt;</span>assigneeList<span class="tok-nt">&lt;/loopDataInputRef&gt;</span>
    <span class="tok-nt">&lt;inputDataItem</span> <span class="tok-na">name=</span><span class="tok-s">&quot;assignee&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/multiInstanceLoopCharacteristics&gt;</span>
<span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>假设变量<code>assigneeList</code>包含<code>[kermit, gonzo, fozzie]</code>。上面的代码会创建三个并行的用户任务。每一个执行都有一个名为<code>assignee</code>的（局部）流程变量，含有集合中的一项，并在这个例子中被用于指派用户任务。</p>
</div>
<div class="paragraph">
<p><code>loopDataInputRef</code>与<code>inputDataItem</code>的缺点是名字很难记，并且由于BPMN 2.0概要的限制，不能使用表达式。Flowable通过在<code>multiInstanceCharacteristics</code>上提供<strong>collection</strong>与<strong>elementVariable</strong>属性解决了这些问题：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;miTasks&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My Task&quot;</span> <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;${assignee}&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;multiInstanceLoopCharacteristics</span> <span class="tok-na">isSequential=</span><span class="tok-s">&quot;true&quot;</span>
     <span class="tok-na">flowable:collection=</span><span class="tok-s">&quot;${myService.resolveUsersForTask()}&quot;</span> <span class="tok-na">flowable:elementVariable=</span><span class="tok-s">&quot;assignee&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;/multiInstanceLoopCharacteristics&gt;</span>
<span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意<code>collection</code>属性会作为表达式进行解析。如果表达式解析为字符串而不是一个集合，不论是因为本身配置的就是静态字符串值，还是表达式计算结果为字符串，这个字符串都会被当做变量名，在流程变量中用于获取实际的集合。</p>
</div>
<div class="paragraph">
<p>例如，下面的代码片段会要求集合存储在<code>assigneeList</code>流程变量中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;miTasks&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My Task&quot;</span> <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;${assignee}&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;multiInstanceLoopCharacteristics</span> <span class="tok-na">isSequential=</span><span class="tok-s">&quot;true&quot;</span>
     <span class="tok-na">flowable:collection=</span><span class="tok-s">&quot;assigneeList&quot;</span> <span class="tok-na">flowable:elementVariable=</span><span class="tok-s">&quot;assignee&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;/multiInstanceLoopCharacteristics&gt;</span>
<span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>假如<code>myService.getCollectionVariableName()</code>返回字符串值，引擎就会用这个值作为变量名，获取流程变量保存的集合。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;miTasks&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My Task&quot;</span> <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;${assignee}&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;multiInstanceLoopCharacteristics</span> <span class="tok-na">isSequential=</span><span class="tok-s">&quot;true&quot;</span>
     <span class="tok-na">flowable:collection=</span><span class="tok-s">&quot;${myService.getCollectionVariableName()}&quot;</span> <span class="tok-na">flowable:elementVariable=</span><span class="tok-s">&quot;assignee&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;/multiInstanceLoopCharacteristics&gt;</span>
<span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>多实例活动在所有实例都完成时结束。然而，也可以指定一个表达式，在每个实例结束时进行计算。当表达式计算为true时，将销毁所有剩余的实例，并结束多实例活动，继续执行流程。这个表达式必须通过<strong>completionCondition</strong>子元素定义。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;miTasks&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;My Task&quot;</span> <span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;${assignee}&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;multiInstanceLoopCharacteristics</span> <span class="tok-na">isSequential=</span><span class="tok-s">&quot;false&quot;</span>
     <span class="tok-na">flowable:collection=</span><span class="tok-s">&quot;assigneeList&quot;</span> <span class="tok-na">flowable:elementVariable=</span><span class="tok-s">&quot;assignee&quot;</span> <span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;completionCondition&gt;</span>${nrOfCompletedInstances/nrOfInstances &gt;= 0.6 }<span class="tok-nt">&lt;/completionCondition&gt;</span>
  <span class="tok-nt">&lt;/multiInstanceLoopCharacteristics&gt;</span>
<span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子里，会为<code>assigneeList</code>集合中的每个元素创建并行实例。当60%的任务完成时，其他的任务将被删除，流程继续运行。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnMultiInstanceBoundaryEvent">边界事件与多实例</h5>
<div class="paragraph">
<p>多实例是普通活动，因此可以在其边界定义<a href="#bpmnBoundaryEvent">边界事件</a>。如果是中断边界事件，当其捕获事件时，会销毁活动中的<strong>所有实例</strong>。以下面的多实例子流程为例：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.multi.instance.boundary.event.png" alt="bpmn.multi.instance.boundary.event">
</div>
</div>
<div class="paragraph">
<p>当定时器触发时，子流程的所有实例都会被销毁，无论有多少实例，或者实例的内部活动是否完成。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCompensationHandlers">多实例与执行监听器</h5>
<div class="paragraph">
<p>执行监听器与多实例一起使用时需要特别注意。以下面的BPMN 2.0 XML代码片段为例。这段XML定义在与<em>multiInstanceLoopCharacteristics</em> XML元素相同的级别：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:executionListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.MyStartListener&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:executionListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.MyEndListener&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/extensionElements&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>对于普通的BPMN活动，会在活动开始与结束时调用一次监听器。</p>
</div>
<div class="paragraph">
<p>但是当该活动为多实例时，行为有区别：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>当进入多实例活动时，在任何<em>内部</em>活动执行前，抛出一个启动事件。<em>loopCounter</em>变量还未设置（为null）。</p>
</li>
<li>
<p>进入每个实际执行的活动时，抛出一个启动事件。<em>loopCounter</em>变量已经设置。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>结束事件类似：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>离开每个实际执行的活动后，抛出一个结束事件。<em>loopCounter</em>变量已经设置。</p>
</li>
<li>
<p>多实例活动整体完成后，抛出一个结束事件。<em>loopCounter</em>变量未设置。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-nt">&lt;subProcess</span> <span class="tok-na">id=</span><span class="tok-s">&quot;subprocess1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Sub Process&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:executionListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.MyStartListener&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:executionListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.MyEndListener&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
  <span class="tok-nt">&lt;multiInstanceLoopCharacteristics</span> <span class="tok-na">isSequential=</span><span class="tok-s">&quot;false&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;loopDataInputRef&gt;</span>assignees<span class="tok-nt">&lt;/loopDataInputRef&gt;</span>
    <span class="tok-nt">&lt;inputDataItem</span> <span class="tok-na">name=</span><span class="tok-s">&quot;assignee&quot;</span><span class="tok-nt">&gt;&lt;/inputDataItem&gt;</span>
  <span class="tok-nt">&lt;/multiInstanceLoopCharacteristics&gt;</span>
  <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;startevent2&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Start&quot;</span><span class="tok-nt">&gt;&lt;/startEvent&gt;</span>
  <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;endevent2&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;End&quot;</span><span class="tok-nt">&gt;&lt;/endEvent&gt;</span>
  <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow3&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;startevent2&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;endevent2&quot;</span><span class="tok-nt">&gt;&lt;/sequenceFlow&gt;</span>
<span class="tok-nt">&lt;/subProcess&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子中，假设<em>assignees</em>有三项。在运行时会发生如下事情：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>多实例整体抛出一个启动事件。调用一次<em>start</em>执行监听器，<em>loopCounter</em>与<em>assignee</em>变量均未设置（即为null）。</p>
</li>
<li>
<p>每一个活动实例抛出一个启动事件。调用三次<em>start</em>执行监听器，<em>loopCounter</em>与<em>assignee</em>变量均已设置（也就是说不为null）。</p>
</li>
<li>
<p>因此启动执行监听器总共被调用四次。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意，即使<em>multiInstanceLoopCharacteristics</em>不是定义在子流程上，也是一样。例如，如果上面的例子中只是一个简单的用户任务，抛出事件的行为也是一样。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compensation_handlers">8.5.16. 补偿处理器</h4>
<div class="sect4">
<h5 id="bpmnCompensationHandlerDescription">描述</h5>
<div class="paragraph">
<p>如果要使用一个活动补偿另一个活动的影响，可以将其声明为<em>补偿处理器（compensation handler）</em>。补偿处理器不在正常流程中执行，而只在流程抛出补偿事件时才会执行。</p>
</div>
<div class="paragraph">
<p>补偿处理器不得有入口或出口顺序流。</p>
</div>
<div class="paragraph">
<p>补偿处理器必须通过单向的连接，关联一个补偿边界事件。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCompensationHandlerGraphicalNotation">图示</h5>
<div class="paragraph">
<p>如果一个活动是补偿处理器，则会在其下部中间显示补偿事件图标。下面摘录的流程图展示了一个带有补偿边界事件的服务任务，并关联至一个补偿处理器。请注意补偿处理器图标显示在"cancel hotel reservation（取消酒店预订）"服务任务的下部中间。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.boundary.compensation.event.png" alt="bpmn.boundary.compensation.event">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCompensationHandlerXml">XML表示</h5>
<div class="paragraph">
<p>要将一个活动声明为补偿处理器，需要将<code>isForCompensation</code>属性设置为true：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;undoBookHotel&quot;</span> <span class="tok-na">isForCompensation=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;...&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bpmnSubprocessAndCallActivity">8.6. 子流程与调用活动</h3>
<div class="sect3">
<h4 id="bpmnSubProcess">8.6.1. 子流程</h4>
<div class="sect4">
<h5 id="bpmnSubProcessDescription">描述</h5>
<div class="paragraph">
<p><em>子流程（sub-process）</em>是包含其他的活动、网关、事件等的活动。其本身构成一个流程，并作为更大流程的一部分。<em>子流程</em>完全在父流程中定义（这就是为什么经常被称作<em>嵌入式</em>子流程）。</p>
</div>
<div class="paragraph">
<p>子流程有两个主要的使用场景：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>子流程可以<strong>分层建模</strong>。很多建模工具都可以<em>折叠</em>子流程，隐藏子流程的所有细节，而只显示业务流程的高层端到端总览。</p>
</li>
<li>
<p>子流程会创建新的<strong>事件范围</strong>。在子流程执行中抛出的事件可以通过子流程边界上的<a href="#bpmnBoundaryEvent">边界事件</a>捕获，为该事件创建了限制在子流程内的范围。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>使用子流程也要注意以下几点：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>子流程只能有<strong>一个空启动事件</strong>，而不允许有其他类型的启动事件。请注意BPMN 2.0规范允许省略子流程的启动与结束事件，但目前Flowable的实现尚不支持省略。</p>
</li>
<li>
<p><strong>顺序流不能跨越子流程边界。</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="bpmnSubProcessGraphicalNotation">图示</h5>
<div class="paragraph">
<p>子流程表示为标准活动(圆角矩形)。若<em>折叠</em>了子流程，则只显示其名字与一个加号，以展示流程的高层概览：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.collapsed.subprocess.png" alt="bpmn.collapsed.subprocess">
</div>
</div>
<div class="paragraph">
<p>若<em>展开</em>了子流程，则在子流程内显示子流程的所有步骤：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.expanded.subprocess.png" alt="bpmn.expanded.subprocess">
</div>
</div>
<div class="paragraph">
<p>使用子流程的一个主要原因是为事件定义范围。下面的流程模型展示了这种用法：<em>investigate software（调查硬件）/investigate hardware（调查软件）</em>两个任务需要并行执行，且需要在给定时限内，在<em>Level 2 support（二级支持）</em>响应前完成。在这里，定时器的范围（即需要按时完成的活动）通过子流程进行限制。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.subprocess.with.boundary.timer.png" alt="bpmn.subprocess.with.boundary.timer">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnSubProcessXML">XML表示</h5>
<div class="paragraph">
<p>子流程通过<em>subprocess</em>元素定义。子流程中的所有活动、网关、事件等，都需要定义在这个元素内。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-nt">&lt;subProcess</span> <span class="tok-na">id=</span><span class="tok-s">&quot;subProcess&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;subProcessStart&quot;</span> <span class="tok-nt">/&gt;</span>

  ... 其他子流程元素 ...

  <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;subProcessEnd&quot;</span> <span class="tok-nt">/&gt;</span>

 <span class="tok-nt">&lt;/subProcess&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnEventSubprocess">8.6.2. 事件子流程</h4>
<div class="sect4">
<h5 id="bpmnEventSubprocessDescription">描述</h5>
<div class="paragraph">
<p>事件子流程（event sub-process）是BPMN 2.0新定义的。事件子流程是通过事件触发的子流程。可以在流程级别，或者任何子流程级别，添加事件子流程。用于触发事件子流程的事件，使用启动事件进行配置。因此可知，不能在事件子流程中使用空启动事件。事件子流程可以通过消息事件、错误事件、信号时间、定时器事件或补偿事件等触发。在事件子流程的宿主范围（流程实例或子流程）创建时，创建对启动事件的订阅。当该范围销毁时，删除订阅。</p>
</div>
<div class="paragraph">
<p>事件子流程可以是中断或不中断的。中断的子流程将取消当前范围内的任何执行。非中断的事件子流程将创建新的并行执行。宿主范围内的每个活动，只能触发一个中断事件子流程，而非中断事件子流程可以多次触发。子流程是否是中断的，通过触发事件子流程的启动事件配置。</p>
</div>
<div class="paragraph">
<p>事件子流程不能有任何入口或出口顺序流。事件子流程是由事件触发的，因此入口顺序流不合逻辑。当事件子流程结束时，要么同时结束当前范围（中断事件子流程的情况），要么是非中断子流程创建的并行执行结束。</p>
</div>
<div class="paragraph">
<p><strong>目前的限制：</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Flowable支持错误、定时器、信号与消息启动事件触发事件子流程。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="bpmnEventSubprocessGraphicalNotation">图示</h5>
<div class="paragraph">
<p>事件子流程表示为点线边框的<a href="#bpmnSubProcessGraphicalNotation">嵌入式子流程</a>。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.subprocess.eventSubprocess.png" alt="bpmn.subprocess.eventSubprocess">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnEventSubprocessXMLRepresentation">XML表示</h5>
<div class="paragraph">
<p>事件子流程的XML表示形式与嵌入式子流程相同。但需要将<code>triggeredByEvent</code>属性设置为<code>true</code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;subProcess</span> <span class="tok-na">id=</span><span class="tok-s">&quot;eventSubProcess&quot;</span> <span class="tok-na">triggeredByEvent=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">&gt;</span>
	...
<span class="tok-nt">&lt;/subProcess&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnEventSubprocessExample">示例</h5>
<div class="paragraph">
<p>下面是使用错误启动事件触发事件子流程的例子。该事件子流程处于“流程级别”，即流程实例的范围：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.subprocess.eventSubprocess.example.1.png" alt="bpmn.subprocess.eventSubprocess.example.1">
</div>
</div>
<div class="paragraph">
<p>事件子流程在XML中是这样的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;subProcess</span> <span class="tok-na">id=</span><span class="tok-s">&quot;eventSubProcess&quot;</span> <span class="tok-na">triggeredByEvent=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;catchError&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;errorEventDefinition</span> <span class="tok-na">errorRef=</span><span class="tok-s">&quot;error&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/startEvent&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;catchError&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;taskAfterErrorCatch&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;taskAfterErrorCatch&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Provide additional data&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/subProcess&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>前面已经指出，事件子流程也可以添加到嵌入式子流程内。若添加到嵌入式子流程内，可以代替边界事件的功能。例如在下面两个流程图中，嵌入式子流程都抛出错误事件。错误事件都被捕获，并由用户任务处理。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.subprocess.eventSubprocess.example.2a.png" alt="bpmn.subprocess.eventSubprocess.example.2a">
</div>
</div>
<div class="paragraph">
<p>对比：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.subprocess.eventSubprocess.example.2b.png" alt="bpmn.subprocess.eventSubprocess.example.2b">
</div>
</div>
<div class="paragraph">
<p>两种情况下都执行相同的任务。然而，两种模型有如下不同：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>嵌入式（事件）子流程使用其宿主范围的执行来执行。这意味着嵌入式（事件）子流程可以访问其范围的局部变量。当使用边界事件时，执行嵌入式子流程的执行，会被边界事件的出口顺序流删除。意味着嵌入式子流程创建的变量将不再可用。</p>
</li>
<li>
<p>使用事件子流程时，事件完全由其所在的子流程处理。当使用边界事件时，事件由其父流程处理。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这两点可以帮助你判断哪种方式更适合解决特定的流程建模或实现问题，以选择使用边界事件还是嵌入式（事件）子流程。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnTransactionSubprocess">8.6.3. 事务子流程</h4>
<div class="sect4">
<h5 id="_description_2">描述</h5>
<div class="paragraph">
<p>事务子流程（transaction sub-process）是一种嵌入式子流程，用于将多个活动组织在一个事务里。事务是工作的逻辑单元，可以组织一组独立活动，使得它们可以一起成功或失败。</p>
</div>
<div class="paragraph">
<p><strong>事务的可能结果：</strong>事务有三种不同的结果：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>若未被取消，或被意外终止，则事务<em>成功(successful)</em>。若事务子流程成功，将使用出口顺序流离开。若流程后面抛出了补偿事件，成功的事务可以被补偿。<em>请注意：</em>与“普通”嵌入式子流程一样，可以使用补偿抛出中间事件，在事务成功完成后补偿。</p>
</li>
<li>
<p>若执行到达取消结束事件时，事务被<em>取消(canceled)</em>。在这种情况下，所有执行都将被终止并移除。只会保留一个执行，设置为取消边界事件，并将触发补偿。在补偿完成后，事务子流程通过取消边界事件的出口顺序流离开。</p>
</li>
<li>
<p>若由于抛出了错误结束事件，且未被事务子流程所在的范围捕获，则事务会被<em>意外(hazard)</em>终止。错误被事件子流程的边界捕获也一样。在这种情况下，不会进行补偿。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>下面的流程图展示这三种不同的结果：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.transaction.subprocess.example.1.png" alt="bpmn.transaction.subprocess.example.1">
</div>
</div>
<div class="paragraph">
<p><strong>与ACID事务的关系：</strong>要注意不要将BPMN事务子流程与技术（ACID）事务混淆。BPMN事务子流程不是划分技术事务范围的方法。要理解Acitivit中的事务管理，请阅读<a href="#bpmnConcurrencyAndTransactions">并发与事务</a>章节。BPMN事务与ACID事务有如下区别：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ACID事务生存期一般比较短，而BPMN事务可以持续几小时，几天甚至几个月才完成。考虑一个场景：事务包括的活动中有一个用户任务。通常人的响应时间要比程序长。或者，在另一个场景下，BPMN事务可能等待某些业务事件发生，像是特定订单的填写完成。这些操作通常要比更新数据库字段、使用事务队列存储消息等，花长得多的时间完成。</p>
</li>
<li>
<p>不可能将业务活动的持续时间限定为ACID事务的范围，因此一个BPMN事务通常会生成多个ACID事务。</p>
</li>
<li>
<p>一个BPMN事务可以生成多个ACID事务，也就不能使用ACID特性。例如，考虑上面的流程例子。假设"book hotel（预订酒店）"与"charge credit card（信用卡付款）"操作在分开的ACID事务中处理。再假设"book hotel（预订酒店）"活动已经成功。这时，因为已经进行了预订酒店操作，而还没有进行信用卡扣款，就处在中间不一致状态（intermediary inconsistent state）。在ACID事务中，会顺序进行不同的操作，因此也处在中间不一致状态。在这里不一样的是，不一致状态在事务范围外可见。例如，如果通过外部预订服务进行预定，则使用该预订服务的其他部分将能看到酒店已被预订。这意味着，当使用业务事务时，完全不会使用隔离参数（的确，当使用ACID事务时，我们通常也会降低隔离级别，以保证高并发级别。但ACID事务可以细粒度地进行控制，而中间不一致状态也只会存在于一小段时间内）。</p>
</li>
<li>
<p>BPMN业务事务不使用传统方式回滚。这是因为它生成多个ACID事务，在BPMN事务取消时，部分ACID事务可能已经提交。这样它们没法回滚。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>因为BPMN事务天生需要长时间运行，因此就需要使用不同的方式缺乏隔离与回滚机制造成的问题。在实际使用中，通常只能通过领域特定（domain specific）的方式解决这些问题：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>通过补偿实现回滚。如果在事务范围内抛出了取消事件，就补偿所有成功执行并带有补偿处理器的活动所造成的影响。</p>
</li>
<li>
<p>缺乏隔离通常使用特定领域的解决方案来处理。例如，在上面的例子里，在我们确定第一个客户可以付款前，一个酒店房间可能被第二个客户预定。这可能不满足业务预期，因此预订服务可能会选择允许一定量的超量预定。</p>
</li>
<li>
<p>另外，由于事务可以由于意外而终止，预订服务需要处理这种情况，比如酒店房间已经预定，但从未付款（因为事务可能已经终止）。在这种情况下，预定服务可能选择这种策略：一个酒店房间有最大预留时间，若到时还未付款，则取消预订。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>总结一下：尽管ACID事务提供了对回滚、隔离级别，与启发式结果（heuristic outcomes）等问题的通用解决方案，但仍然需要在实现业务事务时，为这些问题寻找特定领域的解决方案。</p>
</div>
<div class="paragraph">
<p><strong>目前的限制：</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>BPMN规范要求，流程引擎响应底层事务协议提交的事务。如果在底层协议中发生了取消事件，则取消事务。作为嵌入式的引擎，Flowable当前不支持这点。查看下面介绍一致性的段落，了解其后果。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>基于ACID事务与乐观锁（optimistic concurrency）的一致性：</strong>BPMN事务在如下情况保证一致性：所有活动都成功完成；或若部分活动不能执行，则所有已完成活动都被补偿。两种方法都可以达到最终一致性状态。然而需要了解的是：Flowable中BPMN事务的一致性模型，以流程执行的一致性模型为基础。Flowable以事务的方式执行流程，并通过乐观锁标记处理并发。在Flowable中，BPMN的错误、取消与补偿事件，都建立在相同的ACID事务与乐观锁之上。例如，只有在实际到达时，取消结束事件才能触发补偿。如果服务任务抛出了非受检异常，导致并未实际到达取消结束事件；或者，由于底层ACID事务中的其他操作，将事务设置为rollback-only（回滚）状态，导致补偿处理器的操作不能提交；或者，当两个并行执行到达一个取消结束事件时，补偿会被两次触发，并由于乐观锁异常而失败。这些情况下都不能真正完成补偿。想说明的是，当在Flowable中实现BPMN事务时，与实施“普通”流程与子流程，需要遵守相同的规则。因此实现流程时需要有效地保证一致性，需要将乐观锁、事务执行模型纳入考虑范围。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnTransactionSubprocessGraphicalNotation">图示</h5>
<div class="paragraph">
<p>事务子流程表示为带有两层边框的<a href="#bpmnSubProcessGraphicalNotation">嵌入式子流程</a>。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.transaction.subprocess.png" alt="bpmn.transaction.subprocess">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnTransactionSubprocessXMLRepresentation">XML表示</h5>
<div class="paragraph">
<p>事务子流程在XML中通过<code>transaction</code>标签表示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;transaction</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myTransaction&quot;</span> <span class="tok-nt">&gt;</span>
	...
<span class="tok-nt">&lt;/transaction&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnTransactionSubprocessExample">示例</h5>
<div class="paragraph">
<p>下面是一个事务子流程的例子：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.transaction.subprocess.example.2.png" alt="bpmn.transaction.subprocess.example.2">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bpmnCallActivity">8.6.4. 调用活动（子流程）</h4>
<div class="sect4">
<h5 id="bpmnCallActivityDescription">描述</h5>
<div class="paragraph">
<p>尽管看起来很相像，但在BPMN 2.0中，调用活动（call activity）有别于一般的<em><a href="#bpmnSubProcess">子流程</a></em>——通常也称作<em>嵌入式子流程</em>。从概念上说，两者都在流程执行到达该活动时，调用一个子流程。</p>
</div>
<div class="paragraph">
<p>两者的区别为，调用活动引用一个流程定义外部的流程，而<em><a href="#bpmnSubProcess">子流程</a></em>嵌入在原有流程定义内。调用活动的主要使用场景是，在多个不同流程定义中调用一个可复用的流程定义。</p>
</div>
<div class="paragraph">
<p>当流程执行到达<em>调用活动</em>时，会创建一个新的执行，作为到达调用活动的执行的子执行。这个子执行用于执行子流程，也可用于创建并行子执行（与普通流程中行为类似）。父执行将等待子流程完成，之后沿原流程继续执行。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCallActivityGraphicalNotation">图示</h5>
<div class="paragraph">
<p>调用过程表现为带有粗边框（折叠与展开都是）的<a href="#bpmnSubProcessGraphicalNotation">子流程</a>。取决于建模工具，调用过程可以展开，但默认表现为折叠形式。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.collapsed.call.activity.png" alt="bpmn.collapsed.call.activity">
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCallActivityXMLRepresentation">XML表示</h5>
<div class="paragraph">
<p>调用活动是一个普通活动，在<em>calledElement</em>中通过<strong>key</strong>引用流程定义。在实际使用中，通常在<em>calledElement</em>中配置<strong>流程的ID</strong>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;callActivity</span> <span class="tok-na">id=</span><span class="tok-s">&quot;callCheckCreditProcess&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Check credit&quot;</span> <span class="tok-na">calledElement=</span><span class="tok-s">&quot;checkCreditProcess&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意子流程的流程定义<strong>在运行时解析</strong>。这意味着如果需要的话，子流程可以与调用流程分别部署。</p>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCallActivityPassVariables">传递变量</h5>
<div class="paragraph">
<p>可以向子流程传递与接收流程变量。数据将在子流程启动时复制到子流程，并在其结束时复制回主流程。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-nt">&lt;callActivity</span> <span class="tok-na">id=</span><span class="tok-s">&quot;callSubProcess&quot;</span> <span class="tok-na">calledElement=</span><span class="tok-s">&quot;checkCreditProcess&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;extensionElements&gt;</span>
        <span class="tok-nt">&lt;flowable:in</span> <span class="tok-na">source=</span><span class="tok-s">&quot;someVariableInMainProcess&quot;</span>
            <span class="tok-na">target=</span><span class="tok-s">&quot;nameOfVariableInSubProcess&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;flowable:out</span> <span class="tok-na">source=</span><span class="tok-s">&quot;someVariableInSubProcess&quot;</span>
            <span class="tok-na">target=</span><span class="tok-s">&quot;nameOfVariableInMainProcess&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/callActivity&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以将<code>inheritVariables</code>设置为true，将所有流程变量传递给子流程。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;callActivity</span> <span class="tok-na">id=</span><span class="tok-s">&quot;callSubProcess&quot;</span> <span class="tok-na">calledElement=</span><span class="tok-s">&quot;checkCreditProcess&quot;</span> <span class="tok-na">flowable:inheritVariables=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>除了需要按照BPMN 2.0标准的方式声明流程变量的BPMN标准元素<em>dataInputAssociation</em>与<em>dataOutputAssociation</em>之外，
Flowable还提供了扩展作为快捷方式。</p>
</div>
<div class="paragraph">
<p>也可以在这里使用表达式：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;callActivity</span> <span class="tok-na">id=</span><span class="tok-s">&quot;callSubProcess&quot;</span> <span class="tok-na">calledElement=</span><span class="tok-s">&quot;checkCreditProcess&quot;</span> <span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;extensionElements&gt;</span>
        <span class="tok-nt">&lt;flowable:in</span> <span class="tok-na">sourceExpression=</span><span class="tok-s">&quot;${x+5}&quot;</span> <span class="tok-na">target=</span><span class="tok-s">&quot;y&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;flowable:out</span> <span class="tok-na">source=</span><span class="tok-s">&quot;${y+5}&quot;</span> <span class="tok-na">target=</span><span class="tok-s">&quot;z&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/callActivity&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>因此最终 z = y+5 = x+5+5 。</p>
</div>
<div class="paragraph">
<p>调用活动元素还提供了一个自定义Flowable属性扩展，<em>businessKey</em>，用于设置子流程实例的businessKey。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;callActivity id="callSubProcess" calledElement="checkCreditProcess" flowable:businessKey="${myVariable}"&gt;
...
&lt;/callActivity&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>将<em>inheritBusinessKey</em>属性设置为<code>true</code>，会将子流程的businessKey值设置为调用流程的businessKey的值。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;callActivity id="callSubProcess" calledElement="checkCreditProcess" flowable:inheritBusinessKey="true"&gt;
...
&lt;/callActivity&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bpmnCallActivityExample">引用同一部署中的流程</h5>
<div class="paragraph">
<p>默认会使用引用流程最后部署的流程定义版本。但有的时候也会想引用与主流程一起部署的引用流程定义。这需要将主流程与引用流程放在同一个部署单元中，以便引用相同的部署。</p>
</div>
<div class="paragraph">
<p>在<code>callActivity</code>元素中，将<code>sameDeployment</code>属性设置为<code>true</code>，即可引用相同部署的流程。</p>
</div>
<div class="paragraph">
<p>如下例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;callActivity id="callSubProcess" calledElement="checkCreditProcess" flowable:sameDeployment="true"&gt;
...
&lt;/callActivity&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><code>sameDeployment</code>默认值为false。</p>
</div>
</div>
<div class="sect4">
<h5 id="_example">示例</h5>
<div class="paragraph">
<p>下面的流程图展示了简单的订单处理流程。因为检查客户的信用额度的操作在许多其他流程中都通用，因此将<em>check credit step（检查信用额度步骤）</em>建模为调用活动。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.call.activity.super.process.png" alt="bpmn.call.activity.super.process">
</div>
</div>
<div class="paragraph">
<p>流程像是下面这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;theStart&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;receiveOrder&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;manualTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;receiveOrder&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Receive Order&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;receiveOrder&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;callCheckCreditProcess&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;callActivity</span> <span class="tok-na">id=</span><span class="tok-s">&quot;callCheckCreditProcess&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Check credit&quot;</span> <span class="tok-na">calledElement=</span><span class="tok-s">&quot;checkCreditProcess&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow3&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;callCheckCreditProcess&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;prepareAndShipTask&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;prepareAndShipTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Prepare and Ship&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;flow4&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;prepareAndShipTask&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;end&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>子流程像是下面这样：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.call.activity.sub.process.png" alt="bpmn.call.activity.sub.process">
</div>
</div>
<div class="paragraph">
<p>与子流程的流程定义相比没什么特别。但调用活动的流程也可以不通过其他流程调用而直接使用。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bpmnConcurrencyAndTransactions">8.7. 事务与并发</h3>
<div class="sect3">
<h4 id="asyncContinuations">8.7.1. 异步延续</h4>
<div class="paragraph">
<p>（Asynchronous Continuations）</p>
</div>
<div class="paragraph">
<p>Flowable以事务方式执行流程，并可按照你的需求配置。让我们从Flowable一般如何为事务划分范围开始介绍。如果Flowable被触发（启动流程，完成任务，为执行发送信号），Flowable将沿流程执行，直到到达每个执行路径的等待状态。更具体地说，它以深度优先方式搜索流程图，并在每个执行分支都到达等待状态时返回。等待状态是“之后”再执行的任务，也就是说着Flowable将当前执行持久化，并等待再次触发。触发可以来自外部来源如用户任务或消息接受任务，也可以来自Flowable自身如定时器事件。以下面的图片说明：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/async.example.no.async.PNG" alt="async.example.no.async">
</div>
</div>
<div class="paragraph">
<p>这是一个BPMN流程的片段，有一个用户任务、一个服务任务，与一个定时器事件。用户任务的完成操作与验证地址（validate address）在同一个工作单元内，因此需要原子性地（atomically）成功或失败。这意味着如果服务任务抛出了异常，我们会想要回滚当前事务，以便执行返回到用户任务，并希望用户任务仍然保存在数据库中。这也是Flowable的默认行为。在（1）中，应用或客户端线程完成任务。在相同的线程中，Flowable执行服务并继续，直到到达等待状态，在这个例子中，是定时器事件（2）。然后将控制权返回至调用者（3），同时提交事务（如果事务由Flowable开启）。</p>
</div>
<div class="paragraph">
<p>在有的情况下，我们不想要这样。有时我们需要在流程中自定义地控制事务边界，以便为工作的逻辑单元划分范围。这就需要使用异步延续。考虑下面的流程（片段）：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/async.example.async.PNG" alt="async.example.async">
</div>
</div>
<div class="paragraph">
<p>完成用户任务，生成发票，并将发票发送给客户。这次发票的生成不再是同一个工作单元的一部分，因此我们不希望当发票生成失败时，回滚用户任务。所以我们希望Flowable做的，是完成用户任务（1），提交事务，并将控制权返回给调用程序。然后我们希望在后台线程中，异步地生成发票。这个后台线程就是Flowable作业执行器（事实上是一个线程池），它周期性地将作业保存至数据库。因此在幕后，当到达"generate invoice（生成发票）"任务时，Flowable会创建“消息”作业并将其持久化到数据库中，用于继续执行流程。这个作业之后会被作业执行器选中并执行。Flowable也会向本地的作业执行器进行提示，告知其有新作业到来，以提升性能。</p>
</div>
<div class="paragraph">
<p>要使用这个特性，可以使用<em>flowable:async="true"</em>扩展。因此，一个示例的服务任务会像是这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;service1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Generate Invoice&quot;</span>
    <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;my.custom.Delegate&quot;</span>
    <span class="tok-na">flowable:async=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以为下列BPMN任务类型指定<em>flowable:async</em>：任务，服务任务，脚本任务，业务规则任务，发送任务，接收任务，用户任务，子流程，调用活动。</p>
</div>
<div class="paragraph">
<p>对于用户任务、接收任务与其他等待状态来说，异步操作允许我们在一个独立的线程/事务中启动执行监听器。</p>
</div>
</div>
<div class="sect3">
<h4 id="failRetry">8.7.2. 失败重试</h4>
<div class="paragraph">
<p>默认配置下，如果作业执行中有任何异常，Flowable将三次重试执行作业。对异步作业也是这样。需要更灵活的配置时可以使用这两个参数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>重试的次数</p>
</li>
<li>
<p>重试的间隔</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这两个参数可以通过<code>flowable:failedJobRetryTimeCycle</code>元素配置。这有一个简单的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;failingServiceTask&quot;</span> <span class="tok-na">flowable:async=</span><span class="tok-s">&quot;true&quot;</span>
    <span class="tok-na">flowable:class=</span><span class="tok-s">&quot;org.flowable.engine.test.jobexecutor.RetryFailingDelegate&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;extensionElements&gt;</span>
        <span class="tok-nt">&lt;flowable:failedJobRetryTimeCycle&gt;</span>R5/PT7M<span class="tok-nt">&lt;/flowable:failedJobRetryTimeCycle&gt;</span>
    <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>时间周期表达式与定时器事件表达式一样遵循ISO 8601标准。上面的例子会让作业执行器重试5次，并在每次重试前等待7分钟。</p>
</div>
</div>
<div class="sect3">
<h4 id="exclusiveJobs">8.7.3. 排他作业</h4>
<div class="paragraph">
<p>从近期版本开始，JobExecutor确保同一个流程实例的作业永远不会并发执行。为什么这样？</p>
</div>
<div class="sect4">
<h5 id="_why_exclusive_jobs">为什么使用排他作业？</h5>
<div class="paragraph">
<p>考虑下面的流程定义：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/bpmn.why.exclusive.jobs.png" alt="bpmn.why.exclusive.jobs">
</div>
</div>
<div class="paragraph">
<p>一个并行网关，之后是三个服务任务，都使用异步操作执行。其结果是在数据库中添加了三个作业。当作业储存在数据库后，就由JobExecutor处理。JobExecutor获取作业，并将其委托至工作线程的线程池，由它们实际执行作业。这意味着通过使用异步操作，可以将工作分发至线程池（在集群场景下，甚至会在集群中跨越多个线程池）。通常这都是好事。但也有其固有问题：一致性。考虑服务任务后的并行合并：当服务任务的执行完成时到达并行合并，并需要决定等待其他执行，还是需要继续向前。这意味着，对于每一个到达并行合并的分支，都需要选择继续执行，还是需要等待其他分支上的一个或多个其他执行。</p>
</div>
<div class="paragraph">
<p>为什么这是问题呢？这是因为服务任务配置为使用异步延续，有可能所有相应的作业都同时被作业执行器处理，并委托至不同的工作线程。结果是服务执行的事务，与到达并行合并的3个独立执行所在的事务会发生重叠。如果这样，每一个独立事务都“看不到”其他事物已经并发地到达了同样的并行合并，并因此判断自己需要等待其他事务。然而，如果每个事务都判断需要等待其他事务，在并行合并后不会有继续流程的事务，而流程实例也就会永远保持这个状态。</p>
</div>
<div class="paragraph">
<p>Flowable如何解决这个问题呢？Flowable使用乐观锁。每当需要基于数据进行判断，而数据可能不是最新值（因为其他事务可能在我们提交前修改了这个数据）时，我们确保会在每个事务中都增加同一个数据库记录行的版本号。这样，无论哪个事务第一个提交，都将成功，而其他的会抛出乐观锁异常并失败。这样就解决了上面流程中讨论的问题：如果多个执行并发到达并行合并，它们都判断需要等待，增加其父执行（流程实例）的版本号并尝试提交。无论哪个执行第一个提交，都可以成功提交，而其他的将会抛出乐观锁异常并失败。因为这些执行由作业触发，Flowable会在等待给定时间后，重试执行相同的作业，期望这一次通过这个同步的网关。</p>
</div>
<div class="paragraph">
<p>这是好的解决方案么？我们可以看到乐观锁使Flowable避免不一致状态。它确保了我们不会“在合并网关卡住”，也就是说：要么所有的执行都通过网关，要么数据库中的作业能确保可以重试通过它。然而，尽管这是一个持久化与一致性角度的完美解决方案，但从更高层次看，仍然不一定总是理想行为：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Flowable只会为同一个作业重试一个固定的最大次数（默认配置为<em>3</em>次）。在这之后，作业仍然保存在数据库中，但不会再重试。这就需要手动操作来触发作业。</p>
</li>
<li>
<p>如果一个作业有非事务性的副作用，则副作用将不会由于事务失败而回滚。例如，如果"book concert tickets（预定音乐会门票）"服务与Flowable不在同一个事务中，则重试执行作业将预定多张票。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_what_are_exclusive_jobs">什么是排他作业？</h5>
<div class="paragraph">
<p>排他作业不能与同一个流程实例中的其他排他作业同时执行。考虑上面展示的流程：如果我们将服务任务都声明为排他的，则JobExecutor将确保相关的作业都不会并发执行。相反，它将确保不论何时从特定流程实例中获取了排他作业，都会从同一个流程实例中获取所有其他的排他作业，并将它们委托至同一个工作线程。这保证了作业的顺序执行。</p>
</div>
<div class="paragraph">
<p>如何启用这个特性？从近期版本开始，排他作业成为默认配置。所有异步操作与定时器事件都默认为排他的。另外，如果希望作业成为非排他的，可以使用<code>flowable:exclusive="false"</code>配置。例如，下面的服务任务是异步，但非排他的。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;service&quot;</span> <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;${myService.performBooking(hotel, dates)}&quot;</span>
    <span class="tok-na">flowable:async=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">flowable:exclusive=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这是好的解决方案么？有很多人都在问这个问题。他们的顾虑是，这将阻止并行操作，因此会有性能问题。但也需要考虑以下两点：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果你是专家，并且知道你在做什么（并理解“为什么排他作业？”章节的内容），可以关掉排他。否则，对大多数用户来说，异步操作与定时器能够正常工作才更重要。</p>
</li>
<li>
<p>事实上不会有性能问题。只有在重负载下才会有性能问题。重负载意味着作业执行器的所有的工作线程都一直忙碌。对于排他作业，Flowable会简单的根据负载不同进行分配。排他作业意味着同一个流程实例的作业都将在同一个线程中顺序执行。但是请想一下：我们有不止一个流程实例。其他流程实例的作业将被委托至其他线程，并与本实例的作业并发执行。也就是说Flowable不会并发执行同一个流程实例的排他作业，但会并发执行多个实例。从总吞吐量角度来看，可以期望大多数场景下都可以保证实例很快地完成。此外，执行同一个流程实例中下一个作业所需的数据，已经缓存在同一个执行集群节点中。如果作业与节点没有关联关系，则可能需要重新从数据库中获取数据。</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="security">8.8. 流程启动认证</h3>
<div class="paragraph">
<p>默认情况下，任何人都可以启动已部署流程定义的新流程实例。可以使用流程启动认证功能定义用户与组，让Web客户端可以选择性的限制能够启动新流程实例的用户。请注意Flowable引擎<strong>不会</strong>用任何方式验证认证定义。这个功能只是为了开发人员可以简化Web客户端认证规则的实现。语法与为用户任务指派用户的语法类似：可以使用&lt;flowable:potentialStarter&gt;标签，将用户或组指派为流程的潜在启动者。这里有一个例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;potentialStarter&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:potentialStarter&gt;</span>
       <span class="tok-nt">&lt;resourceAssignmentExpression&gt;</span>
         <span class="tok-nt">&lt;formalExpression&gt;</span>group2, group(group3), user(user3)<span class="tok-nt">&lt;/formalExpression&gt;</span>
       <span class="tok-nt">&lt;/resourceAssignmentExpression&gt;</span>
    <span class="tok-nt">&lt;/flowable:potentialStarter&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>

  <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;theStart&quot;</span><span class="tok-nt">/&gt;</span>
  ...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的XML中，<em>user(user3)</em>直接引用用户<em>user3</em>，而<em>group(group3)</em>引用组<em>group3</em>。不显式标明的话，默认为组。也可以使用&lt;process&gt;标签提供的&lt;flowable:candidateStarterUsers&gt;与&lt;flowable:candidateStarterGroups&gt;的属性。这里有一个例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;potentialStarter&quot;</span> <span class="tok-na">flowable:candidateStarterUsers=</span><span class="tok-s">&quot;user1, user2&quot;</span>
    <span class="tok-na">flowable:candidateStarterGroups=</span><span class="tok-s">&quot;group1&quot;</span><span class="tok-nt">&gt;</span>
    ...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这些属性可以同时使用。</p>
</div>
<div class="paragraph">
<p>在流程启动认证定义后，开发者可以使用下列方法获取该认证定义。
这段代码获取可以由给定用户启动的流程定义列表：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">processDefinitions</span> <span class="tok-o">=</span> <span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">createProcessDefinitionQuery</span><span class="tok-o">().</span><span class="tok-na">startableByUser</span><span class="tok-o">(</span><span class="tok-s">&quot;userxxx&quot;</span><span class="tok-o">).</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以获取给定流程定义中，所有定义为潜在启动者的身份关联</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">identityLinks</span> <span class="tok-o">=</span> <span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">getIdentityLinksForProcessDefinition</span><span class="tok-o">(</span><span class="tok-s">&quot;processDefinitionId&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>下面的例子展示了如何获取能够启动给定流程的用户列表：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">User</span><span class="tok-o">&gt;</span> <span class="tok-n">authorizedUsers</span> <span class="tok-o">=</span> <span class="tok-n">identityService</span><span class="tok-o">().</span><span class="tok-na">createUserQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">potentialStarter</span><span class="tok-o">(</span><span class="tok-s">&quot;processDefinitionId&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>用完全相同的方法，可以获取配置为给定流程定义的潜在启动者的组列表：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Group</span><span class="tok-o">&gt;</span> <span class="tok-n">authorizedGroups</span> <span class="tok-o">=</span> <span class="tok-n">identityService</span><span class="tok-o">().</span><span class="tok-na">createGroupQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">potentialStarter</span><span class="tok-o">(</span><span class="tok-s">&quot;processDefinitionId&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dataobjects">8.9. 数据对象</h3>
<div class="paragraph">
<p>BPMN提供了将数据对象定义为流程或子流程元素的一部分的可能性。根据BPMN规范，数据对象可以包含复杂的XML结构，并可以从XSD定义中引入。下列XSD类型为Flowable支持的第一批数据对象：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;dataObject</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dObj1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;StringTest&quot;</span> <span class="tok-na">itemSubjectRef=</span><span class="tok-s">&quot;xsd:string&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;dataObject</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dObj2&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;BooleanTest&quot;</span> <span class="tok-na">itemSubjectRef=</span><span class="tok-s">&quot;xsd:boolean&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;dataObject</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dObj3&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;DateTest&quot;</span> <span class="tok-na">itemSubjectRef=</span><span class="tok-s">&quot;xsd:datetime&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;dataObject</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dObj4&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;DoubleTest&quot;</span> <span class="tok-na">itemSubjectRef=</span><span class="tok-s">&quot;xsd:double&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;dataObject</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dObj5&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;IntegerTest&quot;</span> <span class="tok-na">itemSubjectRef=</span><span class="tok-s">&quot;xsd:int&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;dataObject</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dObj6&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;LongTest&quot;</span> <span class="tok-na">itemSubjectRef=</span><span class="tok-s">&quot;xsd:long&quot;</span><span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>数据对象定义使用<em>name</em>属性值作为新变量的名字，将其自动转换为流程变量。另外，Flowable也提供了为变量设置默认值的扩展元素。下面的BPMN代码片段示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dataObjectScope&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Data Object Scope&quot;</span> <span class="tok-na">isExecutable=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;dataObject</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dObj123&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;StringTest123&quot;</span> <span class="tok-na">itemSubjectRef=</span><span class="tok-s">&quot;xsd:string&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;extensionElements&gt;</span>
      <span class="tok-nt">&lt;flowable:value&gt;</span>Testing123<span class="tok-nt">&lt;/flowable:value&gt;</span>
    <span class="tok-nt">&lt;/extensionElements&gt;</span>
  <span class="tok-nt">&lt;/dataObject&gt;</span>
  ...
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="forms">9. 表单</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Flowable提供了一种简便灵活的方式，用来为业务流程中的人工步骤添加表单。
有两种使用表单的方法：使用（由表单设计器创建的）表单定义的内置表单渲染，以及外部表单渲染。
使用外部表单渲染时，可以使用（自Explorer web应用V5版本支持的）表单参数；也可以使用表单key定义，引用外部的、使用自定义代码解析的表单。</p>
</div>
<div class="sect2">
<h3 id="formDefinition">9.1. 表单定义</h3>
<div class="paragraph">
<p><a href="http://flowable.org/docs/userguide-form/">表单引擎用户手册</a>中提供了关于表单定义与Flowable表单引擎的完整信息。
可以使用Flowable表单设计器创建表单定义。表单设计器是Flowable Modeler web应用的一部分。也可以直接使用JSON编辑器创建表单定义。
表单引擎用户手册中介绍了表单定义JSON的完整结构。表单支持下列表单字段类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Text: 渲染为文本框</p>
</li>
<li>
<p>Multiline text: 渲染为多行文本框</p>
</li>
<li>
<p>Number: 渲染为只允许数字值的文本框</p>
</li>
<li>
<p>CheckBox: 渲染为复选框</p>
</li>
<li>
<p>Date: 渲染为日期框</p>
</li>
<li>
<p>Dropdown: 渲染为下拉选择框，候选值由字段定义配置</p>
</li>
<li>
<p>Radio buttons: 渲染为单选按钮，候选值由字段定义配置</p>
</li>
<li>
<p>People: 渲染为选人框，可以选择用户身份表中的用户</p>
</li>
<li>
<p>Group of people: 渲染为选组框，可以选择组身份表中的组</p>
</li>
<li>
<p>Upload: 渲染为上传框</p>
</li>
<li>
<p>Expression: 渲染为一个标签，可以在标签文字中使用JUEL表达式，以使用变量及/或其他动态值</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Flowable Task应用可以用表单定义JSON渲染出html表单。
也可以使用Flowable API，自行获取表单定义JSON。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">FormModel</span> <span class="tok-n">RuntimeService</span><span class="tok-o">.</span><span class="tok-na">getStartFormModel</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">processDefinitionId</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">processInstanceId</span><span class="tok-o">)</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>或</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">FormModel</span> <span class="tok-n">TaskService</span><span class="tok-o">.</span><span class="tok-na">getTaskFormModel</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">taskId</span><span class="tok-o">)</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>FormModel对象是一个代表了表单定义JSON的Java对象。</p>
</div>
<div class="paragraph">
<p>可以调用下列API，使用启动表单定义以启动流程实例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">ProcessInstance</span> <span class="tok-n">RuntimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceWithForm</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">processDefinitionId</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">outcome</span><span class="tok-o">,</span>
    <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">variables</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">processInstanceName</span><span class="tok-o">)</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果在流程定义的（某一个或多个）启动事件上定义了表单定义，则可以使用这个方法，使用启动表单中填写的值启动流程实例。
Flowable Task应用使用同样的方法，用表单启动流程实例。
通过变量map传入所有需要的表单值，也可以指定表单输出字符串及流程实例名。</p>
</div>
<div class="paragraph">
<p>类似的，可以调用下列API，使用表单完成用户任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-kt">void</span> <span class="tok-n">TaskService</span><span class="tok-o">.</span><span class="tok-na">completeTaskWithForm</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">taskId</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">formDefinitionId</span><span class="tok-o">,</span>
    <span class="tok-n">String</span> <span class="tok-n">outcome</span><span class="tok-o">,</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">variables</span><span class="tok-o">)</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>再次强调，要获取关于表单定义的更多信息，请查看<a href="http://flowable.org/docs/userguide-form/">表单引擎用户手册</a>。</p>
</div>
</div>
<div class="sect2">
<h3 id="formProperties">9.2. 表单参数</h3>
<div class="paragraph">
<p>所有与业务流程相关的信息，要么包含在流程变量里，要么可以通过流程变量引用。Flowable也支持将复杂的Java对象，以<code>Serializable</code>对象、JPA实体，或整个XML文档存储为<code>String</code>等方式，存储为流程变量。</p>
</div>
<div class="paragraph">
<p>启动流程与完成用户任务是用户参与流程的地方，所以需要使用UI界面渲染表单。为了简化UI设计，可以在流程定义中，将流程变量中的复杂的Java对象转换为<code>Map&lt;String,String&gt;</code>格式的<strong><em>参数</em></strong>。</p>
</div>
<div class="paragraph">
<p>这样UI就可以使用Flowable API方法，在这些参数的基础上构建表单。这些参数可看做是专用（也更受限）的流程变量视图。可以使用<strong>FormData</strong>返回值，获取用于显示表单的参数。如</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">StartFormData</span> <span class="tok-n">FormService</span><span class="tok-o">.</span><span class="tok-na">getStartFormData</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">processDefinitionId</span><span class="tok-o">)</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>或</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">TaskFormData</span> <span class="tok-n">FormService</span><span class="tok-o">.</span><span class="tok-na">getTaskFormData</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">taskId</span><span class="tok-o">)</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>默认情况下，内建表单引擎能够“看到”参数与流程变量。因此如果任务表单参数一对一对应流程变量，则不需要专门进行声明。例如，对于如下声明：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当执行到达startEvent时，所有流程变量都可用。但</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">formService</span><span class="tok-o">.</span><span class="tok-na">getStartFormData</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">processDefinitionId</span><span class="tok-o">).</span><span class="tok-na">getFormProperties</span><span class="tok-o">()</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>将为空，因为并未指定映射。</p>
</div>
<div class="paragraph">
<p>在上面的例子中，所有提交的参数都存储为流程变量。也就是说，只要简单地在表单中添加输入框，就可以存储新变量。</p>
</div>
<div class="paragraph">
<p>参数从流程变量衍生而来，但并不是必须存储为流程变量。例如，流程变量可以是Address类的JPA实体。而UI使用的<code>StreetName</code>表单参数，则通过<code>#{address.street}</code>表达式获取。</p>
</div>
<div class="paragraph">
<p>类似的，表单中用户需要提交的参数，可以存储为流程变量，也可以使用UEL值表达式，保存至某个流程变量的参数。如<code>#{address.street}</code>。</p>
</div>
<div class="paragraph">
<p>除非使用<code>formProperty</code>声明，否则提交参数时，默认将其存储为流程变量。</p>
</div>
<div class="paragraph">
<p>在表单参数与流程变量的处理过程中，也可以进行类型转换。</p>
</div>
<div class="paragraph">
<p>例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;task&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:formProperty</span> <span class="tok-na">id=</span><span class="tok-s">&quot;room&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:formProperty</span> <span class="tok-na">id=</span><span class="tok-s">&quot;duration&quot;</span> <span class="tok-na">type=</span><span class="tok-s">&quot;long&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:formProperty</span> <span class="tok-na">id=</span><span class="tok-s">&quot;speaker&quot;</span> <span class="tok-na">variable=</span><span class="tok-s">&quot;SpeakerName&quot;</span> <span class="tok-na">writable=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:formProperty</span> <span class="tok-na">id=</span><span class="tok-s">&quot;street&quot;</span> <span class="tok-na">expression=</span><span class="tok-s">&quot;#{address.street}&quot;</span> <span class="tok-na">required=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>room</code>表单参数将作为String，映射为<code>room</code>流程变量</p>
</li>
<li>
<p><code>duration</code>表单参数将作为java.lang.Long，映射为<code>duration</code>流程变量</p>
</li>
<li>
<p><code>speaker</code>表单参数将被映射为<code>SpeakerName</code>流程变量。将只在TaskFormData对象中可用。若提交了speaker参数，将抛出FlowableException。对应地，使用<code>readable="false"</code>属性，参数可以提交，但不会在FormData中提供。</p>
</li>
<li>
<p><code>street</code>表单参数将作为String，映射为<code>address</code>流程变量的Java bean参数<code>street</code>。如果在提交时没有提供这个字段，required="true"将抛出异常。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>StartFormData FormService.getStartFormData(String processDefinitionId)</code>与<code>TaskFormdata FormService.getTaskFormData(String taskId)</code>方法返回的FormData同样提供类型元数据。</p>
</div>
<div class="paragraph">
<p>支持下列表单参数类型：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>string</code> (org.flowable.engine.impl.form.StringFormType</p>
</li>
<li>
<p><code>long</code> (org.flowable.engine.impl.form.LongFormType)</p>
</li>
<li>
<p><code>double</code> (org.flowable.engine.impl.form.DoubleFormType)</p>
</li>
<li>
<p><code>enum</code> (org.flowable.engine.impl.form.EnumFormType)</p>
</li>
<li>
<p><code>date</code> (org.flowable.engine.impl.form.DateFormType)</p>
</li>
<li>
<p><code>boolean</code> (org.flowable.engine.impl.form.BooleanFormType)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>可以通过<code>List&lt;FormProperty&gt; formService.getStartFormData(String processDefinitionId).getFormProperties()</code>与<code>List&lt;FormProperty&gt; formService.getTaskFormData(String taskId).getFormProperties()</code>方法，获取每个表单参数的下列<code>FormProperty</code>信息：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">FormProperty</span> <span class="tok-o">{</span>
  <span class="tok-cm">/**</span>
<span class="tok-cm">   * 在{@link FormService#submitStartFormData(String, java.util.Map)}</span>
<span class="tok-cm">   * 或{@link FormService#submitTaskFormData(String, java.util.Map)}</span>
<span class="tok-cm">   * 中提交参数时使用的key</span>
<span class="tok-cm">   */</span>
  <span class="tok-n">String</span> <span class="tok-nf">getId</span><span class="tok-o">();</span>

  <span class="tok-cm">/** 显示标签 */</span>
  <span class="tok-n">String</span> <span class="tok-nf">getName</span><span class="tok-o">();</span>

  <span class="tok-cm">/** 在本接口中定义的类型，例如{@link #TYPE_STRING} */</span>
  <span class="tok-n">FormType</span> <span class="tok-nf">getType</span><span class="tok-o">();</span>

  <span class="tok-cm">/** 可选。这个参数需要显示的值 */</span>
  <span class="tok-n">String</span> <span class="tok-nf">getValue</span><span class="tok-o">();</span>

  <span class="tok-cm">/** 这个参数是否可以读取：在表单中显示，并可通过</span>
<span class="tok-cm">   * {@link FormService#getStartFormData(String)}</span>
<span class="tok-cm">   * 与{@link FormService#getTaskFormData(String)}</span>
<span class="tok-cm">   * 方法访问。</span>
<span class="tok-cm">   */</span>
  <span class="tok-kt">boolean</span> <span class="tok-nf">isReadable</span><span class="tok-o">();</span>

  <span class="tok-cm">/** 用户提交表单时是否可以包含这个参数？ */</span>
  <span class="tok-kt">boolean</span> <span class="tok-nf">isWritable</span><span class="tok-o">();</span>

  <span class="tok-cm">/** 输入框中是否必填这个参数 */</span>
  <span class="tok-kt">boolean</span> <span class="tok-nf">isRequired</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&quot;start&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:formProperty</span> <span class="tok-na">id=</span><span class="tok-s">&quot;speaker&quot;</span>
      <span class="tok-na">name=</span><span class="tok-s">&quot;Speaker&quot;</span>
      <span class="tok-na">variable=</span><span class="tok-s">&quot;SpeakerName&quot;</span>
      <span class="tok-na">type=</span><span class="tok-s">&quot;string&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;flowable:formProperty</span> <span class="tok-na">id=</span><span class="tok-s">&quot;start&quot;</span>
      <span class="tok-na">type=</span><span class="tok-s">&quot;date&quot;</span>
      <span class="tok-na">datePattern=</span><span class="tok-s">&quot;dd-MMM-yyyy&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;flowable:formProperty</span> <span class="tok-na">id=</span><span class="tok-s">&quot;direction&quot;</span> <span class="tok-na">type=</span><span class="tok-s">&quot;enum&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;flowable:value</span> <span class="tok-na">id=</span><span class="tok-s">&quot;left&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Go Left&quot;</span> <span class="tok-nt">/&gt;</span>
      <span class="tok-nt">&lt;flowable:value</span> <span class="tok-na">id=</span><span class="tok-s">&quot;right&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Go Right&quot;</span> <span class="tok-nt">/&gt;</span>
      <span class="tok-nt">&lt;flowable:value</span> <span class="tok-na">id=</span><span class="tok-s">&quot;up&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Go Up&quot;</span> <span class="tok-nt">/&gt;</span>
      <span class="tok-nt">&lt;flowable:value</span> <span class="tok-na">id=</span><span class="tok-s">&quot;down&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Go Down&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/flowable:formProperty&gt;</span>

  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/startEvent&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>所有这些信息都可以通过API获取：用<code>formProperty.getType().getName()</code>获取类型名、<code>formProperty.getType().getInformation("datePattern")</code>获取日期格式、<code>formProperty.getType().getInformation("values")</code>获取枚举值。</p>
</div>
<div class="paragraph">
<p>下面的XML代码片段</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;startEvent&gt;</span>
  <span class="tok-nt">&lt;extensionElements&gt;</span>
    <span class="tok-nt">&lt;flowable:formProperty</span> <span class="tok-na">id=</span><span class="tok-s">&quot;numberOfDays&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Number of days&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;${numberOfDays}&quot;</span> <span class="tok-na">type=</span><span class="tok-s">&quot;long&quot;</span> <span class="tok-na">required=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:formProperty</span> <span class="tok-na">id=</span><span class="tok-s">&quot;startDate&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;First day of holiday (dd-MM-yyy)&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;${startDate}&quot;</span> <span class="tok-na">datePattern=</span><span class="tok-s">&quot;dd-MM-yyyy hh:mm&quot;</span> <span class="tok-na">type=</span><span class="tok-s">&quot;date&quot;</span> <span class="tok-na">required=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;flowable:formProperty</span> <span class="tok-na">id=</span><span class="tok-s">&quot;vacationMotivation&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Motivation&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;${vacationMotivation}&quot;</span> <span class="tok-na">type=</span><span class="tok-s">&quot;string&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/userTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以在自定义应用中用于渲染流程启动表单。</p>
</div>
</div>
<div class="sect2">
<h3 id="externalFormRendering">9.3. 外部表单渲染</h3>
<div class="paragraph">
<p>也可以使用API，在Flowable引擎之外，自行渲染任务表单。下面的步骤介绍在自行渲染任务表单时，可以使用的钩子。</p>
</div>
<div class="paragraph">
<p>实际上，渲染表单所需的所有数据都组装在：<code>StartFormData FormService.getStartFormData(String processDefinitionId)</code>与<code>TaskFormdata FormService.getTaskFormData(String taskId)</code>这两个方法中。</p>
</div>
<div class="paragraph">
<p>可以通过<code>ProcessInstance FormService.submitStartFormData(String processDefinitionId, Map&lt;String,String&gt; properties)</code>与<code>void FormService.submitTaskFormData(String taskId, Map&lt;String,String&gt; properties)</code>提交表单参数。</p>
</div>
<div class="paragraph">
<p>查看<a href="#formProperties">表单参数</a>了解如何将表单参数映射至流程变量。</p>
</div>
<div class="paragraph">
<p>如果希望按版本将表单与流程存储在一起，可以将表单模板资源放在部署的业务存档中，并可以使用<code>String ProcessDefinition.getDeploymentId()</code>与<code>InputStream RepositoryService.getResourceAsStream(String deploymentId, String resourceName);</code>，作为部署中的资源获取，在你的应用中渲染/显示表单。</p>
</div>
<div class="paragraph">
<p>除了任务表单之外，也可以获取其他部署资源。</p>
</div>
<div class="paragraph">
<p><code>String FormService.getStartFormData(String processDefinitionId).getFormKey()</code>与<code>String FormService.getTaskFormData(String taskId).getFormKey()</code>API提供<code>&lt;userTask flowable:formKey="&#8230;&#8203;"</code>属性。可以用它保存部署中模板的全名（如<code>org/flowable/example/form/my-custom-form.xml</code>），但这并非唯一选择。例如，也可以在formKey中保存通用的key，通过算法或转换得到实际需要使用的模板。在你需要在不同的UI界面渲染不同的表单时很方便。例如，在普通屏幕尺寸的Web应用中显示一个表单，在手机等小屏幕中显示另一个表单。甚至可以为IM表单或邮件表单提供专门的模板。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jpa">10. JPA</h2>
<div class="sectionbody">
<div class="paragraph">
<p>（Java Persistence API Java持久化API）</p>
</div>
<div class="paragraph">
<p>可以使用JPA实体作为流程变量，这样可以：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用流程变量更新已有的JPA实体。流程变量可以在用户任务的表单中填写，或者通过服务任务生成。</p>
</li>
<li>
<p>重用已有的领域模型，而不需要写专门的服务用于读取与更新实体。</p>
</li>
<li>
<p>基于已有实体做决策（网关）。</p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_requirements">10.1. 需求</h3>
<div class="paragraph">
<p>只支持完全满足下列条件的实体：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>实体需要使用JPA注解配置，字段与参数访问器都可以。也可以使用映射的父类。</p>
</li>
<li>
<p>实体需要有使用<code>@Id</code>注解的主键，不支持复合主键（<code>@EmbeddedId</code>与<code>@IdClass</code>）。Id字段/参数可以是任何JPA规范支持的类型：原生类型与其包装器（除了boolean）、<code>String</code>、<code>BigInteger</code>、<code>BigDecimal</code>、<code>java.util.Date</code>与<code>java.sql.Date</code>。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="jpaconfiguration">10.2. 配置</h3>
<div class="paragraph">
<p>引擎必须引用<code>EntityManagerFactory</code>才能使用JPA实体，可以配置引用，或者配置持久化单元名（Persistence Unit Name）。引擎会自动检测用作变量的JPA实体，并按需处理。</p>
</div>
<div class="paragraph">
<p>下面的示例配置使用jpaPersistenceUnitName：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span>
  <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneInMemProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>

<span class="tok-c">&lt;!-- 数据库配置 --&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUrl&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:JpaVariableTest;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jpaPersistenceUnitName&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;flowable-jpa-pu&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jpaHandleTransaction&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jpaCloseEntityManager&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-c">&lt;!-- 作业执行器配置 --&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;asyncExecutorActivate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>

<span class="tok-c">&lt;!-- 邮件服务器配置 --&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;mailServerPort&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;5025&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>下面的示例配置使用自定义的<code>EntityManagerFactory</code>（open-jpa实体管理器）。请注意这段代码只包含了与本例相关的bean，而省略了其他的bean。使用open-jpa实体管理器的完整可用示例，可以在flowable-spring-examples (<code>/flowable-spring/src/test/java/org/flowable/spring/test/jpa/JPASpringTest.java</code>)中找到。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;entityManagerFactory&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;persistenceUnitManager&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;pum&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jpaVendorAdapter&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.springframework.orm.jpa.vendor.OpenJpaVendorAdapter&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databasePlatform&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.apache.openjpa.jdbc.sql.H2Dictionary&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/bean&gt;</span>
  <span class="tok-nt">&lt;/property&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.spring.SpringProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jpaEntityManagerFactory&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;entityManagerFactory&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jpaHandleTransaction&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jpaCloseEntityManager&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;asyncExecutorActivate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用相同的配置，以编程方式构建引擎。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">ProcessEngine</span> <span class="tok-n">processEngine</span> <span class="tok-o">=</span> <span class="tok-n">ProcessEngineConfiguration</span>
    <span class="tok-o">.</span><span class="tok-na">createProcessEngineConfigurationFromResourceDefault</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">setJpaPersistenceUnitName</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable-pu&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">buildProcessEngine</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>配置参数：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>jpaPersistenceUnitName</code>：要使用的持久化单元的名字。（需要确保该持久化单元在classpath中可用。根据规范，默认位置为<code>/META-INF/persistence.xml</code>）。<code>jpaEntityManagerFactory</code>与<code>jpaPersistenceUnitName</code>二选一。</p>
</li>
<li>
<p><code>jpaEntityManagerFactory</code>：用于载入实体及刷入更新的，实现<code>javax.persistence.EntityManagerFactory</code>的bean。<em>jpaEntityManagerFactory</em>与<em>jpaPersistenceUnitName</em>二选一。</p>
</li>
<li>
<p><code>jpaHandleTransaction</code>：标示是否需要由引擎负责开启及提交/回滚<em>EntityManager</em>上的事务。当使用<em>Java Transaction API (JTA)</em>时，需设置为false。</p>
</li>
<li>
<p><code>jpaCloseEntityManager</code>：标示是否需要由引擎负责关闭从<code>EntityManagerFactory</code>获取的<code>EntityManager</code>实例。当<em>EntityManager</em>由容器管理时（例如，使用扩展持久化上下文 Extended Persistence Context，而不将实体范围限制为单一事务时）需设置为false。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_usage">10.3. 使用</h3>
<div class="sect3">
<h4 id="_simple_example">10.3.1. 简单示例</h4>
<div class="paragraph">
<p>可以在Flowable源代码的JPAVariableTest中找到使用JPA变量的例子。下面逐步解释<code>JPAVariableTest.testUpdateJPAEntityValues</code>。</p>
</div>
<div class="paragraph">
<p>首先，基于<code>META-INF/persistence.xml</code>为持久化单元创建<em>EntityManagerFactory</em>。包括需要包含在持久化单元内的类及一些（数据库）厂商特定配置。</p>
</div>
<div class="paragraph">
<p>在这个测试里使用的是简单实体，包括id以及一个<code>String</code>值参数。在运行测试前，先创建一个实体并保存。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</div></td><td class="code"><span></span><span class="tok-nd">@Entity</span><span class="tok-o">(</span><span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-s">&quot;JPA_ENTITY_FIELD&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">FieldAccessJPAEntity</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Id</span>
  <span class="tok-nd">@Column</span><span class="tok-o">(</span><span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-s">&quot;ID_&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">private</span> <span class="tok-n">Long</span> <span class="tok-n">id</span><span class="tok-o">;</span>

  <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">;</span>

  <span class="tok-kd">public</span> <span class="tok-nf">FieldAccessJPAEntity</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-c1">// JPA需要的空构造方法</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-n">Long</span> <span class="tok-nf">getId</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">id</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setId</span><span class="tok-o">(</span><span class="tok-n">Long</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">id</span> <span class="tok-o">=</span> <span class="tok-n">id</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getValue</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">value</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setValue</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">value</span> <span class="tok-o">=</span> <span class="tok-n">value</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>启动一个新的流程实例，将这个实体加入变量。与其他变量一样，它们都会在引擎中持久化存储。当下一次请求这个变量时，将会根据类及Id，从<code>EntityManager</code>载入。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">variables</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">HashMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;();</span>
<span class="tok-n">variables</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;entityToUpdate&quot;</span><span class="tok-o">,</span> <span class="tok-n">entityToUpdate</span><span class="tok-o">);</span>

<span class="tok-n">ProcessInstance</span> <span class="tok-n">processInstance</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">startProcessInstanceByKey</span><span class="tok-o">(</span>
    <span class="tok-s">&quot;UpdateJPAValuesProcess&quot;</span><span class="tok-o">,</span> <span class="tok-n">variables</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>流程定义的第一个节点是<code>服务任务</code>，将调用<code>entityToUpdate</code>上的<code>setValue</code>方法。<code>entityToUpdate</code>将解析为之前启动流程实例时设置的JPA变量，并使用当前引擎的上下文中关联的<code>EntityManager</code>载入。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&#39;theTask&#39;</span> <span class="tok-na">name=</span><span class="tok-s">&#39;updateJPAEntityTask&#39;</span>
  <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;${entityToUpdate.setValue(&#39;updatedValue&#39;)}&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>当服务任务完成时，流程实例在流程定义中的用户任务处等待，以便我们可以查看流程实例。在这时，<code>EntityManager</code>已经刷入，对实体的修改也已经存入数据库。当获取<code>entityToUpdate</code>变量的值时，将重新载入实体。所以可以得到<code>value</code>参数设置为<code>updatedValue</code>的实体。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-c1">// 流程&#39;UpdateJPAValuesProcess&#39;中的服务任务已经设置了entityToUpdate的值。</span>
<span class="tok-n">Object</span> <span class="tok-n">updatedEntity</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">getVariable</span><span class="tok-o">(</span><span class="tok-n">processInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">(),</span> <span class="tok-s">&quot;entityToUpdate&quot;</span><span class="tok-o">);</span>
<span class="tok-n">assertTrue</span><span class="tok-o">(</span><span class="tok-n">updatedEntity</span> <span class="tok-k">instanceof</span> <span class="tok-n">FieldAccessJPAEntity</span><span class="tok-o">);</span>
<span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;updatedValue&quot;</span><span class="tok-o">,</span> <span class="tok-o">((</span><span class="tok-n">FieldAccessJPAEntity</span><span class="tok-o">)</span><span class="tok-n">updatedEntity</span><span class="tok-o">).</span><span class="tok-na">getValue</span><span class="tok-o">());</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_query_jpa_process_variables">10.3.2. 查询JPA流程变量</h4>
<div class="paragraph">
<p>可以查询以特定JPA实体作为变量值的<code>流程实例</code>与<code>执行</code>。<strong>请注意<code>ProcessInstanceQuery</code>与<code>ExecutionQuery</code>中，只有<code>variableValueEquals(name, entity)</code>方法支持JPA实体查询</strong>。而<code>variableValueNotEquals</code>、<code>variableValueGreaterThan</code>、<code>variableValueGreaterThanOrEqual</code>、<code>variableValueLessThan</code>与<code>variableValueLessThanOrEqual</code>等方法都不支持JPA，并会在值传递为JPA实体时，抛出<code>FlowableException</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span> <span class="tok-n">ProcessInstance</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createProcessInstanceQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">variableValueEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;entityToQuery&quot;</span><span class="tok-o">,</span> <span class="tok-n">entityToQuery</span><span class="tok-o">).</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_advanced_example_using_spring_beans_and_jpa">10.3.3. 使用Spring bean与JPA的高级示例</h4>
<div class="paragraph">
<p>可以在<code>flowable-spring-examples</code>中找到高级用法的示例——<code>JPASpringTest</code>。它描述了一个简单的用例：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用一个已有的Spring bean及已定义的JPA实体，用于存储贷款申请。</p>
</li>
<li>
<p>Flowable通过该bean获取该实体，并将其用作流程中的变量。流程定义如下步骤：</p>
<div class="ulist">
<ul>
<li>
<p>使用<code>LoanRequestBean</code>，并使用启动流程时（从启动表单）接收的变量创建LoanRequest（贷款申请）实体的服务任务。使用<code>flowable:resultVariable</code>将表达式结果，即所创建的实体存储为流程变量。</p>
</li>
<li>
<p>经理用于审核并批准/驳回申请的用户任务，并将审核结论存储为boolean变量<code>approvedByManager</code>。</p>
</li>
<li>
<p>更新贷款申请实体的服务任务，使实体与流程同步。</p>
</li>
<li>
<p>使用一个排他网关，依据<code>approved</code>实体参数的值选择下一步采用哪条路径：若申请被批准，结束流程；否则，生成一个额外任务（Send rejection letter 发送拒信），以便客户可以收到拒信得到通知。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>请注意这个流程只用于单元测试，而不包含任何表单。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/jpa.spring.example.process.png" alt="jpa.spring.example.process">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</div></td><td class="code"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-nt">&lt;definitions</span> <span class="tok-na">id=</span><span class="tok-s">&quot;taskAssigneeExample&quot;</span>
  <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot;</span>
  <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="tok-na">xmlns:flowable=</span><span class="tok-s">&quot;http://flowable.org/bpmn&quot;</span>
  <span class="tok-na">targetNamespace=</span><span class="tok-s">&quot;org.flowable.examples&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;process</span> <span class="tok-na">id=</span><span class="tok-s">&quot;LoanRequestProcess&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Process creating and handling loan request&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;startEvent</span> <span class="tok-na">id=</span><span class="tok-s">&#39;theStart&#39;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&#39;flow1&#39;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&#39;theStart&#39;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&#39;createLoanRequest&#39;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&#39;createLoanRequest&#39;</span> <span class="tok-na">name=</span><span class="tok-s">&#39;Create loan request&#39;</span>
      <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;${loanRequestBean.newLoanRequest(customerName, amount)}&quot;</span>
      <span class="tok-na">flowable:resultVariable=</span><span class="tok-s">&quot;loanRequest&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&#39;flow2&#39;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&#39;createLoanRequest&#39;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&#39;approveTask&#39;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;approveTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Approve request&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&#39;flow3&#39;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&#39;approveTask&#39;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&#39;approveOrDissaprove&#39;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&#39;approveOrDissaprove&#39;</span> <span class="tok-na">name=</span><span class="tok-s">&#39;Store decision&#39;</span>
      <span class="tok-na">flowable:expression=</span><span class="tok-s">&quot;${loanRequest.setApproved(approvedByManager)}&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&#39;flow4&#39;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&#39;approveOrDissaprove&#39;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&#39;exclusiveGw&#39;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;exclusiveGateway</span> <span class="tok-na">id=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Exclusive Gateway approval&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;endFlow1&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;theEnd&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>${loanRequest.approved}<span class="tok-nt">&lt;/conditionExpression&gt;</span>
    <span class="tok-nt">&lt;/sequenceFlow&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&quot;endFlow2&quot;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&quot;exclusiveGw&quot;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&quot;sendRejectionLetter&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;conditionExpression</span> <span class="tok-na">xsi:type=</span><span class="tok-s">&quot;tFormalExpression&quot;</span><span class="tok-nt">&gt;</span>${!loanRequest.approved}<span class="tok-nt">&lt;/conditionExpression&gt;</span>
    <span class="tok-nt">&lt;/sequenceFlow&gt;</span>

    <span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;sendRejectionLetter&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Send rejection letter&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;sequenceFlow</span> <span class="tok-na">id=</span><span class="tok-s">&#39;flow5&#39;</span> <span class="tok-na">sourceRef=</span><span class="tok-s">&#39;sendRejectionLetter&#39;</span> <span class="tok-na">targetRef=</span><span class="tok-s">&#39;theOtherEnd&#39;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&#39;theEnd&#39;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;endEvent</span> <span class="tok-na">id=</span><span class="tok-s">&#39;theOtherEnd&#39;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/process&gt;</span>

<span class="tok-nt">&lt;/definitions&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>尽管上面的例子很简单，但也展示了JPA与Spring结合，以及带参数方法表达式的威力。这个流程本身完全不需要写Java代码（当然还是需要写Spring bean），大幅加速了开发。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="history">11. 历史</h2>
<div class="sectionbody">
<div class="paragraph">
<p>历史是记录流程执行过程中发生的事情，并将其永久存储的组件。与运行时数据不同，历史数据在流程实例完成以后仍保存在数据库中。</p>
</div>
<div class="paragraph">
<p>有6个历史实体：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>HistoricProcessInstance</code>保存当前及已结束流程实例的信息。</p>
</li>
<li>
<p><code>HistoricVariableInstance</code>保存流程变量或任务变量的最新值。</p>
</li>
<li>
<p><code>HistoricActivityInstance</code>保存活动（流程中的节点）的一次执行的信息。</p>
</li>
<li>
<p><code>HistoricTaskInstance</code>保存当前与历史（完成及删除的）任务实例的信息。</p>
</li>
<li>
<p><code>HistoricIdentityLink</code>保存任务及流程实例、当前及历史的身份关联的信息。</p>
</li>
<li>
<p><code>HistoricDetail</code>保存与历史流程实例、活动实例或任务实例等有关的多种信息。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>历史与当前进行中的流程实例都在数据库中保存历史实体，因此可以选择直接查询历史表，以减少对运行时流程实例数据的访问，并提高运行时执行的性能。</p>
</div>
<div class="sect2">
<h3 id="historyQuery">11.1. 查询历史</h3>
<div class="paragraph">
<p>可以使用HistoryServiceAPI提供的<code>createHistoricProcessInstanceQuery()</code>、<code>createHistoricVariableInstanceQuery()</code>、<code>createHistoricActivityInstanceQuery()</code>、 <code>getHistoricIdentityLinksForTask()</code>、<code>getHistoricIdentityLinksForProcessInstance()</code>、<code>createHistoricDetailQuery()</code>与<code>createHistoricTaskInstanceQuery()</code>方法，查询全部6种历史实体。</p>
</div>
<div class="paragraph">
<p>下面用一些例子展示历史查询API的部分用法。可以在<a href="http://flowable.org/javadocs/index.html">javadoc</a>的<code>org.flowable.engine.history</code>包中找到全部用法。</p>
</div>
<div class="sect3">
<h4 id="historyQueryProcessInstance">11.1.1. 历史流程实例查询</h4>
<div class="paragraph">
<p>获取所有流程中，完成所花费时间（持续时间）排名前10的、流程定义为<em>XXX</em>的、已完成的<code>HistoricProcessInstances（历史流程实例）</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">historyService</span><span class="tok-o">.</span><span class="tok-na">createHistoricProcessInstanceQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">finished</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">processDefinitionId</span><span class="tok-o">(</span><span class="tok-s">&quot;XXX&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">orderByProcessInstanceDuration</span><span class="tok-o">().</span><span class="tok-na">desc</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">listPage</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">10</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="historyQueryVariableInstance">11.1.2. 历史变量实例查询</h4>
<div class="paragraph">
<p>获取已完成的、id为&#8217;XXX&#8217;的流程实例中，所有的<code>HistoricVariableInstances（历史变量实例）</code>，并以变量名排序。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">historyService</span><span class="tok-o">.</span><span class="tok-na">createHistoricVariableInstanceQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">processInstanceId</span><span class="tok-o">(</span><span class="tok-s">&quot;XXX&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">orderByVariableName</span><span class="tok-o">.</span><span class="tok-na">desc</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="historyQueryActivityInstance">11.1.3. 历史活动实例查询</h4>
<div class="paragraph">
<p>获取最新的、已完成的、流程定义的id为XXX的、服务任务类型的<code>HistoricActivityInstance（历史活动实例）</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-n">historyService</span><span class="tok-o">.</span><span class="tok-na">createHistoricActivityInstanceQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">activityType</span><span class="tok-o">(</span><span class="tok-s">&quot;serviceTask&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">processDefinitionId</span><span class="tok-o">(</span><span class="tok-s">&quot;XXX&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">finished</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">orderByHistoricActivityInstanceEndTime</span><span class="tok-o">().</span><span class="tok-na">desc</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">listPage</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">1</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="historyQueryDetail">11.1.4. 历史详情查询</h4>
<div class="paragraph">
<p>下面的的例子获取id为123的流程中所有的变量更新记录。这个查询只会返回<code>HistoricVariableUpdate（历史变量更新）</code>。请注意一个变量名可能会有多个<code>HistoricVariableUpdate</code>实体，这代表了流程中的每一次变量更新。可以使用<code>orderByTime（按变量更新的时间）</code>或<code>orderByVariableRevision（按变量更新的版本号）</code>对这些更新记录进行排序。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">historyService</span><span class="tok-o">.</span><span class="tok-na">createHistoricDetailQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">variableUpdates</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">processInstanceId</span><span class="tok-o">(</span><span class="tok-s">&quot;123&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">orderByVariableName</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">()</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>下面的例子获取流程id为"123"的、启动时提交或任何任务中提交的所有<a href="#formProperties">表单参数</a>。这个查询只会返回<code>HistoricFormProperties（历史表单参数）</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">historyService</span><span class="tok-o">.</span><span class="tok-na">createHistoricDetailQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">formProperties</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">processInstanceId</span><span class="tok-o">(</span><span class="tok-s">&quot;123&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">orderByVariableName</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">()</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>最后一个例子获取id为"123"的任务进行的所有变量更新操作。将返回该任务设置的所有变量（任务局部变量）的<code>HistoricVariableUpdates</code>，而<strong>不会</strong>返回流程实例中设置的变量。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">historyService</span><span class="tok-o">.</span><span class="tok-na">createHistoricDetailQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">variableUpdates</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">taskId</span><span class="tok-o">(</span><span class="tok-s">&quot;123&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">orderByVariableName</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">()</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以在<code>TaskListener</code>中使用<code>TaskService</code>或<code>DelegateTask</code>设置任务局部变量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">setVariableLocal</span><span class="tok-o">(</span><span class="tok-s">&quot;123&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;myVariable&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Variable value&quot;</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">notify</span><span class="tok-o">(</span><span class="tok-n">DelegateTask</span> <span class="tok-n">delegateTask</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-n">delegateTask</span><span class="tok-o">.</span><span class="tok-na">setVariableLocal</span><span class="tok-o">(</span><span class="tok-s">&quot;myVariable&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Variable value&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="historyQueryTaskInstance">11.1.5. 历史任务实例查询</h4>
<div class="paragraph">
<p>获取所有任务中，完成所花费时间（持续时间）排名前10的、已完成的<code>HistoricTaskInstance（历史任务实例）</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">historyService</span><span class="tok-o">.</span><span class="tok-na">createHistoricTaskInstanceQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">finished</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">orderByHistoricTaskInstanceDuration</span><span class="tok-o">().</span><span class="tok-na">desc</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">listPage</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">10</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>获取删除原因包含"invalid"的、最终指派给<em>kermit</em>用户的<code>HistoricTaskInstance</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">historyService</span><span class="tok-o">.</span><span class="tok-na">createHistoricTaskInstanceQuery</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">finished</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">taskDeleteReasonLike</span><span class="tok-o">(</span><span class="tok-s">&quot;%invalid%&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">taskAssignee</span><span class="tok-o">(</span><span class="tok-s">&quot;kermit&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">listPage</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">10</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="historyConfig">11.2. 配置历史</h3>
<div class="paragraph">
<p>可以使用org.flowable.engine.impl.history.HistoryLevel枚举（或在5.11之前的版本中，<code>ProcessEngineConfiguration</code>中定义的<em>HISTORY</em>常量），以编程方式配置历史级别：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">ProcessEngine</span> <span class="tok-n">processEngine</span> <span class="tok-o">=</span> <span class="tok-n">ProcessEngineConfiguration</span>
  <span class="tok-o">.</span><span class="tok-na">createProcessEngineConfigurationFromResourceDefault</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">setHistory</span><span class="tok-o">(</span><span class="tok-n">HistoryLevel</span><span class="tok-o">.</span><span class="tok-na">AUDIT</span><span class="tok-o">.</span><span class="tok-na">getKey</span><span class="tok-o">())</span>
  <span class="tok-o">.</span><span class="tok-na">buildProcessEngine</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以在flowable.cfg.xml或Spring上下文中配置级别：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneInMemProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;history&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;audit&quot;</span> <span class="tok-nt">/&gt;</span>
  ...
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以配置下列历史级别：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>none（无）</code>：跳过所有历史的存档。这是流程执行性能最高的配置，但是不会保存任何历史信息。</p>
</li>
<li>
<p><code>activity（活动）</code>：存档所有流程实例与活动实例。在流程实例结束时，将顶级流程实例变量的最新值复制为历史变量实例。但不会存档细节。</p>
</li>
<li>
<p><code>audit（审计）</code>：默认级别。将存档所有流程实例及活动实例，并保持变量值与提交的表单参数的同步，以保证所有通过表单进行的用户操作都可追踪、可审计。</p>
</li>
<li>
<p><code>full（完全）</code>：历史存档的最高级别，因此也最慢。这个级别存储所有<code>audit</code>级别存储的信息，加上所有其他细节（主要是流程变量的更新）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>在Flowable 5.11版本以前，历史级别保存在数据库中（<code>ACT_GE_PROPERTY</code> 表，参数名为<code>historyLevel</code>）。从5.11开始，这个值不再使用，并从数据库中忽略/删除。现在可以在引擎每次启动时切换历史级别。不会由于前一次启动时修改了级别，而导致本次启动抛出异常。</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="asyncHistoryConfig">11.3. 配置异步历史</h3>
<div class="paragraph">
<p>[实验性] Flowable 6.1.0引入了异步历史，使用历史作业执行器异步地进行历史数据的持久化。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneInMemProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;asyncHistoryEnabled&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;asyncHistoryExecutorNumberOfRetries&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;10&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;asyncHistoryExecutorActivate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
  ...
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>配置<code>asyncHistoryExecutorActivate</code>参数后，流程引擎启动时会自动启动历史作业执行器。只有在测试（或不使用异步历史时）才应该设置为false。
<code>asyncHistoryExecutorNumberOfRetries</code>参数用于配置异步历史作业的重试次数。这个参数与普通的异步作业有些不同，因为历史作业可能需要更多周期才能成功完成。比如，首先需要在ACT_HI_TASK_表中创建一个历史的任务，然后才能在另一个历史作业中记录其办理人的更新。流程引擎配置中，这个参数的默认值为10。到达重试次数后，会忽略这个历史作业（且不会写入死信作业表中）。</p>
</div>
<div class="paragraph">
<p>另外，可以使用<code>asyncHistoryExecutor</code>参数配置异步执行器，与普通的异步作业执行器类似。</p>
</div>
<div class="paragraph">
<p>如果不在默认的历史表中保存历史数据，而是在NoSQL数据库（Elasticsearch、MongoDb、Cassandra等）或其他什么地方保存，可以覆盖处理作业的处理器：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用<code>historyJobHandlers</code>参数，配置全部自定义历史作业处理器的map</p>
</li>
<li>
<p>或者，配置<code>customHistoryJobHandlers</code>列表。启动时会将列表中的所有处理器加入<code>historyJobHandlers</code> map中。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>另外，也可以使用消息队列，让引擎在产生新的历史作业时发送消息。这样，历史数据就可以在另外的服务器中进行处理。也可以配置引擎及消息队列使用JTA（以及JMS），这样就可以不用在作业中记录历史数据，而可以将所有数据发送至全局事务的消息队列中。</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/flowable/flowable-examples/tree/master/async-history">Flowable异步历史示例</a>提供了配置异步历史的不同示例，包括默认方式、JMS队列、JTA，还有使用消息队列，并使用Spring Boot应用作为消息监听器。</p>
</div>
</div>
<div class="sect2">
<h3 id="historyFormAuditPurposes">11.4. 用于审计的历史</h3>
<div class="paragraph">
<p>如果历史至少<a href="#historyConfig">配置</a>为<code>audit</code>级别，则会记录由<code>FormService.submitStartFormData(String processDefinitionId, Map&lt;String, String&gt; properties)</code>与<code>FormService.submitTaskFormData(String taskId, Map&lt;String, String&gt; properties)</code>方法提交的所有参数。</p>
</div>
<div class="paragraph">
<p>表单参数可以像这样通过查询API读取：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">historyService</span>
      <span class="tok-o">.</span><span class="tok-na">createHistoricDetailQuery</span><span class="tok-o">()</span>
      <span class="tok-o">.</span><span class="tok-na">formProperties</span><span class="tok-o">()</span>
      <span class="tok-o">...</span>
      <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这段代码只会返回<code>HistoricFormProperty</code>类型的历史详情。</p>
</div>
<div class="paragraph">
<p>如果在调用提交方法前，使用<code>IdentityService.setAuthenticatedUserId(String)</code>设置了认证用户，那么也可以在历史中获取该认证用户信息。使用<code>HistoricProcessInstance.getStartUserId()</code>获取启动表单的认证用户信息，任务表单则需使用<code>HistoricActivityInstance.getAssignee()</code>。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="IDM">12. 身份管理</h2>
<div class="sectionbody">
<div class="paragraph">
<p>从Flowable V6起，身份管理（IDM IDentity Management）组件从Flowable引擎模块中抽出，并将其逻辑移至几个不同的模块：flowable-idm-api、flowable-idm-engine、flowable-idm-spring及flowable-idm-engine-configurator。分离IDM主要是因为它并不是Flowable引擎的核心，并且在很多将Flowable引擎嵌入应用的用例中，并不使用或需要这部分身份管理逻辑。</p>
</div>
<div class="paragraph">
<p>默认情况下，IDM引擎在Flowable引擎启动时初始化并启动。这样身份管理逻辑在Flowable V5中也可以使用。IDM引擎管理自己的数据库表结构及下列实体：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User与UserEntity，用户信息。</p>
</li>
<li>
<p>Group与GroupEntity，组信息。</p>
</li>
<li>
<p>MembershipEntity，组中的用户成员。</p>
</li>
<li>
<p>Privilege与PrivilegeEntity，权限定义（例如在Flowable Modeler与Flowable Task应用中，用于控制应用界面的访问）。</p>
</li>
<li>
<p>PrivilegeMappingEntity，将用户及/或组与权限关联。</p>
</li>
<li>
<p>Token与TokenEntity，应用界面程序使用的认证令牌。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>历史与当前进行中的流程实例都在数据库中保存历史实体，因此可以选择直接查询历史表，以减少对运行时流程实例数据的访问，并提高运行时执行的性能。</p>
</div>
<div class="sect2">
<h3 id="_idm_engine_configuration">12.1. 配置IDM引擎</h3>
<div class="paragraph">
<p>默认情况下，IDM引擎使用<code>org.flowable.engine.impl.cfg.IdmEngineConfigurator</code>启动。这个配置器使用Flowable流程引擎配置中相同的数据源配置。这样使用身份管理就不需要进行额外的配置，就像在Flowable V5中一样。</p>
</div>
<div class="paragraph">
<p>如果Flowable引擎不需要身份管理，可以在流程引擎配置中禁用IDM引擎。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneInMemProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;disableIdmEngine&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
  ...
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这意味着不能使用用户与组进行查询，也不能在任务查询中，按用户查询其所在的候选组。</p>
</div>
<div class="paragraph">
<p>默认情况下，用户的密码以明文保存在IDM数据库表中。可以在流程引擎配置中定义一个加密算法，以确保密码加密。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;bCryptEncoder&quot;</span>
      <span class="tok-na">class=</span><span class="tok-s">&quot;org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder&quot;</span><span class="tok-nt">/&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;passwordEncoder&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.idm.spring.authentication.SpringEncoder&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;constructor-arg</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;bCryptEncoder&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.cfg.StandaloneInMemProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;passwordEncoder&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;passwordEncoder&quot;</span> <span class="tok-nt">/&gt;</span>
  ...
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这里使用的是ShaPasswordEncoder，但也可以使用其他的加密算法，如org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder，不使用Spring的话也可以改用org.flowable.idm.engine.impl.authentication.ApacheDigester。</p>
</div>
<div class="paragraph">
<p>也可以覆盖默认的IDM引擎配置器，使用自定义方式初始化IDM引擎。LDAPConfigurator的实现就是一个很好的例子。它覆盖了默认的IDM引擎，使用LDAP服务代替了默认的IDM数据库表。流程引擎配置的<code>idmProcessEngineConfigurator</code>参数用于设置自定义的配置器，如LDAPConfigurator</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;...SomeProcessEngineConfigurationClass&quot;</span><span class="tok-nt">&gt;</span>
    ...
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;idmProcessEngineConfigurator&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.ldap.LDAPConfigurator&quot;</span><span class="tok-nt">&gt;</span>

        <span class="tok-c">&lt;!-- 服务器连接参数 --&gt;</span>
        <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;server&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;ldap://localhost&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;port&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;33389&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;user&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;uid=admin, ou=users, o=flowable&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;pass&quot;</span> <span class="tok-nt">/&gt;</span>

        <span class="tok-c">&lt;!-- 查询参数 --&gt;</span>
        <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;baseDn&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;o=flowable&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;queryUserByUserId&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;(&amp;(objectClass=inetOrgPerson)(uid={0}))&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;queryUserByFullNameLike&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;(&amp;(objectClass=inetOrgPerson)(|({0}=*{1}*)({2}=*{3}*)))&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;queryGroupsForUser&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;(&amp;(objectClass=groupOfUniqueNames)(uniqueMember={0}))&quot;</span> <span class="tok-nt">/&gt;</span>

        <span class="tok-c">&lt;!-- 配置参数 --&gt;</span>
        <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;userIdAttribute&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;uid&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;userFirstNameAttribute&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;cn&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;userLastNameAttribute&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sn&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;userEmailAttribute&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;mail&quot;</span> <span class="tok-nt">/&gt;</span>


        <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;groupIdAttribute&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;cn&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;groupNameAttribute&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;cn&quot;</span> <span class="tok-nt">/&gt;</span>

      <span class="tok-nt">&lt;/bean&gt;</span>
    <span class="tok-nt">&lt;/property&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="flowableDesigner">13. Eclipse Designer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Flowable提供了名为Flowable Eclipse Designer的Eclipse插件，可以用于图形化地建模、测试与部署BPMN 2.0流程。</p>
</div>
<div class="sect2">
<h3 id="eclipseDesignerInstallation">13.1. 安装</h3>
<div class="paragraph">
<p>下面的安装指导在<a href="http://www.eclipse.org/downloads/">Eclipse Mars与Neon</a>下进行了验证。</p>
</div>
<div class="paragraph">
<p>选择<strong>Help &#8594; Install New Software</strong>。在下图面板中，点击<em>Add</em>按钮，并填写下列字段：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Name:</strong> Flowable BPMN 2.0 designer</p>
</li>
<li>
<p><strong>Location:</strong> <a href="http://www.flowable.org/designer/update/" class="bare">http://www.flowable.org/designer/update/</a></p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.add.update.site.png" alt="designer.add.update.site">
</div>
</div>
<div class="paragraph">
<p>确保<strong>已选中"Contact all updates sites.."</strong>复选框。这样Eclipse就可以下载需要的所有插件。</p>
</div>
</div>
<div class="sect2">
<h3 id="eclipseDesignerEditorFeatures">13.2. Flowable Designer编辑器功能</h3>
<div class="ulist">
<ul>
<li>
<p>创建Flowable项目与流程图（diagram）。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.create.flowable.project.png" alt="designer.create.flowable.project">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Flowable Designer在创建新的Flowable流程图时，会创建一个.bpmn文件。当使用Flowable Diagram Editor（Flowable流程图编辑器）视图打开时，将提供图形化的模型画布与画板。这个文件也可以使用XML编辑器打开，将显示流程定义的BPMN 2.0 XML元素。也就是说，Flowable Designer只用一个文件，既是流程图，也是BPMN 2.0 XML。请注意在早期版本中，不支持使用.bpmn扩展名作为流程定义的部署包。可以使用Flowable Designer的"create deployment artifacts（创建部署包）"功能，生成一个BAR文件，其中有一个.bpmn20.xml文件，包含.bpmn文件的内容。也可以方便的自己重命名。请注意，也可以使用Flowable Diagram Editor打开.bpmn20.xml文件。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.bpmn.file.png" alt="designer.bpmn.file">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>BPMN 2.0 XML文件导入Flowable Designer会自动显示流程图。只需要将BPMN 2.0 XML文件复制到项目中，并使用Flowable Diagram Editor视图打开它。Flowable Designer使用文件中的BPMN DI信息来创建流程图。如果BPMN 2.0 XML文件中没有BPMN DI信息，会使用Flowable BPMN自动布局模块，创建流程图。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.open.importedfile.png" alt="designer.open.importedfile" width="600">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>可以使用Flowable Designer创建BAR文件或JAR文件进行部署。在包浏览器中的Flowable项目上点击右键，在弹出菜单的下方选择<em>Create deployment artifacts（创建部署包）</em>选项。要了解关于Designer部署功能的更多信息，请查看<a href="#eclipseDesignerDeployment">部署</a>章节。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.create.deployment.png" alt="designer.create.deployment" width="500">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>生成单元测试（在包浏览器中的BPMN 2.0 XML文件上点击右键，选择<em>generate unit test 生成单元测试</em>）。将创建一个单元测试及运行在嵌入式H2数据库上的Flowable配置。这样就可以运行单元测试，来测试你的流程定义。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.unittest.generate.png" alt="designer.unittest.generate" width="600">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Flowable项目可以生成为Maven项目。要配置依赖，需要运行<em>mvn eclipse:eclipse</em>。请注意在流程设计时不需要Maven依赖。只在运行单元测试时才需要依赖。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.project.maven.png" alt="designer.project.maven" width="500">
</div>
</div>
</div>
<div class="sect2">
<h3 id="eclipseDesignerBPMNFeatures">13.3. Flowable Designer BPMN功能</h3>
<div class="ulist">
<ul>
<li>
<p>支持空启动事件，错误启动事件，定时器启动事件，空结束事件，错误结束事件，顺序流，并行网关，排他网关，包容网关，事件网关，嵌入式子流程，事件子流程，调用活动，泳池，泳道，脚本任务，用户任务，服务任务，邮件任务，手动任务，业务规则任务，接收任务，定时器边界事件，错误边界事件，信号边界事件，定时器捕获事件，信号捕获事件，信号抛出事件，空抛出事件，以及四个Flowable特殊元素（用户，脚本，邮件任务与启动事件）。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.model.process.png" alt="designer.model.process">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>可以在元素上悬停并选择新的任务类型，快速改变任务的类型。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.model.quick.change.png" alt="designer.model.quick.change">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>可以在元素上悬停并选择新的元素类型，快速添加新的元素。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.model.quick.new.png" alt="designer.model.quick.new">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Java服务任务支持Java类，表达式或代理表达式配置。另外也可以配置字段扩展。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.servicetask.property.png" alt="designer.servicetask.property">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>支持泳池与泳道。但由于Flowable会将不同的泳池认作不同的流程定义，因此最好只使用一个泳池。如果使用多个泳池，要小心不要在泳池间画顺序流，否则会在Flowable引擎中部署流程时发生错误。可以在一个泳池中添加任意多的泳道。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.model.poolandlanes.png" alt="designer.model.poolandlanes">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>可以通过填写name参数，为顺序流添加标签。可以决定放置标签的位置，位置将保存为BPMN 2.0 XML DI信息的一部分。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.model.labels.png" alt="designer.model.labels">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>支持事件子流程。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.model.eventsubprocess.png" alt="designer.model.eventsubprocess">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>支持展开嵌入式子流程。也可以在一个嵌入式子流程中加入另一个嵌入式子流程。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.embeddedprocess.canvas.png" alt="designer.embeddedprocess.canvas">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>支持在任务与嵌入式子流程上的定时器边界事件。然而，在Flowable Designer中，在用户任务或嵌入式子流程上使用定时器边界事件最合理。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.timerboundary.canvas.png" alt="designer.timerboundary.canvas">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>支持额外的Flowable扩展，例如邮件任务，用户任务的候选人配置，或脚本任务配置。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.mailtask.property.png" alt="designer.mailtask.property">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>支持Flowable执行与任务监听器。也可以为执行监听器添加字段扩展。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.listener.configuration.png" alt="designer.listener.configuration">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>支持在顺序流上添加条件。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.sequence.condition.png" alt="designer.sequence.condition">
</div>
</div>
</div>
<div class="sect2">
<h3 id="eclipseDesignerDeployment">13.4. Flowable Designer部署功能</h3>
<div class="paragraph">
<p>在Flowable引擎上部署流程定义与任务表单并不困难。只需要提供一个包含有流程定义BPMN 2.0 XML文件的BAR文件，与可选的用于在Flowable应用中查看的任务表单和流程图片。在Flowable Designer中，创建BAR文件十分简单。在完成流程实现后，只要在包浏览器中的Flowable项目上点击右键，在弹出菜单下方选择<strong>Create deployment artifacts（创建部署包）</strong>选项。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.create.deployment.png" alt="designer.create.deployment" width="600">
</div>
</div>
<div class="paragraph">
<p>然后就会创建一个部署目录，包含BAR文件与可能的JAR文件。其中JAR文件包含Flowable项目中的Java类。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.deployment.dir.png" alt="designer.deployment.dir">
</div>
</div>
<div class="paragraph">
<p>这样就可以在Flowable Admin应用的部署页签中，将这个文件上传至Flowable引擎。</p>
</div>
<div class="paragraph">
<p>如果项目包含Java类，部署时要多做一些工作。在这种情况下，Flowable Designer的<strong>Create deployment artifacts（创建部署包）</strong>操作也会创建包含编译后类的JAR文件。这个JAR文件必须部署在Flowable Tomcat（或其它容器）安装目录的flowable-XXX/WEB-INF/lib目录下。这样Flowable引擎的classpath就会添加这些类。</p>
</div>
</div>
<div class="sect2">
<h3 id="eclipseDesignerExtending">13.5. 扩展Flowable Designer</h3>
<div class="paragraph">
<p>可以扩展Flowable Designer提供的默认功能。这段文档介绍了可以使用哪些扩展，如何使用，并提供了一些例子。在建模业务流程时，如果默认功能不能满足需要，需要额外的功能，或有领域专门需求的时候，扩展Flowable Designer就很有用。扩展Flowable Designer分为两个不同领域，扩展画板与扩展输出格式。两者都需要专门的方法，与不同的技术知识。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>扩展Flowable Designer需要专业知识，更确切地说，Java编程的知识。取决于你想要创建的扩展类型，你可能需要熟悉Maven，Eclipse，OSGi，Eclipse扩展与SWT。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="eclipseDesignerCustomizingPalette">13.5.1. 自定义画板</h4>
<div class="paragraph">
<p>可以自定义为用户建模流程提供的画板。画板是形状的集合，显示在画布的右侧，可以将形状拖放至画布中的流程图上。在默认画板中可以看到，默认形状进行了分组（被称为“抽屉 drawer”），如事件，网关，等等。Flowable Designer提供了两种选择，用于自定义画板中的抽屉与形状：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>将你自己的形状/节点添加到已有或新建的抽屉</p>
</li>
<li>
<p>禁用Flowable Designer提供的部分或全部BPMN 2.0默认形状，除了连线与选择工具</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>要自定义画板，需要创建一个JAR文件，并将其加入每一个Flowable Designer的安装目录（后面介绍<a href="#eclipseDesignerApplyingExtension">如何做</a>）。这个JAR文件叫做<em>扩展（extension）</em>。通过编写扩展中包含的类，就能让Flowable Designer知道需要自定义的形状。为此需要实现特定的接口。Flowable提供了一个集成类库，包含这些接口以及用于扩展的基类。</p>
</div>
<div class="paragraph">
<p>可以在下列地方找到代码示例：Flowable <a href="https://github.com/flowable/flowable-designer/tree/master/examples">源码</a>，<code>flowable-designer</code>仓库下的<code>examples/money-tasks</code>目录。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>可以使用你喜欢的任何工具设置项目，并使用你选择的构建工具构建JAR。在下面的介绍中，假设使用Eclipse Mars或Neon，并使用Maven（3.x）作为构建工具。但任何设置都可以创建相同的结果。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_extension_setup_eclipse_maven">设置扩展 (Eclipse/Maven)</h5>
<div class="paragraph">
<p>下载并解压缩<a href="http://www.eclipse.org/downloads">Eclipse</a>（应该可以使用最新版本），与<a href="http://maven.apache.org/download.html">Apache Maven</a>近期的版本（3.x）。如果使用2.x版本的Maven，可能会在构建项目时遇到错误，因此请确保版本是最新的。我们假设你已经熟悉Eclipse中的基本功能以及Java编辑器。可以使用Eclipse的Maven功能，或直接从命令行运行Maven命令。</p>
</div>
<div class="paragraph">
<p>在Eclipse中创建一个新项目。可以是通用类型项目。在项目的根路径创建一个<code>pom.xml</code>文件，以包含Maven项目配置。同时创建<code>src/main/java</code>与<code>src/main/resources</code>目录，这是Maven约定的Java源文件与资源文件目录。打开<code>pom.xml</code>文件并添加下列行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-nt">&lt;project</span>
  <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
  <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;modelVersion&gt;</span>4.0.0<span class="tok-nt">&lt;/modelVersion&gt;</span>

  <span class="tok-nt">&lt;groupId&gt;</span>org.acme<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>money-tasks<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>1.0.0<span class="tok-nt">&lt;/version&gt;</span>
  <span class="tok-nt">&lt;packaging&gt;</span>jar<span class="tok-nt">&lt;/packaging&gt;</span>
  <span class="tok-nt">&lt;name&gt;</span>Acme Corporation Money Tasks<span class="tok-nt">&lt;/name&gt;</span>
...
<span class="tok-nt">&lt;/project&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以看到，这只是一个基础的pom.xml文件，为项目定义了一个<code>groupId</code>、<code>artifactId</code>与<code>version</code>。我们会创建一个定制项，包含一个money业务要用的自定义节点。</p>
</div>
<div class="paragraph">
<p>在<code>pom.xml</code>文件中为项目添加这些集成库依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependencies&gt;</span>
  <span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>org.flowable.designer<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>org.flowable.designer.integration<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>5.22.0<span class="tok-nt">&lt;/version&gt;</span> <span class="tok-c">&lt;!-- 使用当前的Flowable Designer版本 --&gt;</span>
    <span class="tok-nt">&lt;scope&gt;</span>compile<span class="tok-nt">&lt;/scope&gt;</span>
  <span class="tok-nt">&lt;/dependency&gt;</span>
<span class="tok-nt">&lt;/dependencies&gt;</span>
...
<span class="tok-nt">&lt;repositories&gt;</span>
  <span class="tok-nt">&lt;repository&gt;</span>
      <span class="tok-nt">&lt;id&gt;</span>Flowable<span class="tok-nt">&lt;/id&gt;</span>
   <span class="tok-nt">&lt;/repository&gt;</span>
<span class="tok-nt">&lt;/repositories&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>最后，在<code>pom.xml</code>文件中，添加<code>maven-compiler-plugin</code>配置，设置Java源码级别为1.5以上（参见下面的代码片段）。要使用注解需要这个配置。也可以为Maven包含用于生成JAR的<code>MANIFEST.MF</code>文件。这不是必须的，但可以在这个manifest中使用特定参数，为你的扩展提供名字（这个名字可以在设计器的特定位置显示，主要用于在设计器中有多个扩展时使用）。如果想要这么做，在<code>pom.xml</code>中添加下列代码片段：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</div></td><td class="code"><span></span><span class="tok-nt">&lt;build&gt;</span>
  <span class="tok-nt">&lt;plugins&gt;</span>
    <span class="tok-nt">&lt;plugin&gt;</span>
      <span class="tok-nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="tok-nt">&lt;/artifactId&gt;</span>
      <span class="tok-nt">&lt;configuration&gt;</span>
        <span class="tok-nt">&lt;source&gt;</span>1.8<span class="tok-nt">&lt;/source&gt;</span>
        <span class="tok-nt">&lt;target&gt;</span>1.8<span class="tok-nt">&lt;/target&gt;</span>
        <span class="tok-nt">&lt;showDeprecation&gt;</span>true<span class="tok-nt">&lt;/showDeprecation&gt;</span>
        <span class="tok-nt">&lt;showWarnings&gt;</span>true<span class="tok-nt">&lt;/showWarnings&gt;</span>
        <span class="tok-nt">&lt;optimize&gt;</span>true<span class="tok-nt">&lt;/optimize&gt;</span>
      <span class="tok-nt">&lt;/configuration&gt;</span>
    <span class="tok-nt">&lt;/plugin&gt;</span>
    <span class="tok-nt">&lt;plugin&gt;</span>
      <span class="tok-nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tok-nt">&lt;/groupId&gt;</span>
      <span class="tok-nt">&lt;artifactId&gt;</span>maven-jar-plugin<span class="tok-nt">&lt;/artifactId&gt;</span>
      <span class="tok-nt">&lt;version&gt;</span>2.3.2<span class="tok-nt">&lt;/version&gt;</span>
      <span class="tok-nt">&lt;configuration&gt;</span>
        <span class="tok-nt">&lt;archive&gt;</span>
          <span class="tok-nt">&lt;index&gt;</span>true<span class="tok-nt">&lt;/index&gt;</span>
          <span class="tok-nt">&lt;manifest&gt;</span>
            <span class="tok-nt">&lt;addClasspath&gt;</span>false<span class="tok-nt">&lt;/addClasspath&gt;</span>
            <span class="tok-nt">&lt;addDefaultImplementationEntries&gt;</span>true<span class="tok-nt">&lt;/addDefaultImplementationEntries&gt;</span>
          <span class="tok-nt">&lt;/manifest&gt;</span>
          <span class="tok-nt">&lt;manifestEntries&gt;</span>
            <span class="tok-nt">&lt;FlowableDesigner-Extension-Name&gt;</span>Acme Money<span class="tok-nt">&lt;/FlowableDesigner-Extension-Name&gt;</span>
          <span class="tok-nt">&lt;/manifestEntries&gt;</span>
        <span class="tok-nt">&lt;/archive&gt;</span>
      <span class="tok-nt">&lt;/configuration&gt;</span>
    <span class="tok-nt">&lt;/plugin&gt;</span>
  <span class="tok-nt">&lt;/plugins&gt;</span>
<span class="tok-nt">&lt;/build&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>扩展的名字使用<code>FlowableDesigner-Extension-Name</code>参数描述。现在只剩下让Eclipse按照<code>pom.xml</code>的指导设置项目。因此打开命令行，并转到Eclipse工作空间中你项目的根目录。然后执行下列Maven命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn eclipse:eclipse</pre>
</div>
</div>
<div class="paragraph">
<p>等待构建完成。刷新项目（使用项目上下文菜单（右键点击），并选择<code>Refresh 刷新</code>）。现在Eclipse项目中应该已经建立了<code>src/main/java</code>与<code>src/main/resources</code>源码目录。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>当然也可以使用<a href="http://www.eclipse.org/m2e">m2eclipse</a>插件，并简单地在项目的上下文菜单（右键点击）中启用Maven依赖管理。然后在项目的上下文菜单中选择<code>Maven</code> &gt; <code>Update project configuration（更新项目配置）</code>。这也将配置源代码目录。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>这就完成了配置。现在可以开始为Flowable Designer创建自定义项了！</p>
</div>
</div>
<div class="sect4">
<h5 id="eclipseDesignerApplyingExtension">在Flowable Designer中应用你的扩展</h5>
<div class="paragraph">
<p>你也许想知道如何将你的扩展加入Flowable Designer，以便应用你的自定义项。需要这些步骤：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>创建扩展JAR（例如，使用Maven构建时，在项目中运行mvn install）后，需要将扩展传递至Flowable Designer安装的计算机；</p>
</li>
<li>
<p>将扩展存储在硬盘上，方便记忆的位置。<em>请注意：</em>必须保存在Flowable Designer的Eclipse工作空间之外——将扩展保存在工作空间内，会导致弹出错误消息弹框，扩展将不可用；</p>
</li>
<li>
<p>启动Flowable Designer，从菜单中，选择<code>Window</code> &gt; <code>Preferences</code>，或<code>Eclipse</code> &gt; <code>Preferences</code></p>
</li>
<li>
<p>在Preferences界面，键入<code>user</code>作为关键字。将可以看到在Eclipse中<code>Java</code>段落内，<code>User Libraries</code>的选项。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.preferences.userlibraries.png" alt="designer.preferences.userlibraries" width="250">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>选择<code>User Libraries</code>选项，将在右侧显示树形界面，可以添加库。应该可以看到一个默认组，可以用于添加Flowable Designer的扩展（根据Eclipse安装不同，也可能看到几个其他的）。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.preferences.userlibraries.flowable.empty.png" alt="designer.preferences.userlibraries.flowable.empty" width="600">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>选择<code>Flowable Designer Extensions</code>组，并点击<code>Add JARs&#8230;&#8203;</code>或<code>Add External JARs&#8230;&#8203;</code>按钮。跳转至存储扩展的目录，并选择希望添加的扩展文件。完成后，配置界面会将扩展作为<code>Flowable Designer Extensions</code>组的成员进行显示，像下面这样。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.preferences.userlibraries.flowable.moneytasks.png" alt="designer.preferences.userlibraries.flowable.moneytasks" width="600">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>点击<code>OK</code>按钮保存并关闭配置对话框。<code>Flowable Designer Extensions</code>会自动添加至你创建的新Flowable项目。可以在导航条或包管理器的项目树下的用户库条目中看到。如果工作空间中已经有了Flowable项目，也可以看到组中显示了新扩展，像下面这样。</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.userlibraries.project.png" alt="designer.userlibraries.project" width="400">
</div>
</div>
<div class="paragraph">
<p>打开的流程图将在其画板上显示新扩展的图形（或者禁用部分图形，取决于扩展中的配置）。如果已经打开了流程图，关闭并重新打开就能在画板上看到变化。</p>
</div>
</div>
<div class="sect4">
<h5 id="_adding_shapes_to_the_palette">为画板添加图形</h5>
<div class="paragraph">
<p>项目配置完后，可以很轻松的为画板添加图形。每个添加的图形都表现为JAR中的一个类。请注意这些类并不是Flowable引擎运行时会使用的类。在扩展中可以为每个图形描述Flowable Designer可用的参数。在这些图形中，也可以定义运行时特性，并将由引擎在流程实例到达该节点时使用。运行时特性可以使用任何Flowable对普通<code>ServiceTask</code>支持的选项。查看<a href="#eclipseDesignerConfiguringRuntime">这个章节</a>了解更多信息。</p>
</div>
<div class="paragraph">
<p>图形的类是简单的Java类，加上一些注解。这个类需要实现<code>CustomServiceTask</code>接口，但不应该直接实现这个接口，而应该扩展<code>AbstractCustomServiceTask</code>基类（目前必须直接扩展这个类，而不能在中间使用abstract类）。在这个类的Javadoc中，可以看到其默认提供的，与需要覆盖的方法介绍。覆盖可以实现很多功能，例如为画板及画布中的图形提供图标（两个可以不一样），或者指定你希望节点实现的基图形（活动，时间，网关）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-cm">/**</span>
<span class="tok-cm"> * @author John Doe</span>
<span class="tok-cm"> * @version 1</span>
<span class="tok-cm"> * @since 1.0.0</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AcmeMoneyTask</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractCustomServiceTask</span> <span class="tok-o">{</span>
<span class="tok-o">...</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>需要实现<code>getName()</code>方法，来决定节点在画板上的名字。也可以将节点放在自己的抽屉中，并提供图标，只需要覆盖<code>AbstractCustomServiceTask</code>的对应方法就可以。如果希望提供图标，请确保放在JAR的<code>src/main/resources</code>包中，需要是16X16像素的JPEG或PNG格式图片。你要提供的路径是到这个目录的相对路径。</p>
</div>
<div class="paragraph">
<p>可以通过在类中添加成员，并使用<code>@Property</code>注解，来为形状添加参数。像这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nd">@Property</span><span class="tok-o">(</span><span class="tok-n">type</span> <span class="tok-o">=</span> <span class="tok-n">PropertyType</span><span class="tok-o">.</span><span class="tok-na">TEXT</span><span class="tok-o">,</span> <span class="tok-n">displayName</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Account Number&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Help</span><span class="tok-o">(</span><span class="tok-n">displayHelpShort</span> <span class="tok-o">=</span> <span class="tok-s">&quot;提供一个账户编码 Provide an account number&quot;</span><span class="tok-o">,</span> <span class="tok-n">displayHelpLong</span> <span class="tok-o">=</span> <span class="tok-n">HELP_ACCOUNT_NUMBER_LONG</span><span class="tok-o">)</span>
<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">accountNumber</span><span class="tok-o">;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用多种<code>PropertyType</code>值，在<a href="#eclipseDesignerPropertyTypes">这个章节</a>中详细描述。可以通过将required属性设置为true，将一个字段设为必填。如果用户没有填写这个字段，将会提示消息，背景也会变红。</p>
</div>
<div class="paragraph">
<p>如果想要调整类中多个参数在参数界面上的显示顺序，需要指定<code>@Property</code>注解的order属性。</p>
</div>
<div class="paragraph">
<p>可以看到有个<code>@Help</code>注解，它用于为用户提供一些填写字段的指导。也可以在类本身上使用<code>@Help</code>注解——这个信息将在显示给用户的参数表格最上面显示。</p>
</div>
<div class="paragraph">
<p>下面是<code>MoneyTask</code>详细介绍的列表。添加了一个备注字段，也可以看到节点包含了一个图标。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</div></td><td class="code"><span></span><span class="tok-cm">/**</span>
<span class="tok-cm"> * @author John Doe</span>
<span class="tok-cm"> * @version 1</span>
<span class="tok-cm"> * @since 1.0.0</span>
<span class="tok-cm"> */</span>
<span class="tok-nd">@Runtime</span><span class="tok-o">(</span><span class="tok-n">javaDelegateClass</span> <span class="tok-o">=</span> <span class="tok-s">&quot;org.acme.runtime.AcmeMoneyJavaDelegation&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@Help</span><span class="tok-o">(</span><span class="tok-n">displayHelpShort</span> <span class="tok-o">=</span> <span class="tok-s">&quot;创建一个新的账户 Creates a new account&quot;</span><span class="tok-o">,</span> <span class="tok-n">displayHelpLong</span> <span class="tok-o">=</span>
    <span class="tok-s">&quot;使用给定的账户编码，创建一个新的账户 Creates a new account using the account number specified&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AcmeMoneyTask</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractCustomServiceTask</span> <span class="tok-o">{</span>

  <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">HELP_ACCOUNT_NUMBER_LONG</span> <span class="tok-o">=</span>
      <span class="tok-s">&quot;提供一个可用作账户编码的编码。 Provide a number that is suitable as an account number.&quot;</span><span class="tok-o">;</span>

  <span class="tok-nd">@Property</span><span class="tok-o">(</span><span class="tok-n">type</span> <span class="tok-o">=</span> <span class="tok-n">PropertyType</span><span class="tok-o">.</span><span class="tok-na">TEXT</span><span class="tok-o">,</span> <span class="tok-n">displayName</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Account Number&quot;</span><span class="tok-o">,</span> <span class="tok-n">required</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">)</span>
  <span class="tok-nd">@Help</span><span class="tok-o">(</span><span class="tok-n">displayHelpShort</span> <span class="tok-o">=</span> <span class="tok-s">&quot;提供一个账户编码 Provide an account number&quot;</span><span class="tok-o">,</span> <span class="tok-n">displayHelpLong</span> <span class="tok-o">=</span> <span class="tok-n">HELP_ACCOUNT_NUMBER_LONG</span><span class="tok-o">)</span>
  <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">accountNumber</span><span class="tok-o">;</span>

  <span class="tok-nd">@Property</span><span class="tok-o">(</span><span class="tok-n">type</span> <span class="tok-o">=</span> <span class="tok-n">PropertyType</span><span class="tok-o">.</span><span class="tok-na">MULTILINE_TEXT</span><span class="tok-o">,</span> <span class="tok-n">displayName</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Comments&quot;</span><span class="tok-o">)</span>
  <span class="tok-nd">@Help</span><span class="tok-o">(</span><span class="tok-n">displayHelpShort</span> <span class="tok-o">=</span> <span class="tok-s">&quot;提供备注 Provide comments&quot;</span><span class="tok-o">,</span> <span class="tok-n">displayHelpLong</span> <span class="tok-o">=</span>
      <span class="tok-s">&quot;可以为节点添加备注，以提供详细说明。 You can add comments to the node to provide a brief description.&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">comments</span><span class="tok-o">;</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">contributeToPaletteDrawer</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-s">&quot;Acme Corporation&quot;</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getName</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-s">&quot;Money node&quot;</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getSmallIconPath</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-s">&quot;icons/coins.png&quot;</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果使用这个图形扩展Flowable Designer，画板与相应的图形将像是这样：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.palette.add.money.png" alt="designer.palette.add.money" width="250">
</div>
</div>
<div class="paragraph">
<p>money任务的参数界面在下面显示。请注意<code>accountNumber</code>字段的必填信息。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.palette.add.money.properties.required.png" alt="designer.palette.add.money.properties.required">
</div>
</div>
<div class="paragraph">
<p>在创建流程图、填写参数字段时，用户可以使用静态文本，或者使用流程变量的表达式（如"This little piggy went to ${piggyLocation}"）。一般来说，用户可以在text字段自由填写任何文本。如果你希望用户使用表达式，并（使用<code>@Runtime</code>）为<code>CustomServiceTask</code>添加运行时行为，请确保在代理类中使用<code>Expression</code>字段，以便表达式可以在运行时正确解析。可以在<a href="#eclipseDesignerConfiguringRuntime">这个章节</a>找到更多关于运行时行为的信息。</p>
</div>
<div class="paragraph">
<p>字段的帮助信息由每个参数右侧的按钮提供。点击该按钮将弹出显示下列内容。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.palette.add.money.help.png" alt="designer.palette.add.money.help">
</div>
</div>
<div class="sect5">
<h6 id="eclipseDesignerConfiguringRuntime">配置自定义服务任务的运行时执行</h6>
<div class="paragraph">
<p>当设置好字段，并将扩展应用至Designer后，用户就可以在建模流程时，配置服务任务的这些参数。在大多数情况下，会希望在Flowable执行流程时，使用这些用户配置参数。要做到这一点，必须告诉Flowable，当流程到达你<code>CustomServiceTask</code>时，需要使用哪个类。</p>
</div>
<div class="paragraph">
<p>有一个特别的注解，<code>@Runtime</code>，用于指定<code>CustomServiceTask</code>的运行时特性。这里有些如何使用的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nd">@Runtime</span><span class="tok-o">(</span><span class="tok-n">javaDelegateClass</span> <span class="tok-o">=</span> <span class="tok-s">&quot;org.acme.runtime.AcmeMoneyJavaDelegation&quot;</span><span class="tok-o">)</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>使用时，<code>CustomServiceTask</code>将会表现为流程建模BPMN中的一个普通的<code>ServiceTask</code>。Flowable提供了<a href="#bpmnJavaServiceTask">多种方法</a>定义<code>ServiceTask</code>的运行时特性。因此，<code>@Runtime</code>可以使用Flowable提供的三个属性中的一个：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>javaDelegateClass</code>在BPMN输出中映射为<code>flowable:class</code>。指定一个实现了<code>JavaDelegate</code>的类的全限定类名。</p>
</li>
<li>
<p><code>expression</code>在BPMN输出中映射为<code>flowable:expression</code>。指定一个需要执行的方法的表达式，例如一个Spring Bean中的方法。当使用这个选项时，<em>不应</em>在字段上指定任何<code>@Property</code>注解。下面有更详细的说明。</p>
</li>
<li>
<p><code>javaDelegateExpression</code>在BPMN输出中映射为<code>flowable:delegateExpression</code>。指定一个实现了<code>JavaDelegate</code>的类的表达式。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>如果在类中为Flowable提供了可以注入的成员，就可以将用户的参数至注入到运行时类中。名字需要与<code>CustomServiceTask</code>的成员名一致。查看用户手册的<a href="#serviceTaskFieldInjection">这个部分</a>了解更多信息。请注意从Designer的5.11.0版本开始，可以为动态字段值使用<code>Expression</code>接口。这意味着Flowable Designer中参数的值必须要是表达式，并且这个表达式将在之后注入<code>JavaDelegate</code>实现类的<code>Expression</code>参数中。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>可以在<code>CustomServiceTask</code>的成员上使用<code>@Property</code>注解，但如果使用<code>@Runtime</code>的<code>expression</code>属性，则<code>@Property</code>注解将不会生效。原因是指定的表达式将被Flowable尝试解析为<em>方法</em>，而不是类。因此，不会有对类的注入。如果在<code>@Runtime</code>注解中使用<code>expression</code>，则注解为<code>@Property</code>的成员将被Designer忽略。Designer不会将它们渲染为节点参数页面的可编辑字段，也不会为这些参数在流程的BPMN中生成输出。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>请注意不应该在你的扩展JAR中包括运行时类，因为它与Flowable库是分离的。Flowable需要在运行时能够找到它们，因此需要将其放在Flowable引擎的clsspath中。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Designer代码树中的示例项目包含了配置<code>@Runtime</code>的不同选项的例子。可以从查看money-tasks项目开始。引用代理类的示例在money-delegates项目中。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="eclipseDesignerPropertyTypes">参数类型</h5>
<div class="paragraph">
<p>这个章节介绍了<code>CustomServiceTask</code>能够使用的参数类型，可以将类型设置为<code>PropertyType</code>的值。</p>
</div>
<div class="sect5">
<h6 id="_propertytype_text">PropertyType.TEXT</h6>
<div class="paragraph">
<p>创建如下所示的单行文本字段。可以是必填字段，并将验证消息作为提示信息显示。验证失败会将字段的背景变为浅红色。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.text.invalid.png" alt="designer.property.text.invalid">
</div>
</div>
</div>
<div class="sect5">
<h6 id="_propertytype_multiline_text">PropertyType.MULTILINE_TEXT</h6>
<div class="paragraph">
<p>创建如下所示的多行文本字段（高度固定为80像素）。可以是必填字段，并将验证消息作为提示信息显示。验证失败会将字段的背景变为浅红色。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.multiline.text.invalid.png" alt="designer.property.multiline.text.invalid">
</div>
</div>
</div>
<div class="sect5">
<h6 id="_propertytype_period">PropertyType.PERIOD</h6>
<div class="paragraph">
<p>创建一个组合编辑框，可以使用转盘控件编辑每一个单位的数量，来指定一段时间长度，结果如下所示。可以是必填字段（含义是不能所有的值都是0，也就是至少有一个部分要有非零值），并将验证消息作为提示信息显示。验证失败会将整个字段的背景变为浅红色。字段的值保存为1y 2mo 3w 4d 5h 6m 7s格式的字符串，代表1年，2月，3周，4天，6分钟及7秒。即使有部分为0，也总是存储整个字符串。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.period.png" alt="designer.property.period">
</div>
</div>
</div>
<div class="sect5">
<h6 id="_propertytype_boolean_choice">PropertyType.BOOLEAN_CHOICE</h6>
<div class="paragraph">
<p>创建一个单独的boolean复选框，或者开关选择。请注意可以在<code>Property</code>注解上指定<code>required</code>属性，但不会生效，不然用户就无法选择是否选中复选框。流程图中存储的值为java.lang.Boolean.toString(boolean)，其结果为"true"或"false"。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.boolean.choice.png" alt="designer.property.boolean.choice">
</div>
</div>
</div>
<div class="sect5">
<h6 id="_propertytype_radio_choice">PropertyType.RADIO_CHOICE</h6>
<div class="paragraph">
<p>创建如下所示的一组单选按钮。选中任何一个单选按钮都自动排除任何其他的选择（也就是说，单选）。可以是必填字段，并将验证消息作为提示信息显示。验证失败会将组的背景变为浅红色。</p>
</div>
<div class="paragraph">
<p>这个参数类型需要注解的类成员同时使用<code>@PropertyItems</code>注解（例如如下所示）。可以使用这个额外的注解，以字符串数组的方式，指定条目的列表。需要为每一个条目添加两个数组项：第一个，用于显示的标签；第二个，用于存储的值。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-nd">@Property</span><span class="tok-o">(</span><span class="tok-n">type</span> <span class="tok-o">=</span> <span class="tok-n">PropertyType</span><span class="tok-o">.</span><span class="tok-na">RADIO_CHOICE</span><span class="tok-o">,</span> <span class="tok-n">displayName</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Withdrawl limit&quot;</span><span class="tok-o">,</span> <span class="tok-n">required</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">)</span>
<span class="tok-nd">@Help</span><span class="tok-o">(</span><span class="tok-n">displayHelpShort</span> <span class="tok-o">=</span> <span class="tok-s">&quot;最大每日提款限额 The maximum daily withdrawl amount &quot;</span><span class="tok-o">,</span>
    <span class="tok-n">displayHelpLong</span> <span class="tok-o">=</span> <span class="tok-s">&quot;选择从该账户中每日最大能提取的额度。 Choose the maximum daily amount that can be withdrawn from the account.&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@PropertyItems</span><span class="tok-o">({</span> <span class="tok-n">LIMIT_LOW_LABEL</span><span class="tok-o">,</span> <span class="tok-n">LIMIT_LOW_VALUE</span><span class="tok-o">,</span> <span class="tok-n">LIMIT_MEDIUM_LABEL</span><span class="tok-o">,</span> <span class="tok-n">LIMIT_MEDIUM_VALUE</span><span class="tok-o">,</span>
    <span class="tok-n">LIMIT_HIGH_LABEL</span><span class="tok-o">,</span> <span class="tok-n">LIMIT_HIGH_VALUE</span> <span class="tok-o">})</span>
<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">withdrawlLimit</span><span class="tok-o">;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.radio.choice.png" alt="designer.property.radio.choice">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.radio.choice.invalid.png" alt="designer.property.radio.choice.invalid">
</div>
</div>
</div>
<div class="sect5">
<h6 id="_propertytype_combobox_choice">PropertyType.COMBOBOX_CHOICE</h6>
<div class="paragraph">
<p>创建如下所示的，带有固定选项的下拉框。可以是必填字段，并将验证消息作为提示信息显示。验证失败会将下拉框的背景变为浅红色。</p>
</div>
<div class="paragraph">
<p>这个参数类型需要注解的类成员同时使用<code>@PropertyItems</code>注解（例如如下所示）。可以使用这个额外的注解，以字符串数组的方式，指定条目的列表。需要为每一个条目添加两个数组项：第一个，用于显示的标签；第二个，用于存储的值。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-nd">@Property</span><span class="tok-o">(</span><span class="tok-n">type</span> <span class="tok-o">=</span> <span class="tok-n">PropertyType</span><span class="tok-o">.</span><span class="tok-na">COMBOBOX_CHOICE</span><span class="tok-o">,</span> <span class="tok-n">displayName</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Account type&quot;</span><span class="tok-o">,</span> <span class="tok-n">required</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">)</span>
<span class="tok-nd">@Help</span><span class="tok-o">(</span><span class="tok-n">displayHelpShort</span> <span class="tok-o">=</span> <span class="tok-s">&quot;账户的类型 The type of account&quot;</span><span class="tok-o">,</span>
    <span class="tok-n">displayHelpLong</span> <span class="tok-o">=</span> <span class="tok-s">&quot;从选项列表中选择账户的类型 Choose a type of account from the list of options&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@PropertyItems</span><span class="tok-o">({</span> <span class="tok-n">ACCOUNT_TYPE_SAVINGS_LABEL</span><span class="tok-o">,</span> <span class="tok-n">ACCOUNT_TYPE_SAVINGS_VALUE</span><span class="tok-o">,</span> <span class="tok-n">ACCOUNT_TYPE_JUNIOR_LABEL</span><span class="tok-o">,</span>
    <span class="tok-n">ACCOUNT_TYPE_JUNIOR_VALUE</span><span class="tok-o">,</span> <span class="tok-n">ACCOUNT_TYPE_JOINT_LABEL</span><span class="tok-o">,</span> <span class="tok-n">ACCOUNT_TYPE_JOINT_VALUE</span><span class="tok-o">,</span>
    <span class="tok-n">ACCOUNT_TYPE_TRANSACTIONAL_LABEL</span><span class="tok-o">,</span> <span class="tok-n">ACCOUNT_TYPE_TRANSACTIONAL_VALUE</span><span class="tok-o">,</span> <span class="tok-n">ACCOUNT_TYPE_STUDENT_LABEL</span><span class="tok-o">,</span>
    <span class="tok-n">ACCOUNT_TYPE_STUDENT_VALUE</span><span class="tok-o">,</span> <span class="tok-n">ACCOUNT_TYPE_SENIOR_LABEL</span><span class="tok-o">,</span> <span class="tok-n">ACCOUNT_TYPE_SENIOR_VALUE</span> <span class="tok-o">})</span>
<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">accountType</span><span class="tok-o">;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.combobox.choice.png" alt="designer.property.combobox.choice">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.combobox.choice.invalid.png" alt="designer.property.combobox.choice.invalid">
</div>
</div>
</div>
<div class="sect5">
<h6 id="_propertytype_date_picker">PropertyType.DATE_PICKER</h6>
<div class="paragraph">
<p>创建如下所示的日期选择控件。可以是必填字段，并将验证消息作为提示信息显示（请注意，这个控件会自动填入当前系统时间，因此值很难为空）。验证失败会将控件的背景变为浅红色。</p>
</div>
<div class="paragraph">
<p>这个参数类型需要注解的类成员同时使用<code>@DatePickerProperty</code>注解（例如如下所示）。可以使用这个额外的注解，指定在流程图中存储日期时使用的日期格式，以及要用于显示的日期选择类型。这些属性都是可选的，当没有指定时会使用默认值（<code>DatePickerProperty</code>注解的静态变量）。<code>dateTimePattern</code>属性应该使用<code>SimpleDateFormat</code>类支持的格式。当使用<code>swtStyle</code>属性时，应该指定<code>SWT</code>的<code>DateTime</code>控件支持的整形值，因为将使用这个控件渲染这个类型的参数。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nd">@Property</span><span class="tok-o">(</span><span class="tok-n">type</span> <span class="tok-o">=</span> <span class="tok-n">PropertyType</span><span class="tok-o">.</span><span class="tok-na">DATE_PICKER</span><span class="tok-o">,</span> <span class="tok-n">displayName</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Expiry date&quot;</span><span class="tok-o">,</span> <span class="tok-n">required</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">)</span>
<span class="tok-nd">@Help</span><span class="tok-o">(</span><span class="tok-n">displayHelpShort</span> <span class="tok-o">=</span> <span class="tok-s">&quot;账户过期的日期 The date the account expires.&quot;</span><span class="tok-o">,</span>
    <span class="tok-n">displayHelpLong</span> <span class="tok-o">=</span> <span class="tok-s">&quot;选择一个日期，如果账户未在该日期前延期，则将过期。Choose the date when the account will expire if not extended before the date.&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@DatePickerProperty</span><span class="tok-o">(</span><span class="tok-n">dateTimePattern</span> <span class="tok-o">=</span> <span class="tok-s">&quot;MM-dd-yyyy&quot;</span><span class="tok-o">,</span> <span class="tok-n">swtStyle</span> <span class="tok-o">=</span> <span class="tok-mi">32</span><span class="tok-o">)</span>
<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">expiryDate</span><span class="tok-o">;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.date.picker.png" alt="designer.property.date.picker">
</div>
</div>
</div>
<div class="sect5">
<h6 id="_propertytype_data_grid">PropertyType.DATA_GRID</h6>
<div class="paragraph">
<p>创建一个如下所示的数据表格控件。数据表格可以让用户输入任意行数据，并为每一行输入固定列数的值（每一组行列的组合代表一个单元格）。用户可以添加与删除行。</p>
</div>
<div class="paragraph">
<p>这个参数类型需要注解的类成员同时使用<code>@DataGridProperty</code>注解（例如如下所示）。可以使用这个额外的注解，指定数据表格的细节属性。需要用<code>itemClass</code>属性引用另一个类，来决定表格中有哪些列。Flowable Designer期望其成员类型为<code>List</code>。按照约定，可以将<code>itemClass</code>属性的类用作其泛型类型。如果，例如，在表格中编辑一个杂货清单，用<code>GroceryListItem</code>类定义表格的列。在<code>CustomServiceTask</code>中，可以这样引用它：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nd">@Property</span><span class="tok-o">(</span><span class="tok-n">type</span> <span class="tok-o">=</span> <span class="tok-n">PropertyType</span><span class="tok-o">.</span><span class="tok-na">DATA_GRID</span><span class="tok-o">,</span> <span class="tok-n">displayName</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Grocery List&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@DataGridProperty</span><span class="tok-o">(</span><span class="tok-n">itemClass</span> <span class="tok-o">=</span> <span class="tok-n">GroceryListItem</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-kd">private</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">GroceryListItem</span><span class="tok-o">&gt;</span> <span class="tok-n">groceryList</span><span class="tok-o">;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>与<code>CustomServiceTask</code>一样，"itemClass"可以使用相同的注解指定字段类型（除了数据表格）。目前支持<code>TEXT</code>，<code>MULTILINE_TEXT</code> 与<code>PERIOD</code>。你会注意到不论其<code>PropertyType</code>是什么，表格都会为每个字段创建一个单行文本控件。这是为了表格保持整洁与可读。如果考虑下<code>PERIOD</code>这种<code>PropertyType</code>的显示模式，就可以想象出它绝不适合在表格的单元格中显示。对于 <code>MULTILINE_TEXT</code> 与<code>PERIOD</code>，会为每个字段添加双击机制，并会为该<code>PropertyType</code>弹出更大的编辑器。数值将在用户点击OK后存储至字段，因此可以在表格中显示。</p>
</div>
<div class="paragraph">
<p>必选属性使用与普通<code>TEXT</code>字段类似的方式处理，当任何字段失去焦点时，会验证整个表格。验证失败的单元格，背景色将变为浅红色。</p>
</div>
<div class="paragraph">
<p>默认情况下，这个组件允许用户添加行，但不能决定行的顺序。如果希望允许排序，需要将<code>orderable</code>属性设置为true，这将在每一行末尾启用按钮，以将该行在表格内上移或下移。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>目前，这个参数类型不能正确注入运行时类。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.property.datagrid.png" alt="designer.property.datagrid">
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_disabling_default_shapes_in_the_palette">在画板中禁用默认图形</h5>
<div class="paragraph">
<p>这种自定义需要在你的扩展中引入一个实现了<code>DefaultPaletteCustomizer</code>接口的类。不应该直接实现这个接口，而要扩展<code>AbstractDefaultPaletteCustomizer</code>基类。目前，这个类不提供任何功能，但<code>DefaultPaletteCustomizer</code>未来的版本中会提供更多功能，这样基类将提供更多合理的默认值。因此最好使用它的子类，这样你的扩展将可以兼容未来的版本。</p>
</div>
<div class="paragraph">
<p>扩展<code>AbstractDefaultPaletteCustomizer</code>需要实现一个方法，<code>disablePaletteEntries()</code>，并必须返回一个<code>PaletteEntry</code>值的list。请注意如果从默认集合中移除图形，导致某个抽屉中没有图形，则该抽屉也会被移除。如果需要禁用所有的默认图形，只需要在结果中添加<code>PaletteEntry.ALL</code>。作为例子，下面的代码禁用了画板中的手动任务和脚本任务图形。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyPaletteCustomizer</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractDefaultPaletteCustomizer</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">PaletteEntry</span><span class="tok-o">&gt;</span> <span class="tok-nf">disablePaletteEntries</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">PaletteEntry</span><span class="tok-o">&gt;</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">PaletteEntry</span><span class="tok-o">&gt;();</span>
    <span class="tok-n">result</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">PaletteEntry</span><span class="tok-o">.</span><span class="tok-na">MANUAL_TASK</span><span class="tok-o">);</span>
    <span class="tok-n">result</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">PaletteEntry</span><span class="tok-o">.</span><span class="tok-na">SCRIPT_TASK</span><span class="tok-o">);</span>
    <span class="tok-k">return</span> <span class="tok-n">result</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>应用这个扩展的结果在下图显示。可以看到，在<code>Tasks</code>抽屉中不再显示手动任务与脚本任务图形。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.palette.disable.manual.and.script.png" alt="designer.palette.disable.manual.and.script">
</div>
</div>
<div class="paragraph">
<p>要禁用所有默认图形，需要使用类似下面的代码。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyPaletteCustomizer</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractDefaultPaletteCustomizer</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">PaletteEntry</span><span class="tok-o">&gt;</span> <span class="tok-nf">disablePaletteEntries</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">PaletteEntry</span><span class="tok-o">&gt;</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">PaletteEntry</span><span class="tok-o">&gt;();</span>
    <span class="tok-n">result</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">PaletteEntry</span><span class="tok-o">.</span><span class="tok-na">ALL</span><span class="tok-o">);</span>
    <span class="tok-k">return</span> <span class="tok-n">result</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>结果像是这样（请注意画板中不再显示默认图形所在的抽屉）：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/designer.palette.disable.all.png" alt="designer.palette.disable.all">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_validating_diagrams_and_exporting_to_custom_output_formats">13.5.2. 验证流程图与输出为自定义格式</h4>
<div class="paragraph">
<p>除了自定义画板，也可以为Flowable Designer创建扩展，来进行流程图验证，以及将流程图的信息保存为Eclipse工作空间中的自定义资源。可以通过内建的扩展点实现 ，这个章节将介绍如何做。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>保存功能最近正在重构。我们仍在开发验证功能。下面的文档记录的是旧的情况，并将在新功能可用后更新。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Flowable Designer可以编写用于验证流程图的扩展。默认情况已经可以在工具中验证BPMN结构，但你也可以添加自己的，如果希望验证额外的条目，例如建模约定，或者<code>CustomServiceTask</code>中的参数值。这些扩展被称作<code>Process Validators</code>。</p>
</div>
<div class="paragraph">
<p>也可以自定义配置，在Flowable Designer保存流程图时，发布为其它格式。这些扩展被称作<code>Export Marshallers</code>，将在每次用户进行保存操作时，由Flowable Designer自动调用。这个行为可以在Eclipse配置对话框中，为每一种扩展检测出的格式，分别启用或禁用。Designer会根据用户的配置，确保在保存流程图时，调用你的<code>ExportMarshaller</code>。</p>
</div>
<div class="paragraph">
<p>通常，会想要将<code>ProcessValidator</code>与<code>ExportMarshaller</code>一起使用。例如有一些<code>CustomServiceTask</code>，带有一些希望在流程中使用的参数。然而，在生成流程前，希望验证其中一些值。联合使用<code>ProcessValidator</code>与<code>ExportMarshaller</code>是最佳的方式，Flowable Designer也允许你无缝拼接扩展。</p>
</div>
<div class="paragraph">
<p>要创建一个<code>ProcessValidator</code>或<code>ExportMarshaller</code>，需要创建与扩展画板不同的扩展类型。原因很简单：你的代码会需访问比集成库中提供的更多的API。特别是，会需要使用Eclipse的类。因此从一开始，就需要创建一个Eclipse插件（可以使用Eclipse的PDE支持完成），并将其打包为自定义Eclipse产品或特性。解释开发Eclipse插件的所有细节，已经不是本用户手册的范畴，因此下面的介绍仅限于扩展Flowable Designer的功能。</p>
</div>
<div class="paragraph">
<p>扩展包需要依赖下列库：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>org.eclipse.core.runtime</p>
</li>
<li>
<p>org.eclipse.core.resources</p>
</li>
<li>
<p>org.flowable.designer.eclipse</p>
</li>
<li>
<p>org.flowable.designer.libs</p>
</li>
<li>
<p>org.flowable.designer.util</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>可选的，如果希望在扩展中使用，可以通过Designer使用org.apache.commons.lang包。</p>
</div>
<div class="paragraph">
<p><code>ProcessValidator</code>与<code>ExportMarshaller</code>都是通过扩展基类创建的。这些基类从其父类<code>AbstractDiagramWorker</code>继承了一些有用的方法。使用这些方法，可以创建在Eclipse问题视图中显示的提示信息，警告，错误标记，以便用户了解错误与重要的信息。可以以<code>Resources</code>与<code>InputStreams</code>的格式获取流程图的信息，这些信息由<code>DiagramWorkerContext</code>提供，在<code>AbstractDiagramWorker</code>中可用。</p>
</div>
<div class="paragraph">
<p>不论是<code>ProcessValidator</code>还是<code>ExportMarshaller</code>中，做任何事情前最好调用<code>clearMarkers()</code>；这将清除任何已有的标记（标记自动连接至操作，清除一个操作的标记不会影响其他操作的标记）。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-c1">// 首先清除流程图的标记 Clear markers for this diagram first</span>
<span class="tok-n">clearMarkersForDiagram</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也需要使用（<code>DiagramWorkerContext</code>中）提供的进度监控，将你的进度报告给用户，因为验证与保存操作可能花费很多时间，而用户只能等待。报告进度需要了解如何使用Eclipse的功能。查看<a href="http://www.eclipse.org/articles/Article-Progress-Monitors/article.html">这篇文章</a>了解详细概念与用法。</p>
</div>
<div class="sect4">
<h5 id="_creating_a_processvalidator_extension">创建ProcessValidator扩展</h5>
<div class="paragraph">
<p>在你的<code>plugin.xml</code>文件中，创建一个<code>org.flowable.designer.eclipse.extension.validation.ProcessValidator</code>扩展点的扩展。这个扩展点需要扩展<code>AbstractProcessValidator</code>类。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-cp">&lt;?eclipse version=&quot;3.6&quot;?&gt;</span>
<span class="tok-nt">&lt;plugin&gt;</span>
  <span class="tok-nt">&lt;extension</span>
    <span class="tok-na">point=</span><span class="tok-s">&quot;org.flowable.designer.eclipse.extension.validation.ProcessValidator&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;ProcessValidator</span>
      <span class="tok-na">class=</span><span class="tok-s">&quot;org.acme.validation.AcmeProcessValidator&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;/ProcessValidator&gt;</span>
  <span class="tok-nt">&lt;/extension&gt;</span>
<span class="tok-nt">&lt;/plugin&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AcmeProcessValidator</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractProcessValidator</span> <span class="tok-o">{</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>需要实现一些方法。最重要的是实现<code>getValidatorId()</code>，为验证器返回全局唯一ID。这将使你可以在<code>ExportMarshaller</code>中调用它，或者允许其他<code>ExportMarshaller</code>调用你的验证器。实现<code>getValidatorName()</code>，为验证器返回逻辑名字。这个名字将在对话框中显示给用户。<code>getFormatName()</code>可以返回这个验证器通常验证的流程图类型。</p>
</div>
<div class="paragraph">
<p>验证工作通过<code>validateDiagram()</code>方法实现。从这里开始，就是你自己的功能代码了。然而，通常你会想从获取流程中的所有节点开始，这样就可以迭代访问，收集、比较与验证数据了。这段代码展示了如何进行这些操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-kd">final</span> <span class="tok-n">EList</span><span class="tok-o">&lt;</span><span class="tok-n">EObject</span><span class="tok-o">&gt;</span> <span class="tok-n">contents</span> <span class="tok-o">=</span> <span class="tok-n">getResourceForDiagram</span><span class="tok-o">(</span><span class="tok-n">diagram</span><span class="tok-o">).</span><span class="tok-na">getContents</span><span class="tok-o">();</span>
<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">EObject</span> <span class="tok-n">object</span> <span class="tok-o">:</span> <span class="tok-n">contents</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">object</span> <span class="tok-k">instanceof</span> <span class="tok-n">StartEvent</span> <span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-c1">// 验证启动事件 Perform some validations for StartEvents</span>
  <span class="tok-o">}</span>
  <span class="tok-c1">// 其它节点类型与验证 Other node types and validations</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>别忘了在验证过程中调用<code>addProblemToDiagram()</code>与/或<code>addWarningToDiagram()</code>等等。确保在结束时返回正确的boolean结果，以指示验证成功还是失败。可以由后续调用的<code>ExportMarshaller</code>判断下一步操作。</p>
</div>
</div>
<div class="sect4">
<h5 id="_creating_an_exportmarshaller_extension">创建ExportMarshaller扩展</h5>
<div class="paragraph">
<p>在你的<code>plugin.xml</code>文件中，创建一个<code>org.flowable.designer.eclipse.extension.ExportMarshaller</code>扩展点的扩展。这个扩展点需要扩展<code>AbstractExportMarshaller</code>类。这个基类提供了一些在保存为你自己的格式时有用的方法，但最重要的是提供了将资源保存至工作空间，以及调用验证器的功能。</p>
</div>
<div class="paragraph">
<p>Designer的示例目录下有一个示例实现。这个示例展示了如何使用基类中的方法完成基本操作，例如访问流程图的<code>InputStream</code>，使用其<code>BpmnModel</code>，以及将资源保存至工作空间。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-cp">&lt;?eclipse version=&quot;3.6&quot;?&gt;</span>
<span class="tok-nt">&lt;plugin&gt;</span>
  <span class="tok-nt">&lt;extension</span>
    <span class="tok-na">point=</span><span class="tok-s">&quot;org.flowable.designer.eclipse.extension.ExportMarshaller&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;ExportMarshaller</span>
      <span class="tok-na">class=</span><span class="tok-s">&quot;org.acme.export.AcmeExportMarshaller&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;/ExportMarshaller&gt;</span>
  <span class="tok-nt">&lt;/extension&gt;</span>
  <span class="tok-nt">&lt;/plugin&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AcmeExportMarshaller</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractExportMarshaller</span> <span class="tok-o">{</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>需要实现一些方法，例如<code>getMarshallerName()</code>与<code>getFormatName()</code>。这些方法用来为用户显示选项，并在流程对话框中显示信息，因此请确保你返回的描述反映了正在进行的操作。</p>
</div>
<div class="paragraph">
<p>大部分工作主要在<code>doMarshallDiagram()</code>方法中进行。</p>
</div>
<div class="paragraph">
<p>如果需要先进行一些验证，可以直接从保存器中调用验证器。从验证器可以获得boolean结果，就可以知道验证是否成功。在大多数情况下，在流程图验证失败时不会想要进行保存，但你也可以选择仍然继续，甚至在验证失败时创建不同的资源。</p>
</div>
<div class="paragraph">
<p>一旦获取了所有需要的数据，就可以调用<code>saveResource()</code>方法创建保存有数据的文件。在一个保存器中，可以调用<code>saveResource()</code>任意多次；因此一个验证器可以创建多于一个输出文件。</p>
</div>
<div class="paragraph">
<p>可以使用<code>AbstractDiagramWorker</code>类的<code>saveResource()</code>方法构建输出资源的文件名。可以使用一些有用的变量用于创建文件名，例如_original-filename__my-format-name.xml。这些变量在Javadocs中描述，通过<code>ExportMarshaller</code>接口定义。如果希望自行解析保存位置，也可以在一个字符串（例如一个路径）上使用<code>resolvePlaceholders()</code>。<code>getURIRelativeToDiagram()</code>会为你调用它。</p>
</div>
<div class="paragraph">
<p>应该使用提供的进度监控将你的进度报告给用户。<a href="http://www.eclipse.org/articles/Article-Progress-Monitors/article.html">这个文章</a>描述了如何做。</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="flowableUIApps">14. Flowable UI应用</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Flowable提供了几个web应用，用于演示及介绍Flowable项目提供的功能：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Flowable IDM: 身份管理应用。为所有Flowable UI应用提供单点登录认证功能，并且为拥有IDM管理员权限的用户提供了管理用户、组与权限的功能。</p>
</li>
<li>
<p>Flowable Modeler: 让具有建模权限的用户可以创建流程模型、表单、选择表与应用定义。</p>
</li>
<li>
<p>Flowable Task: 运行时任务应用。提供了启动流程实例、编辑任务表单、完成任务，以及查询流程实例与任务的功能。</p>
</li>
<li>
<p>Flowable Admin: 管理应用。让具有管理员权限的用户可以查询BPMN、DMN、Form及Content引擎，并提供了许多选项用于修改流程实例、任务、作业等。管理应用通过REST API连接至引擎，并与Flowable Task应用及Flowable REST应用一同部署。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>所有其他的应用都需要Flowable IDM提供认证。每个应用的WAR文件可以部署在相同的servlet容器（如Apache Tomcat）中，也可以部署在不同的容器中。由于每个应用使用相同的cookie进行认证，因此应用需要运行在相同的域名下。</p>
</div>
<div class="paragraph">
<p>应用基于Spring Boot 2.0。也就是说WAR文件实际上可以作为独立应用直接运行。参见Spring Boot文档中的<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/build-tool-plugins-maven-plugin.html#build-tool-plugins-maven-packaging">可执行的Jar</a>章节。</p>
</div>
<div class="sect2">
<h3 id="uiAppInstallation">14.1. 安装</h3>
<div class="paragraph">
<p>如前所述，全部四个UI应用可以部署在同一个Tomcat服务器里，并且作为入门，这大概也是最简单的方式。也可以选择只安装Modeler应用，但是必须也要部署、运行Flowable IDM应用。在这个安装指导中，我们会介绍如何将所有的四个应用安装至Tomcat服务。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>下载最新稳定版本的<a href="http://tomcat.apache.org">Apache Tomcat</a>。</p>
</li>
<li>
<p>下载最新稳定版本的<a href="http://www.flowable.org/downloads.html">Flowable 6</a>。</p>
</li>
<li>
<p>将Flowable发行包中，<em>wars</em>文件夹下的flowable-admin.war、flowable-idm.war、flowable-modeler.war与flowable-task.war文件，复制到Tomcat的webapps文件夹下。</p>
</li>
<li>
<p>运行bin/startup.sh（在Mac OS或Linux下），或bin/startup.bat（在Windows下）脚本，启动Tomcat服务器。</p>
</li>
<li>
<p>打开web浏览器，访问<a href="http://localhost:8080/flowable-modeler"><a href="http://localhost:8080/flowable-modeler" class="bare">http://localhost:8080/flowable-modeler</a></a>。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>这样所有的Flowable UI应用都将运行在H2内存数据库下，并且可以在浏览器中看到如下登录界面：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_idm_login_screen.png" alt="flowable idm login screen">
</div>
</div>
<div class="paragraph">
<p>默认情况下，Flowable IDM应用将创建一个具有访问所有Flowable UI应用所需的权限的admin用户。使用admin/test登录，浏览器会跳转至Flowable Modeler应用：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_startup_screen.png" alt="flowable modeler startup screen">
</div>
</div>
<div class="paragraph">
<p>作为可执行的Spring Boot应用，可以直接以独立应用模式运行UI，而不需要应用服务器。
可以像这样启动一个应用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>java -jar flowable-idm.war</code></pre>
</div>
</div>
<div class="paragraph">
<p>通常会需要将默认的H2内存数据库配置，修改为MySQL或Postgres（或其他持久化数据库）。
可以修改每个应用<em>WEB-INF/classes/</em>文件夹下的application.properties。
也可以使用Spring Boot的<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html">显式配置</a>。
<a href="https://github.com/flowable/flowable-engine/blob/master/modules/flowable-ui-task/flowable-ui-task-app/src/main/resources/application.properties">Github</a>上也提供了配置示例。
要将默认配置修改为MySQL，需要如下修改配置文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="linenums"><span></span>spring.datasource.driver-class-name=com.mysql.jdbc.Driver
spring.datasource.url=jdbc:mysql://127.0.0.1:3306/flowable?characterEncoding=UTF-8
spring.datasource.username=flowable
spring.datasource.password=flowable</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个配置需要MySQL服务器中有一个flowable数据库，UI应用会自动生成必要的数据库表。对于Postgres，需要做如下修改：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="linenums"><span></span>spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.url=jdbc:postgresql://localhost:5432/flowable
spring.datasource.username=flowable
spring.datasource.password=flowable</code></pre>
</div>
</div>
<div class="paragraph">
<p>除了修改配置，还需要确保在classpath中有对应的数据库驱动。类似的，可以对每个web应用分别操作，将驱动JAR文件添加到WEB-INF/lib目录下；也可以直接将JAR文件添加到Tomcat的lib目录下。MySQL与Postgres的数据库驱动可以从这里下载：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MySQL: <a href="https://dev.mysql.com/downloads/connector/j"><a href="https://dev.mysql.com/downloads/connector/j" class="bare">https://dev.mysql.com/downloads/connector/j</a></a></p>
</li>
<li>
<p>Postgres: <a href="https://jdbc.postgresql.org/"><a href="https://jdbc.postgresql.org/" class="bare">https://jdbc.postgresql.org/</a></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以独立应用方式运行应用时，可以使用 <code>loader.path</code> 参数添加数据库驱动。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>java -Dloader.path=/location/to/your/driverfolder -jar flowable-idm.war</code></pre>
</div>
</div>
<div class="paragraph">
<p>参阅Spring Boot文档<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/executable-jar.html#executable-jar-property-launcher-features"><code>PropertiesLauncher</code> 功能</a>介绍了解更多信息。</p>
</div>
</div>
<div class="sect2">
<h3 id="_flowable_ui_applications_configurations">14.2. 配置Flowable UI应用</h3>
<div class="paragraph">
<p>作为Spring Boot应用，Flowable UI应用可以使用Spring Boot提供的全部参数。
参阅Spring Boot文档的<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html">显式配置</a>章节，了解如何进行自定义配置。</p>
</div>
<div class="paragraph">
<p>提示：也可以使用YAML格式的配置文件。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. 通用UI应用参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">原参数</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.idm-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">idm.app.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDM应用的URL，用于获取用户信息与令牌信息的REST GET调用。也用做UI应用重定向的登录页。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.idm-redirect-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">idm.app.redirect.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDM应用的重定向URL，在未设置cookie或cookie失效时，重定向至该页面进行登录。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.redirect-on-auth-success</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">app.redirect.url.on.authsuccess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">登录成功后需要重定向的页面URL。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.role-prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ROLE_</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Security需要的默认角色前缀。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.tenant-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DefaultTenantProvider所用的静态租户id。modeler用来判断需要将模型存储及发布在哪个租户id下。
 当未设置该值、值为空，或只包含空白时：如果能够获取用户的租户id，则会使用该租户id；否则不使用租户id。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.cache-login-tokens.max-age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache.login-tokens.max.age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">login token的缓存时间，以秒记。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.cache-login-tokens.max-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache.login-tokens.max.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">login token缓存的最大尺寸。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.cache-login-users.max-age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache.login-users.max.age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">login user的缓存时间，以秒记。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.cache-login-users.max-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache.login-users.max.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">login user缓存的最大尺寸。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.cache-users.max-age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache.users.max.age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">user的缓存时间，以秒记。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.cache-users.max-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache.users.max.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">user缓存的最大尺寸。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.idm-admin.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">idm.admin.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">对IDM REST服务进行REST调用（使用基础认证）的密码。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.common.app.idm-admin.user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">idm.admin.user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">对IDM REST服务进行REST调用（使用基础认证）的用户名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.rest.app.authentication-mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rest.authentication.mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">verify-privilege</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置REST API验证用户身份的方式：
 <em>any-user</em> ：用户存在且密码匹配。任何用户都可以进行调用（6.3.0之前的方式）
 <em>verify-privilege</em> :用户存在且密码匹配，并且用户拥有<em>rest-api</em>权限</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>一些旧参数改由Flowable Spring Boot starter（或Spring Boot）进行管理</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. 由Flowable Spring Boot Starter管理的旧参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">原参数</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.async-executor-activate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">engine.process.asyncexecutor.activate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否启用异步执行器。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.database-schema-update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">engine.process.schema.update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否执行数据库表结构升级。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.history-level</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">engine.process.history.level</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">历史级别。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.process.servlet.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.rest-api-servlet-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flowable BPMN Rest API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程servlet的名字。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.process.servlet.path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.rest-api-mapping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/process-api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程REST servlet的上下文路径。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.content.storage.create-root</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">contentstorage.fs.create-root</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果root目录不存在，是否需要创建它？</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.content.storage.root-folder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">contentstorage.fs.root-folder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">存储内容文件（任务附件、表单上传文件等）的root目录。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.db-identity-used</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否启动IDM引擎。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.password-encoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.passwordencoder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">密码加密方式。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.base-dn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.basedn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询用户及组的基础DN（<em>标识名 distinguished name</em>）。如果用户及组使用不同的基础DN，请改用<em>user-base-dn</em>及<em>group-base-dn</em>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否启用LDAP IDM服务。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接LDAP系统所用的密码。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP系统的端口号。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP系统所在的服务器地址。例如<em>ldap://localhost</em>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接LDAP系统所用的用户ID。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.attribute.email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.attribute.email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户邮件地址的LDAP属性名。用于查询并将LDAP对象映射至Flowable <em>org.flowable.idm.api.User</em>对象。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.attribute.first-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.attribute.firstname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户名字的LDAP属性名。用于查询并将LDAP对象映射至Flowable <em>org.flowable.idm.api.User</em>对象。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.attribute.group-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.attribute.groupid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户组ID的LDAP属性名。用于查询并将LDAP对象映射至Flowable <em>org.flowable.idm.api.Group</em>对象。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.attribute.group-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.attribute.groupname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户组名称的LDAP属性名。用于查询并将LDAP对象映射至Flowable <em>org.flowable.idm.api.Group</em>对象。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.attribute.last-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.attribute.lastname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户姓的LDAP属性名。用于查询并将LDAP对象映射至Flowable <em>org.flowable.idm.api.User</em>对象。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.attribute.user-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.attribute.userid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户ID的LDAP属性名。用于查询并将LDAP对象映射至Flowable <em>org.flowable.idm.api.User</em>对象。仅在使用Flowable API查询<em>org.flowable.idm.api.User</em>对象时需要设置。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.cache.group-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.cache.groupsize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设置<em>org.flowable.ldap.LDAPGroupCache</em>缓存的尺寸。
这是用户所在组的LRU缓存。避免每次需要查询用户所在组时都访问LDAP系统。
若值小于0，则不会启用缓存。默认值为-1，所以不会进行缓存。
请注意组缓存在<em>org.flowable.ldap.LDAPIdentityServiceImpl</em>中初始化。
因此，自行实现<em>org.flowable.ldap.LDAPIdentityServiceImpl</em>时，请不要忘记添加组缓存功能。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.query.all-groups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.query.groupall</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询所有组所用的语句。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.query.all-users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.query.userall</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询所有用户所用的语句。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.query.groups-for-user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.query.groupsforuser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询给定用户所在组所用的语句。
 比如：<code>(&amp;(objectClass=groupOfUniqueNames)(uniqueMember={0}))</code>
 返回LDAP中所有<em>groupOfUniqueNames</em>类、DN为<em>uniqueMember</em>的对象。
 上例中，使用{@link java.text.MessageFormat}即<em>{0}</em>注入用户ID。
 如果不能通过简单的语句进行查询，可以改用 <code>org.flowable.ldap.LDAPQueryBuilder</code> ，进行定制化查询。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.query.user-by-full-name-like</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.query.userbyname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通过全名查询用户所用的语句。
 比如：<code>(&amp;(objectClass=inetOrgPerson)(|({0}=**{1}**)({2}={3})))</code>
 返回LDAP中所有<em>inetOrgPerson</em>类、姓或名匹配的对象。
 注入到表达式中的值：{0} : 名字属性名 {1} : 查询文本 {2} : 姓属性名 {3} : 查询文本
 如果不能通过简单的语句进行查询，可以改用 <code>org.flowable.ldap.LDAPQueryBuilder</code>，进行定制化查询。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.ldap.query.user-by-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap.query.userbyid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通过ID查询用户所用的语句。
 比如：<code>(&amp;(objectClass=inetOrgPerson)(uid={0}))</code>
 返回LDAP中所有<em>inetOrgPerson</em>类、<em>uid</em>属性值匹配的对象。
 上例中，使用{@link java.text.MessageFormat}即<em>{0}</em>注入用户ID。
 如果不能通过简单的语句进行查询，可以改用 <code>org.flowable.ldap.LDAPQueryBuilder</code> ，进行定制化查询。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail.server.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">email.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">localhost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件服务器地址。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail.server.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">email.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件服务器的密码。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail.server.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">email.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1025</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件服务器的端口号。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail.server.use-ssl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">email.use-ssl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否需要为SMTP协议启用SSL/TLS加密（即SMTPS/POPS）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail.server.use-tls</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">email.use-tls</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否启用STARTTLS加密。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.mail.server.username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">email.username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">邮件服务器的用户名。
 为空则不进行认证。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.process.definition-cache-limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.process-definitions.cache.max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流程定义缓存的最大数量。
 默认值为-1，即缓存所有流程定义。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. 由Spring Boot管理的旧参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">原参数</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.driver-class-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.driver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDBC驱动的全限定名。默认通过URL自动检测。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.jndi-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.jndi.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据源的JNDI。若设置JNDI，则忽略Class、url、username及password设置。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库的登录密码。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库的JDBC URL。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库的登录用户名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.connection-test-query</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.preferred-test-query</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于验证连接的SQL语句。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.connection-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.connection.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">客户端等待获取连接的最大时间，以毫秒计。如果获取连接超时，会抛出SQLException。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.idle-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.connection.idletimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接池中连接的最大空闲时间，以毫秒计。
 实际销毁连接前，会多等平均+15秒，最大+30秒的额外时间。
 不会在空闲超时前销毁连接。
 值为0代表连接池不会销毁空闲连接。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.max-lifetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.connection.maxlifetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接池中连接的最大存活时间。如果连接超过存活时间，即使该连接刚被使用过，也会被连接池销毁。不会销毁正在使用的连接，只会销毁空闲的连接。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.maximum-pool-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.connection.maxpoolsize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接池的最大容量，包括空闲及使用中的连接。这个配置决定了到数据库的实际连接数。如果连接池尺寸到达上限，且没有可用的空闲连接，则getConnection()会等待connectionTimeout设置的时间，然后超时。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.datasource.hikari.minimum-idle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.connection.minidle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HikariCP连接池保留的最小空闲连接数量。如果空闲连接数量少于设置，HikariCP会尽最大努力尽快有效地恢复。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.servlet.multipart.max-file-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">file.upload.max.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">文件的最大尺寸，可以使用“MB”或“KB”后缀。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. 不再使用的旧参数</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">旧参数</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.jndi.resource-ref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Boot不支持配置JNDI resourceRef，而是按名称直接引用。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">email.use-credentials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果邮件服务器不使用认证，直接将用户名及密码置空即可。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="flowableIDMApp">14.3. Flowable IDM应用</h3>
<div class="paragraph">
<p>Flowable IDM应用，用于其他三个Flowable web应用的认证与授权。因此如果你想要运行Modeler，Task或者Admin应用，就需要运行IDM应用。Flowable IDM应用是一个简单的身份管理应用，目标是为Flowable web应用提供单点登录能力，并提供定义用户、组与权限的能力。</p>
</div>
<div class="paragraph">
<p>IDM应用在启动时启动IDM引擎，并按照配置参数中定义的数据源创建IDM引擎所需的身份表。</p>
</div>
<div class="paragraph">
<p>当Flowable IDM应用部署及启动时，将检查是否在ACT_ID_USER表中有用户。如果没有，将在表中使用 <code>flowable.common.app.idm-admin.user</code> 参数创建默认管理员用户。
同时也会为新创建的管理员用户添加Flowable项目中的所有权限：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>access-idm: 提供管理用户、组与权限的权限</p>
</li>
<li>
<p>access-admin: 使用户可以登录Flowable Admin应用，管理Flowable引擎，以及访问所有应用的Actuator Endpoint。</p>
</li>
<li>
<p>access-modeler: 提供访问Flowable Modeler应用的权限</p>
</li>
<li>
<p>access-task: 提供访问Flowable Task应用的权限</p>
</li>
<li>
<p>access-rest-api: 提供调用REST API的权限。否则调用会返回403（无权限）HTTP状态码。请注意需要将<em>flowable.rest.app.authentication-mode</em>设置为<em>verify-privilege</em>，即默认设置。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>第一次使用admin/test登录<a href="http://localhost:8080/flowable-idm"><a href="http://localhost:8080/flowable-idm" class="bare">http://localhost:8080/flowable-idm</a></a>时，会显示如下用户总览界面：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_idm_startup_screen.png" alt="flowable idm startup screen">
</div>
</div>
<div class="paragraph">
<p>在这个界面中，可以添加、删除与更新用户。组页签用于创建、删除与更新组。在组详情界面中，可以向组添加与删除用户。权限界面为用户与组添加及删除权限：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_idm_privilege_screen.png" alt="flowable idm privilege screen">
</div>
</div>
<div class="paragraph">
<p>暂时还不能定义新的权限。但是可以为用户与组添加及删除已有的四个权限。</p>
</div>
<div class="paragraph">
<p>下表是IDM UI应用的专用参数。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. IDM UI应用参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">原参数</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.bootstrap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">idm.bootstrap.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否为IDM应用启用bootstrap。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.rest-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rest.idm-app.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">启用REST API（指的是使用基础身份认证的API，而不是UI使用的REST API）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.admin.email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin.email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin用户的邮箱。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.admin.first-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin.firstname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin用户的名字。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.admin.last-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin.lastname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin用户的姓。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.admin.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin用户的密码。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.admin.user-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin.userid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin用户的ID。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.security.remember-me-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.rememberme.key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">testKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spring Security对密码加密时所用的哈希值。请一定要修改这个参数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.security.user-validity-period</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache.users.recheck.period</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">对于可缓存的CustomUserDetailsService服务，缓存用户的时间。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.security.cookie.domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.cookie.domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cookie的域。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.security.cookie.max-age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.cookie.max-age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2678400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cookie的存活时间，以秒记。默认为31天。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.idm.app.security.cookie.refresh-age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.cookie.refresh-age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">86400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cookie的刷新周期，以秒记。默认为1天。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>除了使用默认的身份表之外，IDM应用也可以使用LDAP服务。
在application.properties文件中（或使用其他配置方式）加入下列配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="linenums"><span></span>#
# LDAP
#
flowable.idm.ldap.enabled=true
flowable.idm.ldap.server=ldap://localhost
flowable.idm.ldap.port=10389
flowable.idm.ldap.user=uid=admin, ou=system
flowable.idm.ldap.password=secret
flowable.idm.ldap.base-dn=o=flowable
flowable.idm.ldap.query.user-by-id=(&amp;(objectClass=inetOrgPerson)(uid={0}))
flowable.idm.ldap.query.user-by-full-name-like=(&amp;(objectClass=inetOrgPerson)(|({0}=*{1}*)({2}=*{3}*)))
flowable.idm.ldap.query.all-users=(objectClass=inetOrgPerson)
flowable.idm.ldap.query.groups-for-user=(&amp;(objectClass=groupOfUniqueNames)(uniqueMember={0}))
flowable.idm.ldap.query.all-groups=(objectClass=groupOfUniqueNames)
flowable.idm.ldap.attribute.user-id=uid
flowable.idm.ldap.attribute.first-name=cn
flowable.idm.ldap.attribute.last-name=sn
flowable.idm.ldap.attribute.group-id=cn
flowable.idm.ldap.attribute.group-name=cn
flowable.idm.ldap.cache.group-size=10000
flowable.idm.ldap.cache.group-expiration=180000</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>flowable.idm.ldap.enabled</code> 参数设置为true时，需要同时填入其他的LDAP参数。
在这个示例配置中使用Apache Directory的服务器配置 + LDAP查询。
其他LDAP服务器如Active Directory使用不同的配置值。</p>
</div>
<div class="paragraph">
<p>配置LDAP后将通过LDAP服务器进行认证及从组中获取用户，但仍然从Flowable身份表中获取权限。因此需要确保每一个LDAP用户都在IDM应用中定义了正确的权限。</p>
</div>
<div class="paragraph">
<p>如果IDM应用配置为使用LDAP，则启动时将检查Flowable身份表中是否存在权限。
（第一次启动时）如果没有权限，则会创建4个默认权限，并为ID为（application.properties或其他配置环境中的） <code>flowable.common.app.idm-admin.user</code> 参数的用户赋予这4个权限。
因此请确保 <code>flowable.common.app.idm-admin.user</code> 参数设置为有效的LDAP用户，否则将没有人能够登录任何Flowable UI应用。</p>
</div>
</div>
<div class="sect2">
<h3 id="flowableModelerApp">14.4. Flowable Modeler应用</h3>
<div class="paragraph">
<p>Flowable Modeler用于建模BPMN流程、DMN选择表、表单定义，以及创建应用定义。BPMN Modeler使用与Flowable 5相同的Oryx与Angular架构，只是迁移为独立的Modeler应用中。在使用Flowable Modeler应用时，请确保Flowable IDM应用已经部署并正常运行（用于认证与授权）。</p>
</div>
<div class="paragraph">
<p>使用自己的账户（或者默认的admin/test用户）登录Modeler应用后(<a href="http://localhost:8080/flowable-modeler"><a href="http://localhost:8080/flowable-modeler" class="bare">http://localhost:8080/flowable-modeler</a></a>)，可以看到流程总览页面。可以点击Create Process(创建流程)按钮或Import Process(导入流程)按钮，创建新的BPMN流程模型。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_createmodel_popup.png" alt="flowable modeler createmodel popup" width="600">
</div>
</div>
<div class="paragraph">
<p>在创建流程模型（以及其他模型）时，需要谨慎选择模型key。模型key是模型仓库中该模型的唯一标识。如果使用了已经存在的模型key，则会显示错误，模型也不会保存。</p>
</div>
<div class="paragraph">
<p>在弹出窗口中创建模型后，会显示BPMN模型画布。这个BPMN编辑器与Flowable 5中（作为Explorer的组件）的BPMN编辑器十分相像。在设计流程模型时，可以使用Flowable引擎支持的所有BPMN元素。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_design_screen.png" alt="flowable modeler design screen">
</div>
</div>
<div class="paragraph">
<p>BPMN编辑器分为4个部分：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>画板(Palette): 用于设计流程模型的所有BPMN元素</p>
</li>
<li>
<p>工具条(Toolbar): 修改模型画布的操作。如缩放、布局、保存等</p>
</li>
<li>
<p>模型画布(Model canvas): 在模型画布上拖放BPMN元素，设计流程模型</p>
</li>
<li>
<p>参数面板(Properties panel): 如果没有选择元素，则显示主流程模型的参数；否则显示所选中BPMN元素的参数</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>用户任务元素的参数面板中有一个<em>Referenced form(引用表单)</em>参数。选择这个参数会弹出窗口，使你可以在仓库中选择一个表单定义，或者创建一个新的表单。如果选择创建一个新的表单，会显示一个类似于流程模型创建对话框的弹窗。填入表单名及表单模型key之后，就会打开表单编辑器。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_formdesign_screen.png" alt="flowable modeler formdesign screen">
</div>
</div>
<div class="paragraph">
<p>可以从表单画板中将表单字段拖入表单画布。在这个例子中，在表单画布上添加了一个Name（姓名）文本框，两个日期框，以及一个Remarks（说明）多行文本框。在编辑表单字段时，可以配置Label(标签)、Id、Required(是否必填)，以及Placeholder(占位符)。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_editfield_popup.png" alt="flowable modeler editfield popup" width="600">
</div>
</div>
<div class="paragraph">
<p>id是一个重要的参数。流程使用这个id为表单字段创建流程变量。填写label参数时，会自动为id参数赋值。如果需要的话，也可以选中Override Id?(覆盖Id)复选框，并填入所需的id。</p>
</div>
<div class="paragraph">
<p>保存表单模型并关闭表单编辑器之后，（如果表单编辑器是从BPMN编辑器打开的话）会自动跳转回流程模型。再次选择用户任务元素，并点击<em>Referenced form</em>参数，就可以看到已经将新创建的表单定义附加至用户任务。点击Modeler应用头部的<em>Form(表单)</em>页签，也可以看到模型仓库中保存的所有表单定义。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_formoverview_screen.png" alt="flowable modeler formoverview screen">
</div>
</div>
<div class="paragraph">
<p>可以打开表单定义的详情界面，查看各表单定义。在详情页面中，可以修改表单名、key及描述，也可以查阅表单模型的修改历史。也可以复制表单定义，创建一个具有相同表单字段的新的表单定义。</p>
</div>
<div class="paragraph">
<p>接下来，再次打开BPMN编辑器中的vacation request（请假）流程模型，向流程模型中添加一个脚本任务，用于计算假期开始到结束之间的日数。点击<em>Script form(脚本表单)</em>参数，填入<em>groovy</em>，这样Flowable引擎就会使用Groovy脚本引擎。然后点击<em>Script(脚本)</em>参数，并填入用于计算日数的脚本。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_script_popup.png" alt="flowable modeler script popup" width="600">
</div>
</div>
<div class="paragraph">
<p>这样就定义了<em>amountOfVacationDays</em>流程变量，接下来可以在流程模型中添加一个选择任务（Decision task）。选择任务用于在Flowable DMN引擎中执行DMN选择表。使用<em>Decision table reference(引用选择表)</em>参数，创建一个新的选择表模型，并打开DMN编辑器。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_dmneditor_screen.png" alt="flowable modeler dmneditor screen">
</div>
</div>
<div class="paragraph">
<p>DMN编辑器提供了一个列表式的编辑器。包括输入列——使用流程中的流程变量定义输入条件；以及输出列——定义输出变量。在这个简单的例子里，只使用一个输入列，并使用<em>amountOfVacationDays</em>变量。如果天数少于10，<em>managerApprovalNeeded</em>变量返回值false。否则返回true。可以定义多个输入列，每条规则也可以有多个输入条件。也可以将一个输入列置空，代表其永远为true。也可以定义一个或多个输出变量。</p>
</div>
<div class="paragraph">
<p>DMN选择表定义的另一个重要部分是命中策略(Hit Policy)。目前，Flowable支持第一(First)与任意(Any)命中策略。对于第一命中策略，DMN会返回第一条计算为true的规则定义的输出变量，并停止计算。对于任意命中策略，会计算所有的规则，并输出计算为true的最后一条规则定义的输出变量。</p>
</div>
<div class="paragraph">
<p>保存并关闭DMN编辑器后，Modeler应用跳转回BPMN编辑器，并将新创建的DMN选择表附加至选择任务。在BPMN XML中生成如下的选择任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-nt">&lt;serviceTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;decisionTask&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Is manager approval needed?&quot;</span> <span class="tok-na">flowable:type=</span><span class="tok-s">&quot;dmn&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;extensionElements&gt;</span>
        <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;decisionTableReferenceKey&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;flowable:string&gt;</span><span class="tok-cp">&lt;![CDATA[managerApprovalNeeded]]&gt;</span><span class="tok-nt">&lt;/flowable:string&gt;</span>
        <span class="tok-nt">&lt;/flowable:field&gt;</span>
    <span class="tok-nt">&lt;/extensionElements&gt;</span>
<span class="tok-nt">&lt;/serviceTask&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样就可以创建带有一个条件顺序流的排他网关，以使用DMN引擎的计算结果，即<em>managerApprovalNeeded</em>变量。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_sequenceflowcondition_popup.png" alt="flowable modeler sequenceflowcondition popup" width="500">
</div>
</div>
<div class="paragraph">
<p>完整的BPMN流程模型为：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_vacationrequest_screen.png" alt="flowable modeler vacationrequest screen">
</div>
</div>
<div class="paragraph">
<p>完成流程模型之后，就可以创建应用定义(app definition)，将一个或多个流程模型及关联的模型（如选择表和表单定义）打包为一个整体。应用定义可以导出为BAR文件(zip格式)，并可以在Flowable引擎中部署。创建完成请假应用定义后，应用编辑器将如下显示。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_appeditor_screen.png" alt="flowable modeler appeditor screen">
</div>
</div>
<div class="paragraph">
<p>还可以在应用编辑器中选择图标和主题色，调整Flowable Task应用在看板(dashboard)中的显示效果。重点步骤是添加请假流程模型，并通过选择流程模型，自动引入对应的表单定义和DMN选择表。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_modelselection_popup.png" alt="flowable modeler modelselection popup">
</div>
</div>
<div class="paragraph">
<p>点击预览图选中流程模型。选择一个或多个模型之后，就可以关闭弹窗，保存并关闭应用定义。在详情页面查看新创建的请假应用定义，如下所示：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_modeler_appdetails_screen.png" alt="flowable modeler appdetails screen">
</div>
</div>
<div class="paragraph">
<p>在这个页面中，可以通过两种不同格式下载应用定义。第一个下载按钮（带有下箭头）下载每个模型的JSON格式模型文件，用于在不同的Flowable Modeler应用之间共享应用定义。第二个下载按钮（带有指向右上的箭头）下载应用定义模型的BAR文件，用于在Flowable引擎中部署。在BAR文件中，只包含了可以部署的工件，如BPMN 2.0 XML文件和DMN XML文件，而不会包含JSON模型文件。这是因为在Flowable引擎部署时，BAR文件中的所有文件都会保存在数据库中。因此需要避免将不需要部署的文件放在BAR中。</p>
</div>
<div class="paragraph">
<p>在应用定义详情页面，也可以直接向Flowable引擎<em>发布(Publish)</em>应用定义。Flowable Modeler使用application.properties文件中，<em>flowable.modeler.app.deployment-api-url</em>参数设置的URL部署应用定义。默认部署URL配置为Flowable Task应用。但也可以修改，比如改为使用Flowable REST应用。确保Flowable Task应用正在运行，点击<em>Publish</em>按钮。这样应用定义就会做为一个BAR文件部署到Flowable Task应用。</p>
</div>
<div class="paragraph">
<p>下表是Modeler UI应用的专用参数。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Modeler UI应用参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">原参数</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.modeler.app.data-source-prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库表名的前缀。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.modeler.app.deployment-api-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment.api.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8080/flowable-task/process-api" class="bare">http://localhost:8080/flowable-task/process-api</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flowable引擎REST服务的根URL，Flowable Modeler用来向引擎部署应用定义BAR文件。
 Flowable Task应用的默认URL为
 <a href="http://localhost:8080/flowable-task/process-api" class="bare">http://localhost:8080/flowable-task/process-api</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.modeler.app.rest-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rest.modeler-app.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">启用REST API（指的是使用基础身份认证的API，而不是UI使用的REST API）。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="flowableTaskApp">14.5. Flowable Task应用</h3>
<div class="paragraph">
<p>Flowable Task应用是Flowable项目的运行时应用，默认包括Flowable BPMN、DMN、Form以及Content引擎。可以使用Flowable Task应用，启动新流程实例、完成任务、渲染任务表单等。在之前的章节中，已经通过Flowable Task应用REST API在Flowable引擎中部署了请假应用定义。在Flowable数据库中可以看到BPMN引擎的ACT_RE_DEPLOYMENT表中已经创建了新的部署实体。DMN引擎的ACT_DMN_DEPLOYMENT，和Form引擎的ACT_FO_FORM_DEPLOYMENT表中也创建了新的实体。</p>
</div>
<div class="paragraph">
<p>在<a href="http://localhost:8080/flowable-task"><a href="http://localhost:8080/flowable-task" class="bare">http://localhost:8080/flowable-task</a></a>的看板中，可以看到请假应用及默认的Task应用，和其他已经在Flowable引擎中部署的应用。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_task_dashboard_screen.png" alt="flowable task dashboard screen">
</div>
</div>
<div class="paragraph">
<p>点击请假应用，会显示当前登录用户的任务列表（现在很可能是空的）。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_task_tasklist_screen.png" alt="flowable task tasklist screen">
</div>
</div>
<div class="paragraph">
<p>点击打开<em>Processes(流程)</em>页签后，可以点击<em>Start a process(启动流程)</em>按钮，启动一个新的流程实例。会列表显示当前应用定义上下文中所有可用的流程定义。选择请假流程定义后，可以点击<em>Start process</em>按钮，启动一个新的请假流程实例。</p>
</div>
<div class="paragraph">
<p>Flowable Task应用将自动跳转至流程实例详情页面。可以看到已经激活了<em>Provide vacation information(提供请假信息)</em>任务。可以添加备注，或者使用<em>Show diagram(显示流程图)</em>按钮，图形化显示流程实例状态。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_task_processdetails_screen.png" alt="flowable task processdetails screen">
</div>
</div>
<div class="paragraph">
<p>转至任务列表，也可以看到这里也列出了<em>Provide vacation information</em>任务。这个界面会显示任务详情及渲染的请假信息表单。也可以点击<em>Show details(显示详情)</em>按钮，转至详情页面。在详情页面中，可以添加备注，引入用户，为任务添加附件，或者修改任务的到期时间和办理人。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_task_taskdetails_screen.png" alt="flowable task taskdetails screen">
</div>
</div>
<div class="paragraph">
<p>开始填写表单并完成任务。首先，选择间隔超过10天的开始日期和结束日期。这样就可以生成<em>Manager approval(经理审批)</em>任务。请假信息表单填写完毕后，点击<em>Complete(完成)</em>按钮，Flowable Task应用就会跳转至<em>Manager approval</em>任务界面。直接完成这个任务（不需要填写任务表单），流程实例就结束了。</p>
</div>
<div class="paragraph">
<p>返回<em>Processes</em>页签，点击<em>Showing running processes(显示运行中的流程)</em>选项，可以选择<em>show completed process instances（显示已完成的流程实例）</em>。这样就会显示已完成的流程实例列表。点击刚才完成的请假流程，可以看到两个完成的任务。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_task_processhistory_screen.png" alt="flowable task processhistory screen">
</div>
</div>
<div class="paragraph">
<p>每个任务的完成表单（complete form）都存储在Flowable Form引擎的ACT_FO_FORM_INSTANCE表中。因此，在查看完成的任务时，就可以看到每一个完成表单的数据。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_task_completedform_screen.png" alt="flowable task completedform screen">
</div>
</div>
<div class="paragraph">
<p>请确保选择回<em>showing running processes</em>，否则就不能看到新启动的流程实例。也可以在任务列表界面进行过滤，选择查找任务名、任务状态，特定流程定义的任务，以及指定的办理人。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_task_taskfilter_screen.png" alt="flowable task taskfilter screen" width="400">
</div>
</div>
<div class="paragraph">
<p>默认情况下，办理人过滤设置为<em>Tasks where I am involved(我参与的任务)</em>。这样不会显示用户作为候选人而没有指定为办理人的任务。要显示候选任务，可以选择<em>Tasks where I am one of the candidates(我参与候选的任务)</em>。</p>
</div>
<div class="paragraph">
<p>下表是Task UI应用的专用参数。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Task UI应用参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">原参数</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.experimental.debugger.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">debugger.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否启用流程调试器。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.task.app.rest-enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rest.task-app.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">启用REST API（指的是使用基础身份认证的API，而不是UI使用的REST API）。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="flowableAdminApp">14.6. Flowable Admin应用</h3>
<div class="paragraph">
<p>Flowable Admin应用是Flowable项目提供的第四个UI应用。用于查询BPMN、DMN及Form引擎中的部署，也可以显示流程实例的当前状态，包括当前的任务和流程变量。也提供了将任务指派给不同的办理人，以及完成任务的操作。Flowable Admin应用使用REST API与Flowable引擎通信。默认情况下，配置为连接至Flowable Task REST API，但是也可以很容易的修改为连接至Flowable REST应用的REST API。访问<a href="http://localhost:8080/flowable-admin"><a href="http://localhost:8080/flowable-admin" class="bare">http://localhost:8080/flowable-admin</a></a>时会显示配置界面（也可以直接点击Flowable logo右上方的箭头）。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/flowable_admin_configuration_screen.png" alt="flowable admin configuration screen"></span></p>
</div>
<div class="paragraph">
<p>每一个引擎都可以配置REST端点的基本认证。每个引擎需要单独配置，因为有可能会分开部署引擎，比如将DMN引擎与BPMN引擎部署在不同的服务器上。</p>
</div>
<div class="paragraph">
<p>如果配置正确，就可以选择<em>Process Engine(流程引擎)</em>来管理Flowable BPMN引擎。默认情况下，会显示Flowable BPMN引擎的部署情况。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_admin_deployments_screen.png" alt="flowable admin deployments screen">
</div>
</div>
<div class="paragraph">
<p>可以使用名字及租户id过滤查找部署。也可以为Flowable引擎部署新的BPMN XML或BAR文件。点击其中一个部署，会显示部署详情界面。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_admin_deploymentdetails_screen.png" alt="flowable admin deploymentdetails screen">
</div>
</div>
<div class="paragraph">
<p>这里会显示部署的详细信息，以及部署中包含的流程定义。也可以删除部署。如果希望删除已部署的应用定义，也可以在Flowable Task应用看板中删除应用定义。点击其中一个流程定义，会显示流程定义详情页面。</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/flowable_admin_processdefinitiondetails_screen.png" alt="flowable admin processdefinitiondetails screen">
</div>
</div>
<div class="paragraph">
<p>在流程定义详情页面中，首先显示的是流程实例，以及流程定义中使用的选择表定义和表单定义。请假流程定义有一个关联的选择表，以及一个关联的表单定义。点击选择表定义，就会从Flowable Admin应用跳转至DMN引擎。可以点击<em>Parent Deployment ID(父部署ID)</em>链接，返回流程引擎。</p>
</div>
<div class="paragraph">
<p>除了部署与定义之外，还可以查询流程引擎中的流程实例、任务、作业，以及事件订阅情况。界面与前面介绍的类似。</p>
</div>
<div class="paragraph">
<p>下表是Admin UI应用的专用参数。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Admin UI应用参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">原参数</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.admin.app.data-source-prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.prefix</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库表名的前缀。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.admin.app.security.encryption.credentials-i-v-spec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.encryption.credentials-i-v-spec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">创建IvParameterSpec对象所用的bytes。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flowable.admin.app.security.encryption.credentials-secret-spec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.encryption.credentials-secret-spec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">创建SecretKeySpec对象所用的bytes。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>除了这些参数之外，Flowable Admin应用还有一些其他参数。可以在<a href="https://github.com/flowable/flowable-engine/tree/master/modules/flowable-ui-admin/flowable-ui-admin-app/src/main/resources/application.properties">Github</a>查看配置文件的完整内容。这些参数主要用于为不同的引擎定义REST端点的初始值。
Admin应用使用这些配置连接Flowable引擎。可以使用Admin应用的配置界面修改这些值。这些值保存在<em>ACT_ADM_SERVER_CONFIG</em>表中。
下面是一个BPMN引擎REST的配置示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="linenums"><span></span>flowable.admin.app.server-config.process.app.name=Flowable Process app
flowable.admin.app.server-config.process.description=Flowable Process REST config
flowable.admin.app.server-config.process.server-address=http://localhost
flowable.admin.app.server-config.process.app.port=8080
flowable.admin.app.server-config.process.context-root=flowable-task
flowable.admin.app.server-config.process.rest-root=process-api
flowable.admin.app.server-config.process.app.user=admin
flowable.admin.app.server-config.process.app.password=test</code></pre>
</div>
</div>
<div class="paragraph">
<p>在Flowable Task应用（及全部Flowable引擎）由Flowable Admin应用管理时，可以使用这些参数。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. 由Spring Boot管理的Admin UI应用参数</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">原参数</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">message.reloading.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">改为使用Spring Boot MessageSourceAutoConfiguration的 <code>spring.messages.cache-duration</code> 设置。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_internationalization">14.7. 国际化</h3>
<div class="paragraph">
<p>Flowable UI应用支持国际化(internationalization, i18n)。项目组维护英语版本。但也可以使用自己的翻译文件支持其他语言。</p>
</div>
<div class="paragraph">
<p><a href="$$https://github.com/angular-translate/angular-translate">Angular Translate</a>库会试着基于浏览器的语言代码，从（每一个UI应用的）<em>i18n</em>目录下载入对应的语言文件。如果无法加载匹配的语言文件，框架会退回使用英语版本。</p>
</div>
<div class="paragraph">
<p>也可以（在Angular应用配置中），将多个浏览器语言代码关联至某个翻译文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="linenums"><span></span>// 初始化angular-translate
$translateProvider.useStaticFilesLoader({
    prefix: &#39;./i18n/&#39;,
    suffix: &#39;.json&#39;
})
/*
    将多个浏览器语言代码映射至同一个翻译。
*/
// .registerAvailableLanguageKeys([&#39;en&#39;], {
//     &#39;en-*&#39;: &#39;en&#39;
// })
.useCookieStorage()
.useSanitizeValueStrategy(&#39;sanitizeParameters&#39;)
.uniformLanguageTag(&#39;bcp47&#39;)
.determinePreferredLanguage();</code></pre>
</div>
</div>
<div class="paragraph">
<p>例如，如果浏览器配置为使用英语（美国）——English (United States)，即语言代码为<em>en-US</em>。如果不做映射配置，Angular Translate会尝试获取对应的语言文件<em>en-US.json</em>。（如果无法加载，会退回为<em>en</em>，并加载<em>en.json</em>语言文件）</p>
</div>
<div class="paragraph">
<p>取消注释<em>.registerAvailableLanguageKeys</em>块，就可以将<em>en-US</em>（以及所有其他的<em>en</em>语言代码）映射至<em>en.json</em>语言文件。</p>
</div>
</div>
<div class="sect2">
<h3 id="_production_ready_endpoints">14.8. 生产可用的端点</h3>
<div class="paragraph">
<p>所有应用都可以使用Spring Boot提供的<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-endpoints.html">生产可用的端点</a>。参阅<a href="https://docs.spring.io/spring-boot/docs/current/actuator-api/html/">Actuator Web API Documentation</a>了解所有可用的端点。</p>
</div>
<div class="paragraph">
<p>默认使用下列配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="linenums"><span></span># 暴露所有Actuator Endpoint
# 尽管会暴露所有的端点，但非认证用户无法访问，认证用户可以访问/info及/health，只有具有access-admin权限的用户可以访问其他端点
management.endpoints.web.exposure.include=*
# 只有认证用户可以访问完整的健康度信息
management.endpoint.health.show-details=when_authorized
# 只有access-admin角色可以访问完整的健康度信息
management.endpoint.health.roles=access-admin</code></pre>
</div>
</div>
<div class="paragraph">
<p>安全策略配置为：只有认证用户可以访问 <code>info</code> 及 <code>health</code> 端点。
只有 <code>access-admin</code> 角色可以查看 <code>health</code> 端点的完整信息。
只有 <code>access-admin</code> 角色可以查看其他的任何端点。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="restApiChapter">15. REST API</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_general_flowable_rest_principles">15.1. Flowable REST一般原则</h3>
<div class="sect3">
<h4 id="_installation_and_authentication">15.1.1. 安装与认证</h4>
<div class="paragraph">
<p>Flowable为Flowable引擎提供了REST API，可以通过在servlet容器（如Apache Tomcat）中部署flowable-rest.war文件来安装。另外，也可以通过在应用中引入servlet（包括对应的映射），并将所有flowable-rest的依赖加入classpath的方式使用。</p>
</div>
<div class="paragraph">
<p>默认情况下Flowable引擎会连接至一个H2内存数据库。可以通过<em>WEB-INF/META-INF/flowable-app</em>文件夹下的flowable-app.properties文件修改数据库设置。REST API使用JSON格式( <a href="http://www.json.org" class="bare">http://www.json.org</a> )，并基于Spring MVC( <a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/mvc.html" class="bare">http://docs.spring.io/spring/docs/current/spring-framework-reference/html/mvc.html</a> )构建。</p>
</div>
<div class="paragraph">
<p>默认情况下访问任何REST资源都需要具有<em>rest-access-api</em>权限的合法用户。如果需要任何合法用户都可以访问REST API，可以将<em>flowable.rest.app.authentication-mode</em>设置为<em>any-user</em>（这也是之前版本Flowable的默认设置）。</p>
</div>
<div class="paragraph">
<p>通过如下参数设置可以访问REST API的默认用户：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>flowable.rest.app.admin.user-id=rest-admin
flowable.rest.app.admin.password=test
flowable.rest.app.admin.first-name=Rest
flowable.rest.app.admin.last-name=Admin</pre>
</div>
</div>
<div class="paragraph">
<p>当REST应用启动时，如果用户不存在或无法找到，则会创建该用户。这个用户会被赋予访问REST API所需的<em>access-rest-api</em>权限。<strong>请不要忘记修改这个用户的密码</strong>。如果未设置<em>flowable.rest.app.admin.user-id</em>，则不会创建用户或权限。也因为此，在初始化完成后删除这些参数，并不会删除之前已经配置的用户或权限。</p>
</div>
<div class="paragraph">
<p>使用基础HTTP访问认证，因此在请求时，需要在HTTP-header中添加 <em>Authorization: Basic &#8230;&#8203;==</em> 。也可以在请求url中包含用户名与密码（如 <em><a href="http://username:password@localhost:8080/xyz" class="bare">http://username:password@localhost:8080/xyz</a></em>）。</p>
</div>
<div class="paragraph">
<p><strong>建议使用基础认证时，同时使用HTTPS。</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_2">15.1.2. 配置</h4>
<div class="paragraph">
<p>Flowable REST web应用使用Spring Java Configuration来启动Flowable引擎，使用Spring security定义基础认证安全，并为为特定的变量处理定义了变量转换。
有少量参数可以通过修改WEB-INF/classes文件夹下的engine.properties文件定义。
如果需要高级配置选项，可以在flowable-custom-context.xml文件中覆盖默认的Spring bean，这个文件也在WEB-INF/classes文件夹下。
该文件中已经以注释形式提供了示例配置。也可以在该文件中定义一个新的命名为restResponsefactory的Spring bean，覆盖默认的RestResponseFactory，并使用自定义实现类。</p>
</div>
</div>
<div class="sect3">
<h4 id="restUsageInTomcat">15.1.3. 在Tomcat中使用</h4>
<div class="paragraph">
<p>由于<a href="http://tomcat.apache.org/tomcat-8.0-doc/security-howto.html">Tomcat中的默认安全参数</a>，<strong>默认不能使用转义斜线符（<code>%2F</code>与<code>%5C</code>）（将返回400）。</strong>这可能会影响部署资源与其数据URL，因为URL可能包含转义斜线符。</p>
</div>
<div class="paragraph">
<p>当发现400异常结果时，可以设置下列系统参数:</p>
</div>
<div class="paragraph">
<p><em>-Dorg.apache.tomcat.util.buf.UDecoder.ALLOW_ENCODED_SLASH=true</em></p>
</div>
<div class="paragraph">
<p>最佳实践是（在post/put JSON时），在下面介绍的HTTP请求中，永远将<strong>Accept</strong>与<strong>Content-Type</strong>HTTP头设置为<strong>application/json</strong>。</p>
</div>
</div>
<div class="sect3">
<h4 id="_methods_and_return_codes">15.1.4. 方法与返回码</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. HTTP方法与对应操作</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">方法</th>
<th class="tableblock halign-left valign-top">操作</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">获取单个资源，或获取一组资源。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>POST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">创建一个新资源。在查询结构太复杂，不能放入GET请求的查询URL中时，也用于执行资源查询。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PUT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">更新一个已有资源的参数。也用于调用已有资源提供的操作。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DELETE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">删除一个已有资源。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. HTTP方法响应码</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">响应</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>200 - Ok</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作成功，返回响应（<code>GET</code>与<code>PUT</code>请求）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>201 - 已创建</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作成功，已经创建了实体，并在响应体中返回（<code>POST</code>请求）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>204 - 无内容</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作成功，已经删除了实体，因此没有返回的响应体（<code>DELETE</code>请求）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>401 - 未认证</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作失败。操作要求设置认证头。如果请求中有认证头，则提供的鉴证并不合法，或者用户未被授权进行该操作。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>403 - 禁止</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作被禁止，且不应重试。这不是鉴证或授权的问题，而是说明不允许该操作。例如：无论任何用户或流程/任务的状态，删除一个运行中流程的任务是且永远是不允许的。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>404 - 未找到</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作失败。请求的资源未找到。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>405 - 不允许的方法</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作失败。使用的方法不能用于该资源。例如，更新（PUT）部署资源将返回<code>405</code>响应码。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>409 - 冲突</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作失败。该操作导致更新一个已被其他操作更新的资源，因此本更新不再有效。也可以表示正在为一个集合创建一个资源，但该标识符已存在。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>415 - 不支持的媒体类型</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作失败。请求提包含了不支持的媒体类型。也会发生在请求体JSON中包含了未知的属性或值，但没有可用的格式/类型来处理的情况。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>500 - 服务器内部错误</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">操作失败。执行操作时发生了未知异常。响应体中包含了错误的细节。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>HTTP响应的media-type总是<code>application/json</code>，除非请求的是二进制内容（例如部署资源数据）。这时将使用内容的media-type。</p>
</div>
</div>
<div class="sect3">
<h4 id="_error_response_body">15.1.5. 错误响应体</h4>
<div class="paragraph">
<p>当发生错误时（可能是客户端或服务器端的错误，4XX及5XX状态码），响应体会包含一个描述了发生的错误的对象。任务未找到时的404状态的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;statusCode&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">404</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;errorMessage&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Could not find a task with id &#39;444&#39;.&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_request_parameters">15.1.6. 请求参数</h4>
<div class="sect4">
<h5 id="_url_fragments">URL片段</h5>
<div class="paragraph">
<p>作为url的一部分的参数（例如，<code><a href="http://host/flowable-rest/service/repository/deployments/{deploymentId}" class="bare">http://host/flowable-rest/service/repository/deployments/{deploymentId}</a></code>中的deploymentId参数），如果包含特殊字符，则需要进行合适的转义（参见<a href="https://en.wikipedia.org/wiki/Percent-encoding">URL编码或百分号编码</a>）。大多数框架都内建了这个功能，但要记得考虑它。特别是对可能包含斜线符的段落（例如部署资源），就必须要做转义。</p>
</div>
</div>
<div class="sect4">
<h5 id="_rest_url_query_parameters">Rest URL查询参数</h5>
<div class="paragraph">
<p>作为查询字符串添加在URL中的参数（例如<code><a href="http://host/flowable-rest/service/deployments?name=Deployment" class="bare">http://host/flowable-rest/service/deployments?name=Deployment</a></code>中的name参数）可以使用下列类型。在相应的REST-API文档中也会提到：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. URL查询参数类型</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">格式</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">纯文本参数。可以包含任何URL允许的合法字符。对于<code>XXXLike</code>参数，字符串可能会包含通配符<code>%</code>（需要进行URL编码）。可以进行like搜索，例如，'Tas%'将匹配所有以&#8217;Tas&#8217;开头的值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">整形参数。只能包含数字型非小数值，在-2.147.483.648至2.147.483.647之间。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">长整形参数。只能包含数字型非小数值，在-9.223.372.036.854.775.808至9.223.372.036.854.775.807之间。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean型参数。可以为<code>true</code>或<code>false</code>。任何其他值都会导致'<code>405 - 错误请求</code>'响应码。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日期型参数。使用ISO-8601日期格式（参考<a href="http://en.wikipedia.org/wiki/ISO_8601">wikipedia中的ISO-8601</a>），使用时间与日期部分（例如<code>2013-04-03T23:45Z</code>）。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="restJsonBody">JSON body 参数</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. JSON参数类型</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">格式</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">纯文本参数。对于<code>XXXLike</code>参数，字符串可能会包含通配符<code>%</code>。可以进行like搜索。例如，'Tas%'将匹配所有以&#8217;Tas&#8217;开头的值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">整形参数，使用JSON数字。只能包含数字型非小数值，在-2.147.483.648至2.147.483.647之间。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">长整形参数，使用JSON数字。只能包含数字型非小数值，在-9.223.372.036.854.775.808至9.223.372.036.854.775.807之间。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日期型参数，使用JSON文本。使用ISO-8601日期格式（参考<a href="http://en.wikipedia.org/wiki/ISO_8601">wikipedia中的ISO-8601</a>），使用时间与日期组分（例如<code>2013-04-03T23:45Z</code>）。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="restPagingAndSort">分页与排序</h5>
<div class="paragraph">
<p>分页与排序参数可以作为查询字符串加入URL中（例如<code><a href="http://host/flowable-rest/service/deployments?sort=name" class="bare">http://host/flowable-rest/service/deployments?sort=name</a></code>中的name参数）。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. JSON查询变量参数</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">各查询实现不同</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">排序键的名字，在各查询实现中默认值与可用值都不同。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">order</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">排序顺序，可以是&#8217;asc'（顺序）或&#8217;desc'（逆序）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">start</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">对结果分页的参数。默认结果从0开始。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">对结果分页的参数。默认大小为10.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="restQueryVariable">JSON查询变量格式</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span>
<span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;variableName&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;variableValue&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;operation&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;equals&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. JSON查询变量参数</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">包含在查询中的变量名。在有些使用'<code>equals</code>'的查询中可以为空，查询<strong>任意变量名</strong>为给定值的资源。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">包含在查询中的变量值，需要使用给定类型的正确格式。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询使用的操作，可以为下列值：<code>equals, notEquals, equalsIgnoreCase, notEqualsIgnoreCase, lessThan, greaterThan, lessThanOrEquals, greaterThanOrEquals</code>与<code>like</code>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">所用变量的类型。当省略时，会从<code>value</code>参数推理类型。任何JSON文本值都使用是<code>string</code>类型，JSON boolean值使用<code>boolean</code>类型，JSON数字使用<code>long</code>或<code>integer</code>，取决于数字的大小。建议在有疑惑时明确指定类型。其他支持的类型列在下面。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. 默认查询JSON类型</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">类型名</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值处理转换为<code>java.lang.String</code>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">short</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值处理转换为<code>java.lang.Integer</code>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值处理转换为<code>java.lang.Integer</code>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值处理转换为<code>java.lang.Long</code>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值处理转换为<code>java.lang.Double</code>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值处理转换为<code>java.lang.Boolean</code>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值处理转换为<code>java.util.Date</code>。JSON字符串将使用ISO-8601日期格式转换。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="restVariables">变量表示</h5>
<div class="paragraph">
<p>读取与写入变量（执行选择）时，REST API都使用通用原则与JSON格式。变量的JSON表示为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;variableName&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;variableValue&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;valueUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://...&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. 变量的JSON属性</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">变量名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">变量的值。当写入变量且省略了<code>value</code>时，会使用<code>null</code>作为value。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">valueUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当读取<code>binary</code>或<code>serializable</code>类型的变量时，这个属性将指向可用于获取原始二进制数据的URL。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">变量的类型。查看下面的表格了解类型的更多信息。当写入变量且省略了这个值时，将使用请求的原始JSON属性类型推断，限制在<code>string</code>, <code>double</code>, <code>integer</code>与<code>boolean</code>中。建议总是包含类型，以确保不会错误推断类型。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. 变量类型</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">类型名</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值按照<code>java.lang.String</code>处理。写入变量时使用原始JSON文本。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值按照<code>java.lang.Integer</code>处理。按约定写入变量时使用JSON数字，失败则退回JSON文本。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">short</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值按照<code>java.lang.Short</code>处理。按约定写入变量时使用JSON数字，失败则退回JSON文本。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值按照<code>java.lang.Long</code>处理。按约定写入变量时使用JSON数字，失败则退回JSON文本。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值按照<code>java.lang.Double</code>处理。按约定写入变量时使用JSON数字，失败则退回JSON文本。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值按照<code>java.lang.Boolean</code>处理。按约定写入变量时使用JSON boolean。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值按照<code>java.util.Date</code>处理。写入变量时将转换为ISO-8601日期格式。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>可以使用自定义JSON表示，以支持额外的变量类型（既可以是简单值，也可以是复杂/嵌套的JSON对象）。通过扩展<code>org.flowable.rest.service.api.RestResponseFactory</code>的<code>initializeVariableConverters()</code>方法，可以添加额外的<code>org.flowable.rest.service.api.engine.variable.RestVariableConverter</code>类，用于将POJO转换为适合通过REST传输的格式，以及将REST值转换为POJO。实际转换JSON使用Jackson。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deployment">15.2. Deployment</h3>
<div class="paragraph">
<p><strong>When using tomcat, please read <a href="#restUsageInTomcat">Usage in Tomcat</a>.</strong></p>
</div>
<div class="sect3">
<h4 id="_list_of_deployments">15.2.1. List of Deployments</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/deployments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. URL query parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return deployments with the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return deployments with a name like the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return deployments with the given category.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">categoryNotEquals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return deployments which don&#8217;t have the given category.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return deployments with the given tenantId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return deployments with a tenantId like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only returns deployments without a tenantId set. If <code>false</code>, the <code>withoutTenantId</code> parameter is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>id</em> (default), <em>name</em>, <em>deployTime</em> or <em>tenantId</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property to sort on, to be used together with the <em>order</em>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 22. REST Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the request was successful.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;10&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;flowable-examples.bar&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deploymentTime&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;2010-10-13T14:54:26.750+02:00&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;examples&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/repository/deployments/10&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;id&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_get_a_deployment">15.2.2. Get a deployment</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/deployments/{deploymentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 23. Get a deployment - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the deployment to get.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 24. Get a deployment - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the deployment was found and returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested deployment was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;10&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;flowable-examples.bar&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;deploymentTime&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;2010-10-13T14:54:26.750+02:00&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;examples&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/repository/deployments/10&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_a_new_deployment">15.2.3. Create a new deployment</h4>
<div class="listingblock">
<div class="content">
<pre>POST repository/deployments</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="paragraph">
<p>The request body should contain data of type <em>multipart/form-data</em>. There should be exactly one file in the request, any additional files will be ignored. The deployment name is the name of the file-field passed in. If multiple resources need to be deployed in a single deployment, compress the resources in a zip and make sure the file-name ends with <code>.bar</code> or <code>.zip</code>.</p>
</div>
<div class="paragraph">
<p>An additional parameter (form-field) can be passed in the request body with name <code>tenantId</code>. The value of this field will be used as the id of the tenant this deployment is done in.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 25. Create a new deployment - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the deployment was created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates there was no content present in the request body or the content mime-type is not supported for deployment. The status-description contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;10&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;flowable-examples.bar&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;deploymentTime&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;2010-10-13T14:54:26.750+02:00&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/repository/deployments/10&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myTenant&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_delete_a_deployment">15.2.4. Delete a deployment</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE repository/deployments/{deploymentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 26. Delete a deployment - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the deployment to delete.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 27. Delete a deployment - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the deployment was found and has been deleted. Response-body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested deployment was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_list_resources_in_a_deployment">15.2.5. List resources in a deployment</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/deployments/{deploymentId}/resources</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 28. List resources in a deployment - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the deployment to get the resources for.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 29. List resources in a deployment - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the deployment was found and the resource list has been returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested deployment was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-p">[</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;diagrams/my-process.bpmn20.xml&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/repository/deployments/10/resources/diagrams%2Fmy-process.bpmn20.xml&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;dataUrl&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/repository/deployments/10/resourcedata/diagrams%2Fmy-process.bpmn20.xml&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;mediaType&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;text/xml&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;processDefinition&quot;</span>
  <span class="tok-p">},</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;image.png&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/repository/deployments/10/resources/image.png&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;dataUrl&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/repository/deployments/10/resourcedata/image.png&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;mediaType&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;image/png&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;resource&quot;</span>
  <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mediaType</code>: Contains the media-type the resource has. This is resolved using a (pluggable) <code>MediaTypeResolver</code> and contains, by default, a limited number of mime-type mappings.</p>
</li>
<li>
<p><code>type</code>: Type of resource, possible values:</p>
</li>
<li>
<p><code>resource</code>: Plain old resource.</p>
</li>
<li>
<p><code>processDefinition</code>: Resource that contains one or more process-definitions. This resource is picked up by the deployer.</p>
</li>
<li>
<p><code>processImage</code>: Resource that represents a deployed process definition&#8217;s graphical layout.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>The dataUrl property in the resulting JSON for a single resource contains the actual URL to use for retrieving the binary resource.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="_get_a_deployment_resource">15.2.6. Get a deployment resource</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/deployments/{deploymentId}/resources/{resourceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 30. Get a deployment resource - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the deployment the requested resource is part of.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the resource to get. <strong>Make sure you URL-encode the resourceId in case it contains forward slashes. Eg: use <em>diagrams%2Fmy-process.bpmn20.xml</em> instead of <em>diagrams/Fmy-process.bpmn20.xml</em>.</strong></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 31. Get a deployment resource - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates both deployment and resource have been found and the resource has been returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested deployment was not found or there is no resource with the given id present in the deployment. The status-description contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;diagrams/my-process.bpmn20.xml&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/repository/deployments/10/resources/diagrams%2Fmy-process.bpmn20.xml&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;dataUrl&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/repository/deployments/10/resourcedata/diagrams%2Fmy-process.bpmn20.xml&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;mediaType&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;text/xml&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;processDefinition&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mediaType</code>: Contains the media-type the resource has. This is resolved using a (pluggable) <code>MediaTypeResolver</code> and contains, by default, a limited number of mime-type mappings.</p>
</li>
<li>
<p><code>type</code>: Type of resource, possible values:</p>
</li>
<li>
<p><code>resource</code>: Plain old resource.</p>
</li>
<li>
<p><code>processDefinition</code>: Resource that contains one or more process-definitions. This resource is picked up by the deployer.</p>
</li>
<li>
<p><code>processImage</code>: Resource that represents a deployed process definition&#8217;s graphical layout.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_get_a_deployment_resource_content">15.2.7. Get a deployment resource content</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/deployments/{deploymentId}/resourcedata/{resourceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 32. Get a deployment resource content - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the deployment the requested resource is part of.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the resource to get the data for. <strong>Make sure you URL-encode the resourceId in case it contains forward slashes. Eg: use <em>diagrams%2Fmy-process.bpmn20.xml</em> instead of <em>diagrams/Fmy-process.bpmn20.xml</em>.</strong></p></td>
</tr>
</tbody>
</table>
<div class="literalblock">
<div class="content">
<pre>.Get a deployment resource content - Response codes</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates both deployment and resource have been found and the resource data has been returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested deployment was not found or there is no resource with the given id present in the deployment. The status-description contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>The response body will contain the binary resource-content for the requested resource. The response content-type will be the same as the type returned in the resources <em>mimeType</em> property. Also, a content-disposition header is set, allowing browsers to download the file instead of displaying it.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_process_definitions">15.3. Process Definitions</h3>
<div class="sect3">
<h4 id="_list_of_process_definitions">15.3.1. List of process definitions</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/process-definitions</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 33. List of process definitions - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with the given version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with a name like the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with the given key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">keyLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with a name like the given key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with the given resource name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with a name like the given resource name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with the given category.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">categoryLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions with a category like the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">categoryNotEquals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions which don&#8217;t have the given category.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions which are part of a deployment with the given id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startableByUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process definitions which can be started by the given user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return the latest process definition versions. Can only be used together with <em>key</em> and <em>keyLike</em> parameters, using any other parameter will result in a 400-response.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">suspended</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only returns process definitions which are suspended. If <code>false</code>, only active process definitions (which are not suspended) are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>name</em> (default), <em>id</em>, <em>key</em>, <em>category</em>, <em>deploymentId</em> and <em>version</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property to sort on, to be used together with the <em>order</em>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 34. List of process definitions - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the process-definitions are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates a parameter was passed in the wrong format or that <em>latest</em> is used with other parameters other than <em>key</em> and <em>keyLike</em>. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess:1:4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;version&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;key&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;category&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Examples&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;suspended&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">false</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;The One Task Process&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a process for testing purposes&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deploymentId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deploymentUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/repository/deployments/2&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;graphicalNotationDefined&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">true</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;resource&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/deployments/2/resources/testProcess.xml&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;diagramResource&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/deployments/2/resources/testProcess.png&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startFormDefined&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">false</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>graphicalNotationDefined</code>: Indicates the process definition contains graphical information (BPMN DI).</p>
</li>
<li>
<p><code>resource</code>: Contains the actual deployed BPMN 2.0 xml.</p>
</li>
<li>
<p><code>diagramResource</code>: Contains a graphical representation of the process, null when no diagram is available.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_get_a_process_definition">15.3.2. Get a process definition</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/process-definitions/{processDefinitionId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 35. Get a process definition - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process definition to get.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 36. Get a process definition - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process definition was found and returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess:1:4&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;version&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;key&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;category&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Examples&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;suspended&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">false</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;The One Task Process&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a process for testing purposes&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;deploymentId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;deploymentUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/repository/deployments/2&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;graphicalNotationDefined&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">true</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;resource&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/deployments/2/resources/testProcess.xml&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;diagramResource&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/deployments/2/resources/testProcess.png&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;startFormDefined&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">false</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>graphicalNotationDefined</code>: Indicates the process definition contains graphical information (BPMN DI).</p>
</li>
<li>
<p><code>resource</code>: Contains the actual deployed BPMN 2.0 xml.</p>
</li>
<li>
<p><code>diagramResource</code>: Contains a graphical representation of the process, null when no diagram is available.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_update_category_for_a_process_definition">15.3.3. Update category for a process definition</h4>
<div class="listingblock">
<div class="content">
<pre>PUT repository/process-definitions/{processDefinitionId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;category&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;updatedcategory&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 37. Update category for a process definition - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process was category was altered.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates no category was defined in the request body.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong> see response for <code>repository/process-definitions/{processDefinitionId}</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_get_a_process_definition_resource_content">15.3.4. Get a process definition resource content</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/process-definitions/{processDefinitionId}/resourcedata</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 38. Get a process definition resource content - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process definition to get the resource data for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Response:</strong></p>
</div>
<div class="paragraph">
<p>Exactly the same response codes/boy as <code>GET repository/deployment/{deploymentId}/resourcedata/{resourceId}</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_get_a_process_definition_bpmn_model">15.3.5. Get a process definition BPMN model</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/process-definitions/{processDefinitionId}/model</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 39. Get a process definition BPMN model - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process definition to get the model for.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 40. Get a process definition BPMN model - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process definition was found and the model is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Response body:</strong>
The response body is a JSON representation of the <code>org.flowable.bpmn.model.BpmnModel</code> and contains the full process definition model.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;processes&quot;</span><span class="tok-p">:[</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;oneTaskProcess&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;xmlRowNumber&quot;</span><span class="tok-p">:</span><span class="tok-mi">7</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;xmlColumnNumber&quot;</span><span class="tok-p">:</span><span class="tok-mi">60</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;extensionElements&quot;</span><span class="tok-p">:{</span>

         <span class="tok-p">},</span>
         <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;The One Task Process&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;executable&quot;</span><span class="tok-p">:</span><span class="tok-kc">true</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;documentation&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;One task process description&quot;</span><span class="tok-p">,</span>

    <span class="tok-err">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_suspend_a_process_definition">15.3.6. Suspend a process definition</h4>
<div class="listingblock">
<div class="content">
<pre>PUT repository/process-definitions/{processDefinitionId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;suspend&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;includeProcessInstances&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;false&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;date&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-15T00:42:12Z&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table id="processDefinitionActionBodyParameters" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 41. Suspend a process definition - JSON Body parameters</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">action</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action to perform. Either <code>activate</code> or <code>suspend</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeProcessInstances</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether or not to suspend/activate running process-instances for this process-definition. If omitted, the process-instances are left in the state they are.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date (ISO-8601) when the suspension/activation should be executed. If omitted, the suspend/activation is effective immediately.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 42. Suspend a process definition - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process was suspended.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition is already suspended.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong> see response for <code>repository/process-definitions/{processDefinitionId}</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_activate_a_process_definition">15.3.7. Activate a process definition</h4>
<div class="listingblock">
<div class="content">
<pre>PUT repository/process-definitions/{processDefinitionId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;activate&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;includeProcessInstances&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;true&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;date&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-15T00:42:12Z&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>See suspend process definition <a href="#processDefinitionActionBodyParameters">JSON Body parameters</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 43. Activate a process definition - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process was activated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition is already active.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong> see response for <code>repository/process-definitions/{processDefinitionId}</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_get_all_candidate_starters_for_a_process_definition">15.3.8. Get all candidate starters for a process-definition</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/process-definitions/{processDefinitionId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 44. Get all candidate starters for a process-definition - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process definition to get the identity links for.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 45. Get all candidate starters for a process-definition - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process definition was found and the requested identity links are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-p">[</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4/identitylinks/groups/admin&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;user&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;group&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;admin&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;candidate&quot;</span>
   <span class="tok-p">},</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4/identitylinks/users/kermit&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;user&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;group&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;candidate&quot;</span>
   <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_add_a_candidate_starter_to_a_process_definition">15.3.9. Add a candidate starter to a process definition</h4>
<div class="listingblock">
<div class="content">
<pre>POST repository/process-definitions/{processDefinitionId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 46. Add a candidate starter to a process definition - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process definition.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body (user):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;user&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body (group):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;groupId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;sales&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 47. Add a candidate starter to a process definition - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process definition was found and the identity link was created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span>
<span class="tok-p">{</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4/identitylinks/users/kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;user&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;group&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;candidate&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_delete_a_candidate_starter_from_a_process_definition">15.3.10. Delete a candidate starter from a process definition</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE repository/process-definitions/{processDefinitionId}/identitylinks/{family}/{identityId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 48. Delete a candidate starter from a process definition - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">family</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either <code>users</code> or <code>groups</code>, depending on the type of identity link.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">identityId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either the userId or groupId of the identity to remove as candidate starter.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 49. Delete a candidate starter from a process definition - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process definition was found and the identity link was removed. The response body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition was not found or the process definition doesn&#8217;t have an identity-link that matches the url.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span>
<span class="tok-p">{</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4/identitylinks/users/kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;user&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;group&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;candidate&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_get_a_candidate_starter_from_a_process_definition">15.3.11. Get a candidate starter from a process definition</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/process-definitions/{processDefinitionId}/identitylinks/{family}/{identityId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 50. Get a candidate starter from a process definition - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process definition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">family</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either <code>users</code> or <code>groups</code>, depending on the type of identity link.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">identityId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either the userId or groupId of the identity to get as candidate starter.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 51. Get a candidate starter from a process definition - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process definition was found and the identity link was returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process definition was not found or the process definition doesn&#8217;t have an identity-link that matches the url.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4/identitylinks/users/kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;user&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;group&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;candidate&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_models">15.4. Models</h3>
<div class="sect3">
<h4 id="_get_a_list_of_models">15.4.1. Get a list of models</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/models</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 52. Get a list of models - URL query parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models with the given id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models with the given category.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">categoryLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models with a category like the given value. Use the <code>%</code> character as wildcard.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">categoryNotEquals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models without the given category.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models with the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models with a name like the given value. Use the <code>%</code> character as wildcard.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models with the given key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models which are deployed in the given deployment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models with the given version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">latestVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only return models which are the latest version. Best used in combination with <code>key</code>. If <code>false</code> is passed in as value, this is ignored and all versions are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only deployed models are returned. If <code>false</code>, only undeployed models are returned (deploymentId is null).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models with the given tenantId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return models with a tenantId like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only returns models without a tenantId set. If <code>false</code>, the <code>withoutTenantId</code> parameter is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>id</em> (default), <em>category</em>, <em>createTime</em>, <em>key</em>, <em>lastUpdateTime</em>, <em>name</em>, <em>version</em> or <em>tenantId</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property to sort on, to be used together with the <em>order</em>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 53. Get a list of models - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the models are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates a parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:[</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model name&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model key&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model category&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;metaInfo&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model metainfo&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;deploymentId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;7&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;10&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/models/10&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;createTime&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-06-12T14:31:08.612+0000&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;lastUpdateTime&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-06-12T14:31:08.612+0000&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;deploymentUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/deployments/7&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
      <span class="tok-p">},</span>

      <span class="tok-err">...</span>

   <span class="tok-p">],</span>
   <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;id&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_get_a_model">15.4.2. Get a model</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/models/{modelId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 54. Get a model - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the model to get.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 55. Get a model - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the model was found and returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested model was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/models/5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model name&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model key&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model category&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;metaInfo&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model metainfo&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;deploymentId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;deploymentUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/deployments/2&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;createTime&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-06-12T12:31:19.861+0000&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;lastUpdateTime&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-06-12T12:31:19.861+0000&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_update_a_model">15.4.3. Update a model</h4>
<div class="listingblock">
<div class="content">
<pre>PUT repository/models/{modelId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model name&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model key&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model category&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;metaInfo&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model metainfo&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;deploymentId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;updatedTenant&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All request values are optional. For example, you can only include the <em>name</em> attribute in the request body JSON-object, only updating the name of the model, leaving all other fields unaffected. When an attribute is explicitly included and is set to null, the model-value will be updated to null. Example: <code>{"metaInfo" : null}</code> will clear the metaInfo of the model).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 56. Update a model - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the model was found and updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested model was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/models/5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model name&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model key&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model category&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;metaInfo&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model metainfo&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;deploymentId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;deploymentUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/deployments/2&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;createTime&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-06-12T12:31:19.861+0000&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;lastUpdateTime&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-06-12T12:31:19.861+0000&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;&quot;</span><span class="tok-err">updatedTenant&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_a_model">15.4.4. Create a model</h4>
<div class="listingblock">
<div class="content">
<pre>POST repository/models</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model name&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model key&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model category&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span><span class="tok-mi">1</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;metaInfo&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model metainfo&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;deploymentId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;tenant&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All request values are optional. For example, you can only include the <em>name</em> attribute in the request body JSON-object, only setting the name of the model, leaving all other fields null.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 57. Create a model - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the model was created.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/models/5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model name&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model key&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;category&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model category&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span><span class="tok-mi">1</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;metaInfo&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Model metainfo&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;deploymentId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;deploymentUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/deployments/2&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;createTime&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-06-12T12:31:19.861+0000&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;lastUpdateTime&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-06-12T12:31:19.861+0000&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;tenant&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_delete_a_model">15.4.5. Delete a model</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE repository/models/{modelId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 58. Delete a model - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the model to delete.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 59. Delete a model - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the model was found and has been deleted. Response-body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested model was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_the_editor_source_for_a_model">15.4.6. Get the editor source for a model</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/models/{modelId}/source</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 60. Get the editor source for a model - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the model.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 61. Get the editor source for a model - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the model was found and source is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested model was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>Response body contains the model&#8217;s raw editor source. The response&#8217;s content-type is set to <code>application/octet-stream</code>, regardless of the content of the source.</p>
</div>
</div>
<div class="sect3">
<h4 id="_set_the_editor_source_for_a_model">15.4.7. Set the editor source for a model</h4>
<div class="listingblock">
<div class="content">
<pre>PUT repository/models/{modelId}/source</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 62. Set the editor source for a model - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the model.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="paragraph">
<p>The request should be of type <code>multipart/form-data</code>. There should be a single file-part included with the binary value of the source.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 63. Set the editor source for a model - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the model was found and the source has been updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested model was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>Response body contains the model&#8217;s raw editor source. The response&#8217;s content-type is set to <code>application/octet-stream</code>, regardless of the content of the source.</p>
</div>
</div>
<div class="sect3">
<h4 id="_get_the_extra_editor_source_for_a_model">15.4.8. Get the extra editor source for a model</h4>
<div class="listingblock">
<div class="content">
<pre>GET repository/models/{modelId}/source-extra</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 64. Get the extra editor source for a model - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the model.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 65. Get the extra editor source for a model - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the model was found and source is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested model was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>Response body contains the model&#8217;s raw extra editor source. The response&#8217;s content-type is set to <code>application/octet-stream</code>, regardless of the content of the extra source.</p>
</div>
</div>
<div class="sect3">
<h4 id="_set_the_extra_editor_source_for_a_model">15.4.9. Set the extra editor source for a model</h4>
<div class="listingblock">
<div class="content">
<pre>PUT repository/models/{modelId}/source-extra</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 66. Set the extra editor source for a model - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the model.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="paragraph">
<p>The request should be of type <code>multipart/form-data</code>. There should be a single file-part included with the binary value of the extra source.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 67. Set the extra editor source for a model - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the model was found and the extra source has been updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested model was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>Response body contains the model&#8217;s raw editor source. The response&#8217;s content-type is set to <code>application/octet-stream</code>, regardless of the content of the source.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_process_instances">15.5. Process Instances</h3>
<div class="sect3">
<h4 id="_get_a_process_instance">15.5.1. Get a process instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/process-instances/{processInstanceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 68. Get a process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to get.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 69. Get a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;7&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/7&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;businessKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myBusinessKey&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processDefinitionUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/processOne%3A1%3A4&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;processTask&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_delete_a_process_instance">15.5.2. Delete a process instance</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/process-instances/{processInstanceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 70. Delete a process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to delete.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 71. Delete a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and deleted. Response body is left empty intentionally.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_activate_or_suspend_a_process_instance">15.5.3. Activate or suspend a process instance</h4>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/process-instances/{processInstanceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 72. Activate or suspend a process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to activate/suspend.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request response body (suspend):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;action&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;suspend&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request response body (activate):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;action&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;activate&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 73. Activate or suspend a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and action was executed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an invalid action was supplied.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance action cannot be executed since the process-instance is already activated/suspended.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_start_a_process_instance_2">15.5.4. Start a process instance</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/process-instances</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body (start by process definition id):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;processDefinitionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;oneTaskProcess:1:158&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;businessKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myBusinessKey&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;returnVariables&quot;</span><span class="tok-p">:</span><span class="tok-kc">true</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
      <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myVar&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;This is a variable&quot;</span><span class="tok-p">,</span>
      <span class="tok-p">}</span>
   <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body (start by process definition key):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;processDefinitionKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;oneTaskProcess&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;businessKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myBusinessKey&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;returnVariables&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;tenant1&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
      <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myVar&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;This is a variable&quot;</span><span class="tok-p">,</span>
      <span class="tok-p">}</span>
   <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body (start by message):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;message&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;newOrderMessage&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;businessKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myBusinessKey&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;tenant1&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
      <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myVar&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;This is a variable&quot;</span><span class="tok-p">,</span>
      <span class="tok-p">}</span>
   <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that also a <em>transientVariables</em> property is accepted as part of this json, that follows the same structure as the <em>variables</em> property.</p>
</div>
<div class="paragraph">
<p>The <em>returnVariables</em> property can be used to get the existing variables in the process instance context back in the response. By default the variables are not returned.</p>
</div>
<div class="paragraph">
<p>Only one of <code>processDefinitionId</code>, <code>processDefinitionKey</code> or <code>message</code> can be used in the request body. Parameters <code>businessKey</code>, <code>variables</code> and <code>tenantId</code> are optional. If <code>tenantId</code> is omitted, the default tenant will be used. More information about the variable format can be found in <a href="#restVariables">the REST variables section</a>. Note that the variable-scope that is supplied is ignored, process-variables are always <code>local</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 74. Start a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates either the process-definition was not found (based on id or key), no process is started by sending the given message or an invalid variable has been passed. Status description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;7&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/7&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;businessKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myBusinessKey&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processDefinitionUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/processOne%3A1%3A4&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;processTask&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="restProcessInstancesGet">15.5.5. List of process instances</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/process-instances</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 75. List of process instances - URL query parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process instance with the given id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process instances with the given process definition key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process instances with the given process definition id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">businessKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process instances with the given businessKey.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">involvedUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process instances in which the given user is involved.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">suspended</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only return process instance which are suspended. If <code>false</code>, only return process instances which are not suspended (active).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">superProcessInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process instances which have the given super process-instance id (for processes that have a call-activities).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">subProcessInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process instances which have the given sub process-instance id (for processes started as a call-activity).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludeSubprocesses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only process instances which aren&#8217;t sub processes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeProcessVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication to include process variables in the result.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process instances with the given tenantId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return process instances with a tenantId like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only returns process instances without a tenantId set. If <code>false</code>, the <code>withoutTenantId</code> parameter is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sort field, should be either one of <code>id</code> (default), <code>processDefinitionId</code>, <code>tenantId</code> or <code>processDefinitionKey</code>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 76. List of process instances - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the process-instances are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates a parameter was passed in the wrong format . The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:[</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;7&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/7&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;businessKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myBusinessKey&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processDefinitionUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/processOne%3A1%3A4&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;processTask&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
      <span class="tok-p">}</span>


   <span class="tok-p">],</span>
   <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;id&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_query_process_instances">15.5.6. Query process instances</h4>
<div class="listingblock">
<div class="content">
<pre>POST query/process-instances</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;processDefinitionKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;oneTaskProcess&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span>
  <span class="tok-p">[</span>
    <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myVariable&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">1234</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;operation&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;equals&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;long&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The request body can contain all possible filters that can be used in the <a href="#restProcessInstancesGet">List process instances</a> URL query. On top of these, it&#8217;s possible to provide an array of variables
to include in the query, with their format <a href="#restQueryVariable">described here</a>.</p>
</div>
<div class="paragraph">
<p>The general <a href="#restPagingAndSort">paging and sorting query-parameters</a> can be used for this URL.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 77. Query process instances - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the process-instances are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates a parameter was passed in the wrong format . The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:[</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;7&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/7&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;businessKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myBusinessKey&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processDefinitionUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/processOne%3A1%3A4&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;processTask&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
      <span class="tok-p">}</span>


   <span class="tok-p">],</span>
   <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;id&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_get_diagram_for_a_process_instance">15.5.7. Get diagram for a process instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/process-instances/{processInstanceId}/diagram</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 78. Get diagram for a process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to get the diagram for.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 79. Get diagram for a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and the diagram was returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found but the process doesn&#8217;t contain any graphical information (BPMN:DI) and no diagram can be created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;7&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/7&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;businessKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myBusinessKey&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processDefinitionUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/processOne%3A1%3A4&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;processTask&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_get_involved_people_for_process_instance">15.5.8. Get involved people for process instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/process-instances/{processInstanceId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 80. Get involved people for process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to the links for.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 81. Get involved people for process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and links are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-p">[</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5/identitylinks/users/john/customType&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;user&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;john&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;group&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;customType&quot;</span>
   <span class="tok-p">},</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5/identitylinks/users/paul/candidate&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;user&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;paul&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;group&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;candidate&quot;</span>
   <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>groupId</code> will always be null, as it&#8217;s only possible to involve users with a process-instance.</p>
</div>
</div>
<div class="sect3">
<h4 id="_add_an_involved_user_to_a_process_instance">15.5.9. Add an involved user to a process instance</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/process-instances/{processInstanceId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 82. Add an involved user to a process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to the links for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;userId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;participant&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>userId</code> and <code>type</code> are required.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 83. Add an involved user to a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and the link is created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested body did not contain a userId or a type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5/identitylinks/users/john/customType&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;user&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;john&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;group&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;customType&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>groupId</code> will always be null, as it&#8217;s only possible to involve users with a process-instance.</p>
</div>
</div>
<div class="sect3">
<h4 id="_remove_an_involved_user_to_from_process_instance">15.5.10. Remove an involved user to from process instance</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/process-instances/{processInstanceId}/identitylinks/users/{userId}/{type}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 84. Remove an involved user to from process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to delete link for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of link to delete.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 85. Remove an involved user to from process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and the link has been deleted. Response body is left empty intentionally.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found or the link to delete doesn&#8217;t exist. The response status contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5/identitylinks/users/john/customType&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;user&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;john&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;group&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;customType&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>groupId</code> will always be null, as it&#8217;s only possible to involve users with a process-instance.</p>
</div>
</div>
<div class="sect3">
<h4 id="_list_of_variables_for_a_process_instance">15.5.11. List of variables for a process instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/process-instances/{processInstanceId}/variables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 86. List of variables for a process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to the variables for.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 87. List of variables for a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and variables are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span></span><span class="tok-p">[</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;intProcVar&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;local&quot;</span>
   <span class="tok-p">},</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;byteArrayProcVar&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;binary&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;valueUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5/variables/byteArrayProcVar/data&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;local&quot;</span>
   <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In case the variable is a binary variable or serializable, the <code>valueUrl</code> points to an URL to fetch the raw value. If it&#8217;s a plain variable, the value is present in the response.
Note that only <code>local</code> scoped variables are returned, as there is no <code>global</code> scope for process-instance variables.</p>
</div>
</div>
<div class="sect3">
<h4 id="_get_a_variable_for_a_process_instance">15.5.12. Get a variable for a process instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/process-instances/{processInstanceId}/variables/{variableName}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 88. Get a variable for a process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to the variables for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the variable to get.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 89. Get a variable for a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates both the process instance and variable were found and variable is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the request body is incomplete or contains illegal values. The status description contains additional information about the error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found or the process instance does not have a variable with the given name. Status description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span>   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;intProcVar&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;local&quot;</span>
   <span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In case the variable is a binary variable or serializable, the <code>valueUrl</code> points to an URL to fetch the raw value. If it&#8217;s a plain variable, the value is present in the response.  Note that only <code>local</code> scoped variables are returned, as there is no <code>global</code> scope for process-instance variables.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_or_update_variables_on_a_process_instance">15.5.13. Create (or update) variables on a process instance</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/process-instances/{processInstanceId}/variables</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/process-instances/{processInstanceId}/variables</pre>
</div>
</div>
<div class="paragraph">
<p>When using <code>POST</code>, all variables that are passed are created. In case one of the variables already exists on the process instance, the request results in an error (409 - CONFLICT). When <code>PUT</code> is used, nonexistent variables are created on the process-instance and existing ones are overridden without any error.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 90. Create (or update) variables on a process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to the variables for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>[
   {
      "name":"intProcVar"
      "type":"integer"
      "value":123
   },

   ...
]</pre>
</div>
</div>
<div class="paragraph">
<p>Any number of variables can be passed into the request body array. More information about the variable format can be found in <a href="#restVariables">the REST variables section</a>. Note that scope is ignored, only <code>local</code> variables can be set in a process instance.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 91. Create (or update) variables on a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and variable is created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the request body is incomplete or contains illegal values. The status description contains additional information about the error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found but already contains a variable with the given name (only thrown when POST method is used). Use the update-method instead.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>[
   {
      "name":"intProcVar",
      "type":"integer",
      "value":123,
      "scope":"local"
   },

   ...

]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_update_a_single_variable_on_a_process_instance">15.5.14. Update a single variable on a process instance</h4>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/process-instances/{processInstanceId}/variables/{variableName}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 92. Update a single variable on a process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to the variables for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the variable to get.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span> <span class="tok-p">{</span>
    <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;intProcVar&quot;</span>
    <span class="tok-s2">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span>
    <span class="tok-s2">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span>
 <span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>More information about the variable format can be found in <a href="#restVariables">the REST variables section</a>. Note that scope is ignored, only <code>local</code> variables can be set in a process instance.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 93. Update a single variable on a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates both the process instance and variable were found and variable is updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found or the process instance does not have a variable with the given name. Status description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;intProcVar&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;local&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In case the variable is a binary variable or serializable, the <code>valueUrl</code> points to an URL to fetch the raw value. If it&#8217;s a plain variable, the value is present in the response. Note that only <code>local</code> scoped variables are returned, as there is no <code>global</code> scope for process-instance variables.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_a_new_binary_variable_on_a_process_instance">15.5.15. Create a new binary variable on a process-instance</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/process-instances/{processInstanceId}/variables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 94. Create a new binary variable on a process-instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to create the new variable for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="paragraph">
<p>The request should be of type <code>multipart/form-data</code>. There should be a single file-part included with the binary value of the variable. On top of that, the following additional form-fields can be present:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Required name of the variable.</p>
</li>
<li>
<p><code>type</code>: Type of variable that is created. If omitted, <code>binary</code> is assumed and the binary data in the request will be stored as an array of bytes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binaryVariable&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binary&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;valueUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://.../runtime/process-instances/123/variables/binaryVariable/data&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 95. Create a new binary variable on a process-instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the variable was created and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the name of the variable to create was missing. Status message provides additional information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance already has a variable with the given name. Use the PUT method to update the task variable instead.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">415</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the serializable data contains an object for which no class is present in the JVM running the Flowable engine and therefore cannot be deserialized.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_update_an_existing_binary_variable_on_a_process_instance">15.5.16. Update an existing binary variable on a process-instance</h4>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/process-instances/{processInstanceId}/variables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 96. Update an existing binary variable on a process-instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to create the new variable for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong>
The request should be of type <code>multipart/form-data</code>. There should be a single file-part included with the binary value of the variable. On top of that, the following additional form-fields can be present:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Required name of the variable.</p>
</li>
<li>
<p><code>type</code>: Type of variable that is created. If omitted, <code>binary</code> is assumed and the binary data in the request will be stored as an array of bytes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binaryVariable&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binary&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;valueUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://.../runtime/process-instances/123/variables/binaryVariable/data&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 97. Update an existing binary variable on a process-instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the variable was updated and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the name of the variable to update was missing. Status message provides additional information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found or the process instance does not have a variable with the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">415</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the serializable data contains an object for which no class is present in the JVM running the Flowable engine and therefore cannot be deserialized.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_executions">15.6. Executions</h3>
<div class="sect3">
<h4 id="_get_an_execution">15.6.1. Get an execution</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/executions/{executionId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 98. Get an execution - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the execution to get.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 99. Get an execution - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution was found and returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/executions/5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;parentId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;parentUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_execute_an_action_on_an_execution">15.6.2. Execute an action on an execution</h4>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/executions/{executionId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 100. Execute an action on an execution - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the execution to execute action on.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body (signal an execution):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;signal&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Both a <em>variables</em> and <em>transientVariables</em> property is accepted with following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;signal&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;variables&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;myVar&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;someValue&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body (signal event received for execution):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;signalEventReceived&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;signalName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;mySignal&quot;</span>
  <span class="tok-s2">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notifies the execution that a signal event has been received, requires a <code>signalName</code> parameter. Optional <code>variables</code> can be passed that are set on the execution before the action is executed.</p>
</div>
<div class="paragraph">
<p><strong>Request body (signal event received for execution):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;messageEventReceived&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;messageName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;myMessage&quot;</span>
  <span class="tok-s2">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notifies the execution that a message event has been received, requires a <code>messageName</code> parameter. Optional <code>variables</code> can be passed that are set on the execution before the action is executed.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 101. Execute an action on an execution - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution was found and the action is performed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution was found, the action was performed and the action caused the execution to end.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an illegal action was requested, required parameters are missing in the request body or illegal variables are passed in. Status description contains additional information about the error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body (in case execution is not ended due to action):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/executions/5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;parentId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;parentUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_get_active_activities_in_an_execution">15.6.3. Get active activities in an execution</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/executions/{executionId}/activities</pre>
</div>
</div>
<div class="paragraph">
<p>Returns all activities which are active in the execution and in all child-executions (and their children, recursively), if any.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 102. Get active activities in an execution - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the execution to get activities for.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 103. Get active activities in an execution - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution was found and activities are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">[</span>
  <span class="tok-s2">&quot;userTaskForManager&quot;</span><span class="tok-p">,</span>
  <span class="tok-s2">&quot;receiveTask&quot;</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="restExecutionsGet">15.6.4. List of executions</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/executions</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 104. List of executions - URL query parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return executions with the given id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">activityId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return executions with the given activity id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return executions with the given process definition key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return executions with the given process definition id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return executions which are part of the process instance with the given id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">messageEventSubscriptionName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return executions which are subscribed to a message with the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">signalEventSubscriptionName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return executions which are subscribed to a signal with the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return executions which are a direct child of the given execution.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return executions with the given tenantId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return executions with a tenantId like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only returns executions without a tenantId set. If <code>false</code>, the <code>withoutTenantId</code> parameter is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sort field, should be either one of <code>processInstanceId</code> (default), <code>processDefinitionId</code>, <code>processDefinitionKey</code> or <code>tenantId</code>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 105. List of executions - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the executions are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates a parameter was passed in the wrong format . The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:[</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/executions/5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;parentId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;parentUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
      <span class="tok-p">},</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;7&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/executions/7&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;parentId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;parentUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/executions/5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;processTask&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
      <span class="tok-p">}</span>
   <span class="tok-p">],</span>
   <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;processInstanceId&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_query_executions">15.6.5. Query executions</h4>
<div class="listingblock">
<div class="content">
<pre>POST query/executions</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;processDefinitionKey&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;oneTaskProcess&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span>
  <span class="tok-p">[</span>
    <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myVariable&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">1234</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;operation&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;equals&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;long&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;processInstanceVariables&quot;</span><span class="tok-p">:</span>
  <span class="tok-p">[</span>
    <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;processVariable&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;some string&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;operation&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;equals&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The request body can contain all possible filters that can be used in the <a href="#restExecutionsGet">List executions</a> URL query. On top of these, it&#8217;s possible to provide an array of <code>variables</code> and <code>processInstanceVariables</code>
to include in the query, with their format <a href="#restQueryVariable">described here</a>.</p>
</div>
<div class="paragraph">
<p>The general <a href="#restPagingAndSort">paging and sorting query-parameters</a> can be used for this URL.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 106. Query executions - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the executions are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates a parameter was passed in the wrong format . The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:[</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/executions/5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;parentId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;parentUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
      <span class="tok-p">},</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;7&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/executions/7&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;parentId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;parentUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/executions/5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span><span class="tok-kc">false</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;activityId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;processTask&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
      <span class="tok-p">}</span>
   <span class="tok-p">],</span>
   <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;processInstanceId&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_list_of_variables_for_an_execution">15.6.6. List of variables for an execution</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/executions/{executionId}/variables?scope={scope}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 107. List of variables for an execution - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the execution to the variables for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either <code>local</code> or <code>global</code>. If omitted, both local and global scoped variables are returned.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 108. List of variables for an execution - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution was found and variables are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested execution was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-p">[</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;intProcVar&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;global&quot;</span>
   <span class="tok-p">},</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;byteArrayProcVar&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;binary&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;valueUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5/variables/byteArrayProcVar/data&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;local&quot;</span>
   <span class="tok-p">}</span>


<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In case the variable is a binary variable or serializable, the <code>valueUrl</code> points to an URL to fetch the raw value. If it&#8217;s a plain variable, the value is present in the response.</p>
</div>
</div>
<div class="sect3">
<h4 id="_get_a_variable_for_an_execution">15.6.7. Get a variable for an execution</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/executions/{executionId}/variables/{variableName}?scope={scope}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 109. Get a variable for an execution - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the execution to the variables for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the variable to get.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either <code>local</code> or <code>global</code>. If omitted, local variable is returned (if exists). If not, a global variable is returned (if exists).</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 110. Get a variable for an execution - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates both the execution and variable were found and variable is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the request body is incomplete or contains illegal values. The status description contains additional information about the error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested execution was not found or the execution does not have a variable with the given name in the requested scope (in case scope-query parameter was omitted, variable doesn&#8217;t exist in local and global scope). Status description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span>   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;intProcVar&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;local&quot;</span>
   <span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In case the variable is a binary variable or serializable, the <code>valueUrl</code> points to an URL to fetch the raw value. If it&#8217;s a plain variable, the value is present in the response.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_or_update_variables_on_an_execution">15.6.8. Create (or update) variables on an execution</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/executions/{executionId}/variables</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/executions/{executionId}/variables</pre>
</div>
</div>
<div class="paragraph">
<p>When using <code>POST</code>, all variables that are passed are created. In case one of the variables already exists on the execution in the requested scope, the request results in an error (409 - CONFLICT). When <code>PUT</code> is used, nonexistent variables are created on the execution and existing ones are overridden without any error.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 111. Create (or update) variables on an execution - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the execution to the variables for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">[</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;intProcVar&quot;</span>
      <span class="tok-s2">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span>
      <span class="tok-s2">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;local&quot;</span>
   <span class="tok-p">}</span>



<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>*Note that you can only provide variables that have the same scope. If the request-body array contains variables from mixed scopes, the request results in an error (400 - BAD REQUEST).*Any number of variables can be passed into the request body array. More information about the variable format can be found in <a href="#restVariables">the REST variables section</a>. Note that scope is ignored, only <code>local</code> variables can be set in a process instance.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 112. Create (or update) variables on an execution - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution was found and variable is created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the request body is incomplete or contains illegal values. The status description contains additional information about the error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested execution was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution was found but already contains a variable with the given name (only thrown when POST method is used). Use the update-method instead.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">[</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;intProcVar&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;local&quot;</span>
   <span class="tok-p">}</span>



<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_update_a_variable_on_an_execution">15.6.9. Update a variable on an execution</h4>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/executions/{executionId}/variables/{variableName}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 113. Update a variable on an execution - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the execution to update the variables for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the variable to update.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span> <span class="tok-p">{</span>
    <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;intProcVar&quot;</span>
    <span class="tok-s2">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span>
    <span class="tok-s2">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;global&quot;</span>
 <span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>More information about the variable format can be found in <a href="#restVariables">the REST variables section</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 114. Update a variable on an execution - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates both the process instance and variable were found and variable is updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found or the process instance does not have a variable with the given name. Status description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span>   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;intProcVar&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;scope&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;global&quot;</span>
   <span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In case the variable is a binary variable or serializable, the <code>valueUrl</code> points to an URL to fetch the raw value. If it&#8217;s a plain variable, the value is present in the response.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_a_new_binary_variable_on_an_execution">15.6.10. Create a new binary variable on an execution</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/executions/{executionId}/variables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 115. Create a new binary variable on an execution - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the execution to create the new variable for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="paragraph">
<p>The request should be of type <code>multipart/form-data</code>. There should be a single file-part included with the binary value of the variable. On top of that, the following additional form-fields can be present:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Required name of the variable.</p>
</li>
<li>
<p><code>type</code>: Type of variable that is created. If omitted, <code>binary</code> is assumed and the binary data in the request will be stored as an array of bytes.</p>
</li>
<li>
<p><code>scope</code>: Scope of variable that is created. If omitted, <code>local</code> is assumed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binaryVariable&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binary&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;valueUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://.../runtime/executions/123/variables/binaryVariable/data&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 116. Create a new binary variable on an execution - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the variable was created and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the name of the variable to create was missing. Status message provides additional information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested execution was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the execution already has a variable with the given name. Use the PUT method to update the task variable instead.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">415</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the serializable data contains an object for which no class is present in the JVM running the Flowable engine and therefore cannot be deserialized.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_update_an_existing_binary_variable_on_a_process_instance_2">15.6.11. Update an existing binary variable on a process-instance</h4>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/executions/{executionId}/variables/{variableName}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 117. Update an existing binary variable on a process-instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the execution to create the new variable for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the variable to update.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong>
The request should be of type <code>multipart/form-data</code>. There should be a single file-part included with the binary value of the variable. On top of that, the following additional form-fields can be present:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Required name of the variable.</p>
</li>
<li>
<p><code>type</code>: Type of variable that is created. If omitted, <code>binary</code> is assumed and the binary data in the request will be stored as an array of bytes.</p>
</li>
<li>
<p><code>scope</code>: Scope of variable that is created. If omitted, <code>local</code> is assumed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binaryVariable&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binary&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;valueUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://.../runtime/executions/123/variables/binaryVariable/data&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 118. Update an existing binary variable on a process-instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the variable was updated and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the name of the variable to update was missing. Status message provides additional information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested execution was not found or the execution does not have a variable with the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">415</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the serializable data contains an object for which no class is present in the JVM running the Flowable engine and therefore cannot be deserialized.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_tasks">15.7. Tasks</h3>
<div class="sect3">
<h4 id="_get_a_task">15.7.1. Get a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 119. Get a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 120. Get a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was found and returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;createTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;delegationState&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;pending&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Task description&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;dueDate&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;execution&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/executions/5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;8&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My task&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;owner&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;owner&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;parentTask&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/9&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;priority&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">50</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processDefinition&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstance&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;suspended&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">false</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskDefinitionKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;theTask&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/8&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>delegationState</code>: Delegation-state of the task, can be <code>null</code>, <code>"pending"</code> or <code>"resolved".</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="restTasksGet">15.7.2. List of tasks</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 121. List of tasks - URL query parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks with the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks with a name like the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks with the given description.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">priority</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks with the given priority.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">minimumPriority</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks with a priority greater than the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maximumPriority</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks with a priority lower than the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">assignee</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks assigned to the given user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">assigneeLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks assigned with an assignee like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">owner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks owned by the given user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ownerLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks assigned with an owner like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unassigned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks that are not assigned to anyone. If <code>false</code> is passed, the value is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">delegationState</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks that have the given delegation state. Possible values are <code>pending</code> and <code>resolved</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">candidateUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks that can be claimed by the given user. This includes both tasks where the user is an explicit candidate for and task that are claimable by a group that the user is a member of.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">candidateGroup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks that can be claimed by a user in the given group.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">candidateGroups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks that can be claimed by a user in the given groups. Values split by comma.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">involvedUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks in which the given user is involved.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks with the given task definition id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDefinitionKeyLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks with a given task definition id like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are part of the process instance with the given id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceBusinessKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are part of the process instance with the given business key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceBusinessKeyLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are part of the process instance which has a business key like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are part of a process instance which has a process definition with the given id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are part of a process instance which has a process definition with the given key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionKeyLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are part of a process instance which has a process definition with a key like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are part of a process instance which has a process definition with the given name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are part of a process instance which has a process definition with a name like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are part of the execution with the given id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">createdOn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are created on the given date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">createdBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are created before the given date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">createdAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are created after the given date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueOn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are due on the given date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are due before the given date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which are due after the given date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutDueDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks which don&#8217;t have a due date. The property is ignored if the value is <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludeSubTasks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks that are not a subtask of another task.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only return tasks that are not suspended (either part of a process that is not suspended or not part of a process at all). If false, only tasks that are part of suspended process instances are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeTaskLocalVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication to include task local variables in the result.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeProcessVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication to include process variables in the result.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks with the given tenantId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return tasks with a tenantId like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only returns tasks without a tenantId set. If <code>false</code>, the <code>withoutTenantId</code> parameter is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">candidateOrAssigned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select tasks that has been claimed or assigned to user or waiting to claim by user (candidate user or groups).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">category</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select tasks with the given category. Note that this is the task category, not the category of the process definition (namespace within the BPMN Xml).</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 122. List of tasks - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the tasks are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates a parameter was passed in the wrong format or that <em>delegationState</em> has an invalid value (other than <em>pending</em> and <em>resolved</em>). The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;createTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;delegationState&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;pending&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Task description&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;dueDate&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;execution&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/executions/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;8&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My task&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;owner&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;owner&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;parentTask&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/9&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;priority&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">50</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinition&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstance&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;suspended&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">false</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskDefinitionKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;theTask&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/8&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_query_for_tasks">15.7.3. Query for tasks</h4>
<div class="listingblock">
<div class="content">
<pre>POST query/tasks</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My task&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;The task description&quot;</span><span class="tok-p">,</span>

  <span class="tok-err">...</span>

  <span class="tok-nt">&quot;taskVariables&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myVariable&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">1234</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;operation&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;equals&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;long&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>

    <span class="tok-nt">&quot;processInstanceVariables&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
      <span class="tok-p">{</span>
         <span class="tok-err">...</span>
      <span class="tok-p">}</span>
    <span class="tok-p">]</span>
  <span class="tok-err">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All supported JSON parameter fields allowed are exactly the same as the parameters found for <a href="#restTasksGet">getting a collection of tasks</a> (except for candidateGroupIn which is only available in this POST task query REST service), but passed in as JSON-body arguments rather than URL-parameters to allow for more advanced querying and preventing errors with request-uri&#8217;s that are too long. On top of that, the query allows for filtering based on task and process variables. The <code>taskVariables</code> and <code>processInstanceVariables</code> are both JSON-arrays containing objects with the format <a href="#restQueryVariable">as described here.</a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 123. Query for tasks - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the tasks are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates a parameter was passed in the wrong format or that <em>delegationState</em> has an invalid value (other than <em>pending</em> and <em>resolved</em>). The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;createTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;delegationState&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;pending&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Task description&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;dueDate&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;execution&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/executions/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;8&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My task&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;owner&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;owner&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;parentTask&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/9&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;priority&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">50</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinition&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstance&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;suspended&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">false</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskDefinitionKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;theTask&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/8&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_update_a_task">15.7.4. Update a task</h4>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/tasks/{taskId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;assignee&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;delegationState&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;resolved&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;New task description&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;dueDate&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T13:06:02.438+02:00&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;New task name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;owner&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;owner&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;parentTaskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;priority&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">20</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All request values are optional. For example, you can only include the <em>assignee</em> attribute in the request body JSON-object, only updating the assignee of the task, leaving all other fields unaffected. When an attribute is explicitly included and is set to null, the task-value will be updated to null. Example: <code>{"dueDate" : null}</code> will clear the duedate of the task).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 124. Update a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was updated simultaneously.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong> see response for <code>runtime/tasks/{taskId}</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_task_actions">15.7.5. Task actions</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/tasks/{taskId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Complete a task - Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;complete&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;variables&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Completes the task. Optional variable array can be passed in using the <code>variables</code> property. More information about the variable format can be found in <a href="#restVariables">the REST variables section</a>. Note that the variable-scope that is supplied is ignored and the variables are set on the parent-scope unless a variable exists in a local scope, which is overridden in this case. This is the same behavior as the <code>TaskService.completeTask(taskId, variables)</code> invocation.</p>
</div>
<div class="paragraph">
<p>Note that also a <em>transientVariables</em> property is accepted as part of this json, that follows the same structure as the <em>variables</em> property.</p>
</div>
<div class="paragraph">
<p><strong>Claim a task - Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;claim&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;userWhoClaims&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Claims the task by the given assignee. If the assignee is <code>null</code>, the task is assigned to no-one, claimable again.</p>
</div>
<div class="paragraph">
<p><strong>Delegate a task - Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;delegate&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;userToDelegateTo&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Delegates the task to the given assignee. The assignee is required.</p>
</div>
<div class="paragraph">
<p><strong>Resolve a task - Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span>
<span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;resolve&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Resolves the task delegation. The task is assigned back to the task owner (if any).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 125. Task actions - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the action was executed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When the body contains an invalid value or when the assignee is missing when the action requires it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the action cannot be performed due to a conflict. Either the task was updates simultaneously or the task was claimed by another user, in case of the <em><code>claim</code></em> action.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong> see response for <code>runtime/tasks/{taskId}</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_delete_a_task">15.7.6. Delete a task</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/tasks/{taskId}?cascadeHistory={cascadeHistory}&amp;deleteReason={deleteReason}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 126. &gt;Delete a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to delete.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cascadeHistory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether or not to delete the HistoricTask instance when deleting the task (if applicable). If not provided, this value defaults to false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deleteReason</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reason why the task is deleted. This value is ignored when <code>cascadeHistory</code> is true.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 127. &gt;Delete a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was found and has been deleted. Response-body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">403</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task cannot be deleted because it&#8217;s part of a workflow.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_all_variables_for_a_task">15.7.7. Get all variables for a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/variables?scope={scope}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 128. Get all variables for a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get variables for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope of variables to be returned. When <em><code>local</code></em>, only task-local variables are returned. When <em><code>global</code></em>, only variables from the task&#8217;s parent execution-hierarchy are returned. When the parameter is omitted, both local and global variables are returned.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 129. Get all variables for a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was found and the requested variables are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</div></td><td class="code"><span></span><span class="tok-p">[</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;doubleTaskVar&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;double&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-mf">99.99</span>
  <span class="tok-p">},</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;stringProcVar&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;global&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a ProcVariable&quot;</span>
  <span class="tok-p">}</span>



<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The variables are returned as a JSON array. Full response description can be found in the general <a href="#restVariables">REST-variables section</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_get_a_variable_from_a_task">15.7.8. Get a variable from a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/variables/{variableName}?scope={scope}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 130. Get a variable from a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get a variable for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the variable to get.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope of variable to be returned. When <em><code>local</code></em>, only task-local variable value is returned. When <em><code>global</code></em>, only variable value from the task&#8217;s parent execution-hierarchy are returned. When the parameter is omitted, a local variable will be returned if it exists, otherwise a global variable.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 131. Get a variable from a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was found and the requested variables are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the task doesn&#8217;t have a variable with the given name (in the given scope). Status message provides additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myTaskVariable&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Hello my friend&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Full response body description can be found in the general <a href="#restVariables">REST-variables section</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_get_the_binary_data_for_a_variable">15.7.9. Get the binary data for a variable</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/variables/{variableName}/data?scope={scope}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 132. Get the binary data for a variable - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get a variable data for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the variable to get data for. Only variables of type <code>binary</code> and <code>serializable</code> can be used. If any other type of variable is used, a <code>404</code> is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope of variable to be returned. When <em><code>local</code></em>, only task-local variable value is returned. When <em><code>global</code></em>, only variable value from the task&#8217;s parent execution-hierarchy are returned. When the parameter is omitted, a local variable will be returned if it exists, otherwise a global variable.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 133. Get the binary data for a variable - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was found and the requested variables are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the task doesn&#8217;t have a variable with the given name (in the given scope) or the variable doesn&#8217;t have a binary stream available. Status message provides additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>The response body contains the binary value of the variable. When the variable is of type <code>binary</code>, the content-type of the response is set to <code>application/octet-stream</code>, regardless of the content of the variable or the request accept-type header. In case of <code>serializable</code>, <code>application/x-java-serialized-object</code> is used as content-type.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_new_variables_on_a_task">15.7.10. Create new variables on a task</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/tasks/{taskId}/variables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 134. Create new variables on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to create the new variable for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body for creating simple (non-binary) variables:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">[</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myTaskVariable&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Hello my friend&quot;</span>
  <span class="tok-p">},</span>
  <span class="tok-p">{</span>

  <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The request body should be an array containing one or more JSON-objects representing the variables that should be created.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Required name of the variable</p>
</li>
<li>
<p><code>scope</code>: Scope of variable that is created. If omitted, <code>local</code> is assumed.</p>
</li>
<li>
<p><code>type</code>: Type of variable that is created. If omitted, reverts to raw JSON-value type (string, boolean, integer or double).</p>
</li>
<li>
<p><code>value</code>: Variable value.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>More information about the variable format can be found in <a href="#restVariables">the REST variables section</a>.</p>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">[</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myTaskVariable&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Hello my friend&quot;</span>
  <span class="tok-p">},</span>
  <span class="tok-p">{</span>

  <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 135. Create new variables on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the variables were created and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the name of a variable to create was missing or that an attempt is done to create a variable on a standalone task (without a process associated) with scope <code>global</code> or an empty array of variables was included in the request or request did not contain an array of variables. Status message provides additional information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task already has a variable with the given name. Use the PUT method to update the task variable instead.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_create_a_new_binary_variable_on_a_task">15.7.11. Create a new binary variable on a task</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/tasks/{taskId}/variables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 136. Create a new binary variable on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to create the new variable for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="paragraph">
<p>The request should be of type <code>multipart/form-data</code>. There should be a single file-part included with the binary value of the variable. On top of that, the following additional form-fields can be present:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Required name of the variable.</p>
</li>
<li>
<p><code>scope</code>: Scope of variable that is created. If omitted, <code>local</code> is assumed.</p>
</li>
<li>
<p><code>type</code>: Type of variable that is created. If omitted, <code>binary</code> is assumed and the binary data in the request will be stored as an array of bytes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binaryVariable&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binary&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;valueUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://.../runtime/tasks/123/variables/binaryVariable/data&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 137. Create a new binary variable on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the variable was created and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the name of the variable to create was missing or that an attempt is done to create a variable on a standalone task (without a process associated) with scope <code>global</code>. Status message provides additional information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task already has a variable with the given name. Use the PUT method to update the task variable instead.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">415</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the serializable data contains an object for which no class is present in the JVM running the Flowable engine and therefore cannot be deserialized.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_update_an_existing_variable_on_a_task">15.7.12. Update an existing variable on a task</h4>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/tasks/{taskId}/variables/{variableName}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 138. Update an existing variable on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to update the variable for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the variable to update.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body for updating simple (non-binary) variables:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myTaskVariable&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Hello my friend&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Required name of the variable</p>
</li>
<li>
<p><code>scope</code>: Scope of variable that is updated. If omitted, <code>local</code> is assumed.</p>
</li>
<li>
<p><code>type</code>: Type of variable that is updated. If omitted, reverts to raw JSON-value type (string, boolean, integer or double).</p>
</li>
<li>
<p><code>value</code>: Variable value.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>More information about the variable format can be found in <a href="#restVariables">the REST variables section</a>.</p>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myTaskVariable&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Hello my friend&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 139. Update an existing variable on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the variables was updated and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the name of a variable to update was missing or that an attempt is done to update a variable on a standalone task (without a process associated) with scope <code>global</code>. Status message provides additional information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the task doesn&#8217;t have a variable with the given name in the given scope. Status message contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_updating_a_binary_variable_on_a_task">15.7.13. Updating a binary variable on a task</h4>
<div class="listingblock">
<div class="content">
<pre>PUT runtime/tasks/{taskId}/variables/{variableName}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 140. Updating a binary variable on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to update the variable for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the variable to update.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="paragraph">
<p>The request should be of type <code>multipart/form-data</code>. There should be a single file-part included with the binary value of the variable. On top of that, the following additional form-fields can be present:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Required name of the variable.</p>
</li>
<li>
<p><code>scope</code>: Scope of variable that is updated. If omitted, <code>local</code> is assumed.</p>
</li>
<li>
<p><code>type</code>: Type of variable that is updated. If omitted, <code>binary</code> is assumed and the binary data in the request will be stored as an array of bytes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binaryVariable&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;scope&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;binary&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;valueUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://.../runtime/tasks/123/variables/binaryVariable/data&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 141. Updating a binary variable on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the variable was updated and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the name of the variable to update was missing or that an attempt is done to update a variable on a standalone task (without a process associated) with scope <code>global</code>. Status message provides additional information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the variable to update doesn&#8217;t exist for the given task in the given scope.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">415</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the serializable data contains an object for which no class is present in the JVM running the Flowable engine and therefore cannot be deserialized.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_delete_a_variable_on_a_task">15.7.14. Delete a variable on a task</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/tasks/{taskId}/variables/{variableName}?scope={scope}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 142. Delete a variable on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task the variable to delete belongs to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the variable to delete.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope of variable to delete in. Can be either <code>local</code> or <code>global</code>. If omitted, <code>local</code> is assumed.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 143. Delete a variable on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task variable was found and has been deleted. Response-body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the task doesn&#8217;t have a variable with the given name. Status message contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_delete_all_local_variables_on_a_task">15.7.15. Delete all local variables on a task</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/tasks/{taskId}/variables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 144. Delete all local variables on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task the variable to delete belongs to.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 145. Delete all local variables on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates all local task variables have been deleted. Response-body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_all_identity_links_for_a_task">15.7.16. Get all identity links for a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 146. Get all identity links for a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get the identity links for.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 147. Get all identity links for a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was found and the requested identity links are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-p">[</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;userId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;groupId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;candidate&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/runtime/tasks/100/identitylinks/users/kermit/candidate&quot;</span>
  <span class="tok-p">},</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;userId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;groupId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;sales&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;candidate&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/runtime/tasks/100/identitylinks/groups/sales/candidate&quot;</span>
  <span class="tok-p">},</span>

  <span class="tok-err">...</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_get_all_identitylinks_for_a_task_for_either_groups_or_users">15.7.17. Get all identitylinks for a task for either groups or users</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/identitylinks/users
GET runtime/tasks/{taskId}/identitylinks/groups</pre>
</div>
</div>
<div class="paragraph">
<p>Returns only identity links targeting either users or groups. Response body and status-codes are exactly the same as when getting the full list of identity links for a task.</p>
</div>
</div>
<div class="sect3">
<h4 id="_get_a_single_identity_link_on_a_task">15.7.18. Get a single identity link on a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/identitylinks/{family}/{identityId}/{type}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 148. Get all identitylinks for a task for either groups or users - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task .</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">family</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either <code>groups</code> or <code>users</code>, depending on what kind of identity is targeted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">identityId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the identity.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of identity link.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 149. Get all identitylinks for a task for either groups or users - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task and identity link was found and returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the task doesn&#8217;t have the requested identityLink. The status contains additional information about this error.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;userId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;groupId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;sales&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;candidate&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/runtime/tasks/100/identitylinks/groups/sales/candidate&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_an_identity_link_on_a_task">15.7.19. Create an identity link on a task</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/tasks/{taskId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 150. Create an identity link on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task .</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body (user):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;userId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;candidate&quot;</span><span class="tok-p">,</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body (group):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;groupId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;sales&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;candidate&quot;</span><span class="tok-p">,</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 151. Create an identity link on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was found and the identity link was created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the task doesn&#8217;t have the requested identityLink. The status contains additional information about this error.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;userId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;groupId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;sales&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;candidate&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/runtime/tasks/100/identitylinks/groups/sales/candidate&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_delete_an_identity_link_on_a_task">15.7.20. Delete an identity link on a task</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/tasks/{taskId}/identitylinks/{family}/{identityId}/{type}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 152. Delete an identity link on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">family</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either <code>groups</code> or <code>users</code>, depending on what kind of identity is targeted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">identityId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the identity.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of identity link.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 153. Delete an identity link on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task and identity link were found and the link has been deleted. Response-body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the task doesn&#8217;t have the requested identityLink. The status contains additional information about this error.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_create_a_new_comment_on_a_task">15.7.21. Create a new comment on a task</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/tasks/{taskId}/comments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 154. Create a new comment on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to create the comment for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a comment on the task.&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;saveProcessInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">true</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Parameter <code>saveProcessInstanceId</code> is optional, if <code>true</code> save process instance id of task with comment.</p>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;123&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/runtime/tasks/101/comments/123&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/history/historic-process-instances/100/comments/123&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a comment on the task.&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;author&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2014-07-13T13:13:52.232+08:00&quot;</span>
  <span class="tok-s2">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;101&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;100&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 155. Create a new comment on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the comment was created and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the comment is missing from the request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_all_comments_on_a_task">15.7.22. Get all comments on a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/comments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 156. Get all comments on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get the comments for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</div></td><td class="code"><span></span><span class="tok-p">[</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;123&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/runtime/tasks/101/comments/123&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/history/historic-process-instances/100/comments/123&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a comment on the task.&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;author&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span>
    <span class="tok-s2">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2014-07-13T13:13:52.232+08:00&quot;</span>
    <span class="tok-s2">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;101&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;100&quot;</span>
  <span class="tok-p">},</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;456&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/runtime/tasks/101/comments/456&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/history/historic-process-instances/100/comments/456&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is another comment on the task.&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;author&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;gonzo&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2014-07-13T13:13:52.232+08:00&quot;</span>
    <span class="tok-s2">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;101&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;100&quot;</span>
  <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 157. Get all comments on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was found and the comments are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_a_comment_on_a_task">15.7.23. Get a comment on a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/comments/{commentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 158. Get a comment on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get the comment for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">commentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the comment.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;123&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/runtime/tasks/101/comments/123&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/history/historic-process-instances/100/comments/123&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a comment on the task.&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;author&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2014-07-13T13:13:52.232+08:00&quot;</span>
  <span class="tok-s2">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;101&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;100&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 159. Get a comment on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task and comment were found and the comment is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the tasks doesn&#8217;t have a comment with the given ID.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_delete_a_comment_on_a_task">15.7.24. Delete a comment on a task</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/tasks/{taskId}/comments/{commentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 160. Delete a comment on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to delete the comment for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">commentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the comment.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 161. Delete a comment on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task and comment were found and the comment is deleted. Response body is left empty intentionally.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the tasks doesn&#8217;t have a comment with the given ID.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_all_events_for_a_task">15.7.25. Get all events for a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/events</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 162. Get all events for a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get the events for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-p">[</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;action&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;AddUserLink&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span> <span class="tok-s2">&quot;gonzo&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;contributor&quot;</span> <span class="tok-p">],</span>
    <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-05-17T11:50:50.000+0000&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2/events/4&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;userId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
  <span class="tok-p">}</span>

<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 163. Get all events for a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was found and the events are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_an_event_on_a_task">15.7.26. Get an event on a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/events/{eventId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 164. Get an event on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get the event for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eventId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the event.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;AddUserLink&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span> <span class="tok-s2">&quot;gonzo&quot;</span><span class="tok-p">,</span> <span class="tok-s2">&quot;contributor&quot;</span> <span class="tok-p">],</span>
  <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-05-17T11:50:50.000+0000&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2/events/4&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;userId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 165. Get an event on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task and event were found and the event is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the tasks doesn&#8217;t have an event with the given ID.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_create_a_new_attachment_on_a_task_containing_a_link_to_an_external_resource">15.7.27. Create a new attachment on a task, containing a link to an external resource</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/tasks/{taskId}/attachments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 166. Create a new attachment on a task, containing a link to an external resource - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to create the attachment for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Simple attachment&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Simple attachment description&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;simpleType&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;externalUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://flowable.org&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Only the attachment name is required to create a new attachment.</p>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2/attachments/3&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Simple attachment&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Simple attachment description&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;simpleType&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;externalUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://flowable.org&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;contentUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 167. Create a new attachment on a task, containing a link to an external resource - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the attachment was created and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the attachment name is missing from the request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_create_a_new_attachment_on_a_task_with_an_attached_file">15.7.28. Create a new attachment on a task, with an attached file</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/tasks/{taskId}/attachments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 168. Create a new attachment on a task, with an attached file - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to create the attachment for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="paragraph">
<p>The request should be of type <code>multipart/form-data</code>. There should be a single file-part included with the binary value of the variable. On top of that, the following additional form-fields can be present:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Required name of the variable.</p>
</li>
<li>
<p><code>description</code>: Description of the attachment, optional.</p>
</li>
<li>
<p><code>type</code>: Type of attachment, optional. Supports any arbitrary string or a valid HTTP content-type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">{</span>
	<span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
	<span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2/attachments/5&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Binary attachment&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Binary attachment description&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;binaryType&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;taskUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;externalUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;contentUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2/attachments/5/content&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 169. Create a new attachment on a task, with an attached file - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the attachment was created and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the attachment name is missing from the request or no file was present in the request. The error-message contains additional information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_all_attachments_on_a_task">15.7.29. Get all attachments on a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/attachments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 170. Get all attachments on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get the attachments for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</div></td><td class="code"><span></span><span class="tok-p">[</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2/attachments/3&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Simple attachment&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Simple attachment description&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;simpleType&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;taskUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;externalUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://flowable.org&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;contentUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
  <span class="tok-p">},</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2/attachments/5&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Binary attachment&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Binary attachment description&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;binaryType&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;taskUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;externalUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;contentUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2/attachments/5/content&quot;</span>
  <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 171. Get all attachments on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task was found and the attachments are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_an_attachment_on_a_task">15.7.30. Get an attachment on a task</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/attachments/{attachmentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 172. Get an attachment on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get the attachment for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">attachmentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the attachment.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2/attachments/5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Binary attachment&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Binary attachment description&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;binaryType&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;externalUrl&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;contentUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/tasks/2/attachments/5/content&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>externalUrl - contentUrl:</code>In case the attachment is a link to an external resource, the <code>externalUrl</code> contains the URL to the external content. If the attachment content is present in the Flowable engine, the <code>contentUrl</code> will contain an URL where the binary content can be streamed from.</p>
</li>
<li>
<p><code>type:</code>Can be any arbitrary value. When a valid formatted media-type (e.g. application/xml, text/plain) is included, the binary content HTTP response content-type will be set the the given value.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 173. Get an attachment on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task and attachment were found and the attachment is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the tasks doesn&#8217;t have a attachment with the given ID.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_the_content_for_an_attachment">15.7.31. Get the content for an attachment</h4>
<div class="listingblock">
<div class="content">
<pre>GET runtime/tasks/{taskId}/attachment/{attachmentId}/content</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 174. Get the content for an attachment - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to get a variable data for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">attachmentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the attachment, a <code>404</code> is returned when the attachment points to an external URL rather than content attached in Flowable.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 175. Get the content for an attachment - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task and attachment was found and the requested content is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the task doesn&#8217;t have an attachment with the given id or the attachment doesn&#8217;t have a binary stream available. Status message provides additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>The response body contains the binary content. By default, the content-type of the response is set to <code>application/octet-stream</code> unless the attachment type contains a valid Content-type.</p>
</div>
</div>
<div class="sect3">
<h4 id="_delete_an_attachment_on_a_task">15.7.32. Delete an attachment on a task</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE runtime/tasks/{taskId}/attachments/{attachmentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 176. Delete an attachment on a task - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the task to delete the attachment for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">attachmentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the attachment.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 177. Delete an attachment on a task - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task and attachment were found and the attachment is deleted. Response body is left empty intentionally.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the tasks doesn&#8217;t have a attachment with the given ID.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_history">15.8. History</h3>
<div class="sect3">
<h4 id="_get_a_historic_process_instance">15.8.1. Get a historic process instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-process-instances/{processInstanceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 178. Get a historic process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that the historic process instances could be found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that the historic process instances could not be found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;businessKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myKey&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;endTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T14:06:32.715+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;durationInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">86400056</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startUserId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startActivityId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;startEvent&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;endActivityId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;endEvent&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deleteReason&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;superProcessInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="restHistoricProcessInstancesGet">15.8.2. List of historic process instances</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-process-instances</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 179. List of historic process instances - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An id of the historic process instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process definition key of the historic process instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process definition id of the historic process instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">businessKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The business key of the historic process instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">involvedUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An involved user of the historic process instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">finished</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication if the historic process instance is finished.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">superProcessInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional parent process id of the historic process instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludeSubprocesses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic process instances which aren&#8217;t sub processes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">finishedAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic process instances that were finished after this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">finishedBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic process instances that were finished before this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startedAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic process instances that were started after this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startedBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic process instances that were started before this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startedBy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic process instances that were started by this user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeProcessVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An indication if the historic process instance variables should be returned as well.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return instances with the given tenantId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return instances with a tenantId like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only returns instances without a tenantId set. If <code>false</code>, the <code>withoutTenantId</code> parameter is ignored.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 180. List of historic process instances - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that historic process instances could be queried.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;businessKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myKey&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;endTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T14:06:32.715+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;durationInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">86400056</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startUserId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startActivityId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;startEvent&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;endActivityId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;endEvent&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deleteReason&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;superProcessInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span>
          <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;test&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;variableScope&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;myTest&quot;</span>
        <span class="tok-p">}</span>
      <span class="tok-p">],</span>
      <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_query_for_historic_process_instances">15.8.3. Query for historic process instances</h4>
<div class="listingblock">
<div class="content">
<pre>POST query/historic-process-instances</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>


  <span class="tok-nt">&quot;variables&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myVariable&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">1234</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;operation&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;equals&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;long&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All supported JSON parameter fields allowed are exactly the same as the parameters found for <a href="#restHistoricProcessInstancesGet">getting a collection of historic process instances</a>, but passed in as JSON-body arguments rather than URL-parameters to allow for more advanced querying and preventing errors with request-uri&#8217;s that are too long. On top of that, the query allows for filtering based on process variables. The <code>variables</code> property is a JSON-array containing objects with the format <a href="#restQueryVariable">as described here.</a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 181. Query for historic process instances - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the tasks are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;businessKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myKey&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;endTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T14:06:32.715+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;durationInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">86400056</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startUserId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startActivityId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;startEvent&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;endActivityId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;endEvent&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deleteReason&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;superProcessInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span>
          <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;test&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;variableScope&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;myTest&quot;</span>
        <span class="tok-p">}</span>
      <span class="tok-p">],</span>
      <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_delete_a_historic_process_instance">15.8.4. Delete a historic process instance</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE history/historic-process-instances/{processInstanceId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 182. Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that the historic process instance was deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that the historic process instance could not be found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_the_identity_links_of_a_historic_process_instance">15.8.5. Get the identity links of a historic process instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-process-instance/{processInstanceId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 183. Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the identity links are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance could not be found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">[</span>
 <span class="tok-p">{</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;participant&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;userId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;groupId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/5&quot;</span>
 <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_get_the_binary_data_for_a_historic_process_instance_variable">15.8.6. Get the binary data for a historic process instance variable</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-process-instances/{processInstanceId}/variables/{variableName}/data</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 184. Get the binary data for a historic process instance variable - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and the requested variable data is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested process instance was not found or the process instance doesn&#8217;t have a variable with the given name or the variable doesn&#8217;t have a binary stream available. Status message provides additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>The response body contains the binary value of the variable. When the variable is of type <code>binary</code>, the content-type of the response is set to <code>application/octet-stream</code>, regardless of the content of the variable or the request accept-type header. In case of <code>serializable</code>, <code>application/x-java-serialized-object</code> is used as content-type.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_a_new_comment_on_a_historic_process_instance">15.8.7. Create a new comment on a historic process instance</h4>
<div class="listingblock">
<div class="content">
<pre>POST history/historic-process-instances/{processInstanceId}/comments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 185. Create a new comment on a historic process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to create the comment for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a comment.&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;saveProcessInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">true</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Parameter <code>saveProcessInstanceId</code> is optional, if <code>true</code> save process instance id of task with comment.</p>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;123&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/runtime/tasks/101/comments/123&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/history/historic-process-instances/100/comments/123&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a comment on the task.&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;author&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2014-07-13T13:13:52.232+08:00&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;101&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;100&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 186. Create a new comment on a historic process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the comment was created and the result is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the comment is missing from the request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested historic process instance was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_all_comments_on_a_historic_process_instance">15.8.8. Get all comments on a historic process instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-process-instances/{processInstanceId}/comments</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 187. Get all comments on a process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the process instance to get the comments for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</div></td><td class="code"><span></span><span class="tok-p">[</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;123&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/history/historic-process-instances/100/comments/123&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is a comment on the task.&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;author&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2014-07-13T13:13:52.232+08:00&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;100&quot;</span>
  <span class="tok-p">},</span>
  <span class="tok-p">{</span>
    <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;456&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/history/historic-process-instances/100/comments/456&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is another comment.&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;author&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;gonzo&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2014-07-14T15:16:52.232+08:00&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;100&quot;</span>
  <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 188. Get all comments on a process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the process instance was found and the comments are returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_a_comment_on_a_historic_process_instance">15.8.9. Get a comment on a historic process instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-process-instances/{processInstanceId}/comments/{commentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 189. Get a comment on a historic process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the historic process instance to get the comment for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">commentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the comment.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;123&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8081/flowable-rest/service/history/historic-process-instances/100/comments/456&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;message&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;This is another comment.&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;author&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;gonzo&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2014-07-14T15:16:52.232+08:00&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;100&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 190. Get a comment on a historic process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the historic process instance and comment were found and the comment is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested historic process instance was not found or the historic process instance doesn&#8217;t have a comment with the given ID.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_delete_a_comment_on_a_historic_process_instance">15.8.10. Delete a comment on a historic process instance</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE history/historic-process-instances/{processInstanceId}/comments/{commentId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 191. Delete a comment on a historic process instance - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the historic process instance to delete the comment for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">commentId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the comment.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 192. Delete a comment on a historic process instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the historic process instance and comment were found and the comment is deleted. Response body is left empty intentionally.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task was not found or the historic process instance doesn&#8217;t have a comment with the given ID.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_a_single_historic_task_instance">15.8.11. Get a single historic task instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-task-instances/{taskId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 193. Get a single historic task instance - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that the historic task instances could be found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that the historic task instances could not be found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processDefinitionUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/3&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;executionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My task name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My task description&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;deleteReason&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;owner&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;fozzie&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;startTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;endTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T14:06:32.715+0000&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;durationInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">86400056</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;workTimeInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">234890</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;claimTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T11:01:54.715+0000&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskDefinitionKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;taskKey&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;formKey&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;priority&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">50</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;dueDate&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-20T12:11:13.134+0000&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;parentTaskId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-task-instances/5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="restHistoricTaskInstancesGet">15.8.12. Get historic task instances</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-task-instances</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 194. Get historic task instances - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An id of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process instance id of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process definition key of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionKeyLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process definition key of the historic task instance, which matches the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process definition id of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process definition name of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process definition name of the historic task instance, which matches the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processBusinessKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process instance business key of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processBusinessKeyLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process instance business key of the historic task instance that matches the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The execution id of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task definition key for tasks part of a process</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task name of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task name with <em>like</em> operator for the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDescription</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task description of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDescriptionLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task description with <em>like</em> operator for the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDefinitionKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task identifier from the process definition for the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskCategory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select tasks with the given category. Note that this is the task category, not the category of the process definition (namespace within the BPMN Xml).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDeleteReason</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task delete reason of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskDeleteReasonLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task delete reason with <em>like</em> operator for the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskAssignee</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The assignee of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskAssigneeLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The assignee with <em>like</em> operator for the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskOwner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The owner of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskOwnerLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The owner with <em>like</em> operator for the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskInvolvedUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An involved user of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskPriority</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The priority of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">finished</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication if the historic task instance is finished.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processFinished</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication if the process instance of the historic task instance is finished.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parentTaskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional parent task id of the historic task instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic task instances that have a due date equal this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueDateAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic task instances that have a due date after this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueDateBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic task instances that have a due date before this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutDueDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic task instances that have no due-date. When <code>false</code> is provided as value, this parameter is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskCompletedOn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic task instances that have been completed on this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskCompletedAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic task instances that have been completed after this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskCompletedBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic task instances that have been completed before this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskCreatedOn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic task instances that were created on this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskCreatedBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic task instances that were created before this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskCreatedAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return only historic task instances that were created after this date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeTaskLocalVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An indication if the historic task instance local variables should be returned as well.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeProcessVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An indication if the historic task instance global variables should be returned as well.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return historic task instances with the given tenantId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return historic task instances with a tenantId like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only returns historic task instances without a tenantId set. If <code>false</code>, the <code>withoutTenantId</code> parameter is ignored.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 195. Get historic task instances - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that historic process instances could be queried.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;executionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My task name&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My task description&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deleteReason&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;owner&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;fozzie&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;endTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T14:06:32.715+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;durationInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">86400056</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;workTimeInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">234890</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;claimTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T11:01:54.715+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskDefinitionKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;taskKey&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;formKey&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;priority&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">50</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;dueDate&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-20T12:11:13.134+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;parentTaskId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-task-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskVariables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span>
          <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;test&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;variableScope&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;myTest&quot;</span>
        <span class="tok-p">}</span>
      <span class="tok-p">],</span>
      <span class="tok-nt">&quot;processVariables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span>
          <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;processTest&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;variableScope&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;global&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;myProcessTest&quot;</span>
        <span class="tok-p">}</span>
      <span class="tok-p">],</span>
      <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_query_for_historic_task_instances">15.8.13. Query for historic task instances</h4>
<div class="listingblock">
<div class="content">
<pre>POST query/historic-task-instances</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Query for historic task instances - Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
  <span class="tok-err">...</span>

  <span class="tok-nt">&quot;variables&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myVariable&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">1234</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;operation&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;equals&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;long&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All supported JSON parameter fields allowed are exactly the same as the parameters found for <a href="#restHistoricTaskInstancesGet">getting a collection of historic task instances</a>, but passed in as JSON-body arguments rather than URL-parameters to allow for more advanced querying and preventing errors with request-uri&#8217;s that are too long. On top of that, the query allows for filtering based on process variables. The <code>taskVariables</code> and <code>processVariables</code> properties are JSON-arrays containing objects with the format <a href="#restQueryVariable">as described here.</a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 196. Query for historic task instances - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the tasks are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;executionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My task name&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;description&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My task description&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deleteReason&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;owner&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;fozzie&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;endTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T14:06:32.715+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;durationInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">86400056</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;workTimeInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">234890</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;claimTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T11:01:54.715+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskDefinitionKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;taskKey&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;formKey&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;priority&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">50</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;dueDate&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-20T12:11:13.134+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;parentTaskId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-task-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskVariables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span>
          <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;test&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;variableScope&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;local&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;myTest&quot;</span>
        <span class="tok-p">}</span>
      <span class="tok-p">],</span>
      <span class="tok-nt">&quot;processVariables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span>
          <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;processTest&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;variableScope&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;global&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;myProcessTest&quot;</span>
        <span class="tok-p">}</span>
      <span class="tok-p">],</span>
      <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_delete_a_historic_task_instance">15.8.14. Delete a historic task instance</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE history/historic-task-instances/{taskId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 197. Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that the historic task instance was deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that the historic task instance could not be found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_the_identity_links_of_a_historic_task_instance">15.8.15. Get the identity links of a historic task instance</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-task-instance/{taskId}/identitylinks</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 198. Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the identity links are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task instance could not be found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-p">[</span>
 <span class="tok-p">{</span>
  <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;assignee&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;userId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;groupId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;6&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-task-instances/5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
 <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_get_the_binary_data_for_a_historic_task_instance_variable">15.8.16. Get the binary data for a historic task instance variable</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-task-instances/{taskId}/variables/{variableName}/data</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 199. Get the binary data for a historic task instance variable - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the task instance was found and the requested variable data is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested task instance was not found or the process instance doesn&#8217;t have a variable with the given name or the variable doesn&#8217;t have a binary stream available. Status message provides additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>The response body contains the binary value of the variable. When the variable is of type <code>binary</code>, the content-type of the response is set to <code>application/octet-stream</code>, regardless of the content of the variable or the request accept-type header. In case of <code>serializable</code>, <code>application/x-java-serialized-object</code> is used as content-type.</p>
</div>
</div>
<div class="sect3">
<h4 id="restHistoricActivityInstancesGet">15.8.17. Get historic activity instances</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-activity-instances</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 200. Get historic activity instances - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">activityId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An id of the activity instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">activityInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An id of the historic activity instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">activityName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the historic activity instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">activityType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The element type of the historic activity instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The execution id of the historic activity instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">finished</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication if the historic activity instance is finished.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskAssignee</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The assignee of the historic activity instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process instance id of the historic activity instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process definition id of the historic activity instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return instances with the given tenantId.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return instances with a tenantId like the given value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only returns instances without a tenantId set. If <code>false</code>, the <code>withoutTenantId</code> parameter is ignored.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 201. Get historic activity instances - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that historic activity instances could be queried.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;activityId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;activityName&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My user task&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;activityType&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;userTask&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;executionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;calledProcessInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;fozzie&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;endTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T14:06:32.715+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;durationInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">86400056</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_query_for_historic_activity_instances">15.8.18. Query for historic activity instances</h4>
<div class="listingblock">
<div class="content">
<pre>POST query/historic-activity-instances</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All supported JSON parameter fields allowed are exactly the same as the parameters found for <a href="#restHistoricTaskInstancesGet">getting a collection of historic task instances</a>, but passed in as JSON-body arguments rather than URL-parameters to allow for more advanced querying and preventing errors with request-uri&#8217;s that are too long.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 202. Query for historic activity instances - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the activities are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;activityId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;activityName&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;My user task&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;activityType&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;userTask&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;executionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;4&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;calledProcessInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;assignee&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;fozzie&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;startTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;endTime&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-18T14:06:32.715+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;durationInMillis&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">86400056</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="restHistoricVariableInstancesGet">15.8.19. List of historic variable instances</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-variable-instances</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 203. List of historic variable instances - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process instance id of the historic variable instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task id of the historic variable instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludeTaskVariables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication to exclude the task variables from the result.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The variable name of the historic variable instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variableNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The variable name using the <em>like</em> operator for the historic variable instance.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 204. List of historic variable instances - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that historic variable instances could be queried.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;14&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;6&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;variable&quot;</span> <span class="tok-p">:</span> <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myVariable&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;variableScope&quot;</span><span class="tok-p">,</span> <span class="tok-nt">&quot;global&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;test&quot;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_query_for_historic_variable_instances">15.8.20. Query for historic variable instances</h4>
<div class="listingblock">
<div class="content">
<pre>POST query/historic-variable-instances</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;oneTaskProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
  <span class="tok-err">...</span>

  <span class="tok-nt">&quot;variables&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myVariable&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">1234</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;operation&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;equals&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;long&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All supported JSON parameter fields allowed are exactly the same as the parameters found for <a href="#restHistoricVariableInstancesGet">getting a collection of historic process instances</a>, but passed in as JSON-body arguments rather than URL-parameters to allow for more advanced querying and preventing errors with request-uri&#8217;s that are too long. On top of that, the query allows for filtering based on process variables. The <code>variables</code> property is a JSON-array containing objects with the format <a href="#restQueryVariable">as described here.</a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 205. Query for historic variable instances - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the tasks are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;14&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;6&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;variable&quot;</span> <span class="tok-p">:</span> <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myVariable&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;variableScope&quot;</span><span class="tok-p">,</span> <span class="tok-nt">&quot;global&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;test&quot;</span>
      <span class="tok-p">}</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>====Get the binary data for a historic task instance variable</p>
</div>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-variable-instances/{varInstanceId}/data</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 206. Get the binary data for a historic task instance variable - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the variable instance was found and the requested variable data is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested variable instance was not found or the variable instance doesn&#8217;t have a variable with the given name or the variable doesn&#8217;t have a binary stream available. Status message provides additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>The response body contains the binary value of the variable. When the variable is of type <code>binary</code>, the content-type of the response is set to <code>application/octet-stream</code>, regardless of the content of the variable or the request accept-type header. In case of <code>serializable</code>, <code>application/x-java-serialized-object</code> is used as content-type.</p>
</div>
</div>
<div class="sect3">
<h4 id="restHistoricDetailGet">15.8.21. Get historic detail</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-detail</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 207. Get historic detail - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the historic detail.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process instance id of the historic detail.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The execution id of the historic detail.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">activityInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The activity instance id of the historic detail.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task id of the historic detail.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">selectOnlyFormProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication to only return form properties in the result.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">selectOnlyVariableUpdates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication to only return variable updates in the result.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 208. Get historic detail - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that historic detail could be queried.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;26&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;executionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;6&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;activityInstanceId&quot;</span><span class="tok-p">,</span> <span class="tok-nt">&quot;10&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;6&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-task-instances/6&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;detailType&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;variableUpdate&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;revision&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">2</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;variable&quot;</span> <span class="tok-p">:</span> <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myVariable&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;variableScope&quot;</span><span class="tok-p">,</span> <span class="tok-nt">&quot;global&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;test&quot;</span>
      <span class="tok-p">},</span>
      <span class="tok-nt">&quot;propertyId&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;propertyValue&quot;</span><span class="tok-p">:</span> <span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_query_for_historic_details">15.8.22. Query for historic details</h4>
<div class="listingblock">
<div class="content">
<pre>POST query/historic-detail</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "processInstanceId" : "5",
}</pre>
</div>
</div>
<div class="paragraph">
<p>All supported JSON parameter fields allowed are exactly the same as the parameters found for <a href="#restHistoricDetailGet">getting a collection of historic process instances</a>, but passed in as JSON-body arguments rather than URL-parameters to allow for more advanced querying and preventing errors with request-uri&#8217;s that are too long.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 209. Query for historic details - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the historic details are returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;26&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processInstanceUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/5&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;executionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;6&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;activityInstanceId&quot;</span><span class="tok-p">,</span> <span class="tok-nt">&quot;10&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;6&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-task-instances/6&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;time&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2013-04-17T10:17:43.902+0000&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;detailType&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;variableUpdate&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;revision&quot;</span> <span class="tok-p">:</span> <span class="tok-mi">2</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;variable&quot;</span> <span class="tok-p">:</span> <span class="tok-p">{</span>
        <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myVariable&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;variableScope&quot;</span><span class="tok-p">,</span> <span class="tok-nt">&quot;global&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;test&quot;</span>
      <span class="tok-p">},</span>
      <span class="tok-nt">&quot;propertyId&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;propertyValue&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_get_the_binary_data_for_a_historic_detail_variable">15.8.23. Get the binary data for a historic detail variable</h4>
<div class="listingblock">
<div class="content">
<pre>GET history/historic-detail/{detailId}/data</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 210. Get the binary data for a historic detail variable - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the historic detail instance was found and the requested variable data is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested historic detail instance was not found or the historic detail instance doesn&#8217;t have a variable with the given name or the variable doesn&#8217;t have a binary stream available. Status message provides additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="paragraph">
<p>The response body contains the binary value of the variable. When the variable is of type <code>binary</code>, the content-type of the response is set to <code>application/octet-stream</code>, regardless of the content of the variable or the request accept-type header. In case of <code>serializable</code>, <code>application/x-java-serialized-object</code> is used as content-type.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_forms">15.9. Forms</h3>
<div class="sect3">
<h4 id="_get_form_data">15.9.1. Get form data</h4>
<div class="listingblock">
<div class="content">
<pre>GET form/form-data</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 211. Get form data - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">taskId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes (if no processDefinitionId)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The task id corresponding to the form data that needs to be retrieved.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes (if no taskId)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The process definition id corresponding to the start event form data that needs to be retrieved.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 212. Get form data - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that form data could be queried.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that form data could not be found.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;formKey&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;deploymentId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;2&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;processDefinitionUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definition/3&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;6&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;taskUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/runtime/task/6&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;formProperties&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
        <span class="tok-p">{</span>
          <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;room&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Room&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;type&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;readable&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">true</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;writable&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">true</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;required&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">true</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;datePattern&quot;</span> <span class="tok-p">:</span> <span class="tok-kc">null</span><span class="tok-p">,</span>
          <span class="tok-nt">&quot;enumValues&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
            <span class="tok-p">{</span>
              <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;normal&quot;</span><span class="tok-p">,</span>
              <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Normal bed&quot;</span>
            <span class="tok-p">},</span>
            <span class="tok-p">{</span>
              <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;kingsize&quot;</span><span class="tok-p">,</span>
              <span class="tok-nt">&quot;name&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;Kingsize bed&quot;</span>
            <span class="tok-p">},</span>
          <span class="tok-p">]</span>
        <span class="tok-p">}</span>
      <span class="tok-p">]</span>
    <span class="tok-p">}</span>
  <span class="tok-p">],</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;name&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span> <span class="tok-mi">1</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_submit_task_form_data">15.9.2. Submit task form data</h4>
<div class="listingblock">
<div class="content">
<pre>POST form/form-data</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body for task form:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;taskId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;properties&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;room&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;normal&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Request body for start event form:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;businessKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myKey&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;properties&quot;</span> <span class="tok-p">:</span> <span class="tok-p">[</span>
    <span class="tok-p">{</span>
      <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;room&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;value&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;normal&quot;</span>
    <span class="tok-p">}</span>
  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 213. Submit task form data - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates request was successful and the form data was submitted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an parameter was passed in the wrong format. The status-message contains additional information.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body for start event form data (no response for task form data):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;id&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;url&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/history/historic-process-instances/5&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;businessKey&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myKey&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;suspended&quot;</span><span class="tok-p">:</span> <span class="tok-kc">false</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processDefinitionId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;processDefinitionUrl&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8182/repository/process-definition/3&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;activityId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;myTask&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_database_tables">15.10. Database tables</h3>
<div class="sect3">
<h4 id="_list_of_tables">15.10.1. List of tables</h4>
<div class="listingblock">
<div class="content">
<pre>GET management/tables</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 214. List of tables - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the request was successful.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-p">[</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;ACT_RU_VARIABLE&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/management/tables/ACT_RU_VARIABLE&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;count&quot;</span><span class="tok-p">:</span><span class="tok-mi">4528</span>
   <span class="tok-p">},</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;ACT_RU_EVENT_SUBSCR&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/management/tables/ACT_RU_EVENT_SUBSCR&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;count&quot;</span><span class="tok-p">:</span><span class="tok-mi">3</span>
   <span class="tok-p">}</span>

<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_get_a_single_table">15.10.2. Get a single table</h4>
<div class="listingblock">
<div class="content">
<pre>GET management/tables/{tableName}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 215. Get a single table - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the table to get.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
      <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;ACT_RE_PROCDEF&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/management/tables/ACT_RE_PROCDEF&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;count&quot;</span><span class="tok-p">:</span><span class="tok-mi">60</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 216. Get a single table - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the table exists and the table count is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested table does not exist.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_column_info_for_a_single_table">15.10.3. Get column info for a single table</h4>
<div class="listingblock">
<div class="content">
<pre>GET management/tables/{tableName}/columns</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 217. Get column info for a single table - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the table to get.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</div></td><td class="code"><span></span>
<span class="tok-p">{</span>
   <span class="tok-nt">&quot;tableName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;ACT_RU_VARIABLE&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;columnNames&quot;</span><span class="tok-p">:[</span>
      <span class="tok-s2">&quot;ID_&quot;</span><span class="tok-p">,</span>
      <span class="tok-s2">&quot;REV_&quot;</span><span class="tok-p">,</span>
      <span class="tok-s2">&quot;TYPE_&quot;</span><span class="tok-p">,</span>
      <span class="tok-s2">&quot;NAME_&quot;</span>


   <span class="tok-p">],</span>
   <span class="tok-nt">&quot;columnTypes&quot;</span><span class="tok-p">:[</span>
      <span class="tok-s2">&quot;VARCHAR&quot;</span><span class="tok-p">,</span>
      <span class="tok-s2">&quot;INTEGER&quot;</span><span class="tok-p">,</span>
      <span class="tok-s2">&quot;VARCHAR&quot;</span><span class="tok-p">,</span>
      <span class="tok-s2">&quot;VARCHAR&quot;</span>


   <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 218. Get column info for a single table - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the table exists and the table column info is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested table does not exist.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_row_data_for_a_single_table">15.10.4. Get row data for a single table</h4>
<div class="listingblock">
<div class="content">
<pre>GET management/tables/{tableName}/data</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 219. Get row data for a single table - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tableName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the table to get.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 220. Get row data for a single table - URL query parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">start</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Index of the first row to fetch. Defaults to 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of rows to fetch, starting from <code>start</code>. Defaults to 10.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">orderAscendingColumn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the column to sort the resulting rows on, ascending.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">orderDescendingColumn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the column to sort the resulting rows on, descending.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span><span class="tok-mi">3</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span><span class="tok-mi">3</span><span class="tok-p">,</span>

   <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:[</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;TASK_ID_&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;NAME_&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;var1&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;REV_&quot;</span><span class="tok-p">:</span><span class="tok-mi">1</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;TEXT_&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;123&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;LONG_&quot;</span><span class="tok-p">:</span><span class="tok-mi">123</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;ID_&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;3&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;TYPE_&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;integer&quot;</span>
      <span class="tok-p">}</span>



   <span class="tok-p">]</span>

<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 221. Get row data for a single table - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the table exists and the table row data is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested table does not exist.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_engine">15.11. Engine</h3>
<div class="sect3">
<h4 id="_get_engine_properties">15.11.1. Get engine properties</h4>
<div class="listingblock">
<div class="content">
<pre>GET management/properties</pre>
</div>
</div>
<div class="paragraph">
<p>Returns a read-only view of the properties used internally in the engine.</p>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;next.dbid&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;101&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;schema.history&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;create(5.15)&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;schema.version&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5.15&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 222. Get engine properties - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the properties are returned.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_engine_info">15.11.2. Get engine info</h4>
<div class="listingblock">
<div class="content">
<pre>GET management/engine</pre>
</div>
</div>
<div class="paragraph">
<p>Returns a read-only view of the engine that is used in this REST-service.</p>
</div>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;default&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5.15&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;resourceUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;file://flowable/flowable.cfg.xml&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;exception&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 223. Get engine info - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the engine info is returned.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_runtime">15.12. Runtime</h3>
<div class="sect3">
<h4 id="_signal_event_received">15.12.1. Signal event received</h4>
<div class="listingblock">
<div class="content">
<pre>POST runtime/signals</pre>
</div>
</div>
<div class="paragraph">
<p>Notifies the engine that a signal event has been received, not explicitly related to a specific execution.</p>
</div>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8
9</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;signalName&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;My Signal&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;tenantId&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;execute&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;async&quot;</span><span class="tok-p">:</span> <span class="tok-kc">true</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;variables&quot;</span><span class="tok-p">:</span> <span class="tok-p">[</span>
      <span class="tok-p">{</span><span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;testVar&quot;</span><span class="tok-p">,</span> <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;This is a string&quot;</span><span class="tok-p">}</span>

  <span class="tok-p">]</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 224. Signal event received - JSON Body parameters</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">signalName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the signal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the tenant that the signal event should be processed in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">async</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, handling of the signal will happen asynchronously. Return code will be <code>202 - Accepted</code> to indicate the request is accepted but not yet executed. If <code>false</code>,
                    handling the signal will be done immediately and result (<code>200 - OK</code>) will only return after this completed successfully. Defaults to <code>false</code> if omitted.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of variables (in the general variables format) to use as payload to pass along with the signal. Cannot be used in case <code>async</code> is set to <code>true</code>, this will result in an error.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 225. Signal event received - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicated signal has been processed and no errors occurred.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">202</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicated signal processing is queued as a job, ready to be executed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signal not processed. The signal name is missing or variables are used together with async, which is not allowed. Response body contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_jobs">15.13. Jobs</h3>
<div class="sect3">
<h4 id="_get_a_single_job">15.13.1. Get a single job</h4>
<div class="listingblock">
<div class="content">
<pre>GET management/jobs/{jobId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 226. Get a single job - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jobId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the job to get.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;8&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/management/jobs/8&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processDefinitionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;timerProcess:1:4&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;processDefinitionUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/timerProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;executionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;7&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;executionUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/executions/7&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;retries&quot;</span><span class="tok-p">:</span><span class="tok-mi">3</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;exceptionMessage&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;dueDate&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-06-04T22:05:05.474+0000&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 227. Get a single job - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the job exists and is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested job does not exist.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_delete_a_job">15.13.2. Delete a job</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE management/jobs/{jobId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 228. Delete a job - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jobId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the job to delete.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 229. Delete a job - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the job was found and has been deleted. Response-body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested job was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_execute_a_single_job">15.13.3. Execute a single job</h4>
<div class="listingblock">
<div class="content">
<pre>POST management/jobs/{jobId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;action&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;execute&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 230. Execute a single job - JSON Body parameters</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">action</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action to perform. Only <code>execute</code> is supported.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 231. Execute a single job - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the job was executed. Response-body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested job was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the an exception occurred while executing the job. The status-description contains additional detail about the error. The full error-stacktrace can be fetched later on if needed.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_the_exception_stacktrace_for_a_job">15.13.4. Get the exception stacktrace for a job</h4>
<div class="listingblock">
<div class="content">
<pre>GET management/jobs/{jobId}/exception-stacktrace</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 232. Get the exception stacktrace for a job - URL parameters</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jobId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Id of the job to get the stacktrace for.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 233. Get the exception stacktrace for a job - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested job was not found and the stacktrace has been returned. The response contains the raw stacktrace and always has a Content-type of <code>text/plain</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested job was not found or the job doesn&#8217;t have an exception stacktrace. Status-description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_a_list_of_jobs">15.13.5. Get a list of jobs</h4>
<div class="listingblock">
<div class="content">
<pre>GET management/jobs</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 234. Get a list of jobs - URL query parameters</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return job with the given id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return jobs part of a process with the given id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return jobs part of an execution with the given id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitionId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return jobs with the given process definition id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withRetriesLeft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only return jobs with retries left. If false, this parameter is ignored.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only return jobs which are executable. If false, this parameter is ignored.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timersOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only return jobs which are timers. If false, this parameter is ignored. Cannot be used together with <code>'messagesOnly'</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">messagesOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only return jobs which are messages. If false, this parameter is ignored. Cannot be used together with <code>'timersOnly'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withException</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only return jobs for which an exception occurred while executing it. If false, this parameter is ignored.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueBefore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return jobs which are due to be executed before the given date. Jobs without duedate are never returned using this parameter.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dueAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return jobs which are due to be executed after the given date. Jobs without duedate are never returned using this parameter.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">exceptionMessage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return jobs with the given exception message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return jobs with the given tenantId.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tenantIdLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return jobs with a tenantId like the given value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">withoutTenantId</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, only returns jobs without a tenantId set. If <code>false</code>, the <code>withoutTenantId</code> parameter is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field to sort results on, should be one of <code>id</code>, <code>dueDate</code>, <code>executionId</code>, <code>processInstanceId</code>, <code>retries</code> or <code>tenantId</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:[</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;13&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/management/jobs/13&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processInstanceId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processInstanceUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/process-instances/5&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processDefinitionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;timerProcess:1:4&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;processDefinitionUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/repository/process-definitions/timerProcess%3A1%3A4&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;executionId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;12&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;executionUrl&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/runtime/executions/12&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;retries&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;exceptionMessage&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Can&#39;t find scripting engine for &#39;unexistinglanguage&#39;&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;dueDate&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;2013-06-07T10:00:24.653+0000&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;tenantId&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
      <span class="tok-p">}</span>



   <span class="tok-p">],</span>
   <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;id&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span><span class="tok-mi">2</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 235. Get a list of jobs - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested jobs were returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates an illegal value has been used in a url query parameter or the both <code>'messagesOnly'</code> and <code>'timersOnly'</code> are used as parameters. Status description contains additional details about the error.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_users">15.14. Users</h3>
<div class="sect3">
<h4 id="_get_a_single_user">15.14.1. Get a single user</h4>
<div class="listingblock">
<div class="content">
<pre>GET identity/users/{userId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 236. Get a single user - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to get.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;testuser&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;firstName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Fred&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;lastName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;McDonald&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/users/testuser&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;email&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;no-reply@flowable.org&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 237. Get a single user - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user exists and is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user does not exist.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_a_list_of_users">15.14.2. Get a list of users</h4>
<div class="listingblock">
<div class="content">
<pre>GET identity/users</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 238. Get a list of users - URL query parameters</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return user with the given id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">firstName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return users with the given firstname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return users with the given lastname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return users with the given email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">firstNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return users with a firstname like the given value. Use <code>%</code> as wildcard-character.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return users with a lastname like the given value. Use <code>%</code> as wildcard-character.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">emailLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return users with an email like the given value. Use <code>%</code> as wildcard-character.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">memberOfGroup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return users which are a member of the given group.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">potentialStarter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return users which are potential starters for a process-definition with the given id.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field to sort results on, should be one of <code>id</code>, <code>firstName</code>, <code>lastname</code> or <code>email</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:[</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;anotherUser&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;firstName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Tijs&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;lastName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Barrez&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/users/anotherUser&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;email&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;no-reply@flowable.org&quot;</span>
      <span class="tok-p">},</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;firstName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Kermit&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;lastName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;the Frog&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/users/kermit&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;email&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
      <span class="tok-p">},</span>
      <span class="tok-p">{</span>
         <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;testuser&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;firstName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Fred&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;lastName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;McDonald&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/users/testuser&quot;</span><span class="tok-p">,</span>
         <span class="tok-nt">&quot;email&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;no-reply@flowable.org&quot;</span>
      <span class="tok-p">}</span>
   <span class="tok-p">],</span>
   <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span><span class="tok-mi">3</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;id&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span><span class="tok-mi">3</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 239. Get a list of users - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested users were returned.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_update_a_user">15.14.3. Update a user</h4>
<div class="listingblock">
<div class="content">
<pre>PUT identity/users/{userId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;firstName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Tijs&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;lastName&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Barrez&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;email&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;no-reply@flowable.org&quot;</span><span class="tok-p">,</span>
  <span class="tok-nt">&quot;password&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;pass123&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All request values are optional. For example, you can only include the <em>firstName</em> attribute in the request body JSON-object, only updating the firstName of the user, leaving all other fields unaffected. When an attribute is explicitly included and is set to null, the user-value will be updated to null. Example: <code>{"firstName" : null}</code> will clear the firstName of the user).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 240. Update a user - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user was updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user was updated simultaneously.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong> see response for <code>identity/users/{userId}</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_a_user">15.14.4. Create a user</h4>
<div class="listingblock">
<div class="content">
<pre>POST identity/users</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "id":"tijs",
  "firstName":"Tijs",
  "lastName":"Barrez",
  "email":"no-reply@flowable.org",
  "password":"pass123"
}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 241. Create a user - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user was created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the id of the user was missing.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong> see response for <code>identity/users/{userId}</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_delete_a_user">15.14.5. Delete a user</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE identity/users/{userId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 242. Delete a user - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to delete.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 243. Delete a user - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user was found and  has been deleted. Response-body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_a_users_picture">15.14.6. Get a user&#8217;s picture</h4>
<div class="listingblock">
<div class="content">
<pre>GET identity/users/{userId}/picture</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 244. Get a user&#8217;s picture - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to get the picture for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Response Body:</strong></p>
</div>
<div class="paragraph">
<p>The response body contains the raw picture data, representing the user&#8217;s picture. The Content-type of the response corresponds to the mimeType that was set when creating the picture.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 245. Get a user&#8217;s picture - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user was found and has a picture, which is returned in the body.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user was not found or the user does not have a profile picture. Status-description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_updating_a_users_picture">15.14.7. Updating a user&#8217;s picture</h4>
<div class="listingblock">
<div class="content">
<pre>GET identity/users/{userId}/picture</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 246. Updating a user&#8217;s picture - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to get the picture for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request body:</strong></p>
</div>
<div class="paragraph">
<p>The request should be of type <code>multipart/form-data</code>. There should be a single file-part included with the binary value of the picture. On top of that, the following additional form-fields can be present:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mimeType</code>: Optional mime-type for the uploaded picture. If omitted, the default of <code>image/jpeg</code> is used as a mime-type for the picture.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 247. Updating a user&#8217;s picture - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user was found and the picture has been updated. The response-body is left empty intentionally.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_list_a_users_info">15.14.8. List a user&#8217;s info</h4>
<div class="listingblock">
<div class="content">
<pre>PUT identity/users/{userId}/info</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 248. List a user&#8217;s info - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to get the info for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Response Body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-p">[</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;key1&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/users/testuser/info/key1&quot;</span>
   <span class="tok-p">},</span>
   <span class="tok-p">{</span>
      <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;key2&quot;</span><span class="tok-p">,</span>
      <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/users/testuser/info/key2&quot;</span>
   <span class="tok-p">}</span>
<span class="tok-p">]</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 249. List a user&#8217;s info - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user was found and list of info (key and url) is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_a_users_info">15.14.9. Get a user&#8217;s info</h4>
<div class="listingblock">
<div class="content">
<pre>GET identity/users/{userId}/info/{key}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 250. Get a user&#8217;s info - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to get the info for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key of the user info to get.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Response Body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;key1&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Value 1&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/users/testuser/info/key1&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 251. Get a user&#8217;s info - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user was found and the user has info for the given key..</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user was not found or the user doesn&#8217;t have info for the given key. Status description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_update_a_users_info">15.14.10. Update a user&#8217;s info</h4>
<div class="listingblock">
<div class="content">
<pre>PUT identity/users/{userId}/info/{key}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 252. Update a user&#8217;s info - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to update the info for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key of the user info to update.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request Body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;The updated value&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Response Body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;key1&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;The updated value&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/users/testuser/info/key1&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 253. Update a user&#8217;s info - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user was found and the info has been updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the value was missing from the request body.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user was not found or the user doesn&#8217;t have info for the given key. Status description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_create_a_new_users_info_entry">15.14.11. Create a new user&#8217;s info entry</h4>
<div class="listingblock">
<div class="content">
<pre>POST identity/users/{userId}/info</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 254. Create a new user&#8217;s info entry - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to create the info for.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Request Body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;key1&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;The value&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Response Body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;key&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;key1&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;value&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;The value&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/users/testuser/info/key1&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 255. Create a new user&#8217;s info entry - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user was found and the info has been created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the key or value was missing from the request body. Status description contains additional information about the error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates there is already an info-entry with the given key for the user, update the resource instance (<code>PUT</code>).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_delete_a_users_info">15.14.12. Delete a user&#8217;s info</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE identity/users/{userId}/info/{key}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 256. Delete a user&#8217;s info - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to delete the info for.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key of the user info to delete.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 257. Delete a user&#8217;s info - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the user was found and the info for the given key has been deleted. Response body is left empty intentionally.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user was not found or the user doesn&#8217;t have info for the given key. Status description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_groups">15.15. Groups</h3>
<div class="sect3">
<h4 id="_get_a_single_group">15.15.1. Get a single group</h4>
<div class="listingblock">
<div class="content">
<pre>GET identity/groups/{groupId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 258. Get a single group - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the group to get.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;testgroup&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/groups/testgroup&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Test group&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Test type&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 259. Get a single group - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the group exists and is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested group does not exist.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_a_list_of_groups">15.15.2. Get a list of groups</h4>
<div class="listingblock">
<div class="content">
<pre>GET identity/groups</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 260. Get a list of groups - URL query parameters</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return group with the given id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return groups with the given name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return groups with the given type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return groups with a name like the given value. Use <code>%</code> as wildcard-character.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">member</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return groups which have a member with the given username.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">potentialStarter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only return groups which members are potential starters for a process-definition with the given id.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field to sort results on, should be one of <code>id</code>, <code>name</code> or <code>type</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:[</span>
     <span class="tok-p">{</span>
        <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;testgroup&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/groups/testgroup&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Test group&quot;</span><span class="tok-p">,</span>
        <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Test type&quot;</span>
     <span class="tok-p">}</span>
   <span class="tok-p">],</span>
   <span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span><span class="tok-mi">3</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;start&quot;</span><span class="tok-p">:</span><span class="tok-mi">0</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;sort&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;id&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;order&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;asc&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;size&quot;</span><span class="tok-p">:</span><span class="tok-mi">3</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 261. Get a list of groups - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested groups were returned.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_update_a_group">15.15.3. Update a group</h4>
<div class="listingblock">
<div class="content">
<pre>PUT identity/groups/{groupId}</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Test group&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Test type&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All request values are optional. For example, you can only include the <em>name</em> attribute in the request body JSON-object, only updating the name of the group, leaving all other fields unaffected. When an attribute is explicitly included and is set to null, the group-value will be updated to null.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 262. Update a group - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the group was updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested group was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested group was updated simultaneously.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong> see response for <code>identity/groups/{groupId}</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_a_group">15.15.4. Create a group</h4>
<div class="listingblock">
<div class="content">
<pre>POST identity/groups</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;testgroup&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Test group&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;Test type&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 263. Create a group - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the group was created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">400</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the id of the group was missing.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Success response body:</strong> see response for <code>identity/groups/{groupId}</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_delete_a_group">15.15.5. Delete a group</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE identity/groups/{groupId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 264. Delete a group - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the group to delete.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 265. Delete a group - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the group was found and  has been deleted. Response-body is intentionally empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested group was not found.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_get_members_in_a_group">15.15.6. Get members in a group</h4>
<div class="paragraph">
<p>There is no GET allowed on <code>identity/groups/members</code>. Use the <code>identity/users?memberOfGroup=sales</code> URL to get all users that are part of a particular group.</p>
</div>
</div>
<div class="sect3">
<h4 id="_add_a_member_to_a_group">15.15.7. Add a member to a group</h4>
<div class="listingblock">
<div class="content">
<pre>POST identity/groups/{groupId}/members</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 266. Add a member to a group - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the group to add a member to.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Body JSON:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;userId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;kermit&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 267. Add a member to a group - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the group was found and the member has been added.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the userId was not included in the request body.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested group was not found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">409</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested user is already a member of the group.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Response Body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;userId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;groupId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;sales&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/groups/sales/members/kermit&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_delete_a_member_from_a_group">15.15.8. Delete a member from a group</h4>
<div class="listingblock">
<div class="content">
<pre>DELETE identity/groups/{groupId}/members/{userId}</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 268. Delete a member from a group - URL parameters</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the group to remove a member from.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the user to remove.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 269. Delete a member from a group - Response codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the group was found and the member has been deleted. The response body is left empty intentionally.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">404</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the requested group was not found or that the user is not a member of the group. The status description contains additional information about the error.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Response Body:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-p">{</span>
   <span class="tok-nt">&quot;userId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;kermit&quot;</span><span class="tok-p">,</span>
   <span class="tok-nt">&quot;groupId&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;sales&quot;</span><span class="tok-p">,</span>
    <span class="tok-nt">&quot;url&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;http://localhost:8182/identity/groups/sales/members/kermit&quot;</span>
<span class="tok-p">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cdiintegration">16. 集成CDI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>flowable-cdi模块结合了Flowable的可配置性及CDI(上下文和依赖注入, Contexts and Dependency Injection, J2EE)的可扩展性。flowable-cdi最突出的特点是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>支持@BusinessProcessScoped bean（生命周期绑定至流程实例的CDI bean），</p>
</li>
<li>
<p>从流程中解析CDI bean（包括EJB）的自定义El解析器，</p>
</li>
<li>
<p>使用注解对流程实例进行声明式控制，</p>
</li>
<li>
<p>Flowable关联至CDI事件总线，</p>
</li>
<li>
<p>可以与Java EE，Java SE，以及Spring一起工作，</p>
</li>
<li>
<p>支持单元测试。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
	<span class="tok-nt">&lt;groupId&gt;</span>org.flowable<span class="tok-nt">&lt;/groupId&gt;</span>
	<span class="tok-nt">&lt;artifactId&gt;</span>flowable-cdi<span class="tok-nt">&lt;/artifactId&gt;</span>
	<span class="tok-nt">&lt;version&gt;</span>6.x<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_flowable_cdi">16.1. 安装flowable-cdi</h3>
<div class="paragraph">
<p>Flowable CDI可以安装在不同环境中。在这个章节我们主要介绍配置选项。</p>
</div>
<div class="sect3">
<h4 id="_looking_up_a_process_engine">16.1.1. 查找流程引擎</h4>
<div class="paragraph">
<p>CDI扩展需要访问流程引擎，在运行时会查找<code>org.flowable.cdi.spi.ProcessEngineLookup</code>接口的实现。CDI模块提供了默认的名为<code>org.flowable.cdi.impl.LocalProcessEngineLookup</code>的实现，使用<code>ProcessEngines</code>-Utility类查找流程引擎，默认配置下用 <code>ProcessEngines#NAME_DEFAULT</code> 查找流程引擎。如果需要使用自定义的名字，需要扩展这个类。请注意：需要将<code>flowable.cfg.xml</code>配置文件放在classpath中。</p>
</div>
<div class="paragraph">
<p>Flowable cdi使用java.util.ServiceLoader SPI解析<code>org.flowable.cdi.spi.ProcessEngineLookup</code>实例。为了提供接口的自定义实现，需要在部署中添加名为<code>META-INF/services/org.flowable.cdi.spi.ProcessEngineLookup</code>的纯文本文件，并在其中设置实现的全限定类名。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果不提供自定义的<code>org.flowable.cdi.spi.ProcessEngineLookup</code>实现，则Flowable会使用默认的<code>LocalProcessEngineLookup</code>实现。在这种情况下，只需要在classpath中提供flowable.cfg.xml（参见下一章节）即可。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_process_engine">16.1.2. 配置流程引擎</h4>
<div class="paragraph">
<p>配置方式取决于所选用的流程引擎查找策略（上一章节）。这章介绍与LocalProcessEngineLookup一起使用的可用配置选项，并需要在classpath中提供一个Spring flowable.cfg.xml文件。</p>
</div>
<div class="paragraph">
<p>根据底层事务管理策略的不同，Flowable提供了不同的ProcessEngineConfiguration实现。flowable-cdi模块不关注事务，也就意味着可以使用任何事务管理策略（甚至是Spring抽象事务）。按照约定，CDI模块提供两个自定义的ProcessEngineConfiguration实现：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.flowable.cdi.CdiJtaProcessEngineConfiguration</code>: Flowable JtaProcessEngineConfiguration的子类，可用于Flowable使用JTA管理事务的情况</p>
</li>
<li>
<p><code>org.flowable.cdi.CdiStandaloneProcessEngineConfiguration</code>: StandaloneProcessEngineConfiguration的子类，可用于Flowable使用简单JDBC事务的情况。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>下面是一个JBoss 7的flowable.cfg.xml文件示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</div></td><td class="code"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-nt">&lt;beans</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans&quot;</span>
	<span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
	<span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="tok-nt">&gt;</span>

	<span class="tok-c">&lt;!-- 查找JTA事务管理器 --&gt;</span>
	<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.springframework.jndi.JndiObjectFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jndiName&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;java:jboss/TransactionManager&quot;</span><span class="tok-nt">&gt;&lt;/property&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resourceRef&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;/bean&gt;</span>

	<span class="tok-c">&lt;!-- 流程定义配置 --&gt;</span>
	<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span>
		<span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cdi.CdiJtaProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-c">&lt;!-- 查找默认的Jboss数据源 --&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dataSourceJndiName&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;java:jboss/datasources/ExampleDS&quot;</span> <span class="tok-nt">/&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseType&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;h2&quot;</span> <span class="tok-nt">/&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-nt">/&gt;</span>
		<span class="tok-c">&lt;!-- 使用外部管理事务 --&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;transactionsExternallyManaged&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;/bean&gt;</span>
<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这是Glassfish 3.1.1中的配置（假设已正确配置了名为jdbc/flowable的数据源）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</div></td><td class="code"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-nt">&lt;beans</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans&quot;</span>
	<span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
	<span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="tok-nt">&gt;</span>

	<span class="tok-c">&lt;!-- 查找JTA事务管理器 --&gt;</span>
	<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.springframework.jndi.JndiObjectFactoryBean&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jndiName&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;java:appserver/TransactionManager&quot;</span><span class="tok-nt">&gt;&lt;/property&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;resourceRef&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;/bean&gt;</span>

	<span class="tok-c">&lt;!-- 流程定义配置 --&gt;</span>
	<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span>
		<span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cdi.CdiJtaProcessEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dataSourceJndiName&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc/flowable&quot;</span> <span class="tok-nt">/&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;transactionManager&quot;</span> <span class="tok-nt">/&gt;</span>
		<span class="tok-c">&lt;!-- 使用外部管理事务 --&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;transactionsExternallyManaged&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
		<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;/bean&gt;</span>
<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意上面的配置需要"spring-context"模块：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
	<span class="tok-nt">&lt;groupId&gt;</span>org.springframework<span class="tok-nt">&lt;/groupId&gt;</span>
	<span class="tok-nt">&lt;artifactId&gt;</span>spring-context<span class="tok-nt">&lt;/artifactId&gt;</span>
	<span class="tok-nt">&lt;version&gt;</span>4.2.5.RELEASE<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Java SE环境中的配置与<a href="#configuration">创建流程引擎</a>章节中的示例一样，只是用"CdiStandaloneProcessEngineConfiguration"代替"StandaloneProcessEngineConfiguration"。</p>
</div>
</div>
<div class="sect3">
<h4 id="_deploying_processes">16.1.3. 部署流程</h4>
<div class="paragraph">
<p>可以使用标准的Flowable API（<code>RepositoryService</code>）部署流程。另外，flowable-cdi也提供了自动部署流程的功能，部署classpath中的<code>processes.xml</code>文件提供的流程列表。这是一个processes.xml文件的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>
<span class="tok-c">&lt;!-- 需要部署的流程列表 --&gt;</span>
<span class="tok-nt">&lt;processes&gt;</span>
	<span class="tok-nt">&lt;process</span> <span class="tok-na">resource=</span><span class="tok-s">&quot;diagrams/myProcess.bpmn20.xml&quot;</span> <span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;process</span> <span class="tok-na">resource=</span><span class="tok-s">&quot;diagrams/myOtherProcess.bpmn20.xml&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/processes&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_contextual_process_execution_with_cdi">16.2. 使用CDI的基于上下文的流程执行</h3>
<div class="paragraph">
<p>本章节将介绍Flowable CDI扩展使用的基于上下文的流程执行模型（contextual process execution model）。BPMN业务流程通常是一个长期运行的交互动作，包含用户与系统的任务。在运行时，流程分割为独立工作单元的集合，由用户与/或应用逻辑操作。在flowable-cdi中，流程实例可以关联至一个CDI作用域，代表了一个工作单元。在工作单元很复杂的时候特别有用，比如用户任务由多个不同表单的复杂顺序组成，并需要在交互过程中保持"非流程作用域（non-process-scoped）"状态的场景。</p>
</div>
<div class="sect3">
<h4 id="_associating_a_conversation_with_a_process_instance">16.2.1. 将一个会话关联至一个流程实例</h4>
<div class="paragraph">
<p>解析@BusinessProcessScoped bean或注入流程变量，都依赖活动的CDI作用域与流程实例的关联。flowable-cdi提供了<code>org.flowable.cdi.BusinessProcess</code> bean用于控制该关联，并提供：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>startProcessBy(&#8230;&#8203;)</em>方法，镜像了Flowable <code>RuntimeService</code>服务暴露的对应方法，用于启动并关联一个业务流程，</p>
</li>
<li>
<p><code>resumeProcessById(String processInstanceId)</code>，用于将给定id关联至流程实例，</p>
</li>
<li>
<p><code>resumeTaskById(String taskId)</code>，用于将给定id关联至任务（以及扩展至相关的流程实例）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>当完成了一个工作单元（例如一个用户任务）时，可以调用<code>completeTask()</code>方法，解除流程实例与会话/请求的关联。这将通知Flowable完成当前任务，并继续运行流程实例。</p>
</div>
<div class="paragraph">
<p>请注意<code>BusinessProcess</code> bean是一个<code>@Named</code> bean，意味着可以使用表达式（比如在JSF页面中）调用它。下面的JSF2代码片段启动了一个新的会话，并将其关联至一个用户任务实例，其id作为请求参数传递（例如<code>pageName.jsf?taskId=XX</code>）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;f:metadata&gt;</span>
<span class="tok-nt">&lt;f:viewParam</span> <span class="tok-na">name=</span><span class="tok-s">&quot;taskId&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;f:event</span> <span class="tok-na">type=</span><span class="tok-s">&quot;preRenderView&quot;</span> <span class="tok-na">listener=</span><span class="tok-s">&quot;#{businessProcess.startTask(taskId, true)}&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/f:metadata&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_declaratively_controlling_the_process">16.2.2. 声明式控制流程</h4>
<div class="paragraph">
<p>Flowable可以使用注解，声明式地启动流程实例以及完成任务。<code>@org.flowable.cdi.annotation.StartProcess</code>注解可以通过"key"或"name"启动一个流程实例。请注意流程实例在注解的方法返回<em>之后</em>启动。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nd">@StartProcess</span><span class="tok-o">(</span><span class="tok-s">&quot;authorizeBusinessTripRequest&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">submitRequest</span><span class="tok-o">(</span><span class="tok-n">BusinessTripRequest</span> <span class="tok-n">request</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-c1">// 进行一些操作</span>
	<span class="tok-k">return</span> <span class="tok-s">&quot;success&quot;</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>按照Flowable的配置，被注解的方法代码以及流程实例的启动将处于同一个事务中。<code>@org.flowable.cdi.annotation.CompleteTask</code>的使用方式相同：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nd">@CompleteTask</span><span class="tok-o">(</span><span class="tok-n">endConversation</span><span class="tok-o">=</span><span class="tok-kc">false</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">authorizeBusinessTrip</span><span class="tok-o">()</span> <span class="tok-o">{</span>
	<span class="tok-c1">// 进行一些操作</span>
	<span class="tok-k">return</span> <span class="tok-s">&quot;success&quot;</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@CompleteTask</code>注解可以结束当前会话。默认行为是在调用Flowable返回后结束回话。但可以像上面的例子一样，禁用结束会话。</p>
</div>
</div>
<div class="sect3">
<h4 id="_referencing_beans_from_the_process">16.2.3. 从流程中引用Bean</h4>
<div class="paragraph">
<p>flowable-cdi使用自定义解析器，将CDI bean暴露给Flowable El。因此可以像这样在流程中引用bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-nt">&lt;userTask</span> <span class="tok-na">id=</span><span class="tok-s">&quot;authorizeBusinessTrip&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Authorize Business Trip&quot;</span>
			<span class="tok-na">flowable:assignee=</span><span class="tok-s">&quot;#{authorizingManager.account.username}&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>其中"authorizingManager"可以是生产者方法提供的bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nd">@Inject</span>	<span class="tok-nd">@ProcessVariable</span> <span class="tok-n">Object</span> <span class="tok-n">businessTripRequesterUsername</span><span class="tok-o">;</span>

<span class="tok-nd">@Produces</span>
<span class="tok-nd">@Named</span>
<span class="tok-kd">public</span> <span class="tok-n">Employee</span> <span class="tok-nf">authorizingManager</span><span class="tok-o">()</span> <span class="tok-o">{</span>
	<span class="tok-n">TypedQuery</span><span class="tok-o">&lt;</span><span class="tok-n">Employee</span><span class="tok-o">&gt;</span> <span class="tok-n">query</span> <span class="tok-o">=</span> <span class="tok-n">entityManager</span><span class="tok-o">.</span><span class="tok-na">createQuery</span><span class="tok-o">(</span><span class="tok-s">&quot;SELECT e FROM Employee e WHERE e.account.username=&#39;&quot;</span>
		<span class="tok-o">+</span> <span class="tok-n">businessTripRequesterUsername</span> <span class="tok-o">+</span> <span class="tok-s">&quot;&#39;&quot;</span><span class="tok-o">,</span> <span class="tok-n">Employee</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
	<span class="tok-n">Employee</span> <span class="tok-n">employee</span> <span class="tok-o">=</span> <span class="tok-n">query</span><span class="tok-o">.</span><span class="tok-na">getSingleResult</span><span class="tok-o">();</span>
	<span class="tok-k">return</span> <span class="tok-n">employee</span><span class="tok-o">.</span><span class="tok-na">getManager</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用<code>flowable:expression="myEjb.method()"</code>扩展，在服务任务中调用一个EJB中的业务方法。请注意这需要在<code>MyEjb</code>类上使用<code>@Named</code>注解。</p>
</div>
</div>
<div class="sect3">
<h4 id="_working_with_businessprocessscoped_beans">16.2.4. 使用@BusinessProcessScoped bean</h4>
<div class="paragraph">
<p>可以使用flowable-cdi将一个bean的生命周期绑定在一个流程实例上。为此提供名为BusinessProcessContext的自定义的上下文实现。BusinessProcessScoped bean实例将作为流程变量存储在当前流程实例中。BusinessProcessScoped bean需要是可持久化（PassivationCapable，例如Serializable）的。下面是一个流程作用域bean的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-nd">@Named</span>
<span class="tok-nd">@BusinessProcessScoped</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BusinessTripRequest</span> <span class="tok-kd">implements</span> <span class="tok-n">Serializable</span> <span class="tok-o">{</span>
	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">long</span> <span class="tok-n">serialVersionUID</span> <span class="tok-o">=</span> <span class="tok-mi">1L</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">startDate</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">endDate</span><span class="tok-o">;</span>
	<span class="tok-c1">// ...</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>有时也需要在没有关联至流程实例的情况下（例如在流程启动前）使用流程作用域bean。如果当前没有激活的流程实例，则BusinessProcessScoped bean的实例将临时存储在本地作用域（也就是会话或请求中，取决于上下文）。如果该作用域之后关联至一个业务流程实例，则会将bean实例刷入该流程实例。</p>
</div>
</div>
<div class="sect3">
<h4 id="_injecting_process_variables">16.2.5. 注入流程变量</h4>
<div class="paragraph">
<p>flowable-cdi支持以下方式注入流程变量</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用<code>@Inject [additional qualifiers] Type fieldName</code>类型安全地注入<code>@BusinessProcessScoped</code> bean</p>
</li>
<li>
<p>使用<code>@ProcessVariable(name?)</code>限定名不安全地注入其它流程变量：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-nd">@Inject</span> <span class="tok-nd">@ProcessVariable</span> <span class="tok-n">Object</span> <span class="tok-n">accountNumber</span><span class="tok-o">;</span>
<span class="tok-nd">@Inject</span> <span class="tok-nd">@ProcessVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;accountNumber&quot;</span><span class="tok-o">)</span> <span class="tok-n">Object</span> <span class="tok-n">account</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>要在EL中引用流程变量，有类似的选择：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>可以直接引用<code>@Named @BusinessProcessScoped</code> bean，</p>
</li>
<li>
<p>可以通过<code>ProcessVariables</code> bean引用其它流程变量：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>#{processVariables['accountNumber']}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_receiving_process_events">16.2.6. 接收流程事件</h4>
<div class="paragraph">
<p>Flowable可以关联至CDI事件总线。这样就可以使用标准CDI事件机制获取流程事件。要为Flowable启用CDI事件支持，需要在配置中启用相应的处理监听器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;postBpmnParseHandlers&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;list&gt;</span>
		<span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cdi.impl.event.CdiEventSupportBpmnParseHandler&quot;</span> <span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;/list&gt;</span>
<span class="tok-nt">&lt;/property&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样Flowable就被配置为使用CDI事件总线发布事件。下面介绍如何在CDI bean中接收流程事件。事件通知是类型安全的。流程事件的类型是<code>org.flowable.cdi.BusinessProcessEvent</code>。
下面是一个简单的事件观察者方法的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onProcessEvent</span><span class="tok-o">(</span><span class="tok-nd">@Observes</span> <span class="tok-n">BusinessProcessEvent</span> <span class="tok-n">businessProcessEvent</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-c1">// 处理事件</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>所有事件都会通知观察者。如果需要限制观察者接收的事件，可以添加限定注解：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@BusinessProcess</code>: 限制事件为特定的流程定义。例如：<code>@Observes @BusinessProcess("billingProcess") BusinessProcessEvent evt</code></p>
</li>
<li>
<p><code>@StartActivity</code>: 使用特定的活动限制事件。例如：<code>@Observes @StartActivity("shipGoods") BusinessProcessEvent evt</code>将在进入id为"shipGoods"的活动时调用。</p>
</li>
<li>
<p><code>@EndActivity</code>: 使用特定的活动限制事件。例如：<code>@Observes @EndActivity("shipGoods") BusinessProcessEvent evt</code>将在离开id为"shipGoods"的活动时调用。</p>
</li>
<li>
<p><code>@TakeTransition</code>: 使用特定的路径限制事件。</p>
</li>
<li>
<p><code>@CreateTask</code>: 使用特定任务的创建限制事件。</p>
</li>
<li>
<p><code>@DeleteTask</code>: 使用特定任务的删除限制事件。</p>
</li>
<li>
<p><code>@AssignTask</code>: 使用特定任务的指派限制事件。</p>
</li>
<li>
<p><code>@CompleteTask</code>: 使用特定任务的完成限制事件。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>上面的限定名可以自由组合。例如，要接收离开"shipmentProcess"中的"shipGoods"活动时生成的所有事件，可以撰写下面的观察者方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">beforeShippingGoods</span><span class="tok-o">(</span><span class="tok-nd">@Observes</span> <span class="tok-nd">@BusinessProcess</span><span class="tok-o">(</span><span class="tok-s">&quot;shippingProcess&quot;</span><span class="tok-o">)</span> <span class="tok-nd">@EndActivity</span><span class="tok-o">(</span><span class="tok-s">&quot;shipGoods&quot;</span><span class="tok-o">)</span> <span class="tok-n">BusinessProcessEvent</span> <span class="tok-n">evt</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-c1">// 处理事件</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在默认配置下，事件监听器将在上下文相同的事务中同步调用。CDI事务性观察者（CDI transactional observer，只能与JavaEE/EJB一起使用）可以在将事件交给观察者方法时进行控制。使用事务性观察者，可以保证比如只在触发事件的事务成功时才通知观察者：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onShipmentSuceeded</span><span class="tok-o">(</span><span class="tok-nd">@Observes</span><span class="tok-o">(</span><span class="tok-n">during</span><span class="tok-o">=</span><span class="tok-n">TransactionPhase</span><span class="tok-o">.</span><span class="tok-na">AFTER_SUCCESS</span><span class="tok-o">)</span> <span class="tok-nd">@BusinessProcess</span><span class="tok-o">(</span><span class="tok-s">&quot;shippingProcess&quot;</span><span class="tok-o">)</span> <span class="tok-nd">@EndActivity</span><span class="tok-o">(</span><span class="tok-s">&quot;shipGoods&quot;</span><span class="tok-o">)</span> <span class="tok-n">BusinessProcessEvent</span> <span class="tok-n">evt</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-c1">// 给客户发送邮件。</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_additional_features">16.2.7. 其他功能</h4>
<div class="ulist">
<ul>
<li>
<p>可以注入流程引擎与服务：<code>@Inject ProcessEngine, RepositoryService, TaskService</code>, &#8230;&#8203;</p>
</li>
<li>
<p>可以注入当前的流程实例与任务：<code>@Inject ProcessInstance, Task</code>,</p>
</li>
<li>
<p>可以注入当前的businessKey：<code>@Inject @BusinessKey String businessKey</code>,</p>
</li>
<li>
<p>可以注入当前的流程实例id：<code>@Inject @ProcessInstanceId String pid</code>+</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_known_limitations">16.3. 已知限制</h3>
<div class="paragraph">
<p>尽管flowable-cdi遵循SPI，并设计为“可插拔扩展”，但只在Weld下进行了测试。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chapter_ldap">17. 集成LDAP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>很多公司使用LDAP（Lightweight Directory Access Protocol，轻量级目录访问协议）系统管理用户与组。Flowable提供了一个开箱即用的解决方案，简单配置即可将Flowable与LDAP系统连接起来。</p>
</div>
<div class="paragraph">
<p>早期版本就可以集成LDAP。之后大幅简化了配置，但“老”的LDAP配置方式仍然可用。实际上，简化配置只是对“老”框架进行的包装。</p>
</div>
<div class="sect2">
<h3 id="ldap_usage">17.1. 使用</h3>
<div class="paragraph">
<p>在pom.xml中添加下列依赖，为项目中添加LDAP集成代码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.flowable<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>flowable-ldap-configurator<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>latest.version<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ldap_usecases">17.2. 用途</h3>
<div class="paragraph">
<p>目前LDAP集成有两大作用：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>通过IdentityService进行认证。用于由IdentityService处理所有认证业务的场景。</p>
</li>
<li>
<p>获取一个组中的用户。比如，用于查询某用户作为候选组的任务。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="ldap_configuration">17.3. 配置</h3>
<div class="paragraph">
<p>在流程引擎配置的<code>idmProcessEngineConfigurator</code>小节添加<code>org.flowable.ldap.LDAPConfigurator</code>的实现，进行Flowable与LDAP系统的集成配置。这是个高度可扩展的类：如果默认实现不能满足使用场景，可以轻松地覆盖方法，许多依赖的bean也是可插拔的。</p>
</div>
<div class="paragraph">
<p>这是一个示例配置（在代码方式创建引擎时完全类似）。目前不需要太关注这些参数，我们会在下一章节详细介绍。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;...SomeProcessEngineConfigurationClass&quot;</span><span class="tok-nt">&gt;</span>
    ...
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;idmProcessEngineConfigurator&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.ldap.LDAPConfigurator&quot;</span><span class="tok-nt">&gt;</span>

        <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;ldapConfiguration&quot;</span><span class="tok-nt">&gt;</span>
		  <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.ldap.LDAPConfiguration&quot;</span><span class="tok-nt">&gt;</span>

            <span class="tok-c">&lt;!-- 服务器连接参数 --&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;server&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;ldap://localhost&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;port&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;33389&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;user&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;uid=admin, ou=users, o=flowable&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;pass&quot;</span> <span class="tok-nt">/&gt;</span>

            <span class="tok-c">&lt;!-- 查询参数 --&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;baseDn&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;o=flowable&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;queryUserByUserId&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;(&amp;(objectClass=inetOrgPerson)(uid={0}))&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;queryUserByFullNameLike&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;(&amp;(objectClass=inetOrgPerson)(|({0}=*{1}*)({2}=*{3}*)))&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;queryAllUsers&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;(objectClass=inetOrgPerson)&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;queryGroupsForUser&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;(&amp;(objectClass=groupOfUniqueNames)(uniqueMember={0}))&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;queryAllGroups&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;(objectClass=groupOfUniqueNames)&quot;</span> <span class="tok-nt">/&gt;</span>

            <span class="tok-c">&lt;!-- 属性配置 --&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;userIdAttribute&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;uid&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;userFirstNameAttribute&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;cn&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;userLastNameAttribute&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sn&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;userEmailAttribute&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;mail&quot;</span> <span class="tok-nt">/&gt;</span>

            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;groupIdAttribute&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;cn&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;groupNameAttribute&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;cn&quot;</span> <span class="tok-nt">/&gt;</span>

          <span class="tok-nt">&lt;/bean&gt;</span>
        <span class="tok-nt">&lt;/property&gt;</span>
      <span class="tok-nt">&lt;/bean&gt;</span>
    <span class="tok-nt">&lt;/property&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ldap_properties">17.4. 参数</h3>
<div class="paragraph">
<p><code>org.flowable.ldap.LDAPConfiguration</code>使用下列参数：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 270. LDAP配置参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP系统的服务器。例如<em>ldap://localhost:33389</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP系统的端口</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP系统的用户id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP系统的密码</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initialContextFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接LDAP所用的InitialContextFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.sun.jndi.ldap.LdapCtxFactory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">securityAuthentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接LDAP系统所用的<em>java.naming.security.authentication</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">simple</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">customConnectionParameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于设置没有配置setter的LDAP连接参数。例如 <a href="http://docs.oracle.com/javase/tutorial/jndi/ldap/jndi.html" class="bare">http://docs.oracle.com/javase/tutorial/jndi/ldap/jndi.html</a> 中的自定义参数，用于配置连接池、安全等。连接LDAP系统时会使用这些参数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map&lt;String, String&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">baseDn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询用户及组的基础<em>标识名</em>（<em>distinguished name, DN</em>）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userBaseDn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询用户的基础<em>标识名</em>。不设置则使用baseDn（见上）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupBaseDn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询组的基础<em>标识名</em>。不设置则使用baseDn（见上）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">searchTimeLimit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询LDAP的超时时间，以毫秒计</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一小时</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">queryUserByUserId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通过ID查询用户所用的语句。
 比如：<code>(&amp;(objectClass=inetOrgPerson)(uid={0}))</code>
 返回LDAP中所有<em>inetOrgPerson</em>类、<em>uid</em>属性值匹配的对象。
 上例中，使用{@link java.text.MessageFormat}即<em>{0}</em>注入用户ID。
 如果不能通过简单的语句进行查询，可以改用 <code>org.flowable.ldap.LDAPQueryBuilder</code> ，进行定制化查询。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">queryUserByFullNameLike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通过全名查询用户所用的语句。
 比如：<code>(&amp;(objectClass=inetOrgPerson)(|({0}=**{1}**)({2}={3})))</code>
 返回LDAP中所有<em>inetOrgPerson</em>类、姓或名匹配的对象。
 注入到表达式中的值：{0} : 名字属性名 {1} : 查询文本 {2} : 姓属性名 {3} : 查询文本
 如果不能通过简单的语句进行查询，可以改用 <code>org.flowable.ldap.LDAPQueryBuilder</code>，进行定制化查询。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">queryAllUsers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不使用过滤条件，查询所有用户所用的语句。
 比如：<code>(objectClass=inetOrgPerson)</code>
 返回LDAP中所有<em>groupOfUniqueNames</em>类的对象。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">queryGroupsForUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询给定用户所在组所用的语句。
 比如：<code>(&amp;(objectClass=groupOfUniqueNames)(uniqueMember={0}))</code>
 返回LDAP中所有<em>groupOfUniqueNames</em>类、DN为<em>uniqueMember</em>的对象。
 上例中，使用{@link java.text.MessageFormat}即<em>{0}</em>注入用户ID。
 如果不能通过简单的语句进行查询，可以改用 <code>org.flowable.ldap.LDAPQueryBuilder</code> ，进行定制化查询。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">queryAllGroups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询所有组所用的语句。
 比如：<code>(objectClass=groupOfUniqueNames)</code>
 返回LDAP中所有<em>groupOfUniqueNames</em>的对象。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userIdAttribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户ID的LDAP属性名。用于查询并将LDAP用户对象映射至Flowable用户对象。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userFirstNameAttribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户名字的LDAP属性名。用于查询并将LDAP用户对象映射至Flowabl用户对象。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userLastNameAttribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户姓的LDAP属性名。用于查询并将LDAP用户对象映射至Flowable用户对象。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupIdAttribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户组ID的LDAP属性名。用于查询并将LDAP用户组对象映射至Flowable用户组对象。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupNameAttribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户组名称的LDAP属性名。用于查询并将LDAP用户组对象映射至Flowable用户组对象。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupTypeAttribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代表用户组类型的LDAP属性名。用于查询并将LDAP用户组对象映射至Flowable用户组对象</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>下面的参数用于修改默认行为及缓存组：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 271. 高级参数</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldapUserManagerFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果默认实现不符合要求，可以设置一个自定义的LDAPUserManagerFactory实现。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAPUserManagerFactory的实例</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldapGroupManagerFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果默认实现不符合要求，可以设置一个自定义的LDAPGroupManagerFactory实现。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAPGroupManagerFactory的实例</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldapMemberShipManagerFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果默认实现不符合要求，可以设置一个自定义的LDAPMembershipManagerFactory实现。请注意很少出现这种情况，一般都使用LDAP系统管理成员信息。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAPMembershipManagerFactory的实例</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldapQueryBuilder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果默认实现不符合要求，可以设置一个自定义的查询构建器。使用LDAPUserManager或LDAPGroupManage进行LDAP查询时，会使用LDAPQueryBuilder的实例。默认会使用在本实例中设置的参数，例如queryGroupsForUser与queryUserById</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.flowable.ldap.LDAPQueryBuilder的实例</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupCacheSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设置用户组缓存的尺寸。
这是用户所在组的LRU缓存。避免每次需要查询用户所在组时都访问LDAP系统。
若值小于0，则不会启用缓存。默认值为-1，所以不会进行缓存。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupCacheExpirationTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设置用户组缓存的过期时间，以毫秒计。如果设置了用户组缓存，在查询了用户所在组后，会缓存用户组关系，持续本参数设置的时间。也就是说，如果在00:00进行了用户所在组查询，过期时间为30分钟，则在00:00 - 00:30间会使用该惠存，00:30之后进行的查询不会使用该缓存，而是会重新查询LDAP系统。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个小时</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>使用活动目录（Active Directory）时请注意：用户报告在使用活动目录时，需要将<em>InitialDirContext</em>设置为Context.REFERRAL。可以通过customConnectionParameters map设置这个参数。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced">18. 高级</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本章介绍的Flowable的高级使用技巧，超出了一般的执行BPMN 2.0流程的范畴。因此，要理解这里讨论的主题，需要对Flowable足够熟练与精通。</p>
</div>
<div class="sect2">
<h3 id="_async_executor">18.1. 异步执行器</h3>
<div class="paragraph">
<p>Flowable V5版本中，在之前的作业执行器(job executor)之外，还提供了异步执行器(async executor)。异步执行器已被许多Flowable的用户及我们自己的跑分证明，性能比老的作业执行器好。</p>
</div>
<div class="paragraph">
<p>从Flowable V6起，将只提供异步执行器。在V6中，对异步执行器进行了完全的重构，以提升性能及易用性。当然仍然与已有的API兼容。</p>
</div>
<div class="sect3">
<h4 id="async_executor_design">18.1.1. 异步执行器的设计</h4>
<div class="paragraph">
<p>Flowable有两种作业类型：定时器（例如边界事件或用户任务中的定时器）以及异步操作（带有<em>flowable:async="true"</em>属性的服务任务）。</p>
</div>
<div class="paragraph">
<p><strong>定时器</strong>很容易理解：保存在ACT_RU_TIMER_JOB表中，并带有给定的到期日期。异步执行器中有一个线程，周期性地检查是否有需要触发的定时器（也就是说，到期日期在当前时间“之前”）。当需要触发定时器时，从JOB表中移除该定时器，并创建一个异步作业(async job)。</p>
</div>
<div class="paragraph">
<p><strong>异步作业</strong>在执行流程实例（即调用API）时插入数据库。如果当前Flowable引擎启用了异步执行器，则该异步作业将被<em>锁定(locked)</em>。即在ACT_RU_JOB表中插入一个作业条目，并设置其<em>lock owner(锁持有人)</em>与<em>lock expiration time(锁到期时间)</em>。在API调用成功后触发的事务监听器(transaction commit listener)，将会触发同一引擎中的异步执行器，让其执行该作业（因此可以保证数据库中已经保存了数据）。为此，异步执行器使用（可配置的）线程池，从其中取出线程用于执行作业，并使流程可以异步进行。如果Flowable引擎未启用异步执行器，则异步作业仍会插入ACT_RU_JOB表，但不会被锁定。</p>
</div>
<div class="paragraph">
<p>与检查定时器的线程类似，异步执行器中也有一个用于“获取”新的异步作业的线程。这里的异步作业，指的是表中存储但未被锁定的作业。这个线程会将这些作业锁定给当前Flowable引擎，并发送至异步执行器。</p>
</div>
<div class="paragraph">
<p>用于执行作业的线程池从一个内存队列中获取作业。当队列满了时（可配置），作业将会被解锁，并重新存回数据库。这样，其他的异步执行器就可以重新操作它们。</p>
</div>
<div class="paragraph">
<p>如果在执行作业期间发生了异常，这个异步作业将会转化为一个定时器作业，并带有一个到期日期。之后，它将会像普通定时器作业一样被获取，并重新变回异步作业，以实现重试。当一个作业已经重试了（可配置）几次，仍然失败，则作业被视为“死亡(dead)”，并被移至ACT_RU_DEADLETTER_JOB表。“死信(deadletter)”的概念在各种其他系统中也广泛使用。管理员需要检查失败作业的异常信息，并进行相应操作。</p>
</div>
<div class="paragraph">
<p>流程定义与流程实例都可以被暂停。这些定义或实例所关联的暂停作业，将被移至ACT_RU_SUSPENDED_JOB表，以确保用于获取作业的查询语句中的where条件尽量少。</p>
</div>
<div class="paragraph">
<p>综上所述：对于熟悉作业/异步执行器的旧实现的人来说，主要目标是让查询尽可能简单。在过去（V6以前），所有作业类型/状态使用一张表。为了满足所有使用场景，导致“where”条件十分庞大。现在已经解决了这个问题，我们的跑分也证明这个新设计带来了更好的性能，也更有弹性。</p>
</div>
</div>
<div class="sect3">
<h4 id="_async_executor_configuration">18.1.2. 配置异步执行器</h4>
<div class="paragraph">
<p>异步执行器是一个高度可配置的组件。建议先查看异步执行器的默认配置，检查它们是否符合你的流程的要求。</p>
</div>
<div class="paragraph">
<p>另外，也可以扩展默认的实现，或者替换为你自己实现的<em>org.flowable.engine.impl.asyncexecutor.AsyncExecutor</em>接口。</p>
</div>
<div class="paragraph">
<p>可以在流程引擎配置中使用setter设置下列参数：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 272. 异步执行器配置选项</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorThreadPoolQueueSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在获取待执行的作业之后，线程池中某个线程实际执行作业之前，放置这些作业的队列的长度。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorCorePoolSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于执行作业的线程池中，最小的活动(kept alive)线程数量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorMaxPoolSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于执行作业的线程池中，创建线程的最大数量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorThreadKeepAliveTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在销毁执行作业所用的线程前，需要保持活动的时间（以毫秒计）。设置为&gt;0的值会消耗资源，但在有大量执行作业的时候，可以避免总是创建新线程。如果设置为0，则线程会在执行完作业后立刻被销毁。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorNumberOfRetries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">作业被移入“死信”表之前的最大重试次数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorMaxTimerJobsPerAcquisition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在一次获取定时器作业的查询中，获取作业的数量。默认值为1，因为这样可以降低潜在的乐观锁异常情况。较大的数值性能较好，但在不同的引擎间发生乐观锁异常的几率也会变大。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorMaxAsyncJobsDuePerAcquisition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在一次获取异步作业的查询中，获取作业的数量。默认值为1，因为这样可以降低潜在的乐观锁异常情况。较大的数值性能较好，但在不同的引擎间发生乐观锁异常的几率也会变大。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorDefaultTimerJobAcquireWaitTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">获取定时器作业的线程在两次获取作业的查询之间等待的时间（以毫秒记）。只在上一次查询未找到新的定时器作业，或者获取的作业数量少于<em>asyncExecutorMaxTimerJobsPerAcquisition</em>中设置的值时才会等待。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorDefaultAsyncJobAcquireWaitTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">获取异步作业的线程在两次获取作业的查询之间等待的时间（以毫秒记）。只在上一次查询未找到新的异步作业，或者获取的作业数量少于<em>asyncExecutorMaxAsyncJobsDuePerAcquisition</em>中设置的值时才会等待。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorDefaultQueueSizeFullWaitTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在内部作业队列已满之后，执行下一次查询之前，获取作业（包括定时器作业及异步作业）的线程将等待的时间（以毫秒记）。默认值为0（为保证向后兼容性）。设置为较大的值，可以让异步执行器有机会多执行掉一些队列作业，腾出队列空间。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorTimerLockTimeInMillis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5分钟</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">异步执行器获取定时器作业之后锁定的时间（以毫秒记）。在这段时间内，其它异步执行器不会尝试获取或锁定这个作业。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorAsyncJobLockTimeInMillis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5分钟</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">异步执行器获取异步作业之后锁定的时间（以毫秒记）。在这段时间内，其它异步执行器不会尝试获取或锁定这个作业。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorSecondsToWaitOnShutdown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当请求关闭执行器（或流程引擎）后，等待执行作业的线程池安全关闭的时间（以秒记）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorResetExpiredJobsInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60秒</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在两次<em>超时作业（expired job）</em>检查之间等待的时间（以毫秒记）。超时作业指的是已经锁定（某个执行器已经为其写入了锁持有人以及超时时间），但一直没有完成的作业。在检查中，会解锁超时作业，即移除其锁持有人以及超时时间。这样其他执行器就可以重新获取它。作业的锁超时时间在当前时间之前则视作超时。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asyncExecutorResetExpiredJobsPageSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">异步执行器的<em>超时重置（reset expired）</em>检查线程一次获取的作业数量。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_message_queue_based_async_executor">18.1.3. 基于消息队列的异步执行器</h4>
<div class="paragraph">
<p>阅读<a href="#async_executor_design">异步执行器的设计</a>章节之后，很明显架构的灵感来自消息队列。异步执行器设计思路保证了可以很轻松地用消息队列代替线程池的工作，处理异步作业。</p>
</div>
<div class="paragraph">
<p>跑分显示，相比基于线程池的异步执行器，消息队列性能出众，吞吐量大。但需要额外的中间件，当然也就增加了安装配置、维护及监控的复杂度。对于多数用户来说，基于线程池的异步执行器性能已经足够用了。但能够知道在性能要求增长之后，仍有改进方案，也是挺好的。</p>
</div>
<div class="paragraph">
<p>目前，唯一直接可用的是带有JMS的Spring。选择首先支持Spring的原因是，Spring提供了非常好的功能，解决了使用线程以及处理多个消息消费者造成的麻烦。但是其实集成也很简单，因此可以轻松改用任何其他消息队列实现或协议（Stomp、AMPQ等等）。我们欢迎用户反馈下一个应该支持什么消息队列。</p>
</div>
<div class="paragraph">
<p>使用消息队列后，当引擎创建新的异步作业时，会在消息队列中放入一条包含有作业标识的消息（处在一个事务提交监听器中，这样就可以确保该作业条目已经提交至数据库）。之后消息消费者可以获取作业标识，并获取及执行该作业。异步执行器不再创建线程池，而是会在另一个单独线程中插入及查询定时器。当定时器到时触发时，将会被移至异步作业表，同时向消息队列发送一条消息。消息队列也可能失败，所以<em>超时重置</em>线程会按照原逻辑处理。只不过不是<em>解锁</em>作业，而是重发消息。异步执行器不再轮询异步作业。</p>
</div>
<div class="paragraph">
<p>主要由两个类实现：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>org.flowable.engine.impl.asyncexecutor.JobManager</em>接口的实现，将消息发送至消息队列而不是线程池。</p>
</li>
<li>
<p><em>javax.jms.MessageListener</em>接口的实现。从消息队列中消费消息，并使用消息中的作业标识获取及执行该作业。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>首先添加<em>flowable-jms-spring-executor</em>依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.flowable<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>flowable-jms-spring-executor<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>${flowable.version}<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在流程引擎配置中进行如下设置启用基于消息队列的异步执行器：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>asyncExecutorActivate</em>为<em>true</em></p>
</li>
<li>
<p><em>asyncExecutorMessageQueueMode</em>为<em>true</em></p>
</li>
<li>
<p><em>org.flowable.spring.executor.jms.MessageBasedJobManager</em>注入为<em>JobManager</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>下面是一个基于Java配置的完整例子，使用<em>ActiveMQ</em>作为消息中间件。</p>
</div>
<div class="paragraph">
<p>请注意：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>需要为<em>MessageBasedJobManager</em>注入一个配置了正确的<em>connectionFactory</em>的<em>JMSTemplate</em>。</p>
</li>
<li>
<p>我们使用Spring的<em>MessageListenerContainer</em>，因为它大幅简化了线程与多消费者的使用。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74</div></td><td class="code"><span></span><span class="tok-nd">@Configuration</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SpringJmsConfig</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Bean</span>
  <span class="tok-kd">public</span> <span class="tok-n">DataSource</span> <span class="tok-nf">dataSource</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-c1">// 略</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Bean</span><span class="tok-o">(</span><span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-s">&quot;transactionManager&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">public</span> <span class="tok-n">PlatformTransactionManager</span> <span class="tok-nf">transactionManager</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">DataSourceTransactionManager</span> <span class="tok-n">transactionManager</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">DataSourceTransactionManager</span><span class="tok-o">();</span>
    <span class="tok-n">transactionManager</span><span class="tok-o">.</span><span class="tok-na">setDataSource</span><span class="tok-o">(</span><span class="tok-n">dataSource</span><span class="tok-o">());</span>
    <span class="tok-k">return</span> <span class="tok-n">transactionManager</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Bean</span>
  <span class="tok-kd">public</span> <span class="tok-n">SpringProcessEngineConfiguration</span> <span class="tok-nf">processEngineConfiguration</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">SpringProcessEngineConfiguration</span> <span class="tok-n">configuration</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">SpringProcessEngineConfiguration</span><span class="tok-o">();</span>
    <span class="tok-n">configuration</span><span class="tok-o">.</span><span class="tok-na">setDataSource</span><span class="tok-o">(</span><span class="tok-n">dataSource</span><span class="tok-o">());</span>
    <span class="tok-n">configuration</span><span class="tok-o">.</span><span class="tok-na">setTransactionManager</span><span class="tok-o">(</span><span class="tok-n">transactionManager</span><span class="tok-o">());</span>
    <span class="tok-n">configuration</span><span class="tok-o">.</span><span class="tok-na">setDatabaseSchemaUpdate</span><span class="tok-o">(</span><span class="tok-n">SpringProcessEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">DB_SCHEMA_UPDATE_TRUE</span><span class="tok-o">);</span>
    <span class="tok-n">configuration</span><span class="tok-o">.</span><span class="tok-na">setAsyncExecutorMessageQueueMode</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
    <span class="tok-n">configuration</span><span class="tok-o">.</span><span class="tok-na">setAsyncExecutorActivate</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
    <span class="tok-n">configuration</span><span class="tok-o">.</span><span class="tok-na">setJobManager</span><span class="tok-o">(</span><span class="tok-n">jobManager</span><span class="tok-o">());</span>
    <span class="tok-k">return</span> <span class="tok-n">configuration</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Bean</span>
  <span class="tok-kd">public</span> <span class="tok-n">ProcessEngine</span> <span class="tok-nf">processEngine</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">processEngineConfiguration</span><span class="tok-o">().</span><span class="tok-na">buildProcessEngine</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Bean</span>
  <span class="tok-kd">public</span> <span class="tok-n">MessageBasedJobManager</span> <span class="tok-nf">jobManager</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">MessageBasedJobManager</span> <span class="tok-n">jobManager</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">MessageBasedJobManager</span><span class="tok-o">();</span>
    <span class="tok-n">jobManager</span><span class="tok-o">.</span><span class="tok-na">setJmsTemplate</span><span class="tok-o">(</span><span class="tok-n">jmsTemplate</span><span class="tok-o">());</span>
    <span class="tok-k">return</span> <span class="tok-n">jobManager</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Bean</span>
  <span class="tok-kd">public</span> <span class="tok-n">ConnectionFactory</span> <span class="tok-nf">connectionFactory</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-n">ActiveMQConnectionFactory</span> <span class="tok-n">activeMQConnectionFactory</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ActiveMQConnectionFactory</span><span class="tok-o">(</span><span class="tok-s">&quot;tcp://localhost:61616&quot;</span><span class="tok-o">);</span>
      <span class="tok-n">activeMQConnectionFactory</span><span class="tok-o">.</span><span class="tok-na">setUseAsyncSend</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
      <span class="tok-n">activeMQConnectionFactory</span><span class="tok-o">.</span><span class="tok-na">setAlwaysSessionAsync</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
      <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-n">CachingConnectionFactory</span><span class="tok-o">(</span><span class="tok-n">activeMQConnectionFactory</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Bean</span>
  <span class="tok-kd">public</span> <span class="tok-n">JmsTemplate</span> <span class="tok-nf">jmsTemplate</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-n">JmsTemplate</span> <span class="tok-n">jmsTemplate</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JmsTemplate</span><span class="tok-o">();</span>
      <span class="tok-n">jmsTemplate</span><span class="tok-o">.</span><span class="tok-na">setDefaultDestination</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">ActiveMQQueue</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable-jobs&quot;</span><span class="tok-o">));</span>
      <span class="tok-n">jmsTemplate</span><span class="tok-o">.</span><span class="tok-na">setConnectionFactory</span><span class="tok-o">(</span><span class="tok-n">connectionFactory</span><span class="tok-o">());</span>
      <span class="tok-k">return</span> <span class="tok-n">jmsTemplate</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Bean</span>
  <span class="tok-kd">public</span> <span class="tok-n">MessageListenerContainer</span> <span class="tok-nf">messageListenerContainer</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-n">DefaultMessageListenerContainer</span> <span class="tok-n">messageListenerContainer</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">DefaultMessageListenerContainer</span><span class="tok-o">();</span>
      <span class="tok-n">messageListenerContainer</span><span class="tok-o">.</span><span class="tok-na">setConnectionFactory</span><span class="tok-o">(</span><span class="tok-n">connectionFactory</span><span class="tok-o">());</span>
      <span class="tok-n">messageListenerContainer</span><span class="tok-o">.</span><span class="tok-na">setDestinationName</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable-jobs&quot;</span><span class="tok-o">);</span>
      <span class="tok-n">messageListenerContainer</span><span class="tok-o">.</span><span class="tok-na">setMessageListener</span><span class="tok-o">(</span><span class="tok-n">jobMessageListener</span><span class="tok-o">());</span>
      <span class="tok-n">messageListenerContainer</span><span class="tok-o">.</span><span class="tok-na">setConcurrentConsumers</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">);</span>
      <span class="tok-n">messageListenerContainer</span><span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
      <span class="tok-k">return</span> <span class="tok-n">messageListenerContainer</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Bean</span>
  <span class="tok-kd">public</span> <span class="tok-n">JobMessageListener</span> <span class="tok-nf">jobMessageListener</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">JobMessageListener</span> <span class="tok-n">jobMessageListener</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JobMessageListener</span><span class="tok-o">();</span>
    <span class="tok-n">jobMessageListener</span><span class="tok-o">.</span><span class="tok-na">setProcessEngineConfiguration</span><span class="tok-o">(</span><span class="tok-n">processEngineConfiguration</span><span class="tok-o">());</span>
    <span class="tok-k">return</span> <span class="tok-n">jobMessageListener</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的代码中，<em>flowable-jms-spring-executor</em>模块提供的只有<em>JobMessageListener</em>与<em>MessageBasedJobManager</em>两个类。其他的所有代码都来自Spring。因此，如果想要替换为其他的队列/协议，就需要替换这些类。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced_parseHandlers">18.2. 深入流程解析</h3>
<div class="paragraph">
<p>BPMN 2.0 XML需要解析为Flowable的内部模型，才能在Flowable引擎中执行。部署流程时，或是在内存中找不到流程时，会从数据库中读取XML并进行解析。</p>
</div>
<div class="paragraph">
<p><code>BpmnParser</code>类会为每个流程创建一个<code>BpmnParser</code>实例，作为解析过程的容器。解析本身很简单：引擎对于每一个BPMN 2.0元素都有一个对应的<code>org.flowable.engine.parse.BpmnParseHandler</code>的实例，解析器将BPMN 2.0元素类映射至<code>BpmnParseHandler</code>实例。默认情况下，Flowable使用<code>BpmnParseHandler</code>实例处理所有支持的元素，并为流程的步骤附加执行监听器，以创建历史。</p>
</div>
<div class="paragraph">
<p>可以在Flowable引擎中添加<code>org.flowable.engine.parse.BpmnParseHandler</code>的自定义实例。比如常见使用场景是，为特定步骤添加执行监听器，向某个事件处理队列发送事件。Flowable处理历史就使用的是这种方式。要添加这种自定义处理器，需要调整Flowable配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;preBpmnParseHandlers&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;list&gt;</span>
    <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.parsing.MyFirstBpmnParseHandler&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/list&gt;</span>
<span class="tok-nt">&lt;/property&gt;</span>

<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;postBpmnParseHandlers&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;list&gt;</span>
    <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.parsing.MySecondBpmnParseHandler&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.parsing.MyThirdBpmnParseHandler&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/list&gt;</span>
<span class="tok-nt">&lt;/property&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在<code>preBpmnParseHandlers</code>参数中配置的<code>BpmnParseHandler</code>实例将添加在默认处理器之前。类似的，<code>postBpmnParseHandlers</code>中实例将添加在默认处理器之后。有时顺序会影响自定义解析处理器中包含的逻辑，需要特别注意。</p>
</div>
<div class="paragraph">
<p><code>org.flowable.engine.parse.BpmnParseHandler</code>是一个简单的接口：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">BpmnParseHandler</span> <span class="tok-o">{</span>

  <span class="tok-n">Collection</span><span class="tok-o">&lt;</span><span class="tok-n">Class</span><span class="tok-o">&gt;?</span> <span class="tok-kd">extends</span> <span class="tok-n">BaseElement</span><span class="tok-o">&gt;&gt;</span> <span class="tok-nf">getHandledTypes</span><span class="tok-o">();</span>

  <span class="tok-kt">void</span> <span class="tok-nf">parse</span><span class="tok-o">(</span><span class="tok-n">BpmnParse</span> <span class="tok-n">bpmnParse</span><span class="tok-o">,</span> <span class="tok-n">BaseElement</span> <span class="tok-n">element</span><span class="tok-o">);</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getHandledTypes()</code>方法返回该解析器处理的所有类型的集合。集合的泛型提示，可用的类型是<code>BaseElement</code>的子类。也可以扩展<code>AbstractBpmnParseHandler</code>类，并覆盖<code>getHandledType()</code>方法，它只返回一个类而不是一个集合。这个类也包含了一些默认解析处理器通用的辅助方法。当解析器遇到匹配该方法的返回类型的元素时，将调用这个<code>BpmnParseHandler</code>实例进行解析。在下面的例子里，当遇到BPMN 2.0 XML中的流程元素时，就会执行其<code>executeParse</code>方法（这是一个类型转换方法，替代<code>BpmnParseHandler</code>接口中的普通<code>parse</code>方法）中的逻辑。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TestBPMNParseHandler</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractBpmnParseHandler</span><span class="tok-o">&lt;</span><span class="tok-n">Process</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>

  <span class="tok-kd">protected</span> <span class="tok-n">Class</span><span class="tok-o">&lt;?</span> <span class="tok-kd">extends</span> <span class="tok-n">BaseElement</span><span class="tok-o">&gt;</span> <span class="tok-nf">getHandledType</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">Process</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">executeParse</span><span class="tok-o">(</span><span class="tok-n">BpmnParse</span> <span class="tok-n">bpmnParse</span><span class="tok-o">,</span> <span class="tok-n">Process</span> <span class="tok-n">element</span><span class="tok-o">)</span> <span class="tok-o">{</span>
     <span class="tok-o">..</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>重要提示：</strong>在实现自定义解析处理器时，不要使用任何用于解析BPMN 2.0结构的内部类。否则会很难查找bug。安全的做法是实现<em>BpmnParseHandler</em>接口，或扩展内部抽象类<em>org.flowable.engine.impl.bpmn.parser.handler.AbstractBpmnParseHandler</em>。</p>
</div>
<div class="paragraph">
<p>可以（但不常用）替换默认用于将BPMN 2.0元素解析为Flowable内部模型的<code>BpmnParseHandler</code>实例。可以通过下面的代码片段实现：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;customDefaultBpmnParseHandlers&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;list&gt;</span>
    ...
  <span class="tok-nt">&lt;/list&gt;</span>
<span class="tok-nt">&lt;/property&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>简单的例子，强制所有服务任务都异步执行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CustomUserTaskBpmnParseHandler</span> <span class="tok-kd">extends</span> <span class="tok-n">ServiceTaskParseHandler</span> <span class="tok-o">{</span>

  <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">executeParse</span><span class="tok-o">(</span><span class="tok-n">BpmnParse</span> <span class="tok-n">bpmnParse</span><span class="tok-o">,</span> <span class="tok-n">ServiceTask</span> <span class="tok-n">serviceTask</span><span class="tok-o">)</span> <span class="tok-o">{</span>

    <span class="tok-c1">// 进行常规操作</span>
    <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">executeParse</span><span class="tok-o">(</span><span class="tok-n">bpmnParse</span><span class="tok-o">,</span> <span class="tok-n">serviceTask</span><span class="tok-o">);</span>

    <span class="tok-c1">// 保证异步执行</span>
    <span class="tok-n">serviceTask</span><span class="tok-o">.</span><span class="tok-na">setAsynchronous</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced.uuid.generator">18.3. 高并发下使用的UUID ID生成器</h3>
<div class="paragraph">
<p>在某些（非常）高并发负载的情况下，默认的ID生成器可能会由于不能足够快地获取新的id块而产生异常。每个流程引擎都有一个ID生成器。默认的ID生成器会在数据库中保存一块ID，这样其他引擎就不能使用同一个块中的ID。引擎运行时，当ID生成器发现ID块已经用完，就会启动一个新的事务，来获取一个新的块。在（非常）有限的使用场景下，当负载非常高时可能导致问题。对于大多数用例来说，默认的ID生成器已经足够使用了。默认的<code>org.flowable.engine.impl.db.DbIdGenerator</code>也有一个<code>idBlockSize</code>参数，用于配置保留的ID块的大小，调整获取ID的行为。</p>
</div>
<div class="paragraph">
<p>可以使用<code>org.flowable.engine.impl.persistence.StrongUuidGenerator</code>替换默认的ID生成器。它会在本地生成唯一的<a href="http://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a>，并将其用于所有实体的标识符。因为UUID不需要访问数据库就能生成，因此在非常高并发的使用场景下更合适。请注意取决于机器，性能可能与默认的ID生成器不同（更好更坏都有可能）。</p>
</div>
<div class="paragraph">
<p>可以在flowable配置中，像下面这样配置UUID生成器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;idGenerator&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.engine.impl.persistence.StrongUuidGenerator&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/property&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>使用UUID id生成器需要添加下列额外依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span> <span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>com.fasterxml.uuid<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>java-uuid-generator<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>3.1.3<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced.tenancy">18.4. 多租户</h3>
<div class="paragraph">
<p>总的来说，多租户是指一个软件为多个不同组织提供服务。其核心是数据隔离，一个组织不能看到其他组织的数据。在这个语境中，一个这样的组织（或部门、团队，等等）被称为一个<em>租户（tenant）</em>。</p>
</div>
<div class="paragraph">
<p>请注意它与多实例部署有本质区别。多实例部署是指每一个组织都分别运行一个Flowable流程引擎实例（且使用不同的数据库账户）。尽管Flowable比较轻量级，运行一个流程引擎实例不会花费太多资源，但多实例部署仍然增加了复杂度与维护量。但是，在某些使用场景中，多实例部署可能是正确的解决方案。</p>
</div>
<div class="paragraph">
<p>Flowable中的多租户主要围绕着隔离数据实现。要注意<em>Flowable并不强制多租户规则</em>。换句话说，查询与使用数据时，不会验证进行操作的用户是否属于正确的租户。这应该在调用Flowable引擎的层次实现。Flowable负责确保可以存储租户信息，并可在获取流程数据时使用。</p>
</div>
<div class="paragraph">
<p>在Flowable流程引擎中部署流程定义时，可以传递一个<em>租户标识符（tenant identifier）</em>。这是一个字符串（可以是UUID，部门id，等等……），限制为256个字符长，唯一标识一个租户：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">repositoryService</span><span class="tok-o">.</span><span class="tok-na">createDeployment</span><span class="tok-o">()</span>
            <span class="tok-o">.</span><span class="tok-na">addClassPathResource</span><span class="tok-o">(...)</span>
            <span class="tok-o">.</span><span class="tok-na">tenantId</span><span class="tok-o">(</span><span class="tok-s">&quot;myTenantId&quot;</span><span class="tok-o">)</span>
            <span class="tok-o">.</span><span class="tok-na">deploy</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在部署时传入一个租户ID意味着：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>部署中包含的所有流程定义都将从该部署继承租户标识符。</p>
</li>
<li>
<p>从这些流程定义启动的所有流程实例都将从流程定义继承租户标识符。</p>
</li>
<li>
<p>在执行流程实例时，创建所有任务都将从流程实例继承租户标识符。独立任务也可以有租户标识符。</p>
</li>
<li>
<p>执行流程实例时，创建的所有执行都将从流程实例继承租户标识符。</p>
</li>
<li>
<p>（在流程内或通过API）触发信号抛出事件时可以提供租户标识符。这个信号将只在该租户的上下文中执行。也就是说，如果有多个使用相同名字的信号捕获事件，只会触发带有正确租户标识符的捕获事件。</p>
</li>
<li>
<p>所有作业（定时器与异步操作）要么从流程定义（如定时器启动事件），要么从流程实例（运行时创建的作业，如异步操作）继承租户标识符。这样就可以在自定义作业执行器中，为租户设置优先级。</p>
</li>
<li>
<p>所有历史实体（历史流程实例、任务与活动）都从其对应的运行时对象继承租户标识符。</p>
</li>
<li>
<p>另外，模型也可以有租户标识符（模型用于Flowable Modeler存储BPMN 2.0）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>所有查询API都可以通过租户标识符进行过滤。例如（也可以换成其他实体的查询）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createProcessInstanceQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">processInstanceTenantId</span><span class="tok-o">(</span><span class="tok-s">&quot;myTenantId&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">processDefinitionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;myProcessDefinitionKey&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">variableValueEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;myVar&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;someValue&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">()</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>查询API也可以使用<em>like</em>语义通过租户标识符过滤，也可以过滤掉没有租户标识符的实体。</p>
</div>
<div class="paragraph">
<p><strong>重要的实现细节：</strong>由于数据库的原因（更确切地说，对唯一约束中null的处理），<em>默认的</em>代表<em>没有租户</em>的租户标识符为<strong>空字符串</strong>。这是因为（流程定义key，流程定义版本，租户标识符）的组合需要是唯一的（由数据库约束保证）。也请注意租户标识符不能设置为null，不然会影响查询，因为某些数据库（Oracle）会将空字符串当做null值处理（这也就是为什么<em>.withoutTenantId</em>查询不检查空字符串还是null）。所以可以为多个租户部署（有相同的流程定义key的）同一个流程定义，并且每一个租户都有他们自己的版本。不影响未使用租户时的使用方式。</p>
</div>
<div class="paragraph">
<p><strong>请注意，集群运行多个Flowable实例与上面所说不冲突。</strong></p>
</div>
<div class="paragraph">
<p>[实验性] 可以调用<em>repositoryService</em>的<em>changeDeploymentTenantId(String deploymentId, String newTenantId)</em>方法修改租户标识符。并将连带修改每一处之前继承的租户标识符。在从非多租户环境迁移至多租户部署时很有用。查看该方法的Javadoc了解更多信息。</p>
</div>
</div>
<div class="sect2">
<h3 id="advanced.custom.sql.queries">18.5. 执行自定义SQL</h3>
<div class="paragraph">
<p>Flowable提供了与数据库交互的高级API。例如，要获取数据，查询API与原生（Native）查询API各有用武之地。但有时会需要更高的灵活性。下面介绍如何在Flowable流程引擎范围内（所以可以使用相同的事务设置等）的数据存储中，执行完全自定义的SQL语句（select、insert、update与delete都可以）。</p>
</div>
<div class="paragraph">
<p>Flowable引擎使用其底层框架MyBatis的功能自定义SQL语句。可以在<a href="http://mybatis.github.io/mybatis-3/java-api.html">MyBatis用户手册</a>找到更多信息。</p>
</div>
<div class="sect3">
<h4 id="_annotation_based_mapped_statements">18.5.1. 基于注解的映射语句</h4>
<div class="paragraph">
<p>使用基于注解的映射语句（Annotation based Mapped Statement）时，首先要做的是创建一个MyBatis映射类。例如，假设在某个用例中，不需要完整的任务数据，而只需要其中很少一部分，就可以通过映射类（Mapper）完成，像是这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">MyTestMapper</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Select</span><span class="tok-o">(</span><span class="tok-s">&quot;SELECT ID_ as id, NAME_ as name, CREATE_TIME_ as createTime FROM ACT_RU_TASK&quot;</span><span class="tok-o">)</span>
    <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;&gt;</span> <span class="tok-nf">selectTasks</span><span class="tok-o">();</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>必须像下面这样为流程引擎配置映射类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span>...
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;customMybatisMappers&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;set&gt;</span>
    <span class="tok-nt">&lt;value&gt;</span>org.flowable.standalone.cfg.MyTestMapper<span class="tok-nt">&lt;/value&gt;</span>
  <span class="tok-nt">&lt;/set&gt;</span>
<span class="tok-nt">&lt;/property&gt;</span>
...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意这是一个接口。底层的MyBatis框架会构造一个它的实例，并在运行时使用。也请注意方法的返回值没有类型，而只是一个map的list（代表了带有列数据的行的列表）。如果需要，可以通过MyBatis映射类设置类型。</p>
</div>
<div class="paragraph">
<p>使用<em>managementService.executeCustomSql</em>方法执行上面的查询。这个方法使用<em>CustomSqlExecution</em>的实例作为包装器，将引擎需要处理的内部数据隐藏起来。</p>
</div>
<div class="paragraph">
<p>不幸的是，Java泛型降低了可读性。下面的两个泛型类是映射类与其返回类型类。只是简单的调用映射方法，并返回其结果（若有）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-n">CustomSqlExecution</span><span class="tok-o">&lt;</span><span class="tok-n">MyTestMapper</span><span class="tok-o">,</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;&gt;&gt;</span> <span class="tok-n">customSqlExecution</span> <span class="tok-o">=</span>
          <span class="tok-k">new</span> <span class="tok-n">AbstractCustomSqlExecution</span><span class="tok-o">&lt;</span><span class="tok-n">MyTestMapper</span><span class="tok-o">,</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;&gt;&gt;(</span><span class="tok-n">MyTestMapper</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;&gt;</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">MyTestMapper</span> <span class="tok-n">customMapper</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">customMapper</span><span class="tok-o">.</span><span class="tok-na">selectTasks</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>

<span class="tok-o">};</span>

<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;&gt;</span> <span class="tok-n">results</span> <span class="tok-o">=</span> <span class="tok-n">managementService</span><span class="tok-o">.</span><span class="tok-na">executeCustomSql</span><span class="tok-o">(</span><span class="tok-n">customSqlExecution</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子里，上面列出的Map只包含<em>id, name与创建时间</em>，而不是完整的任务对象。</p>
</div>
<div class="paragraph">
<p>按照上面的方法可以使用任何SQL。另一个更复杂的例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span>    <span class="tok-nd">@Select</span><span class="tok-o">({</span>
        <span class="tok-s">&quot;SELECT task.ID_ as taskId, variable.LONG_ as variableValue FROM ACT_RU_VARIABLE variable&quot;</span><span class="tok-o">,</span>
        <span class="tok-s">&quot;inner join ACT_RU_TASK task on variable.TASK_ID_ = task.ID_&quot;</span><span class="tok-o">,</span>
        <span class="tok-s">&quot;where variable.NAME_ = #{variableName}&quot;</span>
    <span class="tok-o">})</span>
    <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;&gt;</span> <span class="tok-nf">selectTaskWithSpecificVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>任务表join变量表，只选择变量有特定名字的记录，并返回任务id与对应的数字值。</p>
</div>
<div class="paragraph">
<p>请参考单元测试<em>org.flowable.standalone.cfg.CustomMybatisMapperTest</em>及src/test/java/org/flowable/standalone/cfg/与src/test/resources/org/flowable/standalone/cfg/目录中的其它类与资源，了解基于注解的映射语句的更多使用例子。</p>
</div>
</div>
<div class="sect3">
<h4 id="_xml_based_mapped_statements">18.5.2. 基于XML的映射语句</h4>
<div class="paragraph">
<p>可以使用基于XML的映射语句（XML based Mapped Statement），在XML文件中定义语句。对于不需要完整的任务数据，而只需要其中很少一部分数据的用例，XML文件像是下面这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-nt">&lt;mapper</span> <span class="tok-na">namespace=</span><span class="tok-s">&quot;org.flowable.standalone.cfg.TaskMapper&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;resultMap</span> <span class="tok-na">id=</span><span class="tok-s">&quot;customTaskResultMap&quot;</span> <span class="tok-na">type=</span><span class="tok-s">&quot;org.flowable.standalone.cfg.CustomTask&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;id</span> <span class="tok-na">property=</span><span class="tok-s">&quot;id&quot;</span> <span class="tok-na">column=</span><span class="tok-s">&quot;ID_&quot;</span> <span class="tok-na">jdbcType=</span><span class="tok-s">&quot;VARCHAR&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;result</span> <span class="tok-na">property=</span><span class="tok-s">&quot;name&quot;</span> <span class="tok-na">column=</span><span class="tok-s">&quot;NAME_&quot;</span> <span class="tok-na">jdbcType=</span><span class="tok-s">&quot;VARCHAR&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;result</span> <span class="tok-na">property=</span><span class="tok-s">&quot;createTime&quot;</span> <span class="tok-na">column=</span><span class="tok-s">&quot;CREATE_TIME_&quot;</span> <span class="tok-na">jdbcType=</span><span class="tok-s">&quot;TIMESTAMP&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/resultMap&gt;</span>

  <span class="tok-nt">&lt;select</span> <span class="tok-na">id=</span><span class="tok-s">&quot;selectCustomTaskList&quot;</span> <span class="tok-na">resultMap=</span><span class="tok-s">&quot;customTaskResultMap&quot;</span><span class="tok-nt">&gt;</span>
    select RES.ID_, RES.NAME_, RES.CREATE_TIME_ from ACT_RU_TASK RES
  <span class="tok-nt">&lt;/select&gt;</span>

<span class="tok-nt">&lt;/mapper&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>结果映射为如下的<em>org.flowable.standalone.cfg.CustomTask</em>类的实例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CustomTask</span> <span class="tok-o">{</span>

  <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">;</span>
  <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>
  <span class="tok-kd">protected</span> <span class="tok-n">Date</span> <span class="tok-n">createTime</span><span class="tok-o">;</span>

  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getId</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">id</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
  <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getName</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">name</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
  <span class="tok-kd">public</span> <span class="tok-n">Date</span> <span class="tok-nf">getCreateTime</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">createTime</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>必须像下面这样为流程引擎配置提供映射XML文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span>...
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;customMybatisXMLMappers&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;set&gt;</span>
    <span class="tok-nt">&lt;value&gt;</span>org/flowable/standalone/cfg/custom-mappers/CustomTaskMapper.xml<span class="tok-nt">&lt;/value&gt;</span>
  <span class="tok-nt">&lt;/set&gt;</span>
<span class="tok-nt">&lt;/property&gt;</span>
...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样执行语句：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">CustomTask</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">managementService</span><span class="tok-o">.</span><span class="tok-na">executeCommand</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Command</span><span class="tok-o">&lt;</span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">CustomTask</span><span class="tok-o">&gt;&gt;()</span> <span class="tok-o">{</span>

      <span class="tok-nd">@SuppressWarnings</span><span class="tok-o">(</span><span class="tok-s">&quot;unchecked&quot;</span><span class="tok-o">)</span>
      <span class="tok-nd">@Override</span>
      <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">CustomTask</span><span class="tok-o">&gt;</span> <span class="tok-nf">execute</span><span class="tok-o">(</span><span class="tok-n">CommandContext</span> <span class="tok-n">commandContext</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-o">(</span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">CustomTask</span><span class="tok-o">&gt;)</span> <span class="tok-n">commandContext</span><span class="tok-o">.</span><span class="tok-na">getDbSqlSession</span><span class="tok-o">().</span><span class="tok-na">selectList</span><span class="tok-o">(</span><span class="tok-s">&quot;selectCustomTaskList&quot;</span><span class="tok-o">);</span>
      <span class="tok-o">}</span>
    <span class="tok-o">});</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>XML映射语句在需要更复杂语句的时候很好用。Flowable内部就使用XML映射语句，所以能使用底层功能。</p>
</div>
<div class="paragraph">
<p>假设某个用例下，需要基于id、name、type、userId等字段，查询附件数据。要实现这个用例，可以创建下面这样的扩展了<em>org.flowable.engine.impl.AbstractQuery</em>的查询类<em>AttachmentQuery</em>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AttachmentQuery</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractQuery</span><span class="tok-o">&lt;</span><span class="tok-n">AttachmentQuery</span><span class="tok-o">,</span> <span class="tok-n">Attachment</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>

  <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">attachmentId</span><span class="tok-o">;</span>
  <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">attachmentName</span><span class="tok-o">;</span>
  <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">attachmentType</span><span class="tok-o">;</span>
  <span class="tok-kd">protected</span> <span class="tok-n">String</span> <span class="tok-n">userId</span><span class="tok-o">;</span>

  <span class="tok-kd">public</span> <span class="tok-nf">AttachmentQuery</span><span class="tok-o">(</span><span class="tok-n">ManagementService</span> <span class="tok-n">managementService</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">managementService</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-n">AttachmentQuery</span> <span class="tok-nf">attachmentId</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">attachmentId</span><span class="tok-o">){</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">attachmentId</span> <span class="tok-o">=</span> <span class="tok-n">attachmentId</span><span class="tok-o">;</span>
    <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-n">AttachmentQuery</span> <span class="tok-nf">attachmentName</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">attachmentName</span><span class="tok-o">){</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">attachmentName</span> <span class="tok-o">=</span> <span class="tok-n">attachmentName</span><span class="tok-o">;</span>
    <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-n">AttachmentQuery</span> <span class="tok-nf">attachmentType</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">attachmentType</span><span class="tok-o">){</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">attachmentType</span> <span class="tok-o">=</span> <span class="tok-n">attachmentType</span><span class="tok-o">;</span>
    <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-kd">public</span> <span class="tok-n">AttachmentQuery</span> <span class="tok-nf">userId</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">userId</span><span class="tok-o">){</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">userId</span> <span class="tok-o">=</span> <span class="tok-n">userId</span><span class="tok-o">;</span>
    <span class="tok-k">return</span> <span class="tok-k">this</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">long</span> <span class="tok-nf">executeCount</span><span class="tok-o">(</span><span class="tok-n">CommandContext</span> <span class="tok-n">commandContext</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-o">(</span><span class="tok-n">Long</span><span class="tok-o">)</span> <span class="tok-n">commandContext</span><span class="tok-o">.</span><span class="tok-na">getDbSqlSession</span><span class="tok-o">()</span>
                   <span class="tok-o">.</span><span class="tok-na">selectOne</span><span class="tok-o">(</span><span class="tok-s">&quot;selectAttachmentCountByQueryCriteria&quot;</span><span class="tok-o">,</span> <span class="tok-k">this</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Attachment</span><span class="tok-o">&gt;</span> <span class="tok-nf">executeList</span><span class="tok-o">(</span><span class="tok-n">CommandContext</span> <span class="tok-n">commandContext</span><span class="tok-o">,</span> <span class="tok-n">Page</span> <span class="tok-n">page</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-n">commandContext</span><span class="tok-o">.</span><span class="tok-na">getDbSqlSession</span><span class="tok-o">()</span>
            <span class="tok-o">.</span><span class="tok-na">selectList</span><span class="tok-o">(</span><span class="tok-s">&quot;selectAttachmentByQueryCriteria&quot;</span><span class="tok-o">,</span> <span class="tok-k">this</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意在扩展<em>AbstractQuery</em>时，子类需要为super构造函数传递一个<em>ManagementService</em>的实例，并需要实现<em>executeCount</em>与<em>executeList</em>来调用映射语句。</p>
</div>
<div class="paragraph">
<p>包含映射语句的XML文件如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</div></td><td class="code"><span></span><span class="tok-nt">&lt;mapper</span> <span class="tok-na">namespace=</span><span class="tok-s">&quot;org.flowable.standalone.cfg.AttachmentMapper&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;select</span> <span class="tok-na">id=</span><span class="tok-s">&quot;selectAttachmentCountByQueryCriteria&quot;</span> <span class="tok-na">parameterType=</span><span class="tok-s">&quot;org.flowable.standalone.cfg.AttachmentQuery&quot;</span> <span class="tok-na">resultType=</span><span class="tok-s">&quot;long&quot;</span><span class="tok-nt">&gt;</span>
    select count(distinct RES.ID_)
    <span class="tok-nt">&lt;include</span> <span class="tok-na">refid=</span><span class="tok-s">&quot;selectAttachmentByQueryCriteriaSql&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/select&gt;</span>

  <span class="tok-nt">&lt;select</span> <span class="tok-na">id=</span><span class="tok-s">&quot;selectAttachmentByQueryCriteria&quot;</span> <span class="tok-na">parameterType=</span><span class="tok-s">&quot;org.flowable.standalone.cfg.AttachmentQuery&quot;</span> <span class="tok-na">resultMap=</span><span class="tok-s">&quot;org.flowable.engine.impl.persistence.entity.AttachmentEntity.attachmentResultMap&quot;</span><span class="tok-nt">&gt;</span>
    ${limitBefore}
    select distinct RES.* ${limitBetween}
    <span class="tok-nt">&lt;include</span> <span class="tok-na">refid=</span><span class="tok-s">&quot;selectAttachmentByQueryCriteriaSql&quot;</span><span class="tok-nt">/&gt;</span>
    ${orderBy}
    ${limitAfter}
  <span class="tok-nt">&lt;/select&gt;</span>

  <span class="tok-nt">&lt;sql</span> <span class="tok-na">id=</span><span class="tok-s">&quot;selectAttachmentByQueryCriteriaSql&quot;</span><span class="tok-nt">&gt;</span>
  from ${prefix}ACT_HI_ATTACHMENT RES
  <span class="tok-nt">&lt;where&gt;</span>
   <span class="tok-nt">&lt;if</span> <span class="tok-na">test=</span><span class="tok-s">&quot;attachmentId != null&quot;</span><span class="tok-nt">&gt;</span>
     RES.ID_ = #{attachmentId}
   <span class="tok-nt">&lt;/if&gt;</span>
   <span class="tok-nt">&lt;if</span> <span class="tok-na">test=</span><span class="tok-s">&quot;attachmentName != null&quot;</span><span class="tok-nt">&gt;</span>
     and RES.NAME_ = #{attachmentName}
   <span class="tok-nt">&lt;/if&gt;</span>
   <span class="tok-nt">&lt;if</span> <span class="tok-na">test=</span><span class="tok-s">&quot;attachmentType != null&quot;</span><span class="tok-nt">&gt;</span>
     and RES.TYPE_ = #{attachmentType}
   <span class="tok-nt">&lt;/if&gt;</span>
   <span class="tok-nt">&lt;if</span> <span class="tok-na">test=</span><span class="tok-s">&quot;userId != null&quot;</span><span class="tok-nt">&gt;</span>
     and RES.USER_ID_ = #{userId}
   <span class="tok-nt">&lt;/if&gt;</span>
  <span class="tok-nt">&lt;/where&gt;</span>
  <span class="tok-nt">&lt;/sql&gt;</span>
<span class="tok-nt">&lt;/mapper&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以在语句中使用例如分页、排序、表名前缀等功能（因为parameterType为<em>AbstractQuery</em>的子类）。可以使用引擎定义的<em>org.flowable.engine.impl.persistence.entity.AttachmentEntity.attachmentResultMap</em>来映射结果。</p>
</div>
<div class="paragraph">
<p>最后，可以这样使用<em>AttachmentQuery</em>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</div></td><td class="code"><span></span><span class="tok-o">....</span>
<span class="tok-c1">// 获取附件的总数</span>
<span class="tok-kt">long</span> <span class="tok-n">count</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AttachmentQuery</span><span class="tok-o">(</span><span class="tok-n">managementService</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">();</span>

<span class="tok-c1">// 获取id为10025的附件</span>
<span class="tok-n">Attachment</span> <span class="tok-n">attachment</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AttachmentQuery</span><span class="tok-o">(</span><span class="tok-n">managementService</span><span class="tok-o">).</span><span class="tok-na">attachmentId</span><span class="tok-o">(</span><span class="tok-s">&quot;10025&quot;</span><span class="tok-o">).</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>

<span class="tok-c1">// 获取前10个附件</span>
<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Attachment</span><span class="tok-o">&gt;</span> <span class="tok-n">attachments</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AttachmentQuery</span><span class="tok-o">(</span><span class="tok-n">managementService</span><span class="tok-o">).</span><span class="tok-na">listPage</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-mi">10</span><span class="tok-o">);</span>

<span class="tok-c1">// 获取用户kermit上传的所有附件</span>
<span class="tok-n">attachments</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AttachmentQuery</span><span class="tok-o">(</span><span class="tok-n">managementService</span><span class="tok-o">).</span><span class="tok-na">userId</span><span class="tok-o">(</span><span class="tok-s">&quot;kermit&quot;</span><span class="tok-o">).</span><span class="tok-na">list</span><span class="tok-o">();</span>
<span class="tok-o">....</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>请参考单元测试<em>org.flowable.standalone.cfg.CustomMybatisXMLMapperTest</em>_及src/test/java/org/flowable/standalone/cfg/与src/test/resources/org/flowable/standalone/cfg/目录中的其它类与资源，了解基于XML的映射语句的更多使用例子。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced.process.engine.configurators">18.6. 使用ProcessEngineConfigurator进行高级流程引擎配置</h3>
<div class="paragraph">
<p>深入控制流程引擎配置的高级方法是使用<em>ProcessEngineConfigurator</em>。创建一个<em>org.flowable.engine.cfg.ProcessEngineConfigurator</em>接口的实现，并将它注入到流程引擎配置中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;...SomeProcessEngineConfigurationClass&quot;</span><span class="tok-nt">&gt;</span>

    ...

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;configurators&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;list&gt;</span>
            <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;com.mycompany.MyConfigurator&quot;</span><span class="tok-nt">&gt;</span>
                ...
            <span class="tok-nt">&lt;/bean&gt;</span>
        <span class="tok-nt">&lt;/list&gt;</span>
    <span class="tok-nt">&lt;/property&gt;</span>

    ...

<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>这个接口需要实现两个方法。<em>configure</em>方法，使用一个<em>ProcessEngineConfiguration</em>实例作为参数。可以使用这个方式添加自定义配置，并且这个方法会保证<strong>在流程引擎创建之前，所有默认配置已经完成之后</strong>被调用。另一个方法是<em>getPriority</em>方法，可以指定配置器的顺序，以备某些配置器对其他的有依赖。</p>
</div>
<div class="paragraph">
<p>这种配置器的一个例子是<a href="#chapter_ldap">集成LDAP</a>，使用配置器将默认的用户与组管理类替换为可以处理LDAP用户的实现。可见配置器可以相当大程度地改变及调整流程引擎，以适应非常高级的使用场景。另一个例子是使用自定义的缓存替换流程引擎缓存：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ProcessDefinitionCacheConfigurator</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractProcessEngineConfigurator</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">configure</span><span class="tok-o">(</span><span class="tok-n">ProcessEngineConfigurationImpl</span> <span class="tok-n">processEngineConfiguration</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">MyCache</span> <span class="tok-n">myCache</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">MyCache</span><span class="tok-o">();</span>
            <span class="tok-n">processEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">setProcessDefinitionCache</span><span class="tok-o">(</span><span class="tok-n">enterpriseProcessDefinitionCache</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用<a href="http://docs.oracle.com/javase/7/docs/api/java/util/ServiceLoader.html">ServiceLoader</a>的方法，从classpath中自动发现流程引擎配置器。也就是说必须将包含配置器实现的jar放在classpath下，并且jar的<em>META-INF/services</em>目录下需要有名为<strong>org.flowable.engine.cfg.ProcessEngineConfigurator</strong>的文件，内容是自定义实现的全限定类名。当流程引擎启动时，日志会提示找到这些配置器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO  org.flowable.engine.impl.cfg.ProcessEngineConfigurationImpl  - Found 1 auto-discoverable Process Engine Configurators
INFO  org.flowable.engine.impl.cfg.ProcessEngineConfigurationImpl  - Found 1 Process Engine Configurators in total:
INFO  org.flowable.engine.impl.cfg.ProcessEngineConfigurationImpl  - class org.flowable.MyCustomConfigurator</pre>
</div>
</div>
<div class="paragraph">
<p>请注意某些环境下可能不能使用ServiceLoader方法。可以通过ProcessEngineConfiguration的<em>enableConfiguratorServiceLoader</em>参数显式禁用（默认为true）。</p>
</div>
</div>
<div class="sect2">
<h3 id="advanced.task.query.switching">18.7. 高级查询API：在运行时与历史任务查询间无缝切换</h3>
<div class="paragraph">
<p>BPM用户界面的核心组件是任务列表。一般来说，最终用户执行待办任务，通过不同方式过滤收件箱中的任务。有时也需要在列表中显示历史任务，并进行类似的过滤。为了简化代码，<em>TaskQuery</em>与<em>HistoricTaskInstanceQuery</em>有共同的父接口，其中包含了所有公共操作（大多数操作都是公共的）。</p>
</div>
<div class="paragraph">
<p>这个公共接口是<em>org.flowable.engine.task.TaskInfoQuery</em>类。<em>org.flowable.engine.task.Task</em>与<em>org.flowable.engine.task.HistoricTaskInstance</em>都有公共父类<em>org.flowable.engine.task.TaskInfo</em>（并带有公共参数），作为<em>list()</em>等方法的返回值。然而，有时Java泛型会帮倒忙：如果想要直接使用<em>TaskInfoQuery</em>类型，将会像是这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">TaskInfoQuery</span><span class="tok-o">&lt;?</span> <span class="tok-kd">extends</span> <span class="tok-n">TaskInfoQuery</span><span class="tok-o">&lt;?,?&gt;,</span> <span class="tok-o">?</span> <span class="tok-kd">extends</span> <span class="tok-n">TaskInfo</span><span class="tok-o">&gt;</span> <span class="tok-n">taskInfoQuery</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>呃……好吧。为了“解决”这个问题，可以使用<em>org.flowable.engine.task.TaskInfoQueryWrapper</em>类来避免泛型（下面的代码来自REST的代码，将返回一个任务列表，且用户可以选择查看进行中还是已完成的任务）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-n">TaskInfoQueryWrapper</span> <span class="tok-n">taskInfoQueryWrapper</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">runtimeQuery</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-n">taskInfoQueryWrapper</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">TaskInfoQueryWrapper</span><span class="tok-o">(</span><span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">());</span>
<span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>
	<span class="tok-n">taskInfoQueryWrapper</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">TaskInfoQueryWrapper</span><span class="tok-o">(</span><span class="tok-n">historyService</span><span class="tok-o">.</span><span class="tok-na">createHistoricTaskInstanceQuery</span><span class="tok-o">());</span>
<span class="tok-o">}</span>

<span class="tok-n">List</span><span class="tok-o">&lt;?</span> <span class="tok-kd">extends</span> <span class="tok-n">TaskInfo</span><span class="tok-o">&gt;</span> <span class="tok-n">taskInfos</span> <span class="tok-o">=</span> <span class="tok-n">taskInfoQueryWrapper</span><span class="tok-o">.</span><span class="tok-na">getTaskInfoQuery</span><span class="tok-o">().</span><span class="tok-na">or</span><span class="tok-o">()</span>
	<span class="tok-o">.</span><span class="tok-na">taskNameLike</span><span class="tok-o">(</span><span class="tok-s">&quot;%k1%&quot;</span><span class="tok-o">)</span>
	<span class="tok-o">.</span><span class="tok-na">taskDueAfter</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">(</span><span class="tok-n">now</span><span class="tok-o">.</span><span class="tok-na">getTime</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-o">(</span><span class="tok-mi">3</span> <span class="tok-o">*</span> <span class="tok-mi">24L</span> <span class="tok-o">*</span> <span class="tok-mi">60L</span> <span class="tok-o">*</span> <span class="tok-mi">60L</span> <span class="tok-o">*</span> <span class="tok-mi">1000L</span><span class="tok-o">)))</span>
<span class="tok-o">.</span><span class="tok-na">endOr</span><span class="tok-o">()</span>
<span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced.custom.session.manager">18.8. 通过覆盖标准SessionFactory自定义身份管理</h3>
<div class="paragraph">
<p>如果不想像<a href="#chapter_ldap">集成LDAP</a>中那样使用完整的<em>ProcessEngineConfigurator</em>实现，但仍然希望在框架中插入自定义的身份管理，也可以覆盖<em>IdmIdentityServiceImpl</em>类，或者直接实现<em>IdmIdentityService</em>接口，并使用实现类作为<em>ProcessEngineConfiguration</em>中的<em>idmIdentityService</em>参数。在Spring中，可以简单地向<em>ProcessEngineConfiguration</em>bean定义添加下面的代码实现：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;...SomeProcessEngineConfigurationClass&quot;</span><span class="tok-nt">&gt;</span>

    ...

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;idmIdentityService&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;com.mycompany.IdmIdentityServiceBean&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/property&gt;</span>

    ...

<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>LDAPIdentityServiceImpl</em>类是一个介绍如何实现<em>IdmIdentityService</em>接口中方法的很好的例子。你需要自行判断需要在自定义身份服务类中实现什么方法。例如下面的调用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-kt">long</span> <span class="tok-n">potentialOwners</span> <span class="tok-o">=</span> <span class="tok-n">identityService</span><span class="tok-o">.</span><span class="tok-na">createUserQuery</span><span class="tok-o">().</span><span class="tok-na">memberOfGroup</span><span class="tok-o">(</span><span class="tok-s">&quot;management&quot;</span><span class="tok-o">).</span><span class="tok-na">count</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>会调用<em>IdmIdentityService</em>接口的下列成员：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">UserQuery</span> <span class="tok-nf">createUserQuery</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#chapter_ldap">集成LDAP</a>中的代码包含了如何实现这些的完整示例。可以在GitHub查看代码：<a href="https://github.com/flowable/flowable-engine/blob/master/modules/flowable-ldap/src/main/java/org/flowable/ldap/LDAPIdentityServiceImpl.java">LDAPIdentityServiceImpl</a>。</p>
</div>
</div>
<div class="sect2">
<h3 id="advanced.safe.bpmn.xml">18.9. 启用安全BPMN 2.0 XML</h3>
<div class="paragraph">
<p>在大多数情况下，部署至Flowable引擎的BPMN 2.0流程处在开发团队等的严格控制下。然而，有的时候会希望能够向引擎上传任意的BPMN 2.0 XML。在这种情况下，需要考虑动机不良的用户可能会像<a href="http://www.jorambarrez.be/blog/2013/02/19/uploading-a-funny-xml-can-bring-down-your-server/">这里</a>描述的一样，破坏服务器。</p>
</div>
<div class="paragraph">
<p>要避免上面链接中描述的攻击，可以在流程引擎配置中设置<em>enableSafeBpmnXml</em>参数：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;enableSafeBpmnXml&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>默认情况下这个功能是禁用的！</strong>原因是它依赖<a href="http://download.java.net/jdk7/archive/b123/docs/api/javax/xml/transform/stax/StAXSource.html">StaxSource</a>类。而不幸的是，某些平台（JDK6，JBoss等）不能使用这个类（由于使用的是过时的XML解析器），因此不能启用安全BPMN 2.0 XML功能。</p>
</div>
<div class="paragraph">
<p>如果运行Flowable的平台支持，请一定要启用这个功能。</p>
</div>
</div>
<div class="sect2">
<h3 id="advanced.event.logging">18.10. 事件日志</h3>
<div class="paragraph">
<p>Flowable引入了事件日志机制。日志机制基于<a href="#eventDispatcher">Flowable引擎的事件机制</a>，并默认禁用。总的来说，来源于引擎的事件会被捕获，并创建一个包含了所有事件数据（甚至更多）的map，提供给<em>org.flowable.engine.impl.event.logger.EventFlusher</em>，由它将这些数据保存其他地方。默认情况下，使用简单的基于数据库的事件处理器/保存器，用Jackson将上述map序列化为JSON，并将其作为<em>EventLogEntryEntity</em>实例存入数据库。默认会在数据库中创建<em>ACT_EVT_LOG</em>表保存事件日志。如果不使用事件日志，可以删除这个表。</p>
</div>
<div class="paragraph">
<p>要启用数据库记录器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">processEngineConfigurationImpl</span><span class="tok-o">.</span><span class="tok-na">setEnableDatabaseEventLogging</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>或在运行时：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-n">databaseEventLogger</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">EventLogger</span><span class="tok-o">(</span><span class="tok-n">processEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">getClock</span><span class="tok-o">(),</span>
                                      <span class="tok-n">processEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">getObjectMapper</span><span class="tok-o">());</span>
<span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">addEventListener</span><span class="tok-o">(</span><span class="tok-n">databaseEventLogger</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果默认的数据库记录不符合要求，可以扩展EventLogger类。<em>createEventFlusher()</em>方法需要返回<em>org.flowable.engine.impl.event.logger.EventFlusher</em>接口的实例。可以使用<em>managementService.getEventLogEntries(startLogNr, size);</em>获取<em>EventLogEntryEntity</em>实例。</p>
</div>
<div class="paragraph">
<p>显然，这个表中的数据也可以JSON的形式存入NoSQL存储，如MongoDB，Elastic Search等。也容易看出这里使用的类（org.flowable.engine.impl.event.logger.EventLogger/EventFlusher与许多其他EventHandler类）是可插拔的，可以按你的使用场景调整。（比如将JSON直接发送给队列或NoSQL，而不存入数据库）</p>
</div>
<div class="paragraph">
<p>请注意这个事件日志机制是独立于Flowable的“传统”历史管理器的。尽管所有数据都保存在数据库表中，但并未对查询或快速恢复做优化。实际使用场景主要是审计及存入大数据存储。</p>
</div>
</div>
<div class="sect2">
<h3 id="_disabling_bulk_inserts">18.11. 禁用批量插入</h3>
<div class="paragraph">
<p>默认情况下，引擎会将对同一个数据库表的多个插入语句组合在一起，作为<em>批量插入</em>。这样能够提高性能，并已在所有支持的数据库中实现及测试。</p>
</div>
<div class="paragraph">
<p>然而，即使是支持及测试过的数据库，也可能有某个特定版本不支持批量插入（例如有报告说DB2在z/OS上不支持，尽管一般来说DB2是支持的）。这时可以在流程引擎配置中禁用批量插入：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;bulkInsertEnabled&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advancedSecureScripting">18.12. 安全脚本</h3>
<div class="paragraph">
<p>默认情况下，使用<a href="#bpmnScriptTask">脚本任务</a>时，执行的脚本与Java代码具有相似的能力。可以完全访问JVM，永远运行（无限循环），或占用大量内存。</p>
</div>
<div class="paragraph">
<p>相较而言，Java代码需要放在classpath的jar中，与流程定义的生命周期不一样。最终用户一般不会撰写Java代码，这基本上是开发者的工作。</p>
</div>
<div class="paragraph">
<p>而脚本是流程定义的一部分，生命周期一致。脚本任务不需要额外的jar部署步骤，而是在流程部署后就可以执行。有时，脚本任务中的脚本不是由开发者撰写的。所以会产生这个问题：脚本可以完全访问JVM，也可以在执行脚本时阻塞许多系统资源。因此允许执行来自任何人的脚本并不是一个好主意。</p>
</div>
<div class="paragraph">
<p>可以启用<em>安全脚本</em>功能解决这个问题。目前，这个功能只实现了<em>javascript</em>脚本，在项目中添加<em>flowable-secure-javascript</em>依赖启用。Maven：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
    <span class="tok-nt">&lt;groupId&gt;</span>org.flowable<span class="tok-nt">&lt;/groupId&gt;</span>
    <span class="tok-nt">&lt;artifactId&gt;</span>flowable-secure-javascript<span class="tok-nt">&lt;/artifactId&gt;</span>
    <span class="tok-nt">&lt;version&gt;</span>${flowable.version}<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>添加这个依赖会同时引入Rhino依赖（参见<a href="$https://developer.mozilla.org/en-US/docs/Mozilla/Projects/Rhino$$"><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/Rhino" class="bare">https://developer.mozilla.org/en-US/docs/Mozilla/Projects/Rhino</a></a>）。Rhino是一个用于JDK的javascript引擎。过去包含在JDK6与7中，并已被Nashorn引擎取代。然而，Rhino项目仍然在继续开发。许多（包括Flowable用于实现安全脚本的）功能都在之后才加入。在撰写本手册的时候，Nashorn<strong>还没有</strong>实现安全脚本功能需要的功能。</p>
</div>
<div class="paragraph">
<p>这意味着脚本可能存在一些（基本很少）区别（例如，Rhino使用<em>importPackage</em>，而Nashorn使用<em>load()</em>）。</p>
</div>
<div class="paragraph">
<p>通过专门的<em>Configurator</em>对象配置安全脚本，并在流程引擎实例化之前将其传递给流程引擎配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7
8</div></td><td class="code"><span></span><span class="tok-n">SecureJavascriptConfigurator</span> <span class="tok-n">configurator</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">SecureJavascriptConfigurator</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">setWhiteListedClasses</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">HashSet</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;(</span><span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">asList</span><span class="tok-o">(</span><span class="tok-s">&quot;java.util.ArrayList&quot;</span><span class="tok-o">)))</span>
  <span class="tok-o">.</span><span class="tok-na">setMaxStackDepth</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">setMaxScriptExecutionTime</span><span class="tok-o">(</span><span class="tok-mi">3000L</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">setMaxMemoryUsed</span><span class="tok-o">(</span><span class="tok-mi">3145728L</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">setNrOfInstructionsBeforeStateCheckCallback</span><span class="tok-o">(</span><span class="tok-mi">10</span><span class="tok-o">);</span>

<span class="tok-n">processEngineConfig</span><span class="tok-o">.</span><span class="tok-na">addConfigurator</span><span class="tok-o">(</span><span class="tok-n">configurator</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用下列设置：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>enableClassWhiteListing</strong>: 为true时，会将所有类加入黑名单。需要在白名单中添加希望运行的所有类，严格控制暴露给脚本的东西。默认为<em>false</em>。</p>
</li>
<li>
<p><strong>whiteListedClasses</strong>: 一个全限定类名字符串的集合，表示允许在脚本中使用的类。例如，要在脚本中使用<em>execution</em>对象，需要在这个集合中添加<em>org.flowable.engine.impl.persistence.entity.ExecutionEntityImpl</em>字符串。默认为<em>空</em>。</p>
</li>
<li>
<p><strong>maxStackDepth</strong>: 限制在脚本中调用函数时的最大栈深度。可以用于避免在脚本中递归调用方法而导致的栈溢出异常。默认为<em>-1</em>（禁用）。</p>
</li>
<li>
<p><strong>maxScriptExecutionTime</strong>: 脚本允许运行的最大时间。默认为<em>-1</em>（禁用）。</p>
</li>
<li>
<p><strong>maxMemoryUsed</strong>: 脚本允许使用的最大内存数量，以字节计。请注意脚本引擎自己也要需要一定量的内存，也会算在这里。默认为<em>-1</em>（禁用）。</p>
</li>
<li>
<p><strong>nrOfInstructionsBeforeStateCheckCallback</strong>: 脚本每执行x个指令，就通过回调函数进行一次脚本执行时间与内存检测。请注意这不是指脚本指令，而是指java字节码指令（一行脚本可能有上百行字节码指令）。默认为100。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>请注意：</em><em>maxMemoryUsed</em>设置只能用于支持com.sun.management.ThreadMXBean#getThreadAllocatedBytes()方法的JVM，如Oracle JDK。</p>
</div>
<div class="paragraph">
<p>ScriptExecutionListener与ScriptTaskListener也有安全形式：<em>org.flowable.scripting.secure.listener.SecureJavascriptExecutionListener</em>与<em>org.flowable.scripting.secure.listener.SecureJavascriptTaskListener</em>。</p>
</div>
<div class="paragraph">
<p>像这样使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nt">&lt;flowable:executionListener</span> <span class="tok-na">event=</span><span class="tok-s">&quot;start&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.scripting.secure.listener.SecureJavascriptExecutionListener&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;script&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;flowable:string&gt;</span>
        <span class="tok-cp">&lt;![CDATA[</span>
<span class="tok-cp">            execution.setVariable(&#39;test&#39;);</span>
<span class="tok-cp">        ]]&gt;</span>
    <span class="tok-nt">&lt;/flowable:string&gt;</span>
  <span class="tok-nt">&lt;/flowable:field&gt;</span>
  <span class="tok-nt">&lt;flowable:field</span> <span class="tok-na">name=</span><span class="tok-s">&quot;language&quot;</span> <span class="tok-na">stringValue=</span><span class="tok-s">&quot;javascript&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/flowable:executionListener&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以通过<a href="https://github.com/Flowable/Flowable/tree/master/modules/flowable-secure-javascript/src/test/resources">GitHub上的单元测试</a>，
查看不安全脚本以及通过<em>安全脚本</em>功能将其变得安全的例子，</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Tooling">19. 工具</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="JMX">19.1. JMX</h3>
<div class="sect3">
<h4 id="jmxIntroduction">19.1.1. 介绍</h4>
<div class="paragraph">
<p>可以使用标准Java管理扩展（Java Management Extensions, JMX）技术连接Flowable引擎，查询信息或修改配置。任何符合标准的JMX客户端都可以使用。通过JMX可以完成启用与禁用作业执行器、部署新的流程定义文件或删除流程等操作，而不需要写一行代码。</p>
</div>
</div>
<div class="sect3">
<h4 id="jmxQuickStart">19.1.2. 快速开始</h4>
<div class="paragraph">
<p>默认情况下没有启用JMX。用Maven或其他方法将flowable-jmx jar文件加入classpath即可使用默认配置启动JMX。如果使用Maven，可以在pom.xml中添加下列依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.flowable<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>flowable-jmx<span class="tok-nt">&lt;/artifactId&gt;</span>
  <span class="tok-nt">&lt;version&gt;</span>latest.version<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>在添加依赖并启动流程引擎后，就可以使用JMX进行连接了。可以使用在标准JDK发行版中提供的jconsole。在本地线程列表中，可以找到运行Flowable的JVM。如果在“本地进程”中没有列出Flowable的JVM，可以尝试使用这个URL从“远程进程”中连接：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi/flowable</pre>
</div>
</div>
<div class="paragraph">
<p>可以在日志文件中找到正确的本地URL。连接成功后，可以看到标准的JVM信息以及MBean。选择MBeans页签，并在右侧面板选择"org.flowable.jmx.Mbeans"，查看Flowable的MBean。选择任何MBean，都可以查询相应的信息或修改配置。如下图所示：</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/jmx.jconsole.png" alt="jmx.jconsole">
</div>
</div>
<div class="paragraph">
<p>不只是jconsole，任何JMX客户端都可以访问MBeans。大多数数据中心的监控工具都会提供连接至JMX MBeans的连接器。</p>
</div>
</div>
<div class="sect3">
<h4 id="_attributes_and_operations">19.1.3. 属性与操作</h4>
<div class="paragraph">
<p>下表是目前可用的属性与操作的列表。这个列表可能根据需要在未来版本中扩展。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">MBean</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">名字</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ProcessDefinitionsMBean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">processDefinitions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">已部署流程定义的<code>Id</code>、<code>Name</code>、<code>Version</code>、<code>IsSuspended</code>等参数，是一个字符串的list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当前部署的<code>Id</code>、<code>Name</code>、<code>TenantId</code>参数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">getProcessDefinitionById(String id)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">给定id流程定义的<code>Id</code>、<code>Name</code>、<code>Version</code>与<code>IsSuspended</code>参数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deleteDeployment(String id)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">删除给定<code>Id</code>的部署</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">suspendProcessDefinitionById(String id)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">暂停给定<code>Id</code>的流程定义</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">activatedProcessDefinitionById(String id)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">激活给定<code>Id</code>的流程定义</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">suspendProcessDefinitionByKey(String id)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">暂停给定<code>key</code>的流程定义</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">activatedProcessDefinitionByKey(String id)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">激活给定<code>key</code>的流程定义</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployProcessDefinition(String resourceName, String processDefinitionFile)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部署流程定义文件</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JobExecutorMBean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">isJobExecutorActivated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回作业执行器是否在运行</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">setJobExecutorActivate(Boolean active)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">启用或停用作业执行器</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_configuration_3">19.1.4. 配置</h4>
<div class="paragraph">
<p>JMX默认配置为最常使用的配置，以简化部署。但也可以很容易地以代码或配置文件的方式修改默认配置。下列代码展示了如何修改配置文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;processEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;...SomeProcessEngineConfigurationClass&quot;</span><span class="tok-nt">&gt;</span>
  ...
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;configurators&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;list&gt;</span>
	  <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.management.jmx.JMXConfigurator&quot;</span><span class="tok-nt">&gt;</span>

	    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;connectorPort&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;1912&quot;</span> <span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;serviceUrlPath&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;/jmxrmi/flowable&quot;</span> <span class="tok-nt">/&gt;</span>

		...
      <span class="tok-nt">&lt;/bean&gt;</span>
    <span class="tok-nt">&lt;/list&gt;</span>
  <span class="tok-nt">&lt;/property&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>下表展示了可配置的参数与其默认值：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名字</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若值为true，即使已添加依赖也不会启动JMX</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.flowable.jmx.Mbeans</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MBean的域</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">createConnector</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">若值为true，则会创建一个连接器至MbeanServer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MBeanDomain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DefaultDomain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MBean服务器的域</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">registryPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1099</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">注册端口，组成服务URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serviceUrlPath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jmxrmi/flowable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">组成服务URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectorPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果大于0，则作为连接端口组成服务URL</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_jmx_service_url">19.1.5. JMX服务URL</h4>
<div class="paragraph">
<p>JMX服务URL格式如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>service:jmx:rmi://&lt;hostName&gt;:&lt;connectorPort&gt;/jndi/rmi://&lt;hostName&gt;:&lt;registryPort&gt;/&lt;serviceUrlPath&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><code>hostName</code>自动设置为机器的网络名。可以配置<code>connectorPort</code>、<code>registryPort</code>与<code>serviceUrlPath</code>。</p>
</div>
<div class="paragraph">
<p>如果<code>connectionPort</code>小于0，则服务URL不包括这部分，简化为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>service:jmx:rmi:///jndi/rmi://:&lt;hostname&gt;:&lt;registryPort&gt;/&lt;serviceUrlPath&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mavenArchetypes">19.2. Maven脚手架</h3>
<div class="sect3">
<h4 id="_create_test_case">19.2.1. 创建测试用例</h4>
<div class="paragraph">
<p>在开发过程中，有时会需要在实际实现前，先构建一个小型的测试用例来测试想法或功能。这样可以用测试来明确目标。JUnit测试用例也是沟通功能需求及报告Bug的推荐工具。在一份bug报告或功能需求jira单中附加一个测试用例，可以显著减少修复所用的时间。</p>
</div>
<div class="paragraph">
<p>用maven脚手架可以快速创建标准测试用例，简化测试用例的创建过程。标准库中应该已经有脚手架了。如果没有，也可以在<strong>tooling/archtypes</strong>目录下键入<strong>mvn install</strong>，轻松安装到本地maven仓库目录中。</p>
</div>
<div class="paragraph">
<p>使用下列命令创建单元测试项目：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>mvn archetype:generate \
-DarchetypeGroupId=org.flowable \
-DarchetypeArtifactId=flowable-archetype-unittest \
-DarchetypeVersion=&lt;current version&gt; \
-DgroupId=org.myGroup \
-DartifactId=myArtifact</code></pre>
</div>
</div>
<div class="paragraph">
<p>下表介绍每个参数的作用：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 273. 单元测试脚手架生成参数</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">行</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">参数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">说明</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">archetypeGroupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">脚手架的Group id。需要为<strong>org.flowable</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">archetypeArtifactId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">脚手架Artifact id。需要为<strong>flowable-archetype-unittest</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">archetypeVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成的测试项目中使用的Flowable版本</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成的测试项目的Group id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">artifactId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成的测试项目的Artifact id</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>生成的项目的目录结构像是这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.
├── pom.xml
└── src
    └── test
        ├── java
        │   └── org
        │       └── myGroup
        │           └── MyUnitTest.java
        └── resources
            ├── flowable.cfg.xml
            ├── log4j.properties
            └── org
                └── myGroup
                    └── my-process.bpmn20.xml</pre>
</div>
</div>
<div class="paragraph">
<p>可以修改java单元测试用例及相应的流程模型，或者添加新的单元测试用例与流程模型。
如果用该项目来描述bug或功能，测试用例应该在初始时失败，并在修复了bug或实现了预期的功能以后成功。
请确保在发送之前键入<strong>mvn clean</strong>清理项目。</p>
</div>
</div>
</div>
</div>
</div>
</div>
</body>
</html>